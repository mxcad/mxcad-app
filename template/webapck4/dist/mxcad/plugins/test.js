var vO=Object.defineProperty;var BE=Object.getOwnPropertySymbols;var _O=Object.prototype.hasOwnProperty,bO=Object.prototype.propertyIsEnumerable;var Jv=Math.pow,FE=($,p,b)=>p in $?vO($,p,{enumerable:!0,configurable:!0,writable:!0,value:b}):$[p]=b,Bh=($,p)=>{for(var b in p||(p={}))_O.call(p,b)&&FE($,b,p[b]);if(BE)for(var b of BE(p))bO.call(p,b)&&FE($,b,p[b]);return $};var Gt=($,p,b)=>new Promise((on,Df)=>{var Rf=zs=>{try{ma(b.next(zs))}catch(Fh){Df(Fh)}},Ec=zs=>{try{ma(b.throw(zs))}catch(Fh){Df(Fh)}},ma=zs=>zs.done?on(zs.value):Promise.resolve(zs.value).then(Rf,Ec);ma((b=b.apply($,p)).next())});(function($,p,b,on,Df){"use strict";var Rf=document.createElement("style");Rf.textContent=`.heading[data-v-a388a3ba]{font-size:1.5em;margin-bottom:12px}.card[data-v-a388a3ba]{background:#fff;color:#000;background-image:linear-gradient(48deg,#fff 0%,#e5efe9 100%);border-top-right-radius:16px;border-bottom-left-radius:16px;box-shadow:-20px 20px 35px 1px #0a31562e;display:flex;flex-direction:column;padding:32px;margin:40px;max-width:400px;width:100%}.card .btnEn[data-v-a388a3ba]{font-size:.7em}.content-wrapper[data-v-a388a3ba]{font-size:1.1em;margin-bottom:44px}.content-wrapper[data-v-a388a3ba]:last-child{margin-bottom:0}.button[data-v-a388a3ba]{align-items:center;background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;color:#121943;cursor:pointer;display:flex;font-size:1em;font-weight:700;height:40px;justify-content:center;width:180px}.button[data-v-a388a3ba]:focus{border:2px solid transparent;box-shadow:0 0 0 2px #121943;outline:solid 4px transparent}.link[data-v-a388a3ba]{color:#121943}.link[data-v-a388a3ba]:focus{box-shadow:0 0 0 2px #121943}.input-wrapper[data-v-a388a3ba]{display:flex;flex-direction:column}.input-wrapper .label[data-v-a388a3ba]{align-items:baseline;display:flex;font-weight:700;justify-content:space-between;margin-bottom:8px}.input-wrapper .optional[data-v-a388a3ba]{color:#5a72b5;font-size:.9em}.input-wrapper .input[data-v-a388a3ba]{border:1px solid #5a72b5;border-radius:4px;height:40px;padding:8px}code[data-v-a388a3ba]{background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;padding:2px 4px}.modal-header[data-v-a388a3ba]{align-items:baseline;display:flex;justify-content:space-between}.close[data-v-a388a3ba]{background:none;border:none;cursor:pointer;display:flex;height:16px;text-decoration:none;width:16px}.close svg[data-v-a388a3ba]{width:16px}.modal-wrapper[data-v-a388a3ba]{align-items:center;background:rgba(0,0,0,.7);display:flex;justify-content:center;inset:0;position:fixed}#modal[data-v-a388a3ba]{transition:opacity .25s ease-in-out}#modal .modal-body[data-v-a388a3ba]{max-width:830px;opacity:1;transform:translateY(-100px);transition:opacity .25s ease-in-out;width:100%;z-index:1}.outside-trigger[data-v-a388a3ba]{cursor:default;inset:0;position:fixed}.button__link[data-v-a388a3ba]{text-decoration:none}.button[data-v-a388a3ba]{background-color:#4caf50;border:none;color:#fff;text-align:center;text-decoration:none;font-size:16px;margin:4px 2px;-webkit-transition-duration:.4s;transition-duration:.4s;cursor:pointer;overflow:hidden;min-width:0;display:flex;align-items:center;justify-content:center}.button1[data-v-a388a3ba]{background-color:#fff;color:#000;border:2px solid #4caf50}.button1[data-v-a388a3ba]:hover{background-color:#4caf50;color:#fff}.button2[data-v-a388a3ba]{background-color:#fff;color:#000;border:2px solid #008cba}.button2[data-v-a388a3ba]:hover{background-color:#008cba;color:#fff}.btn_box[data-v-a388a3ba]{width:100%;display:flex;justify-items:center;justify-content:start;align-items:start}.btn span[data-v-a388a3ba],.button span[data-v-a388a3ba],.btn[data-v-a388a3ba],.button[data-v-a388a3ba]{display:block;align-items:center;justify-content:center;font-size:clamp(5px,1vw,1em);max-width:100%;max-height:100%;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:normal;padding:0 8px;min-width:0}.heading[data-v-0817c4f4]{font-size:1.5em;margin-bottom:12px}.btn[data-v-0817c4f4]{height:40px;width:100px;text-align:center;line-height:40px;font-size:1em;font-weight:700;overflow:hidden;position:relative;white-space:nowrap;text-overflow:ellipsis}.btn2[data-v-0817c4f4]{background-color:#008cba;color:#fff;border-top-right-radius:4px;border-top-left-radius:4px}.card[data-v-0817c4f4]{background:#fff;color:#000;background-image:linear-gradient(48deg,#fff 0%,#e5efe9 100%);border-top-right-radius:16px;border-bottom-left-radius:16px;box-shadow:-20px 20px 35px 1px #0a31562e;display:flex;flex-direction:column;padding:32px;margin:40px;max-width:400px;width:100%;height:600px}.card .btnEn[data-v-0817c4f4]{font-size:.7em}.content-wrapper[data-v-0817c4f4]{font-size:1.1em;margin-bottom:44px}.content-wrapper[data-v-0817c4f4]:last-child{margin-bottom:0}.button[data-v-0817c4f4]{align-items:center;background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;color:#121943;cursor:pointer;display:flex;font-size:1em;font-weight:700;height:40px;justify-content:center;width:180px;overflow:hidden;position:relative;white-space:nowrap;text-overflow:ellipsis}.button[data-v-0817c4f4]:focus{border:2px solid transparent;box-shadow:0 0 0 2px #121943;outline:solid 4px transparent}.link[data-v-0817c4f4]{color:#121943}.link[data-v-0817c4f4]:focus{box-shadow:0 0 0 2px #121943}.input-wrapper[data-v-0817c4f4]{display:flex;flex-direction:column}.input-wrapper .label[data-v-0817c4f4]{align-items:baseline;display:flex;font-weight:700;justify-content:space-between;margin-bottom:8px}.input-wrapper .optional[data-v-0817c4f4]{color:#5a72b5;font-size:.9em}.input-wrapper .input[data-v-0817c4f4]{border:1px solid #5a72b5;border-radius:4px;height:40px;padding:8px}code[data-v-0817c4f4]{background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;padding:2px 4px}.modal-header[data-v-0817c4f4]{align-items:baseline;display:flex;justify-content:space-between}.close[data-v-0817c4f4]{background:none;border:none;cursor:pointer;display:flex;height:16px;text-decoration:none;width:16px}.close svg[data-v-0817c4f4]{width:16px}.modal-wrapper[data-v-0817c4f4]{align-items:center;background:rgba(0,0,0,.7);display:flex;justify-content:center;inset:0;position:fixed}#modal[data-v-0817c4f4]{transition:opacity .25s ease-in-out}#modal .modal-body[data-v-0817c4f4]{max-width:830px;opacity:1;transform:translateY(-100px);transition:opacity .25s ease-in-out;width:100%;z-index:1}.outside-trigger[data-v-0817c4f4]{cursor:default;inset:0;position:fixed}.button__link[data-v-0817c4f4]{text-decoration:none}.button[data-v-0817c4f4]{background-color:#4caf50;border:none;color:#fff;text-align:center;text-decoration:none;display:inline-block;font-size:16px;margin:4px 2px;-webkit-transition-duration:.4s;transition-duration:.4s;cursor:pointer}.button1[data-v-0817c4f4]{background-color:#fff;color:#000;border:2px solid #4CAF50}.button1[data-v-0817c4f4]:hover{background-color:#4caf50;color:#fff}.button2[data-v-0817c4f4]{background-color:#fff;color:#000;border:2px solid #008CBA}.button2[data-v-0817c4f4]:hover{background-color:#008cba;color:#fff}.btn_box[data-v-0817c4f4]{width:100%;display:flex;justify-items:center;justify-content:start;align-items:start}.textBox[data-v-0817c4f4]{position:absolute;top:30%;left:42%;background-image:linear-gradient(48deg,#fff 0%,#e5efe9 100%);color:#000;padding:10px 15px}.textBox .header[data-v-0817c4f4]{display:flex;justify-content:space-between;align-items:center}.textBox textarea[data-v-0817c4f4]{color:#000;background-color:#ccc;border:1px solid #5a72b5;border-radius:8px;margin-top:10px;font-size:var(--mx-font-size);padding:5px}.textBox .btnBox[data-v-0817c4f4]{display:flex;justify-content:flex-end}.textBox .btnBox button[data-v-0817c4f4]{background-color:#fff;color:#000;border:2px solid #008CBA;border-radius:5px;padding:5px;margin-top:10px}.textBox .btnBox button[data-v-0817c4f4]:hover{background-color:#008cba;color:#fff}.btn span[data-v-0817c4f4],.button span[data-v-0817c4f4],.btn[data-v-0817c4f4],.button[data-v-0817c4f4]{display:block;align-items:center;justify-content:center;font-size:clamp(5px,1vw,1em);max-width:100%;max-height:100%;overflow-x:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:normal;padding:0 8px;min-width:0}.fcc[data-v-a83034f6]{display:flex;align-items:center;justify-content:center}.row[data-v-fff1a9fd]{display:flex;justify-content:space-between;align-items:center}.row .item[data-v-fff1a9fd]{padding:5px;width:45px;height:45px}.row .item[data-v-fff1a9fd]:hover,.row .backColor[data-v-fff1a9fd]{background-color:#fff3}.inLine[data-v-ef6011f8]{max-height:20px;overflow:hidden}.fcb[data-v-ef6011f8]{display:flex;align-items:center;justify-content:space-between}.fcb .symbolBox[data-v-ef6011f8]{display:flex;position:relative;width:40%;height:120px;border:1px solid #ccc;padding:5px}.fcb .symbolBox .symbol[data-v-ef6011f8]{position:absolute;padding:2px;top:-10px;left:10px;background-color:rgb(var(--v-theme-dialog-card-text))}.fcb .symbolBox .symbolImg[data-v-ef6011f8]{margin-top:12px;margin-right:5px;padding:5px;height:35px}.fcb .symbolBox .symbolImg[data-v-ef6011f8]:hover,.fcb .symbolBox .backColor[data-v-ef6011f8]{background-color:rgba(var(--v-theme-on-prominent),.2)}.formBox[data-v-ef6011f8]{height:250px;width:100%;border:1px solid #ccc;position:relative}.formBox .iconFont[data-v-ef6011f8]{position:absolute;width:32%;left:73px;top:50px}.formBox .iconFont .icon[data-v-ef6011f8]{width:100%}.formBox .topData[data-v-ef6011f8]{position:absolute;right:5px;top:7px;width:40%}.formBox .line[data-v-ef6011f8]{position:absolute;left:180px;top:82px;width:50%;height:4px;background-color:rgb(var(--v-theme-on-prominent))}.formBox .bottomData[data-v-ef6011f8]{position:absolute;width:25%;top:90px;right:36px}.formBox .cornerData[data-v-ef6011f8]{position:absolute;bottom:65px;right:235px}.formBox .cornerData .cornerIcon[data-v-ef6011f8]{height:25px;min-width:25px;padding:0}.formBox .cornerData .btnList[data-v-ef6011f8]{position:absolute;display:flex;width:120px;height:60px;flex-wrap:wrap;justify-content:space-around;top:30px}.formBox .leftDate[data-v-ef6011f8]{position:absolute;width:24%;bottom:75px;left:5px}.imgBox[data-v-a986481d]{width:100px;height:50px;background-color:#000;display:flex;justify-content:center;align-items:center;margin-bottom:10px}.radio[data-v-a986481d]{width:100%;display:flex;justify-content:space-between;align-items:center}.fbc[data-v-253ca580]{display:flex;justify-content:space-between;align-items:center}.btnBox[data-v-253ca580]{border:1px solid rgba(var(--v-border-color),var(--v-border-opacity));position:relative;padding:10px 0;margin-top:20px;align-items:center;justify-content:center}.btnBox .tiltle[data-v-253ca580]{display:block;position:absolute;top:-10px;left:5px}.row[data-v-253ca580]{display:flex}.item[data-v-253ca580]{height:35px;width:35px;padding:5px}.item img[data-v-253ca580]{height:25px;width:25px}.itemHover[data-v-253ca580]:hover,.checked[data-v-253ca580]{background-color:#89cbfa99}.btn[data-v-253ca580]{position:absolute;bottom:16px;right:204px;background-color:rgb(var(--v-theme-undertint-bg))!important;min-width:76px}.fbc[data-v-13e7c51f]{display:flex;justify-content:space-between;align-items:center}.btnBox[data-v-13e7c51f]{border:1px solid rgba(var(--v-border-color),var(--v-border-opacity));position:relative;padding:10px 0;margin-top:20px}.btnBox .tiltle[data-v-13e7c51f]{display:block;position:absolute;top:-10px;left:5px}.row[data-v-13e7c51f]{display:flex}.item[data-v-13e7c51f]{height:35px;width:35px;padding:5px}.item img[data-v-13e7c51f]{height:25px;width:25px}.itemHover[data-v-13e7c51f]:hover,.checked[data-v-13e7c51f]{background-color:#89cbfa99}.btn[data-v-13e7c51f]{position:absolute;bottom:16px;right:204px;background-color:rgb(var(--v-theme-undertint-bg))!important;min-width:76px}.checkBtn[data-v-13e7c51f]{background-color:#89cbfa66}.contents[data-v-7d640c71]{padding:5px}.contents .tips[data-v-7d640c71]{opacity:.6}
`,document.head.appendChild(Rf);const Ec=b.ref(!1),ma=b.ref(!1),zs=t=>{Ec.value=!0,ma.value=!1,Nh.value=Object.assign(Nh.value,t||{})},Fh=t=>{ma.value=!0,Ec.value=!1,Nh.value=Object.assign(Nh.value,t||{})},zh=()=>{Ec.value=!1,ma.value=!1},UE={title:"Modal",text:"",oncancel:zh,onsubmit:zh,ongetallentity:zh,ondrawline:zh,docommand:t=>{}},Nh=b.ref(UE),VE=b.ref(!1),Qv=b.ref(""),Lf=b.ref("");document.addEventListener("mouseup",function(){Lf.value=document.getSelection().toString(),Lf.value===""&&(Lf.value=Qv.value)});function GE(){return Gt(this,null,function*(){try{yield navigator.clipboard.writeText(Lf.value)}catch(t){console.error("Failed to copy: ",t)}})}const If=()=>({isModalVisible:Ec,isToolsVisible:ma,isDialogVisible:VE,showModal:zs,showTools:Fh,hideModal:zh,modalOptions:Nh,excelText:Qv,copyTextToClipboard:GE}),OE="modulepreload",jE=function(t){return"/"+t},$v={},c0=function(e,n,r){return e()};var t_=Object.defineProperty,HE=(t,e,n)=>e in t?t_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Fe=(t,e)=>t_(t,"name",{value:e,configurable:!0}),Po=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),Ii=(t,e,n)=>HE(t,typeof e!="symbol"?e+"":e,n),kf,e_=(kf=class{constructor(t){this._listeners=new Map,this._lastMessage={},this.options=Object.assign({ignoreError:!1},t)}get listeners(){return this._listeners}on(){let t=arguments[0],e=arguments[1],n=arguments[2],{objectify:r=!0,count:s=-1}=Object.assign({},n);this._listeners.has(t)||this._listeners.set(t,new Map);let u=++kf.listenerSeqId,h=this._listeners.get(t);return h==null||h.set(u,[e,s]),this._emitRetainEvent(t,u,h),r?{off:Fe(()=>{h==null||h.delete(u),(h==null?void 0:h.size)==0&&this._listeners.delete(t)},"off")}:u}onAny(t,e){return this.on("*",t,e)}_emitRetainEvent(t,e,n){t in this._lastMessage&&this._executeListener(e,n,this._lastMessage[t])}once(t,e,n){return this.on(t,e,Object.assign({},n,{count:1}))}_forEachListeners(t){let e=!1;for(let[n,r]of this._listeners.entries()){if(e)break;for(let[s,[u,h]]of r.entries()){if(e)break;e=t({event:n,listenerId:s,listener:u,count:h,eventListeners:r})===!1}}}_forEachEventListeners(t,e){let n=!1,r=[[t,this._listeners.get(t)]];for(let[s,u]of r)if(u)for(let[h,[o,m]]of u){if(n)break;n=e({event:s,listenerId:h,listener:o,count:m,eventListeners:u})===!1}}off(){if(arguments.length==1){if(typeof arguments[0]=="number")this._forEachListeners(({listenerId:t,eventListeners:e,event:n})=>{var r;if(t==arguments[0])return e.delete(t),((r=this._listeners.get(n))==null?void 0:r.size)==0&&this._listeners.delete(n),!1});else if(typeof arguments[0]=="function"){let t=arguments[0];this._forEachListeners(({listenerId:e,listener:n,eventListeners:r,event:s})=>{var u;n==t&&(r.delete(e),((u=this._listeners.get(s))==null?void 0:u.size)==0&&this._listeners.delete(s))})}}else arguments.length==2&&typeof arguments[0]=="string"&&typeof arguments[1]=="function"&&this._forEachEventListeners(arguments[0],({event:t,listenerId:e,listener:n,eventListeners:r})=>{var s;t==arguments[0]&&n==arguments[1]&&(r.delete(e),((s=this._listeners.get(t))==null?void 0:s.size)==0&&this._listeners.delete(t))})}waitFor(t,e=0){return new Promise((n,r)=>{let s,u=!1,h;e>0&&(s=setTimeout(()=>{u=!0,this.off(h),r(new Error("Timeout"))},e)),h=this.once(t,o=>{u||(clearTimeout(s),n(o))})})}offAll(t){t?this._listeners.delete(t):this._listeners.clear()}_executeListener(t,e,n){if(!e)return;let r=e.get(t);if(r)try{return r[0](n)}catch(s){if(!this.options.ignoreError)throw s}finally{r[1]>-1&&(r[1]=r[1]-1,r[1]==0&&e.delete(t))}}_executeListeners(t,e,n){let r=[];return this._forEachEventListeners(t,({event:s,listenerId:u,eventListeners:h})=>{r.push(this._executeListener(u,h,e)),typeof n=="function"&&n(u),h.size==0&&this._listeners.delete(s)}),r}emit(t,e,n){return n&&(this._lastMessage[t]=e),this._executeListeners(t,e)}emitAsync(t,e,n){return Gt(this,null,function*(){return yield Promise.allSettled(this.emit(t,e,n))})}},Fe(kf,"l"),kf);e_.listenerSeqId=0;var n_=e_;(t=>typeof Po<"u"?Po:typeof Proxy<"u"?new Proxy(t,{get:Fe((e,n)=>(typeof Po<"u"?Po:e)[n],"get")}):t)(function(t){if(typeof Po<"u")return Po.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function i_(){return Date.now().toString()+parseInt(String(Math.random()*1e3))}Fe(i_,"getId");function Bf(t,e=!1){if(typeof t=="number")return!0;if(typeof t!="string"||e)return!1;try{if(t.includes(".")){let n=parseFloat(t);return t.endsWith(".")?!isNaN(n)&&String(n).length===t.length-1:!isNaN(n)&&String(n).length===t.length}else{let n=parseInt(t);return!isNaN(n)&&String(n).length===t.length}}catch(n){return!1}}Fe(Bf,"r");function Ff(t){return Bf(t)}Fe(Ff,"isMessageId");function r_(t){return t&&typeof t=="object"&&t.__VoerkaI18nScope__}Fe(r_,"isI18nScope");function o_(t){return Gt(this,null,function*(){let e=yield t.call(this);return e&&"__esModule"in e||Symbol.toStringTag in e?e.default:e})}Fe(o_,"loadAsyncModule");function s_(t){return t&&typeof t.get=="function"&&typeof t.set=="function"&&typeof t.remove=="function"}Fe(s_,"isStorage");function a_(t){return Gt(this,null,function*(){return(yield Promise.allSettled(t)).map(e=>e.status==="fulfilled"?e.value:e.reason)})}Fe(a_,"execAsyncs");function u0(){try{return typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"}catch(t){return!1}}Fe(u0,"isBrowser");var h0=class l0 extends n_{constructor(e){if(super(),Ii(this,"__VoerkaI18nManager__",!0),Ii(this,"_scopes",[]),Ii(this,"_appScope"),l0.instance)return l0.instance;if(!e)throw new Error("create VoerkaI18nManager failed, appScope is required");this._registerAppScope(e),this._registerScopes(),this._loadPlugins(),l0.instance=this,globalThis.VoerkaI18n=this}get debug(){return this.scope.debug}get logger(){return this.scope.logger}get scopes(){return this._scopes}get activeLanguage(){return this._appScope.activeLanguage}get defaultLanguage(){return this._appScope.defaultLanguage}get loader(){return this._appScope.loader}get storage(){return this.scope.storage}get languages(){return this.scope.languages}get scope(){return this._appScope}_registerScopes(){let e=globalThis.__VoerkaI18nScopes__;e&&Array.isArray(e)&&e.forEach(n=>this.register(n)),delete globalThis.__VoerkaI18nScopes__}getScope(e){return this._scopes.find(n=>n.id===e)}_loadPlugins(){let e=globalThis.__VoerkaI18nPlugins__;e&&Array.isArray(e)&&e.forEach(n=>n(this)),delete globalThis.__VoerkaI18nPlugins__}registerPlugin(e){typeof e=="function"&&e(this)}_registerAppScope(e){this._scopes.push(e),this._appScope=e,this.logger.debug("VoerkaI18nScope<"+e.id+"> is registered as appScope"),this.emitAsync("init",()=>this._appScope.activeLanguage,!0)}register(e){if(!r_(e))throw new Error("register scope failed, invalid scope");this._scopes.push(e),e.bind(this),this.logger.debug(`VoerkaI18nScope<${e.id}> is registered`)}change(e){return Gt(this,null,function*(){yield this._refreshScopes(e);let n=this._appScope.activeLanguage;return this.scope.saveLanguage(),this.emit("change",n,!0),this.logger.info("language changed to: "+n),n})}_refreshScopes(e){return Gt(this,null,function*(){let n=this._scopes.map(r=>r.refresh(e));yield a_(n)})}refresh(){return Gt(this,null,function*(){return yield this._refreshScopes(this.activeLanguage)})}ready(e,n){return this.waitFor("ready",n).then(r=>{e&&e.call(this,r)})}clearPatchedMessages(){this._scopes.forEach(e=>e.clearPatchedMessages())}hasLanguage(e){return this.languages.findIndex(n=>n.name==e)!=-1}clearLanguage(){this.scope.clearLanguage()}saveLanguage(){this.scope.saveLanguage()}restoreLanguage(){this.scope.restoreLanguage()}};Fe(h0,"VoerkaI18nManager"),Ii(h0,"instance");var l_=h0,WE={get(t){if(globalThis.localStorage)return globalThis.localStorage.getItem(t)},set(t,e){globalThis.localStorage&&globalThis.localStorage.setItem(t,e)},remove(t){globalThis.localStorage&&globalThis.localStorage.removeItem(t)}},qE=[{name:"zh",title:"中文",default:!0,active:!0},{name:"en",title:"英文"}],c_=Fe((t,e,n=[])=>{let r=Object.getOwnPropertyDescriptors(e);for(let s of n)delete r[s];Object.defineProperties(t,r)},"copyProps"),Tc=Fe((t,e=[t])=>{let n=Object.getPrototypeOf(t);return n===null?e:Tc(n,[...e,n])},"protoChain"),YE=Fe((...t)=>{if(t.length===0)return;let e,n=t.map(r=>Tc(r));for(;n.every(r=>r.length>0);){let r=n.map(u=>u.pop()),s=r[0];if(r.every(u=>u===s))e=s;else break}return e},"nearestCommonProto"),u_=Fe((t,e,n=[])=>{var r;let s=(r=YE(...t))!==null&&r!==void 0?r:Object.prototype,u=Object.create(s),h=Tc(s);for(let o of t){let m=Tc(o);for(let y=m.length-1;y>=0;y--){let x=m[y];h.indexOf(x)===-1&&(c_(u,x,["constructor",...n]),h.push(x))}}return u.constructor=e,u},"hardMixProtos"),d0=Fe(t=>t.filter((e,n)=>t.indexOf(e)==n),"unique"),zf=Fe((t,e)=>{let n=e.map(u=>Tc(u)),r=0,s=!0;for(;s;){s=!1;for(let u=e.length-1;u>=0;u--){let h=n[u][r];if(h!=null&&(s=!0,Object.getOwnPropertyDescriptor(h,t)!=null))return n[u][0]}r++}},"getIngredientWithProp"),XE=Fe((t,e=Object.prototype)=>new Proxy({},{getPrototypeOf(){return e},setPrototypeOf(){throw Error("Cannot set prototype of Proxies created by ts-mixer")},getOwnPropertyDescriptor(n,r){return Object.getOwnPropertyDescriptor(zf(r,t)||{},r)},defineProperty(){throw new Error("Cannot define new properties on Proxies created by ts-mixer")},has(n,r){return zf(r,t)!==void 0||e[r]!==void 0},get(n,r){return(zf(r,t)||e)[r]},set(n,r,s){let u=zf(r,t);if(u===void 0)throw new Error("Cannot set new properties on Proxies created by ts-mixer");return u[r]=s,!0},deleteProperty(){throw new Error("Cannot delete properties on Proxies created by ts-mixer")},ownKeys(){return t.map(Object.getOwnPropertyNames).reduce((n,r)=>r.concat(n.filter(s=>r.indexOf(s)<0)))}}),"proxyMix");Fe((t,e)=>XE([...t,{constructor:e}]),"softMixProtos");var h_=new WeakMap,KE=Fe(t=>h_.get(t),"getMixinsForClass"),ZE=Fe((t,e)=>h_.set(t,e),"registerMixins"),d_=Fe((t,e)=>{var n,r;let s=d0([...Object.getOwnPropertyNames(t),...Object.getOwnPropertyNames(e)]),u={};for(let h of s)u[h]=d0([...(n=t==null?void 0:t[h])!==null&&n!==void 0?n:[],...(r=e==null?void 0:e[h])!==null&&r!==void 0?r:[]]);return u},"mergeObjectsOfDecorators"),p_=Fe((t,e)=>{var n,r,s,u;return{property:d_((n=t==null?void 0:t.property)!==null&&n!==void 0?n:{},(r=e==null?void 0:e.property)!==null&&r!==void 0?r:{}),method:d_((s=t==null?void 0:t.method)!==null&&s!==void 0?s:{},(u=e==null?void 0:e.method)!==null&&u!==void 0?u:{})}},"mergePropertyAndMethodDecorators"),f_=Fe((t,e)=>{var n,r,s,u,h,o;return{class:d0([...(n=t==null?void 0:t.class)!==null&&n!==void 0?n:[],...(r=e==null?void 0:e.class)!==null&&r!==void 0?r:[]]),static:p_((s=t==null?void 0:t.static)!==null&&s!==void 0?s:{},(u=e==null?void 0:e.static)!==null&&u!==void 0?u:{}),instance:p_((h=t==null?void 0:t.instance)!==null&&h!==void 0?h:{},(o=e==null?void 0:e.instance)!==null&&o!==void 0?o:{})}},"mergeDecorators"),p0=new Map,JE=Fe((...t)=>{var e;let n=new Set,r=new Set([...t]);for(;r.size>0;)for(let s of r){let u=Tc(s.prototype).map(m=>m.constructor),h=(e=KE(s))!==null&&e!==void 0?e:[],o=[...u,...h].filter(m=>!n.has(m));for(let m of o)r.add(m);n.add(s),r.delete(s)}return[...n]},"findAllConstituentClasses"),QE=Fe((...t)=>{let e=JE(...t).map(n=>p0.get(n)).filter(n=>!!n);return e.length==0?{}:e.length==1?e[0]:e.reduce((n,r)=>f_(n,r))},"deepDecoratorSearch");Fe((...t)=>{let e=t.map(n=>$E(n));return e.length===0?{}:e.length===1?e[0]:e.reduce((n,r)=>f_(n,r))},"directDecoratorSearch");var $E=Fe(t=>{let e=p0.get(t);return e||(e={},p0.set(t,e)),e},"getDecoratorsForClass");function m_(...t){var e,n,r;let s=t.map(o=>o.prototype);function u(...o){for(let m of t)c_(this,new m(...o))}Fe(u,"MixedClass"),u.prototype=u_(s,u),Object.setPrototypeOf(u,u_(t,null,["prototype"]));let h=u;{let o=QE(...t);for(let m of(e=o==null?void 0:o.class)!==null&&e!==void 0?e:[]){let y=m(h);y&&(h=y)}g_((n=o==null?void 0:o.static)!==null&&n!==void 0?n:{},h),g_((r=o==null?void 0:o.instance)!==null&&r!==void 0?r:{},h.prototype)}return ZE(h,t),h}Fe(m_,"Mixin");var g_=Fe((t,e)=>{let n=t.property,r=t.method;if(n)for(let s in n)for(let u of n[s])u(e,s);if(r)for(let s in r)for(let u of r[s])u(e,s,Object.getOwnPropertyDescriptor(e,s))},"applyPropAndMethodDecorators"),y_=class{constructor(){Ii(this,"_eventEmitter")}_getEventEmitter(){return this.attached?this.manager:(this._eventEmitter||(this._eventEmitter=new n_),this._eventEmitter)}on(e,n){return this._getEventEmitter().on(e,n)}once(e,n){return this._getEventEmitter().once(e,n)}off(e,n){return this._getEventEmitter().off(e,n)}waitFor(e,n){return this._getEventEmitter().waitFor(e,n)}emit(e,n,r){return Gt(this,null,function*(){return yield this._getEventEmitter().emitAsync(e,n,r)})}};Fe(y_,"EventEmitterMixin");var tT=y_;function ss(t){return t&&typeof t=="function"}Fe(ss,"t");function ml(t){if(typeof t!="object"||t===null)return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(var n=e;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return e===n}Fe(ml,"o");var f0,eT=(f0=class extends Error{},Fe(f0,"m"),f0),nT=0;function x_(t,e={timeout:0}){let n=!1,r=!1,s=!1,u,h,o=0,m,y=++nT,x=Fe(function(){clearTimeout(o),n=!1,r=!1,s=!1,m=new Promise((A,T)=>{u=A,h=T})},"g");x();function M(A=0,T){return Gt(this,null,function*(){if(typeof t=="function"&&t()){n=!0;return}return(n||r)&&x(),A>0&&(o=setTimeout(()=>{n=!0;try{T instanceof Error?h(T):u(T)}catch(P){}},A)),s=!0,m})}return Fe(M,"o"),M.id=y,M.resolve=A=>{if(clearTimeout(o),!!s&&!(n||r)){if(typeof t=="function"&&t())if(t())u(A);else return;else u(A);n=!0}},M.reject=A=>{clearTimeout(o),s&&(n||r||(h(typeof A=="string"?new Error(A):A instanceof Error?A:new Error),r=!0))},M.destroy=()=>{clearTimeout(o),s&&h(new eT),n=!1,s=!1,r=!1,m=null},M.reset=x,M.isResolved=()=>n,M.isRejected=()=>r,M.isPending=()=>s,M}Fe(x_,"p");var v_=class{constructor(){Ii(this,"_patching")}_getPatchKey(e){return`voerkai18n_${this.id}_${e}_patched_messages`}clearPatchedMessages(e){if(this.storage){let n=e?[e]:this.languages.map(r=>r.name);for(let r of n)this.storage.remove(this._getPatchKey(r))}}_patch(e){return Gt(this,null,function*(){var n;this._patching=x_(),e||(e=this.activeLanguage),this._restorePatchedMessages(this.activeMessages,e);try{if(ss(this.loader)){let r=yield this._loadMessagesFromLoader(e);ml(r)&&(Object.assign(this._activeMessages,r),this._setPatchedMessages(r,e),this.emit("patched",{language:e,scope:this.id}))}}catch(r){this.logger.warn(`从远程加载语言补丁包<${e}>时出错: ${r.stack}(scope=${this.id})`)}finally{(n=this._patching)==null||n.resolve(),this._patching=void 0}})}_restorePatchedMessages(e,n){let r=this._getPatchedMessages(n);ml(r)&&(Object.assign(e,r),this.emit("restore",{language:n,scope:this.id}),this.logger.debug(`成功恢复补丁语言包<${n}>(scope=${this.id})`))}_setPatchedMessages(e,n){if(!(!this.attached&&!this.storage))try{this.storage&&this.storage.set(this._getPatchKey(n),JSON.stringify(e))}catch(r){this.logger.error(`保存语言包补丁(${n})时出错: ${r.stack}(scope=${this.id})`)}}_getPatchedMessages(e){try{return this.storage&&this.options.cachePatch?this.storage.get(this._getPatchKey(e)):{}}catch(n){return this.logger.error(`读取语言包补丁(${e})时出错:${n.stack}(scope=${this.id})`),{}}}};Fe(v_,"PatchMessageMixin");var iT=v_,rT=Fe((t,e,n)=>new Promise((r,s)=>{var u=Fe(m=>{try{o(n.next(m))}catch(y){s(y)}},"f"),h=Fe(m=>{try{o(n.throw(m))}catch(y){s(y)}},"d"),o=Fe(m=>m.done?r(m.value):Promise.resolve(m.value).then(u,h),"u");o((n=n.apply(t,e)).next())}),"j"),m0,oT=(m0=class extends Error{},Fe(m0,"b"),m0),sT=0;function __(t,e={timeout:0}){let n=!1,r=!1,s=!1,u,h,o=0,m,y=++sT,x=Fe(function(){clearTimeout(o),n=!1,r=!1,s=!1,m=new Promise((A,T)=>{u=A,h=T})},"m");x();function M(){return rT(this,arguments,function*(A=e.timeout,T){if(typeof t=="function"&&t()){n=!0;return}return(n||r)&&x(),A>0&&(o=setTimeout(()=>{n=!0;try{T instanceof Error?h(T):u(T)}catch(P){}},A)),s=!0,m})}return Fe(M,"c"),M.id=y,M.resolve=A=>{if(clearTimeout(o),!!s&&!(n||r)){if(typeof t=="function"&&t())if(t())u(A);else return;else u(A);n=!0}},M.reject=A=>{clearTimeout(o),s&&(n||r||(h(typeof A=="string"?new Error(A):A instanceof Error?A:new Error),r=!0))},M.destroy=()=>{clearTimeout(o),s&&h(new oT),n=!1,s=!1,r=!1,m=null},M.reset=x,M.isResolved=()=>n,M.isRejected=()=>r,M.isPending=()=>s,M}Fe(__,"R");var b_=class extends Error{};Fe(b_,"VoerkaI18nError");var Uh=b_,aT=class extends Uh{};Fe(aT,"VoerkaI18nInvalidLanguageError");var lT=class extends Uh{};Fe(lT,"VoerkaI18nOnlyOneAppScopeError");var cT=class extends Uh{};Fe(cT,"VoerkaI18nChangeLanguageError");var M_=class extends Uh{};Fe(M_,"VoerkaI18nLoadLanguageError");var w_=M_,A_=class{constructor(){Ii(this,"_refreshSignal")}refresh(e,n){return Gt(this,null,function*(){this._refreshSignal||(this._refreshSignal=__()),e||(e=this.activeLanguage);let r=e,s,{patch:u,fallback:h}=Object.assign({fallback:!1,patch:!0},n);try{s=yield this._loadLanguageMessages(e),this._activeMessages=s,s&&!s.$remote&&u&&(yield this._patch(e))}catch(o){if(o&&o instanceof Uh){let m=this.getFallbackLanguage(e);m&&m!==e&&(r=yield this.refresh(m,{patch:u,fallback:!0}))}}finally{h||(this._activeLanguage=r,(typeof this.messages[r]=="function"||!(r in this.messages))&&(this.messages[r]=this._activeMessages),this._activeParagraphs=this.paragraphs[r],this._refreshSignal.resolve(),this._refreshSignal=void 0,yield this.emit("scope/change",r,!0))}return this._setLanguageAttr(),r})}_loadLanguageMessages(e){return Gt(this,null,function*(){this.logger.debug(`准备加载语言包:${e}`);let n=this.messages[e],r;if(ml(n))r=n;else if(ss(n))try{r=yield o_.call(this,n)}catch(s){this.logger.error(`加载异步语言包<${e}>失败:${s.message}`),r=void 0}if(!r&&ss(this.loader))try{let s=yield this._loadMessagesFromLoader(e);ml(s)?r=Object.assign({$remote:!0},this.messages[this.defaultLanguage],s):this.logger.error(`错误的语言包<${e}>数据:${s}`)}catch(s){throw new w_(s.message)}if(!ml(r))throw new w_(e);return r})}_loadMessagesFromLoader(e){return Gt(this,null,function*(){if(ss(this.loader))return yield this.loader.call(this,e,this)})}ready(){let e=typeof arguments[0]=="function"?arguments[0]:void 0,n=typeof arguments[0]=="number"?arguments[0]:arguments[1];if(typeof e=="function")this.manager.ready(e,n);else return new Promise(r=>{this.manager.ready(r,n)})}changing(e){return Gt(this,null,function*(){var n,r;!this._refreshSignal&&!this._patching||(yield Promise.all([(n=this._refreshSignal)==null?void 0:n.call(this,e),(r=this._patching)==null?void 0:r.call(this,e)]))})}};Fe(A_,"ChangeLanguageMixin");var uT=A_,hT={warn:console.warn,error:console.error,info:console.info,debug:console.debug};function E_(t){let e,n=[],r=Fe((s,...u)=>{let h=u.join(" ");if(e){if(!e.debug)return;e.emit("log",{level:s,message:h})}else if(e=globalThis.VoerkaI18n,e&&e instanceof l_)if(e.debug){n.push([s,h]);let o=Fe((m,y)=>{t?t(m,y):hT[m](y)},"log");e.on("log",({level:m,message:y})=>o(m,y)),n.forEach(([m,y])=>o(m,y))}else n.splice(0,n.length);else n.push([s,h])},"logOutput");return{warn:Fe((...s)=>r("warn",...s),"warn"),error:Fe((...s)=>r("error",...s),"error"),info:Fe((...s)=>r("info",...s),"info"),debug:Fe((...s)=>r("debug",...s),"debug")}}Fe(E_,"createLogger");var dT=class extends Error{constructor(e){super(`Formatters of language<${e}> is not loaded,try to call load()`)}};Fe(dT,"FormattersNotLoadedError");var T_=class{constructor(e){Ii(this,"_formatters",[]),Ii(this,"_scope"),this._scope=e,this._formatters=e==null?void 0:e.options.formatters,this._registerFormatters()}get scope(){return this._scope}get formatters(){return this._formatters}_registerFormatters(){this._formatters&&this._formatters.forEach(e=>{Array.isArray(e)?this.register.apply(this,e):this.register.apply(this,[e])})}_addFormatter(e){try{if(this.scope.interpolator.addFilter(e),e){let n=this.scope.manager.scope;n.id!==this.scope.id&&n.interpolator.addFilter(e)}}catch(n){this.scope.logger.error(`fail while register formatter<${e.name}>：${n.stack}`)}}register(e,n,r){let s=this.scope,u=e.next;e.next=function(h,o,m){let y=m.getConfig;return m.getConfig=()=>Object.assign({},r,n==null?void 0:n[s.activeLanguage],y(e.name)),u.call(this,h,o,m)},this._addFormatter(e)}};Fe(T_,"VoerkaI18nFormatterManager");var pT=T_;function P_(t){return t&&typeof t=="object"&&t.__VoerkaI18nManager__}Fe(P_,"isI18nManger");var S_=class{getLanguage(e){let n=this.languages.findIndex(r=>r.name==e);if(n!==-1)return this.languages[n]}getFallbackLanguage(e){let n=this.getLanguage(e);return n&&n.fallback||this.options.fallback||this._defaultLanguage}hasLanguage(e){return this.languages.findIndex(n=>n.name==e)!=-1}};Fe(S_,"LanguageMixin");var fT=S_,C_=class{_getPluraMessage(e,n){try{return Array.isArray(e)?e.length>n?e[n]:e[e.length-1]:e}catch(r){return Array.isArray(e)?e[0]:e}}_getPluraValue(e){let n=null,r=[];if(ml(e)){let s=e;for(let[u,h]of Object.entries(s)){if(ss(h))try{s[u]=h()}catch(m){s[u]=h}let o=typeof s[u]=="number";(n==null&&o||u.startsWith("$")&&o)&&(n=s[u])}r=[s]}else Array.isArray(e)?r=e.map(s=>{try{s=ss(s)?s():s,Bf(s)&&!n&&(n=parseInt(s))}catch(u){return String(s)}return s}):e!==void 0&&(n=Bf(e)?parseInt(e):0,r=[e]);return[n,r]}_getTranslateComponent(){if(!this._translateComponent){let e=this.options.component||this.appScope.options.component;typeof e=="function"?this._translateComponent=e.call(this,this):(this._translateComponent=()=>{},this.logger.warn("No translate component builder configured"))}return this._translateComponent}_getTranslateTransformer(){if(!this._translateTransformer){let e=this.options.transform||this.appScope.options.transform;typeof e=="function"&&(this._translateTransformer=e.call(this,this))}return this._translateTransformer}_getActiveMessages(e){return typeof this.messages[e]=="function"?(this.logger.warn(`When the t function specifies the language <${e}> , only synchronized language packs can be used`),this.activeMessages):this.messages[e]}translate(e,n,r){if(typeof e!="string")return this.logger.debug(`failed to translate message:${e},it is not a string`),"";let s=(r==null?void 0:r.language)||this.activeLanguage,u=this._getActiveMessages(s);e=e.replace(/\n/g,"\\n");let h=e;if(typeof e!="string")return e;let o=n===void 0?[]:ss(n)?n():n;try{if(Ff(e))h=u[e]||e;else{let x=this.idMap[e];h=u[x]||u[e]||e}let[m,y]=this._getPluraValue(o);Array.isArray(h)&&h.length>0&&(m!==null?h=this._getPluraMessage(h,m):h=h[0]),o.length,h=this.interpolator.replace(h,...y),this._translateTransformer&&(r!=null&&r.transform)&&(h=this._translateTransformer(h,y,r))}catch(m){this.logger.error(`翻译失败：${m.stack}`)}return h}};Fe(C_,"TranslateMixin");var mT=C_,D_=class{_getStorage(){let e=this.storage;return s_(e)?e:void 0}_getStorageKey(){return this.options.storageKey.replace("{scope}",this.id)}restoreLanguage(){let e=this._getStorage();if(e){let n=this._getStorageKey(),r=e.get(n);if(!r||!this.hasLanguage(r))return;this._activeLanguage=r,this.logger.debug(`从存储<${n}>中恢复保存的语言：${r}`)}}saveLanguage(){let e=this._getStorage();if(e){if(!this._activeLanguage)return;let n=this._getStorageKey();e.set(n,this.activeLanguage),this.logger.debug(`当前语言已保存到存储${n}=${this.activeLanguage}`)}}clearLanguage(){let e=this._getStorage();e&&e.remove(this._getStorageKey())}};Fe(D_,"RestoreMixin");var gT=D_,yT=Object.defineProperty,R_=Object.getOwnPropertySymbols,xT=Object.prototype.hasOwnProperty,vT=Object.prototype.propertyIsEnumerable,L_=Fe((t,e,n)=>e in t?yT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,"R"),I_=Fe((t,e)=>{for(var n in e||(e={}))xT.call(e,n)&&L_(t,n,e[n]);if(R_)for(var n of R_(e))vT.call(e,n)&&L_(t,n,e[n]);return t},"b"),Pc=(t=>typeof Po<"u"?Po:typeof Proxy<"u"?new Proxy(t,{get:Fe((e,n)=>(typeof Po<"u"?Po:e)[n],"get")}):t)(function(t){if(typeof Po<"u")return Po.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')}),gl={Abort:Symbol("Abort"),Throw:Symbol("Throw"),Ignore:Symbol("Ignore")},g0,Sc=(g0=class extends Error{constructor(t){super(),this.value=t}},Fe(g0,"a"),g0),y0,yl=(y0=class extends Sc{},Fe(y0,"p"),y0),x0,Nf=(x0=class extends Sc{},Fe(x0,"x"),x0),v0,_0=(v0=class extends Sc{},Fe(v0,"g"),v0),_T={name:"error",priority:"before",args:["operate","value"],default:{operate:"ignore"},next(t,e,n){let r=e.operate.toLowerCase(),s=e.value;return n.onError=(u,h,o,m)=>{if(!(u instanceof Error)||u instanceof Sc)throw u;if(r=="throw")throw s?new Error(s):u;if(r=="abort")throw new yl(s);if(r=="ignore")throw new Nf(s);return h},t}},bT={name:"empty",priority:"before",args:["operate","value"],default:{operate:"abort",value:""},next(t,e,n){let r=e.operate.toLowerCase(),s=e.value;return n.onEmpty=()=>{if(r=="throw")throw new _0;if(r=="abort")throw new yl(s);if(r=="ignore")throw new Nf;return r},t}};function Vh(t,...e){if(e.length===0)return t;let n=e.map((r,s)=>{let u=Object.entries(r||{});return u.some(([h,o])=>o===void 0)?u.reduce((h,[o,m])=>(m!==void 0&&(h[o]=m),h),{}):r});return Object.assign(t,...n)}Fe(Vh,"F"),(t=>typeof Pc<"u"?Pc:typeof Proxy<"u"?new Proxy(t,{get:Fe((e,n)=>(typeof Pc<"u"?Pc:e)[n],"get")}):t)(function(t){if(typeof Pc<"u")return Pc.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function b0(t){if(typeof t!="object"||t===null)return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(var n=e;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return e===n}Fe(b0,"y");function k_(t){return t&&typeof t=="function"}Fe(k_,"v");function M0(t,e,n){if(typeof e=="string"){let r=0,s;for(;(s=t.indexOf(e,r))>-1;){let u=typeof n=="function"?n(e):n,h=t.length;t=t.substring(0,s)+u+t.substring(s+e.length),r=s+u.length+t.length-h}}else{let r;if(!e.global||!e.multiline)throw new Error("The search parameter must be enabled '/gm' option");for(;(r=e.exec(t))!==null;){r.index===e.lastIndex&&e.lastIndex++;let s=t.length,u=r[0].length,h=typeof n=="function"?n(r[0],...r):n;t=t.substring(0,r.index)+h+t.substring(r.index+u),e.lastIndex+=t.length-s}}return t}Fe(M0,"w"),String.prototype.replaceAll||(String.prototype.replaceAll=function(t,e){return M0(this,t,e)});function Gh(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}Fe(Gh,"m");function B_(t,e=!1){if(typeof t=="number")return!0;if(typeof t!="string"||e)return!1;try{if(t.includes(".")){let n=parseFloat(t);return t.endsWith(".")?!isNaN(n)&&String(n).length===t.length-1:!isNaN(n)&&String(n).length===t.length}else{let n=parseInt(t);return!isNaN(n)&&String(n).length===t.length}}catch(n){return!1}}Fe(B_,"C");var MT=/\n/gm,wT=/(["'])(.*?)(\1)/gm,AT=/([\s\[\,\{])(\w+)(\s*\:)/gm;function F_(t,e){try{return JSON.parse(t,(r,s)=>e?e(r,s):s)}catch(r){}let n=t.replace(MT,(r,s,u)=>{let h=u.slice(0,s).trim(),o=u.slice(s+1).trim();return!/,$/.test(h)&&!/[\[\{\}]$/.test(h)&&!/^\}/.test(o)?`,
`:`
`});return n=n.replaceAll(wT,(r,s,u)=>`"${encodeURI(u)}"`),n=n.replaceAll(AT,(r,s,u,h)=>`${s}"${u}"${h}`),n=n.replaceAll("，",",").replaceAll("“",'"').replaceAll("”",'"'),JSON.parse(n,(r,s)=>(typeof s=="string"&&(s=decodeURI(s)),s))}Fe(F_,"V");function z_(t,e="{",n="}"){let r=0,s=0;for(;r<t.length;){let u=t.slice(r,r+e.length),h=t.slice(r,r+n.length);if(u==e){s++,t=t.substring(0,r+e.length)+`${s}%`+t.substring(r+e.length),r+=e.length+String(s).length+1;continue}if(h==n){s>0&&(t=t.substring(0,r)+`%${s}`+t.substring(r)),r+=n.length+String(s).length+1,s--;continue}r++}return t}Fe(z_,"J");function N_(t,...e){return e.length==0&&(e.push(["{","}"]),e.push(["[","]"])),e.forEach(n=>{t.includes(n[0])&&t.includes(n[1])&&(t=z_(t,...n))}),t}Fe(N_,"H");function U_(t,e,n){return[[e,new RegExp(Gh(e)+"\\d+%")],[n,new RegExp("%\\d+"+Gh(n))]].forEach(([r,s])=>{let u;for(;(u=s.exec(t))!==null;)u.index===s.lastIndex&&s.lastIndex++,t=t.replace(s,r)}),t}Fe(U_,"G");function Uf(t,...e){return e.length==0&&(e.push(["{","}"]),e.push(["[","]"])),e.forEach(([n,r])=>{t.includes(n)&&t.includes(r)&&(t=U_(t,n,r))}),t}Fe(Uf,"E");function V_(t){return t?t.trim().substring(1).trim().split("|").map(e=>e.trim()).map(e=>{if(e=="")return null;let n=e.indexOf("("),r=e.lastIndexOf(")");if(n!==-1&&r!==-1){let s=e.substring(n+1,r).trim(),u=O_(s);return[e.substring(0,n),u]}else return[e,[]]}).filter(e=>Array.isArray(e)):[]}Fe(V_,"M");function G_(...t){t.length==0&&(t.push(["{","}"]),t.push(["[","]"]));let e=t.map(([n,r])=>`(${Gh(n)}1%.*?%1${Gh(r)})`);return ET.replace("__TAG_REGEXP__",e.length>0?e.join("|")+"|":"")}Fe(G_,"z");var ET=String.raw`((([\'\"])(.*?)\3))|__TAG_REGEXP__([\d]+\.?[\d]?)|((true|false|null)(?=[,\b\s]))|([\w\.]+)|((?<=,)\s*(?=,))(?<=\s*[,\)]?\s*)`;function O_(t){let e=[],n;t=N_(t);try{let r=new RegExp(G_(),"g");for(;(n=r.exec(t))!==null;){n.index===r.lastIndex&&r.lastIndex++;let s=n[0];if(s.trim()=="")s=void 0;else if(s.startsWith("'")&&s.endsWith("'")||s.startsWith('"')&&s.endsWith('"'))s=s.substring(1,s.length-1),s=Uf(s);else if(s.startsWith("{")&&s.endsWith("}")||s.startsWith("[")&&s.endsWith("]"))try{s=Uf(s),s=F_(s)}catch(u){}else["true","false","null"].includes(s)?s=JSON.parse(s):B_(s)?s=parseFloat(s):s=Uf(String(s));e.push(s)}}catch(r){}return e}Fe(O_,"U");var TT=new RegExp("(?<!\\\\)\\{([\\S]+\\s)?\\s*(\\w+)?((\\s*\\|\\s*\\w*(\\(.*?\\)){0,1}\\s*)*)\\s*(\\s[\\S]+)?\\}","gm");function w0(t,e,n={}){let r=t,s,u=Object.assign({replaceAll:!0},n),h=TT;for(h.lastIndex=0;(s=h.exec(r))!==null;){s.index===h.lastIndex&&h.lastIndex++;let o=s[2]||"",m=(s[1]||"").trim(),y=(s[6]||"").trim(),x=r.length,M=V_(s[3]||"");if(k_(e)){let A=e(o,m,y,M,s[0]);u.replaceAll?r=M0(r,s[0],A):r=r.replace(s[0],A),h.lastIndex+=r.length-x}}return r}Fe(w0,"O");function A0(t,e){let n=e.value;if(t.length>0){let r=Y_.call(this,t,e);for(let s of r)try{n=s.call(this,n)}catch(u){if(u instanceof _0)throw u;if(u instanceof Sc){if(u.value!=null&&(n=u.value),u instanceof yl)break}else throw u}}return this.options.isEmpty(n)||(n=`${e.prefix}${n}${e.suffix}`),n}Fe(A0,"I");function j_(t,e,n,r){if(!this.options.isEmpty(t))return t;let s=r.onEmpty||n.onEmpty||this.options.onEmpty;if(typeof s!="function")return t;let u=s.call(this,t,e,r);throw u instanceof Error?u:u==gl.Abort?new yl:u==gl.Ignore?new Nf:u==gl.Throw?new _0:new yl(u)}Fe(j_,"K");function H_(t,e,n,r,s){let u=s.onError||r.onError||this.options.onError;if(typeof u!="function")return e;let h=u.call(this,t,e,n,s);throw h instanceof Error?h:h==gl.Abort?new yl:h==gl.Ignore?new Nf:h==gl.Throw?t:new yl(h)}Fe(H_,"Q");function W_(t,e,n){var r;let s=Object.assign({},typeof t.default=="function"?t.default():t.default);return e.length==1&&b0(e[0])?Vh(s,e[0]):t.args&&((r=t.args)==null?void 0:r.length)>0&&t.args.forEach((u,h)=>{e[h]!==void 0&&(s[u]=e[h])}),u=>{let h;try{n.args=e,h=t.next.call(this,u,s,n),h=j_.call(this,h,s,t,n)}catch(o){if(o.filter=t.name,o instanceof Sc)throw o;return this.log(`当执行过滤器器<${n.match}:${t.name}>时出错:${o.stack}`),H_.call(this,o,u,s,t,n)}return String(h)}}Fe(W_,"Y");function q_(t){let e=[],n=t.map(([r,s])=>[this.getFilter.call(this,r),s]).filter(([r])=>r!=null);return n=n.reduce((r,[s,u])=>(s&&(s.priority=="before"?r.unshift([s,u]):s.priority=="after"?e.push([s,u]):r.push([s,u])),r),[]),n.concat(e)}Fe(q_,"Z");function Y_(t,e){let n=q_.call(this,t),r=[];for(let[s,u]of n)r.push(W_.call(this,s,u,e));return r}Fe(Y_,"ee");var E0,PT=(E0=class{constructor(t){this.options=Vh({log:console.log,filters:{},missing:"default",filterContext:{}},t),this.addDefaultHandlers(),this.addBuildinFilters(),this.normalizeFilters()}get filters(){return this.options.filters}addDefaultHandlers(){this.options.onError=()=>gl.Ignore,this.options.onEmpty=()=>"",this.options.isEmpty=t=>t===null||t===""}addFilter(t){if(!t.name)throw new Error("Filter name cannot be empty");if(typeof t.next!="function")throw new Error("The filter must provide a next function");return t=Vh({priority:"normal"},t),this.filters[t.name]=t}removeFilter(t){delete this.filters[t]}getFilter(t){var e;if(t in this.options.filters)return this.options.filters[t];{let n=(e=this.options.getFilter)==null?void 0:e.call(this,t);return typeof n=="function"?{name:t,next:n}:t in String.prototype?{name:t,next:Fe((r,s,u)=>r[t](...u.args),"next")}:n}}addBuildinFilters(){this.addFilter(_T),this.addFilter(bT)}normalizeFilters(){Object.entries(this.options.filters).forEach(([t,e])=>{let n=Vh({name:t,priority:"normal",args:null,next:Fe(r=>r,"next")},typeof e=="function"?{filter:e}:e);this.options.filters[t]=n})}getMissingValue(t,e){let n=this.options.missing;if(n=="default")return"";if(n=="ignore")return e;if(typeof n=="function")return n.call(this,t)}replace(t,...e){if(e.length===0)return t;if(e.length===1&&typeof e[0]=="function"&&(e[0]=e[0].call(this)),e.length===1&&b0(e[0])){let n=e[0];return w0.call(this,t,(r,s,u,h,o)=>{let m=r in n?n[r]:this.getMissingValue(r,o);return typeof m=="function"&&(m=m.call(this)),A0.call(this,h,I_({name:r,value:m,prefix:s,suffix:u,template:t,match:o,args:[]},this.options.filterContext))})}else{let n=e.length===1&&Array.isArray(e[0])?[...e[0]]:e,r=0;return w0.call(this,t,(s,u,h,o,m)=>{let y=n.length>r?n[r++]:this.getMissingValue(r,m);return typeof y=="function"&&(y=y.call(this)),A0.call(this,o,I_({name:s,value:y,prefix:u,suffix:h,template:t,match:m,args:[]},this.options.filterContext))},{replaceAll:!1})}}log(t,...e){this.options.debug&&this.options.log(t,...e)}},Fe(E0,"$"),E0);function X_(t,e,n){let{defaultValue:r,delimiter:s,matched:u}=Object.assign({delimiter:"."},n);if(!t||typeof e!="string")return r;if(!e)return t;let h=e.split(s),o=t,m,y;try{for(let x of h)if(o instanceof Map||o instanceof WeakMap){if(!o.has(x))return r;m=o,y=x,o=o.get(x)}else if(o instanceof Set){let M=parseInt(x,10);if(M>=o.size)return r;m=o,y=M,o=[...o][M]}else if(o&&typeof o=="object"&&x in o)m=o,y=Array.isArray(o)?parseInt(x):x,o=o[x];else return r}catch(x){return r}return typeof u=="function"&&u({value:o,parent:m,indexOrKey:y}),o}Fe(X_,"u");var K_=class{constructor(){Ii(this,"_flexVars")}_initInterpolators(){this._flexVars=new PT({filterContext:{getConfig:Fe(e=>{let n=this.activeMessages.$config||{};return e?X_(n,e):n},"getConfig"),scope:this}})}};Fe(K_,"InterpolatorMixin");var ST=K_;function Z_(t,...e){if(e.length===0)return t;let n=e.map((r,s)=>{let u=Object.entries(r||{});return u.some(([h,o])=>o===void 0)?u.reduce((h,[o,m])=>(m!==void 0&&(h[o]=m),h),{}):r});return Object.assign(t,...n)}Fe(Z_,"u");var T0=class zE extends m_(tT,iT,uT,fT,mT,ST,gT){constructor(e){super(),Ii(this,"__VoerkaI18nScope__",!0),Ii(this,"_options"),Ii(this,"_manager"),Ii(this,"_formatterManager",null),Ii(this,"_logger"),Ii(this,"_defaultLanguage","zh-CN"),Ii(this,"_activeLanguage","zh-CN"),Ii(this,"_activeMessages",{}),Ii(this,"_patchedMessages",{}),Ii(this,"_translateComponent"),Ii(this,"_translateTransformer"),Ii(this,"_activeParagraphs",{}),Ii(this,"$id",++zE.idSeq),this._options=Z_({id:i_(),library:!1,debug:!1,injectLangAttr:!0,languages:[],messages:{},paragraphs:{},idMap:{},formatters:[],attached:!0,storageKey:"language",cachePatch:!0},e),this._init()}get id(){return this._options.id}get options(){return this._options}get attached(){return this._options.attached}get debug(){return this._options.debug}get library(){return this._options.library}get formatters(){return this._formatterManager}get defaultLanguage(){return this._defaultLanguage}get defaultMessages(){return this.messages[this.defaultLanguage]}get messages(){return this._options.messages}get paragraphs(){return this._options.paragraphs}get idMap(){return this._options.idMap}get languages(){return this._options.languages}get manager(){return this._manager}get appScope(){return this._manager.scope}get interpolator(){return this._flexVars}get logger(){return this._logger}get t(){return this.translate.bind(this)}get Translate(){return this._getTranslateComponent()}get activeMessages(){return this._activeMessages}get activeParagraphs(){return this._activeParagraphs}get activeLanguage(){return this._activeLanguage}get storage(){return this.getScopeOption("storage")}get loader(){return this.getScopeOption("loader")}get $t(){return(e,n,r)=>(this._getTranslateTransformer(),r||(r={}),r.transform=!0,this.translate(e,n,r))}getScopeOption(e){let n=this._options;return this.attached?n[e]||(this.library?this._manager[e]:void 0):n[e]}_initOptions(){if(!Array.isArray(this.languages))this.logger.warn("[VoerkaI18n] invalid language settings, will use default language settings."),this._options.languages=Object.assign([],qE);else if(this.languages.length==0)throw new Error("[VoerkaI18n] must provide valid language settings.");let e,n;this.languages.forEach(s=>{s.default&&(n=s.name),s.active&&(e=s.name)});let r=this._options.messages;if(n in r||(n=Object.keys(r)[0]),e in r||(e=n),!(n in r))throw new Error("[VoerkaI18n] invalid language configuration, must provide valid default and active languages.");if(this._activeLanguage=e,this._defaultLanguage=n,!this._options.library&&!this._options.storage&&(this._options.storage=WE),ss(this.messages[this._defaultLanguage]))throw new Error("[VoerkaI18n] default language pack must be static content, can't use async load way.");this._activeMessages=this.messages[this._activeLanguage],this._activeParagraphs=this.paragraphs[this._activeLanguage]}_init(){this._logger=E_(this._options.log),this._initOptions(),this.library||this.restoreLanguage(),this._initInterpolators(),this.registerToManager(),this._formatterManager=new pT(this)}bind(e){this._manager=e,this._manager.once("init",this._initRefresh.bind(this))}_initRefresh(e){if(this.library)this.refresh(e&&e());else{let n=[];(this._defaultLanguage!==this._activeLanguage||ss(this.activeMessages))&&n.push(this.refresh(void 0,{patch:!1})),n.push(this._patch()),Promise.all(n).then(()=>{this.emit("ready",this.activeLanguage,!0),this._setLanguageAttr()})}}registerToManager(){if(!this.attached)return;let e=!this.options.library;e&&(globalThis.VoerkaI18n&&globalThis.VoerkaI18n.scope&&u0()&&console.warn("Only can have one i18nScope with library=false"),this._manager=new l_(this));let n=globalThis.VoerkaI18n;n&&P_(n)?e?this._initRefresh():n.register(this):(globalThis.__VoerkaI18nScopes__||(globalThis.__VoerkaI18nScopes__=[]),globalThis.__VoerkaI18nScopes__.push(this))}change(e){return Gt(this,null,function*(){let n=this.activeLanguage;return this.attached?n=yield this._manager.change(e):n=yield this.refresh(e),n})}_setLanguageAttr(){if(!(this.library||!u0()))try{let e=this._options.injectLangAttr;if(!e)return;let n=e===!0?document.body:document.body.querySelector(e);n&&n.setAttribute("lang",this.activeLanguage)}catch(e){}}getRawMessage(e){if(Ff(e)){if(e in this.defaultMessages)return this.defaultMessages[e]}else return e}getMessageId(e){if(Ff(e))return e;if(e in this.idMap)return this.idMap[e]}};Fe(T0,"VoerkaI18nScope"),Ii(T0,"idSeq",0);var CT=T0;function DT(t,e,n){return r=>{let s=t.next;return t.next=function(u,h,o){let m=o.getConfig;return o.getConfig=()=>Object.assign({},n,e==null?void 0:e[r.activeLanguage],m(t.name)),s.call(this,u,h,o)},t}}Fe(DT,"createFormatter");function RT(t){let e=globalThis.VoerkaI18n;e?e.registerPlugin(t):(globalThis.__VoerkaI18nPlugins__||(globalThis.__VoerkaI18nPlugins__=[]),globalThis.__VoerkaI18nPlugins__.push(t))}Fe(RT,"definePlugin");const LT={get(t){if(globalThis.localStorage)return globalThis.localStorage.getItem(t)},set(t,e){globalThis.localStorage&&globalThis.localStorage.setItem(t,e)},remove(t){globalThis.localStorage&&globalThis.localStorage.removeItem(t)}};var IT=Object.defineProperty,pr=(t,e)=>IT(t,"name",{value:e,configurable:!0}),Cc=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(e,n)=>(typeof require!="undefined"?require:e)[n]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function J_(t,e=!1){if(typeof t=="number")return!0;if(typeof t!="string"||e)return!1;try{if(t.includes(".")){let n=parseFloat(t);return t.endsWith(".")?!isNaN(n)&&String(n).length===t.length-1:!isNaN(n)&&String(n).length===t.length}else{let n=parseInt(t);return!isNaN(n)&&String(n).length===t.length}}catch(n){return!1}}pr(J_,"r"),(t=>typeof Cc<"u"?Cc:typeof Proxy<"u"?new Proxy(t,{get:pr((e,n)=>(typeof Cc<"u"?Cc:e)[n],"get")}):t)(function(t){if(typeof Cc<"u")return Cc.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});function Q_(t,e=3){let n=new RegExp(String.raw`(?!^)(?=(\d{${e}})+$)`,"g"),r=t.replace(n,",");return r.startsWith(",")&&(r=r.substring(1)),r.endsWith(",")&&(r=r.substring(0,r.length-2)),r}pr(Q_,"addSplitChars");function P0(t,e){let{symbol:n="",division:r=3,prefix:s="",precision:u=-1,suffix:h="",unit:o=0,radix:m=3,units:y=[],format:x="{symbol}{value}{unit}"}=e,[M,A]=String(t).split(".");o>0&&m>0&&(M.length<m*o&&(M=Array.from({length:m*o-M.length+1}).fill(0).join("")+M),A=M.substring(Number(M),M.length-m*o)+A,M=M.substring(0,M.length-m*o),M==""&&(M="0"));let T=[];T.push(Q_(M,r)),A&&J_(u)&&u!=0&&(u==0||(u==-1?T.push(`.${A}`):u>0&&(u<0?A=String(parseFloat(`0.${A}`)):A=String(parseFloat(`0.${A}`).toFixed(u)).split(".")[1],T.push(`.${A}`))));const P=y[o]||"";return x.replace("{value}",T.join("")).replace("{symbol}",n).replace("{prefix}",s).replace("{suffix}",h).replace("{unit}",P)}pr(P0,"toCurrency");var kT=[{name:"currency",args:["format","unit","precision","prefix","suffix","division","symbol","radix"],next(t,e,n){const r=n.getConfig(),s=Object.assign({},r,e);return s.format in s&&(s.format=s[s.format]),s.unit=parseInt(String(s.unit))||0,s.unit>s.units.length-1&&(s.unit=s.units.length-1),s.unit<0&&(s.unit=0),s.unit>0&&s.precision==2&&(s.precision=-1),P0(t,s)}},{"en-US":{units:[""," thousands"," millions"," billions"," trillions"],radix:3,symbol:"$",prefix:"USD",suffix:"",division:3,precision:2},"zh-CN":{units:["","万","亿","万亿","万万亿"],radix:4,symbol:"￥",prefix:"RMB",suffix:"元",division:4,precision:2}},{default:"{symbol}{value}{unit}",long:"{prefix} {symbol}{value}{unit}{suffix}",short:"{symbol}{value}{unit}",custom:"{prefix} {symbol}{value}{unit}{suffix}",format:"default"}],BT=[{name:"number",args:["precision","division"],next(t,e,n){const r=n.getConfig();return P0(t,Object.assign({},r,e))}},{"en-US":{division:3},"zh-CN":{division:4}}];function ga(t){return t instanceof Date?t:new Date(t)}pr(ga,"toDate");var FT=[{name:"timeSlots",args:["upper"],default:{upper:!0},next(t,e,n){const r=n.getConfig(),s=ga(t).getHours(),u=!!e.upper;let h=r.slots.findIndex(o=>s<o);return h===-1&&(h=r.upperCases.length-1),u?r.upperCases[h]:r.lowerCases[h]}},{"en-US":{slots:[12],lowerCases:["am","pm"],upperCases:["AM","PM"]},"zh-CN":{slots:[5,8,11,13,18],lowerCases:["凌晨","早上","上午","中午","下午","晚上"],upperCases:["凌晨","早上","上午","中午","下午","晚上"]}}];function S0(t,...e){if(e.length===0)return t;let n=e.map((r,s)=>{let u=Object.entries(r||{});return u.some(([h,o])=>o===void 0)?u.reduce((h,[o,m])=>(m!==void 0&&(h[o]=m),h),{}):r});return Object.assign(t,...n)}pr(S0,"u");var Vf={en:{month:{long:["January","February","March","April","May","June","July","August","September","October","November","December"],short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"]},weekday:{long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],short:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"]}},cn:{month:{long:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],short:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},weekday:{long:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],short:["周日","周一","周二","周三","周四","周五","周六"]}}},$_={en:{slots:[12],names:["AM","PM"]},cn:{slots:[6,9,11,13,18],names:["凌晨","早上","上午","中午","下午","晚上"]}},zT="YYYY-MM-DD HH:mm:ss";function C0(t){t<0&&t>23&&(t=0);let e=[0,...$_[this.language].slots,24].findIndex(n=>n>t)-1;return $_[this.language].names[e]}pr(C0,"h");function D0(t,e,n){let r=S0({language:"cn"},n),s=t instanceof Date?t:new Date(t||Date.now()),u=s.getHours(),h=String(u).padStart(2,"0"),o=u>12?u-12:u,m=String(o).padStart(2,"0"),y=String(s.getMinutes()),x=String(s.getSeconds()),M=String(s.getMilliseconds()),A=String(s.getFullYear()),T=s.getMonth(),P=s.getDay(),D=String(s.getDate()),k=[["HH",h],["H",u],["hh",m],["h",o],["mm",y.padStart(2,"0")],["m",y],["ss",x.padStart(2,"0")],["s",x],["SSS",M.padStart(3,"0")],["A",u>12?"PM":"AM"],["a",u>12?"pm":"am"],["t",C0.call(r,u)],["T",C0.call(r,u)],["YYYY",A],["yyyy",A],["YY",A.substring(2)],["MMM",Vf[r.language].month.short[T]],["MM",String(T+1).padStart(2,"0")],["M",T+1],["DD",D.padStart(2,"0")],["D",D],["d",P],["dd",Vf[r.language].weekday.short[P]],["ddd",Vf[r.language].weekday.short[P]],["dddd",Vf[r.language].weekday.long[P]]],z=e||zT;return k.forEach(([O,U])=>z=z.replaceAll(O,U)),z}pr(D0,"H");function tb(t,e,n){if(typeof e=="string"){let r=0,s;for(;(s=t.indexOf(e,r))>-1;){let u=typeof n=="function"?n(e):n,h=t.length;t=t.substring(0,s)+u+t.substring(s+e.length),r=s+u.length+t.length-h}}else{let r;if(!e.global||!e.multiline)throw new Error("The search parameter must be enabled '/gm' option");for(;(r=e.exec(t))!==null;){r.index===e.lastIndex&&e.lastIndex++;let s=t.length,u=r[0].length,h=typeof n=="function"?n(r[0],...r):n;t=t.substring(0,r.index)+h+t.substring(r.index+u),e.lastIndex+=t.length-s}}return t}pr(tb,"s"),String.prototype.replaceAll||(String.prototype.replaceAll=function(t,e){return tb(this,t,e)});var eb={local:pr(t=>t.toLocaleString(),"local"),iso:pr(t=>t.toISOString(),"iso"),utc:pr(t=>t.toUTCString(),"utc"),gmt:pr(t=>t.toGMTString(),"gmt")},NT=[{global:!0,name:"date",args:["format"],next(t,e,n){const r=n.getConfig(),s=ga(t);let u=e.format||r.format;if(u in eb)return eb[u](s);if(u in r&&(u=r[u],typeof u=="function"))return u(s);if(typeof u=="string")return D0(s,u)}},{"en-US":{long:"YYYY/MM/DD HH:mm:ss",short:"YYYY/MM/DD"},"zh-CN":{long:"YYYY年M月D日 HH点mm分ss秒",short:"YYYY年M月D日"}},{format:"local"}],nb={local:pr(t=>t.toLocaleTimeString(),"local"),timestamp:pr(t=>t.getTime(),"timestamp")},UT=[{name:"time",args:["format"],next(t,e,n){const r=n.getConfig(),s=ga(t);let u=e.format||r.format;if(u in nb)return nb[u](s);if(u in r&&(u=r[u],typeof u=="function"))return u(s);if(typeof u=="string")return D0(s,u)}},{"en-US":{long:"HH:mm:ss"},"zh-CN":{long:"HH点mm分ss秒"}},{format:"local",short:"HH:mm:ss"}],VT=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],GT=["周日","周一","周二","周三","周四","周五","周六"],OT=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],jT=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],HT=[{name:"weekday",args:["format"],next(t,e,n){const r=n.getConfig(),s=ga(t).getDay(),u=e.format||"long";if(typeof u=="string"&&u in r){const h=r[u];return typeof h=="function"?h(s):h[s]}return s}},{"en-US":{long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],short:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"]},"zh-CN":{long:VT,short:GT}},{format:"long"}],WT=[{name:"month",args:["format"],next(t,e,n){const r=n.getConfig(),s=ga(t).getMonth()+1,u=e.format||r.format;if(typeof u=="string"&&u in r){const h=r[u];return typeof h=="function"?h(s):h[s-1]}return s}},{"en-US":{long:["January","February","March","April","May","June","July","August","September","October","November","December"],short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"]},"zh-CN":{long:OT,short:jT}},{format:"long"}],qT=[{name:"quarter",args:["format"],next(t,e,n){const r=n.getConfig(),s=ga(t).getMonth()+1,u=Math.floor(s%3==0?s/3:s/3+1)-1,h=e.format||r.format;if(typeof h=="string"&&h in r){const o=r[h];return typeof o=="function"?o(u):o[u]}return u}},{"en-US":{long:["First Quarter","Second Quarter","Third Quarter","Fourth Quarter"]},"zh-CN":{long:["一季度","二季度","三季度","四季度"]}},{format:"short",short:["Q1","Q2","Q3","Q4"]}],Oh=[1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6,Number.MAX_SAFE_INTEGER];function ib(t,e,n){let{units:r,now:s,before:u,after:h}=S0({units:["秒","分钟","小时","天","周","个月","年"],now:"刚刚",before:"{value}{unit}前",after:"{value}{unit}后"},n),o=typeof t=="number"?new Date(t).getTime():t.getTime(),m=(e instanceof Date?e:typeof e=="number"?new Date(e):new Date).getTime(),y=o-m,x=Oh.findIndex(M=>Math.abs(y)<M)-1;if(x<0&&(x=0),x>Oh.length-1&&(x=Oh.length-1),y<1e3&&y>-1e3)return s;if(y<=-1e3){let M=parseInt(String(Math.abs(y)/Oh[x]));return u.replace("{value}",M).replace("{unit}",r[x])}else{let M=parseInt(String(Math.abs(y)/Oh[x]));return h.replace("{value}",M).replace("{unit}",r[x])}}pr(ib,"b");var YT=[{name:"relativeTime",args:["base"],default:pr(()=>({base:new Date}),"default"),next(t,e,n){const r=n.getConfig(),s=e.base||new Date;return ib(ga(t),s,r)}},{"en-US":{units:["seconds","minutes","hours","days","weeks","months","years"],now:"Just now",before:"{value} {unit} ago",after:"after {value} {unit}"},"zh-CN":{units:["秒","分钟","小时","天","周","个月","年"],now:"刚刚",before:"{value}{unit}前",after:"{value}{unit}后"}}],XT=[kT,BT,FT,NT,UT,HT,WT,qT,YT];const KT=(t,e)=>Gt(this,null,function*(){return yield(yield fetch(MxPluginContext.getLoaderLanguageUrl(t,e))).json()}),ZT={"zh-CN":{},"en-US":{},"ko-KR":{}},JT={" 指定输出范围第一点:":718," 指定输出范围第二点:":719," 指定第一点:":720," 指定第二点:":721," 云线框起始点:":722," 云线框结束点:":723," 审图标注点:":724," 点击开启绘制云线:":725," 再次点击结束绘制云线:":726,"指定一点:":727,"指定二点:":728,选择对象:729," 指定下一个点:":730,"\\指定插入基点":731," 指定表格插入点:":732,"指定插入点:":733,指定插入基点:734,选择标注对象:735,请选择目标文字:736," 指定填充区域内部一点:":737,"没有找到闭合区域 ":738,表面粗糙度:739,焊接符号:740,形位公差:741,选择要需要开启自定义属性的对象:742,选择要隐藏的对象:743," 指定插入点:":744," 指定一点:":745,指定夹角:746," 指定二点:":747,选择图案填充对象:748,"指定第一点:":749,"指定第二点:":750,"指定第二个角度点:":751,"指定最后一个点:":752,"指定坐标点:":753,"指定标注点:":754,请输入审批意见:755,指定云线框起始点:756,指定云线框终止点:757,指定审图标注点:758,"指定第一个角点:":759,"指定第二个角点:":760,"指定序号位置:":761,旋转符号:762,标记类型:763,"请选择需要标记的圆:":764,请设置定位点或直线或圆弧或圆:765,拖动确定标注位置:766,请指定或输入角度:767,焊缝符号:768,"请拾取定位点、直线或圆弧":769,请指定第二点:770,请设置定位点:771,请设置角度:772,请设置定位点或直线或圆弧:773,请设置引线转折点:774,拖动确定定位点:775,"请指定第一点:":776,"请指定第二点:":777,请选择目标块对象:778,请输入新块名:779,选择需要修改基点的块:780,设置基点:781,选择需要修改颜色的块:782,"输入颜色索引(0~256)":783,请选择源块:784,"选择要刷的目标块:":785,选择连接方式:786,手动逐个连线:787,自动批量连线:788,请选择连线的块:789,设置中心线长度:790,"选择要旋转的目标块:":791,设置旋转角度:792,请设置缩放比例:793,"请设置选择范围:":794,请选择目标块:795,请设置统计范围:796,"指定表格插入点:":797,选择目标曲线:798,指定长度标注点:799,选择目标对象:800,请选择目标斜率对象:801,请设置标注文字高度:802,指定斜率标注点:803,请选择目标坐标点:804,请指定标注位置:805,指定起点:806,指定终点:807,指定标注方向:808,请设置文字内容:809,请选择面积的第一个点:810,请选择下一个点:811,请选择面积标注的位置:812,请选择矩形的角点1:813,请选择矩形的角点2:814,请设置面积标注的位置:815,请选择一个测量点:816,请选择一条直线:817,请设置尺寸线的位置:818,请选择一条弧线:819,请指定尺寸线位置:820,请选择一个圆对象:821,请指定文字位置:822,请选择直线的端点或弧线:823,请指定文字的位置:824,请选择一个连续测量的标注:825,请选择第二条直线:826,请设置角度标注的位置:827," 请输入星形顶点数：":828," 指定星形中心点:":829,"请设置星形的内半径:":830," 指定星形的外半径:":831," 请输入凹凸线宽度<5>":832," 请输入凹凸线高度<10>":833,请点击确定起始点:834,请点击确定终点:835," 请输入锯齿线宽度<5>":836," 请输入锯齿线高度<10>":837," 请输入矩形宽度<5>":838," 请输入矩形高度<10>":839,请点击确定矩形中心:840," 请输入管径<10>":841," 请输入长出管口长度<5>":842,请点击确定起点:843,指定剖管线起点:844,指定剖管线终点:845,选择剖管线圆弧方向:846,左边:847,右边:848,选择模式:849,直线焊缝:850,弧线焊缝:851," 请输入焊缝半径<5>":852,指定圆弧的第二个点:853,指定圆弧的端点:854,"请输入宽度<25>":855,"请输入高度<15>":856,"请输入楼梯级数<10>":857,"请确定圆心位置 ":858,请输入圆半径:859," 请输入保温棉宽度<5>":860," 请输入保温棉高度<10>":861,请点击下一个点:862,请选择第一条线:863,请选择第二条线:864,请选择终点:865,请选择目标矩形:866,设置指北针中心点:867,设置指北针半径:868,选择提示框指向:869," 指定消息框第一点:":870," 指定消息框第二点:":871," 设置消息框指向:":872,请设置基准符文字:873,请设置文字高度:874,请设置基准符位置:875,请设置定位点或圆弧或直线:876,请设置符号位置:877,请设置圆心:878,请设置齿轮圆心:879,请设置齿轮半径:880," 请设置中心线长度10>":881,请选择第一个圆:882,请选择第二个圆:883,请设置矩形左上角点:884,请设置矩形右下角点:885,请设置圆角半径:886,请选择多边形起点:887,请选择多边形顶点:888,"选择对象:":889,指定基点:890,"指定第二个点 ":891,阵列:892,退出:893,放弃:894,"输入要进行阵列的项目数 ":895,选择圆弧对象:896,"选择复制旋转对象:":897,"请指定目标点 ":898,请指定旋转角度:899,选择要转成多边形的对象:900,设置多边形边数:901," 输入选项":902,内接于圆:903,外切于圆:904,选择要修改颜色的对象:905,输入颜色索引:906,隐藏:907,隐藏未选:908,全部显示:909,选择目标的对象:910," 指定删除方框第一点:":911," 指定删除方框第二点:":912," 选择需要精确删除的实体":913," 请选择角度复制对象":914," 请输入角度复制数量":915," 请输入角度复制的基点":916," 请输入复制角度":917,请选择顶点对象:918,请选择复制对象:919,请确定复制基点:920,请选择参考曲线:921,选择打断对象:922,指定偏移对象:923,请输入偏移距离:924,"指定伸缩对象(选择直线、多段线、圆弧)":925,伸缩至:926,选择要修改线型比例的对象:927,请输入线型比例:928,请输入阵列间距:929,请选择圆弧:930,选择排列对象:931,指定排列基点:932,"选择目标多段线:":933,"请输入圆角半径<5>":934,选择填充对象:935,请输入填充比例:936,请选择原填充图形:937,请点击填充图形内部任意一点:938,请选择线对象:939,选择等分模式:940,定距等分:941,定数等分:942,偏移等分:943,复制等分:944,请选择偏移等分对象:945,请选择复制等分对象:946,请选择需要等分的线段:947,请设置等分距离:948,请设置等分的数量:949,请设置偏移距离:950,请指定偏移点:951,请指定复制基点:952,请指定复制等分数量:953,请指定复制等分端点:954,"请选择需要矩形缩放的实体:":955,请指定矩形的角点1:956,请指定矩形角点2:957,请选择放大中心点:958,请选择放大范围:959,请设置放大倍数:960,请选择放大插入点:961,请选择一条需要打断的曲线:962,请在曲线上选取打断点:963,请输入阵列数量:964,是否开启旋转:965,是:966,否:967,"请选择需要阵列的图形:":968,请选择阵列中心点:969,"请选择闭合多边形！":970,请选择第一个点:971,请选择第二个点:972,请选择第一个闭合多边形:973,请选择第二个闭合多边形:974,请选择两个闭合多边形:975,"两个多边形没有重合边！":976,请选择目标多边形:977,请选择多边形需要添加顶点的边:978,请设置添加的顶点位置:979,请选择多边形需要删除的顶点:980,请选择多边形需要拉伸的边:981,请指定拉伸位置:982,"请设置图框方向<N>":983,横向:984,纵向:985,"请设置图框尺寸<4>":986,请设置图框位置:987,指定裁剪角点1:988,指定裁剪角点2:989,请设置道路起点:990,请设置下一点:991,"请选择目标对齐线对象(选择直线)":992,请选择目标文字对象:993,选择文字对象:994,请设置字高:995,请设置字宽:996,请选择源文字:997,请选择第一个文字:998,请选择第二个文字:999,请选择需要对齐的文字:1e3,请选择对齐方式:1001,左:1002,中:1003,右:1004,请选择对齐基点:1005,请选择需要反转的文字:1006,请选择需要去空格的文字:1007,请选择文字对象:1008,"请输入下划线宽度 ":1009,"请设置下划线距离 ":1010,"请设置下划线延长距离 ":1011,"请选择操作选项 ":1012,大写:1013,小写:1014,句首大写:1015,请选择数字对象:1016,"请选择文字插入点 ":1017,"选择要查找的范围:":1018,"请选择查找模式 ":1019,等于:1020,包含:1021,前缀为:1022,后缀为:1023,"请输入关键字 ":1024,"选择要操作的范围:":1025,选择操作方式:1026,添加:1027,删除:1028,选择操作位置:1029,前缀:1030,后缀:1031,请输入内容:1032,"请选择文本 ":1033,"请选择圆弧 ":1034,请选择文字样式:1035,请设置文字提取范围:1036,下载开Demo代码:1037,下载开发包:1038,调用画圆线命令:1039,交互画直线:1040,添加图层:1041,得到所有图层:1042,得到所有文字样式:1043,得到所有图块:1044,得到所有线型:1045,写扩展数据:1046,读扩展数据:1047,测试插入一个图块:1048,绘直线:1049,绘圆弧:1050,绘圆:1051,绘PL线:1052,绘填充:1053,绘文字:1054,绘椭圆:1055,绘椭圆弧:1056,绘制多行文字:1057,绘制表格:1058,绘制二维码:1059,插入图章:1060,得到所有对象:1061,交互选择对象:1062,保存mxweb到服务器:1063,得到系统变量:1064,新建图纸:1065,白色背景色:1066,文字查找定位:1067,选择实体做块:1068,绘制单行文字:1069,选点填充:1070,设置扩展属性:1071,绘制对齐标注:1072,绘性线标注:1073,角度标注:1074,修改对象线型:1075,选择隐藏对象层:1076,添加到当前选择:1077,视区旋转:1078,写扩展记录:1079,得到命名字典:1080,添加文字样式:1081,绘自定义实体:1082,修改对象颜色:1083,修改对象不可见:1084,修改对象层:1085,修改对象显示顺序:1086,指定范围输出pdf:1087,绘制image:1088,读取对象扩展字典:1089,绘制3DPolyline:1090,绘线文本自定义实体:1091,计算交点:1092,修改文字样式:1093,偏移输入画线:1094,创建组:1095,屏幕截图jpg:1096,获取图纸相同文字:1097,指定范围输出dwg:1098,测试绘制标记圆:1099,测试Wipeout:1100,创建剪切块:1101,公差标注:1102,改所有对象颜色:1103,切剪mxweb:1104,设置当前颜色线重:1105,查找多边形区域内对象:1106,打碎对象:1107,绘半透明线:1108,添加线型:1109,修改图案比例:1110,测试文字编辑:1111,绘制条形码:1112,屏幕截图bmp:1113,修改工具:1114,文字工具:1115,绘图工具:1116,块工具:1117,测量工具:1118,标注工具:1119,其他工具:1120,多重复制:1121,弧转圆:1122,复制旋转:1123,圆转多边:1124,修改颜色:1125,圆弧切角:1126,临时隐藏:1127,方框删除:1128,角度复制:1129,顶点复制:1130,交点打断:1131,双向偏移:1132,改圆大小:1133,线型比例:1134,伸缩:1135,按弧阵列:1136,pl圆角:1137,pl线反向:1138,得到所有直线对象:1139,等分:1140,矩形缩放:1141,打断:1142,切割多边形:1143,合并多边形:1144,添加多边形顶点:1145,删除多边形顶点:1146,多边形单边拉伸:1147,星形:1148,凹凸线:1149,锯齿线:1150,中心矩形:1151,圆角矩形:1152,圆中心线:1153,管道:1154,剖管符:1155,中垂线:1156,楼梯:1157,实心圆:1158,保温棉:1159,中心线:1160,开洞:1161,消息框:1162,"基准符（1）":1163,焊缝线:1164,同心圆:1165,齿轮:1166,块中心线:1167,圆公切线:1168,"基准符（2）":1169,插入图框:1170,绘制道路:1171,绘任意多边形:1172,按线对齐:1173,改字高:1174,改字宽:1175,刷内容:1176,换内容:1177,左右对齐:1178,上下对齐:1179,文字反转:1180,文字加框:1181,下划线:1182,图名线:1183,大小写:1184,数字求和:1185,选特定字:1186,前后缀:1187,连接文字:1188,去空格:1189,文字竖向:1190,按弧对齐:1191,修改全局文字样式:1192,提取文字:1193,文字编号:1194,改块名:1195,刷块:1196,块连线:1197,改块基点:1198,改块颜色:1199,多块旋转:1200,多块缩放:1201,刷块角度:1202,按块选择:1203,按块全选:1204,统计单块:1205,统计多块:1206,修改块图层:1207,长度:1208,统计面积:1209,智能标高:1210,面积:1211,矩形面积:1212,点到直线的距离:1213,弧长:1214,测量圆:1215,连续测量:1216,查看分段长度:1217,面积含弧线:1218,审图标注:1219,矩形标注:1220,粗糙度标注:1221,坐标标注:1222,标斜率:1223,对齐:1224,局部放大:1225,序号标注:1226,旋转标注:1227,圆孔标记:1228,向视符号:1229,射线标注:1230,矩形标注悬停变色:1231,裁剪图纸扩展:1232,箭头直线:1233,选择的文字:1234,复制到剪贴板:1235,取消:1236,确定:1237,公差代号:1238,公差1:1239,公差2:1240,附注:1241,顶端:1242,底端:1243,基准:1244,全周符号:1245,当前行:1246,增加行:1247,删除行:1248,清零:1249,直线度:1250,平面度:1251,圆度:1252,圆柱度:1253,线轮廓度:1254,面轮廓度:1255,平行度:1256,垂直度:1257,倾斜度:1258,位置度:1259,同轴度:1260,对称度:1261,圆跳动:1262,全跳动:1263,清除:1264,"请输入文本内容和编号：":1265,"文本内容：":1266,"(输入0-20个字)":1267,"起始编号：":1268,"(编号自动递增1)":1269,"编号位置：":1270,编号在前:1271,编号在后:1272,改变方向:1273,"左边文字内容：":1274,"右边文字内容：":1275,"底部文字内容：":1276,基本符号:1277,相同要求:1278,多数符号:1279,长边加横线:1280,辅助符号:1281,补充符号:1282,符号位置:1283,特殊符号:1284,左尺寸:1285,上尺寸:1286,右尺寸:1287,交错焊缝:1288,间距:1289,扩充文字:1290,虚线位置:1291,焊接说明:1292,清除行:1293,卷边焊缝:1294,I型焊缝:1295,V型焊缝:1296,单边V型焊缝:1297,单边陡侧V型坡口堆焊:1298,倾斜焊缝:1299,可移除衬垫:1300,持久衬垫:1301,带顿边V型焊缝:1302,带顿边U型焊缝:1303,带顿边单边V型焊缝:1304,带顿边单边U型焊缝:1305,端接焊缝:1306,堆焊接头:1307,封底焊缝:1308,角焊缝:1309,塞焊缝或槽焊缝:1310,点焊缝:1311,折叠接口:1312,倾斜接口:1313,"点焊缝（偏移中心）":1314,缝焊缝:1315,"缝焊缝（偏离中心）":1316,陡侧V型坡口堆焊:1317,第一种平面符号:1318,第二种凹面符号:1319,第二种凸面符号:1320,第二种平面符号:1321,第一种凸面符号:1322,第三种平面符号:1323,第一种凹面符号:1324,削平焊缝:1325,趾部平滑过渡:1326,带垫板符号:1327,三面焊缝符号:1328,周围焊接符:1329,现场符号:1330,尾部符号:1331,交错断续焊接符号:1332,喇叭形焊缝:1333,单边喇叭形焊缝:1334,堆焊缝:1335,锁边焊缝:1336,锁边坡口:1337,上:1338,下:1339,无:1340,basicSymbol:1341,auxiliarySymbol:1342,suppleSymbol:1343,specialSymbol:1344,选择要在几何图形上放置的焊缝符号:1345,"焊角宽度：":1346,"单边V型对接焊缝（前视图）":1347,"角焊缝（前视图）":1348,"单边V型对接焊缝（侧视图）":1349,"角焊缝（侧视图）":1350},QT=void 0,$T=void 0,tP={languages:[{name:"zh-CN",title:"中文",active:!0,default:!0},{name:"en-US",title:"英语"},{name:"ko-KR",title:"韩语"},{name:"zh-TW",title:"繁体中文"}],library:!0,debug:!1},eP={"zh-CN":{718:" 指定输出范围第一点:",719:" 指定输出范围第二点:",720:" 指定第一点:",721:" 指定第二点:",722:" 云线框起始点:",723:" 云线框结束点:",724:" 审图标注点:",725:" 点击开启绘制云线:",726:" 再次点击结束绘制云线:",727:"指定一点:",728:"指定二点:",729:"选择对象",730:" 指定下一个点:",731:"\\指定插入基点",732:" 指定表格插入点:",733:"指定插入点:",734:"指定插入基点",735:"选择标注对象",736:"请选择目标文字",737:" 指定填充区域内部一点:",738:"没有找到闭合区域 ",739:"表面粗糙度",740:"焊接符号",741:"形位公差",742:"选择要需要开启自定义属性的对象",743:"选择要隐藏的对象",744:" 指定插入点:",745:" 指定一点:",746:"指定夹角",747:" 指定二点:",748:"选择图案填充对象",749:"指定第一点:",750:"指定第二点:",751:"指定第二个角度点:",752:"指定最后一个点:",753:"指定坐标点:",754:"指定标注点:",755:"请输入审批意见",756:"指定云线框起始点",757:"指定云线框终止点",758:"指定审图标注点",759:"指定第一个角点:",760:"指定第二个角点:",761:"指定序号位置:",762:"旋转符号",763:"标记类型",764:"请选择需要标记的圆:",765:"请设置定位点或直线或圆弧或圆",766:"拖动确定标注位置",767:"请指定或输入角度",768:"焊缝符号",769:"请拾取定位点、直线或圆弧",770:"请指定第二点",771:"请设置定位点",772:"请设置角度",773:"请设置定位点或直线或圆弧",774:"请设置引线转折点",775:"拖动确定定位点",776:"请指定第一点:",777:"请指定第二点:",778:"请选择目标块对象",779:"请输入新块名",780:"选择需要修改基点的块",781:"设置基点",782:"选择需要修改颜色的块",783:"输入颜色索引(0~256)",784:"请选择源块",785:"选择要刷的目标块:",786:"选择连接方式",787:"手动逐个连线",788:"自动批量连线",789:"请选择连线的块",790:"设置中心线长度",791:"选择要旋转的目标块:",792:"设置旋转角度",793:"请设置缩放比例",794:"请设置选择范围:",795:"请选择目标块",796:"请设置统计范围",797:"指定表格插入点:",798:"选择目标曲线",799:"指定长度标注点",800:"选择目标对象",801:"请选择目标斜率对象",802:"请设置标注文字高度",803:"指定斜率标注点",804:"请选择目标坐标点",805:"请指定标注位置",806:"指定起点",807:"指定终点",808:"指定标注方向",809:"请设置文字内容",810:"请选择面积的第一个点",811:"请选择下一个点",812:"请选择面积标注的位置",813:"请选择矩形的角点1",814:"请选择矩形的角点2",815:"请设置面积标注的位置",816:"请选择一个测量点",817:"请选择一条直线",818:"请设置尺寸线的位置",819:"请选择一条弧线",820:"请指定尺寸线位置",821:"请选择一个圆对象",822:"请指定文字位置",823:"请选择直线的端点或弧线",824:"请指定文字的位置",825:"请选择一个连续测量的标注",826:"请选择第二条直线",827:"请设置角度标注的位置",828:" 请输入星形顶点数：",829:" 指定星形中心点:",830:"请设置星形的内半径:",831:" 指定星形的外半径:",832:" 请输入凹凸线宽度<5>",833:" 请输入凹凸线高度<10>",834:"请点击确定起始点",835:"请点击确定终点",836:" 请输入锯齿线宽度<5>",837:" 请输入锯齿线高度<10>",838:" 请输入矩形宽度<5>",839:" 请输入矩形高度<10>",840:"请点击确定矩形中心",841:" 请输入管径<10>",842:" 请输入长出管口长度<5>",843:"请点击确定起点",844:"指定剖管线起点",845:"指定剖管线终点",846:"选择剖管线圆弧方向",847:"左边",848:"右边",849:"选择模式",850:"直线焊缝",851:"弧线焊缝",852:" 请输入焊缝半径<5>",853:"指定圆弧的第二个点",854:"指定圆弧的端点",855:"请输入宽度<25>",856:"请输入高度<15>",857:"请输入楼梯级数<10>",858:"请确定圆心位置 ",859:"请输入圆半径",860:" 请输入保温棉宽度<5>",861:" 请输入保温棉高度<10>",862:"请点击下一个点",863:"请选择第一条线",864:"请选择第二条线",865:"请选择终点",866:"请选择目标矩形",867:"设置指北针中心点",868:"设置指北针半径",869:"选择提示框指向",870:" 指定消息框第一点:",871:" 指定消息框第二点:",872:" 设置消息框指向:",873:"请设置基准符文字",874:"请设置文字高度",875:"请设置基准符位置",876:"请设置定位点或圆弧或直线",877:"请设置符号位置",878:"请设置圆心",879:"请设置齿轮圆心",880:"请设置齿轮半径",881:" 请设置中心线长度10>",882:"请选择第一个圆",883:"请选择第二个圆",884:"请设置矩形左上角点",885:"请设置矩形右下角点",886:"请设置圆角半径",887:"请选择多边形起点",888:"请选择多边形顶点",889:"选择对象:",890:"指定基点",891:"指定第二个点 ",892:"阵列",893:"退出",894:"放弃",895:"输入要进行阵列的项目数 ",896:"选择圆弧对象",897:"选择复制旋转对象:",898:"请指定目标点 ",899:"请指定旋转角度",900:"选择要转成多边形的对象",901:"设置多边形边数",902:" 输入选项",903:"内接于圆",904:"外切于圆",905:"选择要修改颜色的对象",906:"输入颜色索引",907:"隐藏",908:"隐藏未选",909:"全部显示",910:"选择目标的对象",911:" 指定删除方框第一点:",912:" 指定删除方框第二点:",913:" 选择需要精确删除的实体",914:" 请选择角度复制对象",915:" 请输入角度复制数量",916:" 请输入角度复制的基点",917:" 请输入复制角度",918:"请选择顶点对象",919:"请选择复制对象",920:"请确定复制基点",921:"请选择参考曲线",922:"选择打断对象",923:"指定偏移对象",924:"请输入偏移距离",925:"指定伸缩对象(选择直线、多段线、圆弧)",926:"伸缩至",927:"选择要修改线型比例的对象",928:"请输入线型比例",929:"请输入阵列间距",930:"请选择圆弧",931:"选择排列对象",932:"指定排列基点",933:"选择目标多段线:",934:"请输入圆角半径<5>",935:"选择填充对象",936:"请输入填充比例",937:"请选择原填充图形",938:"请点击填充图形内部任意一点",939:"请选择线对象",940:"选择等分模式",941:"定距等分",942:"定数等分",943:"偏移等分",944:"复制等分",945:"请选择偏移等分对象",946:"请选择复制等分对象",947:"请选择需要等分的线段",948:"请设置等分距离",949:"请设置等分的数量",950:"请设置偏移距离",951:"请指定偏移点",952:"请指定复制基点",953:"请指定复制等分数量",954:"请指定复制等分端点",955:"请选择需要矩形缩放的实体:",956:"请指定矩形的角点1",957:"请指定矩形角点2",958:"请选择放大中心点",959:"请选择放大范围",960:"请设置放大倍数",961:"请选择放大插入点",962:"请选择一条需要打断的曲线",963:"请在曲线上选取打断点",964:"请输入阵列数量",965:"是否开启旋转",966:"是",967:"否",968:"请选择需要阵列的图形:",969:"请选择阵列中心点",970:"请选择闭合多边形！",971:"请选择第一个点",972:"请选择第二个点",973:"请选择第一个闭合多边形",974:"请选择第二个闭合多边形",975:"请选择两个闭合多边形",976:"两个多边形没有重合边！",977:"请选择目标多边形",978:"请选择多边形需要添加顶点的边",979:"请设置添加的顶点位置",980:"请选择多边形需要删除的顶点",981:"请选择多边形需要拉伸的边",982:"请指定拉伸位置",983:"请设置图框方向<N>",984:"横向",985:"纵向",986:"请设置图框尺寸<4>",987:"请设置图框位置",988:"指定裁剪角点1",989:"指定裁剪角点2",990:"请设置道路起点",991:"请设置下一点",992:"请选择目标对齐线对象(选择直线)",993:"请选择目标文字对象",994:"选择文字对象",995:"请设置字高",996:"请设置字宽",997:"请选择源文字",998:"请选择第一个文字",999:"请选择第二个文字",1e3:"请选择需要对齐的文字",1001:"请选择对齐方式",1002:"左",1003:"中",1004:"右",1005:"请选择对齐基点",1006:"请选择需要反转的文字",1007:"请选择需要去空格的文字",1008:"请选择文字对象",1009:"请输入下划线宽度 ",1010:"请设置下划线距离 ",1011:"请设置下划线延长距离 ",1012:"请选择操作选项 ",1013:"大写",1014:"小写",1015:"句首大写",1016:"请选择数字对象",1017:"请选择文字插入点 ",1018:"选择要查找的范围:",1019:"请选择查找模式 ",1020:"等于",1021:"包含",1022:"前缀为",1023:"后缀为",1024:"请输入关键字 ",1025:"选择要操作的范围:",1026:"选择操作方式",1027:"添加",1028:"删除",1029:"选择操作位置",1030:"前缀",1031:"后缀",1032:"请输入内容",1033:"请选择文本 ",1034:"请选择圆弧 ",1035:"请选择文字样式",1036:"请设置文字提取范围",1037:"下载开Demo代码",1038:"下载开发包",1039:"调用画圆线命令",1040:"交互画直线",1041:"添加图层",1042:"得到所有图层",1043:"得到所有文字样式",1044:"得到所有图块",1045:"得到所有线型",1046:"写扩展数据",1047:"读扩展数据",1048:"测试插入一个图块",1049:"绘直线",1050:"绘圆弧",1051:"绘圆",1052:"绘PL线",1053:"绘填充",1054:"绘文字",1055:"绘椭圆",1056:"绘椭圆弧",1057:"绘制多行文字",1058:"绘制表格",1059:"绘制二维码",1060:"插入图章",1061:"得到所有对象",1062:"交互选择对象",1063:"保存mxweb到服务器",1064:"得到系统变量",1065:"新建图纸",1066:"白色背景色",1067:"文字查找定位",1068:"选择实体做块",1069:"绘制单行文字",1070:"选点填充",1071:"设置扩展属性",1072:"绘制对齐标注",1073:"绘性线标注",1074:"角度标注",1075:"修改对象线型",1076:"选择隐藏对象层",1077:"添加到当前选择",1078:"视区旋转",1079:"写扩展记录",1080:"得到命名字典",1081:"添加文字样式",1082:"绘自定义实体",1083:"修改对象颜色",1084:"修改对象不可见",1085:"修改对象层",1086:"修改对象显示顺序",1087:"指定范围输出pdf",1088:"绘制image",1089:"读取对象扩展字典",1090:"绘制3DPolyline",1091:"绘线文本自定义实体",1092:"计算交点",1093:"修改文字样式",1094:"偏移输入画线",1095:"创建组",1096:"屏幕截图jpg",1097:"获取图纸相同文字",1098:"指定范围输出dwg",1099:"测试绘制标记圆",1100:"测试Wipeout",1101:"创建剪切块",1102:"公差标注",1103:"改所有对象颜色",1104:"切剪mxweb",1105:"设置当前颜色线重",1106:"查找多边形区域内对象",1107:"打碎对象",1108:"绘半透明线",1109:"添加线型",1110:"修改图案比例",1111:"测试文字编辑",1112:"绘制条形码",1113:"屏幕截图bmp",1114:"修改工具",1115:"文字工具",1116:"绘图工具",1117:"块工具",1118:"测量工具",1119:"标注工具",1120:"其他工具",1121:"多重复制",1122:"弧转圆",1123:"复制旋转",1124:"圆转多边",1125:"修改颜色",1126:"圆弧切角",1127:"临时隐藏",1128:"方框删除",1129:"角度复制",1130:"顶点复制",1131:"交点打断",1132:"双向偏移",1133:"改圆大小",1134:"线型比例",1135:"伸缩",1136:"按弧阵列",1137:"pl圆角",1138:"pl线反向",1139:"得到所有直线对象",1140:"等分",1141:"矩形缩放",1142:"打断",1143:"切割多边形",1144:"合并多边形",1145:"添加多边形顶点",1146:"删除多边形顶点",1147:"多边形单边拉伸",1148:"星形",1149:"凹凸线",1150:"锯齿线",1151:"中心矩形",1152:"圆角矩形",1153:"圆中心线",1154:"管道",1155:"剖管符",1156:"中垂线",1157:"楼梯",1158:"实心圆",1159:"保温棉",1160:"中心线",1161:"开洞",1162:"消息框",1163:"基准符（1）",1164:"焊缝线",1165:"同心圆",1166:"齿轮",1167:"块中心线",1168:"圆公切线",1169:"基准符（2）",1170:"插入图框",1171:"绘制道路",1172:"绘任意多边形",1173:"按线对齐",1174:"改字高",1175:"改字宽",1176:"刷内容",1177:"换内容",1178:"左右对齐",1179:"上下对齐",1180:"文字反转",1181:"文字加框",1182:"下划线",1183:"图名线",1184:"大小写",1185:"数字求和",1186:"选特定字",1187:"前后缀",1188:"连接文字",1189:"去空格",1190:"文字竖向",1191:"按弧对齐",1192:"修改全局文字样式",1193:"提取文字",1194:"文字编号",1195:"改块名",1196:"刷块",1197:"块连线",1198:"改块基点",1199:"改块颜色",1200:"多块旋转",1201:"多块缩放",1202:"刷块角度",1203:"按块选择",1204:"按块全选",1205:"统计单块",1206:"统计多块",1207:"修改块图层",1208:"长度",1209:"统计面积",1210:"智能标高",1211:"面积",1212:"矩形面积",1213:"点到直线的距离",1214:"弧长",1215:"测量圆",1216:"连续测量",1217:"查看分段长度",1218:"面积含弧线",1219:"审图标注",1220:"矩形标注",1221:"粗糙度标注",1222:"坐标标注",1223:"标斜率",1224:"对齐",1225:"局部放大",1226:"序号标注",1227:"旋转标注",1228:"圆孔标记",1229:"向视符号",1230:"射线标注",1231:"矩形标注悬停变色",1232:"裁剪图纸扩展",1233:"箭头直线",1234:"选择的文字",1235:"复制到剪贴板",1236:"取消",1237:"确定",1238:"公差代号",1239:"公差1",1240:"公差2",1241:"附注",1242:"顶端",1243:"底端",1244:"基准",1245:"全周符号",1246:"当前行",1247:"增加行",1248:"删除行",1249:"清零",1250:"直线度",1251:"平面度",1252:"圆度",1253:"圆柱度",1254:"线轮廓度",1255:"面轮廓度",1256:"平行度",1257:"垂直度",1258:"倾斜度",1259:"位置度",1260:"同轴度",1261:"对称度",1262:"圆跳动",1263:"全跳动",1264:"清除",1265:"请输入文本内容和编号：",1266:"文本内容：",1267:"(输入0-20个字)",1268:"起始编号：",1269:"(编号自动递增1)",1270:"编号位置：",1271:"编号在前",1272:"编号在后",1273:"改变方向",1274:"左边文字内容：",1275:"右边文字内容：",1276:"底部文字内容：",1277:"基本符号",1278:"相同要求",1279:"多数符号",1280:"长边加横线",1281:"辅助符号",1282:"补充符号",1283:"符号位置",1284:"特殊符号",1285:"左尺寸",1286:"上尺寸",1287:"右尺寸",1288:"交错焊缝",1289:"间距",1290:"扩充文字",1291:"虚线位置",1292:"焊接说明",1293:"清除行",1294:"卷边焊缝",1295:"I型焊缝",1296:"V型焊缝",1297:"单边V型焊缝",1298:"单边陡侧V型坡口堆焊",1299:"倾斜焊缝",1300:"可移除衬垫",1301:"持久衬垫",1302:"带顿边V型焊缝",1303:"带顿边U型焊缝",1304:"带顿边单边V型焊缝",1305:"带顿边单边U型焊缝",1306:"端接焊缝",1307:"堆焊接头",1308:"封底焊缝",1309:"角焊缝",1310:"塞焊缝或槽焊缝",1311:"点焊缝",1312:"折叠接口",1313:"倾斜接口",1314:"点焊缝（偏移中心）",1315:"缝焊缝",1316:"缝焊缝（偏离中心）",1317:"陡侧V型坡口堆焊",1318:"第一种平面符号",1319:"第二种凹面符号",1320:"第二种凸面符号",1321:"第二种平面符号",1322:"第一种凸面符号",1323:"第三种平面符号",1324:"第一种凹面符号",1325:"削平焊缝",1326:"趾部平滑过渡",1327:"带垫板符号",1328:"三面焊缝符号",1329:"周围焊接符",1330:"现场符号",1331:"尾部符号",1332:"交错断续焊接符号",1333:"喇叭形焊缝",1334:"单边喇叭形焊缝",1335:"堆焊缝",1336:"锁边焊缝",1337:"锁边坡口",1338:"上",1339:"下",1340:"无",1341:"basicSymbol",1342:"auxiliarySymbol",1343:"suppleSymbol",1344:"specialSymbol",1345:"选择要在几何图形上放置的焊缝符号",1346:"焊角宽度：",1347:"单边V型对接焊缝（前视图）",1348:"角焊缝（前视图）",1349:"单边V型对接焊缝（侧视图）",1350:"角焊缝（侧视图）"},"en-US":()=>c0(()=>Promise.resolve().then(()=>XV),void 0),"ko-KR":()=>c0(()=>Promise.resolve().then(()=>KV),void 0),"zh-TW":()=>c0(()=>Promise.resolve().then(()=>ZV),void 0)},jh=new CT(Bh({id:"mxcad-plugin__1_0_0",idMap:JT,formatters:XT,storage:LT,messages:eP,paragraphs:ZT,component:QT,loader:KT,transform:$T},tP)),nP=jh.t;jh.$t,jh.Translate;const rb=b.ref();jh.on("change",t=>{rb.value=t});const G=(t,...e)=>(rb.value,jh.t(t,...e)),iP=t=>(b.pushScopeId("data-v-a388a3ba"),t=t(),b.popScopeId(),t),rP={key:0,class:"modal-wrapper",id:"modal"},oP={class:"modal-body card"},sP={class:"modal-header"},aP={class:"heading"},lP=[iP(()=>b.createElementVNode("svg",{viewBox:"0 0 24 24"},[b.createElementVNode("path",{d:"M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"})],-1))],cP={style:{"overflow-y":"auto",height:"500px"}},uP={class:"btn_box"},hP={class:"btn_box"},dP={class:"btn_box"},pP={class:"btn_box"},fP={class:"btn_box"},mP={class:"btn_box"},gP={class:"btn_box"},yP={class:"btn_box"},xP={class:"btn_box"},vP={class:"btn_box"},_P={class:"btn_box"},bP={class:"btn_box"},MP={class:"btn_box"},wP={class:"btn_box"},AP={class:"btn_box"},EP={class:"btn_box"},TP={class:"btn_box"},PP={class:"btn_box"},SP={class:"btn_box"},CP={class:"btn_box"},DP=b.defineComponent({__name:"Modal",setup(t){const{isModalVisible:e,hideModal:n,modalOptions:r}=If(),s=b.ref(!1);return b.watch(()=>e.value,u=>{u&&(s.value=localStorage.getItem("language")==="en")}),(u,h)=>(b.openBlock(),b.createBlock(b.Teleport,{to:"body"},[b.unref(e)?(b.openBlock(),b.createElementBlock("div",rP,[b.createElementVNode("div",oP,[b.createElementVNode("div",sP,[b.createElementVNode("h2",aP,b.toDisplayString(b.unref(r).title),1),b.createElementVNode("a",{href:"#!",onClick:h[0]||(h[0]=(...o)=>b.unref(n)&&b.unref(n)(...o)),role:"button",class:"close","aria-label":"close this modal"},lP)]),b.createElementVNode("div",cP,[b.createElementVNode("div",uP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[1]||(h[1]=o=>b.unref(r).docommand("Mx_Open_DemoCode"))},b.toDisplayString(b.unref(G)("下载开Demo代码")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[2]||(h[2]=o=>b.unref(r).docommand("Mx_Open_DevInstall"))},b.toDisplayString(b.unref(G)("下载开发包")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[3]||(h[3]=(...o)=>b.unref(r).ondrawline&&b.unref(r).ondrawline(...o))},b.toDisplayString(b.unref(G)("调用画圆线命令")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[4]||(h[4]=o=>b.unref(r).docommand("MxTest_DrawLine"))},b.toDisplayString(b.unref(G)("交互画直线")),3)]),b.createElementVNode("div",hP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[5]||(h[5]=o=>b.unref(r).docommand("MxTest_AddLayer"))},b.toDisplayString(b.unref(G)("添加图层")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[6]||(h[6]=o=>b.unref(r).docommand("MxTest_GetAllLayer"))},b.toDisplayString(b.unref(G)("得到所有图层")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[7]||(h[7]=o=>b.unref(r).docommand("MxTest_GetAllTextStyle"))},b.toDisplayString(b.unref(G)("得到所有文字样式")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[8]||(h[8]=o=>b.unref(r).docommand("MxTest_GetAllBlock"))},b.toDisplayString(b.unref(G)("得到所有图块")),3)]),b.createElementVNode("div",dP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[9]||(h[9]=o=>b.unref(r).docommand("MxTest_GetAllLinetype"))},b.toDisplayString(b.unref(G)("得到所有线型")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[10]||(h[10]=o=>b.unref(r).docommand("MxTest_WritexData"))},b.toDisplayString(b.unref(G)("写扩展数据")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[11]||(h[11]=o=>b.unref(r).docommand("MxTest_ReadxData"))},b.toDisplayString(b.unref(G)("读扩展数据")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[12]||(h[12]=o=>b.unref(r).docommand("MxTest_InsertBlock"))},b.toDisplayString(b.unref(G)("测试插入一个图块")),3)]),b.createElementVNode("div",pP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[13]||(h[13]=o=>b.unref(r).docommand("Mx_Test_DrawLine"))},b.toDisplayString(b.unref(G)("绘直线")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[14]||(h[14]=o=>b.unref(r).docommand("Mx_Test_DrawArc"))},b.toDisplayString(b.unref(G)("绘圆弧")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[15]||(h[15]=o=>b.unref(r).docommand("Mx_Test_DrawCircle"))},b.toDisplayString(b.unref(G)("绘圆")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[16]||(h[16]=o=>b.unref(r).docommand("Mx_Test_DrawPolyline"))},b.toDisplayString(b.unref(G)("绘PL线")),3)]),b.createElementVNode("div",fP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[17]||(h[17]=o=>b.unref(r).docommand("Mx_Test_DrawHatch"))},b.toDisplayString(b.unref(G)("绘填充")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[18]||(h[18]=o=>b.unref(r).docommand("Mx_Test_DrawText"))},b.toDisplayString(b.unref(G)("绘文字")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[19]||(h[19]=o=>b.unref(r).docommand("Mx_Test_Ellipse"))},b.toDisplayString(b.unref(G)("绘椭圆")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[20]||(h[20]=o=>b.unref(r).docommand("Mx_Test_EllipseArc"))},b.toDisplayString(b.unref(G)("绘椭圆弧")),3)]),b.createElementVNode("div",mP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[21]||(h[21]=o=>b.unref(r).docommand("Mx_Test_MText"))},b.toDisplayString(b.unref(G)("绘制多行文字")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[22]||(h[22]=o=>b.unref(r).docommand("Mx_Test_DrawTable"))},b.toDisplayString(b.unref(G)("绘制表格")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[23]||(h[23]=o=>b.unref(r).docommand("Mx_Test_QRCode"))},b.toDisplayString(b.unref(G)("绘制二维码")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[24]||(h[24]=o=>b.unref(r).docommand("MxTest_InsertStamp"))},b.toDisplayString(b.unref(G)("插入图章")),3)]),b.createElementVNode("div",gP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[25]||(h[25]=(...o)=>b.unref(r).ongetallentity&&b.unref(r).ongetallentity(...o))},b.toDisplayString(b.unref(G)("得到所有对象")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[26]||(h[26]=o=>b.unref(r).docommand("MxTest_SelectEntity"))},b.toDisplayString(b.unref(G)("交互选择对象")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[27]||(h[27]=o=>b.unref(r).docommand("Mx_Export_MxWeb"))},b.toDisplayString(b.unref(G)("保存mxweb到服务器")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[28]||(h[28]=o=>b.unref(r).docommand("MxTest_GetSysVars"))},b.toDisplayString(b.unref(G)("得到系统变量")),3)]),b.createElementVNode("div",yP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[29]||(h[29]=o=>b.unref(r).docommand("MxTest_NewFile"))},b.toDisplayString(b.unref(G)("新建图纸")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[30]||(h[30]=o=>b.unref(r).docommand("Mx_ViewBackgroundColor"))},b.toDisplayString(b.unref(G)("白色背景色")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[31]||(h[31]=o=>b.unref(r).docommand("MxTest_FindText"))},b.toDisplayString(b.unref(G)("文字查找定位")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[32]||(h[32]=o=>b.unref(r).docommand("MxTest_SelectEntitysToBlock"))},b.toDisplayString(b.unref(G)("选择实体做块")),3)]),b.createElementVNode("div",xP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[33]||(h[33]=o=>b.unref(r).docommand("Mx_Test_Text"))},b.toDisplayString(b.unref(G)("绘制单行文字")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[34]||(h[34]=o=>b.unref(r).docommand("MxTest_DrawHatchFormPoint"))},b.toDisplayString(b.unref(G)("选点填充")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[35]||(h[35]=o=>b.unref(r).docommand("Mx_TestExProp"))},b.toDisplayString(b.unref(G)("设置扩展属性")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[36]||(h[36]=o=>b.unref(r).docommand("Mx_Test_DimAligned"))},b.toDisplayString(b.unref(G)("绘制对齐标注")),3)]),b.createElementVNode("div",vP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[37]||(h[37]=o=>b.unref(r).docommand("Mx_Test_DrawDimRotated"))},b.toDisplayString(b.unref(G)("绘性线标注")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[38]||(h[38]=o=>b.unref(r).docommand("Mx_Test_DrawDimAngular"))},b.toDisplayString(b.unref(G)("角度标注")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[39]||(h[39]=o=>b.unref(r).docommand("MxTest_LineTypeTest"))},b.toDisplayString(b.unref(G)("修改对象线型")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[40]||(h[40]=o=>b.unref(r).docommand("Mx_SelectEntitHideLayer"))},b.toDisplayString(b.unref(G)("选择隐藏对象层")),3)]),b.createElementVNode("div",_P,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[41]||(h[41]=o=>b.unref(r).docommand("MxTest_TestAddCurrentSelect"))},b.toDisplayString(b.unref(G)("添加到当前选择")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[42]||(h[42]=o=>b.unref(r).docommand("MxTest_TestSetViewAngle"))},b.toDisplayString(b.unref(G)("视区旋转")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[43]||(h[43]=o=>b.unref(r).docommand("MxTest_WriteXRecord"))},b.toDisplayString(b.unref(G)("写扩展记录")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[44]||(h[44]=o=>b.unref(r).docommand("MxTest_GetNamedObjectsDictionary"))},b.toDisplayString(b.unref(G)("得到命名字典")),3)]),b.createElementVNode("div",bP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[45]||(h[45]=o=>b.unref(r).docommand("MxTest_AddTextStyleTable"))},b.toDisplayString(b.unref(G)("添加文字样式")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[46]||(h[46]=o=>b.unref(r).docommand("MxTest_DrawCustomEntity"))},b.toDisplayString(b.unref(G)("绘自定义实体")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[47]||(h[47]=o=>b.unref(r).docommand("Mx_Test_ChangeColor"))},b.toDisplayString(b.unref(G)("修改对象颜色")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[48]||(h[48]=o=>b.unref(r).docommand("Mx_Test_ChangeVisible"))},b.toDisplayString(b.unref(G)("修改对象不可见")),3)]),b.createElementVNode("div",MP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[49]||(h[49]=o=>b.unref(r).docommand("Mx_Test_ChangeEntityLayer"))},b.toDisplayString(b.unref(G)("修改对象层")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[50]||(h[50]=o=>b.unref(r).docommand("Mx_ChaneEntityDrawOrder"))},b.toDisplayString(b.unref(G)("修改对象显示顺序")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[51]||(h[51]=o=>b.unref(r).docommand("Mx_Export_Pdf"))},b.toDisplayString(b.unref(G)("指定范围输出pdf")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[52]||(h[52]=o=>b.unref(r).docommand("Mx_Test_DrawImage"))},b.toDisplayString(b.unref(G)("绘制image")),3)]),b.createElementVNode("div",wP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[53]||(h[53]=o=>b.unref(r).docommand("MxTest_GetObjectExDictionaryData"))},b.toDisplayString(b.unref(G)("读取对象扩展字典")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[54]||(h[54]=o=>b.unref(r).docommand("Mx_Test_Draw3DPolyline"))},b.toDisplayString(b.unref(G)("绘制3DPolyline")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[55]||(h[55]=o=>b.unref(r).docommand("MxTest_LineText"))},b.toDisplayString(b.unref(G)("绘线文本自定义实体")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[56]||(h[56]=o=>b.unref(r).docommand("Mx_Test_IntersectWith"))},b.toDisplayString(b.unref(G)("计算交点")),3)]),b.createElementVNode("div",AP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[57]||(h[57]=o=>b.unref(r).docommand("Mx_Test_TrueText"))},b.toDisplayString(b.unref(G)("修改文字样式")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[58]||(h[58]=o=>b.unref(r).docommand("Mx_Test_OffsetIn_DrawLine"))},b.toDisplayString(b.unref(G)("偏移输入画线")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[59]||(h[59]=o=>b.unref(r).docommand("Mx_Test_CreateGroup"))},b.toDisplayString(b.unref(G)("创建组")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[60]||(h[60]=o=>b.unref(r).docommand("Mx_ScreenToJpg"))},b.toDisplayString(b.unref(G)("屏幕截图jpg")),3)]),b.createElementVNode("div",EP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[61]||(h[61]=o=>b.unref(r).docommand("Mx_Test_GetText"))},b.toDisplayString(b.unref(G)("获取图纸相同文字")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[62]||(h[62]=o=>b.unref(r).docommand("Mx_Cut_Dwg"))},b.toDisplayString(b.unref(G)("指定范围输出dwg")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[63]||(h[63]=o=>b.unref(r).docommand("Mx_Test_DrawMarkCircle"))},b.toDisplayString(b.unref(G)("测试绘制标记圆")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[64]||(h[64]=o=>b.unref(r).docommand("Mx_Test_Wipeout"))},b.toDisplayString(b.unref(G)("测试Wipeout")),3)]),b.createElementVNode("div",TP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[65]||(h[65]=o=>b.unref(r).docommand("MxTest_SelectEntitysToSpatialFilterBlock"))},b.toDisplayString(b.unref(G)("创建剪切块")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[66]||(h[66]=o=>b.unref(r).docommand("Mx_Test_DrawDimRotatedTol"))},b.toDisplayString(b.unref(G)("公差标注")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[67]||(h[67]=o=>b.unref(r).docommand("MxTest_ModifyAllEntityColor"))},b.toDisplayString(b.unref(G)("改所有对象颜色")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[68]||(h[68]=o=>b.unref(r).docommand("Mx_Cut_MxWeb"))},b.toDisplayString(b.unref(G)("切剪mxweb")),3)]),b.createElementVNode("div",PP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[69]||(h[69]=o=>b.unref(r).docommand("Mx_Test_SetCurrentlyDraw"))},b.toDisplayString(b.unref(G)("设置当前颜色线重")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[70]||(h[70]=o=>b.unref(r).docommand("Mx_Test_FindPolygonEntitys"))},b.toDisplayString(b.unref(G)("查找多边形区域内对象")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[71]||(h[71]=o=>b.unref(r).docommand("MxTest_Explode"))},b.toDisplayString(b.unref(G)("打碎对象")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[72]||(h[72]=o=>b.unref(r).docommand("Mx_Test_DrawTransparencyLine"))},b.toDisplayString(b.unref(G)("绘半透明线")),3)]),b.createElementVNode("div",SP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[73]||(h[73]=o=>b.unref(r).docommand("MxTest_LineRecord"))},b.toDisplayString(b.unref(G)("添加线型")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[74]||(h[74]=o=>b.unref(r).docommand("MxTest_ModifyPatternScale"))},b.toDisplayString(b.unref(G)("修改图案比例")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[75]||(h[75]=o=>b.unref(r).docommand("Mx_DrawEditorEntity"))},b.toDisplayString(b.unref(G)("测试文字编辑")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[76]||(h[76]=o=>b.unref(r).docommand("Mx_TestDrawBarCode"))},b.toDisplayString(b.unref(G)("绘制条形码")),3)]),b.createElementVNode("div",CP,[b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[77]||(h[77]=o=>b.unref(r).docommand("Mx_TestdrawQrCode"))},b.toDisplayString(b.unref(G)("绘制二维码")),3),b.createElementVNode("button",{class:b.normalizeClass(s.value?"button button2 btnEn":"button button2"),onClick:h[78]||(h[78]=o=>b.unref(r).docommand("Mx_ScreenToBmp"))},b.toDisplayString(b.unref(G)("屏幕截图bmp")),3)])])])])):b.createCommentVNode("",!0)]))}}),kO="",zo=(t,e)=>{const n=t.__vccOpts||t;for(const[r,s]of e)n[r]=s;return n},RP=zo(DP,[["__scopeId","data-v-a388a3ba"],["__file","Modal.vue"]]),ob=t=>(b.pushScopeId("data-v-0817c4f4"),t=t(),b.popScopeId(),t),LP={key:0,class:"modal-wrapper",id:"modal"},IP={class:"modal-body card"},kP={class:"modal-header"},BP={class:"heading"},FP=[ob(()=>b.createElementVNode("svg",{viewBox:"0 0 24 24"},[b.createElementVNode("path",{d:"M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"})],-1))],zP={style:{"border-bottom":"2px solid #008CBA","margin-bottom":"8px",display:"flex","flex-wrap":"wrap"}},NP=["onClick"],UP={style:{"overflow-y":"auto",height:"500px"}},VP={class:"btn_box"},GP={class:"btn_box"},OP={class:"btn_box"},jP={class:"btn_box"},HP={class:"btn_box"},WP={class:"btn_box"},qP={class:"btn_box"},YP={style:{"overflow-y":"auto",height:"500px"}},XP={class:"btn_box"},KP={class:"btn_box"},ZP={class:"btn_box"},JP={class:"btn_box"},QP={class:"btn_box"},$P={class:"btn_box"},tS={class:"btn_box"},eS={style:{"overflow-y":"auto",height:"500px"}},nS={class:"btn_box"},iS={class:"btn_box"},rS={class:"btn_box"},oS={class:"btn_box"},sS={class:"btn_box"},aS={class:"btn_box"},lS={style:{"overflow-y":"auto",height:"500px"}},cS={class:"btn_box"},uS={class:"btn_box"},hS={class:"btn_box"},dS={class:"btn_box"},pS={style:{"overflow-y":"auto",height:"500px"}},fS={class:"btn_box"},mS={class:"btn_box"},gS={class:"btn_box"},yS={style:{"overflow-y":"auto",height:"500px"}},xS={class:"btn_box"},vS={class:"btn_box"},_S={class:"btn_box"},bS={class:"btn_box"},MS={style:{"overflow-y":"auto",height:"500px"}},wS={class:"btn_box"},AS=[ob(()=>b.createElementVNode("svg",{viewBox:"0 0 24 24"},[b.createElementVNode("path",{d:"M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"})],-1))],ES={class:"btnBox"},TS=b.defineComponent({__name:"Tools",setup(t){const{isToolsVisible:e,hideModal:n,modalOptions:r,isDialogVisible:s,excelText:u,copyTextToClipboard:h}=If(),o=b.ref("fit"),{store:m}=MxPluginContext,{setCommandFocus:y}=m.useFocus(),x=b.ref(null),M=T=>{const P=x.value,D=T.clientX-P.offsetLeft,k=T.clientY-P.offsetTop,z=O=>{P.style.left=O.clientX-D+"px",P.style.top=O.clientY-k+"px"};document.addEventListener("mousemove",z),document.addEventListener("mouseup",()=>{document.removeEventListener("mousemove",z)})},A=b.ref(!1);return b.watch(()=>e.value,T=>{T&&(A.value=localStorage.getItem("language")==="en")}),(T,P)=>(b.openBlock(),b.createBlock(b.Teleport,{to:"body"},[b.unref(e)?(b.openBlock(),b.createElementBlock("div",LP,[b.createElementVNode("div",IP,[b.createElementVNode("div",kP,[b.createElementVNode("h2",BP,b.toDisplayString(b.unref(r).title),1),b.createElementVNode("a",{href:"#!",onClick:P[0]||(P[0]=(...D)=>b.unref(n)&&b.unref(n)(...D)),role:"button",class:"close","aria-label":"close this modal"},FP)]),b.createElementVNode("div",zP,[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList([{name:b.unref(G)("修改工具"),id:"fit"},{name:b.unref(G)("文字工具"),id:"text"},{name:b.unref(G)("绘图工具"),id:"draw"},{name:b.unref(G)("块工具"),id:"block"},{name:b.unref(G)("测量工具"),id:"count"},{name:b.unref(G)("标注工具"),id:"dimension"},{name:b.unref(G)("其他工具"),id:"other"}],D=>(b.openBlock(),b.createElementBlock("button",{key:D.id,onClick:()=>{o.value=D.id},class:b.normalizeClass(o.value===D.id?"btn btn2":"btn"),style:b.normalizeStyle(A.value?"font-size:var(--mx-font-size)":"")},b.toDisplayString(D.name),15,NP))),128))]),b.withDirectives(b.createElementVNode("div",UP,[b.createElementVNode("div",VP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[1]||(P[1]=D=>b.unref(r).docommand("Mx_Multicopy"))},b.toDisplayString(b.unref(G)("多重复制")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[2]||(P[2]=D=>b.unref(r).docommand("Mx_ArcToCircle"))},b.toDisplayString(b.unref(G)("弧转圆")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[3]||(P[3]=D=>b.unref(r).docommand("Mx_CopyRotation"))},b.toDisplayString(b.unref(G)("复制旋转")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[4]||(P[4]=D=>b.unref(r).docommand("Mx_CricleTotoll"))},b.toDisplayString(b.unref(G)("圆转多边")),3)]),b.createElementVNode("div",GP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[5]||(P[5]=D=>b.unref(r).docommand("Mx_ChangeColor"))},b.toDisplayString(b.unref(G)("修改颜色")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[6]||(P[6]=D=>b.unref(r).docommand("Mx_ArcToAngle"))},b.toDisplayString(b.unref(G)("圆弧切角")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[7]||(P[7]=D=>b.unref(r).docommand("Mx_TemHiding"))},b.toDisplayString(b.unref(G)("临时隐藏")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[8]||(P[8]=D=>b.unref(r).docommand("Mx_BoxDel"))},b.toDisplayString(b.unref(G)("方框删除")),3)]),b.createElementVNode("div",OP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[9]||(P[9]=D=>b.unref(r).docommand("Mx_AngleCopy"))},b.toDisplayString(b.unref(G)("角度复制")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[10]||(P[10]=D=>b.unref(r).docommand("Mx_VertexRep"))},b.toDisplayString(b.unref(G)("顶点复制")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[11]||(P[11]=D=>b.unref(r).docommand("Mx_IntersectBreak"))},b.toDisplayString(b.unref(G)("交点打断")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[12]||(P[12]=D=>b.unref(r).docommand("Mx_DoubleOff"))},b.toDisplayString(b.unref(G)("双向偏移")),3)]),b.createElementVNode("div",jP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[13]||(P[13]=D=>b.unref(r).docommand("Mx_EitCircle"))},b.toDisplayString(b.unref(G)("改圆大小")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[14]||(P[14]=D=>b.unref(r).docommand("Mx_LayerTypeScale"))},b.toDisplayString(b.unref(G)("线型比例")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[15]||(P[15]=D=>b.unref(r).docommand("Mx_Telescoping"))},b.toDisplayString(b.unref(G)("伸缩")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[16]||(P[16]=D=>b.unref(r).docommand("Mx_ArcOrder"))},b.toDisplayString(b.unref(G)("按弧阵列")),3)]),b.createElementVNode("div",HP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[17]||(P[17]=D=>b.unref(r).docommand("Mx_PlRoundCorners"))},b.toDisplayString(b.unref(G)("pl圆角")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[18]||(P[18]=D=>b.unref(r).docommand("Mx_PlReverse"))},b.toDisplayString(b.unref(G)("pl线反向")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[19]||(P[19]=D=>b.unref(r).docommand("Mx_TestGetAllLineByLayer"))},b.toDisplayString(b.unref(G)("得到所有直线对象")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[20]||(P[20]=D=>b.unref(r).docommand("Mx_Bisection"))},b.toDisplayString(b.unref(G)("等分")),3)]),b.createElementVNode("div",WP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[21]||(P[21]=D=>b.unref(r).docommand("Mx_RectangularScaling"))},b.toDisplayString(b.unref(G)("矩形缩放")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[22]||(P[22]=D=>b.unref(r).docommand("Mx_Interrupt"))},b.toDisplayString(b.unref(G)("打断")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[23]||(P[23]=D=>b.unref(r).docommand("Mx_PolygonClipping"))},b.toDisplayString(b.unref(G)("切割多边形")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[24]||(P[24]=D=>b.unref(r).docommand("Mx_MergePolygons"))},b.toDisplayString(b.unref(G)("合并多边形")),3)]),b.createElementVNode("div",qP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[25]||(P[25]=D=>b.unref(r).docommand("Mx_AddVertex"))},b.toDisplayString(b.unref(G)("添加多边形顶点")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[26]||(P[26]=D=>b.unref(r).docommand("Mx_DeleteVertex"))},b.toDisplayString(b.unref(G)("删除多边形顶点")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[27]||(P[27]=D=>b.unref(r).docommand("Mx_StretchPolygon"))},b.toDisplayString(b.unref(G)("多边形单边拉伸")),3)])],512),[[b.vShow,o.value==="fit"]]),b.withDirectives(b.createElementVNode("div",YP,[b.createElementVNode("div",XP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[28]||(P[28]=D=>b.unref(r).docommand("Mx_DrawStart"))},b.toDisplayString(b.unref(G)("星形")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[29]||(P[29]=D=>b.unref(r).docommand("Mx_ConcavoVex"))},b.toDisplayString(b.unref(G)("凹凸线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[30]||(P[30]=D=>b.unref(r).docommand("Mx_ZigzagLine"))},b.toDisplayString(b.unref(G)("锯齿线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[31]||(P[31]=D=>b.unref(r).docommand("Mx_CenterRect"))},b.toDisplayString(b.unref(G)("中心矩形")),3)]),b.createElementVNode("div",KP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[32]||(P[32]=D=>b.unref(r).docommand("Mx_RREC"))},b.toDisplayString(b.unref(G)("圆角矩形")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[33]||(P[33]=D=>b.unref(r).docommand("Mx_CCLine"))},b.toDisplayString(b.unref(G)("圆中心线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[34]||(P[34]=D=>b.unref(r).docommand("Mx_Piping"))},b.toDisplayString(b.unref(G)("管道")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[35]||(P[35]=D=>b.unref(r).docommand("Mx_CutPipeline"))},b.toDisplayString(b.unref(G)("剖管符")),3)]),b.createElementVNode("div",ZP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[36]||(P[36]=D=>b.unref(r).docommand("Mx_PerpLine"))},b.toDisplayString(b.unref(G)("中垂线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[37]||(P[37]=D=>b.unref(r).docommand("Mx_StairLine"))},b.toDisplayString(b.unref(G)("楼梯")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[38]||(P[38]=D=>b.unref(r).docommand("Mx_SolidCircle"))},b.toDisplayString(b.unref(G)("实心圆")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[39]||(P[39]=D=>b.unref(r).docommand("Mx_CottonInsulation"))},b.toDisplayString(b.unref(G)("保温棉")),3)]),b.createElementVNode("div",JP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[40]||(P[40]=D=>b.unref(r).docommand("Mx_CenterLine"))},b.toDisplayString(b.unref(G)("中心线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[41]||(P[41]=D=>b.unref(r).docommand("Mx_DoHole"))},b.toDisplayString(b.unref(G)("开洞")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[42]||(P[42]=D=>b.unref(r).docommand("Mx_MassegeBox"))},b.toDisplayString(b.unref(G)("消息框")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[43]||(P[43]=D=>b.unref(r).docommand("Mx_DatumSymbol"))},b.toDisplayString(b.unref(G)("基准符（1）")),3)]),b.createElementVNode("div",QP,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[44]||(P[44]=D=>b.unref(r).docommand("Mx_WelLine"))},b.toDisplayString(b.unref(G)("焊缝线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[45]||(P[45]=D=>b.unref(r).docommand("Mx_ConcentricCircles"))},b.toDisplayString(b.unref(G)("同心圆")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[46]||(P[46]=D=>b.unref(r).docommand("Mx_Gear"))},b.toDisplayString(b.unref(G)("齿轮")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[47]||(P[47]=D=>b.unref(r).docommand("Mx_BlkCenterLine"))},b.toDisplayString(b.unref(G)("块中心线")),3)]),b.createElementVNode("div",$P,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[48]||(P[48]=D=>b.unref(r).docommand("Mx_RoundCutPublicLine"))},b.toDisplayString(b.unref(G)("圆公切线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[49]||(P[49]=D=>b.unref(r).docommand("Mx_DatumSymbol2"))},b.toDisplayString(b.unref(G)("基准符（2）")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[50]||(P[50]=D=>b.unref(r).docommand("Mx_InsterFrame"))},b.toDisplayString(b.unref(G)("插入图框")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[51]||(P[51]=D=>b.unref(r).docommand("Mx_drawRoads"))},b.toDisplayString(b.unref(G)("绘制道路")),3)]),b.createElementVNode("div",tS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[52]||(P[52]=D=>b.unref(r).docommand("Mx_DrawPolygon"))},b.toDisplayString(b.unref(G)("绘任意多边形")),3)])],512),[[b.vShow,o.value==="draw"]]),b.withDirectives(b.createElementVNode("div",eS,[b.createElementVNode("div",nS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[53]||(P[53]=D=>b.unref(r).docommand("Mx_AlignByLine"))},b.toDisplayString(b.unref(G)("按线对齐")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[54]||(P[54]=D=>b.unref(r).docommand("Mx_TextHeight"))},b.toDisplayString(b.unref(G)("改字高")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[55]||(P[55]=D=>b.unref(r).docommand("Mx_TextWidth"))},b.toDisplayString(b.unref(G)("改字宽")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[56]||(P[56]=D=>b.unref(r).docommand("Mx_BrushCon"))},b.toDisplayString(b.unref(G)("刷内容")),3)]),b.createElementVNode("div",iS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[57]||(P[57]=D=>b.unref(r).docommand("Mx_ReplaceCon"))},b.toDisplayString(b.unref(G)("换内容")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[58]||(P[58]=D=>b.unref(r).docommand("Mx_AlignLeft"))},b.toDisplayString(b.unref(G)("左右对齐")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[59]||(P[59]=D=>b.unref(r).docommand("Mx_AlignUp"))},b.toDisplayString(b.unref(G)("上下对齐")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[60]||(P[60]=D=>b.unref(r).docommand("Mx_TextReversal"))},b.toDisplayString(b.unref(G)("文字反转")),3)]),b.createElementVNode("div",rS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[61]||(P[61]=D=>b.unref(r).docommand("Mx_TextTraming"))},b.toDisplayString(b.unref(G)("文字加框")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[62]||(P[62]=D=>b.unref(r).docommand("Mx_Underline"))},b.toDisplayString(b.unref(G)("下划线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[63]||(P[63]=D=>b.unref(r).docommand("Mx_TitleLine"))},b.toDisplayString(b.unref(G)("图名线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[64]||(P[64]=D=>b.unref(r).docommand("Mx_Case"))},b.toDisplayString(b.unref(G)("大小写")),3)]),b.createElementVNode("div",oS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[65]||(P[65]=D=>b.unref(r).docommand("Mx_NumSum"))},b.toDisplayString(b.unref(G)("数字求和")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[66]||(P[66]=D=>b.unref(r).docommand("Mx_SSWords"))},b.toDisplayString(b.unref(G)("选特定字")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[67]||(P[67]=D=>b.unref(r).docommand("Mx_Prefix"))},b.toDisplayString(b.unref(G)("前后缀")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[68]||(P[68]=D=>b.unref(r).docommand("Mx_ConnectText"))},b.toDisplayString(b.unref(G)("连接文字")),3)]),b.createElementVNode("div",sS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[69]||(P[69]=D=>b.unref(r).docommand("Mx_TextTrim"))},b.toDisplayString(b.unref(G)("去空格")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[70]||(P[70]=D=>b.unref(r).docommand("Mx_VerticalText"))},b.toDisplayString(b.unref(G)("文字竖向")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[71]||(P[71]=D=>b.unref(r).docommand("Mx_AlignByArc"))},b.toDisplayString(b.unref(G)("按弧对齐")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[72]||(P[72]=D=>b.unref(r).docommand("Mx_EditTextStyle"))},b.toDisplayString(b.unref(G)("修改全局文字样式")),3)]),b.createElementVNode("div",aS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[73]||(P[73]=D=>b.unref(r).docommand("Mx_ExtractText"))},b.toDisplayString(b.unref(G)("提取文字")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[74]||(P[74]=D=>b.unref(r).docommand("Mx_NumberText"))},b.toDisplayString(b.unref(G)("文字编号")),3)])],512),[[b.vShow,o.value==="text"]]),b.withDirectives(b.createElementVNode("div",lS,[b.createElementVNode("div",cS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[75]||(P[75]=D=>b.unref(r).docommand("Mx_ChangeBN"))},b.toDisplayString(b.unref(G)("改块名")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[76]||(P[76]=D=>b.unref(r).docommand("Mx_BushBlk"))},b.toDisplayString(b.unref(G)("刷块")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[77]||(P[77]=D=>b.unref(r).docommand("Mx_ConBlk"))},b.toDisplayString(b.unref(G)("块连线")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[78]||(P[78]=D=>b.unref(r).docommand("Mx_BlkCenterLine"))},b.toDisplayString(b.unref(G)("块中心线")),3)]),b.createElementVNode("div",uS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[79]||(P[79]=D=>b.unref(r).docommand("Mx_BlkPt"))},b.toDisplayString(b.unref(G)("改块基点")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[80]||(P[80]=D=>b.unref(r).docommand("Mx_BlkColor"))},b.toDisplayString(b.unref(G)("改块颜色")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[81]||(P[81]=D=>b.unref(r).docommand("Mx_BlkRotate"))},b.toDisplayString(b.unref(G)("多块旋转")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[82]||(P[82]=D=>b.unref(r).docommand("Mx_BlkScale"))},b.toDisplayString(b.unref(G)("多块缩放")),3)]),b.createElementVNode("div",hS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[83]||(P[83]=D=>b.unref(r).docommand("Mx_BlkAngle"))},b.toDisplayString(b.unref(G)("刷块角度")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[84]||(P[84]=D=>b.unref(r).docommand("Mx_BlkSelect"))},b.toDisplayString(b.unref(G)("按块选择")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[85]||(P[85]=D=>b.unref(r).docommand("Mx_BlkAllSelect"))},b.toDisplayString(b.unref(G)("按块全选")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[86]||(P[86]=D=>b.unref(r).docommand("Mx_SSBlk"))},b.toDisplayString(b.unref(G)("统计单块")),3)]),b.createElementVNode("div",dS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[87]||(P[87]=D=>b.unref(r).docommand("Mx_SMBlk"))},b.toDisplayString(b.unref(G)("统计多块")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[88]||(P[88]=D=>b.unref(r).docommand("Mx_BlkLayer"))},b.toDisplayString(b.unref(G)("修改块图层")),3)])],512),[[b.vShow,o.value==="block"]]),b.withDirectives(b.createElementVNode("div",pS,[b.createElementVNode("div",fS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[89]||(P[89]=D=>b.unref(r).docommand("Mx_StaLength"))},b.toDisplayString(b.unref(G)("长度")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[90]||(P[90]=D=>b.unref(r).docommand("Mx_StaArea"))},b.toDisplayString(b.unref(G)("统计面积")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[91]||(P[91]=D=>b.unref(r).docommand("Mx_Elevation"))},b.toDisplayString(b.unref(G)("智能标高")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[92]||(P[92]=D=>b.unref(r).docommand("Mx_Area"))},b.toDisplayString(b.unref(G)("面积")),3)]),b.createElementVNode("div",mS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[93]||(P[93]=D=>b.unref(r).docommand("Mx_ReactArea"))},b.toDisplayString(b.unref(G)("矩形面积")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[94]||(P[94]=D=>b.unref(r).docommand("Mx_DistFromPointToLine"))},b.toDisplayString(b.unref(G)("点到直线的距离")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[95]||(P[95]=D=>b.unref(r).docommand("Mx_ArcLength"))},b.toDisplayString(b.unref(G)("弧长")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[96]||(P[96]=D=>b.unref(r).docommand("Mx_MeasuringCircle"))},b.toDisplayString(b.unref(G)("测量圆")),3)]),b.createElementVNode("div",gS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[97]||(P[97]=D=>b.unref(r).docommand("Mx_ContinueMeasurement"))},b.toDisplayString(b.unref(G)("连续测量")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[98]||(P[98]=D=>b.unref(r).docommand("Mx_CountList"))},b.toDisplayString(b.unref(G)("查看分段长度")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[99]||(P[99]=D=>b.unref(r).docommand("Mx_AreaArc"))},b.toDisplayString(b.unref(G)("面积含弧线")),3)])],512),[[b.vShow,o.value==="count"]]),b.withDirectives(b.createElementVNode("div",yS,[b.createElementVNode("div",xS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[100]||(P[100]=D=>b.unref(r).docommand("Mx_Approval"))},b.toDisplayString(b.unref(G)("审图标注")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[101]||(P[101]=D=>b.unref(r).docommand("Mx_AnnotatedRectangle"))},b.toDisplayString(b.unref(G)("矩形标注")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[102]||(P[102]=D=>b.unref(r).docommand("Mx_Roughness"))},b.toDisplayString(b.unref(G)("粗糙度标注")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[103]||(P[103]=D=>b.unref(r).docommand("Mx_CoordAnnotation"))},b.toDisplayString(b.unref(G)("坐标标注")),3)]),b.createElementVNode("div",vS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[104]||(P[104]=D=>b.unref(r).docommand("Mx_StandardSlope"))},b.toDisplayString(b.unref(G)("标斜率")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[105]||(P[105]=D=>b.unref(r).docommand("Mx_Alignment"))},b.toDisplayString(b.unref(G)("对齐")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[106]||(P[106]=D=>b.unref(r).docommand("Mx_Enlarge"))},b.toDisplayString(b.unref(G)("局部放大")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[107]||(P[107]=D=>b.unref(r).docommand("Mx_indexSymbol"))},b.toDisplayString(b.unref(G)("序号标注")),3)]),b.createElementVNode("div",_S,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[108]||(P[108]=D=>b.unref(r).docommand("Mx_RotationLabel"))},b.toDisplayString(b.unref(G)("旋转标注")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[109]||(P[109]=D=>b.unref(r).docommand("Mx_RoundHoleMark"))},b.toDisplayString(b.unref(G)("圆孔标记")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[110]||(P[110]=D=>b.unref(r).docommand("Mx_weldSymbol"))},b.toDisplayString(b.unref(G)("焊缝符号")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[111]||(P[111]=D=>b.unref(r).docommand("Mx_DirectionaSymbol"))},b.toDisplayString(b.unref(G)("向视符号")),3)]),b.createElementVNode("div",bS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[112]||(P[112]=D=>b.unref(r).docommand("Mx_WeldingSymbol"))},b.toDisplayString(b.unref(G)("焊接符号")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[113]||(P[113]=D=>b.unref(r).docommand("Mx_Test_DrawGT"))},b.toDisplayString(b.unref(G)("形位公差")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[114]||(P[114]=D=>b.unref(r).docommand("MxTest_DrawRayAnnotation"))},b.toDisplayString(b.unref(G)("射线标注")),3)])],512),[[b.vShow,o.value==="dimension"]]),b.withDirectives(b.createElementVNode("div",MS,[b.createElementVNode("div",wS,[b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[115]||(P[115]=D=>b.unref(r).docommand("Mx_ReactChangeColor"))},b.toDisplayString(b.unref(G)("矩形标注悬停变色")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[116]||(P[116]=D=>b.unref(r).docommand("Mx_Cut_MxWebToFile"))},b.toDisplayString(b.unref(G)("裁剪图纸扩展")),3),b.createElementVNode("button",{class:b.normalizeClass(A.value?"button button2 btnEn":"button button2"),onClick:P[117]||(P[117]=D=>b.unref(r).docommand("MxTest_DrawArrowLine"))},b.toDisplayString(b.unref(G)("箭头直线")),3)])],512),[[b.vShow,o.value==="other"]])])])):b.createCommentVNode("",!0),b.unref(s)?(b.openBlock(),b.createElementBlock("div",{key:1,class:"textBox",ref_key:"model",ref:x},[b.createElementVNode("div",{class:"header",onMousedown:M},[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("选择的文字")),1),b.createElementVNode("a",{href:"#!",onClick:P[118]||(P[118]=D=>s.value=!1),role:"button",class:"close","aria-label":"close this modal"},AS)],32),b.withDirectives(b.createElementVNode("textarea",{rows:"20",cols:"50",onFocus:P[119]||(P[119]=()=>b.unref(y)(!1)),onBlur:P[120]||(P[120]=()=>b.unref(y)(!0)),"onUpdate:modelValue":P[121]||(P[121]=D=>b.isRef(u)?u.value=D:null)},null,544),[[b.vModelText,b.unref(u)]]),b.createElementVNode("div",ES,[b.createElementVNode("button",{onClick:P[122]||(P[122]=(...D)=>b.unref(h)&&b.unref(h)(...D))},b.toDisplayString(b.unref(G)("复制到剪贴板")),1)])],512)):b.createCommentVNode("",!0)]))}}),zO="",PS=zo(TS,[["__scopeId","data-v-0817c4f4"],["__file","Tools.vue"]]),SS=zo(b.defineComponent({__name:"Test",setup(t){return(e,n)=>(b.openBlock(),b.createElementBlock("div",null,[b.createVNode(RP),b.createVNode(PS)]))}}),[["__file","Test.vue"]]),CS={init(){$.MxFun.setPostMessageToParentFrameFunction(function(t){top.postMessage(t,"*")}),window.addEventListener("message",function(t){t.data.type==="sendStringToExecute"?$.MxFun.sendStringToExecute(t.data.cmd,t.data):(console.log("mx:unprocessed message:"),console.log(t.data))},!1)}};function DS(){CS.init()}function RS(){return Gt(this,null,function*(){const t=new $.MrxDbgUiPrPoint;t.setMessage(G(" 指定第一点:")),t.go(e=>{if(e!=0)return;const n=t.value();let r=new $.MxDbLeadComment;r.point1=n.clone(),r.textHeight=$.MxFun.screenCoordLong2Doc(50),r.text="测试Test1",r.textWidth=$.MxFun.screenCoordLong2Doc(300),r.fixedSize=!0,r.fixedSize&&(r.textHeight=50,r.textWidth=250),r.color=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const s=new $.McEdGetPointWorldDrawObject;s.setDraw((u,h)=>{r.point2=u,h.drawCustomEntity(r)}),t.setBasePt(n),t.setUseBasePt(!0),t.setUserDraw(s),t.setMessage(G(" 指定第二点:")),t.go(u=>{if(u!=0){console.log(u);return}const h=t.value();r.point2=h,$.MxFun.addToCurrentSpace(r)})})})}function LS(){$.MxFun.getCurrentDraw().createCanvasImageData(t=>{const e=window.open();e!=null&&(e.document.write('<img src="'+t+'"/>'),setTimeout(()=>{e.print()},300))},{width:349,height:536})}function IS(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const e=new $.MrxDbgUiPrPoint,n=$.MxFun.getCurrentDraw(),r=new $.McEdGetPointWorldDrawObject,s=new $.MxDbRectBoxLeadComment;s.color=t.getHex(),s.color==0&&(s.color=65793),s.radius=$.MxFun.screenCoordLong2Doc(8),s.setLineWidth(3),s.setLineWidthByPixels(!0),e.setMessage(G(" 云线框起始点:")),e.go(u=>{u==$.MrxDbgUiPrBaseReturn.kOk&&(s.point1=e.value(),r.setDraw(h=>{s.point2=h,r.drawCustomEntity(s)}),e.setUserDraw(r),e.setMessage(G(" 云线框结束点:")),e.go(h=>{h==$.MrxDbgUiPrBaseReturn.kOk&&(s.point2=e.value(),r.setDraw(o=>{s.point3=o,r.drawCustomEntity(s)}),s.text="审图批注XXXXXXXXXX",s.textWidth=$.MxFun.screenCoordLong2Doc(200),s.textHeight=$.MxFun.screenCoordLong2Doc(50),s.fixedSize=!0,s.fixedSize&&(s.textHeight=20,s.textWidth=230),e.setMessage(G(" 审图标注点:")),e.go(o=>{o==$.MrxDbgUiPrBaseReturn.kOk&&(s.point3=e.value(),n.addMxEntity(s))}))}))})})}function R0(t,e){let n=$.MxFun.screenCoordLong2World(e?t:t-t/3);return n=$.MxFun.worldCoordLong2Doc(n),n}function kS(){const t=new $.McEdGetPointWorldDrawObject,e=new $.MxDbArrow,n=$.MxFun.getCurrentDraw(),r=new $.MrxDbgUiPrPoint;r.setUserDraw(t),e.setLineWidth(10),e.innerOffset=R0(10),e.outerOffset=R0(22),e.topOffset=R0(36),e.color=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),r.go(()=>{e.startPoint=r.value(),t.setDraw(s=>{e.endPoint=s,t.drawCustomEntity(e)}),r.go(s=>Gt(this,null,function*(){e.endPoint=r.value(),n.addMxEntity(e)}))})}function BS(){const t=new $.MrxDbgUiPrPoint,e=$.MxFun.getCurrentDraw(),n=new $.McEdGetPointWorldDrawObject,r=$.MxFun.screenCoordLong2Doc(16);t.setMessage(G(" 点击开启绘制云线:")),t.go(()=>{let s=t.value();const u=new $.MxDbCloudLine;u.setRadius(r),u.addPoint(s),u.color=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),n.setDraw(h=>{s.distanceTo(h)>r&&(s=h.clone(),u.addPoint(h,!0)),n.drawCustomEntity(u)}),t.setUserDraw(n),t.setMessage(G(" 再次点击结束绘制云线:")),t.go(()=>{e.addMxEntity(u)})})}let Gf="";function FS(){Gf=$.MxFun.getCurrentDraw().saveMxEntityToJson(),console.log(Gf)}function zS(){return Gt(this,null,function*(){if(Gf.length==0)return;let t=$.MxFun.getCurrentDraw();yield t.loadMxEntityFromJson(Gf,["models/svg/mark.svg"]),t.updateDisplay()})}function NS(){const t=new $.MrxDbgUiPrPoint;t.setMessage(" 指定第一点:"),t.go(e=>{if(e!=0)return;const n=t.value();let r=new $.MxDbArea;r.addPoint(n),r.color=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const s=new $.McEdGetPointWorldDrawObject;s.setDraw((u,h)=>{let o=r.clone();o.addPoint(u),s.drawCustomEntity(o)}),t.setUserDraw(s),t.setMessage(" 指定下一点:"),t.goWhile(u=>{if(u==0){const h=t.value();r.addPoint(h)}},u=>{r.isFill=!0,r.fillOpacity=.7,r.fillColor=6697540,$.MxFun.getCurrentDraw().addMxEntity(r)})})}function US(){$.MxFun.addCommand("BR_Comment",RS),$.MxFun.addCommand("BR_CheckDraw",IS),$.MxFun.addCommand("BR_Arrow",kS),$.MxFun.addCommand("BR_CloudLine",BS),$.MxFun.addCommand("BR_Print",LS),$.MxFun.addCommand("BR_SaveAllMxEntity",FS),$.MxFun.addCommand("BR_LoadAllMxEntity",zS),$.MxFun.addCommand("BR_Area",NS)}function VS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("LineLayer"),t.drawLayer="LineLayer",t.drawLine(0,0,100,0),t.drawLine(200,0,300,100),t.addLinetype("MyLineType","6,-10"),t.drawLinetype="MyLineType",t.drawLine(0,30,100,30),t.drawLine(200,30,300,130),t.drawColor=new p.McCmColor(0,0,255),t.drawLine(0,60,100,60),t.drawLine(200,60,300,160),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=4,t.drawLine(0,90,100,90),t.drawLine(200,90,300,190),t.addLinetype("MyLineType2","10,-2,3,-2"),t.drawLinetype="MyLineType2",t.drawColor=new p.McCmColor(255,0,0),t.drawLine(0,120,100,120),t.drawLine(200,120,300,220),t.addTextStyle("MyLineTypeTextStyle","txt.shx","hztxt.shx",1),t.addLinetypeEx("MyLineType3",'(12.7,("T=MxDraw","S=2.54","L=-5.08","R=0.0","X=-2.54","Y=-1.27"),-10.08)',"MyLineTypeTextStyle"),t.drawLinetype="MyLineType3",t.drawLineWidth=0,t.drawLine(350,120,600,120),t.drawColorIndex=0,t.drawLineWidth=4,t.drawLine(350,220,600,220),t.zoomAll(),t.updateDisplay()}function GS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("ArcLayer"),t.drawLayer="ArcLayer",t.drawArc(0,1e3,100,30,200),t.addLinetype("ArcLineType","30,-5,7,-7"),t.drawLinetype="ArcLineType",t.drawColor=new p.McCmColor(255,25,0),t.drawArc(300,1e3,100,30,200),t.drawLineWidth=15,t.drawColorIndex=255,t.drawArc(600,1e3,100,30,200),t.drawArc2(800,1e3,900,1200,1e3,900),t.drawLinetype="",t.drawLineWidth=40,t.drawArc3(1200,1e3,1400,1e3,.6),t.zoomAll(),t.regen(),t.updateDisplay()}function OS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("CircleLayer"),t.drawLayer="CircleLayer",t.drawCircle(0,800,120),t.addLinetype("CircleLineType","30,-5,7,-7"),t.drawLinetype="CircleLineType",t.drawColor=new p.McCmColor(0,25,255),t.drawCircle(300,800,120),t.addLinetype("CircleLineType","30,-5,7,-7"),t.drawLinetype="CircleLineType",t.drawLineWidth=40,t.drawCircle(600,800,120),t.zoomAll(),t.regen(),t.updateDisplay()}function jS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("PolylineLayer"),t.drawLayer="PolylineLayer",t.pathMoveTo(0,300),t.pathLineTo(100,300),t.pathLineTo(100,400),t.pathLineTo(0,400),t.pathMakeClosed(),t.drawPathToPolyline(),t.pathMoveTo(200,300),t.pathLineTo(300,300),t.pathLineTo(300,400),t.pathLineTo(200,400),t.pathMakeClosed(),t.addLinetype("MyLineType3","30,-10"),t.drawLinetype="MyLineType3",t.drawColorIndex=255,t.drawLineWidth=5,t.drawPathToPolyline(),t.pathMoveTo(400,300),t.pathLineTo(500,300),t.pathLineTo(500,400),t.pathLineTo(400,400),t.pathMakeClosed(),t.drawLinetype="",t.drawColor=new p.McCmColor(0,25,255),t.drawLineWidth=10,t.drawPathToPolyline(),t.pathMoveTo(400,300),t.pathLineTo(500,300),t.pathLineTo(500,400),t.pathLineTo(400,400),t.pathMakeClosed(),t.drawLinetype="",t.drawColor=new p.McCmColor(255,25,0),t.drawLineWidth=10,t.drawPathToPolyline(),t.pathMoveTo(600,300),t.pathLineTo(700,300),t.pathLineTo(700,400),t.pathLineTo(600,400),t.drawLinetype="",t.drawColor=new p.McCmColor(0,255,0),t.drawLineWidth=10,t.drawPathToPolyline(),t.pathMoveTo(800,300),t.pathLineTo(900,300),t.pathLineTo(900,400),t.pathMakeClosed(),t.drawLinetype="",t.drawColor=new p.McCmColor(25,255,0),t.drawLineWidth=10,t.drawPathToPolyline(),t.pathMoveToEx(1e3,300,10,10,0),t.pathLineToEx(1e3,500,30,0,0),t.pathLineTo(1e3,580),t.drawPathToPolyline(),t.pathMoveToEx(1200,300,10,10,0),t.pathLineToEx(1200,500,30,0,0),t.pathLineTo(1200,580),t.drawColor=new p.McCmColor(25,255,0),t.drawLinetype="MyLineType3",t.drawPathToPolyline(),t.pathMoveToEx(1400,300,10,10,-.34),t.pathLineToEx(1400,500,30,0,.34),t.pathLineTo(1400,600),t.drawColor=new p.McCmColor(255,255,25),t.drawLinetype="MyLineType3",t.drawPathToPolyline(),t.zoomAll(),t.regen(),t.updateDisplay()}function HS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("HatchLayer"),t.drawLayer="HatchLayer",t.pathMoveToEx(200,3300,0,0,.3),t.pathLineTo(300,3300),t.pathLineTo(300,3400),t.pathLineTo(200,3300),t.drawColor=new p.McCmColor(25,255,0),t.drawPathToHatch(1),t.pathMoveTo(150,3300),t.pathLineTo(250,3300),t.pathLineTo(250,3400),t.pathLineTo(150,3300),t.drawColor=new p.McCmColor(255,0,0),t.drawPathToHatch(1),t.pathMoveToEx(440,3310,0,0,0),t.pathLineTo(480,3310),t.pathLineTo(480,3360),t.pathLineTo(450,3340),t.pathMakeExclude(!0),t.pathMoveToEx(400,3300,0,0,.3),t.pathLineTo(500,3300),t.pathLineTo(500,3400),t.pathLineTo(400,3300),t.drawColor=new p.McCmColor(255,25,0),t.drawPathToHatch(1),t.addPatternDefinition("MyHatchPattern1","((45, 0,0, 0,0.125))"),t.drawPatternDefinition="MyHatchPattern1",t.pathMoveToEx(600,3300,0,0,.3),t.pathLineTo(700,3300),t.pathLineTo(700,3400),t.pathLineTo(600,3300),t.drawPathToHatch(100),t.addPatternDefinition("MyHatchPattern2","((45, 0,0, 0,0.25) (45, 0.176776695,0, 0,0.25, 0.125,-0.0625))"),t.drawPatternDefinition="MyHatchPattern2",t.pathMoveToEx(800,3300,0,0,.3),t.pathLineTo(900,3300),t.pathLineTo(900,3400),t.pathLineTo(800,3300),t.drawPathToHatch(100),t.zoomAll(),t.regen(),t.updateDisplay()}function WS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.addLayer("TextLayer"),t.drawLayer="TextLayer",t.drawText(0,1900,"绘图控件文字测试",100,0,0,1),t.drawColor=new p.McCmColor(255,25,0),t.drawText(3e3,2100,"绘图控件文字测试",100,-20,2,1),t.addTextStyle("MyTextStyle","italicc.shx","gbcbig.shx",.7),t.drawTextStyle="MyTextStyle",t.drawColor=new p.McCmColor(255,0,0),t.drawText(0,3e3,"绘图控件文字测试",100,0,0,1),t.AddTureTypeTextStyle("MyTrueTypeTextStyle"),t.drawTextStyle="MyTrueTypeTextStyle",t.drawColor=new p.McCmColor(200,255,50),t.drawText(0,3500,"绘图控件TrueType文字测试",100,0,0,1),t.zoomAll(),t.regen(),t.updateDisplay()}function qS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),p.MxCpp.App.loadFonts([],[],["syadobe","simsun"],()=>{t.AddTureTypeTextStyle("ht_style","syadobe"),t.AddTureTypeTextStyle("st_style","simsun"),t.drawTextStyle="ht_style",t.drawColor=new p.McCmColor(200,255,50);let n=t.drawText(0,3500,"绘图控件TrueType文字测试",100,0,0,1).getMcDbEntity();n&&(n.textStyle="st_style"),t.zoomAll(),t.regen(),t.updateDisplay()})}function YS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("LineLayer"),t.drawLayer="LineLayer",t.drawEllipse(0,1400,100,0,.7),t.addLinetype("MyEllipseType","6,-10"),t.drawLinetype="MyEllipseType",t.drawColor=new p.McCmColor(200,0,0),t.drawEllipse(200,1400,80,30,.5),t.zoomAll(),t.regen(),t.updateDisplay()}function XS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLineWidth=0,t.addLayer("EllipseArcLayer"),t.drawLayer="EllipseArcLayer",t.drawEllipseArc(0,1600,80,30,.4,30,200),t.addLinetype("MyEllipseArcType","6,-10"),t.drawLinetype="MyEllipseArcType",t.drawColor=new p.McCmColor(200,200,0),t.drawEllipseArc(200,1600,-80,30,.5,60,300),t.drawLinetype="",t.zoomAll(),t.regen(),t.updateDisplay()}function KS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.addLayer("MtextLayer"),t.drawLayer="MtextLayer",t.drawTextStyle="",t.drawMText(0,-100,"控件:\\P多行文字测试",50,400,0,1),t.zoomAll(),t.regen(),t.updateDisplay()}function ZS(t){if(!t||!t.param)return;let e=p.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("LineLayer"),e.drawLayer="LineLayer",e.drawLine(t.param.x1,t.param.y1,t.param.x2,t.param.y2),e.zoomAll(),e.updateDisplay(),$.MxFun.postMessageToParentFrame({cmd:"Mx_ParamDrawLine",message:"ok"})}function JS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.drawText(350831.77,1940511845e-2,"1.034",10,0,p.McDb.TextHorzMode.kTextLeft,p.McDb.TextVertMode.kTextVertMid),t.zoomAll(),t.regen(100)}function QS(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.addDimStyle("MyDimStyle","41,0.18,141,0.09,40,200","77,1,271,3","",""),t.drawDimStyle="MyDimStyle",t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.drawDimAligned(0,4e3,300,4500,150,4600),t.zoomAll(),t.updateDisplay()}function $S(){let t=p.MxCpp.getCurrentMxCAD();t.newFile();let e=t.addTextStyle("我的标注字体","complex.shx","gbcbig.shx",1);t.addDimStyle("MyDimStyle","41,0.18,141,0.09,40,200","77,1,271,3","",`340,${e.id}`),t.drawDimStyle="MyDimStyle",t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0;let r=t.drawDimRotated(0,7e3,600,7e3,250,7050,0).getMcDbDimension();r&&(r.setDimVarDouble(41,2),r.setDimVarDouble(44,3),r.setDimVarDouble(49,6),r.setDimVarInt(290,1)),t.drawDimRotated(0,7200,0,7600,150,7300,.771),t.zoomAll(),t.updateDisplay()}function tC(){let t=p.MxCpp.getCurrentMxCAD();t.newFile();let e=t.addTextStyle("我的标注字体","complex.shx","gbcbig.shx",1);t.addDimStyle("MyDimStyle","41,0.18,141,0.09,40,200","77,1,271,3",'3,"DN%%c<>"',`340,${e.id}`),t.drawDimStyle="MyDimStyle",t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0;let n=t.drawDimRotated(0,7e3,600,7e3,250,7050,0).getMcDbDimension();n&&(n.setDimVarInt(71,1),n.setDimVarInt(272,1),n.setDimVarDouble(146,.5),n.setDimVarDouble(48,5.5),n.setDimVarDouble(47,2.5),n.recomputeDimBlock()),t.zoomAll(),t.updateDisplay()}function eC(){let t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.addDimStyle("MyDimStyle2","41,0.18,141,0.09,40,200","77,1,271,3","",""),t.drawDimStyle="MyDimStyle2",t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.drawDimAngular(500,5e3,0,5500,1e3,5500,500,5500),t.zoomAll(),t.updateDisplay()}function nC(){$.MxFun.addCommand("Mx_Test_DrawLine",VS),$.MxFun.addCommand("Mx_Test_DrawArc",GS),$.MxFun.addCommand("Mx_Test_DrawCircle",OS),$.MxFun.addCommand("Mx_Test_DrawPolyline",jS),$.MxFun.addCommand("Mx_Test_DrawHatch",HS),$.MxFun.addCommand("Mx_Test_DrawText",WS),$.MxFun.addCommand("Mx_Test_Ellipse",YS),$.MxFun.addCommand("Mx_Test_EllipseArc",XS),$.MxFun.addCommand("Mx_Test_MText",KS),$.MxFun.addCommand("Mx_Test_Text",JS),$.MxFun.addCommand("Mx_ParamDrawLine",ZS),$.MxFun.addCommand("Mx_Test_DimAligned",QS),$.MxFun.addCommand("Mx_Test_DrawDimRotated",$S),$.MxFun.addCommand("Mx_Test_DrawDimRotatedTol",tC),$.MxFun.addCommand("Mx_Test_DrawDimAngular",eC),$.MxFun.addCommand("Mx_Test_TrueText",qS)}Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t}),Math.sign===void 0&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(t){if(t==null)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e});var iC="113",rC=0,sb=1,oC=2,ab=1,sC=2,Hh=3,Dc=0,lr=1,Wh=2,lb=1,cb=0,aC=1,Rc=2,ya=0,qh=1,ub=2,hb=3,db=4,lC=5,Lc=100,cC=101,uC=102,pb=103,fb=104,hC=200,dC=201,pC=202,fC=203,mb=204,gb=205,mC=206,gC=207,yC=208,xC=209,vC=210,_C=0,bC=1,MC=2,L0=3,wC=4,AC=5,EC=6,TC=7,Of=0,PC=1,SC=2,jf=0,I0=1,CC=2,DC=3,RC=4,LC=5,k0=300,B0=301,F0=302,yb=303,z0=304,xb=305,Yh=306,N0=307,xl=1e3,Dr=1001,Xh=1002,Yi=1003,Hf=1004,Wf=1005,$i=1006,U0=1007,Ic=1008,qf=1009,IC=1010,kC=1011,Yf=1012,BC=1013,vb=1014,Kh=1015,V0=1016,FC=1017,zC=1018,NC=1019,Xf=1020,UC=1021,Ns=1022,No=1023,VC=1024,GC=1025,OC=No,kc=1026,Zh=1027,jC=1028,HC=1029,WC=1030,qC=1031,YC=1032,XC=1033,_b=33776,bb=33777,Mb=33778,wb=33779,Ab=35840,Eb=35841,Tb=35842,Pb=35843,KC=36196,ZC=37808,JC=37809,QC=37810,$C=37811,t3=37812,e3=37813,n3=37814,i3=37815,r3=37816,o3=37817,s3=37818,a3=37819,l3=37820,c3=37821,u3=2200,h3=2201,d3=2202,Jh=2300,Bc=2301,G0=2302,Fc=2400,zc=2401,Kf=2402,p3=0,f3=1,Sb=2,ho=3e3,Qh=3001,Cb=3007,O0=3002,m3=3003,Db=3004,Rb=3005,Lb=3006,g3=3200,y3=3201,vl=0,x3=1,j0=7680,v3=519,Zf=35044,$h=35048;function Us(){}Object.assign(Us.prototype,{addEventListener:function(t,e){this._listeners===void 0&&(this._listeners={});var n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)},hasEventListener:function(t,e){if(this._listeners===void 0)return!1;var n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1},removeEventListener:function(t,e){if(this._listeners!==void 0){var n=this._listeners,r=n[t];if(r!==void 0){var s=r.indexOf(e);s!==-1&&r.splice(s,1)}}},dispatchEvent:function(t){if(this._listeners!==void 0){var e=this._listeners,n=e[t.type];if(n!==void 0){t.target=this;for(var r=n.slice(0),s=0,u=r.length;s<u;s++)r[s].call(this,t)}}}});for(var fr=[],td=0;td<256;td++)fr[td]=(td<16?"0":"")+td.toString(16);var Xn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,s=fr[t&255]+fr[t>>8&255]+fr[t>>16&255]+fr[t>>24&255]+"-"+fr[e&255]+fr[e>>8&255]+"-"+fr[e>>16&15|64]+fr[e>>24&255]+"-"+fr[n&63|128]+fr[n>>8&255]+"-"+fr[n>>16&255]+fr[n>>24&255]+fr[r&255]+fr[r>>8&255]+fr[r>>16&255]+fr[r>>24&255];return s.toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,s){return r+(t-e)*(s-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Xn.DEG2RAD},radToDeg:function(t){return t*Xn.RAD2DEG},isPowerOfTwo:function(t){return(t&t-1)===0&&t!==0},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,n,r,s){var u=Math.cos,h=Math.sin,o=u(n/2),m=h(n/2),y=u((e+r)/2),x=h((e+r)/2),M=u((e-r)/2),A=h((e-r)/2),T=u((r-e)/2),P=h((r-e)/2);s==="XYX"?t.set(o*x,m*M,m*A,o*y):s==="YZY"?t.set(m*A,o*x,m*M,o*y):s==="ZXZ"?t.set(m*M,m*A,o*x,o*y):s==="XZX"?t.set(o*x,m*P,m*T,o*y):s==="YXY"?t.set(m*T,o*x,m*P,o*y):s==="ZYZ"?t.set(m*P,m*T,o*x,o*y):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function ke(t,e){this.x=t||0,this.y=e||0}Object.defineProperties(ke.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(ke.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),r=Math.sin(e),s=this.x-t.x,u=this.y-t.y;return this.x=s*n-u*r+t.x,this.y=s*r+u*n+t.y,this}});function _r(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(_r.prototype,{isMatrix3:!0,set:function(t,e,n,r,s,u,h,o,m){var y=this.elements;return y[0]=t,y[1]=r,y[2]=h,y[3]=e,y[4]=s,y[5]=o,y[6]=n,y[7]=u,y[8]=m,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,s=this.elements,u=n[0],h=n[3],o=n[6],m=n[1],y=n[4],x=n[7],M=n[2],A=n[5],T=n[8],P=r[0],D=r[3],k=r[6],z=r[1],O=r[4],U=r[7],H=r[2],V=r[5],W=r[8];return s[0]=u*P+h*z+o*H,s[3]=u*D+h*O+o*V,s[6]=u*k+h*U+o*W,s[1]=m*P+y*z+x*H,s[4]=m*D+y*O+x*V,s[7]=m*k+y*U+x*W,s[2]=M*P+A*z+T*H,s[5]=M*D+A*O+T*V,s[8]=M*k+A*U+T*W,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],u=t[4],h=t[5],o=t[6],m=t[7],y=t[8];return e*u*y-e*h*m-n*s*y+n*h*o+r*s*m-r*u*o},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=t.elements,r=this.elements,s=n[0],u=n[1],h=n[2],o=n[3],m=n[4],y=n[5],x=n[6],M=n[7],A=n[8],T=A*m-y*M,P=y*x-A*o,D=M*o-m*x,k=s*T+u*P+h*D;if(k===0){var z="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(e===!0)throw new Error(z);return console.warn(z),this.identity()}var O=1/k;return r[0]=T*O,r[1]=(h*M-A*u)*O,r[2]=(y*u-h*m)*O,r[3]=P*O,r[4]=(A*s-h*x)*O,r[5]=(h*o-y*s)*O,r[6]=D*O,r[7]=(u*x-M*s)*O,r[8]=(m*s-u*o)*O,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,s,u,h){var o=Math.cos(s),m=Math.sin(s);this.set(n*o,n*m,-n*(o*u+m*h)+u+t,-r*m,r*o,-r*(-m*u+o*h)+h+e,0,0,1)},scale:function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.elements,s=r[0],u=r[3],h=r[6],o=r[1],m=r[4],y=r[7];return r[0]=e*s+n*o,r[3]=e*u+n*m,r[6]=e*h+n*y,r[1]=-n*s+e*o,r[4]=-n*u+e*m,r[7]=-n*h+e*y,this},translate:function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Nc,_l={getDataURL:function(t){var e;if(typeof HTMLCanvasElement=="undefined")return t.src;if(t instanceof HTMLCanvasElement)e=t;else{Nc===void 0&&(Nc=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Nc.width=t.width,Nc.height=t.height;var n=Nc.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Nc}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},_3=0;function bi(t,e,n,r,s,u,h,o,m,y){Object.defineProperty(this,"id",{value:_3++}),this.uuid=Xn.generateUUID(),this.name="",this.image=t!==void 0?t:bi.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=e!==void 0?e:bi.DEFAULT_MAPPING,this.wrapS=n!==void 0?n:Dr,this.wrapT=r!==void 0?r:Dr,this.magFilter=s!==void 0?s:$i,this.minFilter=u!==void 0?u:Ic,this.anisotropy=m!==void 0?m:1,this.format=h!==void 0?h:No,this.internalFormat=null,this.type=o!==void 0?o:qf,this.offset=new ke(0,0),this.repeat=new ke(1,1),this.center=new ke(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new _r,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=y!==void 0?y:ho,this.version=0,this.onUpdate=null}bi.DEFAULT_IMAGE=void 0,bi.DEFAULT_MAPPING=k0,bi.prototype=Object.assign(Object.create(Us.prototype),{constructor:bi,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var r=this.image;if(r.uuid===void 0&&(r.uuid=Xn.generateUUID()),!e&&t.images[r.uuid]===void 0){var s;if(Array.isArray(r)){s=[];for(var u=0,h=r.length;u<h;u++)s.push(_l.getDataURL(r[u]))}else s=_l.getDataURL(r);t.images[r.uuid]={uuid:r.uuid,url:s}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==k0)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case xl:t.x=t.x-Math.floor(t.x);break;case Dr:t.x=t.x<0?0:1;break;case Xh:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case xl:t.y=t.y-Math.floor(t.y);break;case Dr:t.y=t.y<0?0:1;break;case Xh:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(bi.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});function Mi(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=r!==void 0?r:1}Object.defineProperties(Mi.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(Mi.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,s=this.w,u=t.elements;return this.x=u[0]*e+u[4]*n+u[8]*r+u[12]*s,this.y=u[1]*e+u[5]*n+u[9]*r+u[13]*s,this.z=u[2]*e+u[6]*n+u[10]*r+u[14]*s,this.w=u[3]*e+u[7]*n+u[11]*r+u[15]*s,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,r,s,u=.01,h=.1,o=t.elements,m=o[0],y=o[4],x=o[8],M=o[1],A=o[5],T=o[9],P=o[2],D=o[6],k=o[10];if(Math.abs(y-M)<u&&Math.abs(x-P)<u&&Math.abs(T-D)<u){if(Math.abs(y+M)<h&&Math.abs(x+P)<h&&Math.abs(T+D)<h&&Math.abs(m+A+k-3)<h)return this.set(1,0,0,0),this;e=Math.PI;var z=(m+1)/2,O=(A+1)/2,U=(k+1)/2,H=(y+M)/4,V=(x+P)/4,W=(T+D)/4;return z>O&&z>U?z<u?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(z),r=H/n,s=V/n):O>U?O<u?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(O),n=H/r,s=W/r):U<u?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(U),n=V/s,r=W/s),this.set(n,r,s,e),this}var K=Math.sqrt((D-T)*(D-T)+(x-P)*(x-P)+(M-y)*(M-y));return Math.abs(K)<.001&&(K=1),this.x=(D-T)/K,this.y=(x-P)/K,this.z=(M-y)/K,this.w=Math.acos((m+A+k-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}});function Rr(t,e,n){this.width=t,this.height=e,this.scissor=new Mi(0,0,t,e),this.scissorTest=!1,this.viewport=new Mi(0,0,t,e),n=n||{},this.texture=new bi(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:$i,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!0,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null}Rr.prototype=Object.assign(Object.create(Us.prototype),{constructor:Rr,isWebGLRenderTarget:!0,setSize:function(t,e){(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Ib(t,e,n){Rr.call(this,t,e,n),this.samples=4}Ib.prototype=Object.assign(Object.create(Rr.prototype),{constructor:Ib,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Rr.prototype.copy.call(this,t),this.samples=t.samples,this}});function Wr(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=r!==void 0?r:1}Object.assign(Wr,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,s,u,h){var o=n[r+0],m=n[r+1],y=n[r+2],x=n[r+3],M=s[u+0],A=s[u+1],T=s[u+2],P=s[u+3];if(x!==P||o!==M||m!==A||y!==T){var D=1-h,k=o*M+m*A+y*T+x*P,z=k>=0?1:-1,O=1-k*k;if(O>Number.EPSILON){var U=Math.sqrt(O),H=Math.atan2(U,k*z);D=Math.sin(D*H)/U,h=Math.sin(h*H)/U}var V=h*z;if(o=o*D+M*V,m=m*D+A*V,y=y*D+T*V,x=x*D+P*V,D===1-h){var W=1/Math.sqrt(o*o+m*m+y*y+x*x);o*=W,m*=W,y*=W,x*=W}}t[e]=o,t[e+1]=m,t[e+2]=y,t[e+3]=x}}),Object.defineProperties(Wr.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Wr.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,r=t._y,s=t._z,u=t.order,h=Math.cos,o=Math.sin,m=h(n/2),y=h(r/2),x=h(s/2),M=o(n/2),A=o(r/2),T=o(s/2);return u==="XYZ"?(this._x=M*y*x+m*A*T,this._y=m*A*x-M*y*T,this._z=m*y*T+M*A*x,this._w=m*y*x-M*A*T):u==="YXZ"?(this._x=M*y*x+m*A*T,this._y=m*A*x-M*y*T,this._z=m*y*T-M*A*x,this._w=m*y*x+M*A*T):u==="ZXY"?(this._x=M*y*x-m*A*T,this._y=m*A*x+M*y*T,this._z=m*y*T+M*A*x,this._w=m*y*x-M*A*T):u==="ZYX"?(this._x=M*y*x-m*A*T,this._y=m*A*x+M*y*T,this._z=m*y*T-M*A*x,this._w=m*y*x+M*A*T):u==="YZX"?(this._x=M*y*x+m*A*T,this._y=m*A*x+M*y*T,this._z=m*y*T-M*A*x,this._w=m*y*x-M*A*T):u==="XZY"&&(this._x=M*y*x-m*A*T,this._y=m*A*x-M*y*T,this._z=m*y*T+M*A*x,this._w=m*y*x+M*A*T),e!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e=t.elements,n=e[0],r=e[4],s=e[8],u=e[1],h=e[5],o=e[9],m=e[2],y=e[6],x=e[10],M=n+h+x,A;return M>0?(A=.5/Math.sqrt(M+1),this._w=.25/A,this._x=(y-o)*A,this._y=(s-m)*A,this._z=(u-r)*A):n>h&&n>x?(A=2*Math.sqrt(1+n-h-x),this._w=(y-o)/A,this._x=.25*A,this._y=(r+u)/A,this._z=(s+m)/A):h>x?(A=2*Math.sqrt(1+h-n-x),this._w=(s-m)/A,this._x=(r+u)/A,this._y=.25*A,this._z=(o+y)/A):(A=2*Math.sqrt(1+x-n-h),this._w=(u-r)/A,this._x=(s+m)/A,this._y=(o+y)/A,this._z=.25*A),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var n=1e-6,r=t.dot(e)+1;return r<n?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(Xn.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var n=this.angleTo(t);if(n===0)return this;var r=Math.min(1,e/n);return this.slerp(t,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,r=t._y,s=t._z,u=t._w,h=e._x,o=e._y,m=e._z,y=e._w;return this._x=n*y+u*h+r*m-s*o,this._y=r*y+u*o+s*h-n*m,this._z=s*y+u*m+n*o-r*h,this._w=u*y-n*h-r*o-s*m,this._onChangeCallback(),this},slerp:function(t,e){if(e===0)return this;if(e===1)return this.copy(t);var n=this._x,r=this._y,s=this._z,u=this._w,h=u*t._w+n*t._x+r*t._y+s*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=u,this._x=n,this._y=r,this._z=s,this;var o=1-h*h;if(o<=Number.EPSILON){var m=1-e;return this._w=m*u+e*this._w,this._x=m*n+e*this._x,this._y=m*r+e*this._y,this._z=m*s+e*this._z,this.normalize(),this._onChangeCallback(),this}var y=Math.sqrt(o),x=Math.atan2(y,h),M=Math.sin((1-e)*x)/y,A=Math.sin(e*x)/y;return this._w=u*M+this._w*A,this._x=n*M+this._x*A,this._y=r*M+this._y*A,this._z=s*M+this._z*A,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return e===void 0&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var H0=new kt,kb=new Wr;function kt(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}Object.assign(kt.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(kb.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(kb.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*r,this.y=s[1]*e+s[4]*n+s[7]*r,this.z=s[2]*e+s[5]*n+s[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,n=this.y,r=this.z,s=t.elements,u=1/(s[3]*e+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*r+s[12])*u,this.y=(s[1]*e+s[5]*n+s[9]*r+s[13])*u,this.z=(s[2]*e+s[6]*n+s[10]*r+s[14])*u,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,s=t.x,u=t.y,h=t.z,o=t.w,m=o*e+u*r-h*n,y=o*n+h*e-s*r,x=o*r+s*n-u*e,M=-s*e-u*n-h*r;return this.x=m*o+M*-s+y*-h-x*-u,this.y=y*o+M*-u+x*-s-m*-h,this.z=x*o+M*-h+m*-u-y*-s,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r,this.y=s[1]*e+s[5]*n+s[9]*r,this.z=s[2]*e+s[6]*n+s[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var n=t.x,r=t.y,s=t.z,u=e.x,h=e.y,o=e.z;return this.x=r*o-s*h,this.y=s*u-n*o,this.z=n*h-r*u,this},projectOnVector:function(t){var e=t.lengthSq();if(e===0)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return H0.copy(this).projectOnVector(t),this.sub(H0)},reflect:function(t){return this.sub(H0.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;var n=this.dot(t)/e;return Math.acos(Xn.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,n){var r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,e*4)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,e*3)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}});var Uc=new kt,Uo=new Kn,b3=new kt(0,0,0),M3=new kt(1,1,1),xa=new kt,Jf=new kt,po=new kt;function Kn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Kn.prototype,{isMatrix4:!0,set:function(t,e,n,r,s,u,h,o,m,y,x,M,A,T,P,D){var k=this.elements;return k[0]=t,k[4]=e,k[8]=n,k[12]=r,k[1]=s,k[5]=u,k[9]=h,k[13]=o,k[2]=m,k[6]=y,k[10]=x,k[14]=M,k[3]=A,k[7]=T,k[11]=P,k[15]=D,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new Kn().fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,n=t.elements,r=1/Uc.setFromMatrixColumn(t,0).length(),s=1/Uc.setFromMatrixColumn(t,1).length(),u=1/Uc.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*u,e[9]=n[9]*u,e[10]=n[10]*u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,r=t.y,s=t.z,u=Math.cos(n),h=Math.sin(n),o=Math.cos(r),m=Math.sin(r),y=Math.cos(s),x=Math.sin(s);if(t.order==="XYZ"){var M=u*y,A=u*x,T=h*y,P=h*x;e[0]=o*y,e[4]=-o*x,e[8]=m,e[1]=A+T*m,e[5]=M-P*m,e[9]=-h*o,e[2]=P-M*m,e[6]=T+A*m,e[10]=u*o}else if(t.order==="YXZ"){var D=o*y,k=o*x,z=m*y,O=m*x;e[0]=D+O*h,e[4]=z*h-k,e[8]=u*m,e[1]=u*x,e[5]=u*y,e[9]=-h,e[2]=k*h-z,e[6]=O+D*h,e[10]=u*o}else if(t.order==="ZXY"){var D=o*y,k=o*x,z=m*y,O=m*x;e[0]=D-O*h,e[4]=-u*x,e[8]=z+k*h,e[1]=k+z*h,e[5]=u*y,e[9]=O-D*h,e[2]=-u*m,e[6]=h,e[10]=u*o}else if(t.order==="ZYX"){var M=u*y,A=u*x,T=h*y,P=h*x;e[0]=o*y,e[4]=T*m-A,e[8]=M*m+P,e[1]=o*x,e[5]=P*m+M,e[9]=A*m-T,e[2]=-m,e[6]=h*o,e[10]=u*o}else if(t.order==="YZX"){var U=u*o,H=u*m,V=h*o,W=h*m;e[0]=o*y,e[4]=W-U*x,e[8]=V*x+H,e[1]=x,e[5]=u*y,e[9]=-h*y,e[2]=-m*y,e[6]=H*x+V,e[10]=U-W*x}else if(t.order==="XZY"){var U=u*o,H=u*m,V=h*o,W=h*m;e[0]=o*y,e[4]=-x,e[8]=m*y,e[1]=U*x+W,e[5]=u*y,e[9]=H*x-V,e[2]=V*x-H,e[6]=h*y,e[10]=W*x+U}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(b3,t,M3)},lookAt:function(t,e,n){var r=this.elements;return po.subVectors(t,e),po.lengthSq()===0&&(po.z=1),po.normalize(),xa.crossVectors(n,po),xa.lengthSq()===0&&(Math.abs(n.z)===1?po.x+=1e-4:po.z+=1e-4,po.normalize(),xa.crossVectors(n,po)),xa.normalize(),Jf.crossVectors(po,xa),r[0]=xa.x,r[4]=Jf.x,r[8]=po.x,r[1]=xa.y,r[5]=Jf.y,r[9]=po.y,r[2]=xa.z,r[6]=Jf.z,r[10]=po.z,this},multiply:function(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,r=e.elements,s=this.elements,u=n[0],h=n[4],o=n[8],m=n[12],y=n[1],x=n[5],M=n[9],A=n[13],T=n[2],P=n[6],D=n[10],k=n[14],z=n[3],O=n[7],U=n[11],H=n[15],V=r[0],W=r[4],K=r[8],Z=r[12],tt=r[1],at=r[5],st=r[9],nt=r[13],ct=r[2],xt=r[6],vt=r[10],Zt=r[14],ce=r[3],le=r[7],fe=r[11],de=r[15];return s[0]=u*V+h*tt+o*ct+m*ce,s[4]=u*W+h*at+o*xt+m*le,s[8]=u*K+h*st+o*vt+m*fe,s[12]=u*Z+h*nt+o*Zt+m*de,s[1]=y*V+x*tt+M*ct+A*ce,s[5]=y*W+x*at+M*xt+A*le,s[9]=y*K+x*st+M*vt+A*fe,s[13]=y*Z+x*nt+M*Zt+A*de,s[2]=T*V+P*tt+D*ct+k*ce,s[6]=T*W+P*at+D*xt+k*le,s[10]=T*K+P*st+D*vt+k*fe,s[14]=T*Z+P*nt+D*Zt+k*de,s[3]=z*V+O*tt+U*ct+H*ce,s[7]=z*W+O*at+U*xt+H*le,s[11]=z*K+O*st+U*vt+H*fe,s[15]=z*Z+O*nt+U*Zt+H*de,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[4],r=t[8],s=t[12],u=t[1],h=t[5],o=t[9],m=t[13],y=t[2],x=t[6],M=t[10],A=t[14],T=t[3],P=t[7],D=t[11],k=t[15];return T*(+s*o*x-r*m*x-s*h*M+n*m*M+r*h*A-n*o*A)+P*(+e*o*A-e*m*M+s*u*M-r*u*A+r*m*y-s*o*y)+D*(+e*m*x-e*h*A-s*u*x+n*u*A+s*h*y-n*m*y)+k*(-r*h*y-e*o*x+e*h*M+r*u*x-n*u*M+n*o*y)},transpose:function(){var t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){var r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){var n=this.elements,r=t.elements,s=r[0],u=r[1],h=r[2],o=r[3],m=r[4],y=r[5],x=r[6],M=r[7],A=r[8],T=r[9],P=r[10],D=r[11],k=r[12],z=r[13],O=r[14],U=r[15],H=T*O*M-z*P*M+z*x*D-y*O*D-T*x*U+y*P*U,V=k*P*M-A*O*M-k*x*D+m*O*D+A*x*U-m*P*U,W=A*z*M-k*T*M+k*y*D-m*z*D-A*y*U+m*T*U,K=k*T*x-A*z*x-k*y*P+m*z*P+A*y*O-m*T*O,Z=s*H+u*V+h*W+o*K;if(Z===0){var tt="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(e===!0)throw new Error(tt);return console.warn(tt),this.identity()}var at=1/Z;return n[0]=H*at,n[1]=(z*P*o-T*O*o-z*h*D+u*O*D+T*h*U-u*P*U)*at,n[2]=(y*O*o-z*x*o+z*h*M-u*O*M-y*h*U+u*x*U)*at,n[3]=(T*x*o-y*P*o-T*h*M+u*P*M+y*h*D-u*x*D)*at,n[4]=V*at,n[5]=(A*O*o-k*P*o+k*h*D-s*O*D-A*h*U+s*P*U)*at,n[6]=(k*x*o-m*O*o-k*h*M+s*O*M+m*h*U-s*x*U)*at,n[7]=(m*P*o-A*x*o+A*h*M-s*P*M-m*h*D+s*x*D)*at,n[8]=W*at,n[9]=(k*T*o-A*z*o-k*u*D+s*z*D+A*u*U-s*T*U)*at,n[10]=(m*z*o-k*y*o+k*u*M-s*z*M-m*u*U+s*y*U)*at,n[11]=(A*y*o-m*T*o-A*u*M+s*T*M+m*u*D-s*y*D)*at,n[12]=K*at,n[13]=(A*z*h-k*T*h+k*u*P-s*z*P-A*u*O+s*T*O)*at,n[14]=(k*y*h-m*z*h-k*u*x+s*z*x+m*u*O-s*y*O)*at,n[15]=(m*T*h-A*y*h+A*u*x-s*T*x-m*u*P+s*y*P)*at,this},scale:function(t){var e=this.elements,n=t.x,r=t.y,s=t.z;return e[0]*=n,e[4]*=r,e[8]*=s,e[1]*=n,e[5]*=r,e[9]*=s,e[2]*=n,e[6]*=r,e[10]*=s,e[3]*=n,e[7]*=r,e[11]*=s,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),r=Math.sin(e),s=1-n,u=t.x,h=t.y,o=t.z,m=s*u,y=s*h;return this.set(m*u+n,m*h-r*o,m*o+r*h,0,m*h+r*o,y*h+n,y*o-r*u,0,m*o-r*h,y*o+r*u,s*o*o+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){var r=this.elements,s=e._x,u=e._y,h=e._z,o=e._w,m=s+s,y=u+u,x=h+h,M=s*m,A=s*y,T=s*x,P=u*y,D=u*x,k=h*x,z=o*m,O=o*y,U=o*x,H=n.x,V=n.y,W=n.z;return r[0]=(1-(P+k))*H,r[1]=(A+U)*H,r[2]=(T-O)*H,r[3]=0,r[4]=(A-U)*V,r[5]=(1-(M+k))*V,r[6]=(D+z)*V,r[7]=0,r[8]=(T+O)*W,r[9]=(D-z)*W,r[10]=(1-(M+P))*W,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){var r=this.elements,s=Uc.set(r[0],r[1],r[2]).length(),u=Uc.set(r[4],r[5],r[6]).length(),h=Uc.set(r[8],r[9],r[10]).length(),o=this.determinant();o<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],Uo.copy(this);var m=1/s,y=1/u,x=1/h;return Uo.elements[0]*=m,Uo.elements[1]*=m,Uo.elements[2]*=m,Uo.elements[4]*=y,Uo.elements[5]*=y,Uo.elements[6]*=y,Uo.elements[8]*=x,Uo.elements[9]*=x,Uo.elements[10]*=x,e.setFromRotationMatrix(Uo),n.x=s,n.y=u,n.z=h,this},makePerspective:function(t,e,n,r,s,u){u===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var h=this.elements,o=2*s/(e-t),m=2*s/(n-r),y=(e+t)/(e-t),x=(n+r)/(n-r),M=-(u+s)/(u-s),A=-2*u*s/(u-s);return h[0]=o,h[4]=0,h[8]=y,h[12]=0,h[1]=0,h[5]=m,h[9]=x,h[13]=0,h[2]=0,h[6]=0,h[10]=M,h[14]=A,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},makeOrthographic:function(t,e,n,r,s,u){var h=this.elements,o=1/(e-t),m=1/(n-r),y=1/(u-s),x=(e+t)*o,M=(n+r)*m,A=(u+s)*y;return h[0]=2*o,h[4]=0,h[8]=0,h[12]=-x,h[1]=0,h[5]=2*m,h[9]=0,h[13]=-M,h[2]=0,h[6]=0,h[10]=-2*y,h[14]=-A,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},fromArray:function(t,e){e===void 0&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});var Bb=new Kn,Fb=new Wr;function Vc(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._order=r||Vc.DefaultOrder}Vc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Vc.DefaultOrder="XYZ",Object.defineProperties(Vc.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(Vc.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var r=Xn.clamp,s=t.elements,u=s[0],h=s[4],o=s[8],m=s[1],y=s[5],x=s[9],M=s[2],A=s[6],T=s[10];return e=e||this._order,e==="XYZ"?(this._y=Math.asin(r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-x,T),this._z=Math.atan2(-h,u)):(this._x=Math.atan2(A,y),this._z=0)):e==="YXZ"?(this._x=Math.asin(-r(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(o,T),this._z=Math.atan2(m,y)):(this._y=Math.atan2(-M,u),this._z=0)):e==="ZXY"?(this._x=Math.asin(r(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(-M,T),this._z=Math.atan2(-h,y)):(this._y=0,this._z=Math.atan2(m,u))):e==="ZYX"?(this._y=Math.asin(-r(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(A,T),this._z=Math.atan2(m,u)):(this._x=0,this._z=Math.atan2(-h,y))):e==="YZX"?(this._z=Math.asin(r(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(-x,y),this._y=Math.atan2(-M,u)):(this._x=0,this._y=Math.atan2(o,T))):e==="XZY"?(this._z=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(A,y),this._y=Math.atan2(o,u)):(this._x=Math.atan2(-x,T),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,n!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,n){return Bb.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Bb,e,n)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return Fb.setFromEuler(this),this.setFromQuaternion(Fb,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new kt(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});function zb(){this.mask=1}Object.assign(zb.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return(this.mask&t.mask)!==0}});var w3=0,Nb=new kt,Gc=new Wr,Vs=new Kn,Qf=new kt,ed=new kt,A3=new kt,E3=new Wr,Ub=new kt(1,0,0),Vb=new kt(0,1,0),Gb=new kt(0,0,1),T3={type:"added"},P3={type:"removed"};function cn(){Object.defineProperty(this,"id",{value:w3++}),this.uuid=Xn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=cn.DefaultUp.clone();var t=new kt,e=new Vc,n=new Wr,r=new kt(1,1,1);function s(){n.setFromEuler(e,!1)}function u(){e.setFromQuaternion(n,void 0,!1)}e._onChange(s),n._onChange(u),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Kn},normalMatrix:{value:new _r}}),this.matrix=new Kn,this.matrixWorld=new Kn,this.matrixAutoUpdate=cn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new zb,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}cn.DefaultUp=new kt(0,1,0),cn.DefaultMatrixAutoUpdate=!0,cn.prototype=Object.assign(Object.create(Us.prototype),{constructor:cn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Gc.setFromAxisAngle(t,e),this.quaternion.multiply(Gc),this},rotateOnWorldAxis:function(t,e){return Gc.setFromAxisAngle(t,e),this.quaternion.premultiply(Gc),this},rotateX:function(t){return this.rotateOnAxis(Ub,t)},rotateY:function(t){return this.rotateOnAxis(Vb,t)},rotateZ:function(t){return this.rotateOnAxis(Gb,t)},translateOnAxis:function(t,e){return Nb.copy(t).applyQuaternion(this.quaternion),this.position.add(Nb.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(Ub,t)},translateY:function(t){return this.translateOnAxis(Vb,t)},translateZ:function(t){return this.translateOnAxis(Gb,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Vs.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?Qf.copy(t):Qf.set(t,e,n);var r=this.parent;this.updateWorldMatrix(!0,!1),ed.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vs.lookAt(ed,Qf,this.up):Vs.lookAt(Qf,ed,this.up),this.quaternion.setFromRotationMatrix(Vs),r&&(Vs.extractRotation(r.matrixWorld),Gc.setFromRotationMatrix(Vs),this.quaternion.premultiply(Gc.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(T3)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexOf(t);return n!==-1&&(t.parent=null,this.children.splice(n,1),t.dispatchEvent(P3)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),Vs.getInverse(this.matrixWorld),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Vs.multiply(t.parent.matrixWorld)),t.applyMatrix4(Vs),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var s=this.children[n],u=s.getObjectByProperty(t,e);if(u!==void 0)return u}},getWorldPosition:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new kt),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Wr),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ed,t,A3),t},getWorldScale:function(t){return t===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new kt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ed,E3,t),t},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new kt),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0)for(var r=this.children,s=0,u=r.length;s<u;s++)r[s].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON());function s(k,z){return k[z.uuid]===void 0&&(k[z.uuid]=z.toJSON(t)),z.uuid}if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(t.geometries,this.geometry);var u=this.geometry.parameters;if(u!==void 0&&u.shapes!==void 0){var h=u.shapes;if(Array.isArray(h))for(var o=0,m=h.length;o<m;o++){var y=h[o];s(t.shapes,y)}else s(t.shapes,h)}}if(this.material!==void 0)if(Array.isArray(this.material)){for(var x=[],o=0,m=this.material.length;o<m;o++)x.push(s(t.materials,this.material[o]));r.material=x}else r.material=s(t.materials,this.material);if(this.children.length>0){r.children=[];for(var o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(t).object)}if(e){var M=D(t.geometries),A=D(t.materials),T=D(t.textures),P=D(t.images),h=D(t.shapes);M.length>0&&(n.geometries=M),A.length>0&&(n.materials=A),T.length>0&&(n.textures=T),P.length>0&&(n.images=P),h.length>0&&(n.shapes=h)}return n.object=r,n;function D(k){var z=[];for(var O in k){var U=k[O];delete U.metadata,z.push(U)}return z}},clone:function(t){return new this.constructor().copy(this,t)},copy:function(t,e){if(e===void 0&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}});function Gs(){cn.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Gs.prototype=Object.assign(Object.create(cn.prototype),{constructor:Gs,isScene:!0,copy:function(t,e){return cn.prototype.copy.call(this,t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=cn.prototype.toJSON.call(this,t);return this.background!==null&&(e.object.background=this.background.toJSON(t)),this.environment!==null&&(e.object.environment=this.environment.toJSON(t)),this.fog!==null&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Os=[new kt,new kt,new kt,new kt,new kt,new kt,new kt,new kt],nd=new kt,$f=new Vo,Oc=new kt,jc=new kt,Hc=new kt,va=new kt,_a=new kt,bl=new kt,id=new kt,tm=new kt,em=new kt,Ml=new kt;function Vo(t,e){this.min=t!==void 0?t:new kt(1/0,1/0,1/0),this.max=e!==void 0?e:new kt(-1/0,-1/0,-1/0)}Object.assign(Vo.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,n=1/0,r=1/0,s=-1/0,u=-1/0,h=-1/0,o=0,m=t.length;o<m;o+=3){var y=t[o],x=t[o+1],M=t[o+2];y<e&&(e=y),x<n&&(n=x),M<r&&(r=M),y>s&&(s=y),x>u&&(u=x),M>h&&(h=M)}return this.min.set(e,n,r),this.max.set(s,u,h),this},setFromBufferAttribute:function(t){for(var e=1/0,n=1/0,r=1/0,s=-1/0,u=-1/0,h=-1/0,o=0,m=t.count;o<m;o++){var y=t.getX(o),x=t.getY(o),M=t.getZ(o);y<e&&(e=y),x<n&&(n=x),M<r&&(r=M),y>s&&(s=y),x>u&&(u=x),M>h&&(h=M)}return this.min.set(e,n,r),this.max.set(s,u,h),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var n=nd.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new kt),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new kt),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;e!==void 0&&(e.boundingBox===null&&e.computeBoundingBox(),$f.copy(e.boundingBox),$f.applyMatrix4(t.matrixWorld),this.expandByPoint($f.min),this.expandByPoint($f.max));for(var n=t.children,r=0,s=n.length;r<s;r++)this.expandByObject(n[r]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new kt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,nd),nd.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(id),tm.subVectors(this.max,id),Oc.subVectors(t.a,id),jc.subVectors(t.b,id),Hc.subVectors(t.c,id),va.subVectors(jc,Oc),_a.subVectors(Hc,jc),bl.subVectors(Oc,Hc);var e=[0,-va.z,va.y,0,-_a.z,_a.y,0,-bl.z,bl.y,va.z,0,-va.x,_a.z,0,-_a.x,bl.z,0,-bl.x,-va.y,va.x,0,-_a.y,_a.x,0,-bl.y,bl.x,0];return!W0(e,Oc,jc,Hc,tm)||(e=[1,0,0,0,1,0,0,0,1],!W0(e,Oc,jc,Hc,tm))?!1:(em.crossVectors(va,_a),e=[em.x,em.y,em.z],W0(e,Oc,jc,Hc,tm))},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new kt),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){var e=nd.copy(t).clamp(this.min,this.max);return e.sub(t).length()},getBoundingSphere:function(t){return t===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=this.getSize(nd).length()*.5,t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()?this:(Os[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Os[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Os[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Os[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Os[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Os[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Os[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Os[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Os),this)},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});function W0(t,e,n,r,s){var u,h;for(u=0,h=t.length-3;u<=h;u+=3){Ml.fromArray(t,u);var o=s.x*Math.abs(Ml.x)+s.y*Math.abs(Ml.y)+s.z*Math.abs(Ml.z),m=e.dot(Ml),y=n.dot(Ml),x=r.dot(Ml);if(Math.max(-Math.max(m,y,x),Math.min(m,y,x))>o)return!1}return!0}var S3=new Vo;function js(t,e){this.center=t!==void 0?t:new kt,this.radius=e!==void 0?e:0}Object.assign(js.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var n=this.center;e!==void 0?n.copy(e):S3.setFromPoints(t).getCenter(n);for(var r=0,s=0,u=t.length;s<u;s++)r=Math.max(r,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return e===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new kt),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return t===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new Vo),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Hs=new kt,q0=new kt,nm=new kt,ba=new kt,Y0=new kt,im=new kt,X0=new kt;function Wc(t,e){this.origin=t!==void 0?t:new kt,this.direction=e!==void 0?e:new kt(0,0,-1)}Object.assign(Wc.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return e===void 0&&(console.warn("THREE.Ray: .at() target is now required"),e=new kt),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Hs)),this},closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new kt),e.subVectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=Hs.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Hs.copy(this.direction).multiplyScalar(e).add(this.origin),Hs.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,r){q0.copy(t).add(e).multiplyScalar(.5),nm.copy(e).sub(t).normalize(),ba.copy(this.origin).sub(q0);var s=t.distanceTo(e)*.5,u=-this.direction.dot(nm),h=ba.dot(this.direction),o=-ba.dot(nm),m=ba.lengthSq(),y=Math.abs(1-u*u),x,M,A,T;if(y>0)if(x=u*o-h,M=u*h-o,T=s*y,x>=0)if(M>=-T)if(M<=T){var P=1/y;x*=P,M*=P,A=x*(x+u*M+2*h)+M*(u*x+M+2*o)+m}else M=s,x=Math.max(0,-(u*M+h)),A=-x*x+M*(M+2*o)+m;else M=-s,x=Math.max(0,-(u*M+h)),A=-x*x+M*(M+2*o)+m;else M<=-T?(x=Math.max(0,-(-u*s+h)),M=x>0?-s:Math.min(Math.max(-s,-o),s),A=-x*x+M*(M+2*o)+m):M<=T?(x=0,M=Math.min(Math.max(-s,-o),s),A=M*(M+2*o)+m):(x=Math.max(0,-(u*s+h)),M=x>0?s:Math.min(Math.max(-s,-o),s),A=-x*x+M*(M+2*o)+m);else M=u>0?-s:s,x=Math.max(0,-(u*M+h)),A=-x*x+M*(M+2*o)+m;return n&&n.copy(this.direction).multiplyScalar(x).add(this.origin),r&&r.copy(nm).multiplyScalar(M).add(q0),A},intersectSphere:function(t,e){Hs.subVectors(t.center,this.origin);var n=Hs.dot(this.direction),r=Hs.dot(Hs)-n*n,s=t.radius*t.radius;if(r>s)return null;var u=Math.sqrt(s-r),h=n-u,o=n+u;return h<0&&o<0?null:h<0?this.at(o,e):this.at(h,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return n===null?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);if(e===0)return!0;var n=t.normal.dot(this.direction);return n*e<0},intersectBox:function(t,e){var n,r,s,u,h,o,m=1/this.direction.x,y=1/this.direction.y,x=1/this.direction.z,M=this.origin;return m>=0?(n=(t.min.x-M.x)*m,r=(t.max.x-M.x)*m):(n=(t.max.x-M.x)*m,r=(t.min.x-M.x)*m),y>=0?(s=(t.min.y-M.y)*y,u=(t.max.y-M.y)*y):(s=(t.max.y-M.y)*y,u=(t.min.y-M.y)*y),n>u||s>r||((s>n||n!==n)&&(n=s),(u<r||r!==r)&&(r=u),x>=0?(h=(t.min.z-M.z)*x,o=(t.max.z-M.z)*x):(h=(t.max.z-M.z)*x,o=(t.min.z-M.z)*x),n>o||h>r)||((h>n||n!==n)&&(n=h),(o<r||r!==r)&&(r=o),r<0)?null:this.at(n>=0?n:r,e)},intersectsBox:function(t){return this.intersectBox(t,Hs)!==null},intersectTriangle:function(t,e,n,r,s){Y0.subVectors(e,t),im.subVectors(n,t),X0.crossVectors(Y0,im);var u=this.direction.dot(X0),h;if(u>0){if(r)return null;h=1}else if(u<0)h=-1,u=-u;else return null;ba.subVectors(this.origin,t);var o=h*this.direction.dot(im.crossVectors(ba,im));if(o<0)return null;var m=h*this.direction.dot(Y0.cross(ba));if(m<0||o+m>u)return null;var y=-h*ba.dot(X0);return y<0?null:this.at(y/u,s)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var K0=new kt,C3=new kt,D3=new _r;function as(t,e){this.normal=t!==void 0?t:new kt(1,0,0),this.constant=e!==void 0?e:0}Object.assign(as.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,n){var r=K0.subVectors(n,e).cross(C3.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return e===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new kt),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){e===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new kt);var n=t.delta(K0),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/r;if(!(s<0||s>1))return e.copy(n).multiplyScalar(s).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return t===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new kt),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var n=e||D3.getNormalMatrix(t),r=this.coplanarPoint(K0).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Go=new kt,Ws=new kt,Z0=new kt,qs=new kt,qc=new kt,Yc=new kt,Ob=new kt,J0=new kt,Q0=new kt,$0=new kt;function mr(t,e,n){this.a=t!==void 0?t:new kt,this.b=e!==void 0?e:new kt,this.c=n!==void 0?n:new kt}Object.assign(mr,{getNormal:function(t,e,n,r){r===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new kt),r.subVectors(n,e),Go.subVectors(t,e),r.cross(Go);var s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)},getBarycoord:function(t,e,n,r,s){Go.subVectors(r,e),Ws.subVectors(n,e),Z0.subVectors(t,e);var u=Go.dot(Go),h=Go.dot(Ws),o=Go.dot(Z0),m=Ws.dot(Ws),y=Ws.dot(Z0),x=u*m-h*h;if(s===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new kt),x===0)return s.set(-2,-1,-1);var M=1/x,A=(m*o-h*y)*M,T=(u*y-h*o)*M;return s.set(1-A-T,T,A)},containsPoint:function(t,e,n,r){return mr.getBarycoord(t,e,n,r,qs),qs.x>=0&&qs.y>=0&&qs.x+qs.y<=1},getUV:function(t,e,n,r,s,u,h,o){return this.getBarycoord(t,e,n,r,qs),o.set(0,0),o.addScaledVector(s,qs.x),o.addScaledVector(u,qs.y),o.addScaledVector(h,qs.z),o},isFrontFacing:function(t,e,n,r){return Go.subVectors(n,e),Ws.subVectors(t,e),Go.cross(Ws).dot(r)<0}}),Object.assign(mr.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Go.subVectors(this.c,this.b),Ws.subVectors(this.a,this.b),Go.cross(Ws).length()*.5},getMidpoint:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new kt),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return mr.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return t===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new as),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return mr.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,r,s){return mr.getUV(t,this.a,this.b,this.c,e,n,r,s)},containsPoint:function(t){return mr.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return mr.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){e===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new kt);var n=this.a,r=this.b,s=this.c,u,h;qc.subVectors(r,n),Yc.subVectors(s,n),J0.subVectors(t,n);var o=qc.dot(J0),m=Yc.dot(J0);if(o<=0&&m<=0)return e.copy(n);Q0.subVectors(t,r);var y=qc.dot(Q0),x=Yc.dot(Q0);if(y>=0&&x<=y)return e.copy(r);var M=o*x-y*m;if(M<=0&&o>=0&&y<=0)return u=o/(o-y),e.copy(n).addScaledVector(qc,u);$0.subVectors(t,s);var A=qc.dot($0),T=Yc.dot($0);if(T>=0&&A<=T)return e.copy(s);var P=A*m-o*T;if(P<=0&&m>=0&&T<=0)return h=m/(m-T),e.copy(n).addScaledVector(Yc,h);var D=y*T-A*x;if(D<=0&&x-y>=0&&A-T>=0)return Ob.subVectors(s,r),h=(x-y)/(x-y+(A-T)),e.copy(r).addScaledVector(Ob,h);var k=1/(D+P+M);return u=P*k,h=M*k,e.copy(n).addScaledVector(qc,u).addScaledVector(Yc,h)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var jb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Oo={h:0,s:0,l:0},rm={h:0,s:0,l:0};function sn(t,e,n){return e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}function tx(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}function ex(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function nx(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}Object.assign(sn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(t,e,n){if(t=Xn.euclideanModulo(t,1),e=Xn.clamp(e,0,1),n=Xn.clamp(n,0,1),e===0)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,s=2*n-r;this.r=tx(s,r,t+1/3),this.g=tx(s,r,t),this.b=tx(s,r,t-1/3)}return this},setStyle:function(t){function e(M){M!==void 0&&parseFloat(M)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,s=n[1],u=n[2];switch(s){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(u))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,e(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(u))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,e(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(u)){var h=parseFloat(r[1])/360,o=parseInt(r[2],10)/100,m=parseInt(r[3],10)/100;return e(r[5]),this.setHSL(h,o,m)}break}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var y=n[1],x=y.length;if(x===3)return this.r=parseInt(y.charAt(0)+y.charAt(0),16)/255,this.g=parseInt(y.charAt(1)+y.charAt(1),16)/255,this.b=parseInt(y.charAt(2)+y.charAt(2),16)/255,this;if(x===6)return this.r=parseInt(y.charAt(0)+y.charAt(1),16)/255,this.g=parseInt(y.charAt(2)+y.charAt(3),16)/255,this.b=parseInt(y.charAt(4)+y.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=jb[t];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return e===void 0&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){e===void 0&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=ex(t.r),this.g=ex(t.g),this.b=ex(t.b),this},copyLinearToSRGB:function(t){return this.r=nx(t.r),this.g=nx(t.g),this.b=nx(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){t===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e=this.r,n=this.g,r=this.b,s=Math.max(e,n,r),u=Math.min(e,n,r),h,o,m=(u+s)/2;if(u===s)h=0,o=0;else{var y=s-u;switch(o=m<=.5?y/(s+u):y/(2-s-u),s){case e:h=(n-r)/y+(n<r?6:0);break;case n:h=(r-e)/y+2;break;case r:h=(e-n)/y+4;break}h/=6}return t.h=h,t.s=o,t.l=m,t},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(t,e,n){return this.getHSL(Oo),Oo.h+=t,Oo.s+=e,Oo.l+=n,this.setHSL(Oo.h,Oo.s,Oo.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(Oo),t.getHSL(rm);var n=Xn.lerp(Oo.h,rm.h,e),r=Xn.lerp(Oo.s,rm.s,e),s=Xn.lerp(Oo.l,rm.l,e);return this.setHSL(n,r,s),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return e===void 0&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),sn.NAMES=jb;function om(t,e,n,r,s,u){this.a=t,this.b=e,this.c=n,this.normal=r&&r.isVector3?r:new kt,this.vertexNormals=Array.isArray(r)?r:[],this.color=s&&s.isColor?s:new sn,this.vertexColors=Array.isArray(s)?s:[],this.materialIndex=u!==void 0?u:0}Object.assign(om.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var R3=0;function zn(){Object.defineProperty(this,"id",{value:R3++}),this.uuid=Xn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=qh,this.side=Dc,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=cb,this.opacity=1,this.transparent=!1,this.blendSrc=mb,this.blendDst=gb,this.blendEquation=Lc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=L0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=v3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=j0,this.stencilZFail=j0,this.stencilZPass=j0,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}zn.prototype=Object.assign(Object.create(Us.prototype),{constructor:zn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(t!==void 0)for(var e in t){var n=t[e];if(n===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===lb;continue}var r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n}},toJSON:function(t){var e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,this.combine!==void 0&&(n.combine=this.combine),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.size!==void 0&&(n.size=this.size),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==qh&&(n.blending=this.blending),this.flatShading===!0&&(n.flatShading=this.flatShading),this.side!==Dc&&(n.side=this.side),this.vertexColors!==cb&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(n.morphTargets=!0),this.morphNormals===!0&&(n.morphNormals=!0),this.skinning===!0&&(n.skinning=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(h){var o=[];for(var m in h){var y=h[m];delete y.metadata,o.push(y)}return o}if(e){var s=r(t.textures),u=r(t.images);s.length>0&&(n.textures=s),u.length>0&&(n.images=u)}return n},clone:function(){return new this.constructor().copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexTangents=t.vertexTangents,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,n=null;if(e!==null){var r=e.length;n=new Array(r);for(var s=0;s!==r;++s)n[s]=e[s].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(zn.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}});function gr(t){zn.call(this),this.type="MeshBasicMaterial",this.color=new sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Of,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}gr.prototype=Object.create(zn.prototype),gr.prototype.constructor=gr,gr.prototype.isMeshBasicMaterial=!0,gr.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var vi=new kt;function Nn(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n===!0,this.usage=Zf,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Nn.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),Object.assign(Nn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var r=0,s=this.itemSize;r<s;r++)this.array[t+r]=e.array[n+r];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,r=0,s=t.length;r<s;r++){var u=t[r];u===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),u=new sn),e[n++]=u.r,e[n++]=u.g,e[n++]=u.b}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,r=0,s=t.length;r<s;r++){var u=t[r];u===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),u=new ke),e[n++]=u.x,e[n++]=u.y}return this},copyVector3sArray:function(t){for(var e=this.array,n=0,r=0,s=t.length;r<s;r++){var u=t[r];u===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),u=new kt),e[n++]=u.x,e[n++]=u.y,e[n++]=u.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,r=0,s=t.length;r<s;r++){var u=t[r];u===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),u=new Mi),e[n++]=u.x,e[n++]=u.y,e[n++]=u.z,e[n++]=u.w}return this},applyMatrix3:function(t){for(var e=0,n=this.count;e<n;e++)vi.x=this.getX(e),vi.y=this.getY(e),vi.z=this.getZ(e),vi.applyMatrix3(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this},applyMatrix4:function(t){for(var e=0,n=this.count;e<n;e++)vi.x=this.getX(e),vi.y=this.getY(e),vi.z=this.getZ(e),vi.applyMatrix4(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this},applyNormalMatrix:function(t){for(var e=0,n=this.count;e<n;e++)vi.x=this.getX(e),vi.y=this.getY(e),vi.z=this.getZ(e),vi.applyNormalMatrix(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this},transformDirection:function(t){for(var e=0,n=this.count;e<n;e++)vi.x=this.getX(e),vi.y=this.getY(e),vi.z=this.getZ(e),vi.transformDirection(t),this.setXYZ(e,vi.x,vi.y,vi.z);return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=s,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function ix(t,e,n){Nn.call(this,new Int8Array(t),e,n)}ix.prototype=Object.create(Nn.prototype),ix.prototype.constructor=ix;function rx(t,e,n){Nn.call(this,new Uint8Array(t),e,n)}rx.prototype=Object.create(Nn.prototype),rx.prototype.constructor=rx;function ox(t,e,n){Nn.call(this,new Uint8ClampedArray(t),e,n)}ox.prototype=Object.create(Nn.prototype),ox.prototype.constructor=ox;function sx(t,e,n){Nn.call(this,new Int16Array(t),e,n)}sx.prototype=Object.create(Nn.prototype),sx.prototype.constructor=sx;function rd(t,e,n){Nn.call(this,new Uint16Array(t),e,n)}rd.prototype=Object.create(Nn.prototype),rd.prototype.constructor=rd;function ax(t,e,n){Nn.call(this,new Int32Array(t),e,n)}ax.prototype=Object.create(Nn.prototype),ax.prototype.constructor=ax;function od(t,e,n){Nn.call(this,new Uint32Array(t),e,n)}od.prototype=Object.create(Nn.prototype),od.prototype.constructor=od;function dn(t,e,n){Nn.call(this,new Float32Array(t),e,n)}dn.prototype=Object.create(Nn.prototype),dn.prototype.constructor=dn;function lx(t,e,n){Nn.call(this,new Float64Array(t),e,n)}lx.prototype=Object.create(Nn.prototype),lx.prototype.constructor=lx;function Hb(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(Hb.prototype,{computeGroups:function(t){for(var e,n=[],r=void 0,s=t.faces,u=0;u<s.length;u++){var h=s[u];h.materialIndex!==r&&(r=h.materialIndex,e!==void 0&&(e.count=u*3-e.start,n.push(e)),e={start:u*3,materialIndex:r})}e!==void 0&&(e.count=u*3-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e=t.faces,n=t.vertices,r=t.faceVertexUvs,s=r[0]&&r[0].length>0,u=r[1]&&r[1].length>0,h=t.morphTargets,o=h.length,m;if(o>0){m=[];for(var y=0;y<o;y++)m[y]={name:h[y].name,data:[]};this.morphTargets.position=m}var x=t.morphNormals,M=x.length,A;if(M>0){A=[];for(var y=0;y<M;y++)A[y]={name:x[y].name,data:[]};this.morphTargets.normal=A}var T=t.skinIndices,P=t.skinWeights,D=T.length===n.length,k=P.length===n.length;n.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var y=0;y<e.length;y++){var z=e[y];this.vertices.push(n[z.a],n[z.b],n[z.c]);var O=z.vertexNormals;if(O.length===3)this.normals.push(O[0],O[1],O[2]);else{var U=z.normal;this.normals.push(U,U,U)}var H=z.vertexColors;if(H.length===3)this.colors.push(H[0],H[1],H[2]);else{var V=z.color;this.colors.push(V,V,V)}if(s===!0){var W=r[0][y];W!==void 0?this.uvs.push(W[0],W[1],W[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",y),this.uvs.push(new ke,new ke,new ke))}if(u===!0){var W=r[1][y];W!==void 0?this.uvs2.push(W[0],W[1],W[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",y),this.uvs2.push(new ke,new ke,new ke))}for(var K=0;K<o;K++){var Z=h[K].vertices;m[K].data.push(Z[z.a],Z[z.b],Z[z.c])}for(var K=0;K<M;K++){var tt=x[K].vertexNormals[y];A[K].data.push(tt.a,tt.b,tt.c)}D&&this.skinIndices.push(T[z.a],T[z.b],T[z.c]),k&&this.skinWeights.push(P[z.a],P[z.b],P[z.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}});function Wb(t){if(t.length===0)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}var L3=1,ls=new Kn,cx=new cn,Xc=new kt,fo=new Vo,sd=new Vo,tr=new kt;function wn(){Object.defineProperty(this,"id",{value:L3+=2}),this.uuid=Xn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}wn.prototype=Object.assign(Object.create(Us.prototype),{constructor:wn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Wb(t)>65535?od:rd)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:n!==void 0?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);var n=this.attributes.normal;if(n!==void 0){var r=new _r().getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}var s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(t){return ls.makeRotationX(t),this.applyMatrix4(ls),this},rotateY:function(t){return ls.makeRotationY(t),this.applyMatrix4(ls),this},rotateZ:function(t){return ls.makeRotationZ(t),this.applyMatrix4(ls),this},translate:function(t,e,n){return ls.makeTranslation(t,e,n),this.applyMatrix4(ls),this},scale:function(t,e,n){return ls.makeScale(t,e,n),this.applyMatrix4(ls),this},lookAt:function(t){return cx.lookAt(t),cx.updateMatrix(),this.applyMatrix4(cx.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Xc).negate(),this.translate(Xc.x,Xc.y,Xc.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new dn(e.vertices.length*3,3),r=new dn(e.colors.length*3,3);if(this.setAttribute("position",n.copyVector3sArray(e.vertices)),this.setAttribute("color",r.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var s=new dn(e.lineDistances.length,1);this.setAttribute("lineDistance",s.copyArray(e.lineDistances))}e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var s=t[n];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new dn(e,3)),this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var n=e.__directGeometry;if(e.elementsNeedUpdate===!0&&(n=void 0,e.elementsNeedUpdate=!1),n===void 0)return this.fromGeometry(e);n.verticesNeedUpdate=e.verticesNeedUpdate,n.normalsNeedUpdate=e.normalsNeedUpdate,n.colorsNeedUpdate=e.colorsNeedUpdate,n.uvsNeedUpdate=e.uvsNeedUpdate,n.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=n}var r;return e.verticesNeedUpdate===!0&&(r=this.attributes.position,r!==void 0&&(r.copyVector3sArray(e.vertices),r.needsUpdate=!0),e.verticesNeedUpdate=!1),e.normalsNeedUpdate===!0&&(r=this.attributes.normal,r!==void 0&&(r.copyVector3sArray(e.normals),r.needsUpdate=!0),e.normalsNeedUpdate=!1),e.colorsNeedUpdate===!0&&(r=this.attributes.color,r!==void 0&&(r.copyColorsArray(e.colors),r.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(r=this.attributes.uv,r!==void 0&&(r.copyVector2sArray(e.uvs),r.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(r=this.attributes.lineDistance,r!==void 0&&(r.copyArray(e.lineDistances),r.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=new Hb().fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(t.vertices.length*3);if(this.setAttribute("position",new Nn(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(t.normals.length*3);this.setAttribute("normal",new Nn(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var r=new Float32Array(t.colors.length*3);this.setAttribute("color",new Nn(r,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var s=new Float32Array(t.uvs.length*2);this.setAttribute("uv",new Nn(s,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var u=new Float32Array(t.uvs2.length*2);this.setAttribute("uv2",new Nn(u,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(var h in t.morphTargets){for(var o=[],m=t.morphTargets[h],y=0,x=m.length;y<x;y++){var M=m[y],A=new dn(M.data.length*3,3);A.name=M.name,o.push(A.copyVector3sArray(M.data))}this.morphAttributes[h]=o}if(t.skinIndices.length>0){var T=new dn(t.skinIndices.length*4,4);this.setAttribute("skinIndex",T.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var P=new dn(t.skinWeights.length*4,4);this.setAttribute("skinWeight",P.copyVector4sArray(t.skinWeights))}return t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Vo);var t=this.attributes.position,e=this.morphAttributes.position;if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(var n=0,r=e.length;n<r;n++){var s=e[n];fo.setFromBufferAttribute(s),this.morphTargetsRelative?(tr.addVectors(this.boundingBox.min,fo.min),this.boundingBox.expandByPoint(tr),tr.addVectors(this.boundingBox.max,fo.max),this.boundingBox.expandByPoint(tr)):(this.boundingBox.expandByPoint(fo.min),this.boundingBox.expandByPoint(fo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new js);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var n=this.boundingSphere.center;if(fo.setFromBufferAttribute(t),e)for(var r=0,s=e.length;r<s;r++){var u=e[r];sd.setFromBufferAttribute(u),this.morphTargetsRelative?(tr.addVectors(fo.min,sd.min),fo.expandByPoint(tr),tr.addVectors(fo.max,sd.max),fo.expandByPoint(tr)):(fo.expandByPoint(sd.min),fo.expandByPoint(sd.max))}fo.getCenter(n);for(var h=0,r=0,s=t.count;r<s;r++)tr.fromBufferAttribute(t,r),h=Math.max(h,n.distanceToSquared(tr));if(e)for(var r=0,s=e.length;r<s;r++)for(var u=e[r],o=this.morphTargetsRelative,m=0,y=u.count;m<y;m++)tr.fromBufferAttribute(u,m),o&&(Xc.fromBufferAttribute(t,m),tr.add(Xc)),h=Math.max(h,n.distanceToSquared(tr));this.boundingSphere.radius=Math.sqrt(h),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var n=e.position.array;if(e.normal===void 0)this.setAttribute("normal",new Nn(new Float32Array(n.length),3));else for(var r=e.normal.array,s=0,u=r.length;s<u;s++)r[s]=0;var h=e.normal.array,o,m,y,x=new kt,M=new kt,A=new kt,T=new kt,P=new kt;if(t)for(var D=t.array,s=0,u=t.count;s<u;s+=3)o=D[s+0]*3,m=D[s+1]*3,y=D[s+2]*3,x.fromArray(n,o),M.fromArray(n,m),A.fromArray(n,y),T.subVectors(A,M),P.subVectors(x,M),T.cross(P),h[o]+=T.x,h[o+1]+=T.y,h[o+2]+=T.z,h[m]+=T.x,h[m+1]+=T.y,h[m+2]+=T.z,h[y]+=T.x,h[y+1]+=T.y,h[y+2]+=T.z;else for(var s=0,u=n.length;s<u;s+=9)x.fromArray(n,s),M.fromArray(n,s+3),A.fromArray(n,s+6),T.subVectors(A,M),P.subVectors(x,M),T.cross(P),h[s]=T.x,h[s+1]=T.y,h[s+2]=T.z,h[s+3]=T.x,h[s+4]=T.y,h[s+5]=T.z,h[s+6]=T.x,h[s+7]=T.y,h[s+8]=T.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(t.attributes[r]!==void 0)for(var s=n[r],u=s.array,h=t.attributes[r],o=h.array,m=h.itemSize*e,y=Math.min(o.length,u.length-m),x=0,M=m;x<y;x++,M++)u[M]=o[x];return this},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)tr.x=t.getX(e),tr.y=t.getY(e),tr.z=t.getZ(e),tr.normalize(),t.setXYZ(e,tr.x,tr.y,tr.z)},toNonIndexed:function(){function t(D,k){for(var z=D.array,O=D.itemSize,U=new z.constructor(k.length*O),H=0,V=0,W=0,K=k.length;W<K;W++){H=k[W]*O;for(var Z=0;Z<O;Z++)U[V++]=z[H++]}return new Nn(U,O)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new wn,n=this.index.array,r=this.attributes;for(var s in r){var u=r[s],h=t(u,n);e.setAttribute(s,h)}var o=this.morphAttributes;for(s in o){for(var m=[],y=o[s],x=0,M=y.length;x<M;x++){var u=y[x],h=t(u,n);m.push(h)}e.morphAttributes[s]=m}e.morphTargetsRelative=this.morphTargetsRelative;for(var A=this.groups,x=0,T=A.length;x<T;x++){var P=A[x];e.addGroup(P.start,P.count,P.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){var e=this.parameters;for(var n in e)e[n]!==void 0&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;r!==null&&(t.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var s=this.attributes;for(var n in s){var u=s[n],h=u.toJSON();u.name!==""&&(h.name=u.name),t.data.attributes[n]=h}var o={},m=!1;for(var n in this.morphAttributes){for(var y=this.morphAttributes[n],x=[],M=0,A=y.length;M<A;M++){var u=y[M],h=u.toJSON();u.name!==""&&(h.name=u.name),x.push(h)}x.length>0&&(o[n]=x,m=!0)}m&&(t.data.morphAttributes=o,t.data.morphTargetsRelative=this.morphTargetsRelative);var T=this.groups;T.length>0&&(t.data.groups=JSON.parse(JSON.stringify(T)));var P=this.boundingSphere;return P!==null&&(t.data.boundingSphere={center:P.center.toArray(),radius:P.radius}),t},clone:function(){return new wn().copy(this)},copy:function(t){var e,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.index;s!==null&&this.setIndex(s.clone());var u=t.attributes;for(e in u){var h=u[e];this.setAttribute(e,h.clone())}var o=t.morphAttributes;for(e in o){var m=[],y=o[e];for(n=0,r=y.length;n<r;n++)m.push(y[n].clone());this.morphAttributes[e]=m}this.morphTargetsRelative=t.morphTargetsRelative;var x=t.groups;for(n=0,r=x.length;n<r;n++){var M=x[n];this.addGroup(M.start,M.count,M.materialIndex)}var A=t.boundingBox;A!==null&&(this.boundingBox=A.clone());var T=t.boundingSphere;return T!==null&&(this.boundingSphere=T.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var qb=new Kn,wl=new Wc,ux=new js,Al=new kt,El=new kt,Tl=new kt,hx=new kt,dx=new kt,px=new kt,sm=new kt,am=new kt,lm=new kt,Kc=new ke,Zc=new ke,Jc=new ke,ad=new kt,cm=new kt;function ki(t,e){cn.call(this),this.type="Mesh",this.geometry=t!==void 0?t:new wn,this.material=e!==void 0?e:new gr,this.updateMorphTargets()}ki.prototype=Object.assign(Object.create(cn.prototype),{constructor:ki,isMesh:!0,copy:function(t){return cn.prototype.copy.call(this,t),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t=this.geometry,e,n,r;if(t.isBufferGeometry){var s=t.morphAttributes,u=Object.keys(s);if(u.length>0){var h=s[u[0]];if(h!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,n=h.length;e<n;e++)r=h[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var o=t.morphTargets;o!==void 0&&o.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var n=this.geometry,r=this.material,s=this.matrixWorld;if(r!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),ux.copy(n.boundingSphere),ux.applyMatrix4(s),t.ray.intersectsSphere(ux)!==!1&&(qb.getInverse(s),wl.copy(t.ray).applyMatrix4(qb),!(n.boundingBox!==null&&wl.intersectsBox(n.boundingBox)===!1)))){var u;if(n.isBufferGeometry){var h,o,m,y=n.index,x=n.attributes.position,M=n.morphAttributes.position,A=n.morphTargetsRelative,T=n.attributes.uv,P=n.attributes.uv2,D=n.groups,k=n.drawRange,z,O,U,H,V,W,K,Z;if(y!==null)if(Array.isArray(r))for(z=0,U=D.length;z<U;z++)for(V=D[z],W=r[V.materialIndex],K=Math.max(V.start,k.start),Z=Math.min(V.start+V.count,k.start+k.count),O=K,H=Z;O<H;O+=3)h=y.getX(O),o=y.getX(O+1),m=y.getX(O+2),u=um(this,W,t,wl,x,M,A,T,P,h,o,m),u&&(u.faceIndex=Math.floor(O/3),u.face.materialIndex=V.materialIndex,e.push(u));else for(K=Math.max(0,k.start),Z=Math.min(y.count,k.start+k.count),z=K,U=Z;z<U;z+=3)h=y.getX(z),o=y.getX(z+1),m=y.getX(z+2),u=um(this,r,t,wl,x,M,A,T,P,h,o,m),u&&(u.faceIndex=Math.floor(z/3),e.push(u));else if(x!==void 0)if(Array.isArray(r))for(z=0,U=D.length;z<U;z++)for(V=D[z],W=r[V.materialIndex],K=Math.max(V.start,k.start),Z=Math.min(V.start+V.count,k.start+k.count),O=K,H=Z;O<H;O+=3)h=O,o=O+1,m=O+2,u=um(this,W,t,wl,x,M,A,T,P,h,o,m),u&&(u.faceIndex=Math.floor(O/3),u.face.materialIndex=V.materialIndex,e.push(u));else for(K=Math.max(0,k.start),Z=Math.min(x.count,k.start+k.count),z=K,U=Z;z<U;z+=3)h=z,o=z+1,m=z+2,u=um(this,r,t,wl,x,M,A,T,P,h,o,m),u&&(u.faceIndex=Math.floor(z/3),e.push(u))}else if(n.isGeometry){var tt,at,st,nt=Array.isArray(r),ct=n.vertices,xt=n.faces,vt,Zt=n.faceVertexUvs[0];Zt.length>0&&(vt=Zt);for(var ce=0,le=xt.length;ce<le;ce++){var fe=xt[ce],de=nt?r[fe.materialIndex]:r;if(de!==void 0&&(tt=ct[fe.a],at=ct[fe.b],st=ct[fe.c],u=Yb(this,de,t,wl,tt,at,st,ad),u)){if(vt&&vt[ce]){var Le=vt[ce];Kc.copy(Le[0]),Zc.copy(Le[1]),Jc.copy(Le[2]),u.uv=mr.getUV(ad,tt,at,st,Kc,Zc,Jc,new ke)}u.face=fe,u.faceIndex=ce,e.push(u)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function Yb(t,e,n,r,s,u,h,o){var m;if(e.side===lr?m=r.intersectTriangle(h,u,s,!0,o):m=r.intersectTriangle(s,u,h,e.side!==Wh,o),m===null)return null;cm.copy(o),cm.applyMatrix4(t.matrixWorld);var y=n.ray.origin.distanceTo(cm);return y<n.near||y>n.far?null:{distance:y,point:cm.clone(),object:t}}function um(t,e,n,r,s,u,h,o,m,y,x,M){Al.fromBufferAttribute(s,y),El.fromBufferAttribute(s,x),Tl.fromBufferAttribute(s,M);var A=t.morphTargetInfluences;if(e.morphTargets&&u&&A){sm.set(0,0,0),am.set(0,0,0),lm.set(0,0,0);for(var T=0,P=u.length;T<P;T++){var D=A[T],k=u[T];D!==0&&(hx.fromBufferAttribute(k,y),dx.fromBufferAttribute(k,x),px.fromBufferAttribute(k,M),h?(sm.addScaledVector(hx,D),am.addScaledVector(dx,D),lm.addScaledVector(px,D)):(sm.addScaledVector(hx.sub(Al),D),am.addScaledVector(dx.sub(El),D),lm.addScaledVector(px.sub(Tl),D)))}Al.add(sm),El.add(am),Tl.add(lm)}var z=Yb(t,e,n,r,Al,El,Tl,ad);if(z){o&&(Kc.fromBufferAttribute(o,y),Zc.fromBufferAttribute(o,x),Jc.fromBufferAttribute(o,M),z.uv=mr.getUV(ad,Al,El,Tl,Kc,Zc,Jc,new ke)),m&&(Kc.fromBufferAttribute(m,y),Zc.fromBufferAttribute(m,x),Jc.fromBufferAttribute(m,M),z.uv2=mr.getUV(ad,Al,El,Tl,Kc,Zc,Jc,new ke));var O=new om(y,x,M);mr.getNormal(Al,El,Tl,O.normal),z.face=O}return z}var I3=0,cs=new Kn,fx=new cn,hm=new kt;function Gn(){Object.defineProperty(this,"id",{value:I3+=2}),this.uuid=Xn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Gn.prototype=Object.assign(Object.create(Us.prototype),{constructor:Gn,isGeometry:!0,applyMatrix4:function(t){for(var e=new _r().getNormalMatrix(t),n=0,r=this.vertices.length;n<r;n++){var s=this.vertices[n];s.applyMatrix4(t)}for(var n=0,r=this.faces.length;n<r;n++){var u=this.faces[n];u.normal.applyMatrix3(e).normalize();for(var h=0,o=u.vertexNormals.length;h<o;h++)u.vertexNormals[h].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return cs.makeRotationX(t),this.applyMatrix4(cs),this},rotateY:function(t){return cs.makeRotationY(t),this.applyMatrix4(cs),this},rotateZ:function(t){return cs.makeRotationZ(t),this.applyMatrix4(cs),this},translate:function(t,e,n){return cs.makeTranslation(t,e,n),this.applyMatrix4(cs),this},scale:function(t,e,n){return cs.makeScale(t,e,n),this.applyMatrix4(cs),this},lookAt:function(t){return fx.lookAt(t),fx.updateMatrix(),this.applyMatrix4(fx.matrix),this},fromBufferGeometry:function(t){var e=this,n=t.index!==null?t.index.array:void 0,r=t.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var s=r.position.array,u=r.normal!==void 0?r.normal.array:void 0,h=r.color!==void 0?r.color.array:void 0,o=r.uv!==void 0?r.uv.array:void 0,m=r.uv2!==void 0?r.uv2.array:void 0;m!==void 0&&(this.faceVertexUvs[1]=[]);for(var y=0;y<s.length;y+=3)e.vertices.push(new kt().fromArray(s,y)),h!==void 0&&e.colors.push(new sn().fromArray(h,y));function x(z,O,U,H){var V=h===void 0?[]:[e.colors[z].clone(),e.colors[O].clone(),e.colors[U].clone()],W=u===void 0?[]:[new kt().fromArray(u,z*3),new kt().fromArray(u,O*3),new kt().fromArray(u,U*3)],K=new om(z,O,U,W,V,H);e.faces.push(K),o!==void 0&&e.faceVertexUvs[0].push([new ke().fromArray(o,z*2),new ke().fromArray(o,O*2),new ke().fromArray(o,U*2)]),m!==void 0&&e.faceVertexUvs[1].push([new ke().fromArray(m,z*2),new ke().fromArray(m,O*2),new ke().fromArray(m,U*2)])}var M=t.groups;if(M.length>0)for(var y=0;y<M.length;y++)for(var A=M[y],T=A.start,P=A.count,D=T,k=T+P;D<k;D+=3)n!==void 0?x(n[D],n[D+1],n[D+2],A.materialIndex):x(D,D+1,D+2,A.materialIndex);else if(n!==void 0)for(var y=0;y<n.length;y+=3)x(n[y],n[y+1],n[y+2]);else for(var y=0;y<s.length/3;y+=3)x(y,y+1,y+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(hm).negate(),this.translate(hm.x,hm.y,hm.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=e===0?1:1/e,r=new Kn;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var t=new kt,e=new kt,n=0,r=this.faces.length;n<r;n++){var s=this.faces[n],u=this.vertices[s.a],h=this.vertices[s.b],o=this.vertices[s.c];t.subVectors(o,h),e.subVectors(u,h),t.cross(e),t.normalize(),s.normal.copy(t)}},computeVertexNormals:function(t){t===void 0&&(t=!0);var e,n,r,s,u,h;for(h=new Array(this.vertices.length),e=0,n=this.vertices.length;e<n;e++)h[e]=new kt;if(t){var o,m,y,x=new kt,M=new kt;for(r=0,s=this.faces.length;r<s;r++)u=this.faces[r],o=this.vertices[u.a],m=this.vertices[u.b],y=this.vertices[u.c],x.subVectors(y,m),M.subVectors(o,m),x.cross(M),h[u.a].add(x),h[u.b].add(x),h[u.c].add(x)}else for(this.computeFaceNormals(),r=0,s=this.faces.length;r<s;r++)u=this.faces[r],h[u.a].add(u.normal),h[u.b].add(u.normal),h[u.c].add(u.normal);for(e=0,n=this.vertices.length;e<n;e++)h[e].normalize();for(r=0,s=this.faces.length;r<s;r++){u=this.faces[r];var A=u.vertexNormals;A.length===3?(A[0].copy(h[u.a]),A[1].copy(h[u.b]),A[2].copy(h[u.c])):(A[0]=h[u.a].clone(),A[1]=h[u.b].clone(),A[2]=h[u.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){n=this.faces[t];var r=n.vertexNormals;r.length===3?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,n,r,s;for(n=0,r=this.faces.length;n<r;n++)for(s=this.faces[n],s.__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]),t=0,e=s.vertexNormals.length;t<e;t++)s.__originalVertexNormals[t]?s.__originalVertexNormals[t].copy(s.vertexNormals[t]):s.__originalVertexNormals[t]=s.vertexNormals[t].clone();var u=new Gn;for(u.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var h=this.morphNormals[t].faceNormals,o=this.morphNormals[t].vertexNormals,y,x;for(n=0,r=this.faces.length;n<r;n++)y=new kt,x={a:new kt,b:new kt,c:new kt},h.push(y),o.push(x)}var m=this.morphNormals[t];u.vertices=this.morphTargets[t].vertices,u.computeFaceNormals(),u.computeVertexNormals();var y,x;for(n=0,r=this.faces.length;n<r;n++)s=this.faces[n],y=m.faceNormals[n],x=m.vertexNormals[n],y.copy(s.normal),x.a.copy(s.vertexNormals[0]),x.b.copy(s.vertexNormals[1]),x.c.copy(s.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)s=this.faces[n],s.normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Vo),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new js),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}var r,s=this.vertices.length,u=this.vertices,h=t.vertices,o=this.faces,m=t.faces,y=this.colors,x=t.colors;n===void 0&&(n=0),e!==void 0&&(r=new _r().getNormalMatrix(e));for(var M=0,A=h.length;M<A;M++){var T=h[M],P=T.clone();e!==void 0&&P.applyMatrix4(e),u.push(P)}for(var M=0,A=x.length;M<A;M++)y.push(x[M].clone());for(M=0,A=m.length;M<A;M++){var D=m[M],k,z,O,U=D.vertexNormals,H=D.vertexColors;k=new om(D.a+s,D.b+s,D.c+s),k.normal.copy(D.normal),r!==void 0&&k.normal.applyMatrix3(r).normalize();for(var V=0,W=U.length;V<W;V++)z=U[V].clone(),r!==void 0&&z.applyMatrix3(r).normalize(),k.vertexNormals.push(z);k.color.copy(D.color);for(var V=0,W=H.length;V<W;V++)O=H[V],k.vertexColors.push(O.clone());k.materialIndex=D.materialIndex+n,o.push(k)}for(var M=0,A=t.faceVertexUvs.length;M<A;M++){var K=t.faceVertexUvs[M];this.faceVertexUvs[M]===void 0&&(this.faceVertexUvs[M]=[]);for(var V=0,W=K.length;V<W;V++){for(var Z=K[V],tt=[],at=0,st=Z.length;at<st;at++)tt.push(Z[at].clone());this.faceVertexUvs[M].push(tt)}}},mergeMesh:function(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)},mergeVertices:function(){var t={},e=[],n=[],r,s,u=4,h=Math.pow(10,u),o,m,y,x,M,A;for(o=0,m=this.vertices.length;o<m;o++)r=this.vertices[o],s=Math.round(r.x*h)+"_"+Math.round(r.y*h)+"_"+Math.round(r.z*h),t[s]===void 0?(t[s]=o,e.push(this.vertices[o]),n[o]=e.length-1):n[o]=n[t[s]];var T=[];for(o=0,m=this.faces.length;o<m;o++){y=this.faces[o],y.a=n[y.a],y.b=n[y.b],y.c=n[y.c],x=[y.a,y.b,y.c];for(var P=0;P<3;P++)if(x[P]===x[(P+1)%3]){T.push(o);break}}for(o=T.length-1;o>=0;o--){var D=T[o];for(this.faces.splice(D,1),M=0,A=this.faceVertexUvs.length;M<A;M++)this.faceVertexUvs[M].splice(D,1)}var k=this.vertices.length-e.length;return this.vertices=e,k},setFromPoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new kt(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;function r(y,x){return y.materialIndex-x.materialIndex}t.sort(r);var s=this.faceVertexUvs[0],u=this.faceVertexUvs[1],h,o;s&&s.length===e&&(h=[]),u&&u.length===e&&(o=[]);for(var n=0;n<e;n++){var m=t[n]._id;h&&h.push(s[m]),o&&o.push(u[m])}h&&(this.faceVertexUvs[0]=h),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){var e=this.parameters;for(var n in e)e[n]!==void 0&&(t[n]=e[n]);return t}for(var r=[],s=0;s<this.vertices.length;s++){var u=this.vertices[s];r.push(u.x,u.y,u.z)}for(var h=[],o=[],m={},y=[],x={},M=[],A={},s=0;s<this.faces.length;s++){var T=this.faces[s],P=!0,D=!1,k=this.faceVertexUvs[0][s]!==void 0,z=T.normal.length()>0,O=T.vertexNormals.length>0,U=T.color.r!==1||T.color.g!==1||T.color.b!==1,H=T.vertexColors.length>0,V=0;if(V=tt(V,0,0),V=tt(V,1,P),V=tt(V,2,D),V=tt(V,3,k),V=tt(V,4,z),V=tt(V,5,O),V=tt(V,6,U),V=tt(V,7,H),h.push(V),h.push(T.a,T.b,T.c),h.push(T.materialIndex),k){var W=this.faceVertexUvs[0][s];h.push(nt(W[0]),nt(W[1]),nt(W[2]))}if(z&&h.push(at(T.normal)),O){var K=T.vertexNormals;h.push(at(K[0]),at(K[1]),at(K[2]))}if(U&&h.push(st(T.color)),H){var Z=T.vertexColors;h.push(st(Z[0]),st(Z[1]),st(Z[2]))}}function tt(ct,xt,vt){return vt?ct|1<<xt:ct&~(1<<xt)}function at(ct){var xt=ct.x.toString()+ct.y.toString()+ct.z.toString();return m[xt]!==void 0||(m[xt]=o.length/3,o.push(ct.x,ct.y,ct.z)),m[xt]}function st(ct){var xt=ct.r.toString()+ct.g.toString()+ct.b.toString();return x[xt]!==void 0||(x[xt]=y.length,y.push(ct.getHex())),x[xt]}function nt(ct){var xt=ct.x.toString()+ct.y.toString();return A[xt]!==void 0||(A[xt]=M.length/2,M.push(ct.x,ct.y)),A[xt]}return t.data={},t.data.vertices=r,t.data.normals=o,y.length>0&&(t.data.colors=y),M.length>0&&(t.data.uvs=[M]),t.data.faces=h,t},clone:function(){return new Gn().copy(this)},copy:function(t){var e,n,r,s,u,h;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var o=t.vertices;for(e=0,n=o.length;e<n;e++)this.vertices.push(o[e].clone());var m=t.colors;for(e=0,n=m.length;e<n;e++)this.colors.push(m[e].clone());var y=t.faces;for(e=0,n=y.length;e<n;e++)this.faces.push(y[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var x=t.faceVertexUvs[e];for(this.faceVertexUvs[e]===void 0&&(this.faceVertexUvs[e]=[]),r=0,s=x.length;r<s;r++){var M=x[r],A=[];for(u=0,h=M.length;u<h;u++){var T=M[u];A.push(T.clone())}this.faceVertexUvs[e].push(A)}}var P=t.morphTargets;for(e=0,n=P.length;e<n;e++){var D={};if(D.name=P[e].name,P[e].vertices!==void 0)for(D.vertices=[],r=0,s=P[e].vertices.length;r<s;r++)D.vertices.push(P[e].vertices[r].clone());if(P[e].normals!==void 0)for(D.normals=[],r=0,s=P[e].normals.length;r<s;r++)D.normals.push(P[e].normals[r].clone());this.morphTargets.push(D)}var k=t.morphNormals;for(e=0,n=k.length;e<n;e++){var z={};if(k[e].vertexNormals!==void 0)for(z.vertexNormals=[],r=0,s=k[e].vertexNormals.length;r<s;r++){var O=k[e].vertexNormals[r],U={};U.a=O.a.clone(),U.b=O.b.clone(),U.c=O.c.clone(),z.vertexNormals.push(U)}if(k[e].faceNormals!==void 0)for(z.faceNormals=[],r=0,s=k[e].faceNormals.length;r<s;r++)z.faceNormals.push(k[e].faceNormals[r].clone());this.morphNormals.push(z)}var H=t.skinWeights;for(e=0,n=H.length;e<n;e++)this.skinWeights.push(H[e].clone());var V=t.skinIndices;for(e=0,n=V.length;e<n;e++)this.skinIndices.push(V[e].clone());var W=t.lineDistances;for(e=0,n=W.length;e<n;e++)this.lineDistances.push(W[e]);var K=t.boundingBox;K!==null&&(this.boundingBox=K.clone());var Z=t.boundingSphere;return Z!==null&&(this.boundingSphere=Z.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class k3 extends Gn{constructor(e,n,r,s,u,h){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:s,heightSegments:u,depthSegments:h},this.fromBufferGeometry(new dm(e,n,r,s,u,h)),this.mergeVertices()}}class dm extends wn{constructor(e,n,r,s,u,h){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:s,heightSegments:u,depthSegments:h};var o=this;e=e||1,n=n||1,r=r||1,s=Math.floor(s)||1,u=Math.floor(u)||1,h=Math.floor(h)||1;var m=[],y=[],x=[],M=[],A=0,T=0;P("z","y","x",-1,-1,r,n,e,h,u,0),P("z","y","x",1,-1,r,n,-e,h,u,1),P("x","z","y",1,1,e,r,n,s,h,2),P("x","z","y",1,-1,e,r,-n,s,h,3),P("x","y","z",1,-1,e,n,r,s,u,4),P("x","y","z",-1,-1,e,n,-r,s,u,5),this.setIndex(m),this.setAttribute("position",new dn(y,3)),this.setAttribute("normal",new dn(x,3)),this.setAttribute("uv",new dn(M,2));function P(D,k,z,O,U,H,V,W,K,Z,tt){var at=H/K,st=V/Z,nt=H/2,ct=V/2,xt=W/2,vt=K+1,Zt=Z+1,ce=0,le=0,fe,de,Le=new kt;for(de=0;de<Zt;de++){var Lt=de*st-ct;for(fe=0;fe<vt;fe++){var bt=fe*at-nt;Le[D]=bt*O,Le[k]=Lt*U,Le[z]=xt,y.push(Le.x,Le.y,Le.z),Le[D]=0,Le[k]=0,Le[z]=W>0?1:-1,x.push(Le.x,Le.y,Le.z),M.push(fe/K),M.push(1-de/Z),ce+=1}}for(de=0;de<Z;de++)for(fe=0;fe<K;fe++){var qt=A+fe+vt*de,Wt=A+fe+vt*(de+1),Nt=A+(fe+1)+vt*(de+1),se=A+(fe+1)+vt*de;m.push(qt,Wt,se),m.push(Wt,Nt,se),le+=6}o.addGroup(T,le,tt),T+=le,A+=ce}}}function Qc(t){var e={};for(var n in t){e[n]={};for(var r in t[n]){var s=t[n][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture)?e[n][r]=s.clone():Array.isArray(s)?e[n][r]=s.slice():e[n][r]=s}}return e}function br(t){for(var e={},n=0;n<t.length;n++){var r=Qc(t[n]);for(var s in r)e[s]=r[s]}return e}var B3={clone:Qc,merge:br},F3=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,z3=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function qr(t){zn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=F3,this.fragmentShader=z3,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}qr.prototype=Object.create(zn.prototype),qr.prototype.constructor=qr,qr.prototype.isShaderMaterial=!0,qr.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Qc(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},qr.prototype.toJSON=function(t){var e=zn.prototype.toJSON.call(this,t);e.uniforms={};for(var n in this.uniforms){var r=this.uniforms[n],s=r.value;s&&s.isTexture?e.uniforms[n]={type:"t",value:s.toJSON(t).uuid}:s&&s.isColor?e.uniforms[n]={type:"c",value:s.getHex()}:s&&s.isVector2?e.uniforms[n]={type:"v2",value:s.toArray()}:s&&s.isVector3?e.uniforms[n]={type:"v3",value:s.toArray()}:s&&s.isVector4?e.uniforms[n]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?e.uniforms[n]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?e.uniforms[n]={type:"m4",value:s.toArray()}:e.uniforms[n]={value:s}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var u={};for(var h in this.extensions)this.extensions[h]===!0&&(u[h]=!0);return Object.keys(u).length>0&&(e.extensions=u),e};function Ys(){cn.call(this),this.type="Camera",this.matrixWorldInverse=new Kn,this.projectionMatrix=new Kn,this.projectionMatrixInverse=new Kn}Ys.prototype=Object.assign(Object.create(cn.prototype),{constructor:Ys,isCamera:!0,copy:function(t,e){return cn.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){t===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new kt),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){cn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){cn.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function er(t,e,n,r){Ys.call(this),this.type="PerspectiveCamera",this.fov=t!==void 0?t:50,this.zoom=1,this.near=n!==void 0?n:.1,this.far=r!==void 0?r:2e3,this.focus=10,this.aspect=e!==void 0?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}er.prototype=Object.assign(Object.create(Ys.prototype),{constructor:er,isPerspectiveCamera:!0,copy:function(t,e){return Ys.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=Xn.RAD2DEG*2*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(Xn.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/t},getEffectiveFOV:function(){return Xn.RAD2DEG*2*Math.atan(Math.tan(Xn.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,s,u){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=u,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(Xn.DEG2RAD*.5*this.fov)/this.zoom,n=2*e,r=this.aspect*n,s=-.5*r,u=this.view;if(this.view!==null&&this.view.enabled){var h=u.fullWidth,o=u.fullHeight;s+=u.offsetX*r/h,e-=u.offsetY*n/o,r*=u.width/h,n*=u.height/o}var m=this.filmOffset;m!==0&&(s+=t*m/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=cn.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var $c=90,tu=1;function ld(t,e,n,r){cn.call(this),this.type="CubeCamera";var s=new er($c,tu,t,e);s.up.set(0,-1,0),s.lookAt(new kt(1,0,0)),this.add(s);var u=new er($c,tu,t,e);u.up.set(0,-1,0),u.lookAt(new kt(-1,0,0)),this.add(u);var h=new er($c,tu,t,e);h.up.set(0,0,1),h.lookAt(new kt(0,1,0)),this.add(h);var o=new er($c,tu,t,e);o.up.set(0,0,-1),o.lookAt(new kt(0,-1,0)),this.add(o);var m=new er($c,tu,t,e);m.up.set(0,-1,0),m.lookAt(new kt(0,0,1)),this.add(m);var y=new er($c,tu,t,e);y.up.set(0,-1,0),y.lookAt(new kt(0,0,-1)),this.add(y),r=r||{format:Ns,magFilter:$i,minFilter:$i},this.renderTarget=new eu(n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(x,M){this.parent===null&&this.updateMatrixWorld();var A=x.getRenderTarget(),T=this.renderTarget,P=T.texture.generateMipmaps;T.texture.generateMipmaps=!1,x.setRenderTarget(T,0),x.render(M,s),x.setRenderTarget(T,1),x.render(M,u),x.setRenderTarget(T,2),x.render(M,h),x.setRenderTarget(T,3),x.render(M,o),x.setRenderTarget(T,4),x.render(M,m),T.texture.generateMipmaps=P,x.setRenderTarget(T,5),x.render(M,y),x.setRenderTarget(A)},this.clear=function(x,M,A,T){for(var P=x.getRenderTarget(),D=this.renderTarget,k=0;k<6;k++)x.setRenderTarget(D,k),x.clear(M,A,T);x.setRenderTarget(P)}}ld.prototype=Object.create(cn.prototype),ld.prototype.constructor=ld;function eu(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),Rr.call(this,t,t,e)}eu.prototype=Object.create(Rr.prototype),eu.prototype.constructor=eu,eu.prototype.isWebGLCubeRenderTarget=!0,eu.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var n=new Gs,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV;","	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},s=new qr({type:"CubemapFromEquirect",uniforms:Qc(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:lr,blending:ya});s.uniforms.tEquirect.value=e;var u=new ki(new dm(5,5,5),s);n.add(u);var h=new ld(1,10,1);return h.renderTarget=this,h.renderTarget.texture.name="CubeCameraTexture",h.update(t,n),u.geometry.dispose(),u.material.dispose(),this};function nu(t,e,n,r,s,u,h,o,m,y,x,M){bi.call(this,null,u,h,o,m,y,r,s,x,M),this.image={data:t||null,width:e||1,height:n||1},this.magFilter=m!==void 0?m:Yi,this.minFilter=y!==void 0?y:Yi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}nu.prototype=Object.create(bi.prototype),nu.prototype.constructor=nu,nu.prototype.isDataTexture=!0;var iu=new js,pm=new kt;function cd(t,e,n,r,s,u){this.planes=[t!==void 0?t:new as,e!==void 0?e:new as,n!==void 0?n:new as,r!==void 0?r:new as,s!==void 0?s:new as,u!==void 0?u:new as]}Object.assign(cd.prototype,{set:function(t,e,n,r,s,u){var h=this.planes;return h[0].copy(t),h[1].copy(e),h[2].copy(n),h[3].copy(r),h[4].copy(s),h[5].copy(u),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromProjectionMatrix:function(t){var e=this.planes,n=t.elements,r=n[0],s=n[1],u=n[2],h=n[3],o=n[4],m=n[5],y=n[6],x=n[7],M=n[8],A=n[9],T=n[10],P=n[11],D=n[12],k=n[13],z=n[14],O=n[15];return e[0].setComponents(h-r,x-o,P-M,O-D).normalize(),e[1].setComponents(h+r,x+o,P+M,O+D).normalize(),e[2].setComponents(h+s,x+m,P+A,O+k).normalize(),e[3].setComponents(h-s,x-m,P-A,O-k).normalize(),e[4].setComponents(h-u,x-y,P-T,O-z).normalize(),e[5].setComponents(h+u,x+y,P+T,O+z).normalize(),this},intersectsObject:function(t){var e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),iu.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(iu)},intersectsSprite:function(t){return iu.center.set(0,0,0),iu.radius=.7071067811865476,iu.applyMatrix4(t.matrixWorld),this.intersectsSphere(iu)},intersectsSphere:function(t){for(var e=this.planes,n=t.center,r=-t.radius,s=0;s<6;s++){var u=e[s].distanceToPoint(n);if(u<r)return!1}return!0},intersectsBox:function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];if(pm.x=r.normal.x>0?t.max.x:t.min.x,pm.y=r.normal.y>0?t.max.y:t.min.y,pm.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(pm)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}});var un={common:{diffuse:{value:new sn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new _r},uv2Transform:{value:new _r},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ke(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new sn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new sn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new _r}},sprite:{diffuse:{value:new sn(15658734)},opacity:{value:1},center:{value:new ke(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new _r}}};function Xb(){var t=null,e=!1,n=null;function r(s,u){e!==!1&&(n(s,u),t.requestAnimationFrame(r))}return{start:function(){e!==!0&&n!==null&&(t.requestAnimationFrame(r),e=!0)},stop:function(){e=!1},setAnimationLoop:function(s){n=s},setContext:function(s){t=s}}}function N3(t,e){var n=e.isWebGL2,r=new WeakMap;function s(y,x){var M=y.array,A=y.usage,T=t.createBuffer();t.bindBuffer(x,T),t.bufferData(x,M,A),y.onUploadCallback();var P=5126;return M instanceof Float32Array?P=5126:M instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):M instanceof Uint16Array?P=5123:M instanceof Int16Array?P=5122:M instanceof Uint32Array?P=5125:M instanceof Int32Array?P=5124:M instanceof Int8Array?P=5120:M instanceof Uint8Array&&(P=5121),{buffer:T,type:P,bytesPerElement:M.BYTES_PER_ELEMENT,version:y.version}}function u(y,x,M){var A=x.array,T=x.updateRange;t.bindBuffer(M,y),T.count===-1?t.bufferSubData(M,0,A):(n?t.bufferSubData(M,T.offset*A.BYTES_PER_ELEMENT,A,T.offset,T.count):t.bufferSubData(M,T.offset*A.BYTES_PER_ELEMENT,A.subarray(T.offset,T.offset+T.count)),T.count=-1)}function h(y){return y.isInterleavedBufferAttribute&&(y=y.data),r.get(y)}function o(y){y.isInterleavedBufferAttribute&&(y=y.data);var x=r.get(y);x&&(t.deleteBuffer(x.buffer),r.delete(y))}function m(y,x){y.isInterleavedBufferAttribute&&(y=y.data);var M=r.get(y);M===void 0?r.set(y,s(y,x)):M.version<y.version&&(u(M.buffer,y,x),M.version=y.version)}return{get:h,remove:o,update:m}}function fm(t,e,n,r){Gn.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new ru(t,e,n,r)),this.mergeVertices()}fm.prototype=Object.create(Gn.prototype),fm.prototype.constructor=fm;function ru(t,e,n,r){wn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},t=t||1,e=e||1;var s=t/2,u=e/2,h=Math.floor(n)||1,o=Math.floor(r)||1,m=h+1,y=o+1,x=t/h,M=e/o,A,T,P=[],D=[],k=[],z=[];for(T=0;T<y;T++){var O=T*M-u;for(A=0;A<m;A++){var U=A*x-s;D.push(U,-O,0),k.push(0,0,1),z.push(A/h),z.push(1-T/o)}}for(T=0;T<o;T++)for(A=0;A<h;A++){var H=A+m*T,V=A+m*(T+1),W=A+1+m*(T+1),K=A+1+m*T;P.push(H,V,K),P.push(V,W,K)}this.setIndex(P),this.setAttribute("position",new dn(D,3)),this.setAttribute("normal",new dn(k,3)),this.setAttribute("uv",new dn(z,2))}ru.prototype=Object.create(wn.prototype),ru.prototype.constructor=ru;var U3=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,V3=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,G3=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,O3=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,j3=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,H3="vec3 transformed = vec3( position );",W3=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,q3=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,Y3=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,X3=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,K3=`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Z3=`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,J3=`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,Q3=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,$3=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,tD=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,eD=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,nD=`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}`,iD=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,rD=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	transformedNormal = mat3( instanceMatrix ) * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,oD=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,sD=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,aD=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,lD=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,cD="gl_FragColor = linearToOutputTexel( gl_FragColor );",uD=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,hD=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,dD=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,pD=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,fD=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,mD=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,gD=`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,yD=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,xD=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,vD=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,_D=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,bD=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,MD=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,wD=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,AD=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,ED=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,TD=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,PD=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,SD=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,CD=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,DD=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = saturate( clearcoat );	material.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,RD=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,LD=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ID=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,kD=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,BD=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,FD=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,zD=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,ND=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,UD=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,VD=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,GD=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,OD=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,jD=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,HD=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,WD=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,qD=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,YD=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,XD=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,KD=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,ZD=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,JD=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,QD=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,$D=`#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,tR=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,eR=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,nR=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,iR=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,rR=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,oR=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,sR=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,aR=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,lR=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,cR=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,uR=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,hR=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,dR=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,pR=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,fR=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,mR=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,gR=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,yR=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,xR=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,vR=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,_R=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,bR=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,MR=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,wR=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,AR=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,ER=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,TR=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,PR=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,SR=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,CR=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,DR=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,RR=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,LR=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,IR=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,kR=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,BR=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,FR=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,zR=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,NR=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UR=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,VR=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GR=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,OR=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,jR=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,HR=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WR=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qR=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YR=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XR=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,KR=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ZR=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,JR=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,QR=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$R=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,tL=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,eL=`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nL=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,iL=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,$n={alphamap_fragment:U3,alphamap_pars_fragment:V3,alphatest_fragment:G3,aomap_fragment:O3,aomap_pars_fragment:j3,begin_vertex:H3,beginnormal_vertex:W3,bsdfs:q3,bumpmap_pars_fragment:Y3,clipping_planes_fragment:X3,clipping_planes_pars_fragment:K3,clipping_planes_pars_vertex:Z3,clipping_planes_vertex:J3,color_fragment:Q3,color_pars_fragment:$3,color_pars_vertex:tD,color_vertex:eD,common:nD,cube_uv_reflection_fragment:iD,defaultnormal_vertex:rD,displacementmap_pars_vertex:oD,displacementmap_vertex:sD,emissivemap_fragment:aD,emissivemap_pars_fragment:lD,encodings_fragment:cD,encodings_pars_fragment:uD,envmap_fragment:hD,envmap_common_pars_fragment:dD,envmap_pars_fragment:pD,envmap_pars_vertex:fD,envmap_physical_pars_fragment:ED,envmap_vertex:mD,fog_vertex:gD,fog_pars_vertex:yD,fog_fragment:xD,fog_pars_fragment:vD,gradientmap_pars_fragment:_D,lightmap_fragment:bD,lightmap_pars_fragment:MD,lights_lambert_vertex:wD,lights_pars_begin:AD,lights_toon_fragment:TD,lights_toon_pars_fragment:PD,lights_phong_fragment:SD,lights_phong_pars_fragment:CD,lights_physical_fragment:DD,lights_physical_pars_fragment:RD,lights_fragment_begin:LD,lights_fragment_maps:ID,lights_fragment_end:kD,logdepthbuf_fragment:BD,logdepthbuf_pars_fragment:FD,logdepthbuf_pars_vertex:zD,logdepthbuf_vertex:ND,map_fragment:UD,map_pars_fragment:VD,map_particle_fragment:GD,map_particle_pars_fragment:OD,metalnessmap_fragment:jD,metalnessmap_pars_fragment:HD,morphnormal_vertex:WD,morphtarget_pars_vertex:qD,morphtarget_vertex:YD,normal_fragment_begin:XD,normal_fragment_maps:KD,normalmap_pars_fragment:ZD,clearcoat_normal_fragment_begin:JD,clearcoat_normal_fragment_maps:QD,clearcoat_normalmap_pars_fragment:$D,packing:tR,premultiplied_alpha_fragment:eR,project_vertex:nR,dithering_fragment:iR,dithering_pars_fragment:rR,roughnessmap_fragment:oR,roughnessmap_pars_fragment:sR,shadowmap_pars_fragment:aR,shadowmap_pars_vertex:lR,shadowmap_vertex:cR,shadowmask_pars_fragment:uR,skinbase_vertex:hR,skinning_pars_vertex:dR,skinning_vertex:pR,skinnormal_vertex:fR,specularmap_fragment:mR,specularmap_pars_fragment:gR,tonemapping_fragment:yR,tonemapping_pars_fragment:xR,uv_pars_fragment:vR,uv_pars_vertex:_R,uv_vertex:bR,uv2_pars_fragment:MR,uv2_pars_vertex:wR,uv2_vertex:AR,worldpos_vertex:ER,background_frag:TR,background_vert:PR,cube_frag:SR,cube_vert:CR,depth_frag:DR,depth_vert:RR,distanceRGBA_frag:LR,distanceRGBA_vert:IR,equirect_frag:kR,equirect_vert:BR,linedashed_frag:FR,linedashed_vert:zR,meshbasic_frag:NR,meshbasic_vert:UR,meshlambert_frag:VR,meshlambert_vert:GR,meshmatcap_frag:OR,meshmatcap_vert:jR,meshtoon_frag:HR,meshtoon_vert:WR,meshphong_frag:qR,meshphong_vert:YR,meshphysical_frag:XR,meshphysical_vert:KR,normal_frag:ZR,normal_vert:JR,points_frag:QR,points_vert:$R,shadow_frag:tL,shadow_vert:eL,sprite_frag:nL,sprite_vert:iL},Xs={basic:{uniforms:br([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.fog]),vertexShader:$n.meshbasic_vert,fragmentShader:$n.meshbasic_frag},lambert:{uniforms:br([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.fog,un.lights,{emissive:{value:new sn(0)}}]),vertexShader:$n.meshlambert_vert,fragmentShader:$n.meshlambert_frag},phong:{uniforms:br([un.common,un.specularmap,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.fog,un.lights,{emissive:{value:new sn(0)},specular:{value:new sn(1118481)},shininess:{value:30}}]),vertexShader:$n.meshphong_vert,fragmentShader:$n.meshphong_frag},standard:{uniforms:br([un.common,un.envmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.roughnessmap,un.metalnessmap,un.fog,un.lights,{emissive:{value:new sn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:$n.meshphysical_vert,fragmentShader:$n.meshphysical_frag},toon:{uniforms:br([un.common,un.specularmap,un.aomap,un.lightmap,un.emissivemap,un.bumpmap,un.normalmap,un.displacementmap,un.gradientmap,un.fog,un.lights,{emissive:{value:new sn(0)},specular:{value:new sn(1118481)},shininess:{value:30}}]),vertexShader:$n.meshtoon_vert,fragmentShader:$n.meshtoon_frag},matcap:{uniforms:br([un.common,un.bumpmap,un.normalmap,un.displacementmap,un.fog,{matcap:{value:null}}]),vertexShader:$n.meshmatcap_vert,fragmentShader:$n.meshmatcap_frag},points:{uniforms:br([un.points,un.fog]),vertexShader:$n.points_vert,fragmentShader:$n.points_frag},dashed:{uniforms:br([un.common,un.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:$n.linedashed_vert,fragmentShader:$n.linedashed_frag},depth:{uniforms:br([un.common,un.displacementmap]),vertexShader:$n.depth_vert,fragmentShader:$n.depth_frag},normal:{uniforms:br([un.common,un.bumpmap,un.normalmap,un.displacementmap,{opacity:{value:1}}]),vertexShader:$n.normal_vert,fragmentShader:$n.normal_frag},sprite:{uniforms:br([un.sprite,un.fog]),vertexShader:$n.sprite_vert,fragmentShader:$n.sprite_frag},background:{uniforms:{uvTransform:{value:new _r},t2D:{value:null}},vertexShader:$n.background_vert,fragmentShader:$n.background_frag},cube:{uniforms:br([un.envmap,{opacity:{value:1}}]),vertexShader:$n.cube_vert,fragmentShader:$n.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:$n.equirect_vert,fragmentShader:$n.equirect_frag},distanceRGBA:{uniforms:br([un.common,un.displacementmap,{referencePosition:{value:new kt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:$n.distanceRGBA_vert,fragmentShader:$n.distanceRGBA_frag},shadow:{uniforms:br([un.lights,un.fog,{color:{value:new sn(0)},opacity:{value:1}}]),vertexShader:$n.shadow_vert,fragmentShader:$n.shadow_frag}};Xs.physical={uniforms:br([Xs.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new sn(0)},clearcoatNormalScale:{value:new ke(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:$n.meshphysical_vert,fragmentShader:$n.meshphysical_frag};function rL(t,e,n,r){var s=new sn(0),u=0,h,o,m=null,y=0,x=null;function M(T,P,D,k){var z=P.background,O=t.xr,U=O.getSession&&O.getSession();if(U&&U.environmentBlendMode==="additive"&&(z=null),z===null?A(s,u):z&&z.isColor&&(A(z,1),k=!0),(t.autoClear||k)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),z&&(z.isCubeTexture||z.isWebGLCubeRenderTarget||z.mapping===Yh)){o===void 0&&(o=new ki(new dm(1,1,1),new qr({type:"BackgroundCubeMaterial",uniforms:Qc(Xs.cube.uniforms),vertexShader:Xs.cube.vertexShader,fragmentShader:Xs.cube.fragmentShader,side:lr,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(V,W,K){this.matrixWorld.copyPosition(K.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(o));var H=z.isWebGLCubeRenderTarget?z.texture:z;o.material.uniforms.envMap.value=H,o.material.uniforms.flipEnvMap.value=H.isCubeTexture?-1:1,(m!==z||y!==H.version||x!==t.toneMapping)&&(o.material.needsUpdate=!0,m=z,y=H.version,x=t.toneMapping),T.unshift(o,o.geometry,o.material,0,0,null)}else z&&z.isTexture&&(h===void 0&&(h=new ki(new ru(2,2),new qr({type:"BackgroundMaterial",uniforms:Qc(Xs.background.uniforms),vertexShader:Xs.background.vertexShader,fragmentShader:Xs.background.fragmentShader,side:Dc,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(h)),h.material.uniforms.t2D.value=z,z.matrixAutoUpdate===!0&&z.updateMatrix(),h.material.uniforms.uvTransform.value.copy(z.matrix),(m!==z||y!==z.version||x!==t.toneMapping)&&(h.material.needsUpdate=!0,m=z,y=z.version,x=t.toneMapping),T.unshift(h,h.geometry,h.material,0,0,null))}function A(T,P){e.buffers.color.setClear(T.r,T.g,T.b,P,r)}return{getClearColor:function(){return s},setClearColor:function(T,P){s.set(T),u=P!==void 0?P:1,A(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(T){u=T,A(s,u)},render:M}}function oL(t,e,n,r){var s=r.isWebGL2,u;function h(y){u=y}function o(y,x){t.drawArrays(u,y,x),n.update(x,u)}function m(y,x,M,A){if(A!==0){var T,P;if(s)T=t,P="drawArraysInstanced";else if(T=e.get("ANGLE_instanced_arrays"),P="drawArraysInstancedANGLE",T===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}T[P](u,x,M,A),n.update(M,u,A)}}this.setMode=h,this.render=o,this.renderInstances=m}function sL(t,e,n){var r;function s(){if(r!==void 0)return r;var W=e.get("EXT_texture_filter_anisotropic");return W!==null?r=t.getParameter(W.MAX_TEXTURE_MAX_ANISOTROPY_EXT):r=0,r}function u(W){if(W==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";W="mediump"}return W==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var h=typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&t instanceof WebGL2ComputeRenderingContext,o=n.precision!==void 0?n.precision:"highp",m=u(o);m!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",m,"instead."),o=m);var y=n.logarithmicDepthBuffer===!0,x=t.getParameter(34930),M=t.getParameter(35660),A=t.getParameter(3379),T=t.getParameter(34076),P=t.getParameter(34921),D=t.getParameter(36347),k=t.getParameter(36348),z=t.getParameter(36349),O=M>0,U=h||!!e.get("OES_texture_float"),H=O&&U,V=h?t.getParameter(36183):0;return{isWebGL2:h,getMaxAnisotropy:s,getMaxPrecision:u,precision:o,logarithmicDepthBuffer:y,maxTextures:x,maxVertexTextures:M,maxTextureSize:A,maxCubemapSize:T,maxAttributes:P,maxVertexUniforms:D,maxVaryings:k,maxFragmentUniforms:z,vertexTextures:O,floatFragmentTextures:U,floatVertexTextures:H,maxSamples:V}}function aL(){var t=this,e=null,n=0,r=!1,s=!1,u=new as,h=new _r,o={value:null,needsUpdate:!1};this.uniform=o,this.numPlanes=0,this.numIntersection=0,this.init=function(x,M,A){var T=x.length!==0||M||n!==0||r;return r=M,e=y(x,A,0),n=x.length,T},this.beginShadows=function(){s=!0,y(null)},this.endShadows=function(){s=!1,m()},this.setState=function(x,M,A,T,P,D){if(!r||x===null||x.length===0||s&&!A)s?y(null):m();else{var k=s?0:n,z=k*4,O=P.clippingState||null;o.value=O,O=y(x,T,z,D);for(var U=0;U!==z;++U)O[U]=e[U];P.clippingState=O,this.numIntersection=M?this.numPlanes:0,this.numPlanes+=k}};function m(){o.value!==e&&(o.value=e,o.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function y(x,M,A,T){var P=x!==null?x.length:0,D=null;if(P!==0){if(D=o.value,T!==!0||D===null){var k=A+P*4,z=M.matrixWorldInverse;h.getNormalMatrix(z),(D===null||D.length<k)&&(D=new Float32Array(k));for(var O=0,U=A;O!==P;++O,U+=4)u.copy(x[O]).applyMatrix4(z,h),u.normal.toArray(D,U),D[U+3]=u.constant}o.value=D,o.needsUpdate=!0}return t.numPlanes=P,D}}function lL(t){var e={};return{get:function(n){if(e[n]!==void 0)return e[n];var r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r,r}}}function cL(t,e,n){var r=new WeakMap,s=new WeakMap;function u(x){var M=x.target,A=r.get(M);A.index!==null&&e.remove(A.index);for(var T in A.attributes)e.remove(A.attributes[T]);M.removeEventListener("dispose",u),r.delete(M);var P=s.get(A);P&&(e.remove(P),s.delete(A)),n.memory.geometries--}function h(x,M){var A=r.get(M);return A||(M.addEventListener("dispose",u),M.isBufferGeometry?A=M:M.isGeometry&&(M._bufferGeometry===void 0&&(M._bufferGeometry=new wn().setFromObject(x)),A=M._bufferGeometry),r.set(M,A),n.memory.geometries++,A)}function o(x){var M=x.index,A=x.attributes;M!==null&&e.update(M,34963);for(var T in A)e.update(A[T],34962);var P=x.morphAttributes;for(var T in P)for(var D=P[T],k=0,z=D.length;k<z;k++)e.update(D[k],34962)}function m(x){var M=[],A=x.index,T=x.attributes.position,P=0;if(A!==null){var D=A.array;P=A.version;for(var k=0,z=D.length;k<z;k+=3){var O=D[k+0],U=D[k+1],H=D[k+2];M.push(O,U,U,H,H,O)}}else{var D=T.array;P=T.version;for(var k=0,z=D.length/3-1;k<z;k+=3){var O=k+0,U=k+1,H=k+2;M.push(O,U,U,H,H,O)}}var V=new(Wb(M)>65535?od:rd)(M,1);V.version=P,e.update(V,34963);var W=s.get(x);W&&e.remove(W),s.set(x,V)}function y(x){var M=s.get(x);if(M){var A=x.index;A!==null&&M.version<A.version&&m(x)}else m(x);return s.get(x)}return{get:h,update:o,getWireframeAttribute:y}}function uL(t,e,n,r){var s=r.isWebGL2,u;function h(A){u=A}var o,m;function y(A){o=A.type,m=A.bytesPerElement}function x(A,T){t.drawElements(u,T,o,A*m),n.update(T,u)}function M(A,T,P,D){if(D!==0){var k,z;if(s)k=t,z="drawElementsInstanced";else if(k=e.get("ANGLE_instanced_arrays"),z="drawElementsInstancedANGLE",k===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}k[z](u,P,o,T*m,D),n.update(P,u,D)}}this.setMode=h,this.setIndex=y,this.render=x,this.renderInstances=M}function hL(t){var e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(u,h,o){switch(o=o||1,n.calls++,h){case 4:n.triangles+=o*(u/3);break;case 1:n.lines+=o*(u/2);break;case 3:n.lines+=o*(u-1);break;case 2:n.lines+=o*u;break;case 0:n.points+=o*u;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",h);break}}function s(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:s,update:r}}function dL(t,e){return Math.abs(e[1])-Math.abs(t[1])}function pL(t){var e={},n=new Float32Array(8);function r(s,u,h,o){var m=s.morphTargetInfluences,y=m===void 0?0:m.length,x=e[u.id];if(x===void 0){x=[];for(var M=0;M<y;M++)x[M]=[M,0];e[u.id]=x}for(var A=h.morphTargets&&u.morphAttributes.position,T=h.morphNormals&&u.morphAttributes.normal,M=0;M<y;M++){var P=x[M];P[1]!==0&&(A&&u.deleteAttribute("morphTarget"+M),T&&u.deleteAttribute("morphNormal"+M))}for(var M=0;M<y;M++){var P=x[M];P[0]=M,P[1]=m[M]}x.sort(dL);for(var D=0,M=0;M<8;M++){var P=x[M];if(P){var k=P[0],z=P[1];if(z){A&&u.setAttribute("morphTarget"+M,A[k]),T&&u.setAttribute("morphNormal"+M,T[k]),n[M]=z,D+=z;continue}}n[M]=0}var O=u.morphTargetsRelative?1:1-D;o.getUniforms().setValue(t,"morphTargetBaseInfluence",O),o.getUniforms().setValue(t,"morphTargetInfluences",n)}return{update:r}}function fL(t,e,n,r){var s={};function u(o){var m=r.render.frame,y=o.geometry,x=e.get(o,y);return s[x.id]!==m&&(y.isGeometry&&x.updateFromObject(o),e.update(x),s[x.id]=m),o.isInstancedMesh&&n.update(o.instanceMatrix,34962),x}function h(){s={}}return{update:u,dispose:h}}function Ma(t,e,n,r,s,u,h,o,m,y){t=t!==void 0?t:[],e=e!==void 0?e:B0,h=h!==void 0?h:Ns,bi.call(this,t,e,n,r,s,u,h,o,m,y),this.flipY=!1}Ma.prototype=Object.create(bi.prototype),Ma.prototype.constructor=Ma,Ma.prototype.isCubeTexture=!0,Object.defineProperty(Ma.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});function ud(t,e,n,r){bi.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.magFilter=Yi,this.minFilter=Yi,this.wrapR=Dr,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ud.prototype=Object.create(bi.prototype),ud.prototype.constructor=ud,ud.prototype.isDataTexture2DArray=!0;function hd(t,e,n,r){bi.call(this,null),this.image={data:t||null,width:e||1,height:n||1,depth:r||1},this.magFilter=Yi,this.minFilter=Yi,this.wrapR=Dr,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}hd.prototype=Object.create(bi.prototype),hd.prototype.constructor=hd,hd.prototype.isDataTexture3D=!0;var Kb=new bi,mL=new ud,gL=new hd,Zb=new Ma,Jb=[],Qb=[],$b=new Float32Array(16),tM=new Float32Array(9),eM=new Float32Array(4);function ou(t,e,n){var r=t[0];if(r<=0||r>0)return t;var s=e*n,u=Jb[s];if(u===void 0&&(u=new Float32Array(s),Jb[s]=u),e!==0){r.toArray(u,0);for(var h=1,o=0;h!==e;++h)o+=n,t[h].toArray(u,o)}return u}function So(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function mo(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function nM(t,e){var n=Qb[e];n===void 0&&(n=new Int32Array(e),Qb[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function yL(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function xL(t,e){var n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(So(n,e))return;t.uniform2fv(this.addr,e),mo(n,e)}}function vL(t,e){var n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(So(n,e))return;t.uniform3fv(this.addr,e),mo(n,e)}}function _L(t,e){var n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(So(n,e))return;t.uniform4fv(this.addr,e),mo(n,e)}}function bL(t,e){var n=this.cache,r=e.elements;if(r===void 0){if(So(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),mo(n,e)}else{if(So(n,r))return;eM.set(r),t.uniformMatrix2fv(this.addr,!1,eM),mo(n,r)}}function ML(t,e){var n=this.cache,r=e.elements;if(r===void 0){if(So(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),mo(n,e)}else{if(So(n,r))return;tM.set(r),t.uniformMatrix3fv(this.addr,!1,tM),mo(n,r)}}function wL(t,e){var n=this.cache,r=e.elements;if(r===void 0){if(So(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),mo(n,e)}else{if(So(n,r))return;$b.set(r),t.uniformMatrix4fv(this.addr,!1,$b),mo(n,r)}}function AL(t,e,n){var r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.safeSetTexture2D(e||Kb,s)}function EL(t,e,n){var r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.setTexture2DArray(e||mL,s)}function TL(t,e,n){var r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.setTexture3D(e||gL,s)}function PL(t,e,n){var r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.safeSetTextureCube(e||Zb,s)}function SL(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function CL(t,e){var n=this.cache;So(n,e)||(t.uniform2iv(this.addr,e),mo(n,e))}function DL(t,e){var n=this.cache;So(n,e)||(t.uniform3iv(this.addr,e),mo(n,e))}function RL(t,e){var n=this.cache;So(n,e)||(t.uniform4iv(this.addr,e),mo(n,e))}function LL(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function IL(t){switch(t){case 5126:return yL;case 35664:return xL;case 35665:return vL;case 35666:return _L;case 35674:return bL;case 35675:return ML;case 35676:return wL;case 5124:case 35670:return SL;case 35667:case 35671:return CL;case 35668:case 35672:return DL;case 35669:case 35673:return RL;case 5125:return LL;case 35678:case 36198:case 36298:case 36306:case 35682:return AL;case 35679:case 36299:case 36307:return TL;case 35680:case 36300:case 36308:case 36293:return PL;case 36289:case 36303:case 36311:case 36292:return EL}}function kL(t,e){t.uniform1fv(this.addr,e)}function BL(t,e){t.uniform1iv(this.addr,e)}function FL(t,e){t.uniform2iv(this.addr,e)}function zL(t,e){t.uniform3iv(this.addr,e)}function NL(t,e){t.uniform4iv(this.addr,e)}function UL(t,e){var n=ou(e,this.size,2);t.uniform2fv(this.addr,n)}function VL(t,e){var n=ou(e,this.size,3);t.uniform3fv(this.addr,n)}function GL(t,e){var n=ou(e,this.size,4);t.uniform4fv(this.addr,n)}function OL(t,e){var n=ou(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function jL(t,e){var n=ou(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function HL(t,e){var n=ou(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function WL(t,e,n){var r=e.length,s=nM(n,r);t.uniform1iv(this.addr,s);for(var u=0;u!==r;++u)n.safeSetTexture2D(e[u]||Kb,s[u])}function qL(t,e,n){var r=e.length,s=nM(n,r);t.uniform1iv(this.addr,s);for(var u=0;u!==r;++u)n.safeSetTextureCube(e[u]||Zb,s[u])}function YL(t){switch(t){case 5126:return kL;case 35664:return UL;case 35665:return VL;case 35666:return GL;case 35674:return OL;case 35675:return jL;case 35676:return HL;case 5124:case 35670:return BL;case 35667:case 35671:return FL;case 35668:case 35672:return zL;case 35669:case 35673:return NL;case 35678:case 36198:case 36298:case 36306:case 35682:return WL;case 35680:case 36300:case 36308:case 36293:return qL}}function XL(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=IL(e.type)}function iM(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=YL(e.type)}iM.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),mo(e,t)};function rM(t){this.id=t,this.seq=[],this.map={}}rM.prototype.setValue=function(t,e,n){for(var r=this.seq,s=0,u=r.length;s!==u;++s){var h=r[s];h.setValue(t,e[h.id],n)}};var mx=/([\w\d_]+)(\])?(\[|\.)?/g;function oM(t,e){t.seq.push(e),t.map[e.id]=e}function KL(t,e,n){var r=t.name,s=r.length;for(mx.lastIndex=0;;){var u=mx.exec(r),h=mx.lastIndex,o=u[1],m=u[2]==="]",y=u[3];if(m&&(o=o|0),y===void 0||y==="["&&h+2===s){oM(n,y===void 0?new XL(o,t,e):new iM(o,t,e));break}else{var x=n.map,M=x[o];M===void 0&&(M=new rM(o),oM(n,M)),n=M}}}function wa(t,e){this.seq=[],this.map={};for(var n=t.getProgramParameter(e,35718),r=0;r<n;++r){var s=t.getActiveUniform(e,r),u=t.getUniformLocation(e,s.name);KL(s,u,this)}}wa.prototype.setValue=function(t,e,n,r){var s=this.map[e];s!==void 0&&s.setValue(t,n,r)},wa.prototype.setOptional=function(t,e,n){var r=e[n];r!==void 0&&this.setValue(t,n,r)},wa.upload=function(t,e,n,r){for(var s=0,u=e.length;s!==u;++s){var h=e[s],o=n[h.id];o.needsUpdate!==!1&&h.setValue(t,o.value,r)}},wa.seqWithValue=function(t,e){for(var n=[],r=0,s=t.length;r!==s;++r){var u=t[r];u.id in e&&n.push(u)}return n};function sM(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}var ZL=0;function JL(t){for(var e=t.split(`
`),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join(`
`)}function aM(t){switch(t){case ho:return["Linear","( value )"];case Qh:return["sRGB","( value )"];case O0:return["RGBE","( value )"];case Db:return["RGBM","( value, 7.0 )"];case Rb:return["RGBM","( value, 16.0 )"];case Lb:return["RGBD","( value, 256.0 )"];case Cb:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case m3:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function lM(t,e,n){var r=t.getShaderParameter(e,35713),s=t.getShaderInfoLog(e).trim();if(r&&s==="")return"";var u=t.getShaderSource(e);return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+`
`+s+JL(u)}function dd(t,e){var n=aM(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function QL(t,e){var n=aM(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function $L(t,e){var n;switch(e){case I0:n="Linear";break;case CC:n="Reinhard";break;case DC:n="Uncharted2";break;case RC:n="OptimizedCineon";break;case LC:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function t4(t){var e=[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return e.filter(pd).join(`
`)}function e4(t){var e=[];for(var n in t){var r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function n4(t,e){for(var n={},r=t.getProgramParameter(e,35721),s=0;s<r;s++){var u=t.getActiveAttrib(e,s),h=u.name;n[h]=t.getAttribLocation(e,h)}return n}function pd(t){return t!==""}function cM(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function uM(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var i4=/^[ \t]*#include +<([\w\d./]+)>/gm;function gx(t){return t.replace(i4,r4)}function r4(t,e){var n=$n[e];if(n===void 0)throw new Error("Can not resolve #include <"+e+">");return gx(n)}var o4=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function hM(t){return t.replace(o4,s4)}function s4(t,e,n,r){for(var s="",u=parseInt(e);u<parseInt(n);u++)s+=r.replace(/\[ i \]/g,"[ "+u+" ]").replace(/UNROLLED_LOOP_INDEX/g,u);return s}function dM(t){var e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function a4(t){var e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===ab?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===sC?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Hh&&(e="SHADOWMAP_TYPE_VSM"),e}function l4(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case B0:case F0:e="ENVMAP_TYPE_CUBE";break;case Yh:case N0:e="ENVMAP_TYPE_CUBE_UV";break;case yb:case z0:e="ENVMAP_TYPE_EQUIREC";break;case xb:e="ENVMAP_TYPE_SPHERE";break}return e}function c4(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case F0:case z0:e="ENVMAP_MODE_REFRACTION";break}return e}function u4(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Of:e="ENVMAP_BLENDING_MULTIPLY";break;case PC:e="ENVMAP_BLENDING_MIX";break;case SC:e="ENVMAP_BLENDING_ADD";break}return e}function h4(t,e,n){var r=t.getContext(),s=n.defines,u=n.vertexShader,h=n.fragmentShader,o=a4(n),m=l4(n),y=c4(n),x=u4(n),M=t.gammaFactor>0?t.gammaFactor:1,A=n.isWebGL2?"":t4(n),T=e4(s),P=r.createProgram(),D,k,z=n.numMultiviewViews;if(n.isRawShaderMaterial?(D=[T].filter(pd).join(`
`),D.length>0&&(D+=`
`),k=[A,T].filter(pd).join(`
`),k.length>0&&(k+=`
`)):(D=[dM(n),"#define SHADER_NAME "+n.shaderName,T,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+M,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+y:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+o:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(pd).join(`
`),k=[A,dM(n),"#define SHADER_NAME "+n.shaderName,T,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+M,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.envMap?"#define "+y:"",n.envMap?"#define "+x:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+o:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==jf?"#define TONE_MAPPING":"",n.toneMapping!==jf?$n.tonemapping_pars_fragment:"",n.toneMapping!==jf?$L("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?$n.encodings_pars_fragment:"",n.mapEncoding?dd("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?dd("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?dd("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?dd("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?dd("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?QL("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(pd).join(`
`)),u=gx(u),u=cM(u,n),u=uM(u,n),h=gx(h),h=cM(h,n),h=uM(h,n),u=hM(u),h=hM(h),n.isWebGL2&&!n.isRawShaderMaterial){var O=!1,U=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&u.match(U)!==null&&h.match(U)!==null&&(O=!0,u=u.replace(U,""),h=h.replace(U,"")),D=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+D,k=[`#version 300 es
`,"#define varying in",O?"":"out highp vec4 pc_fragColor;",O?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+k,z>0&&(D=D.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","layout(num_views = "+z+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)),D=D.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+z+"];","uniform mat4 projectionMatrices["+z+"];","uniform mat4 viewMatrices["+z+"];","uniform mat3 normalMatrices["+z+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),k=k.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)),k=k.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+z+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`)))}var H=D+u,V=k+h,W=sM(r,35633,H),K=sM(r,35632,V);if(r.attachShader(P,W),r.attachShader(P,K),n.index0AttributeName!==void 0?r.bindAttribLocation(P,0,n.index0AttributeName):n.morphTargets===!0&&r.bindAttribLocation(P,0,"position"),r.linkProgram(P),t.debug.checkShaderErrors){var Z=r.getProgramInfoLog(P).trim(),tt=r.getShaderInfoLog(W).trim(),at=r.getShaderInfoLog(K).trim(),st=!0,nt=!0;if(r.getProgramParameter(P,35714)===!1){st=!1;var ct=lM(r,W,"vertex"),xt=lM(r,K,"fragment");console.error("THREE.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(P,35715),"gl.getProgramInfoLog",Z,ct,xt)}else Z!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Z):(tt===""||at==="")&&(nt=!1);nt&&(this.diagnostics={runnable:st,programLog:Z,vertexShader:{log:tt,prefix:D},fragmentShader:{log:at,prefix:k}})}r.deleteShader(W),r.deleteShader(K);var vt;this.getUniforms=function(){return vt===void 0&&(vt=new wa(r,P)),vt};var Zt;return this.getAttributes=function(){return Zt===void 0&&(Zt=n4(r,P)),Zt},this.destroy=function(){r.deleteProgram(P),this.program=void 0},this.name=n.shaderName,this.id=ZL++,this.cacheKey=e,this.usedTimes=1,this.program=P,this.vertexShader=W,this.fragmentShader=K,this.numMultiviewViews=z,this}function d4(t,e,n){var r=[],s=n.isWebGL2,u=n.logarithmicDepthBuffer,h=n.floatVertexTextures,o=n.precision,m=n.maxVertexUniforms,y=n.vertexTextures,x={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},M=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function A(D,k){var z;if(k){var O=Xs[k];z={name:D.type,uniforms:B3.clone(O.uniforms),vertexShader:O.vertexShader,fragmentShader:O.fragmentShader}}else z={name:D.type,uniforms:D.uniforms,vertexShader:D.vertexShader,fragmentShader:D.fragmentShader};return z}function T(D){var k=D.skeleton,z=k.bones;if(h)return 1024;var O=m,U=Math.floor((O-20)/4),H=Math.min(U,z.length);return H<z.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+z.length+" bones. This GPU supports "+H+"."),0):H}function P(D){var k;return D?D.isTexture?k=D.encoding:D.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),k=D.texture.encoding):k=ho,k}this.getParameters=function(D,k,z,O,U,H,V){var W=O.fog,K=D.isMeshStandardMaterial?O.environment:null,Z=D.envMap||K,tt=x[D.type],at=V.isSkinnedMesh?T(V):0;D.precision!==null&&(o=n.getMaxPrecision(D.precision),o!==D.precision&&console.warn("THREE.WebGLProgram.getParameters:",D.precision,"not supported, using",o,"instead."));var st=A(D,tt);D.onBeforeCompile(st,t);var nt=t.getRenderTarget(),ct=nt&&nt.isWebGLMultiviewRenderTarget?nt.numViews:0,xt={isWebGL2:s,shaderID:tt,shaderName:st.name,uniforms:st.uniforms,vertexShader:st.vertexShader,fragmentShader:st.fragmentShader,defines:D.defines,isRawShaderMaterial:D.isRawShaderMaterial,isShaderMaterial:D.isShaderMaterial,precision:o,instancing:V.isInstancedMesh===!0,supportsVertexTextures:y,numMultiviewViews:ct,outputEncoding:nt!==null?P(nt.texture):t.outputEncoding,map:!!D.map,mapEncoding:P(D.map),matcap:!!D.matcap,matcapEncoding:P(D.matcap),envMap:!!Z,envMapMode:Z&&Z.mapping,envMapEncoding:P(Z),envMapCubeUV:!!Z&&(Z.mapping===Yh||Z.mapping===N0),lightMap:!!D.lightMap,lightMapEncoding:P(D.lightMap),aoMap:!!D.aoMap,emissiveMap:!!D.emissiveMap,emissiveMapEncoding:P(D.emissiveMap),bumpMap:!!D.bumpMap,normalMap:!!D.normalMap,objectSpaceNormalMap:D.normalMapType===x3,tangentSpaceNormalMap:D.normalMapType===vl,clearcoatNormalMap:!!D.clearcoatNormalMap,displacementMap:!!D.displacementMap,roughnessMap:!!D.roughnessMap,metalnessMap:!!D.metalnessMap,specularMap:!!D.specularMap,alphaMap:!!D.alphaMap,gradientMap:!!D.gradientMap,sheen:!!D.sheen,combine:D.combine,vertexTangents:D.normalMap&&D.vertexTangents,vertexColors:D.vertexColors,vertexUvs:!!D.map||!!D.bumpMap||!!D.normalMap||!!D.specularMap||!!D.alphaMap||!!D.emissiveMap||!!D.roughnessMap||!!D.metalnessMap||!!D.clearcoatNormalMap||!!D.displacementMap,uvsVertexOnly:!(D.map||D.bumpMap||D.normalMap||D.specularMap||D.alphaMap||D.emissiveMap||D.roughnessMap||D.metalnessMap||D.clearcoatNormalMap)&&!!D.displacementMap,fog:!!W,useFog:D.fog,fogExp2:W&&W.isFogExp2,flatShading:D.flatShading,sizeAttenuation:D.sizeAttenuation,logarithmicDepthBuffer:u,skinning:D.skinning&&at>0,maxBones:at,useVertexTexture:h,morphTargets:D.morphTargets,morphNormals:D.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:k.directional.length,numPointLights:k.point.length,numSpotLights:k.spot.length,numRectAreaLights:k.rectArea.length,numHemiLights:k.hemi.length,numDirLightShadows:k.directionalShadowMap.length,numPointLightShadows:k.pointShadowMap.length,numSpotLightShadows:k.spotShadowMap.length,numClippingPlanes:U,numClipIntersection:H,dithering:D.dithering,shadowMapEnabled:t.shadowMap.enabled&&z.length>0,shadowMapType:t.shadowMap.type,toneMapping:D.toneMapped?t.toneMapping:jf,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:D.premultipliedAlpha,alphaTest:D.alphaTest,doubleSided:D.side===Wh,flipSided:D.side===lr,depthPacking:D.depthPacking!==void 0?D.depthPacking:!1,index0AttributeName:D.index0AttributeName,extensionDerivatives:D.extensions&&D.extensions.derivatives,extensionFragDepth:D.extensions&&D.extensions.frawbuffers,extensionDrawbuffers:D.extensions&&D.extensions.drawbuffers,extensionShaderTextureLOD:D.extensions&&D.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||e.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:s||e.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:s||e.get("EXT_shader_texture_lod")!==null,onBeforeCompile:D.onBeforeCompile};return xt},this.getProgramCacheKey=function(D){var k=[];if(D.shaderID?k.push(D.shaderID):(k.push(D.fragmentShader),k.push(D.vertexShader)),D.defines!==void 0)for(var z in D.defines)k.push(z),k.push(D.defines[z]);if(D.isRawShaderMaterial===void 0){for(var O=0;O<M.length;O++)k.push(D[M[O]]);k.push(t.outputEncoding),k.push(t.gammaFactor)}return k.push(D.onBeforeCompile.toString()),k.join()},this.acquireProgram=function(D,k){for(var z,O=0,U=r.length;O<U;O++){var H=r[O];if(H.cacheKey===k){z=H,++z.usedTimes;break}}return z===void 0&&(z=new h4(t,k,D),r.push(z)),z},this.releaseProgram=function(D){if(--D.usedTimes===0){var k=r.indexOf(D);r[k]=r[r.length-1],r.pop(),D.destroy()}},this.programs=r}function p4(){var t=new WeakMap;function e(u){var h=t.get(u);return h===void 0&&(h={},t.set(u,h)),h}function n(u){t.delete(u)}function r(u,h,o){t.get(u)[h]=o}function s(){t=new WeakMap}return{get:e,remove:n,update:r,dispose:s}}function f4(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function m4(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function pM(){var t=[],e=0,n=[],r=[],s={id:-1};function u(){e=0,n.length=0,r.length=0}function h(x,M,A,T,P,D){var k=t[e];return k===void 0?(k={id:x.id,object:x,geometry:M,material:A,program:A.program||s,groupOrder:T,renderOrder:x.renderOrder,z:P,group:D},t[e]=k):(k.id=x.id,k.object=x,k.geometry=M,k.material=A,k.program=A.program||s,k.groupOrder=T,k.renderOrder=x.renderOrder,k.z=P,k.group=D),e++,k}function o(x,M,A,T,P,D){var k=h(x,M,A,T,P,D);(A.transparent===!0?r:n).push(k)}function m(x,M,A,T,P,D){var k=h(x,M,A,T,P,D);(A.transparent===!0?r:n).unshift(k)}function y(x,M){n.length>1&&n.sort(x||f4),r.length>1&&r.sort(M||m4)}return{opaque:n,transparent:r,init:u,push:o,unshift:m,sort:y}}function g4(){var t=new WeakMap;function e(s){var u=s.target;u.removeEventListener("dispose",e),t.delete(u)}function n(s,u){var h=t.get(s),o;return h===void 0?(o=new pM,t.set(s,new WeakMap),t.get(s).set(u,o),s.addEventListener("dispose",e)):(o=h.get(u),o===void 0&&(o=new pM,h.set(u,o))),o}function r(){t=new WeakMap}return{get:n,dispose:r}}function y4(){var t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];var n;switch(e.type){case"DirectionalLight":n={direction:new kt,color:new sn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ke};break;case"SpotLight":n={position:new kt,direction:new kt,color:new sn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ke};break;case"PointLight":n={position:new kt,color:new sn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new ke,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new kt,skyColor:new sn,groundColor:new sn};break;case"RectAreaLight":n={color:new sn,position:new kt,halfWidth:new kt,halfHeight:new kt};break}return t[e.id]=n,n}}}var x4=0;function v4(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function _4(){for(var t=new y4,e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)e.probe.push(new kt);var r=new kt,s=new Kn,u=new Kn;function h(o,m,y){for(var x=0,M=0,A=0,T=0;T<9;T++)e.probe[T].set(0,0,0);var P=0,D=0,k=0,z=0,O=0,U=0,H=0,V=0,W=y.matrixWorldInverse;o.sort(v4);for(var T=0,K=o.length;T<K;T++){var Z=o[T],tt=Z.color,at=Z.intensity,st=Z.distance,nt=Z.shadow&&Z.shadow.map?Z.shadow.map.texture:null;if(Z.isAmbientLight)x+=tt.r*at,M+=tt.g*at,A+=tt.b*at;else if(Z.isLightProbe)for(var ct=0;ct<9;ct++)e.probe[ct].addScaledVector(Z.sh.coefficients[ct],at);else if(Z.isDirectionalLight){var xt=t.get(Z);if(xt.color.copy(Z.color).multiplyScalar(Z.intensity),xt.direction.setFromMatrixPosition(Z.matrixWorld),r.setFromMatrixPosition(Z.target.matrixWorld),xt.direction.sub(r),xt.direction.transformDirection(W),xt.shadow=Z.castShadow,Z.castShadow){var vt=Z.shadow;xt.shadowBias=vt.bias,xt.shadowRadius=vt.radius,xt.shadowMapSize=vt.mapSize,e.directionalShadowMap[P]=nt,e.directionalShadowMatrix[P]=Z.shadow.matrix,U++}e.directional[P]=xt,P++}else if(Z.isSpotLight){var xt=t.get(Z);if(xt.position.setFromMatrixPosition(Z.matrixWorld),xt.position.applyMatrix4(W),xt.color.copy(tt).multiplyScalar(at),xt.distance=st,xt.direction.setFromMatrixPosition(Z.matrixWorld),r.setFromMatrixPosition(Z.target.matrixWorld),xt.direction.sub(r),xt.direction.transformDirection(W),xt.coneCos=Math.cos(Z.angle),xt.penumbraCos=Math.cos(Z.angle*(1-Z.penumbra)),xt.decay=Z.decay,xt.shadow=Z.castShadow,Z.castShadow){var vt=Z.shadow;xt.shadowBias=vt.bias,xt.shadowRadius=vt.radius,xt.shadowMapSize=vt.mapSize,e.spotShadowMap[k]=nt,e.spotShadowMatrix[k]=Z.shadow.matrix,V++}e.spot[k]=xt,k++}else if(Z.isRectAreaLight){var xt=t.get(Z);xt.color.copy(tt).multiplyScalar(at),xt.position.setFromMatrixPosition(Z.matrixWorld),xt.position.applyMatrix4(W),u.identity(),s.copy(Z.matrixWorld),s.premultiply(W),u.extractRotation(s),xt.halfWidth.set(Z.width*.5,0,0),xt.halfHeight.set(0,Z.height*.5,0),xt.halfWidth.applyMatrix4(u),xt.halfHeight.applyMatrix4(u),e.rectArea[z]=xt,z++}else if(Z.isPointLight){var xt=t.get(Z);if(xt.position.setFromMatrixPosition(Z.matrixWorld),xt.position.applyMatrix4(W),xt.color.copy(Z.color).multiplyScalar(Z.intensity),xt.distance=Z.distance,xt.decay=Z.decay,xt.shadow=Z.castShadow,Z.castShadow){var vt=Z.shadow;xt.shadowBias=vt.bias,xt.shadowRadius=vt.radius,xt.shadowMapSize=vt.mapSize,xt.shadowCameraNear=vt.camera.near,xt.shadowCameraFar=vt.camera.far,e.pointShadowMap[D]=nt,e.pointShadowMatrix[D]=Z.shadow.matrix,H++}e.point[D]=xt,D++}else if(Z.isHemisphereLight){var xt=t.get(Z);xt.direction.setFromMatrixPosition(Z.matrixWorld),xt.direction.transformDirection(W),xt.direction.normalize(),xt.skyColor.copy(Z.color).multiplyScalar(at),xt.groundColor.copy(Z.groundColor).multiplyScalar(at),e.hemi[O]=xt,O++}}e.ambient[0]=x,e.ambient[1]=M,e.ambient[2]=A;var Zt=e.hash;(Zt.directionalLength!==P||Zt.pointLength!==D||Zt.spotLength!==k||Zt.rectAreaLength!==z||Zt.hemiLength!==O||Zt.numDirectionalShadows!==U||Zt.numPointShadows!==H||Zt.numSpotShadows!==V)&&(e.directional.length=P,e.spot.length=k,e.rectArea.length=z,e.point.length=D,e.hemi.length=O,e.directionalShadowMap.length=U,e.pointShadowMap.length=H,e.spotShadowMap.length=V,e.directionalShadowMatrix.length=U,e.pointShadowMatrix.length=H,e.spotShadowMatrix.length=V,Zt.directionalLength=P,Zt.pointLength=D,Zt.spotLength=k,Zt.rectAreaLength=z,Zt.hemiLength=O,Zt.numDirectionalShadows=U,Zt.numPointShadows=H,Zt.numSpotShadows=V,e.version=x4++)}return{setup:h,state:e}}function fM(){var t=new _4,e=[],n=[];function r(){e.length=0,n.length=0}function s(m){e.push(m)}function u(m){n.push(m)}function h(m){t.setup(e,n,m)}var o={lightsArray:e,shadowsArray:n,lights:t};return{init:r,state:o,setupLights:h,pushLight:s,pushShadow:u}}function b4(){var t=new WeakMap;function e(s){var u=s.target;u.removeEventListener("dispose",e),t.delete(u)}function n(s,u){var h;return t.has(s)===!1?(h=new fM,t.set(s,new WeakMap),t.get(s).set(u,h),s.addEventListener("dispose",e)):t.get(s).has(u)===!1?(h=new fM,t.get(s).set(u,h)):h=t.get(s).get(u),h}function r(){t=new WeakMap}return{get:n,dispose:r}}function Pl(t){zn.call(this),this.type="MeshDepthMaterial",this.depthPacking=g3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}Pl.prototype=Object.create(zn.prototype),Pl.prototype.constructor=Pl,Pl.prototype.isMeshDepthMaterial=!0,Pl.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this};function Sl(t){zn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new kt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Sl.prototype=Object.create(zn.prototype),Sl.prototype.constructor=Sl,Sl.prototype.isMeshDistanceMaterial=!0,Sl.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var M4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,w4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function mM(t,e,n){var r=new cd,s=new ke,u=new ke,h=new Mi,o=[],m=[],y={},x={0:lr,1:Dc,2:Wh},M=new qr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new ke},radius:{value:4}},vertexShader:w4,fragmentShader:M4}),A=M.clone();A.defines.HORIZONAL_PASS=1;var T=new wn;T.setAttribute("position",new Nn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var P=new ki(T,M),D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ab,this.render=function(V,W,K){if(D.enabled!==!1&&!(D.autoUpdate===!1&&D.needsUpdate===!1)&&V.length!==0){var Z=t.getRenderTarget(),tt=t.getActiveCubeFace(),at=t.getActiveMipmapLevel(),st=t.state;st.setBlending(ya),st.buffers.color.setClear(1,1,1,1),st.buffers.depth.setTest(!0),st.setScissorTest(!1);for(var nt=0,ct=V.length;nt<ct;nt++){var xt=V[nt],vt=xt.shadow;if(vt===void 0){console.warn("THREE.WebGLShadowMap:",xt,"has no shadow.");continue}s.copy(vt.mapSize);var Zt=vt.getFrameExtents();if(s.multiply(Zt),u.copy(vt.mapSize),(s.x>n||s.y>n)&&(console.warn("THREE.WebGLShadowMap:",xt,"has shadow exceeding max texture size, reducing"),s.x>n&&(u.x=Math.floor(n/Zt.x),s.x=u.x*Zt.x,vt.mapSize.x=u.x),s.y>n&&(u.y=Math.floor(n/Zt.y),s.y=u.y*Zt.y,vt.mapSize.y=u.y)),vt.map===null&&!vt.isPointLightShadow&&this.type===Hh){var ce={minFilter:$i,magFilter:$i,format:No};vt.map=new Rr(s.x,s.y,ce),vt.map.texture.name=xt.name+".shadowMap",vt.mapPass=new Rr(s.x,s.y,ce),vt.camera.updateProjectionMatrix()}if(vt.map===null){var ce={minFilter:Yi,magFilter:Yi,format:No};vt.map=new Rr(s.x,s.y,ce),vt.map.texture.name=xt.name+".shadowMap",vt.camera.updateProjectionMatrix()}t.setRenderTarget(vt.map),t.clear();for(var le=vt.getViewportCount(),fe=0;fe<le;fe++){var de=vt.getViewport(fe);h.set(u.x*de.x,u.y*de.y,u.x*de.z,u.y*de.w),st.viewport(h),vt.updateMatrices(xt,fe),r=vt.getFrustum(),H(W,K,vt.camera,xt,this.type)}!vt.isPointLightShadow&&this.type===Hh&&k(vt,K)}D.needsUpdate=!1,t.setRenderTarget(Z,tt,at)}};function k(V,W){var K=e.update(P);M.uniforms.shadow_pass.value=V.map.texture,M.uniforms.resolution.value=V.mapSize,M.uniforms.radius.value=V.radius,t.setRenderTarget(V.mapPass),t.clear(),t.renderBufferDirect(W,null,K,M,P,null),A.uniforms.shadow_pass.value=V.mapPass.texture,A.uniforms.resolution.value=V.mapSize,A.uniforms.radius.value=V.radius,t.setRenderTarget(V.map),t.clear(),t.renderBufferDirect(W,null,K,A,P,null)}function z(V,W,K){var Z=V<<0|W<<1|K<<2,tt=o[Z];return tt===void 0&&(tt=new Pl({depthPacking:y3,morphTargets:V,skinning:W}),o[Z]=tt),tt}function O(V,W,K){var Z=V<<0|W<<1|K<<2,tt=m[Z];return tt===void 0&&(tt=new Sl({morphTargets:V,skinning:W}),m[Z]=tt),tt}function U(V,W,K,Z,tt,at){var st=V.geometry,nt=null,ct=z,xt=V.customDepthMaterial;if(K.isPointLight===!0&&(ct=O,xt=V.customDistanceMaterial),xt===void 0){var vt=!1;W.morphTargets===!0&&(st.isBufferGeometry===!0?vt=st.morphAttributes&&st.morphAttributes.position&&st.morphAttributes.position.length>0:st.isGeometry===!0&&(vt=st.morphTargets&&st.morphTargets.length>0));var Zt=!1;V.isSkinnedMesh===!0&&(W.skinning===!0?Zt=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",V));var ce=V.isInstancedMesh===!0;nt=ct(vt,Zt,ce)}else nt=xt;if(t.localClippingEnabled&&W.clipShadows===!0&&W.clippingPlanes.length!==0){var le=nt.uuid,fe=W.uuid,de=y[le];de===void 0&&(de={},y[le]=de);var Le=de[fe];Le===void 0&&(Le=nt.clone(),de[fe]=Le),nt=Le}return nt.visible=W.visible,nt.wireframe=W.wireframe,at===Hh?nt.side=W.shadowSide!==null?W.shadowSide:W.side:nt.side=W.shadowSide!==null?W.shadowSide:x[W.side],nt.clipShadows=W.clipShadows,nt.clippingPlanes=W.clippingPlanes,nt.clipIntersection=W.clipIntersection,nt.wireframeLinewidth=W.wireframeLinewidth,nt.linewidth=W.linewidth,K.isPointLight===!0&&nt.isMeshDistanceMaterial===!0&&(nt.referencePosition.setFromMatrixPosition(K.matrixWorld),nt.nearDistance=Z,nt.farDistance=tt),nt}function H(V,W,K,Z,tt){if(V.visible!==!1){var at=V.layers.test(W.layers);if(at&&(V.isMesh||V.isLine||V.isPoints)&&(V.castShadow||V.receiveShadow&&tt===Hh)&&(!V.frustumCulled||r.intersectsObject(V))){V.modelViewMatrix.multiplyMatrices(K.matrixWorldInverse,V.matrixWorld);var st=e.update(V),nt=V.material;if(Array.isArray(nt))for(var ct=st.groups,xt=0,vt=ct.length;xt<vt;xt++){var Zt=ct[xt],ce=nt[Zt.materialIndex];if(ce&&ce.visible){var le=U(V,ce,Z,K.near,K.far,tt);t.renderBufferDirect(K,null,st,le,V,Zt)}}else if(nt.visible){var le=U(V,nt,Z,K.near,K.far,tt);t.renderBufferDirect(K,null,st,le,V,null)}}for(var fe=V.children,de=0,Le=fe.length;de<Le;de++)H(fe[de],W,K,Z,tt)}}}function A4(t,e,n){var r=n.isWebGL2;function s(){var Jt=!1,je=new Mi,rn=null,In=new Mi(0,0,0,0);return{setMask:function(xn){rn!==xn&&!Jt&&(t.colorMask(xn,xn,xn,xn),rn=xn)},setLocked:function(xn){Jt=xn},setClear:function(xn,On,qn,Jn,Ji){Ji===!0&&(xn*=Jn,On*=Jn,qn*=Jn),je.set(xn,On,qn,Jn),In.equals(je)===!1&&(t.clearColor(xn,On,qn,Jn),In.copy(je))},reset:function(){Jt=!1,rn=null,In.set(-1,0,0,0)}}}function u(){var Jt=!1,je=null,rn=null,In=null;return{setTest:function(xn){xn?_t(2929):wt(2929)},setMask:function(xn){je!==xn&&!Jt&&(t.depthMask(xn),je=xn)},setFunc:function(xn){if(rn!==xn){if(xn)switch(xn){case _C:t.depthFunc(512);break;case bC:t.depthFunc(519);break;case MC:t.depthFunc(513);break;case L0:t.depthFunc(515);break;case wC:t.depthFunc(514);break;case AC:t.depthFunc(518);break;case EC:t.depthFunc(516);break;case TC:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);rn=xn}},setLocked:function(xn){Jt=xn},setClear:function(xn){In!==xn&&(t.clearDepth(xn),In=xn)},reset:function(){Jt=!1,je=null,rn=null,In=null}}}function h(){var Jt=!1,je=null,rn=null,In=null,xn=null,On=null,qn=null,Jn=null,Ji=null;return{setTest:function(jn){Jt||(jn?_t(2960):wt(2960))},setMask:function(jn){je!==jn&&!Jt&&(t.stencilMask(jn),je=jn)},setFunc:function(jn,Bi,oi){(rn!==jn||In!==Bi||xn!==oi)&&(t.stencilFunc(jn,Bi,oi),rn=jn,In=Bi,xn=oi)},setOp:function(jn,Bi,oi){(On!==jn||qn!==Bi||Jn!==oi)&&(t.stencilOp(jn,Bi,oi),On=jn,qn=Bi,Jn=oi)},setLocked:function(jn){Jt=jn},setClear:function(jn){Ji!==jn&&(t.clearStencil(jn),Ji=jn)},reset:function(){Jt=!1,je=null,rn=null,In=null,xn=null,On=null,qn=null,Jn=null,Ji=null}}}var o=new s,m=new u,y=new h,x=t.getParameter(34921),M=new Uint8Array(x),A=new Uint8Array(x),T=new Uint8Array(x),P={},D=null,k=null,z=null,O=null,U=null,H=null,V=null,W=null,K=null,Z=!1,tt=null,at=null,st=null,nt=null,ct=null,xt=t.getParameter(35661),vt=!1,Zt=0,ce=t.getParameter(7938);ce.indexOf("WebGL")!==-1?(Zt=parseFloat(/^WebGL\ ([0-9])/.exec(ce)[1]),vt=Zt>=1):ce.indexOf("OpenGL ES")!==-1&&(Zt=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ce)[1]),vt=Zt>=2);var le=null,fe={},de=new Mi,Le=new Mi;function Lt(Jt,je,rn){var In=new Uint8Array(4),xn=t.createTexture();t.bindTexture(Jt,xn),t.texParameteri(Jt,10241,9728),t.texParameteri(Jt,10240,9728);for(var On=0;On<rn;On++)t.texImage2D(je+On,0,6408,1,1,0,6408,5121,In);return xn}var bt={};bt[3553]=Lt(3553,3553,1),bt[34067]=Lt(34067,34069,6),o.setClear(0,0,0,1),m.setClear(1),y.setClear(0),_t(2929),m.setFunc(L0),We(!1),yt(sb),_t(2884),pe(ya);function qt(){for(var Jt=0,je=M.length;Jt<je;Jt++)M[Jt]=0}function Wt(Jt){Nt(Jt,0)}function Nt(Jt,je){if(M[Jt]=1,A[Jt]===0&&(t.enableVertexAttribArray(Jt),A[Jt]=1),T[Jt]!==je){var rn=r?t:e.get("ANGLE_instanced_arrays");rn[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Jt,je),T[Jt]=je}}function se(){for(var Jt=0,je=A.length;Jt!==je;++Jt)A[Jt]!==M[Jt]&&(t.disableVertexAttribArray(Jt),A[Jt]=0)}function _t(Jt){P[Jt]!==!0&&(t.enable(Jt),P[Jt]=!0)}function wt(Jt){P[Jt]!==!1&&(t.disable(Jt),P[Jt]=!1)}function Ct(Jt){return D!==Jt?(t.useProgram(Jt),D=Jt,!0):!1}var Mt={[Lc]:32774,[cC]:32778,[uC]:32779};if(r)Mt[pb]=32775,Mt[fb]=32776;else{var jt=e.get("EXT_blend_minmax");jt!==null&&(Mt[pb]=jt.MIN_EXT,Mt[fb]=jt.MAX_EXT)}var ee={[hC]:0,[dC]:1,[pC]:768,[mb]:770,[vC]:776,[yC]:774,[mC]:772,[fC]:769,[gb]:771,[xC]:775,[gC]:773};function pe(Jt,je,rn,In,xn,On,qn,Jn){if(Jt===ya){k&&(wt(3042),k=!1);return}if(k||(_t(3042),k=!0),Jt!==lC){if(Jt!==z||Jn!==Z){if((O!==Lc||V!==Lc)&&(t.blendEquation(32774),O=Lc,V=Lc),Jn)switch(Jt){case qh:t.blendFuncSeparate(1,771,1,771);break;case ub:t.blendFunc(1,1);break;case hb:t.blendFuncSeparate(0,0,769,771);break;case db:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Jt);break}else switch(Jt){case qh:t.blendFuncSeparate(770,771,1,771);break;case ub:t.blendFunc(770,1);break;case hb:t.blendFunc(0,769);break;case db:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Jt);break}U=null,H=null,W=null,K=null,z=Jt,Z=Jn}return}xn=xn||je,On=On||rn,qn=qn||In,(je!==O||xn!==V)&&(t.blendEquationSeparate(Mt[je],Mt[xn]),O=je,V=xn),(rn!==U||In!==H||On!==W||qn!==K)&&(t.blendFuncSeparate(ee[rn],ee[In],ee[On],ee[qn]),U=rn,H=In,W=On,K=qn),z=Jt,Z=null}function Te(Jt,je){Jt.side===Wh?wt(2884):_t(2884);var rn=Jt.side===lr;je&&(rn=!rn),We(rn),Jt.blending===qh&&Jt.transparent===!1?pe(ya):pe(Jt.blending,Jt.blendEquation,Jt.blendSrc,Jt.blendDst,Jt.blendEquationAlpha,Jt.blendSrcAlpha,Jt.blendDstAlpha,Jt.premultipliedAlpha),m.setFunc(Jt.depthFunc),m.setTest(Jt.depthTest),m.setMask(Jt.depthWrite),o.setMask(Jt.colorWrite);var In=Jt.stencilWrite;y.setTest(In),In&&(y.setMask(Jt.stencilWriteMask),y.setFunc(Jt.stencilFunc,Jt.stencilRef,Jt.stencilFuncMask),y.setOp(Jt.stencilFail,Jt.stencilZFail,Jt.stencilZPass)),Ee(Jt.polygonOffset,Jt.polygonOffsetFactor,Jt.polygonOffsetUnits)}function We(Jt){tt!==Jt&&(Jt?t.frontFace(2304):t.frontFace(2305),tt=Jt)}function yt(Jt){Jt!==rC?(_t(2884),Jt!==at&&(Jt===sb?t.cullFace(1029):Jt===oC?t.cullFace(1028):t.cullFace(1032))):wt(2884),at=Jt}function St(Jt){Jt!==st&&(vt&&t.lineWidth(Jt),st=Jt)}function Ee(Jt,je,rn){Jt?(_t(32823),(nt!==je||ct!==rn)&&(t.polygonOffset(je,rn),nt=je,ct=rn)):wt(32823)}function be(Jt){Jt?_t(3089):wt(3089)}function En(Jt){Jt===void 0&&(Jt=33984+xt-1),le!==Jt&&(t.activeTexture(Jt),le=Jt)}function mn(Jt,je){le===null&&En();var rn=fe[le];rn===void 0&&(rn={type:void 0,texture:void 0},fe[le]=rn),(rn.type!==Jt||rn.texture!==je)&&(t.bindTexture(Jt,je||bt[Jt]),rn.type=Jt,rn.texture=je)}function an(){var Jt=fe[le];Jt!==void 0&&Jt.type!==void 0&&(t.bindTexture(Jt.type,null),Jt.type=void 0,Jt.texture=void 0)}function yn(){try{t.compressedTexImage2D.apply(t,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}}function Tn(){try{t.texImage2D.apply(t,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}}function pn(){try{t.texImage3D.apply(t,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}}function qe(Jt){de.equals(Jt)===!1&&(t.scissor(Jt.x,Jt.y,Jt.z,Jt.w),de.copy(Jt))}function hn(Jt){Le.equals(Jt)===!1&&(t.viewport(Jt.x,Jt.y,Jt.z,Jt.w),Le.copy(Jt))}function Je(){for(var Jt=0;Jt<A.length;Jt++)A[Jt]===1&&(t.disableVertexAttribArray(Jt),A[Jt]=0);P={},le=null,fe={},D=null,z=null,tt=null,at=null,o.reset(),m.reset(),y.reset()}return{buffers:{color:o,depth:m,stencil:y},initAttributes:qt,enableAttribute:Wt,enableAttributeAndDivisor:Nt,disableUnusedAttributes:se,enable:_t,disable:wt,useProgram:Ct,setBlending:pe,setMaterial:Te,setFlipSided:We,setCullFace:yt,setLineWidth:St,setPolygonOffset:Ee,setScissorTest:be,activeTexture:En,bindTexture:mn,unbindTexture:an,compressedTexImage2D:yn,texImage2D:Tn,texImage3D:pn,scissor:qe,viewport:hn,reset:Je}}function E4(t,e,n,r,s,u,h){var o=s.isWebGL2,m=s.maxTextures,y=s.maxCubemapSize,x=s.maxTextureSize,M=s.maxSamples,A=new WeakMap,T,P=!1;try{P=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(yt){}function D(yt,St){return P?new OffscreenCanvas(yt,St):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function k(yt,St,Ee,be){var En=1;if((yt.width>be||yt.height>be)&&(En=be/Math.max(yt.width,yt.height)),En<1||St===!0)if(typeof HTMLImageElement!="undefined"&&yt instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&yt instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&yt instanceof ImageBitmap){var mn=St?Xn.floorPowerOfTwo:Math.floor,an=mn(En*yt.width),yn=mn(En*yt.height);T===void 0&&(T=D(an,yn));var Tn=Ee?D(an,yn):T;Tn.width=an,Tn.height=yn;var pn=Tn.getContext("2d");return pn.drawImage(yt,0,0,an,yn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+yt.width+"x"+yt.height+") to ("+an+"x"+yn+")."),Tn}else return"data"in yt&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+yt.width+"x"+yt.height+")."),yt;return yt}function z(yt){return Xn.isPowerOfTwo(yt.width)&&Xn.isPowerOfTwo(yt.height)}function O(yt){return o?!1:yt.wrapS!==Dr||yt.wrapT!==Dr||yt.minFilter!==Yi&&yt.minFilter!==$i}function U(yt,St){return yt.generateMipmaps&&St&&yt.minFilter!==Yi&&yt.minFilter!==$i}function H(yt,St,Ee,be){t.generateMipmap(yt);var En=r.get(St);En.__maxMipLevel=Math.log(Math.max(Ee,be))*Math.LOG2E}function V(yt,St,Ee){if(o===!1)return St;if(yt!==null){if(t[yt]!==void 0)return t[yt];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+yt+"'")}var be=St;return St===6403&&(Ee===5126&&(be=33326),Ee===5131&&(be=33325),Ee===5121&&(be=33321)),St===6407&&(Ee===5126&&(be=34837),Ee===5131&&(be=34843),Ee===5121&&(be=32849)),St===6408&&(Ee===5126&&(be=34836),Ee===5131&&(be=34842),Ee===5121&&(be=32856)),be===33325||be===33326||be===34842||be===34836?e.get("EXT_color_buffer_float"):(be===34843||be===34837)&&console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),be}function W(yt){return yt===Yi||yt===Hf||yt===Wf?9728:9729}function K(yt){var St=yt.target;St.removeEventListener("dispose",K),tt(St),St.isVideoTexture&&A.delete(St),h.memory.textures--}function Z(yt){var St=yt.target;St.removeEventListener("dispose",Z),at(St),h.memory.textures--}function tt(yt){var St=r.get(yt);St.__webglInit!==void 0&&(t.deleteTexture(St.__webglTexture),r.remove(yt))}function at(yt){var St=r.get(yt),Ee=r.get(yt.texture);if(yt){if(Ee.__webglTexture!==void 0&&t.deleteTexture(Ee.__webglTexture),yt.depthTexture&&yt.depthTexture.dispose(),yt.isWebGLCubeRenderTarget)for(var be=0;be<6;be++)t.deleteFramebuffer(St.__webglFramebuffer[be]),St.__webglDepthbuffer&&t.deleteRenderbuffer(St.__webglDepthbuffer[be]);else t.deleteFramebuffer(St.__webglFramebuffer),St.__webglDepthbuffer&&t.deleteRenderbuffer(St.__webglDepthbuffer);if(yt.isWebGLMultiviewRenderTarget){t.deleteTexture(St.__webglColorTexture),t.deleteTexture(St.__webglDepthStencilTexture),h.memory.textures-=2;for(var be=0,En=St.__webglViewFramebuffers.length;be<En;be++)t.deleteFramebuffer(St.__webglViewFramebuffers[be])}r.remove(yt.texture),r.remove(yt)}}var st=0;function nt(){st=0}function ct(){var yt=st;return yt>=m&&console.warn("THREE.WebGLTextures: Trying to use "+yt+" texture units while this GPU supports only "+m),st+=1,yt}function xt(yt,St){var Ee=r.get(yt);if(yt.isVideoTexture&&jt(yt),yt.version>0&&Ee.__version!==yt.version){var be=yt.image;if(be===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(be.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{bt(Ee,yt,St);return}}n.activeTexture(33984+St),n.bindTexture(3553,Ee.__webglTexture)}function vt(yt,St){var Ee=r.get(yt);if(yt.version>0&&Ee.__version!==yt.version){bt(Ee,yt,St);return}n.activeTexture(33984+St),n.bindTexture(35866,Ee.__webglTexture)}function Zt(yt,St){var Ee=r.get(yt);if(yt.version>0&&Ee.__version!==yt.version){bt(Ee,yt,St);return}n.activeTexture(33984+St),n.bindTexture(32879,Ee.__webglTexture)}function ce(yt,St){if(yt.image.length===6){var Ee=r.get(yt);if(yt.version>0&&Ee.__version!==yt.version){Lt(Ee,yt),n.activeTexture(33984+St),n.bindTexture(34067,Ee.__webglTexture),t.pixelStorei(37440,yt.flipY);for(var be=yt&&(yt.isCompressedTexture||yt.image[0].isCompressedTexture),En=yt.image[0]&&yt.image[0].isDataTexture,mn=[],an=0;an<6;an++)!be&&!En?mn[an]=k(yt.image[an],!1,!0,y):mn[an]=En?yt.image[an].image:yt.image[an];var yn=mn[0],Tn=z(yn)||o,pn=u.convert(yt.format),qe=u.convert(yt.type),hn=V(yt.internalFormat,pn,qe);Le(34067,yt,Tn);var Je;if(be){for(var an=0;an<6;an++){Je=mn[an].mipmaps;for(var Jt=0;Jt<Je.length;Jt++){var je=Je[Jt];yt.format!==No&&yt.format!==Ns?pn!==null?n.compressedTexImage2D(34069+an,Jt,hn,je.width,je.height,0,je.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+an,Jt,hn,je.width,je.height,0,pn,qe,je.data)}}Ee.__maxMipLevel=Je.length-1}else{Je=yt.mipmaps;for(var an=0;an<6;an++)if(En){n.texImage2D(34069+an,0,hn,mn[an].width,mn[an].height,0,pn,qe,mn[an].data);for(var Jt=0;Jt<Je.length;Jt++){var je=Je[Jt],rn=je.image[an].image;n.texImage2D(34069+an,Jt+1,hn,rn.width,rn.height,0,pn,qe,rn.data)}}else{n.texImage2D(34069+an,0,hn,pn,qe,mn[an]);for(var Jt=0;Jt<Je.length;Jt++){var je=Je[Jt];n.texImage2D(34069+an,Jt+1,hn,pn,qe,je.image[an])}}Ee.__maxMipLevel=Je.length}U(yt,Tn)&&H(34067,yt,yn.width,yn.height),Ee.__version=yt.version,yt.onUpdate&&yt.onUpdate(yt)}else n.activeTexture(33984+St),n.bindTexture(34067,Ee.__webglTexture)}}function le(yt,St){n.activeTexture(33984+St),n.bindTexture(34067,r.get(yt).__webglTexture)}var fe={[xl]:10497,[Dr]:33071,[Xh]:33648},de={[Yi]:9728,[Hf]:9984,[Wf]:9986,[$i]:9729,[U0]:9985,[Ic]:9987};function Le(yt,St,Ee){Ee?(t.texParameteri(yt,10242,fe[St.wrapS]),t.texParameteri(yt,10243,fe[St.wrapT]),(yt===32879||yt===35866)&&t.texParameteri(yt,32882,fe[St.wrapR]),t.texParameteri(yt,10240,de[St.magFilter]),t.texParameteri(yt,10241,de[St.minFilter])):(t.texParameteri(yt,10242,33071),t.texParameteri(yt,10243,33071),(yt===32879||yt===35866)&&t.texParameteri(yt,32882,33071),(St.wrapS!==Dr||St.wrapT!==Dr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(yt,10240,W(St.magFilter)),t.texParameteri(yt,10241,W(St.minFilter)),St.minFilter!==Yi&&St.minFilter!==$i&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var be=e.get("EXT_texture_filter_anisotropic");if(be){if(St.type===Kh&&e.get("OES_texture_float_linear")===null||St.type===V0&&(o||e.get("OES_texture_half_float_linear"))===null)return;(St.anisotropy>1||r.get(St).__currentAnisotropy)&&(t.texParameterf(yt,be.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(St.anisotropy,s.getMaxAnisotropy())),r.get(St).__currentAnisotropy=St.anisotropy)}}function Lt(yt,St){yt.__webglInit===void 0&&(yt.__webglInit=!0,St.addEventListener("dispose",K),yt.__webglTexture=t.createTexture(),h.memory.textures++)}function bt(yt,St,Ee){var be=3553;St.isDataTexture2DArray&&(be=35866),St.isDataTexture3D&&(be=32879),Lt(yt,St),n.activeTexture(33984+Ee),n.bindTexture(be,yt.__webglTexture),t.pixelStorei(37440,St.flipY),t.pixelStorei(37441,St.premultiplyAlpha),t.pixelStorei(3317,St.unpackAlignment);var En=O(St)&&z(St.image)===!1,mn=k(St.image,En,!1,x),an=z(mn)||o,yn=u.convert(St.format),Tn=u.convert(St.type),pn=V(St.internalFormat,yn,Tn);Le(be,St,an);var qe,hn=St.mipmaps;if(St.isDepthTexture){if(pn=6402,St.type===Kh){if(o===!1)throw new Error("Float Depth Texture only supported in WebGL2.0");pn=36012}else o&&(pn=33189);St.format===kc&&pn===6402&&St.type!==Yf&&St.type!==vb&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),St.type=Yf,Tn=u.convert(St.type)),St.format===Zh&&(pn=34041,St.type!==Xf&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),St.type=Xf,Tn=u.convert(St.type))),n.texImage2D(3553,0,pn,mn.width,mn.height,0,yn,Tn,null)}else if(St.isDataTexture)if(hn.length>0&&an){for(var Je=0,Jt=hn.length;Je<Jt;Je++)qe=hn[Je],n.texImage2D(3553,Je,pn,qe.width,qe.height,0,yn,Tn,qe.data);St.generateMipmaps=!1,yt.__maxMipLevel=hn.length-1}else n.texImage2D(3553,0,pn,mn.width,mn.height,0,yn,Tn,mn.data),yt.__maxMipLevel=0;else if(St.isCompressedTexture){for(var Je=0,Jt=hn.length;Je<Jt;Je++)qe=hn[Je],St.format!==No&&St.format!==Ns?yn!==null?n.compressedTexImage2D(3553,Je,pn,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,Je,pn,qe.width,qe.height,0,yn,Tn,qe.data);yt.__maxMipLevel=hn.length-1}else if(St.isDataTexture2DArray)n.texImage3D(35866,0,pn,mn.width,mn.height,mn.depth,0,yn,Tn,mn.data),yt.__maxMipLevel=0;else if(St.isDataTexture3D)n.texImage3D(32879,0,pn,mn.width,mn.height,mn.depth,0,yn,Tn,mn.data),yt.__maxMipLevel=0;else if(hn.length>0&&an){for(var Je=0,Jt=hn.length;Je<Jt;Je++)qe=hn[Je],n.texImage2D(3553,Je,pn,yn,Tn,qe);St.generateMipmaps=!1,yt.__maxMipLevel=hn.length-1}else n.texImage2D(3553,0,pn,yn,Tn,mn),yt.__maxMipLevel=0;U(St,an)&&H(be,St,mn.width,mn.height),yt.__version=St.version,St.onUpdate&&St.onUpdate(St)}function qt(yt,St,Ee,be){var En=u.convert(St.texture.format),mn=u.convert(St.texture.type),an=V(St.texture.internalFormat,En,mn);n.texImage2D(be,0,an,St.width,St.height,0,En,mn,null),t.bindFramebuffer(36160,yt),t.framebufferTexture2D(36160,Ee,be,r.get(St.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function Wt(yt,St,Ee){if(t.bindRenderbuffer(36161,yt),St.depthBuffer&&!St.stencilBuffer){if(Ee){var be=Mt(St);t.renderbufferStorageMultisample(36161,be,33189,St.width,St.height)}else t.renderbufferStorage(36161,33189,St.width,St.height);t.framebufferRenderbuffer(36160,36096,36161,yt)}else if(St.depthBuffer&&St.stencilBuffer){if(Ee){var be=Mt(St);t.renderbufferStorageMultisample(36161,be,35056,St.width,St.height)}else t.renderbufferStorage(36161,34041,St.width,St.height);t.framebufferRenderbuffer(36160,33306,36161,yt)}else{var En=u.convert(St.texture.format),mn=u.convert(St.texture.type),an=V(St.texture.internalFormat,En,mn);if(Ee){var be=Mt(St);t.renderbufferStorageMultisample(36161,be,an,St.width,St.height)}else t.renderbufferStorage(36161,an,St.width,St.height)}t.bindRenderbuffer(36161,null)}function Nt(yt,St){var Ee=St&&St.isWebGLCubeRenderTarget;if(Ee)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,yt),!(St.depthTexture&&St.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(St.depthTexture).__webglTexture||St.depthTexture.image.width!==St.width||St.depthTexture.image.height!==St.height)&&(St.depthTexture.image.width=St.width,St.depthTexture.image.height=St.height,St.depthTexture.needsUpdate=!0),xt(St.depthTexture,0);var be=r.get(St.depthTexture).__webglTexture;if(St.depthTexture.format===kc)t.framebufferTexture2D(36160,36096,3553,be,0);else if(St.depthTexture.format===Zh)t.framebufferTexture2D(36160,33306,3553,be,0);else throw new Error("Unknown depthTexture format")}function se(yt){var St=r.get(yt),Ee=yt.isWebGLCubeRenderTarget===!0;if(yt.depthTexture){if(Ee)throw new Error("target.depthTexture not supported in Cube render targets");Nt(St.__webglFramebuffer,yt)}else if(Ee){St.__webglDepthbuffer=[];for(var be=0;be<6;be++)t.bindFramebuffer(36160,St.__webglFramebuffer[be]),St.__webglDepthbuffer[be]=t.createRenderbuffer(),Wt(St.__webglDepthbuffer[be],yt)}else t.bindFramebuffer(36160,St.__webglFramebuffer),St.__webglDepthbuffer=t.createRenderbuffer(),Wt(St.__webglDepthbuffer,yt);t.bindFramebuffer(36160,null)}function _t(yt){var St=r.get(yt),Ee=r.get(yt.texture);yt.addEventListener("dispose",Z),Ee.__webglTexture=t.createTexture(),h.memory.textures++;var be=yt.isWebGLCubeRenderTarget===!0,En=yt.isWebGLMultisampleRenderTarget===!0,mn=yt.isWebGLMultiviewRenderTarget===!0,an=z(yt)||o;if(be){St.__webglFramebuffer=[];for(var yn=0;yn<6;yn++)St.__webglFramebuffer[yn]=t.createFramebuffer()}else if(St.__webglFramebuffer=t.createFramebuffer(),En)if(o){St.__webglMultisampledFramebuffer=t.createFramebuffer(),St.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,St.__webglColorRenderbuffer);var Tn=u.convert(yt.texture.format),pn=u.convert(yt.texture.type),qe=V(yt.texture.internalFormat,Tn,pn),hn=Mt(yt);t.renderbufferStorageMultisample(36161,hn,qe,yt.width,yt.height),t.bindFramebuffer(36160,St.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,St.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),yt.depthBuffer&&(St.__webglDepthRenderbuffer=t.createRenderbuffer(),Wt(St.__webglDepthRenderbuffer,yt,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(mn){var Je=yt.width,Jt=yt.height,je=yt.numViews;t.bindFramebuffer(36160,St.__webglFramebuffer);var rn=e.get("OVR_multiview2");h.memory.textures+=2;var In=t.createTexture();t.bindTexture(35866,In),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,32856,Je,Jt,je,0,6408,5121,null),rn.framebufferTextureMultiviewOVR(36160,36064,In,0,0,je);var xn=t.createTexture();t.bindTexture(35866,xn),t.texParameteri(35866,10240,9728),t.texParameteri(35866,10241,9728),t.texImage3D(35866,0,35056,Je,Jt,je,0,34041,34042,null),rn.framebufferTextureMultiviewOVR(36160,33306,xn,0,0,je);for(var On=new Array(je),yn=0;yn<je;++yn)On[yn]=t.createFramebuffer(),t.bindFramebuffer(36160,On[yn]),t.framebufferTextureLayer(36160,36064,In,0,yn);St.__webglColorTexture=In,St.__webglDepthStencilTexture=xn,St.__webglViewFramebuffers=On,t.bindFramebuffer(36160,null),t.bindTexture(35866,null)}if(be){n.bindTexture(34067,Ee.__webglTexture),Le(34067,yt.texture,an);for(var yn=0;yn<6;yn++)qt(St.__webglFramebuffer[yn],yt,36064,34069+yn);U(yt.texture,an)&&H(34067,yt.texture,yt.width,yt.height),n.bindTexture(34067,null)}else mn||(n.bindTexture(3553,Ee.__webglTexture),Le(3553,yt.texture,an),qt(St.__webglFramebuffer,yt,36064,3553),U(yt.texture,an)&&H(3553,yt.texture,yt.width,yt.height),n.bindTexture(3553,null));yt.depthBuffer&&se(yt)}function wt(yt){var St=yt.texture,Ee=z(yt)||o;if(U(St,Ee)){var be=yt.isWebGLCubeRenderTarget?34067:3553,En=r.get(St).__webglTexture;n.bindTexture(be,En),H(be,St,yt.width,yt.height),n.bindTexture(be,null)}}function Ct(yt){if(yt.isWebGLMultisampleRenderTarget)if(o){var St=r.get(yt);t.bindFramebuffer(36008,St.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,St.__webglFramebuffer);var Ee=yt.width,be=yt.height,En=16384;yt.depthBuffer&&(En|=256),yt.stencilBuffer&&(En|=1024),t.blitFramebuffer(0,0,Ee,be,0,0,Ee,be,En,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function Mt(yt){return o&&yt.isWebGLMultisampleRenderTarget?Math.min(M,yt.samples):0}function jt(yt){var St=h.render.frame;A.get(yt)!==St&&(A.set(yt,St),yt.update())}var ee=!1,pe=!1;function Te(yt,St){yt&&yt.isWebGLRenderTarget&&(ee===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),ee=!0),yt=yt.texture),xt(yt,St)}function We(yt,St){yt&&yt.isWebGLCubeRenderTarget&&(pe===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),pe=!0),yt=yt.texture),yt&&yt.isCubeTexture||Array.isArray(yt.image)&&yt.image.length===6?ce(yt,St):le(yt,St)}this.allocateTextureUnit=ct,this.resetTextureUnits=nt,this.setTexture2D=xt,this.setTexture2DArray=vt,this.setTexture3D=Zt,this.setTextureCube=ce,this.setTextureCubeDynamic=le,this.setupRenderTarget=_t,this.updateRenderTargetMipmap=wt,this.updateMultisampleRenderTarget=Ct,this.safeSetTexture2D=Te,this.safeSetTextureCube=We}function T4(t,e,n){var r=n.isWebGL2;function s(u){var h;if(u===qf)return 5121;if(u===FC)return 32819;if(u===zC)return 32820;if(u===NC)return 33635;if(u===IC)return 5120;if(u===kC)return 5122;if(u===Yf)return 5123;if(u===BC)return 5124;if(u===vb)return 5125;if(u===Kh)return 5126;if(u===V0)return r?5131:(h=e.get("OES_texture_half_float"),h!==null?h.HALF_FLOAT_OES:null);if(u===UC)return 6406;if(u===Ns)return 6407;if(u===No)return 6408;if(u===VC)return 6409;if(u===GC)return 6410;if(u===kc)return 6402;if(u===Zh)return 34041;if(u===jC)return 6403;if(u===HC)return 36244;if(u===WC)return 33319;if(u===qC)return 33320;if(u===YC)return 36248;if(u===XC)return 36249;if(u===_b||u===bb||u===Mb||u===wb)if(h=e.get("WEBGL_compressed_texture_s3tc"),h!==null){if(u===_b)return h.COMPRESSED_RGB_S3TC_DXT1_EXT;if(u===bb)return h.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(u===Mb)return h.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(u===wb)return h.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(u===Ab||u===Eb||u===Tb||u===Pb)if(h=e.get("WEBGL_compressed_texture_pvrtc"),h!==null){if(u===Ab)return h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(u===Eb)return h.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(u===Tb)return h.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(u===Pb)return h.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(u===KC)return h=e.get("WEBGL_compressed_texture_etc1"),h!==null?h.COMPRESSED_RGB_ETC1_WEBGL:null;if(u===ZC||u===JC||u===QC||u===$C||u===t3||u===e3||u===n3||u===i3||u===r3||u===o3||u===s3||u===a3||u===l3||u===c3)return h=e.get("WEBGL_compressed_texture_astc"),h!==null?u:null;if(u===Xf)return r?34042:(h=e.get("WEBGL_depth_texture"),h!==null?h.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:s}}function yx(t,e,n,r){Rr.call(this,t,e,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}yx.prototype=Object.assign(Object.create(Rr.prototype),{constructor:yx,isWebGLMultiviewRenderTarget:!0,copy:function(t){return Rr.prototype.copy.call(this,t),this.numViews=t.numViews,this},setNumViews:function(t){return this.numViews!==t&&(this.numViews=t,this.dispose()),this}});function P4(t,e){var n=2,r=t.extensions,s=t.properties,u,h,o,m,y,x,M,A=0;function T(){if(M===void 0){var K=r.get("OVR_multiview2");if(M=K!==null&&e.getContextAttributes().antialias===!1,M){A=e.getParameter(K.MAX_VIEWS_OVR),u=new yx(0,0,n),x=new ke,m=[],o=[],y=[];for(var Z=0;Z<A;Z++)m[Z]=new Kn,o[Z]=new _r}}return M}function P(K){return K.isArrayCamera?K.cameras:(y[0]=K,y)}function D(K,Z){for(var tt=P(K),at=0;at<tt.length;at++)m[at].copy(tt[at].projectionMatrix);Z.setValue(e,"projectionMatrices",m)}function k(K,Z){for(var tt=P(K),at=0;at<tt.length;at++)m[at].copy(tt[at].matrixWorldInverse);Z.setValue(e,"viewMatrices",m)}function z(K,Z,tt){for(var at=P(Z),st=0;st<at.length;st++)m[st].multiplyMatrices(at[st].matrixWorldInverse,K.matrixWorld),o[st].getNormalMatrix(m[st]);tt.setValue(e,"modelViewMatrices",m),tt.setValue(e,"normalMatrices",o)}function O(K){if(K.isArrayCamera===void 0)return!0;var Z=K.cameras;if(Z.length>A)return!1;for(var tt=1,at=Z.length;tt<at;tt++)if(Z[0].viewport.z!==Z[tt].viewport.z||Z[0].viewport.w!==Z[tt].viewport.w)return!1;return!0}function U(K){if(h?x.set(h.width,h.height):t.getDrawingBufferSize(x),K.isArrayCamera){var Z=K.cameras[0].viewport;u.setSize(Z.z,Z.w),u.setNumViews(K.cameras.length)}else u.setSize(x.x,x.y),u.setNumViews(n)}function H(K){O(K)!==!1&&(h=t.getRenderTarget(),U(K),t.setRenderTarget(u))}function V(K){u===t.getRenderTarget()&&(t.setRenderTarget(h),W(K))}function W(K){var Z=u,tt=Z.numViews,at=s.get(Z).__webglViewFramebuffers,st=Z.width,nt=Z.height;if(K.isArrayCamera)for(var ct=0;ct<tt;ct++){var xt=K.cameras[ct].viewport,vt=xt.x,Zt=xt.y,ce=vt+xt.z,le=Zt+xt.w;e.bindFramebuffer(36008,at[ct]),e.blitFramebuffer(0,0,st,nt,vt,Zt,ce,le,16384,9728)}else e.bindFramebuffer(36008,at[0]),e.blitFramebuffer(0,0,st,nt,0,0,x.x,x.y,16384,9728)}this.isAvailable=T,this.attachCamera=H,this.detachCamera=V,this.updateCameraProjectionMatricesUniform=D,this.updateCameraViewMatricesUniform=k,this.updateObjectMatricesUniforms=z}function xx(t){er.call(this),this.cameras=t||[]}xx.prototype=Object.assign(Object.create(er.prototype),{constructor:xx,isArrayCamera:!0});function Cl(){cn.call(this),this.type="Group"}Cl.prototype=Object.assign(Object.create(cn.prototype),{constructor:Cl,isGroup:!0});function gM(t,e){var n=this,r=null,s=null,u="local-floor",h=null,o=[],m=new Map,y=new er;y.layers.enable(1),y.viewport=new Mi;var x=new er;x.layers.enable(2),x.viewport=new Mi;var M=new xx([y,x]);M.layers.enable(1),M.layers.enable(2);var A=null,T=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(tt){var at=o[tt];return at===void 0&&(at={},o[tt]=at),at.targetRay===void 0&&(at.targetRay=new Cl,at.targetRay.matrixAutoUpdate=!1,at.targetRay.visible=!1),at.targetRay},this.getControllerGrip=function(tt){var at=o[tt];return at===void 0&&(at={},o[tt]=at),at.grip===void 0&&(at.grip=new Cl,at.grip.matrixAutoUpdate=!1,at.grip.visible=!1),at.grip};function P(tt){var at=m.get(tt.inputSource);at&&(at.targetRay&&at.targetRay.dispatchEvent({type:tt.type}),at.grip&&at.grip.dispatchEvent({type:tt.type}))}function D(){m.forEach(function(tt,at){tt.targetRay&&(tt.targetRay.dispatchEvent({type:"disconnected",data:at}),tt.targetRay.visible=!1),tt.grip&&(tt.grip.dispatchEvent({type:"disconnected",data:at}),tt.grip.visible=!1)}),m.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),Z.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function k(tt){s=tt,Z.setContext(r),Z.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(tt){u=tt},this.getReferenceSpace=function(){return s},this.getSession=function(){return r},this.setSession=function(tt){if(r=tt,r!==null){r.addEventListener("select",P),r.addEventListener("selectstart",P),r.addEventListener("selectend",P),r.addEventListener("squeeze",P),r.addEventListener("squeezestart",P),r.addEventListener("squeezeend",P),r.addEventListener("end",D);var at=e.getContextAttributes(),st={antialias:at.antialias,alpha:at.alpha,depth:at.depth,stencil:at.stencil},nt=new XRWebGLLayer(r,e,st);r.updateRenderState({baseLayer:nt}),r.requestReferenceSpace(u).then(k),r.addEventListener("inputsourceschange",z)}};function z(tt){for(var at=r.inputSources,st=0;st<o.length;st++)m.set(at[st],o[st]);for(var st=0;st<tt.removed.length;st++){var nt=tt.removed[st],ct=m.get(nt);ct&&(ct.targetRay&&ct.targetRay.dispatchEvent({type:"disconnected",data:nt}),ct.grip&&ct.grip.dispatchEvent({type:"disconnected",data:nt}),m.delete(nt))}for(var st=0;st<tt.added.length;st++){var nt=tt.added[st],ct=m.get(nt);ct&&(ct.targetRay&&ct.targetRay.dispatchEvent({type:"connected",data:nt}),ct.grip&&ct.grip.dispatchEvent({type:"connected",data:nt}))}}var O=new kt,U=new kt;function H(tt,at,st){O.setFromMatrixPosition(at.matrixWorld),U.setFromMatrixPosition(st.matrixWorld);var nt=O.distanceTo(U),ct=at.projectionMatrix.elements,xt=st.projectionMatrix.elements,vt=ct[14]/(ct[10]-1),Zt=ct[14]/(ct[10]+1),ce=(ct[9]+1)/ct[5],le=(ct[9]-1)/ct[5],fe=(ct[8]-1)/ct[0],de=(xt[8]+1)/xt[0],Le=vt*fe,Lt=vt*de,bt=nt/(-fe+de),qt=bt*-fe;at.matrixWorld.decompose(tt.position,tt.quaternion,tt.scale),tt.translateX(qt),tt.translateZ(bt),tt.matrixWorld.compose(tt.position,tt.quaternion,tt.scale),tt.matrixWorldInverse.getInverse(tt.matrixWorld);var Wt=vt+bt,Nt=Zt+bt,se=Le-qt,_t=Lt+(nt-qt),wt=ce*Zt/Nt*Wt,Ct=le*Zt/Nt*Wt;tt.projectionMatrix.makePerspective(se,_t,wt,Ct,Wt,Nt)}function V(tt,at){at===null?tt.matrixWorld.copy(tt.matrix):tt.matrixWorld.multiplyMatrices(at.matrixWorld,tt.matrix),tt.matrixWorldInverse.getInverse(tt.matrixWorld)}this.getCamera=function(tt){M.near=x.near=y.near=tt.near,M.far=x.far=y.far=tt.far,(A!==M.near||T!==M.far)&&(r.updateRenderState({depthNear:M.near,depthFar:M.far}),A=M.near,T=M.far);var at=tt.parent,st=M.cameras;V(M,at);for(var nt=0;nt<st.length;nt++)V(st[nt],at);tt.matrixWorld.copy(M.matrixWorld);for(var ct=tt.children,nt=0,xt=ct.length;nt<xt;nt++)ct[nt].updateMatrixWorld(!0);return H(M,y,x),M};var W=null;function K(tt,at){if(h=at.getViewerPose(s),h!==null){var st=h.views,nt=r.renderState.baseLayer;t.setFramebuffer(nt.framebuffer);for(var ct=0;ct<st.length;ct++){var xt=st[ct],vt=nt.getViewport(xt),Zt=M.cameras[ct];Zt.matrix.fromArray(xt.transform.matrix),Zt.projectionMatrix.fromArray(xt.projectionMatrix),Zt.viewport.set(vt.x,vt.y,vt.width,vt.height),ct===0&&M.matrix.copy(Zt.matrix)}}for(var ce=r.inputSources,ct=0;ct<o.length;ct++){var le=o[ct],fe=ce[ct],de=null,Le=null;fe&&(le.targetRay&&(de=at.getPose(fe.targetRaySpace,s),de!==null&&(le.targetRay.matrix.fromArray(de.transform.matrix),le.targetRay.matrix.decompose(le.targetRay.position,le.targetRay.rotation,le.targetRay.scale))),le.grip&&fe.gripSpace&&(Le=at.getPose(fe.gripSpace,s),Le!==null&&(le.grip.matrix.fromArray(Le.transform.matrix),le.grip.matrix.decompose(le.grip.position,le.grip.rotation,le.grip.scale)))),le.targetRay&&(le.targetRay.visible=de!==null),le.grip&&(le.grip.visible=Le!==null)}W&&W(tt,at)}var Z=new Xb;Z.setAnimationLoop(K),this.setAnimationLoop=function(tt){W=tt},this.dispose=function(){}}Object.assign(gM.prototype,Us.prototype);function yM(t){t=t||{};var e=t.canvas!==void 0?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.context!==void 0?t.context:null,r=t.alpha!==void 0?t.alpha:!1,s=t.depth!==void 0?t.depth:!0,u=t.stencil!==void 0?t.stencil:!0,h=t.antialias!==void 0?t.antialias:!1,o=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,m=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,y=t.powerPreference!==void 0?t.powerPreference:"default",x=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,M=null,A=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=ho,this.physicallyCorrectLights=!1,this.toneMapping=I0,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var T=this,P=!1,D=null,k=0,z=0,O=null,U=null,H=-1,V={geometry:null,program:null,wireframe:!1},W=null,K=null,Z=new Mi,tt=new Mi,at=null,st=e.width,nt=e.height,ct=1,xt=null,vt=null,Zt=new Mi(0,0,st,nt),ce=new Mi(0,0,st,nt),le=!1,fe=new cd,de=new aL,Le=!1,Lt=!1,bt=new Kn,qt=new kt;function Wt(){return O===null?ct:1}var Nt;try{var se={alpha:r,depth:s,stencil:u,antialias:h,premultipliedAlpha:o,preserveDrawingBuffer:m,powerPreference:y,failIfMajorPerformanceCaveat:x,xrCompatible:!0};if(e.addEventListener("webglcontextlost",Je,!1),e.addEventListener("webglcontextrestored",Jt,!1),Nt=n||e.getContext("webgl",se)||e.getContext("experimental-webgl",se),Nt===null)throw e.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");Nt.getShaderPrecisionFormat===void 0&&(Nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(rt){throw console.error("THREE.WebGLRenderer: "+rt.message),rt}var _t,wt,Ct,Mt,jt,ee,pe,Te,We,yt,St,Ee,be,En,mn,an,yn;function Tn(){_t=new lL(Nt),wt=new sL(Nt,_t,t),wt.isWebGL2===!1&&(_t.get("WEBGL_depth_texture"),_t.get("OES_texture_float"),_t.get("OES_texture_half_float"),_t.get("OES_texture_half_float_linear"),_t.get("OES_standard_derivatives"),_t.get("OES_element_index_uint"),_t.get("ANGLE_instanced_arrays")),_t.get("OES_texture_float_linear"),yn=new T4(Nt,_t,wt),Ct=new A4(Nt,_t,wt),Ct.scissor(tt.copy(ce).multiplyScalar(ct).floor()),Ct.viewport(Z.copy(Zt).multiplyScalar(ct).floor()),Mt=new hL,jt=new p4,ee=new E4(Nt,_t,Ct,jt,wt,yn,Mt),pe=new N3(Nt,wt),Te=new cL(Nt,pe,Mt),We=new fL(Nt,Te,pe,Mt),En=new pL(Nt),yt=new d4(T,_t,wt),St=new g4,Ee=new b4,be=new rL(T,Ct,We,o),mn=new oL(Nt,_t,Mt,wt),an=new uL(Nt,_t,Mt,wt),Mt.programs=yt.programs,T.capabilities=wt,T.extensions=_t,T.properties=jt,T.renderLists=St,T.state=Ct,T.info=Mt}Tn();var pn=new gM(T,Nt);this.xr=pn;var qe=new P4(T,Nt),hn=new mM(T,We,wt.maxTextureSize);this.shadowMap=hn,this.getContext=function(){return Nt},this.getContextAttributes=function(){return Nt.getContextAttributes()},this.forceContextLoss=function(){var rt=_t.get("WEBGL_lose_context");rt&&rt.loseContext()},this.forceContextRestore=function(){var rt=_t.get("WEBGL_lose_context");rt&&rt.restoreContext()},this.getPixelRatio=function(){return ct},this.setPixelRatio=function(rt){rt!==void 0&&(ct=rt,this.setSize(st,nt,!1))},this.getSize=function(rt){return rt===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),rt=new ke),rt.set(st,nt)},this.setSize=function(rt,ht,Vt){if(pn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}st=rt,nt=ht,e.width=Math.floor(rt*ct),e.height=Math.floor(ht*ct),Vt!==!1&&(e.style.width=rt+"px",e.style.height=ht+"px"),this.setViewport(0,0,rt,ht)},this.getDrawingBufferSize=function(rt){return rt===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),rt=new ke),rt.set(st*ct,nt*ct).floor()},this.setDrawingBufferSize=function(rt,ht,Vt){st=rt,nt=ht,ct=Vt,e.width=Math.floor(rt*Vt),e.height=Math.floor(ht*Vt),this.setViewport(0,0,rt,ht)},this.getCurrentViewport=function(rt){return rt===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),rt=new Mi),rt.copy(Z)},this.getViewport=function(rt){return rt.copy(Zt)},this.setViewport=function(rt,ht,Vt,Dt){rt.isVector4?Zt.set(rt.x,rt.y,rt.z,rt.w):Zt.set(rt,ht,Vt,Dt),Ct.viewport(Z.copy(Zt).multiplyScalar(ct).floor())},this.getScissor=function(rt){return rt.copy(ce)},this.setScissor=function(rt,ht,Vt,Dt){rt.isVector4?ce.set(rt.x,rt.y,rt.z,rt.w):ce.set(rt,ht,Vt,Dt),Ct.scissor(tt.copy(ce).multiplyScalar(ct).floor())},this.getScissorTest=function(){return le},this.setScissorTest=function(rt){Ct.setScissorTest(le=rt)},this.setOpaqueSort=function(rt){xt=rt},this.setTransparentSort=function(rt){vt=rt},this.getClearColor=function(){return be.getClearColor()},this.setClearColor=function(){be.setClearColor.apply(be,arguments)},this.getClearAlpha=function(){return be.getClearAlpha()},this.setClearAlpha=function(){be.setClearAlpha.apply(be,arguments)},this.clear=function(rt,ht,Vt){var Dt=0;(rt===void 0||rt)&&(Dt|=16384),(ht===void 0||ht)&&(Dt|=256),(Vt===void 0||Vt)&&(Dt|=1024),Nt.clear(Dt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Je,!1),e.removeEventListener("webglcontextrestored",Jt,!1),St.dispose(),Ee.dispose(),jt.dispose(),We.dispose(),pn.dispose(),jn.stop()};function Je(rt){rt.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),P=!0}function Jt(){console.log("THREE.WebGLRenderer: Context Restored."),P=!1,Tn()}function je(rt){var ht=rt.target;ht.removeEventListener("dispose",je),rn(ht)}function rn(rt){In(rt),jt.remove(rt)}function In(rt){var ht=jt.get(rt).program;rt.program=void 0,ht!==void 0&&yt.releaseProgram(ht)}function xn(rt,ht){rt.render(function(Vt){T.renderBufferImmediate(Vt,ht)})}this.renderBufferImmediate=function(rt,ht){Ct.initAttributes();var Vt=jt.get(rt);rt.hasPositions&&!Vt.position&&(Vt.position=Nt.createBuffer()),rt.hasNormals&&!Vt.normal&&(Vt.normal=Nt.createBuffer()),rt.hasUvs&&!Vt.uv&&(Vt.uv=Nt.createBuffer()),rt.hasColors&&!Vt.color&&(Vt.color=Nt.createBuffer());var Dt=ht.getAttributes();rt.hasPositions&&(Nt.bindBuffer(34962,Vt.position),Nt.bufferData(34962,rt.positionArray,35048),Ct.enableAttribute(Dt.position),Nt.vertexAttribPointer(Dt.position,3,5126,!1,0,0)),rt.hasNormals&&(Nt.bindBuffer(34962,Vt.normal),Nt.bufferData(34962,rt.normalArray,35048),Ct.enableAttribute(Dt.normal),Nt.vertexAttribPointer(Dt.normal,3,5126,!1,0,0)),rt.hasUvs&&(Nt.bindBuffer(34962,Vt.uv),Nt.bufferData(34962,rt.uvArray,35048),Ct.enableAttribute(Dt.uv),Nt.vertexAttribPointer(Dt.uv,2,5126,!1,0,0)),rt.hasColors&&(Nt.bindBuffer(34962,Vt.color),Nt.bufferData(34962,rt.colorArray,35048),Ct.enableAttribute(Dt.color),Nt.vertexAttribPointer(Dt.color,3,5126,!1,0,0)),Ct.disableUnusedAttributes(),Nt.drawArrays(4,0,rt.count),rt.count=0};var On=new Gs;this.renderBufferDirect=function(rt,ht,Vt,Dt,Se,Me){ht===null&&(ht=On);var Oe=Se.isMesh&&Se.matrixWorld.determinant()<0,ln=Qr(rt,ht,Dt,Se);Ct.setMaterial(Dt,Oe);var kn=!1;(V.geometry!==Vt.id||V.program!==ln.id||V.wireframe!==(Dt.wireframe===!0))&&(V.geometry=Vt.id,V.program=ln.id,V.wireframe=Dt.wireframe===!0,kn=!0),(Dt.morphTargets||Dt.morphNormals)&&(En.update(Se,Vt,Dt,ln),kn=!0);var Bn=Vt.index,Pe=Vt.attributes.position;if(Bn===null){if(Pe===void 0||Pe.count===0)return}else if(Bn.count===0)return;var fn=1;Dt.wireframe===!0&&(Bn=Te.getWireframeAttribute(Vt),fn=2);var tn,vn=mn;Bn!==null&&(tn=pe.get(Bn),vn=an,vn.setIndex(tn)),kn&&(qn(Se,Vt,Dt,ln),Bn!==null&&Nt.bindBuffer(34963,tn.buffer));var Sn=Bn!==null?Bn.count:Pe.count,Dn=Vt.drawRange.start*fn,xi=Vt.drawRange.count*fn,kr=Me!==null?Me.start*fn:0,hi=Me!==null?Me.count*fn:1/0,fi=Math.max(Dn,kr),di=Math.min(Sn,Dn+xi,kr+hi)-1,Va=Math.max(0,di-fi+1);if(Va!==0){if(Se.isMesh)Dt.wireframe===!0?(Ct.setLineWidth(Dt.wireframeLinewidth*Wt()),vn.setMode(1)):vn.setMode(4);else if(Se.isLine){var Xo=Dt.linewidth;Xo===void 0&&(Xo=1),Ct.setLineWidth(Xo*Wt()),Se.isLineSegments?vn.setMode(1):Se.isLineLoop?vn.setMode(2):vn.setMode(3)}else Se.isPoints?vn.setMode(0):Se.isSprite&&vn.setMode(4);Se.isInstancedMesh?vn.renderInstances(Vt,fi,Va,Se.count):Vt.isInstancedBufferGeometry?vn.renderInstances(Vt,fi,Va,Vt.maxInstancedCount):vn.render(fi,Va)}};function qn(rt,ht,Vt,Dt){if(!(wt.isWebGL2===!1&&(rt.isInstancedMesh||ht.isInstancedBufferGeometry)&&_t.get("ANGLE_instanced_arrays")===null)){Ct.initAttributes();var Se=ht.attributes,Me=Dt.getAttributes(),Oe=Vt.defaultAttributeValues;for(var ln in Me){var kn=Me[ln];if(kn>=0){var Bn=Se[ln];if(Bn!==void 0){var Pe=Bn.normalized,fn=Bn.itemSize,tn=pe.get(Bn);if(tn===void 0)continue;var vn=tn.buffer,Sn=tn.type,Dn=tn.bytesPerElement;if(Bn.isInterleavedBufferAttribute){var xi=Bn.data,kr=xi.stride,hi=Bn.offset;xi&&xi.isInstancedInterleavedBuffer?(Ct.enableAttributeAndDivisor(kn,xi.meshPerAttribute),ht.maxInstancedCount===void 0&&(ht.maxInstancedCount=xi.meshPerAttribute*xi.count)):Ct.enableAttribute(kn),Nt.bindBuffer(34962,vn),Nt.vertexAttribPointer(kn,fn,Sn,Pe,kr*Dn,hi*Dn)}else Bn.isInstancedBufferAttribute?(Ct.enableAttributeAndDivisor(kn,Bn.meshPerAttribute),ht.maxInstancedCount===void 0&&(ht.maxInstancedCount=Bn.meshPerAttribute*Bn.count)):Ct.enableAttribute(kn),Nt.bindBuffer(34962,vn),Nt.vertexAttribPointer(kn,fn,Sn,Pe,0,0)}else if(ln==="instanceMatrix"){var tn=pe.get(rt.instanceMatrix);if(tn===void 0)continue;var vn=tn.buffer,Sn=tn.type;Ct.enableAttributeAndDivisor(kn+0,1),Ct.enableAttributeAndDivisor(kn+1,1),Ct.enableAttributeAndDivisor(kn+2,1),Ct.enableAttributeAndDivisor(kn+3,1),Nt.bindBuffer(34962,vn),Nt.vertexAttribPointer(kn+0,4,Sn,!1,64,0),Nt.vertexAttribPointer(kn+1,4,Sn,!1,64,16),Nt.vertexAttribPointer(kn+2,4,Sn,!1,64,32),Nt.vertexAttribPointer(kn+3,4,Sn,!1,64,48)}else if(Oe!==void 0){var fi=Oe[ln];if(fi!==void 0)switch(fi.length){case 2:Nt.vertexAttrib2fv(kn,fi);break;case 3:Nt.vertexAttrib3fv(kn,fi);break;case 4:Nt.vertexAttrib4fv(kn,fi);break;default:Nt.vertexAttrib1fv(kn,fi)}}}}Ct.disableUnusedAttributes()}}this.compile=function(rt,ht){A=Ee.get(rt,ht),A.init(),rt.traverse(function(Dt){Dt.isLight&&(A.pushLight(Dt),Dt.castShadow&&A.pushShadow(Dt))}),A.setupLights(ht);var Vt={};rt.traverse(function(Dt){if(Dt.material)if(Array.isArray(Dt.material))for(var Se=0;Se<Dt.material.length;Se++)Dt.material[Se].uuid in Vt||(Ai(Dt.material[Se],rt,Dt),Vt[Dt.material[Se].uuid]=!0);else Dt.material.uuid in Vt||(Ai(Dt.material,rt,Dt),Vt[Dt.material.uuid]=!0)})};var Jn=null;function Ji(rt){pn.isPresenting||Jn&&Jn(rt)}var jn=new Xb;jn.setAnimationLoop(Ji),typeof window!="undefined"&&jn.setContext(window),this.setAnimationLoop=function(rt){Jn=rt,pn.setAnimationLoop(rt),jn.start()},this.render=function(rt,ht){var Vt,Dt;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Vt=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Dt=arguments[3]),!(ht&&ht.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!P){V.geometry=null,V.program=null,V.wireframe=!1,H=-1,W=null,rt.autoUpdate===!0&&rt.updateMatrixWorld(),ht.parent===null&&ht.updateMatrixWorld(),pn.enabled&&pn.isPresenting&&(ht=pn.getCamera(ht)),A=Ee.get(rt,ht),A.init(),rt.onBeforeRender(T,rt,ht,Vt||O),bt.multiplyMatrices(ht.projectionMatrix,ht.matrixWorldInverse),fe.setFromProjectionMatrix(bt),Lt=this.localClippingEnabled,Le=de.init(this.clippingPlanes,Lt,ht),M=St.get(rt,ht),M.init(),Bi(rt,ht,0,T.sortObjects),T.sortObjects===!0&&M.sort(xt,vt),Le&&de.beginShadows();var Se=A.state.shadowsArray;hn.render(Se,rt,ht),A.setupLights(ht),Le&&de.endShadows(),this.info.autoReset&&this.info.reset(),Vt!==void 0&&this.setRenderTarget(Vt),pn.enabled&&qe.isAvailable()&&qe.attachCamera(ht),be.render(M,rt,ht,Dt);var Me=M.opaque,Oe=M.transparent;if(rt.overrideMaterial){var ln=rt.overrideMaterial;Me.length&&oi(Me,rt,ht,ln),Oe.length&&oi(Oe,rt,ht,ln)}else Me.length&&oi(Me,rt,ht),Oe.length&&oi(Oe,rt,ht);rt.onAfterRender(T,rt,ht),O!==null&&(ee.updateRenderTargetMipmap(O),ee.updateMultisampleRenderTarget(O)),Ct.buffers.depth.setTest(!0),Ct.buffers.depth.setMask(!0),Ct.buffers.color.setMask(!0),Ct.setPolygonOffset(!1),pn.enabled&&qe.isAvailable()&&qe.detachCamera(ht),M=null,A=null}};function Bi(rt,ht,Vt,Dt){if(rt.visible!==!1){var Se=rt.layers.test(ht.layers);if(Se){if(rt.isGroup)Vt=rt.renderOrder;else if(rt.isLOD)rt.autoUpdate===!0&&rt.update(ht);else if(rt.isLight)A.pushLight(rt),rt.castShadow&&A.pushShadow(rt);else if(rt.isSprite){if(!rt.frustumCulled||fe.intersectsSprite(rt)){Dt&&qt.setFromMatrixPosition(rt.matrixWorld).applyMatrix4(bt);var Me=We.update(rt),Oe=rt.material;Oe.visible&&M.push(rt,Me,Oe,Vt,qt.z,null)}}else if(rt.isImmediateRenderObject)Dt&&qt.setFromMatrixPosition(rt.matrixWorld).applyMatrix4(bt),M.push(rt,null,rt.material,Vt,qt.z,null);else if((rt.isMesh||rt.isLine||rt.isPoints)&&(rt.isSkinnedMesh&&rt.skeleton.frame!==Mt.render.frame&&(rt.skeleton.update(),rt.skeleton.frame=Mt.render.frame),!rt.frustumCulled||fe.intersectsObject(rt))){Dt&&qt.setFromMatrixPosition(rt.matrixWorld).applyMatrix4(bt);var Me=We.update(rt),Oe=rt.material;if(Array.isArray(Oe))for(var ln=Me.groups,kn=0,Bn=ln.length;kn<Bn;kn++){var Pe=ln[kn],fn=Oe[Pe.materialIndex];fn&&fn.visible&&M.push(rt,Me,fn,Vt,qt.z,Pe)}else Oe.visible&&M.push(rt,Me,Oe,Vt,qt.z,null)}}for(var tn=rt.children,kn=0,Bn=tn.length;kn<Bn;kn++)Bi(tn[kn],ht,Vt,Dt)}}function oi(rt,ht,Vt,Dt){for(var Se=0,Me=rt.length;Se<Me;Se++){var Oe=rt[Se],ln=Oe.object,kn=Oe.geometry,Bn=Dt===void 0?Oe.material:Dt,Pe=Oe.group;if(Vt.isArrayCamera)if(K=Vt,pn.enabled&&qe.isAvailable())or(ln,ht,Vt,kn,Bn,Pe);else for(var fn=Vt.cameras,tn=0,vn=fn.length;tn<vn;tn++){var Sn=fn[tn];ln.layers.test(Sn.layers)&&(Ct.viewport(Z.copy(Sn.viewport)),A.setupLights(Sn),or(ln,ht,Sn,kn,Bn,Pe))}else K=null,or(ln,ht,Vt,kn,Bn,Pe)}}function or(rt,ht,Vt,Dt,Se,Me){if(rt.onBeforeRender(T,ht,Vt,Dt,Se,Me),A=Ee.get(ht,K||Vt),rt.modelViewMatrix.multiplyMatrices(Vt.matrixWorldInverse,rt.matrixWorld),rt.normalMatrix.getNormalMatrix(rt.modelViewMatrix),rt.isImmediateRenderObject){var Oe=Qr(Vt,ht,Se,rt);Ct.setMaterial(Se),V.geometry=null,V.program=null,V.wireframe=!1,xn(rt,Oe)}else T.renderBufferDirect(Vt,ht,Dt,Se,rt,Me);rt.onAfterRender(T,ht,Vt,Dt,Se,Me),A=Ee.get(ht,K||Vt)}function Ai(rt,ht,Vt){var Dt=jt.get(rt),Se=A.state.lights,Me=A.state.shadowsArray,Oe=Se.state.version,ln=yt.getParameters(rt,Se.state,Me,ht,de.numPlanes,de.numIntersection,Vt),kn=yt.getProgramCacheKey(ln),Bn=Dt.program,Pe=!0;if(Bn===void 0)rt.addEventListener("dispose",je);else if(Bn.cacheKey!==kn)In(rt);else if(Dt.lightsStateVersion!==Oe)Dt.lightsStateVersion=Oe,Pe=!1;else{if(ln.shaderID!==void 0)return;Pe=!1}Pe&&(Bn=yt.acquireProgram(ln,kn),Dt.program=Bn,Dt.uniforms=ln.uniforms,Dt.environment=rt.isMeshStandardMaterial?ht.environment:null,Dt.outputEncoding=T.outputEncoding,rt.program=Bn);var fn=Bn.getAttributes();if(rt.morphTargets){rt.numSupportedMorphTargets=0;for(var tn=0;tn<T.maxMorphTargets;tn++)fn["morphTarget"+tn]>=0&&rt.numSupportedMorphTargets++}if(rt.morphNormals){rt.numSupportedMorphNormals=0;for(var tn=0;tn<T.maxMorphNormals;tn++)fn["morphNormal"+tn]>=0&&rt.numSupportedMorphNormals++}var vn=Dt.uniforms;(!rt.isShaderMaterial&&!rt.isRawShaderMaterial||rt.clipping===!0)&&(Dt.numClippingPlanes=de.numPlanes,Dt.numIntersection=de.numIntersection,vn.clippingPlanes=de.uniform),Dt.fog=ht.fog,Dt.needsLights=Mn(rt),Dt.lightsStateVersion=Oe,Dt.needsLights&&(vn.ambientLightColor.value=Se.state.ambient,vn.lightProbe.value=Se.state.probe,vn.directionalLights.value=Se.state.directional,vn.spotLights.value=Se.state.spot,vn.rectAreaLights.value=Se.state.rectArea,vn.pointLights.value=Se.state.point,vn.hemisphereLights.value=Se.state.hemi,vn.directionalShadowMap.value=Se.state.directionalShadowMap,vn.directionalShadowMatrix.value=Se.state.directionalShadowMatrix,vn.spotShadowMap.value=Se.state.spotShadowMap,vn.spotShadowMatrix.value=Se.state.spotShadowMatrix,vn.pointShadowMap.value=Se.state.pointShadowMap,vn.pointShadowMatrix.value=Se.state.pointShadowMatrix);var Sn=Dt.program.getUniforms(),Dn=wa.seqWithValue(Sn.seq,vn);Dt.uniformsList=Dn}function Qr(rt,ht,Vt,Dt){ee.resetTextureUnits();var Se=ht.fog,Me=Vt.isMeshStandardMaterial?ht.environment:null,Oe=jt.get(Vt),ln=A.state.lights;if(Le&&(Lt||rt!==W)){var kn=rt===W&&Vt.id===H;de.setState(Vt.clippingPlanes,Vt.clipIntersection,Vt.clipShadows,rt,Oe,kn)}Vt.version===Oe.__version?(Oe.program===void 0||Vt.fog&&Oe.fog!==Se||Oe.environment!==Me||Oe.needsLights&&Oe.lightsStateVersion!==ln.state.version||Oe.numClippingPlanes!==void 0&&(Oe.numClippingPlanes!==de.numPlanes||Oe.numIntersection!==de.numIntersection)||Oe.outputEncoding!==T.outputEncoding)&&Ai(Vt,ht,Dt):(Ai(Vt,ht,Dt),Oe.__version=Vt.version);var Bn=!1,Pe=!1,fn=!1,tn=Oe.program,vn=tn.getUniforms(),Sn=Oe.uniforms;if(Ct.useProgram(tn.program)&&(Bn=!0,Pe=!0,fn=!0),Vt.id!==H&&(H=Vt.id,Pe=!0),Bn||W!==rt){if(tn.numMultiviewViews>0?qe.updateCameraProjectionMatricesUniform(rt,vn):vn.setValue(Nt,"projectionMatrix",rt.projectionMatrix),wt.logarithmicDepthBuffer&&vn.setValue(Nt,"logDepthBufFC",2/(Math.log(rt.far+1)/Math.LN2)),W!==rt&&(W=rt,Pe=!0,fn=!0),Vt.isShaderMaterial||Vt.isMeshPhongMaterial||Vt.isMeshToonMaterial||Vt.isMeshStandardMaterial||Vt.envMap){var Dn=vn.map.cameraPosition;Dn!==void 0&&Dn.setValue(Nt,qt.setFromMatrixPosition(rt.matrixWorld))}(Vt.isMeshPhongMaterial||Vt.isMeshToonMaterial||Vt.isMeshLambertMaterial||Vt.isMeshBasicMaterial||Vt.isMeshStandardMaterial||Vt.isShaderMaterial)&&vn.setValue(Nt,"isOrthographic",rt.isOrthographicCamera===!0),(Vt.isMeshPhongMaterial||Vt.isMeshToonMaterial||Vt.isMeshLambertMaterial||Vt.isMeshBasicMaterial||Vt.isMeshStandardMaterial||Vt.isShaderMaterial||Vt.skinning)&&(tn.numMultiviewViews>0?qe.updateCameraViewMatricesUniform(rt,vn):vn.setValue(Nt,"viewMatrix",rt.matrixWorldInverse))}if(Vt.skinning){vn.setOptional(Nt,Dt,"bindMatrix"),vn.setOptional(Nt,Dt,"bindMatrixInverse");var xi=Dt.skeleton;if(xi){var kr=xi.bones;if(wt.floatVertexTextures){if(xi.boneTexture===void 0){var hi=Math.sqrt(kr.length*4);hi=Xn.ceilPowerOfTwo(hi),hi=Math.max(hi,4);var fi=new Float32Array(hi*hi*4);fi.set(xi.boneMatrices);var di=new nu(fi,hi,hi,No,Kh);xi.boneMatrices=fi,xi.boneTexture=di,xi.boneTextureSize=hi}vn.setValue(Nt,"boneTexture",xi.boneTexture,ee),vn.setValue(Nt,"boneTextureSize",xi.boneTextureSize)}else vn.setOptional(Nt,xi,"boneMatrices")}}return(Pe||Oe.receiveShadow!==Dt.receiveShadow)&&(Oe.receiveShadow=Dt.receiveShadow,vn.setValue(Nt,"receiveShadow",Dt.receiveShadow)),Pe&&(vn.setValue(Nt,"toneMappingExposure",T.toneMappingExposure),vn.setValue(Nt,"toneMappingWhitePoint",T.toneMappingWhitePoint),Oe.needsLights&&De(Sn,fn),Se&&Vt.fog&&lt(Sn,Se),Vt.isMeshBasicMaterial?Oi(Sn,Vt):Vt.isMeshLambertMaterial?(Oi(Sn,Vt),At(Sn,Vt)):Vt.isMeshToonMaterial?(Oi(Sn,Vt),Yt(Sn,Vt)):Vt.isMeshPhongMaterial?(Oi(Sn,Vt),zt(Sn,Vt)):Vt.isMeshStandardMaterial?(Oi(Sn,Vt,Me),Vt.isMeshPhysicalMaterial?ie(Sn,Vt,Me):ne(Sn,Vt,Me)):Vt.isMeshMatcapMaterial?(Oi(Sn,Vt),Kt(Sn,Vt)):Vt.isMeshDepthMaterial?(Oi(Sn,Vt),ae(Sn,Vt)):Vt.isMeshDistanceMaterial?(Oi(Sn,Vt),we(Sn,Vt)):Vt.isMeshNormalMaterial?(Oi(Sn,Vt),He(Sn,Vt)):Vt.isLineBasicMaterial?($r(Sn,Vt),Vt.isLineDashedMaterial&&Ir(Sn,Vt)):Vt.isPointsMaterial?Pt(Sn,Vt):Vt.isSpriteMaterial?et(Sn,Vt):Vt.isShadowMaterial&&(Sn.color.value.copy(Vt.color),Sn.opacity.value=Vt.opacity),Sn.ltc_1!==void 0&&(Sn.ltc_1.value=un.LTC_1),Sn.ltc_2!==void 0&&(Sn.ltc_2.value=un.LTC_2),wa.upload(Nt,Oe.uniformsList,Sn,ee),Vt.isShaderMaterial&&(Vt.uniformsNeedUpdate=!1)),Vt.isShaderMaterial&&Vt.uniformsNeedUpdate===!0&&(wa.upload(Nt,Oe.uniformsList,Sn,ee),Vt.uniformsNeedUpdate=!1),Vt.isSpriteMaterial&&vn.setValue(Nt,"center",Dt.center),tn.numMultiviewViews>0?qe.updateObjectMatricesUniforms(Dt,rt,vn):(vn.setValue(Nt,"modelViewMatrix",Dt.modelViewMatrix),vn.setValue(Nt,"normalMatrix",Dt.normalMatrix)),vn.setValue(Nt,"modelMatrix",Dt.matrixWorld),tn}function Oi(rt,ht,Vt){rt.opacity.value=ht.opacity,ht.color&&rt.diffuse.value.copy(ht.color),ht.emissive&&rt.emissive.value.copy(ht.emissive).multiplyScalar(ht.emissiveIntensity),ht.map&&(rt.map.value=ht.map),ht.alphaMap&&(rt.alphaMap.value=ht.alphaMap),ht.specularMap&&(rt.specularMap.value=ht.specularMap);var Dt=ht.envMap||Vt;Dt&&(rt.envMap.value=Dt,rt.flipEnvMap.value=Dt.isCubeTexture?-1:1,rt.reflectivity.value=ht.reflectivity,rt.refractionRatio.value=ht.refractionRatio,rt.maxMipLevel.value=jt.get(Dt).__maxMipLevel),ht.lightMap&&(rt.lightMap.value=ht.lightMap,rt.lightMapIntensity.value=ht.lightMapIntensity),ht.aoMap&&(rt.aoMap.value=ht.aoMap,rt.aoMapIntensity.value=ht.aoMapIntensity);var Se;ht.map?Se=ht.map:ht.specularMap?Se=ht.specularMap:ht.displacementMap?Se=ht.displacementMap:ht.normalMap?Se=ht.normalMap:ht.bumpMap?Se=ht.bumpMap:ht.roughnessMap?Se=ht.roughnessMap:ht.metalnessMap?Se=ht.metalnessMap:ht.alphaMap?Se=ht.alphaMap:ht.emissiveMap&&(Se=ht.emissiveMap),Se!==void 0&&(Se.isWebGLRenderTarget&&(Se=Se.texture),Se.matrixAutoUpdate===!0&&Se.updateMatrix(),rt.uvTransform.value.copy(Se.matrix));var Me;ht.aoMap?Me=ht.aoMap:ht.lightMap&&(Me=ht.lightMap),Me!==void 0&&(Me.isWebGLRenderTarget&&(Me=Me.texture),Me.matrixAutoUpdate===!0&&Me.updateMatrix(),rt.uv2Transform.value.copy(Me.matrix))}function $r(rt,ht){rt.diffuse.value.copy(ht.color),rt.opacity.value=ht.opacity}function Ir(rt,ht){rt.dashSize.value=ht.dashSize,rt.totalSize.value=ht.dashSize+ht.gapSize,rt.scale.value=ht.scale}function Pt(rt,ht){rt.diffuse.value.copy(ht.color),rt.opacity.value=ht.opacity,rt.size.value=ht.size*ct,rt.scale.value=nt*.5,ht.map&&(rt.map.value=ht.map),ht.alphaMap&&(rt.alphaMap.value=ht.alphaMap);var Vt;ht.map?Vt=ht.map:ht.alphaMap&&(Vt=ht.alphaMap),Vt!==void 0&&(Vt.matrixAutoUpdate===!0&&Vt.updateMatrix(),rt.uvTransform.value.copy(Vt.matrix))}function et(rt,ht){rt.diffuse.value.copy(ht.color),rt.opacity.value=ht.opacity,rt.rotation.value=ht.rotation,ht.map&&(rt.map.value=ht.map),ht.alphaMap&&(rt.alphaMap.value=ht.alphaMap);var Vt;ht.map?Vt=ht.map:ht.alphaMap&&(Vt=ht.alphaMap),Vt!==void 0&&(Vt.matrixAutoUpdate===!0&&Vt.updateMatrix(),rt.uvTransform.value.copy(Vt.matrix))}function lt(rt,ht){rt.fogColor.value.copy(ht.color),ht.isFog?(rt.fogNear.value=ht.near,rt.fogFar.value=ht.far):ht.isFogExp2&&(rt.fogDensity.value=ht.density)}function At(rt,ht){ht.emissiveMap&&(rt.emissiveMap.value=ht.emissiveMap)}function zt(rt,ht){rt.specular.value.copy(ht.specular),rt.shininess.value=Math.max(ht.shininess,1e-4),ht.emissiveMap&&(rt.emissiveMap.value=ht.emissiveMap),ht.bumpMap&&(rt.bumpMap.value=ht.bumpMap,rt.bumpScale.value=ht.bumpScale,ht.side===lr&&(rt.bumpScale.value*=-1)),ht.normalMap&&(rt.normalMap.value=ht.normalMap,rt.normalScale.value.copy(ht.normalScale),ht.side===lr&&rt.normalScale.value.negate()),ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias)}function Yt(rt,ht){rt.specular.value.copy(ht.specular),rt.shininess.value=Math.max(ht.shininess,1e-4),ht.gradientMap&&(rt.gradientMap.value=ht.gradientMap),ht.emissiveMap&&(rt.emissiveMap.value=ht.emissiveMap),ht.bumpMap&&(rt.bumpMap.value=ht.bumpMap,rt.bumpScale.value=ht.bumpScale,ht.side===lr&&(rt.bumpScale.value*=-1)),ht.normalMap&&(rt.normalMap.value=ht.normalMap,rt.normalScale.value.copy(ht.normalScale),ht.side===lr&&rt.normalScale.value.negate()),ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias)}function ne(rt,ht,Vt){rt.roughness.value=ht.roughness,rt.metalness.value=ht.metalness,ht.roughnessMap&&(rt.roughnessMap.value=ht.roughnessMap),ht.metalnessMap&&(rt.metalnessMap.value=ht.metalnessMap),ht.emissiveMap&&(rt.emissiveMap.value=ht.emissiveMap),ht.bumpMap&&(rt.bumpMap.value=ht.bumpMap,rt.bumpScale.value=ht.bumpScale,ht.side===lr&&(rt.bumpScale.value*=-1)),ht.normalMap&&(rt.normalMap.value=ht.normalMap,rt.normalScale.value.copy(ht.normalScale),ht.side===lr&&rt.normalScale.value.negate()),ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias),(ht.envMap||Vt)&&(rt.envMapIntensity.value=ht.envMapIntensity)}function ie(rt,ht,Vt){ne(rt,ht,Vt),rt.reflectivity.value=ht.reflectivity,rt.clearcoat.value=ht.clearcoat,rt.clearcoatRoughness.value=ht.clearcoatRoughness,ht.sheen&&rt.sheen.value.copy(ht.sheen),ht.clearcoatNormalMap&&(rt.clearcoatNormalScale.value.copy(ht.clearcoatNormalScale),rt.clearcoatNormalMap.value=ht.clearcoatNormalMap,ht.side===lr&&rt.clearcoatNormalScale.value.negate()),rt.transparency.value=ht.transparency}function Kt(rt,ht){ht.matcap&&(rt.matcap.value=ht.matcap),ht.bumpMap&&(rt.bumpMap.value=ht.bumpMap,rt.bumpScale.value=ht.bumpScale,ht.side===lr&&(rt.bumpScale.value*=-1)),ht.normalMap&&(rt.normalMap.value=ht.normalMap,rt.normalScale.value.copy(ht.normalScale),ht.side===lr&&rt.normalScale.value.negate()),ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias)}function ae(rt,ht){ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias)}function we(rt,ht){ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias),rt.referencePosition.value.copy(ht.referencePosition),rt.nearDistance.value=ht.nearDistance,rt.farDistance.value=ht.farDistance}function He(rt,ht){ht.bumpMap&&(rt.bumpMap.value=ht.bumpMap,rt.bumpScale.value=ht.bumpScale,ht.side===lr&&(rt.bumpScale.value*=-1)),ht.normalMap&&(rt.normalMap.value=ht.normalMap,rt.normalScale.value.copy(ht.normalScale),ht.side===lr&&rt.normalScale.value.negate()),ht.displacementMap&&(rt.displacementMap.value=ht.displacementMap,rt.displacementScale.value=ht.displacementScale,rt.displacementBias.value=ht.displacementBias)}function De(rt,ht){rt.ambientLightColor.needsUpdate=ht,rt.lightProbe.needsUpdate=ht,rt.directionalLights.needsUpdate=ht,rt.pointLights.needsUpdate=ht,rt.spotLights.needsUpdate=ht,rt.rectAreaLights.needsUpdate=ht,rt.hemisphereLights.needsUpdate=ht}function Mn(rt){return rt.isMeshLambertMaterial||rt.isMeshToonMaterial||rt.isMeshPhongMaterial||rt.isMeshStandardMaterial||rt.isShadowMaterial||rt.isShaderMaterial&&rt.lights===!0}this.setFramebuffer=function(rt){D!==rt&&O===null&&Nt.bindFramebuffer(36160,rt),D=rt},this.getActiveCubeFace=function(){return k},this.getActiveMipmapLevel=function(){return z},this.getRenderTarget=function(){return O},this.setRenderTarget=function(rt,ht,Vt){O=rt,k=ht,z=Vt,rt&&jt.get(rt).__webglFramebuffer===void 0&&ee.setupRenderTarget(rt);var Dt=D,Se=!1;if(rt){var Me=jt.get(rt).__webglFramebuffer;rt.isWebGLCubeRenderTarget?(Dt=Me[ht||0],Se=!0):rt.isWebGLMultisampleRenderTarget?Dt=jt.get(rt).__webglMultisampledFramebuffer:Dt=Me,Z.copy(rt.viewport),tt.copy(rt.scissor),at=rt.scissorTest}else Z.copy(Zt).multiplyScalar(ct).floor(),tt.copy(ce).multiplyScalar(ct).floor(),at=le;if(U!==Dt&&(Nt.bindFramebuffer(36160,Dt),U=Dt),Ct.viewport(Z),Ct.scissor(tt),Ct.setScissorTest(at),Se){var Oe=jt.get(rt.texture);Nt.framebufferTexture2D(36160,36064,34069+(ht||0),Oe.__webglTexture,Vt||0)}},this.readRenderTargetPixels=function(rt,ht,Vt,Dt,Se,Me,Oe){if(!(rt&&rt.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var ln=jt.get(rt).__webglFramebuffer;if(rt.isWebGLCubeRenderTarget&&Oe!==void 0&&(ln=ln[Oe]),ln){var kn=!1;ln!==U&&(Nt.bindFramebuffer(36160,ln),kn=!0);try{var Bn=rt.texture,Pe=Bn.format,fn=Bn.type;if(Pe!==No&&yn.convert(Pe)!==Nt.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(fn!==qf&&yn.convert(fn)!==Nt.getParameter(35738)&&!(fn===Kh&&(wt.isWebGL2||_t.get("OES_texture_float")||_t.get("WEBGL_color_buffer_float")))&&!(fn===V0&&(wt.isWebGL2?_t.get("EXT_color_buffer_float"):_t.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Nt.checkFramebufferStatus(36160)===36053?ht>=0&&ht<=rt.width-Dt&&Vt>=0&&Vt<=rt.height-Se&&Nt.readPixels(ht,Vt,Dt,Se,yn.convert(Pe),yn.convert(fn),Me):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{kn&&Nt.bindFramebuffer(36160,U)}}},this.copyFramebufferToTexture=function(rt,ht,Vt){Vt===void 0&&(Vt=0);var Dt=Math.pow(2,-Vt),Se=Math.floor(ht.image.width*Dt),Me=Math.floor(ht.image.height*Dt),Oe=yn.convert(ht.format);ee.setTexture2D(ht,0),Nt.copyTexImage2D(3553,Vt,Oe,rt.x,rt.y,Se,Me,0),Ct.unbindTexture()},this.copyTextureToTexture=function(rt,ht,Vt,Dt){var Se=ht.image.width,Me=ht.image.height,Oe=yn.convert(Vt.format),ln=yn.convert(Vt.type);ee.setTexture2D(Vt,0),ht.isDataTexture?Nt.texSubImage2D(3553,Dt||0,rt.x,rt.y,Se,Me,Oe,ln,ht.image.data):Nt.texSubImage2D(3553,Dt||0,rt.x,rt.y,Oe,ln,ht.image),Ct.unbindTexture()},this.initTexture=function(rt){ee.setTexture2D(rt,0),Ct.unbindTexture()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function vx(t,e){this.name="",this.color=new sn(t),this.density=e!==void 0?e:25e-5}Object.assign(vx.prototype,{isFogExp2:!0,clone:function(){return new vx(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function _x(t,e,n){this.name="",this.color=new sn(t),this.near=e!==void 0?e:1,this.far=n!==void 0?n:1e3}Object.assign(_x.prototype,{isFog:!0,clone:function(){return new _x(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function Ks(t,e){this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Zf,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(Ks.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),Object.assign(Ks.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,s=this.stride;r<s;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return e===void 0&&(e=0),this.array.set(t,e),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var Dl=new kt;function fd(t,e,n,r){this.data=t,this.itemSize=e,this.offset=n,this.normalized=r===!0}Object.defineProperties(fd.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(fd.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)Dl.x=this.getX(e),Dl.y=this.getY(e),Dl.z=this.getZ(e),Dl.applyMatrix4(t),this.setXYZ(e,Dl.x,Dl.y,Dl.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,s){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=s,this}});function Rl(t){zn.call(this),this.type="SpriteMaterial",this.color=new sn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Rl.prototype=Object.create(zn.prototype),Rl.prototype.constructor=Rl,Rl.prototype.isSpriteMaterial=!0,Rl.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var su,md=new kt,au=new kt,lu=new kt,cu=new ke,gd=new ke,xM=new Kn,mm=new kt,yd=new kt,gm=new kt,vM=new ke,bx=new ke,_M=new ke;function wx(t){if(cn.call(this),this.type="Sprite",su===void 0){su=new wn;var e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Ks(e,5);su.setIndex([0,1,2,0,2,3]),su.setAttribute("position",new fd(n,3,0,!1)),su.setAttribute("uv",new fd(n,2,3,!1))}this.geometry=su,this.material=t!==void 0?t:new Rl,this.center=new ke(.5,.5)}wx.prototype=Object.assign(Object.create(cn.prototype),{constructor:wx,isSprite:!0,raycast:function(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),au.setFromMatrixScale(this.matrixWorld),xM.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),lu.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&au.multiplyScalar(-lu.z);var n=this.material.rotation,r,s;n!==0&&(s=Math.cos(n),r=Math.sin(n));var u=this.center;ym(mm.set(-.5,-.5,0),lu,u,au,r,s),ym(yd.set(.5,-.5,0),lu,u,au,r,s),ym(gm.set(.5,.5,0),lu,u,au,r,s),vM.set(0,0),bx.set(1,0),_M.set(1,1);var h=t.ray.intersectTriangle(mm,yd,gm,!1,md);if(!(h===null&&(ym(yd.set(-.5,.5,0),lu,u,au,r,s),bx.set(0,1),h=t.ray.intersectTriangle(mm,gm,yd,!1,md),h===null))){var o=t.ray.origin.distanceTo(md);o<t.near||o>t.far||e.push({distance:o,point:md.clone(),uv:mr.getUV(md,mm,yd,gm,vM,bx,_M,new ke),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return cn.prototype.copy.call(this,t),t.center!==void 0&&this.center.copy(t.center),this}});function ym(t,e,n,r,s,u){cu.subVectors(t,n).addScalar(.5).multiply(r),s!==void 0?(gd.x=u*cu.x-s*cu.y,gd.y=s*cu.x+u*cu.y):gd.copy(cu),t.copy(e),t.x+=gd.x,t.y+=gd.y,t.applyMatrix4(xM)}var xm=new kt,bM=new kt;function vm(){cn.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}vm.prototype=Object.assign(Object.create(cn.prototype),{constructor:vm,isLOD:!0,copy:function(t){cn.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var s=e[n];this.addLevel(s.object.clone(),s.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){e===void 0&&(e=0),e=Math.abs(e);for(var n=this.levels,r=0;r<n.length&&!(e<n[r].distance);r++);return n.splice(r,0,{distance:e,object:t}),this.add(t),this},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){var n=this.levels;if(n.length>0){xm.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(xm);this.getObjectForDistance(r).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){xm.setFromMatrixPosition(t.matrixWorld),bM.setFromMatrixPosition(this.matrixWorld);var n=xm.distanceTo(bM);e[0].object.visible=!0;for(var r=1,s=e.length;r<s&&n>=e[r].distance;r++)e[r-1].object.visible=!1,e[r].object.visible=!0;for(;r<s;r++)e[r].object.visible=!1}},toJSON:function(t){var e=cn.prototype.toJSON.call(this,t);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];for(var n=this.levels,r=0,s=n.length;r<s;r++){var u=n[r];e.object.levels.push({object:u.object.uuid,distance:u.distance})}return e}});function xd(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),ki.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Kn,this.bindMatrixInverse=new Kn}xd.prototype=Object.assign(Object.create(ki.prototype),{constructor:xd,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new Mi,e=this.geometry.attributes.skinWeight,n=0,r=e.count;n<r;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);var s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){ki.prototype.updateMatrixWorld.call(this,t),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var MM=new Kn,S4=new Kn;function _m(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),this.frame=-1,e===void 0)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Kn)}}Object.assign(_m.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var n=new Kn;this.bones[t]&&n.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(n)}},pose:function(){var t,e,n;for(e=0,n=this.bones.length;e<n;e++)t=this.bones[e],t&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,n=this.bones.length;e<n;e++)t=this.bones[e],t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,s=0,u=t.length;s<u;s++){var h=t[s]?t[s].matrixWorld:S4;MM.multiplyMatrices(h,e[s]),MM.toArray(n,s*16)}r!==void 0&&(r.needsUpdate=!0)},clone:function(){return new _m(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}}});function Ax(){cn.call(this),this.type="Bone"}Ax.prototype=Object.assign(Object.create(cn.prototype),{constructor:Ax,isBone:!0});var wM=new Kn,AM=new Kn,uu=[],vd=new ki;function Ex(t,e,n){ki.call(this,t,e),this.instanceMatrix=new Nn(new Float32Array(n*16),16),this.count=n,this.frustumCulled=!1}Ex.prototype=Object.assign(Object.create(ki.prototype),{constructor:Ex,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,t*16)},raycast:function(t,e){var n=this.matrixWorld,r=this.count;if(vd.geometry=this.geometry,vd.material=this.material,vd.material!==void 0)for(var s=0;s<r;s++)this.getMatrixAt(s,wM),AM.multiplyMatrices(n,wM),vd.matrixWorld=AM,vd.raycast(t,uu),uu.length>0&&(uu[0].instanceId=s,uu[0].object=this,e.push(uu[0]),uu.length=0)},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,t*16)},updateMorphTargets:function(){}});function Vi(t){zn.call(this),this.type="LineBasicMaterial",this.color=new sn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}Vi.prototype=Object.create(zn.prototype),Vi.prototype.constructor=Vi,Vi.prototype.isLineBasicMaterial=!0,Vi.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this};var EM=new kt,TM=new kt,PM=new Kn,bm=new Wc,Mm=new js;function go(t,e,n){n===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),cn.call(this),this.type="Line",this.geometry=t!==void 0?t:new wn,this.material=e!==void 0?e:new Vi}go.prototype=Object.assign(Object.create(cn.prototype),{constructor:go,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(t.index===null){for(var e=t.attributes.position,n=[0],r=1,s=e.count;r<s;r++)EM.fromBufferAttribute(e,r-1),TM.fromBufferAttribute(e,r),n[r]=n[r-1],n[r]+=EM.distanceTo(TM);t.setAttribute("lineDistance",new dn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var u=t.vertices,n=t.lineDistances;n[0]=0;for(var r=1,s=u.length;r<s;r++)n[r]=n[r-1],n[r]+=u[r-1].distanceTo(u[r])}return this},raycast:function(t,e){var n=t.linePrecision,r=this.geometry,s=this.matrixWorld;if(r.boundingSphere===null&&r.computeBoundingSphere(),Mm.copy(r.boundingSphere),Mm.applyMatrix4(s),Mm.radius+=n,t.ray.intersectsSphere(Mm)!==!1){PM.getInverse(s),bm.copy(t.ray).applyMatrix4(PM);var u=n/((this.scale.x+this.scale.y+this.scale.z)/3),h=u*u,o=new kt,m=new kt,y=new kt,x=new kt,M=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var A=r.index,T=r.attributes,P=T.position.array;if(A!==null)for(var D=A.array,k=0,z=D.length-1;k<z;k+=M){var O=D[k],U=D[k+1];o.fromArray(P,O*3),m.fromArray(P,U*3);var H=bm.distanceSqToSegment(o,m,x,y);if(!(H>h)){x.applyMatrix4(this.matrixWorld);var V=t.ray.origin.distanceTo(x);V<t.near||V>t.far||e.push({distance:V,point:y.clone().applyMatrix4(this.matrixWorld),index:k,face:null,faceIndex:null,object:this})}}else for(var k=0,z=P.length/3-1;k<z;k+=M){o.fromArray(P,3*k),m.fromArray(P,3*k+3);var H=bm.distanceSqToSegment(o,m,x,y);if(!(H>h)){x.applyMatrix4(this.matrixWorld);var V=t.ray.origin.distanceTo(x);V<t.near||V>t.far||e.push({distance:V,point:y.clone().applyMatrix4(this.matrixWorld),index:k,face:null,faceIndex:null,object:this})}}}else if(r.isGeometry)for(var W=r.vertices,K=W.length,k=0;k<K-1;k+=M){var H=bm.distanceSqToSegment(W[k],W[k+1],x,y);if(!(H>h)){x.applyMatrix4(this.matrixWorld);var V=t.ray.origin.distanceTo(x);V<t.near||V>t.far||e.push({distance:V,point:y.clone().applyMatrix4(this.matrixWorld),index:k,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var wm=new kt,Am=new kt;function Xi(t,e){go.call(this,t,e),this.type="LineSegments"}Xi.prototype=Object.assign(Object.create(go.prototype),{constructor:Xi,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(t.index===null){for(var e=t.attributes.position,n=[],r=0,s=e.count;r<s;r+=2)wm.fromBufferAttribute(e,r),Am.fromBufferAttribute(e,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+wm.distanceTo(Am);t.setAttribute("lineDistance",new dn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry)for(var u=t.vertices,n=t.lineDistances,r=0,s=u.length;r<s;r+=2)wm.copy(u[r]),Am.copy(u[r+1]),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+wm.distanceTo(Am);return this}});function Em(t,e){go.call(this,t,e),this.type="LineLoop"}Em.prototype=Object.assign(Object.create(go.prototype),{constructor:Em,isLineLoop:!0});function Aa(t){zn.call(this),this.type="PointsMaterial",this.color=new sn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Aa.prototype=Object.create(zn.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isPointsMaterial=!0,Aa.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var SM=new Kn,Tx=new Wc,Tm=new js,Pm=new kt;function Sm(t,e){cn.call(this),this.type="Points",this.geometry=t!==void 0?t:new wn,this.material=e!==void 0?e:new Aa,this.updateMorphTargets()}Sm.prototype=Object.assign(Object.create(cn.prototype),{constructor:Sm,isPoints:!0,raycast:function(t,e){var n=this.geometry,r=this.matrixWorld,s=t.params.Points.threshold;if(n.boundingSphere===null&&n.computeBoundingSphere(),Tm.copy(n.boundingSphere),Tm.applyMatrix4(r),Tm.radius+=s,t.ray.intersectsSphere(Tm)!==!1){SM.getInverse(r),Tx.copy(t.ray).applyMatrix4(SM);var u=s/((this.scale.x+this.scale.y+this.scale.z)/3),h=u*u;if(n.isBufferGeometry){var o=n.index,m=n.attributes,y=m.position.array;if(o!==null)for(var x=o.array,M=0,A=x.length;M<A;M++){var T=x[M];Pm.fromArray(y,T*3),Px(Pm,T,h,r,t,e,this)}else for(var M=0,P=y.length/3;M<P;M++)Pm.fromArray(y,M*3),Px(Pm,M,h,r,t,e,this)}else for(var D=n.vertices,M=0,P=D.length;M<P;M++)Px(D[M],M,h,r,t,e,this)}},updateMorphTargets:function(){var t=this.geometry,e,n,r;if(t.isBufferGeometry){var s=t.morphAttributes,u=Object.keys(s);if(u.length>0){var h=s[u[0]];if(h!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,n=h.length;e<n;e++)r=h[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var o=t.morphTargets;o!==void 0&&o.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function Px(t,e,n,r,s,u,h){var o=Tx.distanceSqToPoint(t);if(o<n){var m=new kt;Tx.closestPointToPoint(t,m),m.applyMatrix4(r);var y=s.ray.origin.distanceTo(m);if(y<s.near||y>s.far)return;u.push({distance:y,distanceToRay:Math.sqrt(o),point:m,index:e,face:null,object:h})}}function CM(t,e,n,r,s,u,h,o,m){bi.call(this,t,e,n,r,s,u,h,o,m),this.format=h!==void 0?h:Ns,this.minFilter=u!==void 0?u:$i,this.magFilter=s!==void 0?s:$i,this.generateMipmaps=!1}CM.prototype=Object.assign(Object.create(bi.prototype),{constructor:CM,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function _d(t,e,n,r,s,u,h,o,m,y,x,M){bi.call(this,null,u,h,o,m,y,r,s,x,M),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}_d.prototype=Object.create(bi.prototype),_d.prototype.constructor=_d,_d.prototype.isCompressedTexture=!0;function Cm(t,e,n,r,s,u,h,o,m){bi.call(this,t,e,n,r,s,u,h,o,m),this.needsUpdate=!0}Cm.prototype=Object.create(bi.prototype),Cm.prototype.constructor=Cm,Cm.prototype.isCanvasTexture=!0;function Dm(t,e,n,r,s,u,h,o,m,y){if(y=y!==void 0?y:kc,y!==kc&&y!==Zh)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&y===kc&&(n=Yf),n===void 0&&y===Zh&&(n=Xf),bi.call(this,null,r,s,u,h,o,y,n,m),this.image={width:t,height:e},this.magFilter=h!==void 0?h:Yi,this.minFilter=o!==void 0?o:Yi,this.flipY=!1,this.generateMipmaps=!1}Dm.prototype=Object.create(bi.prototype),Dm.prototype.constructor=Dm,Dm.prototype.isDepthTexture=!0;function Rm(t){wn.call(this),this.type="WireframeGeometry";var e=[],n,r,s,u,h,o=[0,0],m={},y,x,M,A,T=["a","b","c"],P;if(t&&t.isGeometry){var D=t.faces;for(n=0,s=D.length;n<s;n++){var k=D[n];for(r=0;r<3;r++)x=k[T[r]],M=k[T[(r+1)%3]],o[0]=Math.min(x,M),o[1]=Math.max(x,M),A=o[0]+","+o[1],m[A]===void 0&&(m[A]={index1:o[0],index2:o[1]})}for(A in m)y=m[A],P=t.vertices[y.index1],e.push(P.x,P.y,P.z),P=t.vertices[y.index2],e.push(P.x,P.y,P.z)}else if(t&&t.isBufferGeometry){var z,O,U,H,V,W,K,Z;if(P=new kt,t.index!==null){for(z=t.attributes.position,O=t.index,U=t.groups,U.length===0&&(U=[{start:0,count:O.count,materialIndex:0}]),u=0,h=U.length;u<h;++u)for(H=U[u],V=H.start,W=H.count,n=V,s=V+W;n<s;n+=3)for(r=0;r<3;r++)x=O.getX(n+r),M=O.getX(n+(r+1)%3),o[0]=Math.min(x,M),o[1]=Math.max(x,M),A=o[0]+","+o[1],m[A]===void 0&&(m[A]={index1:o[0],index2:o[1]});for(A in m)y=m[A],P.fromBufferAttribute(z,y.index1),e.push(P.x,P.y,P.z),P.fromBufferAttribute(z,y.index2),e.push(P.x,P.y,P.z)}else for(z=t.attributes.position,n=0,s=z.count/3;n<s;n++)for(r=0;r<3;r++)K=3*n+r,P.fromBufferAttribute(z,K),e.push(P.x,P.y,P.z),Z=3*n+(r+1)%3,P.fromBufferAttribute(z,Z),e.push(P.x,P.y,P.z)}this.setAttribute("position",new dn(e,3))}Rm.prototype=Object.create(wn.prototype),Rm.prototype.constructor=Rm;function Lm(t,e,n){Gn.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new bd(t,e,n)),this.mergeVertices()}Lm.prototype=Object.create(Gn.prototype),Lm.prototype.constructor=Lm;function bd(t,e,n){wn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};var r=[],s=[],u=[],h=[],o=1e-5,m=new kt,y=new kt,x=new kt,M=new kt,A=new kt,T,P;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var D=e+1;for(T=0;T<=n;T++){var k=T/n;for(P=0;P<=e;P++){var z=P/e;t(z,k,y),s.push(y.x,y.y,y.z),z-o>=0?(t(z-o,k,x),M.subVectors(y,x)):(t(z+o,k,x),M.subVectors(x,y)),k-o>=0?(t(z,k-o,x),A.subVectors(y,x)):(t(z,k+o,x),A.subVectors(x,y)),m.crossVectors(M,A).normalize(),u.push(m.x,m.y,m.z),h.push(z,k)}}for(T=0;T<n;T++)for(P=0;P<e;P++){var O=T*D+P,U=T*D+P+1,H=(T+1)*D+P+1,V=(T+1)*D+P;r.push(O,U,V),r.push(U,H,V)}this.setIndex(r),this.setAttribute("position",new dn(s,3)),this.setAttribute("normal",new dn(u,3)),this.setAttribute("uv",new dn(h,2))}bd.prototype=Object.create(wn.prototype),bd.prototype.constructor=bd;function Im(t,e,n,r){Gn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new yo(t,e,n,r)),this.mergeVertices()}Im.prototype=Object.create(Gn.prototype),Im.prototype.constructor=Im;function yo(t,e,n,r){wn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1,r=r||0;var s=[],u=[];h(r),m(n),y(),this.setAttribute("position",new dn(s,3)),this.setAttribute("normal",new dn(s.slice(),3)),this.setAttribute("uv",new dn(u,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function h(z){for(var O=new kt,U=new kt,H=new kt,V=0;V<e.length;V+=3)A(e[V+0],O),A(e[V+1],U),A(e[V+2],H),o(O,U,H,z)}function o(z,O,U,H){var V=Math.pow(2,H),W=[],K,Z;for(K=0;K<=V;K++){W[K]=[];var tt=z.clone().lerp(U,K/V),at=O.clone().lerp(U,K/V),st=V-K;for(Z=0;Z<=st;Z++)Z===0&&K===V?W[K][Z]=tt:W[K][Z]=tt.clone().lerp(at,Z/st)}for(K=0;K<V;K++)for(Z=0;Z<2*(V-K)-1;Z++){var nt=Math.floor(Z/2);Z%2===0?(M(W[K][nt+1]),M(W[K+1][nt]),M(W[K][nt])):(M(W[K][nt+1]),M(W[K+1][nt+1]),M(W[K+1][nt]))}}function m(z){for(var O=new kt,U=0;U<s.length;U+=3)O.x=s[U+0],O.y=s[U+1],O.z=s[U+2],O.normalize().multiplyScalar(z),s[U+0]=O.x,s[U+1]=O.y,s[U+2]=O.z}function y(){for(var z=new kt,O=0;O<s.length;O+=3){z.x=s[O+0],z.y=s[O+1],z.z=s[O+2];var U=D(z)/2/Math.PI+.5,H=k(z)/Math.PI+.5;u.push(U,1-H)}T(),x()}function x(){for(var z=0;z<u.length;z+=6){var O=u[z+0],U=u[z+2],H=u[z+4],V=Math.max(O,U,H),W=Math.min(O,U,H);V>.9&&W<.1&&(O<.2&&(u[z+0]+=1),U<.2&&(u[z+2]+=1),H<.2&&(u[z+4]+=1))}}function M(z){s.push(z.x,z.y,z.z)}function A(z,O){var U=z*3;O.x=t[U+0],O.y=t[U+1],O.z=t[U+2]}function T(){for(var z=new kt,O=new kt,U=new kt,H=new kt,V=new ke,W=new ke,K=new ke,Z=0,tt=0;Z<s.length;Z+=9,tt+=6){z.set(s[Z+0],s[Z+1],s[Z+2]),O.set(s[Z+3],s[Z+4],s[Z+5]),U.set(s[Z+6],s[Z+7],s[Z+8]),V.set(u[tt+0],u[tt+1]),W.set(u[tt+2],u[tt+3]),K.set(u[tt+4],u[tt+5]),H.copy(z).add(O).add(U).divideScalar(3);var at=D(H);P(V,tt+0,z,at),P(W,tt+2,O,at),P(K,tt+4,U,at)}}function P(z,O,U,H){H<0&&z.x===1&&(u[O]=z.x-1),U.x===0&&U.z===0&&(u[O]=H/2/Math.PI+.5)}function D(z){return Math.atan2(z.z,-z.x)}function k(z){return Math.atan2(-z.y,Math.sqrt(z.x*z.x+z.z*z.z))}}yo.prototype=Object.create(wn.prototype),yo.prototype.constructor=yo;function km(t,e){Gn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Md(t,e)),this.mergeVertices()}km.prototype=Object.create(Gn.prototype),km.prototype.constructor=km;function Md(t,e){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];yo.call(this,n,r,t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}Md.prototype=Object.create(yo.prototype),Md.prototype.constructor=Md;function Bm(t,e){Gn.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new hu(t,e)),this.mergeVertices()}Bm.prototype=Object.create(Gn.prototype),Bm.prototype.constructor=Bm;function hu(t,e){var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];yo.call(this,n,r,t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}hu.prototype=Object.create(yo.prototype),hu.prototype.constructor=hu;function Fm(t,e){Gn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new wd(t,e)),this.mergeVertices()}Fm.prototype=Object.create(Gn.prototype),Fm.prototype.constructor=Fm;function wd(t,e){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];yo.call(this,r,s,t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}wd.prototype=Object.create(yo.prototype),wd.prototype.constructor=wd;function zm(t,e){Gn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ad(t,e)),this.mergeVertices()}zm.prototype=Object.create(Gn.prototype),zm.prototype.constructor=zm;function Ad(t,e){var n=(1+Math.sqrt(5))/2,r=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],u=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];yo.call(this,s,u,t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}Ad.prototype=Object.create(yo.prototype),Ad.prototype.constructor=Ad;function Nm(t,e,n,r,s,u){Gn.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:s},u!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var h=new du(t,e,n,r,s);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals,this.fromBufferGeometry(h),this.mergeVertices()}Nm.prototype=Object.create(Gn.prototype),Nm.prototype.constructor=Nm;function du(t,e,n,r,s){wn.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:r,closed:s},e=e||64,n=n||1,r=r||8,s=s||!1;var u=t.computeFrenetFrames(e,s);this.tangents=u.tangents,this.normals=u.normals,this.binormals=u.binormals;var h=new kt,o=new kt,m=new ke,y=new kt,x,M,A=[],T=[],P=[],D=[];k(),this.setIndex(D),this.setAttribute("position",new dn(A,3)),this.setAttribute("normal",new dn(T,3)),this.setAttribute("uv",new dn(P,2));function k(){for(x=0;x<e;x++)z(x);z(s===!1?e:0),U(),O()}function z(H){y=t.getPointAt(H/e,y);var V=u.normals[H],W=u.binormals[H];for(M=0;M<=r;M++){var K=M/r*Math.PI*2,Z=Math.sin(K),tt=-Math.cos(K);o.x=tt*V.x+Z*W.x,o.y=tt*V.y+Z*W.y,o.z=tt*V.z+Z*W.z,o.normalize(),T.push(o.x,o.y,o.z),h.x=y.x+n*o.x,h.y=y.y+n*o.y,h.z=y.z+n*o.z,A.push(h.x,h.y,h.z)}}function O(){for(M=1;M<=e;M++)for(x=1;x<=r;x++){var H=(r+1)*(M-1)+(x-1),V=(r+1)*M+(x-1),W=(r+1)*M+x,K=(r+1)*(M-1)+x;D.push(H,V,K),D.push(V,W,K)}}function U(){for(x=0;x<=e;x++)for(M=0;M<=r;M++)m.x=x/e,m.y=M/r,P.push(m.x,m.y)}}du.prototype=Object.create(wn.prototype),du.prototype.constructor=du,du.prototype.toJSON=function(){var t=wn.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t};function Um(t,e,n,r,s,u,h){Gn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:s,q:u},h!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Ed(t,e,n,r,s,u)),this.mergeVertices()}Um.prototype=Object.create(Gn.prototype),Um.prototype.constructor=Um;function Ed(t,e,n,r,s,u){wn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:s,q:u},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,s=s||2,u=u||3;var h=[],o=[],m=[],y=[],x,M,A=new kt,T=new kt,P=new kt,D=new kt,k=new kt,z=new kt,O=new kt;for(x=0;x<=n;++x){var U=x/n*s*Math.PI*2;for(st(U,s,u,t,P),st(U+.01,s,u,t,D),z.subVectors(D,P),O.addVectors(D,P),k.crossVectors(z,O),O.crossVectors(k,z),k.normalize(),O.normalize(),M=0;M<=r;++M){var H=M/r*Math.PI*2,V=-e*Math.cos(H),W=e*Math.sin(H);A.x=P.x+(V*O.x+W*k.x),A.y=P.y+(V*O.y+W*k.y),A.z=P.z+(V*O.z+W*k.z),o.push(A.x,A.y,A.z),T.subVectors(A,P).normalize(),m.push(T.x,T.y,T.z),y.push(x/n),y.push(M/r)}}for(M=1;M<=n;M++)for(x=1;x<=r;x++){var K=(r+1)*(M-1)+(x-1),Z=(r+1)*M+(x-1),tt=(r+1)*M+x,at=(r+1)*(M-1)+x;h.push(K,Z,at),h.push(Z,tt,at)}this.setIndex(h),this.setAttribute("position",new dn(o,3)),this.setAttribute("normal",new dn(m,3)),this.setAttribute("uv",new dn(y,2));function st(nt,ct,xt,vt,Zt){var ce=Math.cos(nt),le=Math.sin(nt),fe=xt/ct*nt,de=Math.cos(fe);Zt.x=vt*(2+de)*.5*ce,Zt.y=vt*(2+de)*le*.5,Zt.z=vt*Math.sin(fe)*.5}}Ed.prototype=Object.create(wn.prototype),Ed.prototype.constructor=Ed;function Vm(t,e,n,r,s){Gn.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:s},this.fromBufferGeometry(new Td(t,e,n,r,s)),this.mergeVertices()}Vm.prototype=Object.create(Gn.prototype),Vm.prototype.constructor=Vm;function Td(t,e,n,r,s){wn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:s},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,s=s||Math.PI*2;var u=[],h=[],o=[],m=[],y=new kt,x=new kt,M=new kt,A,T;for(A=0;A<=n;A++)for(T=0;T<=r;T++){var P=T/r*s,D=A/n*Math.PI*2;x.x=(t+e*Math.cos(D))*Math.cos(P),x.y=(t+e*Math.cos(D))*Math.sin(P),x.z=e*Math.sin(D),h.push(x.x,x.y,x.z),y.x=t*Math.cos(P),y.y=t*Math.sin(P),M.subVectors(x,y).normalize(),o.push(M.x,M.y,M.z),m.push(T/r),m.push(A/n)}for(A=1;A<=n;A++)for(T=1;T<=r;T++){var k=(r+1)*A+T-1,z=(r+1)*(A-1)+T-1,O=(r+1)*(A-1)+T,U=(r+1)*A+T;u.push(k,z,U),u.push(z,O,U)}this.setIndex(u),this.setAttribute("position",new dn(h,3)),this.setAttribute("normal",new dn(o,3)),this.setAttribute("uv",new dn(m,2))}Td.prototype=Object.create(wn.prototype),Td.prototype.constructor=Td;var C4={triangulate:function(t,e,n){n=n||2;var r=e&&e.length,s=r?e[0]*n:t.length,u=DM(t,0,s,n,!0),h=[];if(!u||u.next===u.prev)return h;var o,m,y,x,M,A,T;if(r&&(u=k4(t,e,u,n)),t.length>80*n){o=y=t[0],m=x=t[1];for(var P=n;P<s;P+=n)M=t[P],A=t[P+1],M<o&&(o=M),A<m&&(m=A),M>y&&(y=M),A>x&&(x=A);T=Math.max(y-o,x-m),T=T!==0?1/T:0}return Sd(u,h,n,o,m,T),h}};function DM(t,e,n,r,s){var u,h;if(s===H4(t,e,n,r)>0)for(u=e;u<n;u+=r)h=IM(u,t[u],t[u+1],h);else for(u=n-r;u>=e;u-=r)h=IM(u,t[u],t[u+1],h);return h&&Ll(h,h.next)&&(Dd(h),h=h.next),h}function Pd(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Ll(n,n.next)||yr(n.prev,n,n.next)===0)){if(Dd(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function Sd(t,e,n,r,s,u,h){if(t){!h&&u&&N4(t,r,s,u);for(var o=t,m,y;t.prev!==t.next;){if(m=t.prev,y=t.next,u?R4(t,r,s,u):D4(t)){e.push(m.i/n),e.push(t.i/n),e.push(y.i/n),Dd(t),t=y.next,o=y.next;continue}if(t=y,t===o){h?h===1?(t=L4(t,e,n),Sd(t,e,n,r,s,u,2)):h===2&&I4(t,e,n,r,s,u):Sd(Pd(t),e,n,r,s,u,1);break}}}}function D4(t){var e=t.prev,n=t,r=t.next;if(yr(e,n,r)>=0)return!1;for(var s=t.next.next;s!==t.prev;){if(pu(e.x,e.y,n.x,n.y,r.x,r.y,s.x,s.y)&&yr(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function R4(t,e,n,r){var s=t.prev,u=t,h=t.next;if(yr(s,u,h)>=0)return!1;for(var o=s.x<u.x?s.x<h.x?s.x:h.x:u.x<h.x?u.x:h.x,m=s.y<u.y?s.y<h.y?s.y:h.y:u.y<h.y?u.y:h.y,y=s.x>u.x?s.x>h.x?s.x:h.x:u.x>h.x?u.x:h.x,x=s.y>u.y?s.y>h.y?s.y:h.y:u.y>h.y?u.y:h.y,M=Sx(o,m,e,n,r),A=Sx(y,x,e,n,r),T=t.prevZ,P=t.nextZ;T&&T.z>=M&&P&&P.z<=A;){if(T!==t.prev&&T!==t.next&&pu(s.x,s.y,u.x,u.y,h.x,h.y,T.x,T.y)&&yr(T.prev,T,T.next)>=0||(T=T.prevZ,P!==t.prev&&P!==t.next&&pu(s.x,s.y,u.x,u.y,h.x,h.y,P.x,P.y)&&yr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;T&&T.z>=M;){if(T!==t.prev&&T!==t.next&&pu(s.x,s.y,u.x,u.y,h.x,h.y,T.x,T.y)&&yr(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;P&&P.z<=A;){if(P!==t.prev&&P!==t.next&&pu(s.x,s.y,u.x,u.y,h.x,h.y,P.x,P.y)&&yr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function L4(t,e,n){var r=t;do{var s=r.prev,u=r.next.next;!Ll(s,u)&&RM(s,r,r.next,u)&&Cd(s,u)&&Cd(u,s)&&(e.push(s.i/n),e.push(r.i/n),e.push(u.i/n),Dd(r),Dd(r.next),r=t=u),r=r.next}while(r!==t);return r}function I4(t,e,n,r,s,u){var h=t;do{for(var o=h.next.next;o!==h.prev;){if(h.i!==o.i&&G4(h,o)){var m=LM(h,o);h=Pd(h,h.next),m=Pd(m,m.next),Sd(h,e,n,r,s,u),Sd(m,e,n,r,s,u);return}o=o.next}h=h.next}while(h!==t)}function k4(t,e,n,r){var s=[],u,h,o,m,y;for(u=0,h=e.length;u<h;u++)o=e[u]*r,m=u<h-1?e[u+1]*r:t.length,y=DM(t,o,m,r,!1),y===y.next&&(y.steiner=!0),s.push(V4(y));for(s.sort(B4),u=0;u<s.length;u++)F4(s[u],n),n=Pd(n,n.next);return n}function B4(t,e){return t.x-e.x}function F4(t,e){if(e=z4(t,e),e){var n=LM(e,t);Pd(n,n.next)}}function z4(t,e){var n=e,r=t.x,s=t.y,u=-1/0,h;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&o>u){if(u=o,o===r){if(s===n.y)return n;if(s===n.next.y)return n.next}h=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!h)return null;if(r===u)return h.prev;var m=h,y=h.x,x=h.y,M=1/0,A;for(n=h.next;n!==m;)r>=n.x&&n.x>=y&&r!==n.x&&pu(s<x?r:u,s,y,x,s<x?u:r,s,n.x,n.y)&&(A=Math.abs(s-n.y)/(r-n.x),(A<M||A===M&&n.x>h.x)&&Cd(n,t)&&(h=n,M=A)),n=n.next;return h}function N4(t,e,n,r){var s=t;do s.z===null&&(s.z=Sx(s.x,s.y,e,n,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,U4(s)}function U4(t){var e,n,r,s,u,h,o,m,y=1;do{for(n=t,t=null,u=null,h=0;n;){for(h++,r=n,o=0,e=0;e<y&&(o++,r=r.nextZ,!!r);e++);for(m=y;o>0||m>0&&r;)o!==0&&(m===0||!r||n.z<=r.z)?(s=n,n=n.nextZ,o--):(s=r,r=r.nextZ,m--),u?u.nextZ=s:t=s,s.prevZ=u,u=s;n=r}u.nextZ=null,y*=2}while(h>1);return t}function Sx(t,e,n,r,s){return t=32767*(t-n)*s,e=32767*(e-r)*s,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function V4(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function pu(t,e,n,r,s,u,h,o){return(s-h)*(e-o)-(t-h)*(u-o)>=0&&(t-h)*(r-o)-(n-h)*(e-o)>=0&&(n-h)*(u-o)-(s-h)*(r-o)>=0}function G4(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!O4(t,e)&&Cd(t,e)&&Cd(e,t)&&j4(t,e)}function yr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ll(t,e){return t.x===e.x&&t.y===e.y}function RM(t,e,n,r){return Ll(t,n)&&Ll(e,r)||Ll(t,r)&&Ll(n,e)?!0:yr(t,e,n)>0!=yr(t,e,r)>0&&yr(n,r,t)>0!=yr(n,r,e)>0}function O4(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&RM(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Cd(t,e){return yr(t.prev,t,t.next)<0?yr(t,e,t.next)>=0&&yr(t,t.prev,e)>=0:yr(t,e,t.prev)<0||yr(t,t.next,e)<0}function j4(t,e){var n=t,r=!1,s=(t.x+e.x)/2,u=(t.y+e.y)/2;do n.y>u!=n.next.y>u&&n.next.y!==n.y&&s<(n.next.x-n.x)*(u-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function LM(t,e){var n=new Cx(t.i,t.x,t.y),r=new Cx(e.i,e.x,e.y),s=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=s,s.prev=n,r.next=n,n.prev=r,u.next=r,r.prev=u,r}function IM(t,e,n,r){var s=new Cx(t,e,n);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function Dd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Cx(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function H4(t,e,n,r){for(var s=0,u=e,h=n-r;u<n;u+=r)s+=(t[h]-t[u])*(t[u+1]+t[h+1]),h=u;return s}var Ea={area:function(t){for(var e=t.length,n=0,r=e-1,s=0;s<e;r=s++)n+=t[r].x*t[s].y-t[s].x*t[r].y;return n*.5},isClockWise:function(t){return Ea.area(t)<0},triangulateShape:function(t,e){var n=[],r=[],s=[];kM(t),BM(n,t);var u=t.length;e.forEach(kM);for(var h=0;h<e.length;h++)r.push(u),u+=e[h].length,BM(n,e[h]);for(var o=C4.triangulate(n,r),h=0;h<o.length;h+=3)s.push(o.slice(h,h+3));return s}};function kM(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function BM(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}function fu(t,e){Gn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Zs(t,e)),this.mergeVertices()}fu.prototype=Object.create(Gn.prototype),fu.prototype.constructor=fu,fu.prototype.toJSON=function(){var t=Gn.prototype.toJSON.call(this),e=this.parameters.shapes,n=this.parameters.options;return FM(e,n,t)};function Zs(t,e){wn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var n=this,r=[],s=[],u=0,h=t.length;u<h;u++){var o=t[u];m(o)}this.setAttribute("position",new dn(r,3)),this.setAttribute("uv",new dn(s,2)),this.computeVertexNormals();function m(y){var x=[],M=e.curveSegments!==void 0?e.curveSegments:12,A=e.steps!==void 0?e.steps:1,T=e.depth!==void 0?e.depth:100,P=e.bevelEnabled!==void 0?e.bevelEnabled:!0,D=e.bevelThickness!==void 0?e.bevelThickness:6,k=e.bevelSize!==void 0?e.bevelSize:D-2,z=e.bevelOffset!==void 0?e.bevelOffset:0,O=e.bevelSegments!==void 0?e.bevelSegments:3,U=e.extrudePath,H=e.UVGenerator!==void 0?e.UVGenerator:W4;e.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),T=e.amount);var V,W=!1,K,Z,tt,at;U&&(V=U.getSpacedPoints(A),W=!0,P=!1,K=U.computeFrenetFrames(A,!1),Z=new kt,tt=new kt,at=new kt),P||(O=0,D=0,k=0,z=0);var st,nt,ct,xt=y.extractPoints(M),vt=xt.shape,Zt=xt.holes,ce=!Ea.isClockWise(vt);if(ce)for(vt=vt.reverse(),nt=0,ct=Zt.length;nt<ct;nt++)st=Zt[nt],Ea.isClockWise(st)&&(Zt[nt]=st.reverse());var le=Ea.triangulateShape(vt,Zt),fe=vt;for(nt=0,ct=Zt.length;nt<ct;nt++)st=Zt[nt],vt=vt.concat(st);function de(qe,hn,Je){return hn||console.error("THREE.ExtrudeGeometry: vec does not exist"),hn.clone().multiplyScalar(Je).add(qe)}var Le,Lt,bt,qt,Wt,Nt=vt.length,se,_t=le.length;function wt(qe,hn,Je){var Jt,je,rn,In=qe.x-hn.x,xn=qe.y-hn.y,On=Je.x-qe.x,qn=Je.y-qe.y,Jn=In*In+xn*xn,Ji=In*qn-xn*On;if(Math.abs(Ji)>Number.EPSILON){var jn=Math.sqrt(Jn),Bi=Math.sqrt(On*On+qn*qn),oi=hn.x-xn/jn,or=hn.y+In/jn,Ai=Je.x-qn/Bi,Qr=Je.y+On/Bi,Oi=((Ai-oi)*qn-(Qr-or)*On)/(In*qn-xn*On);Jt=oi+In*Oi-qe.x,je=or+xn*Oi-qe.y;var $r=Jt*Jt+je*je;if($r<=2)return new ke(Jt,je);rn=Math.sqrt($r/2)}else{var Ir=!1;In>Number.EPSILON?On>Number.EPSILON&&(Ir=!0):In<-Number.EPSILON?On<-Number.EPSILON&&(Ir=!0):Math.sign(xn)===Math.sign(qn)&&(Ir=!0),Ir?(Jt=-xn,je=In,rn=Math.sqrt(Jn)):(Jt=In,je=xn,rn=Math.sqrt(Jn/2))}return new ke(Jt/rn,je/rn)}for(var Ct=[],Mt=0,jt=fe.length,ee=jt-1,pe=Mt+1;Mt<jt;Mt++,ee++,pe++)ee===jt&&(ee=0),pe===jt&&(pe=0),Ct[Mt]=wt(fe[Mt],fe[ee],fe[pe]);var Te=[],We,yt=Ct.concat();for(nt=0,ct=Zt.length;nt<ct;nt++){for(st=Zt[nt],We=[],Mt=0,jt=st.length,ee=jt-1,pe=Mt+1;Mt<jt;Mt++,ee++,pe++)ee===jt&&(ee=0),pe===jt&&(pe=0),We[Mt]=wt(st[Mt],st[ee],st[pe]);Te.push(We),yt=yt.concat(We)}for(Le=0;Le<O;Le++){for(bt=Le/O,qt=D*Math.cos(bt*Math.PI/2),Lt=k*Math.sin(bt*Math.PI/2)+z,Mt=0,jt=fe.length;Mt<jt;Mt++)Wt=de(fe[Mt],Ct[Mt],Lt),mn(Wt.x,Wt.y,-qt);for(nt=0,ct=Zt.length;nt<ct;nt++)for(st=Zt[nt],We=Te[nt],Mt=0,jt=st.length;Mt<jt;Mt++)Wt=de(st[Mt],We[Mt],Lt),mn(Wt.x,Wt.y,-qt)}for(Lt=k+z,Mt=0;Mt<Nt;Mt++)Wt=P?de(vt[Mt],yt[Mt],Lt):vt[Mt],W?(tt.copy(K.normals[0]).multiplyScalar(Wt.x),Z.copy(K.binormals[0]).multiplyScalar(Wt.y),at.copy(V[0]).add(tt).add(Z),mn(at.x,at.y,at.z)):mn(Wt.x,Wt.y,0);var St;for(St=1;St<=A;St++)for(Mt=0;Mt<Nt;Mt++)Wt=P?de(vt[Mt],yt[Mt],Lt):vt[Mt],W?(tt.copy(K.normals[St]).multiplyScalar(Wt.x),Z.copy(K.binormals[St]).multiplyScalar(Wt.y),at.copy(V[St]).add(tt).add(Z),mn(at.x,at.y,at.z)):mn(Wt.x,Wt.y,T/A*St);for(Le=O-1;Le>=0;Le--){for(bt=Le/O,qt=D*Math.cos(bt*Math.PI/2),Lt=k*Math.sin(bt*Math.PI/2)+z,Mt=0,jt=fe.length;Mt<jt;Mt++)Wt=de(fe[Mt],Ct[Mt],Lt),mn(Wt.x,Wt.y,T+qt);for(nt=0,ct=Zt.length;nt<ct;nt++)for(st=Zt[nt],We=Te[nt],Mt=0,jt=st.length;Mt<jt;Mt++)Wt=de(st[Mt],We[Mt],Lt),W?mn(Wt.x,Wt.y+V[A-1].y,V[A-1].x+qt):mn(Wt.x,Wt.y,T+qt)}Ee(),be();function Ee(){var qe=r.length/3;if(P){var hn=0,Je=Nt*hn;for(Mt=0;Mt<_t;Mt++)se=le[Mt],an(se[2]+Je,se[1]+Je,se[0]+Je);for(hn=A+O*2,Je=Nt*hn,Mt=0;Mt<_t;Mt++)se=le[Mt],an(se[0]+Je,se[1]+Je,se[2]+Je)}else{for(Mt=0;Mt<_t;Mt++)se=le[Mt],an(se[2],se[1],se[0]);for(Mt=0;Mt<_t;Mt++)se=le[Mt],an(se[0]+Nt*A,se[1]+Nt*A,se[2]+Nt*A)}n.addGroup(qe,r.length/3-qe,0)}function be(){var qe=r.length/3,hn=0;for(En(fe,hn),hn+=fe.length,nt=0,ct=Zt.length;nt<ct;nt++)st=Zt[nt],En(st,hn),hn+=st.length;n.addGroup(qe,r.length/3-qe,1)}function En(qe,hn){var Je,Jt;for(Mt=qe.length;--Mt>=0;){Je=Mt,Jt=Mt-1,Jt<0&&(Jt=qe.length-1);var je=0,rn=A+O*2;for(je=0;je<rn;je++){var In=Nt*je,xn=Nt*(je+1),On=hn+Je+In,qn=hn+Jt+In,Jn=hn+Jt+xn,Ji=hn+Je+xn;yn(On,qn,Jn,Ji)}}}function mn(qe,hn,Je){x.push(qe),x.push(hn),x.push(Je)}function an(qe,hn,Je){Tn(qe),Tn(hn),Tn(Je);var Jt=r.length/3,je=H.generateTopUV(n,r,Jt-3,Jt-2,Jt-1);pn(je[0]),pn(je[1]),pn(je[2])}function yn(qe,hn,Je,Jt){Tn(qe),Tn(hn),Tn(Jt),Tn(hn),Tn(Je),Tn(Jt);var je=r.length/3,rn=H.generateSideWallUV(n,r,je-6,je-3,je-2,je-1);pn(rn[0]),pn(rn[1]),pn(rn[3]),pn(rn[1]),pn(rn[2]),pn(rn[3])}function Tn(qe){r.push(x[qe*3+0]),r.push(x[qe*3+1]),r.push(x[qe*3+2])}function pn(qe){s.push(qe.x),s.push(qe.y)}}}Zs.prototype=Object.create(wn.prototype),Zs.prototype.constructor=Zs,Zs.prototype.toJSON=function(){var t=wn.prototype.toJSON.call(this),e=this.parameters.shapes,n=this.parameters.options;return FM(e,n,t)};var W4={generateTopUV:function(t,e,n,r,s){var u=e[n*3],h=e[n*3+1],o=e[r*3],m=e[r*3+1],y=e[s*3],x=e[s*3+1];return[new ke(u,h),new ke(o,m),new ke(y,x)]},generateSideWallUV:function(t,e,n,r,s,u){var h=e[n*3],o=e[n*3+1],m=e[n*3+2],y=e[r*3],x=e[r*3+1],M=e[r*3+2],A=e[s*3],T=e[s*3+1],P=e[s*3+2],D=e[u*3],k=e[u*3+1],z=e[u*3+2];return Math.abs(o-x)<.01?[new ke(h,1-m),new ke(y,1-M),new ke(A,1-P),new ke(D,1-z)]:[new ke(o,1-m),new ke(x,1-M),new ke(T,1-P),new ke(k,1-z)]}};function FM(t,e,n){if(n.shapes=[],Array.isArray(t))for(var r=0,s=t.length;r<s;r++){var u=t[r];n.shapes.push(u.uuid)}else n.shapes.push(t.uuid);return e.extrudePath!==void 0&&(n.options.extrudePath=e.extrudePath.toJSON()),n}function Gm(t,e){Gn.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new Rd(t,e)),this.mergeVertices()}Gm.prototype=Object.create(Gn.prototype),Gm.prototype.constructor=Gm;function Rd(t,e){e=e||{};var n=e.font;if(!(n&&n.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Gn;var r=n.generateShapes(t,e.size);e.depth=e.height!==void 0?e.height:50,e.bevelThickness===void 0&&(e.bevelThickness=10),e.bevelSize===void 0&&(e.bevelSize=8),e.bevelEnabled===void 0&&(e.bevelEnabled=!1),Zs.call(this,r,e),this.type="TextBufferGeometry"}Rd.prototype=Object.create(Zs.prototype),Rd.prototype.constructor=Rd;function Om(t,e,n,r,s,u,h){Gn.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:s,thetaStart:u,thetaLength:h},this.fromBufferGeometry(new mu(t,e,n,r,s,u,h)),this.mergeVertices()}Om.prototype=Object.create(Gn.prototype),Om.prototype.constructor=Om;function mu(t,e,n,r,s,u,h){wn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:s,thetaStart:u,thetaLength:h},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=r!==void 0?r:0,s=s!==void 0?s:Math.PI*2,u=u!==void 0?u:0,h=h!==void 0?h:Math.PI;var o=Math.min(u+h,Math.PI),m,y,x=0,M=[],A=new kt,T=new kt,P=[],D=[],k=[],z=[];for(y=0;y<=n;y++){var O=[],U=y/n,H=0;for(y==0&&u==0?H=.5/e:y==n&&o==Math.PI&&(H=-.5/e),m=0;m<=e;m++){var V=m/e;A.x=-t*Math.cos(r+V*s)*Math.sin(u+U*h),A.y=t*Math.cos(u+U*h),A.z=t*Math.sin(r+V*s)*Math.sin(u+U*h),D.push(A.x,A.y,A.z),T.copy(A).normalize(),k.push(T.x,T.y,T.z),z.push(V+H,1-U),O.push(x++)}M.push(O)}for(y=0;y<n;y++)for(m=0;m<e;m++){var W=M[y][m+1],K=M[y][m],Z=M[y+1][m],tt=M[y+1][m+1];(y!==0||u>0)&&P.push(W,K,tt),(y!==n-1||o<Math.PI)&&P.push(K,Z,tt)}this.setIndex(P),this.setAttribute("position",new dn(D,3)),this.setAttribute("normal",new dn(k,3)),this.setAttribute("uv",new dn(z,2))}mu.prototype=Object.create(wn.prototype),mu.prototype.constructor=mu;function jm(t,e,n,r,s,u){Gn.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:u},this.fromBufferGeometry(new Ld(t,e,n,r,s,u)),this.mergeVertices()}jm.prototype=Object.create(Gn.prototype),jm.prototype.constructor=jm;function Ld(t,e,n,r,s,u){wn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:u},t=t||.5,e=e||1,s=s!==void 0?s:0,u=u!==void 0?u:Math.PI*2,n=n!==void 0?Math.max(3,n):8,r=r!==void 0?Math.max(1,r):1;var h=[],o=[],m=[],y=[],x,M=t,A=(e-t)/r,T=new kt,P=new ke,D,k;for(D=0;D<=r;D++){for(k=0;k<=n;k++)x=s+k/n*u,T.x=M*Math.cos(x),T.y=M*Math.sin(x),o.push(T.x,T.y,T.z),m.push(0,0,1),P.x=(T.x/e+1)/2,P.y=(T.y/e+1)/2,y.push(P.x,P.y);M+=A}for(D=0;D<r;D++){var z=D*(n+1);for(k=0;k<n;k++){x=k+z;var O=x,U=x+n+1,H=x+n+2,V=x+1;h.push(O,U,V),h.push(U,H,V)}}this.setIndex(h),this.setAttribute("position",new dn(o,3)),this.setAttribute("normal",new dn(m,3)),this.setAttribute("uv",new dn(y,2))}Ld.prototype=Object.create(wn.prototype),Ld.prototype.constructor=Ld;function Hm(t,e,n,r){Gn.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new Id(t,e,n,r)),this.mergeVertices()}Hm.prototype=Object.create(Gn.prototype),Hm.prototype.constructor=Hm;function Id(t,e,n,r){wn.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||Math.PI*2,r=Xn.clamp(r,0,Math.PI*2);var s=[],u=[],h=[],o,m=1/e,y=new kt,x=new ke,M,A;for(M=0;M<=e;M++){var T=n+M*m*r,P=Math.sin(T),D=Math.cos(T);for(A=0;A<=t.length-1;A++)y.x=t[A].x*P,y.y=t[A].y,y.z=t[A].x*D,u.push(y.x,y.y,y.z),x.x=M/e,x.y=A/(t.length-1),h.push(x.x,x.y)}for(M=0;M<e;M++)for(A=0;A<t.length-1;A++){o=A+M*t.length;var k=o,z=o+t.length,O=o+t.length+1,U=o+1;s.push(k,z,U),s.push(z,O,U)}if(this.setIndex(s),this.setAttribute("position",new dn(u,3)),this.setAttribute("uv",new dn(h,2)),this.computeVertexNormals(),r===Math.PI*2){var H=this.attributes.normal.array,V=new kt,W=new kt,K=new kt;for(o=e*t.length*3,M=0,A=0;M<t.length;M++,A+=3)V.x=H[A+0],V.y=H[A+1],V.z=H[A+2],W.x=H[o+A+0],W.y=H[o+A+1],W.z=H[o+A+2],K.addVectors(V,W).normalize(),H[A+0]=H[o+A+0]=K.x,H[A+1]=H[o+A+1]=K.y,H[A+2]=H[o+A+2]=K.z}}Id.prototype=Object.create(wn.prototype),Id.prototype.constructor=Id;function gu(t,e){Gn.call(this),this.type="ShapeGeometry",typeof e=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new yu(t,e)),this.mergeVertices()}gu.prototype=Object.create(Gn.prototype),gu.prototype.constructor=gu,gu.prototype.toJSON=function(){var t=Gn.prototype.toJSON.call(this),e=this.parameters.shapes;return zM(e,t)};function yu(t,e){wn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var n=[],r=[],s=[],u=[],h=0,o=0;if(Array.isArray(t)===!1)y(t);else for(var m=0;m<t.length;m++)y(t[m]),this.addGroup(h,o,m),h+=o,o=0;this.setIndex(n),this.setAttribute("position",new dn(r,3)),this.setAttribute("normal",new dn(s,3)),this.setAttribute("uv",new dn(u,2));function y(x){var M,A,T,P=r.length/3,D=x.extractPoints(e),k=D.shape,z=D.holes;for(Ea.isClockWise(k)===!1&&(k=k.reverse()),M=0,A=z.length;M<A;M++)T=z[M],Ea.isClockWise(T)===!0&&(z[M]=T.reverse());var O=Ea.triangulateShape(k,z);for(M=0,A=z.length;M<A;M++)T=z[M],k=k.concat(T);for(M=0,A=k.length;M<A;M++){var U=k[M];r.push(U.x,U.y,0),s.push(0,0,1),u.push(U.x,U.y)}for(M=0,A=O.length;M<A;M++){var H=O[M],V=H[0]+P,W=H[1]+P,K=H[2]+P;n.push(V,W,K),o+=3}}}yu.prototype=Object.create(wn.prototype),yu.prototype.constructor=yu,yu.prototype.toJSON=function(){var t=wn.prototype.toJSON.call(this),e=this.parameters.shapes;return zM(e,t)};function zM(t,e){if(e.shapes=[],Array.isArray(t))for(var n=0,r=t.length;n<r;n++){var s=t[n];e.shapes.push(s.uuid)}else e.shapes.push(t.uuid);return e}function Wm(t,e){wn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=e!==void 0?e:1;var n=[],r=Math.cos(Xn.DEG2RAD*e),s=[0,0],u={},h,o,m,y=["a","b","c"],x;t.isBufferGeometry?(x=new Gn,x.fromBufferGeometry(t)):x=t.clone(),x.mergeVertices(),x.computeFaceNormals();for(var M=x.vertices,A=x.faces,T=0,P=A.length;T<P;T++)for(var D=A[T],k=0;k<3;k++)h=D[y[k]],o=D[y[(k+1)%3]],s[0]=Math.min(h,o),s[1]=Math.max(h,o),m=s[0]+","+s[1],u[m]===void 0?u[m]={index1:s[0],index2:s[1],face1:T,face2:void 0}:u[m].face2=T;for(m in u){var z=u[m];if(z.face2===void 0||A[z.face1].normal.dot(A[z.face2].normal)<=r){var O=M[z.index1];n.push(O.x,O.y,O.z),O=M[z.index2],n.push(O.x,O.y,O.z)}}this.setAttribute("position",new dn(n,3))}Wm.prototype=Object.create(wn.prototype),Wm.prototype.constructor=Wm;function xu(t,e,n,r,s,u,h,o){Gn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:s,openEnded:u,thetaStart:h,thetaLength:o},this.fromBufferGeometry(new Ta(t,e,n,r,s,u,h,o)),this.mergeVertices()}xu.prototype=Object.create(Gn.prototype),xu.prototype.constructor=xu;function Ta(t,e,n,r,s,u,h,o){wn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:s,openEnded:u,thetaStart:h,thetaLength:o};var m=this;t=t!==void 0?t:1,e=e!==void 0?e:1,n=n||1,r=Math.floor(r)||8,s=Math.floor(s)||1,u=u!==void 0?u:!1,h=h!==void 0?h:0,o=o!==void 0?o:Math.PI*2;var y=[],x=[],M=[],A=[],T=0,P=[],D=n/2,k=0;z(),u===!1&&(t>0&&O(!0),e>0&&O(!1)),this.setIndex(y),this.setAttribute("position",new dn(x,3)),this.setAttribute("normal",new dn(M,3)),this.setAttribute("uv",new dn(A,2));function z(){var U,H,V=new kt,W=new kt,K=0,Z=(e-t)/n;for(H=0;H<=s;H++){var tt=[],at=H/s,st=at*(e-t)+t;for(U=0;U<=r;U++){var nt=U/r,ct=nt*o+h,xt=Math.sin(ct),vt=Math.cos(ct);W.x=st*xt,W.y=-at*n+D,W.z=st*vt,x.push(W.x,W.y,W.z),V.set(xt,Z,vt).normalize(),M.push(V.x,V.y,V.z),A.push(nt,1-at),tt.push(T++)}P.push(tt)}for(U=0;U<r;U++)for(H=0;H<s;H++){var Zt=P[H][U],ce=P[H+1][U],le=P[H+1][U+1],fe=P[H][U+1];y.push(Zt,ce,fe),y.push(ce,le,fe),K+=6}m.addGroup(k,K,0),k+=K}function O(U){var H,V,W,K=new ke,Z=new kt,tt=0,at=U===!0?t:e,st=U===!0?1:-1;for(V=T,H=1;H<=r;H++)x.push(0,D*st,0),M.push(0,st,0),A.push(.5,.5),T++;for(W=T,H=0;H<=r;H++){var nt=H/r,ct=nt*o+h,xt=Math.cos(ct),vt=Math.sin(ct);Z.x=at*vt,Z.y=D*st,Z.z=at*xt,x.push(Z.x,Z.y,Z.z),M.push(0,st,0),K.x=xt*.5+.5,K.y=vt*.5*st+.5,A.push(K.x,K.y),T++}for(H=0;H<r;H++){var Zt=V+H,ce=W+H;U===!0?y.push(ce,ce+1,Zt):y.push(ce+1,ce,Zt),tt+=3}m.addGroup(k,tt,U===!0?1:2),k+=tt}}Ta.prototype=Object.create(wn.prototype),Ta.prototype.constructor=Ta;function qm(t,e,n,r,s,u,h){xu.call(this,0,t,e,n,r,s,u,h),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:u,thetaLength:h}}qm.prototype=Object.create(xu.prototype),qm.prototype.constructor=qm;function Ym(t,e,n,r,s,u,h){Ta.call(this,0,t,e,n,r,s,u,h),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:u,thetaLength:h}}Ym.prototype=Object.create(Ta.prototype),Ym.prototype.constructor=Ym;function Xm(t,e,n,r){Gn.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new kd(t,e,n,r)),this.mergeVertices()}Xm.prototype=Object.create(Gn.prototype),Xm.prototype.constructor=Xm;function kd(t,e,n,r){wn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||1,e=e!==void 0?Math.max(3,e):8,n=n!==void 0?n:0,r=r!==void 0?r:Math.PI*2;var s=[],u=[],h=[],o=[],m,y,x=new kt,M=new ke;for(u.push(0,0,0),h.push(0,0,1),o.push(.5,.5),y=0,m=3;y<=e;y++,m+=3){var A=n+y/e*r;x.x=t*Math.cos(A),x.y=t*Math.sin(A),u.push(x.x,x.y,x.z),h.push(0,0,1),M.x=(u[m]/t+1)/2,M.y=(u[m+1]/t+1)/2,o.push(M.x,M.y)}for(m=1;m<=e;m++)s.push(m,m+1,0);this.setIndex(s),this.setAttribute("position",new dn(u,3)),this.setAttribute("normal",new dn(h,3)),this.setAttribute("uv",new dn(o,2))}kd.prototype=Object.create(wn.prototype),kd.prototype.constructor=kd;var Lr=Object.freeze({__proto__:null,WireframeGeometry:Rm,ParametricGeometry:Lm,ParametricBufferGeometry:bd,TetrahedronGeometry:km,TetrahedronBufferGeometry:Md,OctahedronGeometry:Bm,OctahedronBufferGeometry:hu,IcosahedronGeometry:Fm,IcosahedronBufferGeometry:wd,DodecahedronGeometry:zm,DodecahedronBufferGeometry:Ad,PolyhedronGeometry:Im,PolyhedronBufferGeometry:yo,TubeGeometry:Nm,TubeBufferGeometry:du,TorusKnotGeometry:Um,TorusKnotBufferGeometry:Ed,TorusGeometry:Vm,TorusBufferGeometry:Td,TextGeometry:Gm,TextBufferGeometry:Rd,SphereGeometry:Om,SphereBufferGeometry:mu,RingGeometry:jm,RingBufferGeometry:Ld,PlaneGeometry:fm,PlaneBufferGeometry:ru,LatheGeometry:Hm,LatheBufferGeometry:Id,ShapeGeometry:gu,ShapeBufferGeometry:yu,ExtrudeGeometry:fu,ExtrudeBufferGeometry:Zs,EdgesGeometry:Wm,ConeGeometry:qm,ConeBufferGeometry:Ym,CylinderGeometry:xu,CylinderBufferGeometry:Ta,CircleGeometry:Xm,CircleBufferGeometry:kd,BoxGeometry:k3,BoxBufferGeometry:dm});function vu(t){zn.call(this),this.type="ShadowMaterial",this.color=new sn(0),this.transparent=!0,this.setValues(t)}vu.prototype=Object.create(zn.prototype),vu.prototype.constructor=vu,vu.prototype.isShadowMaterial=!0,vu.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this};function Pa(t){qr.call(this,t),this.type="RawShaderMaterial"}Pa.prototype=Object.create(qr.prototype),Pa.prototype.constructor=Pa,Pa.prototype.isRawShaderMaterial=!0;function Yr(t){zn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new sn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vl,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Yr.prototype=Object.create(zn.prototype),Yr.prototype.constructor=Yr,Yr.prototype.isMeshStandardMaterial=!0,Yr.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function _u(t){Yr.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new ke(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(t)}_u.prototype=Object.create(Yr.prototype),_u.prototype.constructor=_u,_u.prototype.isMeshPhysicalMaterial=!0,_u.prototype.copy=function(t){return Yr.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=t.reflectivity,this.clearcoat=t.clearcoat,this.clearcoatRoughness=t.clearcoatRoughness,t.sheen?this.sheen=(this.sheen||new sn).copy(t.sheen):this.sheen=null,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.transparency=t.transparency,this};function Il(t){zn.call(this),this.type="MeshPhongMaterial",this.color=new sn(16777215),this.specular=new sn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vl,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Of,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Il.prototype=Object.create(zn.prototype),Il.prototype.constructor=Il,Il.prototype.isMeshPhongMaterial=!0,Il.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function bu(t){zn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new sn(16777215),this.specular=new sn(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vl,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}bu.prototype=Object.create(zn.prototype),bu.prototype.constructor=bu,bu.prototype.isMeshToonMaterial=!0,bu.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Mu(t){zn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vl,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Mu.prototype=Object.create(zn.prototype),Mu.prototype.constructor=Mu,Mu.prototype.isMeshNormalMaterial=!0,Mu.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function wu(t){zn.call(this),this.type="MeshLambertMaterial",this.color=new sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new sn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Of,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}wu.prototype=Object.create(zn.prototype),wu.prototype.constructor=wu,wu.prototype.isMeshLambertMaterial=!0,wu.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Au(t){zn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new sn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=vl,this.normalScale=new ke(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}Au.prototype=Object.create(zn.prototype),Au.prototype.constructor=Au,Au.prototype.isMeshMatcapMaterial=!0,Au.prototype.copy=function(t){return zn.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};function Eu(t){Vi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Eu.prototype=Object.create(Vi.prototype),Eu.prototype.constructor=Eu,Eu.prototype.isLineDashedMaterial=!0,Eu.prototype.copy=function(t){return Vi.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var q4=Object.freeze({__proto__:null,ShadowMaterial:vu,SpriteMaterial:Rl,RawShaderMaterial:Pa,ShaderMaterial:qr,PointsMaterial:Aa,MeshPhysicalMaterial:_u,MeshStandardMaterial:Yr,MeshPhongMaterial:Il,MeshToonMaterial:bu,MeshNormalMaterial:Mu,MeshLambertMaterial:wu,MeshDepthMaterial:Pl,MeshDistanceMaterial:Sl,MeshBasicMaterial:gr,MeshMatcapMaterial:Au,LineDashedMaterial:Eu,LineBasicMaterial:Vi,Material:zn}),Ki={arraySlice:function(t,e,n){return Ki.isTypedArray(t)?new t.constructor(t.subarray(e,n!==void 0?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){function e(u,h){return t[u]-t[h]}for(var n=t.length,r=new Array(n),s=0;s!==n;++s)r[s]=s;return r.sort(e),r},sortedArray:function(t,e,n){for(var r=t.length,s=new t.constructor(r),u=0,h=0;h!==r;++u)for(var o=n[u]*e,m=0;m!==e;++m)s[h++]=t[o+m];return s},flattenJSON:function(t,e,n,r){for(var s=1,u=t[0];u!==void 0&&u[r]===void 0;)u=t[s++];if(u!==void 0){var h=u[r];if(h!==void 0)if(Array.isArray(h))do h=u[r],h!==void 0&&(e.push(u.time),n.push.apply(n,h)),u=t[s++];while(u!==void 0);else if(h.toArray!==void 0)do h=u[r],h!==void 0&&(e.push(u.time),h.toArray(n,n.length)),u=t[s++];while(u!==void 0);else do h=u[r],h!==void 0&&(e.push(u.time),n.push(h)),u=t[s++];while(u!==void 0)}},subclip:function(t,e,n,r,s){s=s||30;var u=t.clone();u.name=e;for(var h=[],o=0;o<u.tracks.length;++o){for(var m=u.tracks[o],y=m.getValueSize(),x=[],M=[],A=0;A<m.times.length;++A){var T=m.times[A]*s;if(!(T<n||T>=r)){x.push(m.times[A]);for(var P=0;P<y;++P)M.push(m.values[A*y+P])}}x.length!==0&&(m.times=Ki.convertArray(x,m.times.constructor),m.values=Ki.convertArray(M,m.values.constructor),h.push(m))}u.tracks=h;for(var D=1/0,o=0;o<u.tracks.length;++o)D>u.tracks[o].times[0]&&(D=u.tracks[o].times[0]);for(var o=0;o<u.tracks.length;++o)u.tracks[o].shift(-1*D);return u.resetDuration(),u}};function Xr(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}Object.assign(Xr.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,r=e[n],s=e[n-1];t:{e:{var u;n:{i:if(!(t<r)){for(var h=n+2;;){if(r===void 0){if(t<s)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,s)}if(n===h)break;if(s=r,r=e[++n],t<r)break e}u=e.length;break n}if(!(t>=s)){var o=e[1];t<o&&(n=2,s=o);for(var h=n-2;;){if(s===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===h)break;if(r=s,s=e[--n-1],t>=s)break e}u=n,n=0;break n}break t}for(;n<u;){var m=n+u>>>1;t<e[m]?u=m:n=m+1}if(r=e[n],s=e[n-1],s===void 0)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(r===void 0)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,s,t)}this._cachedIndex=n,this.intervalChanged_(n,s,r)}return this.interpolate_(n,s,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=t*r,u=0;u!==r;++u)e[u]=n[s+u];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Xr.prototype,{beforeStart_:Xr.prototype.copySampleValue_,afterEnd_:Xr.prototype.copySampleValue_});function Dx(t,e,n,r){Xr.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}Dx.prototype=Object.assign(Object.create(Xr.prototype),{constructor:Dx,DefaultSettings_:{endingStart:Fc,endingEnd:Fc},intervalChanged_:function(t,e,n){var r=this.parameterPositions,s=t-2,u=t+1,h=r[s],o=r[u];if(h===void 0)switch(this.getSettings_().endingStart){case zc:s=t,h=2*e-n;break;case Kf:s=r.length-2,h=e+r[s]-r[s+1];break;default:s=t,h=n}if(o===void 0)switch(this.getSettings_().endingEnd){case zc:u=t,o=2*n-e;break;case Kf:u=1,o=n+r[1]-r[0];break;default:u=t-1,o=e}var m=(n-e)*.5,y=this.valueSize;this._weightPrev=m/(e-h),this._weightNext=m/(o-n),this._offsetPrev=s*y,this._offsetNext=u*y},interpolate_:function(t,e,n,r){for(var s=this.resultBuffer,u=this.sampleValues,h=this.valueSize,o=t*h,m=o-h,y=this._offsetPrev,x=this._offsetNext,M=this._weightPrev,A=this._weightNext,T=(n-e)/(r-e),P=T*T,D=P*T,k=-M*D+2*M*P-M*T,z=(1+M)*D+(-1.5-2*M)*P+(-.5+M)*T+1,O=(-1-A)*D+(1.5+A)*P+.5*T,U=A*D-A*P,H=0;H!==h;++H)s[H]=k*u[y+H]+z*u[m+H]+O*u[o+H]+U*u[x+H];return s}});function Km(t,e,n,r){Xr.call(this,t,e,n,r)}Km.prototype=Object.assign(Object.create(Xr.prototype),{constructor:Km,interpolate_:function(t,e,n,r){for(var s=this.resultBuffer,u=this.sampleValues,h=this.valueSize,o=t*h,m=o-h,y=(n-e)/(r-e),x=1-y,M=0;M!==h;++M)s[M]=u[m+M]*x+u[o+M]*y;return s}});function Rx(t,e,n,r){Xr.call(this,t,e,n,r)}Rx.prototype=Object.assign(Object.create(Xr.prototype),{constructor:Rx,interpolate_:function(t){return this.copySampleValue_(t-1)}});function Mr(t,e,n,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Ki.convertArray(e,this.TimeBufferType),this.values=Ki.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}Object.assign(Mr,{toJSON:function(t){var e=t.constructor,n;if(e.toJSON!==void 0)n=e.toJSON(t);else{n={name:t.name,times:Ki.convertArray(t.times,Array),values:Ki.convertArray(t.values,Array)};var r=t.getInterpolation();r!==t.DefaultInterpolation&&(n.interpolation=r)}return n.type=t.ValueTypeName,n}}),Object.assign(Mr.prototype,{constructor:Mr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Bc,InterpolantFactoryMethodDiscrete:function(t){return new Rx(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Km(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Dx(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Jh:e=this.InterpolantFactoryMethodDiscrete;break;case Bc:e=this.InterpolantFactoryMethodLinear;break;case G0:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Jh;case this.InterpolantFactoryMethodLinear:return Bc;case this.InterpolantFactoryMethodSmooth:return G0}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(t!==0)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(t!==1)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,s=0,u=r-1;s!==r&&n[s]<t;)++s;for(;u!==-1&&n[u]>e;)--u;if(++u,s!==0||u!==r){s>=u&&(u=Math.max(u,1),s=u-1);var h=this.getValueSize();this.times=Ki.arraySlice(n,s,u),this.values=Ki.arraySlice(this.values,s*h,u*h)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var n=this.times,r=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var u=null,h=0;h!==s;h++){var o=n[h];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,h,o),t=!1;break}if(u!==null&&u>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,h,o,u),t=!1;break}u=o}if(r!==void 0&&Ki.isTypedArray(r))for(var h=0,m=r.length;h!==m;++h){var y=r[h];if(isNaN(y)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,h,y),t=!1;break}}return t},optimize:function(){for(var t=Ki.arraySlice(this.times),e=Ki.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===G0,s=1,u=t.length-1,h=1;h<u;++h){var o=!1,m=t[h],y=t[h+1];if(m!==y&&(h!==1||m!==m[0]))if(r)o=!0;else for(var x=h*n,M=x-n,A=x+n,T=0;T!==n;++T){var P=e[x+T];if(P!==e[M+T]||P!==e[A+T]){o=!0;break}}if(o){if(h!==s){t[s]=t[h];for(var D=h*n,k=s*n,T=0;T!==n;++T)e[k+T]=e[D+T]}++s}}if(u>0){t[s]=t[u];for(var D=u*n,k=s*n,T=0;T!==n;++T)e[k+T]=e[D+T];++s}return s!==t.length?(this.times=Ki.arraySlice(t,0,s),this.values=Ki.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this},clone:function(){var t=Ki.arraySlice(this.times,0),e=Ki.arraySlice(this.values,0),n=this.constructor,r=new n(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}});function Lx(t,e,n){Mr.call(this,t,e,n)}Lx.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Lx,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Jh,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Ix(t,e,n,r){Mr.call(this,t,e,n,r)}Ix.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Ix,ValueTypeName:"color"});function Tu(t,e,n,r){Mr.call(this,t,e,n,r)}Tu.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Tu,ValueTypeName:"number"});function kx(t,e,n,r){Xr.call(this,t,e,n,r)}kx.prototype=Object.assign(Object.create(Xr.prototype),{constructor:kx,interpolate_:function(t,e,n,r){for(var s=this.resultBuffer,u=this.sampleValues,h=this.valueSize,o=t*h,m=(n-e)/(r-e),y=o+h;o!==y;o+=4)Wr.slerpFlat(s,0,u,o-h,u,o,m);return s}});function Bd(t,e,n,r){Mr.call(this,t,e,n,r)}Bd.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Bd,ValueTypeName:"quaternion",DefaultInterpolation:Bc,InterpolantFactoryMethodLinear:function(t){return new kx(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0});function Bx(t,e,n,r){Mr.call(this,t,e,n,r)}Bx.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Bx,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Jh,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Pu(t,e,n,r){Mr.call(this,t,e,n,r)}Pu.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Pu,ValueTypeName:"vector"});function Co(t,e,n){this.name=t,this.tracks=n,this.duration=e!==void 0?e:-1,this.uuid=Xn.generateUUID(),this.duration<0&&this.resetDuration()}function Y4(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Tu;case"vector":case"vector2":case"vector3":case"vector4":return Pu;case"color":return Ix;case"quaternion":return Bd;case"bool":case"boolean":return Lx;case"string":return Bx}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function X4(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=Y4(t.type);if(t.times===void 0){var n=[],r=[];Ki.flattenJSON(t.keys,n,r,"value"),t.times=n,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(Co,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),s=0,u=n.length;s!==u;++s)e.push(X4(n[s]).scale(r));return new Co(t.name,t.duration,e)},toJSON:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid},s=0,u=n.length;s!==u;++s)e.push(Mr.toJSON(n[s]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){for(var s=e.length,u=[],h=0;h<s;h++){var o=[],m=[];o.push((h+s-1)%s,h,(h+1)%s),m.push(0,1,0);var y=Ki.getKeyframeOrder(o);o=Ki.sortedArray(o,1,y),m=Ki.sortedArray(m,1,y),!r&&o[0]===0&&(o.push(s),m.push(m[0])),u.push(new Tu(".morphTargetInfluences["+e[h].name+"]",o,m).scale(1/n))}return new Co(t,-1,u)},findByName:function(t,e){var n=t;if(!Array.isArray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var s=0;s<n.length;s++)if(n[s].name===e)return n[s];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var r={},s=/^([\w-]*?)([\d]+)$/,u=0,h=t.length;u<h;u++){var o=t[u],m=o.name.match(s);if(m&&m.length>1){var y=m[1],x=r[y];x||(r[y]=x=[]),x.push(o)}}var M=[];for(var y in r)M.push(Co.CreateFromMorphTargetSequence(y,r[y],e,n));return M},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(U,H,V,W,K){if(V.length!==0){var Z=[],tt=[];Ki.flattenJSON(V,Z,tt,W),Z.length!==0&&K.push(new U(H,Z,tt))}},r=[],s=t.name||"default",u=t.length||-1,h=t.fps||30,o=t.hierarchy||[],m=0;m<o.length;m++){var y=o[m].keys;if(!(!y||y.length===0))if(y[0].morphTargets){for(var x={},M=0;M<y.length;M++)if(y[M].morphTargets)for(var A=0;A<y[M].morphTargets.length;A++)x[y[M].morphTargets[A]]=-1;for(var T in x){for(var P=[],D=[],A=0;A!==y[M].morphTargets.length;++A){var k=y[M];P.push(k.time),D.push(k.morphTarget===T?1:0)}r.push(new Tu(".morphTargetInfluence["+T+"]",P,D))}u=x.length*(h||1)}else{var z=".bones["+e[m].name+"]";n(Pu,z+".position",y,"pos",r),n(Bd,z+".quaternion",y,"rot",r),n(Pu,z+".scale",y,"scl",r)}}if(r.length===0)return null;var O=new Co(s,u,r);return O}}),Object.assign(Co.prototype,{resetDuration:function(){for(var t=this.tracks,e=0,n=0,r=t.length;n!==r;++n){var s=this.tracks[n];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Co(this.name,this.duration,t)}});var Su={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function NM(t,e,n){var r=this,s=!1,u=0,h=0,o=void 0,m=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(y){h++,s===!1&&r.onStart!==void 0&&r.onStart(y,u,h),s=!0},this.itemEnd=function(y){u++,r.onProgress!==void 0&&r.onProgress(y,u,h),u===h&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(y){r.onError!==void 0&&r.onError(y)},this.resolveURL=function(y){return o?o(y):y},this.setURLModifier=function(y){return o=y,this},this.addHandler=function(y,x){return m.push(y,x),this},this.removeHandler=function(y){var x=m.indexOf(y);return x!==-1&&m.splice(x,2),this},this.getHandler=function(y){for(var x=0,M=m.length;x<M;x+=2){var A=m[x],T=m[x+1];if(A.global&&(A.lastIndex=0),A.test(y))return T}return null}}var K4=new NM;function ci(t){this.manager=t!==void 0?t:K4,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(ci.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this}});var jo={};function Do(t){ci.call(this,t)}Do.prototype=Object.assign(Object.create(ci.prototype),{constructor:Do,load:function(t,e,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var s=this,u=Su.get(t);if(u!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(u),s.manager.itemEnd(t)},0),u;if(jo[t]!==void 0){jo[t].push({onLoad:e,onProgress:n,onError:r});return}var h=/^data:(.*?)(;base64)?,(.*)$/,o=t.match(h);if(o){var m=o[1],y=!!o[2],x=o[3];x=decodeURIComponent(x),y&&(x=atob(x));try{var M,A=(this.responseType||"").toLowerCase();switch(A){case"arraybuffer":case"blob":for(var T=new Uint8Array(x.length),P=0;P<x.length;P++)T[P]=x.charCodeAt(P);A==="blob"?M=new Blob([T.buffer],{type:m}):M=T.buffer;break;case"document":var D=new DOMParser;M=D.parseFromString(x,m);break;case"json":M=JSON.parse(x);break;default:M=x;break}setTimeout(function(){e&&e(M),s.manager.itemEnd(t)},0)}catch(O){setTimeout(function(){r&&r(O),s.manager.itemError(t),s.manager.itemEnd(t)},0)}}else{jo[t]=[],jo[t].push({onLoad:e,onProgress:n,onError:r});var k=new XMLHttpRequest;k.open("GET",t,!0),k.addEventListener("load",function(O){var U=this.response,H=jo[t];if(delete jo[t],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Su.add(t,U);for(var V=0,W=H.length;V<W;V++){var K=H[V];K.onLoad&&K.onLoad(U)}s.manager.itemEnd(t)}else{for(var V=0,W=H.length;V<W;V++){var K=H[V];K.onError&&K.onError(O)}s.manager.itemError(t),s.manager.itemEnd(t)}},!1),k.addEventListener("progress",function(O){for(var U=jo[t],H=0,V=U.length;H<V;H++){var W=U[H];W.onProgress&&W.onProgress(O)}},!1),k.addEventListener("error",function(O){var U=jo[t];delete jo[t];for(var H=0,V=U.length;H<V;H++){var W=U[H];W.onError&&W.onError(O)}s.manager.itemError(t),s.manager.itemEnd(t)},!1),k.addEventListener("abort",function(O){var U=jo[t];delete jo[t];for(var H=0,V=U.length;H<V;H++){var W=U[H];W.onError&&W.onError(O)}s.manager.itemError(t),s.manager.itemEnd(t)},!1),this.responseType!==void 0&&(k.responseType=this.responseType),this.withCredentials!==void 0&&(k.withCredentials=this.withCredentials),k.overrideMimeType&&k.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var z in this.requestHeader)k.setRequestHeader(z,this.requestHeader[z]);k.send(null)}return s.manager.itemStart(t),k},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});function UM(t){ci.call(this,t)}UM.prototype=Object.assign(Object.create(ci.prototype),{constructor:UM,load:function(t,e,n,r){var s=this,u=new Do(s.manager);u.setPath(s.path),u.load(t,function(h){e(s.parse(JSON.parse(h)))},n,r)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var r=Co.parse(t[n]);e.push(r)}return e}});function VM(t){ci.call(this,t)}VM.prototype=Object.assign(Object.create(ci.prototype),{constructor:VM,load:function(t,e,n,r){var s=this,u=[],h=new _d;h.image=u;var o=new Do(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer");function m(A){o.load(t[A],function(T){var P=s.parse(T,!0);u[A]={width:P.width,height:P.height,format:P.format,mipmaps:P.mipmaps},y+=1,y===6&&(P.mipmapCount===1&&(h.minFilter=$i),h.format=P.format,h.needsUpdate=!0,e&&e(h))},n,r)}if(Array.isArray(t))for(var y=0,x=0,M=t.length;x<M;++x)m(x);else o.load(t,function(A){var T=s.parse(A,!0);if(T.isCubemap)for(var P=T.mipmaps.length/T.mipmapCount,D=0;D<P;D++){u[D]={mipmaps:[]};for(var k=0;k<T.mipmapCount;k++)u[D].mipmaps.push(T.mipmaps[D*T.mipmapCount+k]),u[D].format=T.format,u[D].width=T.width,u[D].height=T.height}else h.image.width=T.width,h.image.height=T.height,h.mipmaps=T.mipmaps;T.mipmapCount===1&&(h.minFilter=$i),h.format=T.format,h.needsUpdate=!0,e&&e(h)},n,r);return h}});function GM(t){ci.call(this,t)}GM.prototype=Object.assign(Object.create(ci.prototype),{constructor:GM,load:function(t,e,n,r){var s=this,u=new nu,h=new Do(this.manager);return h.setResponseType("arraybuffer"),h.setPath(this.path),h.load(t,function(o){var m=s.parse(o);m&&(m.image!==void 0?u.image=m.image:m.data!==void 0&&(u.image.width=m.width,u.image.height=m.height,u.image.data=m.data),u.wrapS=m.wrapS!==void 0?m.wrapS:Dr,u.wrapT=m.wrapT!==void 0?m.wrapT:Dr,u.magFilter=m.magFilter!==void 0?m.magFilter:$i,u.minFilter=m.minFilter!==void 0?m.minFilter:$i,u.anisotropy=m.anisotropy!==void 0?m.anisotropy:1,m.format!==void 0&&(u.format=m.format),m.type!==void 0&&(u.type=m.type),m.mipmaps!==void 0&&(u.mipmaps=m.mipmaps,u.minFilter=Ic),m.mipmapCount===1&&(u.minFilter=$i),u.needsUpdate=!0,e&&e(u,m))},n,r),u}});function Fd(t){ci.call(this,t)}Fd.prototype=Object.assign(Object.create(ci.prototype),{constructor:Fd,load:function(t,e,n,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var s=this,u=Su.get(t);if(u!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(u),s.manager.itemEnd(t)},0),u;var h=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){h.removeEventListener("load",o,!1),h.removeEventListener("error",m,!1),Su.add(t,this),e&&e(this),s.manager.itemEnd(t)}function m(y){h.removeEventListener("load",o,!1),h.removeEventListener("error",m,!1),r&&r(y),s.manager.itemError(t),s.manager.itemEnd(t)}return h.addEventListener("load",o,!1),h.addEventListener("error",m,!1),t.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(h.crossOrigin=this.crossOrigin),s.manager.itemStart(t),h.src=t,h}});function Fx(t){ci.call(this,t)}Fx.prototype=Object.assign(Object.create(ci.prototype),{constructor:Fx,load:function(t,e,n,r){var s=new Ma,u=new Fd(this.manager);u.setCrossOrigin(this.crossOrigin),u.setPath(this.path);var h=0;function o(y){u.load(t[y],function(x){s.images[y]=x,h++,h===6&&(s.needsUpdate=!0,e&&e(s))},void 0,r)}for(var m=0;m<t.length;++m)o(m);return s}});function zd(t){ci.call(this,t)}zd.prototype=Object.assign(Object.create(ci.prototype),{constructor:zd,load:function(t,e,n,r){var s=new bi,u=new Fd(this.manager);return u.setCrossOrigin(this.crossOrigin),u.setPath(this.path),u.load(t,function(h){s.image=h;var o=t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0;s.format=o?Ns:No,s.needsUpdate=!0,e!==void 0&&e(s)},n,r),s}});function Ln(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Ln.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var n=this.getUtoTmapping(t);return this.getPoint(n,e)},getPoints:function(t){t===void 0&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){t===void 0&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(t===void 0&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e=[],n,r=this.getPoint(0),s,u=0;for(e.push(0),s=1;s<=t;s++)n=this.getPoint(s/t),u+=n.distanceTo(r),e.push(u),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n=this.getLengths(),r=0,s=n.length,u;e?u=e:u=t*n[s-1];for(var h=0,o=s-1,m;h<=o;)if(r=Math.floor(h+(o-h)/2),m=n[r]-u,m<0)h=r+1;else if(m>0)o=r-1;else{o=r;break}if(r=o,n[r]===u)return r/(s-1);var y=n[r],x=n[r+1],M=x-y,A=(u-y)/M,T=(r+A)/(s-1);return T},getTangent:function(t){var e=1e-4,n=t-e,r=t+e;n<0&&(n=0),r>1&&(r=1);var s=this.getPoint(n),u=this.getPoint(r),h=u.clone().sub(s);return h.normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var n=new kt,r=[],s=[],u=[],h=new kt,o=new Kn,m,y,x;for(m=0;m<=t;m++)y=m/t,r[m]=this.getTangentAt(y),r[m].normalize();s[0]=new kt,u[0]=new kt;var M=Number.MAX_VALUE,A=Math.abs(r[0].x),T=Math.abs(r[0].y),P=Math.abs(r[0].z);for(A<=M&&(M=A,n.set(1,0,0)),T<=M&&(M=T,n.set(0,1,0)),P<=M&&n.set(0,0,1),h.crossVectors(r[0],n).normalize(),s[0].crossVectors(r[0],h),u[0].crossVectors(r[0],s[0]),m=1;m<=t;m++)s[m]=s[m-1].clone(),u[m]=u[m-1].clone(),h.crossVectors(r[m-1],r[m]),h.length()>Number.EPSILON&&(h.normalize(),x=Math.acos(Xn.clamp(r[m-1].dot(r[m]),-1,1)),s[m].applyMatrix4(o.makeRotationAxis(h,x))),u[m].crossVectors(r[m],s[m]);if(e===!0)for(x=Math.acos(Xn.clamp(s[0].dot(s[t]),-1,1)),x/=t,r[0].dot(h.crossVectors(s[0],s[t]))>0&&(x=-x),m=1;m<=t;m++)s[m].applyMatrix4(o.makeRotationAxis(r[m],x*m)),u[m].crossVectors(r[m],s[m]);return{tangents:r,normals:s,binormals:u}},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}});function Ro(t,e,n,r,s,u,h,o){Ln.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=s||0,this.aEndAngle=u||2*Math.PI,this.aClockwise=h||!1,this.aRotation=o||0}Ro.prototype=Object.create(Ln.prototype),Ro.prototype.constructor=Ro,Ro.prototype.isEllipseCurve=!0,Ro.prototype.getPoint=function(t,e){for(var n=e||new ke,r=Math.PI*2,s=this.aEndAngle-this.aStartAngle,u=Math.abs(s)<Number.EPSILON;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(u?s=0:s=r),this.aClockwise===!0&&!u&&(s===r?s=-r:s=s-r);var h=this.aStartAngle+t*s,o=this.aX+this.xRadius*Math.cos(h),m=this.aY+this.yRadius*Math.sin(h);if(this.aRotation!==0){var y=Math.cos(this.aRotation),x=Math.sin(this.aRotation),M=o-this.aX,A=m-this.aY;o=M*y-A*x+this.aX,m=M*x+A*y+this.aY}return n.set(o,m)},Ro.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Ro.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Ro.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this};function Nd(t,e,n,r,s,u){Ro.call(this,t,e,n,n,r,s,u),this.type="ArcCurve"}Nd.prototype=Object.create(Ro.prototype),Nd.prototype.constructor=Nd,Nd.prototype.isArcCurve=!0;function zx(){var t=0,e=0,n=0,r=0;function s(u,h,o,m){t=u,e=o,n=-3*u+3*h-2*o-m,r=2*u-2*h+o+m}return{initCatmullRom:function(u,h,o,m,y){s(h,o,y*(o-u),y*(m-h))},initNonuniformCatmullRom:function(u,h,o,m,y,x,M){var A=(h-u)/y-(o-u)/(y+x)+(o-h)/x,T=(o-h)/x-(m-h)/(x+M)+(m-o)/M;A*=x,T*=x,s(h,o,A,T)},calc:function(u){var h=u*u,o=h*u;return t+e*u+n*h+r*o}}}var Zm=new kt,Nx=new zx,Ux=new zx,Vx=new zx;function xo(t,e,n,r){Ln.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}xo.prototype=Object.create(Ln.prototype),xo.prototype.constructor=xo,xo.prototype.isCatmullRomCurve3=!0,xo.prototype.getPoint=function(t,e){var n=e||new kt,r=this.points,s=r.length,u=(s-(this.closed?0:1))*t,h=Math.floor(u),o=u-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/s)+1)*s:o===0&&h===s-1&&(h=s-2,o=1);var m,y,x,M;if(this.closed||h>0?m=r[(h-1)%s]:(Zm.subVectors(r[0],r[1]).add(r[0]),m=Zm),y=r[h%s],x=r[(h+1)%s],this.closed||h+2<s?M=r[(h+2)%s]:(Zm.subVectors(r[s-1],r[s-2]).add(r[s-1]),M=Zm),this.curveType==="centripetal"||this.curveType==="chordal"){var A=this.curveType==="chordal"?.5:.25,T=Math.pow(m.distanceToSquared(y),A),P=Math.pow(y.distanceToSquared(x),A),D=Math.pow(x.distanceToSquared(M),A);P<1e-4&&(P=1),T<1e-4&&(T=P),D<1e-4&&(D=P),Nx.initNonuniformCatmullRom(m.x,y.x,x.x,M.x,T,P,D),Ux.initNonuniformCatmullRom(m.y,y.y,x.y,M.y,T,P,D),Vx.initNonuniformCatmullRom(m.z,y.z,x.z,M.z,T,P,D)}else this.curveType==="catmullrom"&&(Nx.initCatmullRom(m.x,y.x,x.x,M.x,this.tension),Ux.initCatmullRom(m.y,y.y,x.y,M.y,this.tension),Vx.initCatmullRom(m.z,y.z,x.z,M.z,this.tension));return n.set(Nx.calc(o),Ux.calc(o),Vx.calc(o)),n},xo.prototype.copy=function(t){Ln.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},xo.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},xo.prototype.fromJSON=function(t){Ln.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(new kt().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this};function OM(t,e,n,r,s){var u=(r-e)*.5,h=(s-n)*.5,o=t*t,m=t*o;return(2*n-2*r+u+h)*m+(-3*n+3*r-2*u-h)*o+u*t+n}function Z4(t,e){var n=1-t;return n*n*e}function J4(t,e){return 2*(1-t)*t*e}function Q4(t,e){return t*t*e}function Ud(t,e,n,r){return Z4(t,e)+J4(t,n)+Q4(t,r)}function $4(t,e){var n=1-t;return n*n*n*e}function tI(t,e){var n=1-t;return 3*n*n*t*e}function eI(t,e){return 3*(1-t)*t*t*e}function nI(t,e){return t*t*t*e}function Vd(t,e,n,r,s){return $4(t,e)+tI(t,n)+eI(t,r)+nI(t,s)}function us(t,e,n,r){Ln.call(this),this.type="CubicBezierCurve",this.v0=t||new ke,this.v1=e||new ke,this.v2=n||new ke,this.v3=r||new ke}us.prototype=Object.create(Ln.prototype),us.prototype.constructor=us,us.prototype.isCubicBezierCurve=!0,us.prototype.getPoint=function(t,e){var n=e||new ke,r=this.v0,s=this.v1,u=this.v2,h=this.v3;return n.set(Vd(t,r.x,s.x,u.x,h.x),Vd(t,r.y,s.y,u.y,h.y)),n},us.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},us.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},us.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this};function Js(t,e,n,r){Ln.call(this),this.type="CubicBezierCurve3",this.v0=t||new kt,this.v1=e||new kt,this.v2=n||new kt,this.v3=r||new kt}Js.prototype=Object.create(Ln.prototype),Js.prototype.constructor=Js,Js.prototype.isCubicBezierCurve3=!0,Js.prototype.getPoint=function(t,e){var n=e||new kt,r=this.v0,s=this.v1,u=this.v2,h=this.v3;return n.set(Vd(t,r.x,s.x,u.x,h.x),Vd(t,r.y,s.y,u.y,h.y),Vd(t,r.z,s.z,u.z,h.z)),n},Js.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Js.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Js.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this};function vo(t,e){Ln.call(this),this.type="LineCurve",this.v1=t||new ke,this.v2=e||new ke}vo.prototype=Object.create(Ln.prototype),vo.prototype.constructor=vo,vo.prototype.isLineCurve=!0,vo.prototype.getPoint=function(t,e){var n=e||new ke;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},vo.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},vo.prototype.getTangent=function(){var t=this.v2.clone().sub(this.v1);return t.normalize()},vo.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},vo.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},vo.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function hs(t,e){Ln.call(this),this.type="LineCurve3",this.v1=t||new kt,this.v2=e||new kt}hs.prototype=Object.create(Ln.prototype),hs.prototype.constructor=hs,hs.prototype.isLineCurve3=!0,hs.prototype.getPoint=function(t,e){var n=e||new kt;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},hs.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},hs.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},hs.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},hs.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function ds(t,e,n){Ln.call(this),this.type="QuadraticBezierCurve",this.v0=t||new ke,this.v1=e||new ke,this.v2=n||new ke}ds.prototype=Object.create(Ln.prototype),ds.prototype.constructor=ds,ds.prototype.isQuadraticBezierCurve=!0,ds.prototype.getPoint=function(t,e){var n=e||new ke,r=this.v0,s=this.v1,u=this.v2;return n.set(Ud(t,r.x,s.x,u.x),Ud(t,r.y,s.y,u.y)),n},ds.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ds.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ds.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function Qs(t,e,n){Ln.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new kt,this.v1=e||new kt,this.v2=n||new kt}Qs.prototype=Object.create(Ln.prototype),Qs.prototype.constructor=Qs,Qs.prototype.isQuadraticBezierCurve3=!0,Qs.prototype.getPoint=function(t,e){var n=e||new kt,r=this.v0,s=this.v1,u=this.v2;return n.set(Ud(t,r.x,s.x,u.x),Ud(t,r.y,s.y,u.y),Ud(t,r.z,s.z,u.z)),n},Qs.prototype.copy=function(t){return Ln.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Qs.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Qs.prototype.fromJSON=function(t){return Ln.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this};function ps(t){Ln.call(this),this.type="SplineCurve",this.points=t||[]}ps.prototype=Object.create(Ln.prototype),ps.prototype.constructor=ps,ps.prototype.isSplineCurve=!0,ps.prototype.getPoint=function(t,e){var n=e||new ke,r=this.points,s=(r.length-1)*t,u=Math.floor(s),h=s-u,o=r[u===0?u:u-1],m=r[u],y=r[u>r.length-2?r.length-1:u+1],x=r[u>r.length-3?r.length-1:u+2];return n.set(OM(h,o.x,m.x,y.x,x.x),OM(h,o.y,m.y,y.y,x.y)),n},ps.prototype.copy=function(t){Ln.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(r.clone())}return this},ps.prototype.toJSON=function(){var t=Ln.prototype.toJSON.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var r=this.points[e];t.points.push(r.toArray())}return t},ps.prototype.fromJSON=function(t){Ln.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(new ke().fromArray(r))}return this};var Gx=Object.freeze({__proto__:null,ArcCurve:Nd,CatmullRomCurve3:xo,CubicBezierCurve:us,CubicBezierCurve3:Js,EllipseCurve:Ro,LineCurve:vo,LineCurve3:hs,QuadraticBezierCurve:ds,QuadraticBezierCurve3:Qs,SplineCurve:ps});function Sa(){Ln.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}Sa.prototype=Object.assign(Object.create(Ln.prototype),{constructor:Sa,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new vo(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=e){var s=n[r]-e,u=this.curves[r],h=u.getLength(),o=h===0?0:1-s/h;return u.getPointAt(o)}r++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){t===void 0&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e=[],n,r=0,s=this.curves;r<s.length;r++)for(var u=s[r],h=u&&u.isEllipseCurve?t*2:u&&(u.isLineCurve||u.isLineCurve3)?1:u&&u.isSplineCurve?t*u.points.length:t,o=u.getPoints(h),m=0;m<o.length;m++){var y=o[m];n&&n.equals(y)||(e.push(y),n=y)}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){Ln.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Ln.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++){var r=this.curves[e];t.curves.push(r.toJSON())}return t},fromJSON:function(t){Ln.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push(new Gx[r.type]().fromJSON(r))}return this}});function fs(t){Sa.call(this),this.type="Path",this.currentPoint=new ke,t&&this.setFromPoints(t)}fs.prototype=Object.assign(Object.create(Sa.prototype),{constructor:fs,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var n=new vo(this.currentPoint.clone(),new ke(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){var s=new ds(this.currentPoint.clone(),new ke(t,e),new ke(n,r));return this.curves.push(s),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,s,u){var h=new us(this.currentPoint.clone(),new ke(t,e),new ke(n,r),new ke(s,u));return this.curves.push(h),this.currentPoint.set(s,u),this},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t),n=new ps(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,s,u){var h=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+h,e+o,n,r,s,u),this},absarc:function(t,e,n,r,s,u){return this.absellipse(t,e,n,n,r,s,u),this},ellipse:function(t,e,n,r,s,u,h,o){var m=this.currentPoint.x,y=this.currentPoint.y;return this.absellipse(t+m,e+y,n,r,s,u,h,o),this},absellipse:function(t,e,n,r,s,u,h,o){var m=new Ro(t,e,n,r,s,u,h,o);if(this.curves.length>0){var y=m.getPoint(0);y.equals(this.currentPoint)||this.lineTo(y.x,y.y)}this.curves.push(m);var x=m.getPoint(1);return this.currentPoint.copy(x),this},copy:function(t){return Sa.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=Sa.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Sa.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}});function kl(t){fs.call(this,t),this.uuid=Xn.generateUUID(),this.type="Shape",this.holes=[]}kl.prototype=Object.assign(Object.create(fs.prototype),{constructor:kl,getPointsHoles:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){fs.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push(r.clone())}return this},toJSON:function(){var t=fs.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++){var r=this.holes[e];t.holes.push(r.toJSON())}return t},fromJSON:function(t){fs.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push(new fs().fromJSON(r))}return this}});function Ci(t,e){cn.call(this),this.type="Light",this.color=new sn(t),this.intensity=e!==void 0?e:1,this.receiveShadow=void 0}Ci.prototype=Object.assign(Object.create(cn.prototype),{constructor:Ci,isLight:!0,copy:function(t){return cn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=cn.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}});function Ox(t,e,n){Ci.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(cn.DefaultUp),this.updateMatrix(),this.groundColor=new sn(e)}Ox.prototype=Object.assign(Object.create(Ci.prototype),{constructor:Ox,isHemisphereLight:!0,copy:function(t){return Ci.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}});function $s(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new ke(512,512),this.map=null,this.mapPass=null,this.matrix=new Kn,this._frustum=new cd,this._frameExtents=new ke(1,1),this._viewportCount=1,this._viewports=[new Mi(0,0,1,1)]}Object.assign($s.prototype,{_projScreenMatrix:new Kn,_lightPositionWorld:new kt,_lookTarget:new kt,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,n=this.matrix,r=this._projScreenMatrix,s=this._lookTarget,u=this._lightPositionWorld;u.setFromMatrixPosition(t.matrixWorld),e.position.copy(u),s.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(s),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t={};return this.bias!==0&&(t.bias=this.bias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}});function jx(){$s.call(this,new er(50,1,.5,500))}jx.prototype=Object.assign(Object.create($s.prototype),{constructor:jx,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,n=Xn.RAD2DEG*2*t.angle,r=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;(n!==e.fov||r!==e.aspect||s!==e.far)&&(e.fov=n,e.aspect=r,e.far=s,e.updateProjectionMatrix()),$s.prototype.updateMatrices.call(this,t)}});function Jm(t,e,n,r,s,u){Ci.call(this,t,e),this.type="SpotLight",this.position.copy(cn.DefaultUp),this.updateMatrix(),this.target=new cn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(h){this.intensity=h/Math.PI}}),this.distance=n!==void 0?n:0,this.angle=r!==void 0?r:Math.PI/3,this.penumbra=s!==void 0?s:0,this.decay=u!==void 0?u:1,this.shadow=new jx}Jm.prototype=Object.assign(Object.create(Ci.prototype),{constructor:Jm,isSpotLight:!0,copy:function(t){return Ci.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});function Hx(){$s.call(this,new er(90,1,.5,500)),this._frameExtents=new ke(4,2),this._viewportCount=6,this._viewports=[new Mi(2,1,1,1),new Mi(0,1,1,1),new Mi(3,1,1,1),new Mi(1,1,1,1),new Mi(3,0,1,1),new Mi(1,0,1,1)],this._cubeDirections=[new kt(1,0,0),new kt(-1,0,0),new kt(0,0,1),new kt(0,0,-1),new kt(0,1,0),new kt(0,-1,0)],this._cubeUps=[new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,0,1),new kt(0,0,-1)]}Hx.prototype=Object.assign(Object.create($s.prototype),{constructor:Hx,isPointLightShadow:!0,updateMatrices:function(t,e){e===void 0&&(e=0);var n=this.camera,r=this.matrix,s=this._lightPositionWorld,u=this._lookTarget,h=this._projScreenMatrix;s.setFromMatrixPosition(t.matrixWorld),n.position.copy(s),u.copy(n.position),u.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(u),n.updateMatrixWorld(),r.makeTranslation(-s.x,-s.y,-s.z),h.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(h)}});function Qm(t,e,n,r){Ci.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(s){this.intensity=s/(4*Math.PI)}}),this.distance=n!==void 0?n:0,this.decay=r!==void 0?r:1,this.shadow=new Hx}Qm.prototype=Object.assign(Object.create(Ci.prototype),{constructor:Qm,isPointLight:!0,copy:function(t){return Ci.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}});function Cu(t,e,n,r,s,u){Ys.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t!==void 0?t:-1,this.right=e!==void 0?e:1,this.top=n!==void 0?n:1,this.bottom=r!==void 0?r:-1,this.near=s!==void 0?s:.1,this.far=u!==void 0?u:2e3,this.updateProjectionMatrix()}Cu.prototype=Object.assign(Object.create(Ys.prototype),{constructor:Cu,isOrthographicCamera:!0,copy:function(t,e){return Ys.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this},setViewOffset:function(t,e,n,r,s,u){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=u,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,s=n-t,u=n+t,h=r+e,o=r-e;if(this.view!==null&&this.view.enabled){var m=(this.right-this.left)/this.view.fullWidth/this.zoom,y=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=m*this.view.offsetX,u=s+m*this.view.width,h-=y*this.view.offsetY,o=h-y*this.view.height}this.projectionMatrix.makeOrthographic(s,u,h,o,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=cn.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}});function Wx(){$s.call(this,new Cu(-5,5,5,-5,.5,500))}Wx.prototype=Object.assign(Object.create($s.prototype),{constructor:Wx,isDirectionalLightShadow:!0,updateMatrices:function(t){$s.prototype.updateMatrices.call(this,t)}});function $m(t,e){Ci.call(this,t,e),this.type="DirectionalLight",this.position.copy(cn.DefaultUp),this.updateMatrix(),this.target=new cn,this.shadow=new Wx}$m.prototype=Object.assign(Object.create(Ci.prototype),{constructor:$m,isDirectionalLight:!0,copy:function(t){return Ci.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}});function qx(t,e){Ci.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}qx.prototype=Object.assign(Object.create(Ci.prototype),{constructor:qx,isAmbientLight:!0});function Yx(t,e,n,r){Ci.call(this,t,e),this.type="RectAreaLight",this.width=n!==void 0?n:10,this.height=r!==void 0?r:10}Yx.prototype=Object.assign(Object.create(Ci.prototype),{constructor:Yx,isRectAreaLight:!0,copy:function(t){return Ci.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=Ci.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});function Xx(t){ci.call(this,t),this.textures={}}Xx.prototype=Object.assign(Object.create(ci.prototype),{constructor:Xx,load:function(t,e,n,r){var s=this,u=new Do(s.manager);u.setPath(s.path),u.load(t,function(h){e(s.parse(JSON.parse(h)))},n,r)},parse:function(t){var e=this.textures;function n(m){return e[m]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",m),e[m]}var r=new q4[t.type];if(t.uuid!==void 0&&(r.uuid=t.uuid),t.name!==void 0&&(r.name=t.name),t.color!==void 0&&r.color.setHex(t.color),t.roughness!==void 0&&(r.roughness=t.roughness),t.metalness!==void 0&&(r.metalness=t.metalness),t.sheen!==void 0&&(r.sheen=new sn().setHex(t.sheen)),t.emissive!==void 0&&r.emissive.setHex(t.emissive),t.specular!==void 0&&r.specular.setHex(t.specular),t.shininess!==void 0&&(r.shininess=t.shininess),t.clearcoat!==void 0&&(r.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=t.clearcoatRoughness),t.vertexColors!==void 0&&(r.vertexColors=t.vertexColors),t.fog!==void 0&&(r.fog=t.fog),t.flatShading!==void 0&&(r.flatShading=t.flatShading),t.blending!==void 0&&(r.blending=t.blending),t.combine!==void 0&&(r.combine=t.combine),t.side!==void 0&&(r.side=t.side),t.opacity!==void 0&&(r.opacity=t.opacity),t.transparent!==void 0&&(r.transparent=t.transparent),t.alphaTest!==void 0&&(r.alphaTest=t.alphaTest),t.depthTest!==void 0&&(r.depthTest=t.depthTest),t.depthWrite!==void 0&&(r.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(r.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(r.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(r.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(r.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(r.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(r.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(r.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(r.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(r.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(r.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(r.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(r.rotation=t.rotation),t.linewidth!==1&&(r.linewidth=t.linewidth),t.dashSize!==void 0&&(r.dashSize=t.dashSize),t.gapSize!==void 0&&(r.gapSize=t.gapSize),t.scale!==void 0&&(r.scale=t.scale),t.polygonOffset!==void 0&&(r.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=t.polygonOffsetUnits),t.skinning!==void 0&&(r.skinning=t.skinning),t.morphTargets!==void 0&&(r.morphTargets=t.morphTargets),t.morphNormals!==void 0&&(r.morphNormals=t.morphNormals),t.dithering!==void 0&&(r.dithering=t.dithering),t.visible!==void 0&&(r.visible=t.visible),t.toneMapped!==void 0&&(r.toneMapped=t.toneMapped),t.userData!==void 0&&(r.userData=t.userData),t.uniforms!==void 0)for(var s in t.uniforms){var u=t.uniforms[s];switch(r.uniforms[s]={},u.type){case"t":r.uniforms[s].value=n(u.value);break;case"c":r.uniforms[s].value=new sn().setHex(u.value);break;case"v2":r.uniforms[s].value=new ke().fromArray(u.value);break;case"v3":r.uniforms[s].value=new kt().fromArray(u.value);break;case"v4":r.uniforms[s].value=new Mi().fromArray(u.value);break;case"m3":r.uniforms[s].value=new _r().fromArray(u.value);case"m4":r.uniforms[s].value=new Kn().fromArray(u.value);break;default:r.uniforms[s].value=u.value}}if(t.defines!==void 0&&(r.defines=t.defines),t.vertexShader!==void 0&&(r.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(r.fragmentShader=t.fragmentShader),t.extensions!==void 0)for(var h in t.extensions)r.extensions[h]=t.extensions[h];if(t.shading!==void 0&&(r.flatShading=t.shading===1),t.size!==void 0&&(r.size=t.size),t.sizeAttenuation!==void 0&&(r.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(r.map=n(t.map)),t.matcap!==void 0&&(r.matcap=n(t.matcap)),t.alphaMap!==void 0&&(r.alphaMap=n(t.alphaMap),r.transparent=!0),t.bumpMap!==void 0&&(r.bumpMap=n(t.bumpMap)),t.bumpScale!==void 0&&(r.bumpScale=t.bumpScale),t.normalMap!==void 0&&(r.normalMap=n(t.normalMap)),t.normalMapType!==void 0&&(r.normalMapType=t.normalMapType),t.normalScale!==void 0){var o=t.normalScale;Array.isArray(o)===!1&&(o=[o,o]),r.normalScale=new ke().fromArray(o)}return t.displacementMap!==void 0&&(r.displacementMap=n(t.displacementMap)),t.displacementScale!==void 0&&(r.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(r.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(r.roughnessMap=n(t.roughnessMap)),t.metalnessMap!==void 0&&(r.metalnessMap=n(t.metalnessMap)),t.emissiveMap!==void 0&&(r.emissiveMap=n(t.emissiveMap)),t.emissiveIntensity!==void 0&&(r.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(r.specularMap=n(t.specularMap)),t.envMap!==void 0&&(r.envMap=n(t.envMap)),t.envMapIntensity!==void 0&&(r.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(r.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(r.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(r.lightMap=n(t.lightMap)),t.lightMapIntensity!==void 0&&(r.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(r.aoMap=n(t.aoMap)),t.aoMapIntensity!==void 0&&(r.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(r.gradientMap=n(t.gradientMap)),t.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new ke().fromArray(t.clearcoatNormalScale)),r},setTextures:function(t){return this.textures=t,this}});var Bl={decodeText:function(t){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(s){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return e===-1?"./":t.substr(0,e+1)}};function Kx(){wn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}Kx.prototype=Object.assign(Object.create(wn.prototype),{constructor:Kx,isInstancedBufferGeometry:!0,copy:function(t){return wn.prototype.copy.call(this,t),this.maxInstancedCount=t.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var t=wn.prototype.toJSON.call(this);return t.maxInstancedCount=this.maxInstancedCount,t.isInstancedBufferGeometry=!0,t}});function Zx(t,e,n,r){typeof n=="number"&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Nn.call(this,t,e,n),this.meshPerAttribute=r||1}Zx.prototype=Object.assign(Object.create(Nn.prototype),{constructor:Zx,isInstancedBufferAttribute:!0,copy:function(t){return Nn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=Nn.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}});function Jx(t){ci.call(this,t)}Jx.prototype=Object.assign(Object.create(ci.prototype),{constructor:Jx,load:function(t,e,n,r){var s=this,u=new Do(s.manager);u.setPath(s.path),u.load(t,function(h){e(s.parse(JSON.parse(h)))},n,r)},parse:function(t){var e=t.isInstancedBufferGeometry?new Kx:new wn,n=t.data.index;if(n!==void 0){var r=new Qx[n.type](n.array);e.setIndex(new Nn(r,1))}var s=t.data.attributes;for(var u in s){var h=s[u],r=new Qx[h.type](h.array),o=h.isInstancedBufferAttribute?Zx:Nn,m=new o(r,h.itemSize,h.normalized);h.name!==void 0&&(m.name=h.name),e.setAttribute(u,m)}var y=t.data.morphAttributes;if(y)for(var u in y){for(var x=y[u],M=[],A=0,T=x.length;A<T;A++){var h=x[A],r=new Qx[h.type](h.array),m=new Nn(r,h.itemSize,h.normalized);h.name!==void 0&&(m.name=h.name),M.push(m)}e.morphAttributes[u]=M}var P=t.data.morphTargetsRelative;P&&(e.morphTargetsRelative=!0);var D=t.data.groups||t.data.drawcalls||t.data.offsets;if(D!==void 0)for(var A=0,k=D.length;A!==k;++A){var z=D[A];e.addGroup(z.start,z.count,z.materialIndex)}var O=t.data.boundingSphere;if(O!==void 0){var U=new kt;O.center!==void 0&&U.fromArray(O.center),e.boundingSphere=new js(U,O.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var Qx={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!="undefined"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function $x(t){ci.call(this,t)}$x.prototype=Object.assign(Object.create(ci.prototype),{constructor:$x,load:function(t,e,n,r){var s=this,u=this.path===""?Bl.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||u;var h=new Do(s.manager);h.setPath(this.path),h.load(t,function(o){var m=null;try{m=JSON.parse(o)}catch(x){r!==void 0&&r(x),console.error("THREE:ObjectLoader: Can't parse "+t+".",x.message);return}var y=m.metadata;if(y===void 0||y.type===void 0||y.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+t);return}s.parse(m,e)},n,r)},parse:function(t,e){var n=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,function(){e!==void 0&&e(o)}),u=this.parseTextures(t.textures,s),h=this.parseMaterials(t.materials,u),o=this.parseObject(t.object,r,h);return t.animations&&(o.animations=this.parseAnimations(t.animations)),(t.images===void 0||t.images.length===0)&&e!==void 0&&e(o),o},parseShape:function(t){var e={};if(t!==void 0)for(var n=0,r=t.length;n<r;n++){var s=new kl().fromJSON(t[n]);e[s.uuid]=s}return e},parseGeometries:function(t,e){var n={};if(t!==void 0)for(var r=new Jx,s=0,u=t.length;s<u;s++){var h,o=t[s];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":h=new Lr[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":h=new Lr[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":h=new Lr[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":h=new Lr[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":h=new Lr[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":h=new Lr[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":h=new Lr[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":h=new Lr[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":h=new Lr[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":h=new Lr[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":h=new Lr[o.type](new Gx[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":h=new Lr[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":h=new Lr[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var M=[],m=0,y=o.shapes.length;m<y;m++){var x=e[o.shapes[m]];M.push(x)}h=new Lr[o.type](M,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var M=[],m=0,y=o.shapes.length;m<y;m++){var x=e[o.shapes[m]];M.push(x)}var A=o.options.extrudePath;A!==void 0&&(o.options.extrudePath=new Gx[A.type]().fromJSON(A)),h=new Lr[o.type](M,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":h=r.parse(o);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var T=new THREE.LegacyJSONLoader;h=T.parse(o,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}h.uuid=o.uuid,o.name!==void 0&&(h.name=o.name),h.isBufferGeometry===!0&&o.userData!==void 0&&(h.userData=o.userData),n[o.uuid]=h}return n},parseMaterials:function(t,e){var n={},r={};if(t!==void 0){var s=new Xx;s.setTextures(e);for(var u=0,h=t.length;u<h;u++){var o=t[u];if(o.type==="MultiMaterial"){for(var m=[],y=0;y<o.materials.length;y++){var x=o.materials[y];n[x.uuid]===void 0&&(n[x.uuid]=s.parse(x)),m.push(n[x.uuid])}r[o.uuid]=m}else n[o.uuid]===void 0&&(n[o.uuid]=s.parse(o)),r[o.uuid]=n[o.uuid]}}return r},parseAnimations:function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],s=Co.parse(r);r.uuid!==void 0&&(s.uuid=r.uuid),e.push(s)}return e},parseImages:function(t,e){var n=this,r={};function s(D){return n.manager.itemStart(D),h.load(D,function(){n.manager.itemEnd(D)},void 0,function(){n.manager.itemError(D),n.manager.itemEnd(D)})}if(t!==void 0&&t.length>0){var u=new NM(e),h=new Fd(u);h.setCrossOrigin(this.crossOrigin);for(var o=0,m=t.length;o<m;o++){var y=t[o],x=y.url;if(Array.isArray(x)){r[y.uuid]=[];for(var M=0,A=x.length;M<A;M++){var T=x[M],P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(T)?T:n.resourcePath+T;r[y.uuid].push(s(P))}}else{var P=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(y.url)?y.url:n.resourcePath+y.url;r[y.uuid]=s(P)}}}return r},parseTextures:function(t,e){function n(m,y){return typeof m=="number"?m:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",m),y[m])}var r={};if(t!==void 0)for(var s=0,u=t.length;s<u;s++){var h=t[s];h.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',h.uuid),e[h.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",h.image);var o;Array.isArray(e[h.image])?o=new Ma(e[h.image]):o=new bi(e[h.image]),o.needsUpdate=!0,o.uuid=h.uuid,h.name!==void 0&&(o.name=h.name),h.mapping!==void 0&&(o.mapping=n(h.mapping,iI)),h.offset!==void 0&&o.offset.fromArray(h.offset),h.repeat!==void 0&&o.repeat.fromArray(h.repeat),h.center!==void 0&&o.center.fromArray(h.center),h.rotation!==void 0&&(o.rotation=h.rotation),h.wrap!==void 0&&(o.wrapS=n(h.wrap[0],jM),o.wrapT=n(h.wrap[1],jM)),h.format!==void 0&&(o.format=h.format),h.type!==void 0&&(o.type=h.type),h.encoding!==void 0&&(o.encoding=h.encoding),h.minFilter!==void 0&&(o.minFilter=n(h.minFilter,HM)),h.magFilter!==void 0&&(o.magFilter=n(h.magFilter,HM)),h.anisotropy!==void 0&&(o.anisotropy=h.anisotropy),h.flipY!==void 0&&(o.flipY=h.flipY),h.premultiplyAlpha!==void 0&&(o.premultiplyAlpha=h.premultiplyAlpha),h.unpackAlignment!==void 0&&(o.unpackAlignment=h.unpackAlignment),r[h.uuid]=o}return r},parseObject:function(t,e,n){var r;function s(k){return e[k]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",k),e[k]}function u(k){if(k!==void 0){if(Array.isArray(k)){for(var z=[],O=0,U=k.length;O<U;O++){var H=k[O];n[H]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",H),z.push(n[H])}return z}return n[k]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",k),n[k]}}switch(t.type){case"Scene":r=new Gs,t.background!==void 0&&Number.isInteger(t.background)&&(r.background=new sn(t.background)),t.fog!==void 0&&(t.fog.type==="Fog"?r.fog=new _x(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(r.fog=new vx(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":r=new er(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(r.focus=t.focus),t.zoom!==void 0&&(r.zoom=t.zoom),t.filmGauge!==void 0&&(r.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(r.filmOffset=t.filmOffset),t.view!==void 0&&(r.view=Object.assign({},t.view));break;case"OrthographicCamera":r=new Cu(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(r.zoom=t.zoom),t.view!==void 0&&(r.view=Object.assign({},t.view));break;case"AmbientLight":r=new qx(t.color,t.intensity);break;case"DirectionalLight":r=new $m(t.color,t.intensity);break;case"PointLight":r=new Qm(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":r=new Yx(t.color,t.intensity,t.width,t.height);break;case"SpotLight":r=new Jm(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":r=new Ox(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var h=s(t.geometry),o=u(t.material);h.bones&&h.bones.length>0?r=new xd(h,o):r=new ki(h,o);break;case"InstancedMesh":var h=s(t.geometry),o=u(t.material),m=t.count,y=t.instanceMatrix;r=new Ex(h,o,m),r.instanceMatrix=new Nn(new Float32Array(y.array),16);break;case"LOD":r=new vm;break;case"Line":r=new go(s(t.geometry),u(t.material),t.mode);break;case"LineLoop":r=new Em(s(t.geometry),u(t.material));break;case"LineSegments":r=new Xi(s(t.geometry),u(t.material));break;case"PointCloud":case"Points":r=new Sm(s(t.geometry),u(t.material));break;case"Sprite":r=new wx(u(t.material));break;case"Group":r=new Cl;break;default:r=new cn}if(r.uuid=t.uuid,t.name!==void 0&&(r.name=t.name),t.matrix!==void 0?(r.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=t.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(t.position!==void 0&&r.position.fromArray(t.position),t.rotation!==void 0&&r.rotation.fromArray(t.rotation),t.quaternion!==void 0&&r.quaternion.fromArray(t.quaternion),t.scale!==void 0&&r.scale.fromArray(t.scale)),t.castShadow!==void 0&&(r.castShadow=t.castShadow),t.receiveShadow!==void 0&&(r.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(r.shadow.bias=t.shadow.bias),t.shadow.radius!==void 0&&(r.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(r.visible=t.visible),t.frustumCulled!==void 0&&(r.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(r.renderOrder=t.renderOrder),t.userData!==void 0&&(r.userData=t.userData),t.layers!==void 0&&(r.layers.mask=t.layers),t.children!==void 0)for(var x=t.children,M=0;M<x.length;M++)r.add(this.parseObject(x[M],e,n));if(t.type==="LOD"){t.autoUpdate!==void 0&&(r.autoUpdate=t.autoUpdate);for(var A=t.levels,T=0;T<A.length;T++){var P=A[T],D=r.getObjectByProperty("uuid",P.object);D!==void 0&&r.addLevel(D,P.distance)}}return r}});var iI={UVMapping:k0,CubeReflectionMapping:B0,CubeRefractionMapping:F0,EquirectangularReflectionMapping:yb,EquirectangularRefractionMapping:z0,SphericalReflectionMapping:xb,CubeUVReflectionMapping:Yh,CubeUVRefractionMapping:N0},jM={RepeatWrapping:xl,ClampToEdgeWrapping:Dr,MirroredRepeatWrapping:Xh},HM={NearestFilter:Yi,NearestMipmapNearestFilter:Hf,NearestMipmapLinearFilter:Wf,LinearFilter:$i,LinearMipmapNearestFilter:U0,LinearMipmapLinearFilter:Ic};function WM(t){typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ci.call(this,t),this.options=void 0}WM.prototype=Object.assign(Object.create(ci.prototype),{constructor:WM,setOptions:function(e){return this.options=e,this},load:function(t,e,n,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);var s=this,u=Su.get(t);if(u!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(u),s.manager.itemEnd(t)},0),u;fetch(t).then(function(h){return h.blob()}).then(function(h){return s.options===void 0?createImageBitmap(h):createImageBitmap(h,s.options)}).then(function(h){Su.add(t,h),e&&e(h),s.manager.itemEnd(t)}).catch(function(h){r&&r(h),s.manager.itemError(t),s.manager.itemEnd(t)}),s.manager.itemStart(t)}});function qM(){this.type="ShapePath",this.color=new sn,this.subPaths=[],this.currentPath=null}Object.assign(qM.prototype,{moveTo:function(t,e){return this.currentPath=new fs,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,s,u){return this.currentPath.bezierCurveTo(t,e,n,r,s,u),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(vt){for(var Zt=[],ce=0,le=vt.length;ce<le;ce++){var fe=vt[ce],de=new kl;de.curves=fe.curves,Zt.push(de)}return Zt}function r(vt,Zt){for(var ce=Zt.length,le=!1,fe=ce-1,de=0;de<ce;fe=de++){var Le=Zt[fe],Lt=Zt[de],bt=Lt.x-Le.x,qt=Lt.y-Le.y;if(Math.abs(qt)>Number.EPSILON){if(qt<0&&(Le=Zt[de],bt=-bt,Lt=Zt[fe],qt=-qt),vt.y<Le.y||vt.y>Lt.y)continue;if(vt.y===Le.y){if(vt.x===Le.x)return!0}else{var Wt=qt*(vt.x-Le.x)-bt*(vt.y-Le.y);if(Wt===0)return!0;if(Wt<0)continue;le=!le}}else{if(vt.y!==Le.y)continue;if(Lt.x<=vt.x&&vt.x<=Le.x||Le.x<=vt.x&&vt.x<=Lt.x)return!0}}return le}var s=Ea.isClockWise,u=this.subPaths;if(u.length===0)return[];if(e===!0)return n(u);var h,o,m,y=[];if(u.length===1)return o=u[0],m=new kl,m.curves=o.curves,y.push(m),y;var x=!s(u[0].getPoints());x=t?!x:x;var M=[],A=[],T=[],P=0,D;A[P]=void 0,T[P]=[];for(var k=0,z=u.length;k<z;k++)o=u[k],D=o.getPoints(),h=s(D),h=t?!h:h,h?(!x&&A[P]&&P++,A[P]={s:new kl,p:D},A[P].s.curves=o.curves,x&&P++,T[P]=[]):T[P].push({h:o,p:D[0]});if(!A[0])return n(u);if(A.length>1){for(var O=!1,U=[],H=0,V=A.length;H<V;H++)M[H]=[];for(var H=0,V=A.length;H<V;H++)for(var W=T[H],K=0;K<W.length;K++){for(var Z=W[K],tt=!0,at=0;at<A.length;at++)r(Z.p,A[at].p)&&(H!==at&&U.push({froms:H,tos:at,hole:K}),tt?(tt=!1,M[at].push(Z)):O=!0);tt&&M[H].push(Z)}U.length>0&&(O||(T=M))}for(var st,k=0,nt=A.length;k<nt;k++){m=A[k].s,y.push(m),st=T[k];for(var ct=0,xt=st.length;ct<xt;ct++)m.holes.push(st[ct].h)}return y}});function YM(t){this.type="Font",this.data=t}Object.assign(YM.prototype,{isFont:!0,generateShapes:function(t,e){e===void 0&&(e=100);for(var n=[],r=rI(t,e,this.data),s=0,u=r.length;s<u;s++)Array.prototype.push.apply(n,r[s].toShapes());return n}});function rI(t,e,n){for(var r=Array.from?Array.from(t):String(t).split(""),s=e/n.resolution,u=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,h=[],o=0,m=0,y=0;y<r.length;y++){var x=r[y];if(x===`
`)o=0,m-=u;else{var M=oI(x,s,o,m,n);o+=M.offsetX,h.push(M.path)}}return h}function oI(t,e,n,r,s){var u=s.glyphs[t]||s.glyphs["?"];if(!u){console.error('THREE.Font: character "'+t+'" does not exists in font family '+s.familyName+".");return}var h=new qM,o,m,y,x,M,A,T,P;if(u.o)for(var D=u._cachedOutline||(u._cachedOutline=u.o.split(" ")),k=0,z=D.length;k<z;){var O=D[k++];switch(O){case"m":o=D[k++]*e+n,m=D[k++]*e+r,h.moveTo(o,m);break;case"l":o=D[k++]*e+n,m=D[k++]*e+r,h.lineTo(o,m);break;case"q":y=D[k++]*e+n,x=D[k++]*e+r,M=D[k++]*e+n,A=D[k++]*e+r,h.quadraticCurveTo(M,A,y,x);break;case"b":y=D[k++]*e+n,x=D[k++]*e+r,M=D[k++]*e+n,A=D[k++]*e+r,T=D[k++]*e+n,P=D[k++]*e+r,h.bezierCurveTo(M,A,T,P,y,x);break}}return{offsetX:u.ha*e,path:h}}function XM(t){ci.call(this,t)}XM.prototype=Object.assign(Object.create(ci.prototype),{constructor:XM,load:function(t,e,n,r){var s=this,u=new Do(this.manager);u.setPath(this.path),u.load(t,function(h){var o;try{o=JSON.parse(h)}catch(y){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),o=JSON.parse(h.substring(65,h.length-2))}var m=s.parse(o);e&&e(m)},n,r)},parse:function(t){return new YM(t)}});var tg,KM={getContext:function(){return tg===void 0&&(tg=new(window.AudioContext||window.webkitAudioContext)),tg},setContext:function(t){tg=t}};function t1(t){ci.call(this,t)}t1.prototype=Object.assign(Object.create(ci.prototype),{constructor:t1,load:function(t,e,n,r){var s=new Do(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(t,function(u){var h=u.slice(0),o=KM.getContext();o.decodeAudioData(h,function(m){e(m)})},n,r)}});function e1(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new kt)}Object.assign(e1.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var n=t.x,r=t.y,s=t.z,u=this.coefficients;return e.copy(u[0]).multiplyScalar(.282095),e.addScale(u[1],.488603*r),e.addScale(u[2],.488603*s),e.addScale(u[3],.488603*n),e.addScale(u[4],1.092548*(n*r)),e.addScale(u[5],1.092548*(r*s)),e.addScale(u[6],.315392*(3*s*s-1)),e.addScale(u[7],1.092548*(n*s)),e.addScale(u[8],.546274*(n*n-r*r)),e},getIrradianceAt:function(t,e){var n=t.x,r=t.y,s=t.z,u=this.coefficients;return e.copy(u[0]).multiplyScalar(.886227),e.addScale(u[1],2*.511664*r),e.addScale(u[2],2*.511664*s),e.addScale(u[3],2*.511664*n),e.addScale(u[4],2*.429043*n*r),e.addScale(u[5],2*.429043*r*s),e.addScale(u[6],.743125*s*s-.247708),e.addScale(u[7],2*.429043*n*s),e.addScale(u[8],.429043*(n*n-r*r)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(t,e){e===void 0&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(t,e+r*3);return this},toArray:function(t,e){t===void 0&&(t=[]),e===void 0&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(t,e+r*3);return t}}),Object.assign(e1,{getBasisAt:function(t,e){var n=t.x,r=t.y,s=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*s,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*s,e[6]=.315392*(3*s*s-1),e[7]=1.092548*n*s,e[8]=.546274*(n*n-r*r)}});function ms(t,e){Ci.call(this,void 0,e),this.sh=t!==void 0?t:new e1}ms.prototype=Object.assign(Object.create(Ci.prototype),{constructor:ms,isLightProbe:!0,copy:function(t){return Ci.prototype.copy.call(this,t),this.sh.copy(t.sh),this.intensity=t.intensity,this},toJSON:function(t){var e=Ci.prototype.toJSON.call(this,t);return e}});function ZM(t,e,n){ms.call(this,void 0,n);var r=new sn().set(t),s=new sn().set(e),u=new kt(r.r,r.g,r.b),h=new kt(s.r,s.g,s.b),o=Math.sqrt(Math.PI),m=o*Math.sqrt(.75);this.sh.coefficients[0].copy(u).add(h).multiplyScalar(o),this.sh.coefficients[1].copy(u).sub(h).multiplyScalar(m)}ZM.prototype=Object.assign(Object.create(ms.prototype),{constructor:ZM,isHemisphereLightProbe:!0,copy:function(t){return ms.prototype.copy.call(this,t),this},toJSON:function(t){var e=ms.prototype.toJSON.call(this,t);return e}});function JM(t,e){ms.call(this,void 0,e);var n=new sn().set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}JM.prototype=Object.assign(Object.create(ms.prototype),{constructor:JM,isAmbientLightProbe:!0,copy:function(t){return ms.prototype.copy.call(this,t),this},toJSON:function(t){var e=ms.prototype.toJSON.call(this,t);return e}});var QM=new Kn,$M=new Kn;function sI(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new er,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new er,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(sI.prototype,{update:function(t){var e=this._cache,n=e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep;if(n){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var r=t.projectionMatrix.clone(),s=e.eyeSep/2,u=s*e.near/e.focus,h=e.near*Math.tan(Xn.DEG2RAD*e.fov*.5)/e.zoom,o,m;$M.elements[12]=-s,QM.elements[12]=s,o=-h*e.aspect+u,m=h*e.aspect+u,r.elements[0]=2*e.near/(m-o),r.elements[8]=(m+o)/(m-o),this.cameraL.projectionMatrix.copy(r),o=-h*e.aspect-u,m=h*e.aspect-u,r.elements[0]=2*e.near/(m-o),r.elements[8]=(m+o)/(m-o),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply($M),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(QM)}});function tw(t){this.autoStart=t!==void 0?t:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(tw.prototype,{start:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=(typeof performance=="undefined"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var Fl=new kt,ew=new Wr,aI=new kt,zl=new kt;function nw(){cn.call(this),this.type="AudioListener",this.context=KM.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new tw}nw.prototype=Object.assign(Object.create(cn.prototype),{constructor:nw,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){cn.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Fl,ew,aI),zl.set(0,0,-1).applyQuaternion(ew),e.positionX){var r=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Fl.x,r),e.positionY.linearRampToValueAtTime(Fl.y,r),e.positionZ.linearRampToValueAtTime(Fl.z,r),e.forwardX.linearRampToValueAtTime(zl.x,r),e.forwardY.linearRampToValueAtTime(zl.y,r),e.forwardZ.linearRampToValueAtTime(zl.z,r),e.upX.linearRampToValueAtTime(n.x,r),e.upY.linearRampToValueAtTime(n.y,r),e.upZ.linearRampToValueAtTime(n.z,r)}else e.setPosition(Fl.x,Fl.y,Fl.z),e.setOrientation(zl.x,zl.y,zl.z,n.x,n.y,n.z)}});function Gd(t){cn.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Gd.prototype=Object.assign(Object.create(cn.prototype),{constructor:Gd,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(t===void 0&&(t=0),this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),this.isPlaying===!0?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var Nl=new kt,iw=new Wr,lI=new kt,Ul=new kt;function rw(t){Gd.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}rw.prototype=Object.assign(Object.create(Gd.prototype),{constructor:rw,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(cn.prototype.updateMatrixWorld.call(this,t),!(this.hasPlaybackControl===!0&&this.isPlaying===!1)){this.matrixWorld.decompose(Nl,iw,lI),Ul.set(0,0,1).applyQuaternion(iw);var e=this.panner;if(e.positionX){var n=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Nl.x,n),e.positionY.linearRampToValueAtTime(Nl.y,n),e.positionZ.linearRampToValueAtTime(Nl.z,n),e.orientationX.linearRampToValueAtTime(Ul.x,n),e.orientationY.linearRampToValueAtTime(Ul.y,n),e.orientationZ.linearRampToValueAtTime(Ul.z,n)}else e.setPosition(Nl.x,Nl.y,Nl.z),e.setOrientation(Ul.x,Ul.y,Ul.z)}}});function ow(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e!==void 0?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}Object.assign(ow.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),n=0;n<e.length;n++)t+=e[n];return t/e.length}});function sw(t,e,n){this.binding=t,this.valueSize=n;var r=Float64Array,s;switch(e){case"quaternion":s=this._slerp;break;case"string":case"bool":r=Array,s=this._select;break;default:s=this._lerp}this.buffer=new r(n*4),this._mixBufferRegion=s,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(sw.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valueSize,s=t*r+r,u=this.cumulativeWeight;if(u===0){for(var h=0;h!==r;++h)n[s+h]=n[h];u=e}else{u+=e;var o=e/u;this._mixBufferRegion(n,s,0,o,r)}this.cumulativeWeight=u},apply:function(t){var e=this.valueSize,n=this.buffer,r=t*e+e,s=this.cumulativeWeight,u=this.binding;if(this.cumulativeWeight=0,s<1){var h=e*3;this._mixBufferRegion(n,r,h,1-s,e)}for(var o=e,m=e+e;o!==m;++o)if(n[o]!==n[o+e]){u.setValue(n,r);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,n=this.valueSize,r=n*3;t.getValue(e,r);for(var s=n,u=r;s!==u;++s)e[s]=e[r+s%n];this.cumulativeWeight=0},restoreOriginalState:function(){var t=this.valueSize*3;this.binding.setValue(this.buffer,t)},_select:function(t,e,n,r,s){if(r>=.5)for(var u=0;u!==s;++u)t[e+u]=t[n+u]},_slerp:function(t,e,n,r){Wr.slerpFlat(t,e,t,e,t,n,r)},_lerp:function(t,e,n,r,s){for(var u=1-r,h=0;h!==s;++h){var o=e+h;t[o]=t[o]*u+t[n+h]*r}}});var n1="\\[\\]\\.:\\/",cI=new RegExp("["+n1+"]","g"),i1="[^"+n1+"]",uI="[^"+n1.replace("\\.","")+"]",hI=/((?:WC+[\/:])*)/.source.replace("WC",i1),dI=/(WCOD+)?/.source.replace("WCOD",uI),pI=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",i1),fI=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",i1),mI=new RegExp("^"+hI+dI+pI+fI+"$"),gI=["material","materials","bones"];function aw(t,e,n){var r=n||wr.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}Object.assign(aw.prototype,{getValue:function(t,e){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(t,e)},setValue:function(t,e){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,s=n.length;r!==s;++r)n[r].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}});function wr(t,e,n){this.path=e,this.parsedPath=n||wr.parseTrackName(e),this.node=wr.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}Object.assign(wr,{Composite:aw,create:function(t,e,n){return t&&t.isAnimationObjectGroup?new wr.Composite(t,e,n):new wr(t,e,n)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(cI,"")},parseTrackName:function(t){var e=mI.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){var s=n.nodeName.substring(r+1);gI.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||e===""||e==="root"||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){var r=function(u){for(var h=0;h<u.length;h++){var o=u[h];if(o.name===e||o.uuid===e)return o;var m=r(o.children);if(m)return m}return null},s=r(t.children);if(s)return s}return null}}),Object.assign(wr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,n){e[n]=this.node[this.propertyName]},function(e,n){for(var r=this.resolvedProperty,s=0,u=r.length;s!==u;++s)e[n++]=r[s]},function(e,n){e[n]=this.resolvedProperty[this.propertyIndex]},function(e,n){this.resolvedProperty.toArray(e,n)}],SetterByBindingTypeAndVersioning:[[function(e,n){this.targetObject[this.propertyName]=e[n]},function(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.needsUpdate=!0},function(e,n){this.targetObject[this.propertyName]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,n){for(var r=this.resolvedProperty,s=0,u=r.length;s!==u;++s)r[s]=e[n++]},function(e,n){for(var r=this.resolvedProperty,s=0,u=r.length;s!==u;++s)r[s]=e[n++];this.targetObject.needsUpdate=!0},function(e,n){for(var r=this.resolvedProperty,s=0,u=r.length;s!==u;++s)r[s]=e[n++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,n){this.resolvedProperty[this.propertyIndex]=e[n]},function(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.needsUpdate=!0},function(e,n){this.resolvedProperty[this.propertyIndex]=e[n],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,n){this.resolvedProperty.fromArray(e,n)},function(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.needsUpdate=!0},function(e,n){this.resolvedProperty.fromArray(e,n),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,n){this.bind(),this.getValue(e,n)},setValue:function(e,n){this.bind(),this.setValue(e,n)},bind:function(){var t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,s=e.propertyIndex;if(t||(t=wr.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){var u=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(var h=0;h<t.length;h++)if(t[h].name===u){u=h;break}break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(u!==void 0){if(t[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[u]}}var o=t[r];if(o===void 0){var m=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+m+"."+r+" but it wasn't found.",t);return}var y=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?y=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(y=this.Versioning.MatrixWorldNeedsUpdate);var x=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(t.geometry.isBufferGeometry){if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var h=0;h<this.node.geometry.morphAttributes.position.length;h++)if(t.geometry.morphAttributes.position[h].name===s){s=h;break}}else{if(!t.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var h=0;h<this.node.geometry.morphTargets.length;h++)if(t.geometry.morphTargets[h].name===s){s=h;break}}}x=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(x=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(x=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[x],this.setValue=this.SetterByBindingTypeAndVersioning[x][y]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(wr.prototype,{_getValue_unbound:wr.prototype.getValue,_setValue_unbound:wr.prototype.setValue});function yI(){this.uuid=Xn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}Object.assign(yI.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,s=this._paths,u=this._parsedPaths,h=this._bindings,o=h.length,m=void 0,y=0,x=arguments.length;y!==x;++y){var M=arguments[y],A=M.uuid,T=r[A];if(T===void 0){T=e++,r[A]=T,t.push(M);for(var P=0,D=o;P!==D;++P)h[P].push(new wr(M,s[P],u[P]))}else if(T<n){m=t[T];var k=--n,z=t[k];r[z.uuid]=T,t[T]=z,r[A]=k,t[k]=M;for(var P=0,D=o;P!==D;++P){var O=h[P],U=O[k],H=O[T];O[T]=U,H===void 0&&(H=new wr(M,s[P],u[P])),O[k]=H}}else t[T]!==m&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,s=r.length,u=0,h=arguments.length;u!==h;++u){var o=arguments[u],m=o.uuid,y=n[m];if(y!==void 0&&y>=e){var x=e++,M=t[x];n[M.uuid]=y,t[y]=M,n[m]=x,t[x]=o;for(var A=0,T=s;A!==T;++A){var P=r[A],D=P[x],k=P[y];P[y]=D,P[x]=k}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,n=this.nCachedObjects_,r=this._indicesByUUID,s=this._bindings,u=s.length,h=0,o=arguments.length;h!==o;++h){var m=arguments[h],y=m.uuid,x=r[y];if(x!==void 0)if(delete r[y],x<n){var M=--n,A=t[M],T=--e,P=t[T];r[A.uuid]=x,t[x]=A,r[P.uuid]=M,t[M]=P,t.pop();for(var D=0,k=u;D!==k;++D){var z=s[D],O=z[M],U=z[T];z[x]=O,z[M]=U,z.pop()}}else{var T=--e,P=t[T];r[P.uuid]=x,t[x]=P,t.pop();for(var D=0,k=u;D!==k;++D){var z=s[D];z[x]=z[T],z.pop()}}}this.nCachedObjects_=n},subscribe_:function(t,e){var n=this._bindingsIndicesByPath,r=n[t],s=this._bindings;if(r!==void 0)return s[r];var u=this._paths,h=this._parsedPaths,o=this._objects,m=o.length,y=this.nCachedObjects_,x=new Array(m);r=s.length,n[t]=r,u.push(t),h.push(e),s.push(x);for(var M=y,A=o.length;M!==A;++M){var T=o[M];x[M]=new wr(T,t,e)}return x},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,n=e[t];if(n!==void 0){var r=this._paths,s=this._parsedPaths,u=this._bindings,h=u.length-1,o=u[h],m=t[h];e[m]=n,u[n]=o,u.pop(),s[n]=s[h],s.pop(),r[n]=r[h],r.pop()}}});function lw(t,e,n){this._mixer=t,this._clip=e,this._localRoot=n||null;for(var r=e.tracks,s=r.length,u=new Array(s),h={endingStart:Fc,endingEnd:Fc},o=0;o!==s;++o){var m=r[o].createInterpolant(null);u[o]=m,m.settings=h}this._interpolantSettings=h,this._interpolants=u,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=h3,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(lw.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){var r=this._clip.duration,s=t._clip.duration,u=s/r,h=r/s;t.warp(1,u,e),this.warp(h,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){var t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){var r=this._mixer,s=r.time,u=this._timeScaleInterpolant,h=this.timeScale;u===null&&(u=r._lendControlInterpolant(),this._timeScaleInterpolant=u);var o=u.parameterPositions,m=u.sampleValues;return o[0]=s,o[1]=s+n,m[0]=t/h,m[1]=e/h,this},stopWarping:function(){var t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,n,r){if(!this.enabled){this._updateWeight(t);return}var s=this._startTime;if(s!==null){var u=(t-s)*n;if(u<0||n===0)return;this._startTime=null,e=n*u}e*=this._updateTimeScale(t);var h=this._updateTime(e),o=this._updateWeight(t);if(o>0)for(var m=this._interpolants,y=this._propertyBindings,x=0,M=m.length;x!==M;++x)m[x].evaluate(h),y[x].accumulate(r,o)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightInterpolant;if(n!==null){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var n=this._timeScaleInterpolant;if(n!==null){var r=n.evaluate(t)[0];e*=r,t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,n=this._clip.duration,r=this.loop,s=this._loopCount,u=r===d3;if(t===0)return s===-1?e:u&&(s&1)===1?n-e:e;if(r===u3){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=n)e=n;else if(e<0)e=0;else{this.time=e;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,u)):this._setEndings(this.repetitions===0,!0,u)),e>=n||e<0){var h=Math.floor(e/n);e-=n*h,s+=Math.abs(h);var o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?n:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){var m=t<0;this._setEndings(m,!m,u)}else this._setEndings(!1,!1,u);this._loopCount=s,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:h})}}else this.time=e;if(u&&(s&1)===1)return n-e}return e},_setEndings:function(t,e,n){var r=this._interpolantSettings;n?(r.endingStart=zc,r.endingEnd=zc):(t?r.endingStart=this.zeroSlopeAtStart?zc:Fc:r.endingStart=Kf,e?r.endingEnd=this.zeroSlopeAtEnd?zc:Fc:r.endingEnd=Kf)},_scheduleFading:function(t,e,n){var r=this._mixer,s=r.time,u=this._weightInterpolant;u===null&&(u=r._lendControlInterpolant(),this._weightInterpolant=u);var h=u.parameterPositions,o=u.sampleValues;return h[0]=s,o[0]=e,h[1]=s+t,o[1]=n,this}});function cw(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}cw.prototype=Object.assign(Object.create(Us.prototype),{constructor:cw,_bindAction:function(t,e){var n=t._localRoot||this._root,r=t._clip.tracks,s=r.length,u=t._propertyBindings,h=t._interpolants,o=n.uuid,m=this._bindingsByRootAndName,y=m[o];y===void 0&&(y={},m[o]=y);for(var x=0;x!==s;++x){var M=r[x],A=M.name,T=y[A];if(T!==void 0)u[x]=T;else{if(T=u[x],T!==void 0){T._cacheIndex===null&&(++T.referenceCount,this._addInactiveBinding(T,o,A));continue}var P=e&&e._propertyBindings[x].binding.parsedPath;T=new sw(wr.create(n,A,P),M.ValueTypeName,M.getValueSize()),++T.referenceCount,this._addInactiveBinding(T,o,A),u[x]=T}h[x].resultBuffer=T.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){var e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}for(var s=t._propertyBindings,u=0,h=s.length;u!==h;++u){var o=s[u];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var s=e[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return e!==null&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){var r=this._actions,s=this._actionsByClip,u=s[e];if(u===void 0)u={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=u;else{var h=u.knownActions;t._byClipCacheIndex=h.length,h.push(t)}t._cacheIndex=r.length,r.push(t),u.actionByRoot[n]=t},_removeInactiveAction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;var s=t._clip.uuid,u=this._actionsByClip,h=u[s],o=h.knownActions,m=o[o.length-1],y=t._byClipCacheIndex;m._byClipCacheIndex=y,o[y]=m,o.pop(),t._byClipCacheIndex=null;var x=h.actionByRoot,M=(t._localRoot||this._root).uuid;delete x[M],o.length===0&&delete u[s],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,n=0,r=e.length;n!==r;++n){var s=e[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}},_lendAction:function(t){var e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=n,e[n]=s},_takeBackAction:function(t){var e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=n,e[n]=s},_addInactiveBinding:function(t,e,n){var r=this._bindingsByRootAndName,s=r[e],u=this._bindings;s===void 0&&(s={},r[e]=s),s[n]=t,t._cacheIndex=u.length,u.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,n=t.binding,r=n.rootNode.uuid,s=n.path,u=this._bindingsByRootAndName,h=u[r],o=e[e.length-1],m=t._cacheIndex;o._cacheIndex=m,e[m]=o,e.pop(),delete h[s],Object.keys(h).length===0&&delete u[r]},_lendBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=n,e[n]=s},_takeBackBinding:function(t){var e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,s=e[r];t._cacheIndex=r,e[r]=t,s._cacheIndex=n,e[n]=s},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,n=t[e];return n===void 0&&(n=new Km(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,s=e[r];t.__cacheIndex=r,e[r]=t,s.__cacheIndex=n,e[n]=s},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e){var n=e||this._root,r=n.uuid,s=typeof t=="string"?Co.findByName(n,t):t,u=s!==null?s.uuid:t,h=this._actionsByClip[u],o=null;if(h!==void 0){var m=h.actionByRoot[r];if(m!==void 0)return m;o=h.knownActions[0],s===null&&(s=o._clip)}if(s===null)return null;var y=new lw(this,s,e);return this._bindAction(y,o),this._addInactiveAction(y,u,r),y},existingAction:function(t,e){var n=e||this._root,r=n.uuid,s=typeof t=="string"?Co.findByName(n,t):t,u=s?s.uuid:t,h=this._actionsByClip[u];return h!==void 0&&h.actionByRoot[r]||null},stopAllAction:function(){var t=this._actions,e=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var s=0;s!==e;++s)t[s].reset();for(var s=0;s!==r;++s)n[s].useCount=0;return this},update:function(t){t*=this.timeScale;for(var e=this._actions,n=this._nActiveActions,r=this.time+=t,s=Math.sign(t),u=this._accuIndex^=1,h=0;h!==n;++h){var o=e[h];o._update(r,t,s,u)}for(var m=this._bindings,y=this._nActiveBindings,h=0;h!==y;++h)m[h].apply(u);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,n=t.uuid,r=this._actionsByClip,s=r[n];if(s!==void 0){for(var u=s.knownActions,h=0,o=u.length;h!==o;++h){var m=u[h];this._deactivateAction(m);var y=m._cacheIndex,x=e[e.length-1];m._cacheIndex=null,m._byClipCacheIndex=null,x._cacheIndex=y,e[y]=x,e.pop(),this._removeInactiveBindingsForAction(m)}delete r[n]}},uncacheRoot:function(t){var e=t.uuid,n=this._actionsByClip;for(var r in n){var s=n[r].actionByRoot,u=s[e];u!==void 0&&(this._deactivateAction(u),this._removeInactiveAction(u))}var h=this._bindingsByRootAndName,o=h[e];if(o!==void 0)for(var m in o){var y=o[m];y.restoreOriginalState(),this._removeInactiveBinding(y)}},uncacheAction:function(t,e){var n=this.existingAction(t,e);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}});function r1(t){typeof t=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}r1.prototype.clone=function(){return new r1(this.value.clone===void 0?this.value:this.value.clone())};function uw(t,e,n){Ks.call(this,t,e),this.meshPerAttribute=n||1}uw.prototype=Object.assign(Object.create(Ks.prototype),{constructor:uw,isInstancedInterleavedBuffer:!0,copy:function(t){return Ks.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}});function xI(t,e,n,r){this.ray=new Wc(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function hw(t,e){return t.distance-e.distance}function o1(t,e,n,r){if(t.visible!==!1&&(t.raycast(e,n),r===!0))for(var s=t.children,u=0,h=s.length;u<h;u++)o1(s[u],e,n,!0)}Object.assign(xI.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,n){var r=n||[];return o1(t,this,r,e),r.sort(hw),r},intersectObjects:function(t,e,n){var r=n||[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var s=0,u=t.length;s<u;s++)o1(t[s],this,r,e);return r.sort(hw),r}});function vI(t,e,n){return this.radius=t!==void 0?t:1,this.phi=e!==void 0?e:0,this.theta=n!==void 0?n:0,this}Object.assign(vI.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Xn.clamp(e/this.radius,-1,1))),this}});function _I(t,e,n){return this.radius=t!==void 0?t:1,this.theta=e!==void 0?e:0,this.y=n!==void 0?n:0,this}Object.assign(_I.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});var dw=new ke;function pw(t,e){this.min=t!==void 0?t:new ke(1/0,1/0),this.max=e!==void 0?e:new ke(-1/0,-1/0)}Object.assign(pw.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var n=dw.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return t===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new ke),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return t===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new ke),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new ke),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return e===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new ke),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){var e=dw.copy(t).clamp(this.min,this.max);return e.sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var fw=new kt,eg=new kt;function mw(t,e){this.start=t!==void 0?t:new kt,this.end=e!==void 0?e:new kt}Object.assign(mw.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return new this.constructor().copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return t===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new kt),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return t===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),t=new kt),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return e===void 0&&(console.warn("THREE.Line3: .at() target is now required"),e=new kt),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){fw.subVectors(t,this.start),eg.subVectors(this.end,this.start);var n=eg.dot(eg),r=eg.dot(fw),s=r/n;return e&&(s=Xn.clamp(s,0,1)),s},closestPointToPoint:function(t,e,n){var r=this.closestPointToPointParameter(t,e);return n===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new kt),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}});function ng(t){cn.call(this),this.material=t,this.render=function(){}}ng.prototype=Object.create(cn.prototype),ng.prototype.constructor=ng,ng.prototype.isImmediateRenderObject=!0;var gw=new kt;function Od(t,e){cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var n=new wn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,u=1,h=32;s<h;s++,u++){var o=s/h*Math.PI*2,m=u/h*Math.PI*2;r.push(Math.cos(o),Math.sin(o),1,Math.cos(m),Math.sin(m),1)}n.setAttribute("position",new dn(r,3));var y=new Vi({fog:!1});this.cone=new Xi(n,y),this.add(this.cone),this.update()}Od.prototype=Object.create(cn.prototype),Od.prototype.constructor=Od,Od.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Od.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),gw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(gw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var Ca=new kt,ig=new Kn,s1=new Kn;function yw(t){var e=[];t&&t.isBone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,yw(t.children[n]));return e}function jd(t){for(var e=yw(t),n=new wn,r=[],s=[],u=new sn(0,0,1),h=new sn(0,1,0),o=0;o<e.length;o++){var m=e[o];m.parent&&m.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(u.r,u.g,u.b),s.push(h.r,h.g,h.b))}n.setAttribute("position",new dn(r,3)),n.setAttribute("color",new dn(s,3));var y=new Vi({vertexColors:Rc,depthTest:!1,depthWrite:!1,transparent:!0});Xi.call(this,n,y),this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}jd.prototype=Object.create(Xi.prototype),jd.prototype.constructor=jd,jd.prototype.updateMatrixWorld=function(t){var e=this.bones,n=this.geometry,r=n.getAttribute("position");s1.getInverse(this.root.matrixWorld);for(var s=0,u=0;s<e.length;s++){var h=e[s];h.parent&&h.parent.isBone&&(ig.multiplyMatrices(s1,h.matrixWorld),Ca.setFromMatrixPosition(ig),r.setXYZ(u,Ca.x,Ca.y,Ca.z),ig.multiplyMatrices(s1,h.parent.matrixWorld),Ca.setFromMatrixPosition(ig),r.setXYZ(u+1,Ca.x,Ca.y,Ca.z),u+=2)}n.getAttribute("position").needsUpdate=!0,cn.prototype.updateMatrixWorld.call(this,t)};function Hd(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;var r=new mu(e,4,2),s=new gr({wireframe:!0,fog:!1});ki.call(this,r,s),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Hd.prototype=Object.create(ki.prototype),Hd.prototype.constructor=Hd,Hd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Hd.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var bI=new kt,xw=new sn,vw=new sn;function Wd(t,e,n){cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new hu(e);r.rotateY(Math.PI*.5),this.material=new gr({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=Rc);var s=r.getAttribute("position"),u=new Float32Array(s.count*3);r.setAttribute("color",new Nn(u,3)),this.add(new ki(r,this.material)),this.update()}Wd.prototype=Object.create(cn.prototype),Wd.prototype.constructor=Wd,Wd.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Wd.prototype.update=function(){var t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");xw.copy(this.light.color),vw.copy(this.light.groundColor);for(var n=0,r=e.count;n<r;n++){var s=n<r/2?xw:vw;e.setXYZ(n,s.r,s.g,s.b)}e.needsUpdate=!0}t.lookAt(bI.setFromMatrixPosition(this.light.matrixWorld).negate())};function a1(t,e,n,r){t=t||10,e=e||10,n=new sn(n!==void 0?n:4473924),r=new sn(r!==void 0?r:8947848);for(var s=e/2,u=t/e,h=t/2,o=[],m=[],y=0,x=0,M=-h;y<=e;y++,M+=u){o.push(-h,0,M,h,0,M),o.push(M,0,-h,M,0,h);var A=y===s?n:r;A.toArray(m,x),x+=3,A.toArray(m,x),x+=3,A.toArray(m,x),x+=3,A.toArray(m,x),x+=3}var T=new wn;T.setAttribute("position",new dn(o,3)),T.setAttribute("color",new dn(m,3));var P=new Vi({vertexColors:Rc});Xi.call(this,T,P)}a1.prototype=Object.assign(Object.create(Xi.prototype),{constructor:a1,copy:function(t){return Xi.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return new this.constructor().copy(this)}});function l1(t,e,n,r,s,u){t=t||10,e=e||16,n=n||8,r=r||64,s=new sn(s!==void 0?s:4473924),u=new sn(u!==void 0?u:8947848);var h=[],o=[],m,y,x,M,A,T,P;for(M=0;M<=e;M++)x=M/e*(Math.PI*2),m=Math.sin(x)*t,y=Math.cos(x)*t,h.push(0,0,0),h.push(m,0,y),P=M&1?s:u,o.push(P.r,P.g,P.b),o.push(P.r,P.g,P.b);for(M=0;M<=n;M++)for(P=M&1?s:u,T=t-t/n*M,A=0;A<r;A++)x=A/r*(Math.PI*2),m=Math.sin(x)*T,y=Math.cos(x)*T,h.push(m,0,y),o.push(P.r,P.g,P.b),x=(A+1)/r*(Math.PI*2),m=Math.sin(x)*T,y=Math.cos(x)*T,h.push(m,0,y),o.push(P.r,P.g,P.b);var D=new wn;D.setAttribute("position",new dn(h,3)),D.setAttribute("color",new dn(o,3));var k=new Vi({vertexColors:Rc});Xi.call(this,D,k)}l1.prototype=Object.create(Xi.prototype),l1.prototype.constructor=l1;var _w=new kt,rg=new kt,bw=new kt;function qd(t,e,n){cn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,e===void 0&&(e=1);var r=new wn;r.setAttribute("position",new dn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var s=new Vi({fog:!1});this.lightPlane=new go(r,s),this.add(this.lightPlane),r=new wn,r.setAttribute("position",new dn([0,0,0,0,0,1],3)),this.targetLine=new go(r,s),this.add(this.targetLine),this.update()}qd.prototype=Object.create(cn.prototype),qd.prototype.constructor=qd,qd.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},qd.prototype.update=function(){_w.setFromMatrixPosition(this.light.matrixWorld),rg.setFromMatrixPosition(this.light.target.matrixWorld),bw.subVectors(rg,_w),this.lightPlane.lookAt(rg),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(rg),this.targetLine.scale.z=bw.length()};var og=new kt,Gi=new Ys;function sg(t){var e=new wn,n=new Vi({color:16777215,vertexColors:aC}),r=[],s=[],u={},h=new sn(16755200),o=new sn(16711680),m=new sn(43775),y=new sn(16777215),x=new sn(3355443);M("n1","n2",h),M("n2","n4",h),M("n4","n3",h),M("n3","n1",h),M("f1","f2",h),M("f2","f4",h),M("f4","f3",h),M("f3","f1",h),M("n1","f1",h),M("n2","f2",h),M("n3","f3",h),M("n4","f4",h),M("p","n1",o),M("p","n2",o),M("p","n3",o),M("p","n4",o),M("u1","u2",m),M("u2","u3",m),M("u3","u1",m),M("c","t",y),M("p","c",x),M("cn1","cn2",x),M("cn3","cn4",x),M("cf1","cf2",x),M("cf3","cf4",x);function M(T,P,D){A(T,D),A(P,D)}function A(T,P){r.push(0,0,0),s.push(P.r,P.g,P.b),u[T]===void 0&&(u[T]=[]),u[T].push(r.length/3-1)}e.setAttribute("position",new dn(r,3)),e.setAttribute("color",new dn(s,3)),Xi.call(this,e,n),this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=u,this.update()}sg.prototype=Object.create(Xi.prototype),sg.prototype.constructor=sg,sg.prototype.update=function(){var t=this.geometry,e=this.pointMap,n=1,r=1;Gi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Zi("c",e,t,Gi,0,0,-1),Zi("t",e,t,Gi,0,0,1),Zi("n1",e,t,Gi,-n,-r,-1),Zi("n2",e,t,Gi,n,-r,-1),Zi("n3",e,t,Gi,-n,r,-1),Zi("n4",e,t,Gi,n,r,-1),Zi("f1",e,t,Gi,-n,-r,1),Zi("f2",e,t,Gi,n,-r,1),Zi("f3",e,t,Gi,-n,r,1),Zi("f4",e,t,Gi,n,r,1),Zi("u1",e,t,Gi,n*.7,r*1.1,-1),Zi("u2",e,t,Gi,-n*.7,r*1.1,-1),Zi("u3",e,t,Gi,0,r*2,-1),Zi("cf1",e,t,Gi,-n,0,1),Zi("cf2",e,t,Gi,n,0,1),Zi("cf3",e,t,Gi,0,-r,1),Zi("cf4",e,t,Gi,0,r,1),Zi("cn1",e,t,Gi,-n,0,-1),Zi("cn2",e,t,Gi,n,0,-1),Zi("cn3",e,t,Gi,0,-r,-1),Zi("cn4",e,t,Gi,0,r,-1),t.getAttribute("position").needsUpdate=!0};function Zi(t,e,n,r,s,u,h){og.set(s,u,h).unproject(r);var o=e[t];if(o!==void 0)for(var m=n.getAttribute("position"),y=0,x=o.length;y<x;y++)m.setXYZ(o[y],og.x,og.y,og.z)}var ag=new Vo;function Vl(t,e){this.object=t,e===void 0&&(e=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new wn;s.setIndex(new Nn(n,1)),s.setAttribute("position",new Nn(r,3)),Xi.call(this,s,new Vi({color:e})),this.matrixAutoUpdate=!1,this.update()}Vl.prototype=Object.create(Xi.prototype),Vl.prototype.constructor=Vl,Vl.prototype.update=function(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&ag.setFromObject(this.object),!ag.isEmpty()){var e=ag.min,n=ag.max,r=this.geometry.attributes.position,s=r.array;s[0]=n.x,s[1]=n.y,s[2]=n.z,s[3]=e.x,s[4]=n.y,s[5]=n.z,s[6]=e.x,s[7]=e.y,s[8]=n.z,s[9]=n.x,s[10]=e.y,s[11]=n.z,s[12]=n.x,s[13]=n.y,s[14]=e.z,s[15]=e.x,s[16]=n.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=n.x,s[22]=e.y,s[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Vl.prototype.setFromObject=function(t){return this.object=t,this.update(),this},Vl.prototype.copy=function(t){return Xi.prototype.copy.call(this,t),this.object=t.object,this},Vl.prototype.clone=function(){return new this.constructor().copy(this)};function lg(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new wn;s.setIndex(new Nn(n,1)),s.setAttribute("position",new dn(r,3)),Xi.call(this,s,new Vi({color:e})),this.geometry.computeBoundingSphere()}lg.prototype=Object.create(Xi.prototype),lg.prototype.constructor=lg,lg.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),cn.prototype.updateMatrixWorld.call(this,t))};function cg(t,e,n){this.type="PlaneHelper",this.plane=t,this.size=e===void 0?1:e;var r=n!==void 0?n:16776960,s=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],u=new wn;u.setAttribute("position",new dn(s,3)),u.computeBoundingSphere(),go.call(this,u,new Vi({color:r}));var h=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],o=new wn;o.setAttribute("position",new dn(h,3)),o.computeBoundingSphere(),this.add(new ki(o,new gr({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}cg.prototype=Object.create(go.prototype),cg.prototype.constructor=cg,cg.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?lr:Dc,this.lookAt(this.plane.normal),cn.prototype.updateMatrixWorld.call(this,t)};var Mw=new kt,ug,c1;function Da(t,e,n,r,s,u){cn.call(this),t===void 0&&(t=new kt(0,0,1)),e===void 0&&(e=new kt(0,0,0)),n===void 0&&(n=1),r===void 0&&(r=16776960),s===void 0&&(s=.2*n),u===void 0&&(u=.2*s),ug===void 0&&(ug=new wn,ug.setAttribute("position",new dn([0,0,0,0,1,0],3)),c1=new Ta(0,.5,1,5,1),c1.translate(0,-.5,0)),this.position.copy(e),this.line=new go(ug,new Vi({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ki(c1,new gr({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,s,u)}Da.prototype=Object.create(cn.prototype),Da.prototype.constructor=Da,Da.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Mw.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Mw,e)}},Da.prototype.setLength=function(t,e,n){e===void 0&&(e=.2*t),n===void 0&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},Da.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},Da.prototype.copy=function(t){return cn.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},Da.prototype.clone=function(){return new this.constructor().copy(this)};function u1(t){t=t||1;var e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new wn;r.setAttribute("position",new dn(e,3)),r.setAttribute("color",new dn(n,3));var s=new Vi({vertexColors:Rc});Xi.call(this,r,s)}u1.prototype=Object.create(Xi.prototype),u1.prototype.constructor=u1;var Du=4,Ra=8,gs=Math.pow(2,Ra),ww=[.125,.215,.35,.446,.526,.582],Aw=Ra-Du+1+ww.length,Ru=20,ys={[ho]:0,[Qh]:1,[O0]:2,[Db]:3,[Rb]:4,[Lb]:5,[Cb]:6},h1=new Cu,hg=EI(Ru),La=null,Ia=null,{_lodPlanes:Yd,_sizeLods:Ew,_sigmas:dg}=MI(),pg=null,wi=null,d1=null,Gl=(1+Math.sqrt(5))/2,Lu=1/Gl,Tw=[new kt(1,1,1),new kt(-1,1,1),new kt(1,1,-1),new kt(-1,1,-1),new kt(0,Gl,Lu),new kt(0,Gl,-Lu),new kt(Lu,0,Gl),new kt(-Lu,0,Gl),new kt(Gl,Lu,0),new kt(-Gl,Lu,0)];function Pw(t){wi=t,p1(hg)}Pw.prototype={constructor:Pw,fromScene:function(t,e=0,n=.1,r=100){d1=wi.getRenderTarget();var s=Sw();return wI(t,n,r,s),e>0&&Lw(s,0,0,e),Rw(s),Cw(s),s},fromEquirectangular:function(t){return t.magFilter=Yi,t.minFilter=Yi,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){d1=wi.getRenderTarget();var e=Sw(t);return AI(t,e),Rw(e),Cw(e),e},compileCubemapShader:function(){Ia==null&&(Ia=Bw(),p1(Ia))},compileEquirectangularShader:function(){La==null&&(La=kw(),p1(La))},dispose:function(){hg.dispose(),Ia!=null&&Ia.dispose(),La!=null&&La.dispose();for(var t=0;t<Yd.length;t++)Yd[t].dispose()}};function MI(){for(var t=[],e=[],n=[],r=Ra,s=0;s<Aw;s++){var u=Math.pow(2,r);e.push(u);var h=1/u;s>Ra-Du?h=ww[s-Ra+Du-1]:s==0&&(h=0),n.push(h);for(var o=1/(u-1),m=-o/2,y=1+o/2,x=[m,m,y,m,y,y,m,m,y,y,m,y],M=6,A=6,T=3,P=2,D=1,k=new Float32Array(T*A*M),z=new Float32Array(P*A*M),O=new Float32Array(D*A*M),U=0;U<M;U++){var H=U%3*2/3-1,V=U>2?0:-1,W=[H,V,0,H+2/3,V,0,H+2/3,V+1,0,H,V,0,H+2/3,V+1,0,H,V+1,0];k.set(W,T*A*U),z.set(x,P*A*U);var K=[U,U,U,U,U,U];O.set(K,D*A*U)}var Z=new wn;Z.setAttribute("position",new Nn(k,T)),Z.setAttribute("uv",new Nn(z,P)),Z.setAttribute("faceIndex",new Nn(O,D)),t.push(Z),r>Du&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}function Sw(t){var e={magFilter:Yi,minFilter:Yi,generateMipmaps:!1,type:t?t.type:qf,format:t?t.format:OC,encoding:t?t.encoding:O0,depthBuffer:!1,stencilBuffer:!1},n=Dw(e);return n.depthBuffer=!t,pg=Dw(e),n}function Cw(t){pg.dispose(),wi.setRenderTarget(d1),t.scissorTest=!1,t.setSize(t.width,t.height)}function wI(t,e,n,r){var s=90,u=1,h=new er(s,u,e,n),o=[1,1,1,1,-1,1],m=[1,1,-1,-1,-1,1],y=wi.outputEncoding,x=wi.toneMapping,M=wi.toneMappingExposure,A=wi.getClearColor(),T=wi.getClearAlpha();wi.toneMapping=I0,wi.toneMappingExposure=1,wi.outputEncoding=ho,t.scale.z*=-1;var P=t.background;if(P&&P.isColor){P.convertSRGBToLinear();var D=Math.max(P.r,P.g,P.b),k=Math.min(Math.max(Math.ceil(Math.log2(D)),-128),127);P=P.multiplyScalar(Math.pow(2,-k));var z=(k+128)/255;wi.setClearColor(P,z),t.background=null}for(var O=0;O<6;O++){var U=O%3;U==0?(h.up.set(0,o[O],0),h.lookAt(m[O],0,0)):U==1?(h.up.set(0,0,o[O]),h.lookAt(0,m[O],0)):(h.up.set(0,o[O],0),h.lookAt(0,0,m[O])),f1(r,U*gs,O>2?gs:0,gs,gs),wi.setRenderTarget(r),wi.render(t,h)}wi.toneMapping=x,wi.toneMappingExposure=M,wi.outputEncoding=y,wi.setClearColor(A,T),t.scale.z*=-1}function AI(t,e){var n=new Gs;t.isCubeTexture?Ia==null&&(Ia=Bw()):La==null&&(La=kw());var r=t.isCubeTexture?Ia:La;n.add(new ki(Yd[0],r));var s=r.uniforms;s.envMap.value=t,t.isCubeTexture||s.texelSize.value.set(1/t.image.width,1/t.image.height),s.inputEncoding.value=ys[t.encoding],s.outputEncoding.value=ys[t.encoding],f1(e,0,0,3*gs,2*gs),wi.setRenderTarget(e),wi.render(n,h1)}function p1(t){var e=new Gs;e.add(new ki(Yd[0],t)),wi.compile(e,h1)}function Dw(t){var e=new Rr(3*gs,3*gs,t);return e.texture.mapping=Yh,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function f1(t,e,n,r,s){t.viewport.set(e,n,r,s),t.scissor.set(e,n,r,s)}function Rw(t){var e=wi.autoClear;wi.autoClear=!1;for(var n=1;n<Aw;n++){var r=Math.sqrt(dg[n]*dg[n]-dg[n-1]*dg[n-1]),s=Tw[(n-1)%Tw.length];Lw(t,n-1,n,r,s)}wi.autoClear=e}function Lw(t,e,n,r,s){Iw(t,pg,e,n,r,"latitudinal",s),Iw(pg,t,n,n,r,"longitudinal",s)}function Iw(t,e,n,r,s,u,h){u!=="latitudinal"&&u!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var o=3,m=new Gs;m.add(new ki(Yd[r],hg));var y=hg.uniforms,x=Ew[n]-1,M=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Ru-1),A=s/M,T=isFinite(s)?1+Math.floor(o*A):Ru;T>Ru&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${T} samples when the maximum is set to ${Ru}`);for(var P=[],D=0,k=0;k<Ru;++k){var U=k/A,z=Math.exp(-U*U/2);P.push(z),k==0?D+=z:k<T&&(D+=2*z)}for(var k=0;k<P.length;k++)P[k]=P[k]/D;y.envMap.value=t.texture,y.samples.value=T,y.weights.value=P,y.latitudinal.value=u==="latitudinal",h&&(y.poleAxis.value=h),y.dTheta.value=M,y.mipInt.value=Ra-n,y.inputEncoding.value=ys[t.texture.encoding],y.outputEncoding.value=ys[t.texture.encoding];var O=Ew[r],U=3*Math.max(0,gs-2*O),H=(r===0?0:2*gs)+2*O*(r>Ra-Du?r-Ra+Du:0);f1(e,U,H,3*O,2*O),wi.setRenderTarget(e),wi.render(m,h1)}function EI(t){var e=new Float32Array(t),n=new kt(0,1,0),r=new Pa({defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:ys[ho]},outputEncoding:{value:ys[ho]}},vertexShader:m1(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;

${g1()}

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

void main() {
	gl_FragColor = vec4(0.0);
	for (int i = 0; i < n; i++) {
		if (i >= samples)
			break;
		for (int dir = -1; dir < 2; dir += 2) {
			if (i == 0 && dir == 1)
				continue;
			vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
			if (all(equal(axis, vec3(0.0))))
				axis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);
			axis = normalize(axis);
			float theta = dTheta * float(dir * i);
			float cosTheta = cos(theta);
			// Rodrigues' axis-angle rotation
			vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross(axis, vOutputDirection) * sin(theta)
					+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
			gl_FragColor.rgb +=
					weights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);
		}
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:ya,depthTest:!1,depthWrite:!1});return r.type="SphericalGaussianBlur",r}function kw(){var t=new ke(1,1),e=new Pa({uniforms:{envMap:{value:null},texelSize:{value:t},inputEncoding:{value:ys[ho]},outputEncoding:{value:ys[ho]}},vertexShader:m1(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;

${g1()}

#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv;
	uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
	uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:ya,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function Bw(){var t=new Pa({uniforms:{envMap:{value:null},inputEncoding:{value:ys[ho]},outputEncoding:{value:ys[ho]}},vertexShader:m1(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;

${g1()}

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:ya,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function m1(){return`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`}function g1(){return`
uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	`}Ln.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Ln.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(Sa.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new Gn,n=0,r=t.length;n<r;n++){var s=t[n];e.vertices.push(new kt(s.x,s.y,s.z||0))}return e}}),Object.assign(fs.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Object.create(xo.prototype),Object.create(xo.prototype);function Fw(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),xo.call(this,t),this.type="catmullrom"}Fw.prototype=Object.create(xo.prototype),Object.assign(Fw.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),a1.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},jd.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ci.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Bl.extractUrlBase(t)}}),ci.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign($x.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(pw.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Vo.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),cd.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},mw.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Xn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Xn.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Xn.ceilPowerOfTwo(t)}}),Object.assign(_r.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Kn.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new kt().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,s,u){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,s,u)}}),as.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Wr.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Wc.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(mr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(mr,{barycoordFromPoint:function(t,e,n,r,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),mr.getBarycoord(t,e,n,r,s)},normal:function(t,e,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),mr.getNormal(t,e,n,r)}}),Object.assign(kl.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new fu(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new gu(this,t)}}),Object.assign(ke.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Mi.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Gn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(cn.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(cn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(ki.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(ki.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),p3},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(vm.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(_m.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),xd.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ln.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),er.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Ci.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Nn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===$h},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage($h)}}}),Object.assign(Nn.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(t===!0?$h:Zf),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(wn.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Nn(arguments[1],arguments[2]))):t==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e)},addDrawCall:function(t,e,n){n!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(wn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ks.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===$h},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Ks.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(t===!0?$h:Zf),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Zs.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(r1.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(zn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new sn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===lb}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Il.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(qr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(yM.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(yM.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=t===!0?Qh:ho}}}),Object.defineProperties(mM.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Rr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Gd.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this,n=new t1;return n.load(t,function(r){e.setBuffer(r)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),ow.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ld.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},_l.crossOrigin=void 0,_l.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var s=new zd;s.setCrossOrigin(this.crossOrigin);var u=s.load(t,n,void 0,r);return e&&(u.mapping=e),u},_l.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var s=new Fx;s.setCrossOrigin(this.crossOrigin);var u=s.load(t,n,void 0,r);return e&&(u.mapping=e),u},_l.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},_l.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:iC}}));class fg extends $.MxDbAlignedDimension{constructor(){super()}getDimText(){var e=new kt(this.point1.x-this.point2.x,this.point1.y-this.point2.y,0),n=e.length();return n.toFixed(2)}create(){return new fg}getTypeName(){return this.constructor.name}}function TI(){return Gt(this,null,function*(){const t=new $.MrxDbgUiPrPoint;t.setMessage(G("指定第一点:")),t.go(e=>{if(e!=0)return;const n=t.value();let r=new fg;r.setPoint1(n),r.setColor(65314);const s=new $.McEdGetPointWorldDrawObject;s.setDraw(u=>{r.setPoint2(u),s.drawCustomEntity(r)}),t.setBasePt(n),t.setUseBasePt(!0),t.setUserDraw(s),t.setMessage(G("指定第二点:")),t.setInputToucheType($.MxType.InputToucheType.kGetEnd),t.go(u=>{if(u!=0){console.log(u);return}const h=t.value();r.setPoint2(h),$.MxFun.getCurrentDraw().addMxEntity(r),alert("测试长度是："+r.getDimText())})})})}function PI(){const t=new $.MrxDbgUiPrPoint,e=$.MxFun.getCurrentDraw(),n=new $.MxDb2LineAngularDimension;n.color=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const r=new $.McEdGetPointWorldDrawObject;r.setColor(p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor()),t.setMessage(G("指定第一点:")),t.go(s=>{s===0&&(t.setMessage(G("指定第二个角度点:")),n.point1=t.value(),r.setDraw((u,h)=>{n.point2=u,h.drawLine(n.point1,u)}),t.setUserDraw(r),t.go(u=>{t.setMessage(G("指定最后一个点:")),u===0&&(n.point2=t.value(),r.setDraw((h,o)=>{n.point3=h,r.drawCustomEntity(n)}),t.go(h=>{h===0&&e.addMxEntity(n)}))}))})}function SI(){const t=new $.MrxDbgUiPrPoint;t.setMessage(G("指定坐标点:")),t.go(e=>{if(e!=0)return;const n=t.value();let r=new $.MxDbCoord;r.point1=n,r.point2=n.clone(),r.color=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),t.setBasePt(n),t.setUseBasePt(!0),t.setUserDraw((s,u)=>{r.point2=s,u.drawCustomEntity(r)}),t.setMessage(G("指定标注点:")),t.go(s=>{if(s!=0){console.log(s);return}r.point2=t.value(),$.MxFun.addToCurrentSpace(r)})})}function CI(){new fg().rxInit(),$.MxFun.addCommand("Mx_Linear",TI),$.MxFun.addCommand("BR_AngleMeasure",PI),$.MxFun.addCommand("BR_CoordMeasure",SI)}function DI(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage("select entity:");let n=(yield t.go()).getMcDbEntity();if(n!==null){if(console.log("ent.objectName",n.objectName),n instanceof p.McDbBlockReference){let s=n.explode();if(s.GetCount()==0)return;let u=s.GetCount();for(let h=0;h<u;h++){let o=s.AtObject(h).val;if(o instanceof p.McDbPolyline){let m=o,y=m.numVerts();for(let x=0;x<y;x++){let M=m.getPointAt(x),A=m.getBulgeAt(x);console.log("polyline.pt"+x+":"+Jr(M.val)),console.log("polyline.bulge"+x+":"+A)}}}}else if(n instanceof p.McDbPolyline){let r=n,s=r.numVerts();for(let u=0;u<s;u++){let h=r.getPointAt(u),o=r.getBulgeAt(u);console.log("polyline.pt"+u+":"+Jr(h.val)),console.log("polyline.bulge"+u+":"+o)}}}})}function RI(){$.MxFun.addCommand("MxTest_SelectEntity",DI)}class LI{constructor(){this.m_aryColumn=[],this.m_allData=[],this.m_dColumnHeight=14,this.m_dRowHeight=10,this.m_dRowLineWdith=0,this.m_dColumnLineWidth=.5,this.m_dRowTextHeight=6,this.m_dColumnTextHeight=10}addColumn(e,n){this.m_aryColumn.push({name:e,w:n})}addRow(e){this.m_allData.push(e)}}class zw{constructor(){this.data=new LI,this.pt=new p.McGePoint3d,this.dScale=1,this.mxcad=p.MxCpp.getCurrentMxCAD()}draw(e,n){return this.pt=e,this.dScale=n,this.data.m_aryColumn.length==0||this.data.m_allData.length==0?!1:(this.DrawTableHead(),this.DrawContent(),!0)}DrawTableHead(){let e=this.data,n=this.pt.clone(),r=this.pt.clone(),s=new p.McGeVector3d(0,1,0).mult(this.Scale(this.data.m_dColumnHeight));console.log(s);let u=this.Scale(this.data.m_dColumnLineWidth),h=0,o=new p.McGeVector3d(1,0,0);for(let m=0;m<e.m_aryColumn.length;m++){let y=e.m_aryColumn[m];this.DrawLine(r,r.clone().subvec(s),u),this.DrawMCText(r.clone().addvec(o.clone().mult(this.Scale(y.w)*.5)).subvec(s.clone().mult(.5)),y.name,this.Scale(e.m_dColumnTextHeight)),r.addvec(o.clone().mult(this.Scale(y.w))),h+=this.Scale(y.w)}return this.DrawLine(r,r.clone().subvec(s),u),this.DrawLine(n,n.clone().addvec(o.clone().mult(h)),u),this.DrawLine(n.clone().subvec(s),n.addvec(o.clone().mult(h)).subvec(s),u),!0}DrawContent(){let e=this.data,n=this.pt,r=0;for(let y=0;y<e.m_aryColumn.length;y++)r+=this.Scale(e.m_aryColumn[y].w);let s=this.Scale(this.data.m_dRowLineWdith),u=new p.McGeVector3d(1,0,0),h=new p.McGeVector3d(0,1,0),o=n.clone().subvec(h.clone().mult(this.Scale(e.m_dColumnHeight))),m=h.clone().mult(this.Scale(e.m_dRowHeight));for(let y=0;y<e.m_allData.length;y++){let x=o.clone();for(let M=0;M<e.m_aryColumn.length;M++){let A=e.m_aryColumn[M];this.DrawLine(x,x.clone().subvec(m),s),this.DrawMCText(x.clone().addvec(u.clone().mult(this.Scale(A.w*.5))).subvec(m.clone().mult(.5)),e.m_allData[y][M],this.Scale(e.m_dRowTextHeight)),x.addvec(u.clone().mult(this.Scale(A.w)))}this.DrawLine(x,x.clone().subvec(m),s),this.DrawLine(o,o.clone().addvec(u.clone().mult(r)),s),this.DrawLine(o.clone().subvec(m),o.clone().addvec(u.clone().mult(r)).subvec(m),s),o.subvec(m)}return!0}DrawLine(e,n,r){this.mxcad.drawLineWidth=r,this.mxcad.drawColorIndex=p.ColorIndexType.kMagenta,this.mxcad.drawLine(e.x,e.y,n.x,n.y)}DrawMCText(e,n,r){this.mxcad.drawColorIndex=0,this.mxcad.drawColor=new p.McCmColor(0,255,0),this.mxcad.drawText(e.x,e.y,n,r,0,p.McDb.TextHorzMode.kTextMid,p.McDb.TextVertMode.kTextVertMid)}Scale(e){return e*this.dScale}}var II=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Nw(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Uw={exports:{}};(function(t,e){var n=function(){var r=function(V,W){var K=236,Z=17,tt=V,at=u[W],st=null,nt=0,ct=null,xt=[],vt={},Zt=function(_t,wt){nt=tt*4+17,st=function(Ct){for(var Mt=new Array(Ct),jt=0;jt<Ct;jt+=1){Mt[jt]=new Array(Ct);for(var ee=0;ee<Ct;ee+=1)Mt[jt][ee]=null}return Mt}(nt),ce(0,0),ce(nt-7,0),ce(0,nt-7),de(),fe(),Lt(_t,wt),tt>=7&&Le(_t),ct==null&&(ct=Wt(tt,at,xt)),bt(ct,wt)},ce=function(_t,wt){for(var Ct=-1;Ct<=7;Ct+=1)if(!(_t+Ct<=-1||nt<=_t+Ct))for(var Mt=-1;Mt<=7;Mt+=1)wt+Mt<=-1||nt<=wt+Mt||(0<=Ct&&Ct<=6&&(Mt==0||Mt==6)||0<=Mt&&Mt<=6&&(Ct==0||Ct==6)||2<=Ct&&Ct<=4&&2<=Mt&&Mt<=4?st[_t+Ct][wt+Mt]=!0:st[_t+Ct][wt+Mt]=!1)},le=function(){for(var _t=0,wt=0,Ct=0;Ct<8;Ct+=1){Zt(!0,Ct);var Mt=o.getLostPoint(vt);(Ct==0||_t>Mt)&&(_t=Mt,wt=Ct)}return wt},fe=function(){for(var _t=8;_t<nt-8;_t+=1)st[_t][6]==null&&(st[_t][6]=_t%2==0);for(var wt=8;wt<nt-8;wt+=1)st[6][wt]==null&&(st[6][wt]=wt%2==0)},de=function(){for(var _t=o.getPatternPosition(tt),wt=0;wt<_t.length;wt+=1)for(var Ct=0;Ct<_t.length;Ct+=1){var Mt=_t[wt],jt=_t[Ct];if(st[Mt][jt]==null)for(var ee=-2;ee<=2;ee+=1)for(var pe=-2;pe<=2;pe+=1)ee==-2||ee==2||pe==-2||pe==2||ee==0&&pe==0?st[Mt+ee][jt+pe]=!0:st[Mt+ee][jt+pe]=!1}},Le=function(_t){for(var wt=o.getBCHTypeNumber(tt),Ct=0;Ct<18;Ct+=1){var Mt=!_t&&(wt>>Ct&1)==1;st[Math.floor(Ct/3)][Ct%3+nt-8-3]=Mt}for(var Ct=0;Ct<18;Ct+=1){var Mt=!_t&&(wt>>Ct&1)==1;st[Ct%3+nt-8-3][Math.floor(Ct/3)]=Mt}},Lt=function(_t,wt){for(var Ct=at<<3|wt,Mt=o.getBCHTypeInfo(Ct),jt=0;jt<15;jt+=1){var ee=!_t&&(Mt>>jt&1)==1;jt<6?st[jt][8]=ee:jt<8?st[jt+1][8]=ee:st[nt-15+jt][8]=ee}for(var jt=0;jt<15;jt+=1){var ee=!_t&&(Mt>>jt&1)==1;jt<8?st[8][nt-jt-1]=ee:jt<9?st[8][15-jt-1+1]=ee:st[8][15-jt-1]=ee}st[nt-8][8]=!_t},bt=function(_t,wt){for(var Ct=-1,Mt=nt-1,jt=7,ee=0,pe=o.getMaskFunction(wt),Te=nt-1;Te>0;Te-=2)for(Te==6&&(Te-=1);;){for(var We=0;We<2;We+=1)if(st[Mt][Te-We]==null){var yt=!1;ee<_t.length&&(yt=(_t[ee]>>>jt&1)==1);var St=pe(Mt,Te-We);St&&(yt=!yt),st[Mt][Te-We]=yt,jt-=1,jt==-1&&(ee+=1,jt=7)}if(Mt+=Ct,Mt<0||nt<=Mt){Mt-=Ct,Ct=-Ct;break}}},qt=function(_t,wt){for(var Ct=0,Mt=0,jt=0,ee=new Array(wt.length),pe=new Array(wt.length),Te=0;Te<wt.length;Te+=1){var We=wt[Te].dataCount,yt=wt[Te].totalCount-We;Mt=Math.max(Mt,We),jt=Math.max(jt,yt),ee[Te]=new Array(We);for(var St=0;St<ee[Te].length;St+=1)ee[Te][St]=255&_t.getBuffer()[St+Ct];Ct+=We;var Ee=o.getErrorCorrectPolynomial(yt),be=y(ee[Te],Ee.getLength()-1),En=be.mod(Ee);pe[Te]=new Array(Ee.getLength()-1);for(var St=0;St<pe[Te].length;St+=1){var mn=St+En.getLength()-pe[Te].length;pe[Te][St]=mn>=0?En.getAt(mn):0}}for(var an=0,St=0;St<wt.length;St+=1)an+=wt[St].totalCount;for(var yn=new Array(an),Tn=0,St=0;St<Mt;St+=1)for(var Te=0;Te<wt.length;Te+=1)St<ee[Te].length&&(yn[Tn]=ee[Te][St],Tn+=1);for(var St=0;St<jt;St+=1)for(var Te=0;Te<wt.length;Te+=1)St<pe[Te].length&&(yn[Tn]=pe[Te][St],Tn+=1);return yn},Wt=function(_t,wt,Ct){for(var Mt=x.getRSBlocks(_t,wt),jt=M(),ee=0;ee<Ct.length;ee+=1){var pe=Ct[ee];jt.put(pe.getMode(),4),jt.put(pe.getLength(),o.getLengthInBits(pe.getMode(),_t)),pe.write(jt)}for(var Te=0,ee=0;ee<Mt.length;ee+=1)Te+=Mt[ee].dataCount;if(jt.getLengthInBits()>Te*8)throw"code length overflow. ("+jt.getLengthInBits()+">"+Te*8+")";for(jt.getLengthInBits()+4<=Te*8&&jt.put(0,4);jt.getLengthInBits()%8!=0;)jt.putBit(!1);for(;!(jt.getLengthInBits()>=Te*8||(jt.put(K,8),jt.getLengthInBits()>=Te*8));)jt.put(Z,8);return qt(jt,Mt)};vt.addData=function(_t,wt){wt=wt||"Byte";var Ct=null;switch(wt){case"Numeric":Ct=A(_t);break;case"Alphanumeric":Ct=T(_t);break;case"Byte":Ct=P(_t);break;case"Kanji":Ct=D(_t);break;default:throw"mode:"+wt}xt.push(Ct),ct=null},vt.isDark=function(_t,wt){if(_t<0||nt<=_t||wt<0||nt<=wt)throw _t+","+wt;return st[_t][wt]},vt.getModuleCount=function(){return nt},vt.make=function(){if(tt<1){for(var _t=1;_t<40;_t++){for(var wt=x.getRSBlocks(_t,at),Ct=M(),Mt=0;Mt<xt.length;Mt++){var jt=xt[Mt];Ct.put(jt.getMode(),4),Ct.put(jt.getLength(),o.getLengthInBits(jt.getMode(),_t)),jt.write(Ct)}for(var ee=0,Mt=0;Mt<wt.length;Mt++)ee+=wt[Mt].dataCount;if(Ct.getLengthInBits()<=ee*8)break}tt=_t}Zt(!1,le())},vt.createTableTag=function(_t,wt){_t=_t||2,wt=typeof wt=="undefined"?_t*4:wt;var Ct="";Ct+='<table style="',Ct+=" border-width: 0px; border-style: none;",Ct+=" border-collapse: collapse;",Ct+=" padding: 0px; margin: "+wt+"px;",Ct+='">',Ct+="<tbody>";for(var Mt=0;Mt<vt.getModuleCount();Mt+=1){Ct+="<tr>";for(var jt=0;jt<vt.getModuleCount();jt+=1)Ct+='<td style="',Ct+=" border-width: 0px; border-style: none;",Ct+=" border-collapse: collapse;",Ct+=" padding: 0px; margin: 0px;",Ct+=" width: "+_t+"px;",Ct+=" height: "+_t+"px;",Ct+=" background-color: ",Ct+=vt.isDark(Mt,jt)?"#000000":"#ffffff",Ct+=";",Ct+='"/>';Ct+="</tr>"}return Ct+="</tbody>",Ct+="</table>",Ct},vt.createSvgTag=function(_t,wt,Ct,Mt){var jt={};typeof arguments[0]=="object"&&(jt=arguments[0],_t=jt.cellSize,wt=jt.margin,Ct=jt.alt,Mt=jt.title),_t=_t||2,wt=typeof wt=="undefined"?_t*4:wt,Ct=typeof Ct=="string"?{text:Ct}:Ct||{},Ct.text=Ct.text||null,Ct.id=Ct.text?Ct.id||"qrcode-description":null,Mt=typeof Mt=="string"?{text:Mt}:Mt||{},Mt.text=Mt.text||null,Mt.id=Mt.text?Mt.id||"qrcode-title":null;var ee=vt.getModuleCount()*_t+wt*2,pe,Te,We,yt,St="",Ee;for(Ee="l"+_t+",0 0,"+_t+" -"+_t+",0 0,-"+_t+"z ",St+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',St+=jt.scalable?"":' width="'+ee+'px" height="'+ee+'px"',St+=' viewBox="0 0 '+ee+" "+ee+'" ',St+=' preserveAspectRatio="xMinYMin meet"',St+=Mt.text||Ct.text?' role="img" aria-labelledby="'+Nt([Mt.id,Ct.id].join(" ").trim())+'"':"",St+=">",St+=Mt.text?'<title id="'+Nt(Mt.id)+'">'+Nt(Mt.text)+"</title>":"",St+=Ct.text?'<description id="'+Nt(Ct.id)+'">'+Nt(Ct.text)+"</description>":"",St+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',St+='<path d="',We=0;We<vt.getModuleCount();We+=1)for(yt=We*_t+wt,pe=0;pe<vt.getModuleCount();pe+=1)vt.isDark(We,pe)&&(Te=pe*_t+wt,St+="M"+Te+","+yt+Ee);return St+='" stroke="transparent" fill="black"/>',St+="</svg>",St},vt.createDataURL=function(_t,wt){_t=_t||2,wt=typeof wt=="undefined"?_t*4:wt;var Ct=vt.getModuleCount()*_t+wt*2,Mt=wt,jt=Ct-wt;return H(Ct,Ct,function(ee,pe){if(Mt<=ee&&ee<jt&&Mt<=pe&&pe<jt){var Te=Math.floor((ee-Mt)/_t),We=Math.floor((pe-Mt)/_t);return vt.isDark(We,Te)?0:1}else return 1})},vt.createImgTag=function(_t,wt,Ct){_t=_t||2,wt=typeof wt=="undefined"?_t*4:wt;var Mt=vt.getModuleCount()*_t+wt*2,jt="";return jt+="<img",jt+=' src="',jt+=vt.createDataURL(_t,wt),jt+='"',jt+=' width="',jt+=Mt,jt+='"',jt+=' height="',jt+=Mt,jt+='"',Ct&&(jt+=' alt="',jt+=Nt(Ct),jt+='"'),jt+="/>",jt};var Nt=function(_t){for(var wt="",Ct=0;Ct<_t.length;Ct+=1){var Mt=_t.charAt(Ct);switch(Mt){case"<":wt+="&lt;";break;case">":wt+="&gt;";break;case"&":wt+="&amp;";break;case'"':wt+="&quot;";break;default:wt+=Mt;break}}return wt},se=function(_t){var wt=1;_t=typeof _t=="undefined"?wt*2:_t;var Ct=vt.getModuleCount()*wt+_t*2,Mt=_t,jt=Ct-_t,ee,pe,Te,We,yt,St={"██":"█","█ ":"▀"," █":"▄","  ":" "},Ee={"██":"▀","█ ":"▀"," █":" ","  ":" "},be="";for(ee=0;ee<Ct;ee+=2){for(Te=Math.floor((ee-Mt)/wt),We=Math.floor((ee+1-Mt)/wt),pe=0;pe<Ct;pe+=1)yt="█",Mt<=pe&&pe<jt&&Mt<=ee&&ee<jt&&vt.isDark(Te,Math.floor((pe-Mt)/wt))&&(yt=" "),Mt<=pe&&pe<jt&&Mt<=ee+1&&ee+1<jt&&vt.isDark(We,Math.floor((pe-Mt)/wt))?yt+=" ":yt+="█",be+=_t<1&&ee+1>=jt?Ee[yt]:St[yt];be+=`
`}return Ct%2&&_t>0?be.substring(0,be.length-Ct-1)+Array(Ct+1).join("▀"):be.substring(0,be.length-1)};return vt.createASCII=function(_t,wt){if(_t=_t||1,_t<2)return se(wt);_t-=1,wt=typeof wt=="undefined"?_t*2:wt;var Ct=vt.getModuleCount()*_t+wt*2,Mt=wt,jt=Ct-wt,ee,pe,Te,We,yt=Array(_t+1).join("██"),St=Array(_t+1).join("  "),Ee="",be="";for(ee=0;ee<Ct;ee+=1){for(Te=Math.floor((ee-Mt)/_t),be="",pe=0;pe<Ct;pe+=1)We=1,Mt<=pe&&pe<jt&&Mt<=ee&&ee<jt&&vt.isDark(Te,Math.floor((pe-Mt)/_t))&&(We=0),be+=We?yt:St;for(Te=0;Te<_t;Te+=1)Ee+=be+`
`}return Ee.substring(0,Ee.length-1)},vt.renderTo2dContext=function(_t,wt){wt=wt||2;for(var Ct=vt.getModuleCount(),Mt=0;Mt<Ct;Mt++)for(var jt=0;jt<Ct;jt++)_t.fillStyle=vt.isDark(Mt,jt)?"black":"white",_t.fillRect(Mt*wt,jt*wt,wt,wt)},vt};r.stringToBytesFuncs={default:function(V){for(var W=[],K=0;K<V.length;K+=1){var Z=V.charCodeAt(K);W.push(Z&255)}return W}},r.stringToBytes=r.stringToBytesFuncs.default,r.createStringToBytes=function(V,W){var K=function(){for(var tt=O(V),at=function(){var fe=tt.read();if(fe==-1)throw"eof";return fe},st=0,nt={};;){var ct=tt.read();if(ct==-1)break;var xt=at(),vt=at(),Zt=at(),ce=String.fromCharCode(ct<<8|xt),le=vt<<8|Zt;nt[ce]=le,st+=1}if(st!=W)throw st+" != "+W;return nt}(),Z="?".charCodeAt(0);return function(tt){for(var at=[],st=0;st<tt.length;st+=1){var nt=tt.charCodeAt(st);if(nt<128)at.push(nt);else{var ct=K[tt.charAt(st)];typeof ct=="number"?(ct&255)==ct?at.push(ct):(at.push(ct>>>8),at.push(ct&255)):at.push(Z)}}return at}};var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},u={L:1,M:0,Q:3,H:2},h={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},o=function(){var V=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],W=1335,K=7973,Z=21522,tt={},at=function(st){for(var nt=0;st!=0;)nt+=1,st>>>=1;return nt};return tt.getBCHTypeInfo=function(st){for(var nt=st<<10;at(nt)-at(W)>=0;)nt^=W<<at(nt)-at(W);return(st<<10|nt)^Z},tt.getBCHTypeNumber=function(st){for(var nt=st<<12;at(nt)-at(K)>=0;)nt^=K<<at(nt)-at(K);return st<<12|nt},tt.getPatternPosition=function(st){return V[st-1]},tt.getMaskFunction=function(st){switch(st){case h.PATTERN000:return function(nt,ct){return(nt+ct)%2==0};case h.PATTERN001:return function(nt,ct){return nt%2==0};case h.PATTERN010:return function(nt,ct){return ct%3==0};case h.PATTERN011:return function(nt,ct){return(nt+ct)%3==0};case h.PATTERN100:return function(nt,ct){return(Math.floor(nt/2)+Math.floor(ct/3))%2==0};case h.PATTERN101:return function(nt,ct){return nt*ct%2+nt*ct%3==0};case h.PATTERN110:return function(nt,ct){return(nt*ct%2+nt*ct%3)%2==0};case h.PATTERN111:return function(nt,ct){return(nt*ct%3+(nt+ct)%2)%2==0};default:throw"bad maskPattern:"+st}},tt.getErrorCorrectPolynomial=function(st){for(var nt=y([1],0),ct=0;ct<st;ct+=1)nt=nt.multiply(y([1,m.gexp(ct)],0));return nt},tt.getLengthInBits=function(st,nt){if(1<=nt&&nt<10)switch(st){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:return 8;case s.MODE_KANJI:return 8;default:throw"mode:"+st}else if(nt<27)switch(st){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw"mode:"+st}else if(nt<41)switch(st){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw"mode:"+st}else throw"type:"+nt},tt.getLostPoint=function(st){for(var nt=st.getModuleCount(),ct=0,xt=0;xt<nt;xt+=1)for(var vt=0;vt<nt;vt+=1){for(var Zt=0,ce=st.isDark(xt,vt),le=-1;le<=1;le+=1)if(!(xt+le<0||nt<=xt+le))for(var fe=-1;fe<=1;fe+=1)vt+fe<0||nt<=vt+fe||le==0&&fe==0||ce==st.isDark(xt+le,vt+fe)&&(Zt+=1);Zt>5&&(ct+=3+Zt-5)}for(var xt=0;xt<nt-1;xt+=1)for(var vt=0;vt<nt-1;vt+=1){var de=0;st.isDark(xt,vt)&&(de+=1),st.isDark(xt+1,vt)&&(de+=1),st.isDark(xt,vt+1)&&(de+=1),st.isDark(xt+1,vt+1)&&(de+=1),(de==0||de==4)&&(ct+=3)}for(var xt=0;xt<nt;xt+=1)for(var vt=0;vt<nt-6;vt+=1)st.isDark(xt,vt)&&!st.isDark(xt,vt+1)&&st.isDark(xt,vt+2)&&st.isDark(xt,vt+3)&&st.isDark(xt,vt+4)&&!st.isDark(xt,vt+5)&&st.isDark(xt,vt+6)&&(ct+=40);for(var vt=0;vt<nt;vt+=1)for(var xt=0;xt<nt-6;xt+=1)st.isDark(xt,vt)&&!st.isDark(xt+1,vt)&&st.isDark(xt+2,vt)&&st.isDark(xt+3,vt)&&st.isDark(xt+4,vt)&&!st.isDark(xt+5,vt)&&st.isDark(xt+6,vt)&&(ct+=40);for(var Le=0,vt=0;vt<nt;vt+=1)for(var xt=0;xt<nt;xt+=1)st.isDark(xt,vt)&&(Le+=1);var Lt=Math.abs(100*Le/nt/nt-50)/5;return ct+=Lt*10,ct},tt}(),m=function(){for(var V=new Array(256),W=new Array(256),K=0;K<8;K+=1)V[K]=1<<K;for(var K=8;K<256;K+=1)V[K]=V[K-4]^V[K-5]^V[K-6]^V[K-8];for(var K=0;K<255;K+=1)W[V[K]]=K;var Z={};return Z.glog=function(tt){if(tt<1)throw"glog("+tt+")";return W[tt]},Z.gexp=function(tt){for(;tt<0;)tt+=255;for(;tt>=256;)tt-=255;return V[tt]},Z}();function y(V,W){if(typeof V.length=="undefined")throw V.length+"/"+W;var K=function(){for(var tt=0;tt<V.length&&V[tt]==0;)tt+=1;for(var at=new Array(V.length-tt+W),st=0;st<V.length-tt;st+=1)at[st]=V[st+tt];return at}(),Z={};return Z.getAt=function(tt){return K[tt]},Z.getLength=function(){return K.length},Z.multiply=function(tt){for(var at=new Array(Z.getLength()+tt.getLength()-1),st=0;st<Z.getLength();st+=1)for(var nt=0;nt<tt.getLength();nt+=1)at[st+nt]^=m.gexp(m.glog(Z.getAt(st))+m.glog(tt.getAt(nt)));return y(at,0)},Z.mod=function(tt){if(Z.getLength()-tt.getLength()<0)return Z;for(var at=m.glog(Z.getAt(0))-m.glog(tt.getAt(0)),st=new Array(Z.getLength()),nt=0;nt<Z.getLength();nt+=1)st[nt]=Z.getAt(nt);for(var nt=0;nt<tt.getLength();nt+=1)st[nt]^=m.gexp(m.glog(tt.getAt(nt))+at);return y(st,0).mod(tt)},Z}var x=function(){var V=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],W=function(tt,at){var st={};return st.totalCount=tt,st.dataCount=at,st},K={},Z=function(tt,at){switch(at){case u.L:return V[(tt-1)*4+0];case u.M:return V[(tt-1)*4+1];case u.Q:return V[(tt-1)*4+2];case u.H:return V[(tt-1)*4+3];default:return}};return K.getRSBlocks=function(tt,at){var st=Z(tt,at);if(typeof st=="undefined")throw"bad rs block @ typeNumber:"+tt+"/errorCorrectionLevel:"+at;for(var nt=st.length/3,ct=[],xt=0;xt<nt;xt+=1)for(var vt=st[xt*3+0],Zt=st[xt*3+1],ce=st[xt*3+2],le=0;le<vt;le+=1)ct.push(W(Zt,ce));return ct},K}(),M=function(){var V=[],W=0,K={};return K.getBuffer=function(){return V},K.getAt=function(Z){var tt=Math.floor(Z/8);return(V[tt]>>>7-Z%8&1)==1},K.put=function(Z,tt){for(var at=0;at<tt;at+=1)K.putBit((Z>>>tt-at-1&1)==1)},K.getLengthInBits=function(){return W},K.putBit=function(Z){var tt=Math.floor(W/8);V.length<=tt&&V.push(0),Z&&(V[tt]|=128>>>W%8),W+=1},K},A=function(V){var W=s.MODE_NUMBER,K=V,Z={};Z.getMode=function(){return W},Z.getLength=function(st){return K.length},Z.write=function(st){for(var nt=K,ct=0;ct+2<nt.length;)st.put(tt(nt.substring(ct,ct+3)),10),ct+=3;ct<nt.length&&(nt.length-ct==1?st.put(tt(nt.substring(ct,ct+1)),4):nt.length-ct==2&&st.put(tt(nt.substring(ct,ct+2)),7))};var tt=function(st){for(var nt=0,ct=0;ct<st.length;ct+=1)nt=nt*10+at(st.charAt(ct));return nt},at=function(st){if("0"<=st&&st<="9")return st.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+st};return Z},T=function(V){var W=s.MODE_ALPHA_NUM,K=V,Z={};Z.getMode=function(){return W},Z.getLength=function(at){return K.length},Z.write=function(at){for(var st=K,nt=0;nt+1<st.length;)at.put(tt(st.charAt(nt))*45+tt(st.charAt(nt+1)),11),nt+=2;nt<st.length&&at.put(tt(st.charAt(nt)),6)};var tt=function(at){if("0"<=at&&at<="9")return at.charCodeAt(0)-"0".charCodeAt(0);if("A"<=at&&at<="Z")return at.charCodeAt(0)-"A".charCodeAt(0)+10;switch(at){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+at}};return Z},P=function(V){var W=s.MODE_8BIT_BYTE,K=r.stringToBytes(V),Z={};return Z.getMode=function(){return W},Z.getLength=function(tt){return K.length},Z.write=function(tt){for(var at=0;at<K.length;at+=1)tt.put(K[at],8)},Z},D=function(V){var W=s.MODE_KANJI,K=r.stringToBytesFuncs.SJIS;if(!K)throw"sjis not supported.";(function(at,st){var nt=K(at);if(nt.length!=2||(nt[0]<<8|nt[1])!=st)throw"sjis not supported."})("友",38726);var Z=K(V),tt={};return tt.getMode=function(){return W},tt.getLength=function(at){return~~(Z.length/2)},tt.write=function(at){for(var st=Z,nt=0;nt+1<st.length;){var ct=(255&st[nt])<<8|255&st[nt+1];if(33088<=ct&&ct<=40956)ct-=33088;else if(57408<=ct&&ct<=60351)ct-=49472;else throw"illegal char at "+(nt+1)+"/"+ct;ct=(ct>>>8&255)*192+(ct&255),at.put(ct,13),nt+=2}if(nt<st.length)throw"illegal char at "+(nt+1)},tt},k=function(){var V=[],W={};return W.writeByte=function(K){V.push(K&255)},W.writeShort=function(K){W.writeByte(K),W.writeByte(K>>>8)},W.writeBytes=function(K,Z,tt){Z=Z||0,tt=tt||K.length;for(var at=0;at<tt;at+=1)W.writeByte(K[at+Z])},W.writeString=function(K){for(var Z=0;Z<K.length;Z+=1)W.writeByte(K.charCodeAt(Z))},W.toByteArray=function(){return V},W.toString=function(){var K="";K+="[";for(var Z=0;Z<V.length;Z+=1)Z>0&&(K+=","),K+=V[Z];return K+="]",K},W},z=function(){var V=0,W=0,K=0,Z="",tt={},at=function(nt){Z+=String.fromCharCode(st(nt&63))},st=function(nt){if(!(nt<0)){if(nt<26)return 65+nt;if(nt<52)return 97+(nt-26);if(nt<62)return 48+(nt-52);if(nt==62)return 43;if(nt==63)return 47}throw"n:"+nt};return tt.writeByte=function(nt){for(V=V<<8|nt&255,W+=8,K+=1;W>=6;)at(V>>>W-6),W-=6},tt.flush=function(){if(W>0&&(at(V<<6-W),V=0,W=0),K%3!=0)for(var nt=3-K%3,ct=0;ct<nt;ct+=1)Z+="="},tt.toString=function(){return Z},tt},O=function(V){var W=V,K=0,Z=0,tt=0,at={};at.read=function(){for(;tt<8;){if(K>=W.length){if(tt==0)return-1;throw"unexpected end of file./"+tt}var nt=W.charAt(K);if(K+=1,nt=="=")return tt=0,-1;if(nt.match(/^\s$/))continue;Z=Z<<6|st(nt.charCodeAt(0)),tt+=6}var ct=Z>>>tt-8&255;return tt-=8,ct};var st=function(nt){if(65<=nt&&nt<=90)return nt-65;if(97<=nt&&nt<=122)return nt-97+26;if(48<=nt&&nt<=57)return nt-48+52;if(nt==43)return 62;if(nt==47)return 63;throw"c:"+nt};return at},U=function(V,W){var K=V,Z=W,tt=new Array(V*W),at={};at.setPixel=function(xt,vt,Zt){tt[vt*K+xt]=Zt},at.write=function(xt){xt.writeString("GIF87a"),xt.writeShort(K),xt.writeShort(Z),xt.writeByte(128),xt.writeByte(0),xt.writeByte(0),xt.writeByte(0),xt.writeByte(0),xt.writeByte(0),xt.writeByte(255),xt.writeByte(255),xt.writeByte(255),xt.writeString(","),xt.writeShort(0),xt.writeShort(0),xt.writeShort(K),xt.writeShort(Z),xt.writeByte(0);var vt=2,Zt=nt(vt);xt.writeByte(vt);for(var ce=0;Zt.length-ce>255;)xt.writeByte(255),xt.writeBytes(Zt,ce,255),ce+=255;xt.writeByte(Zt.length-ce),xt.writeBytes(Zt,ce,Zt.length-ce),xt.writeByte(0),xt.writeString(";")};var st=function(xt){var vt=xt,Zt=0,ce=0,le={};return le.write=function(fe,de){if(fe>>>de)throw"length over";for(;Zt+de>=8;)vt.writeByte(255&(fe<<Zt|ce)),de-=8-Zt,fe>>>=8-Zt,ce=0,Zt=0;ce=fe<<Zt|ce,Zt=Zt+de},le.flush=function(){Zt>0&&vt.writeByte(ce)},le},nt=function(xt){for(var vt=1<<xt,Zt=(1<<xt)+1,ce=xt+1,le=ct(),fe=0;fe<vt;fe+=1)le.add(String.fromCharCode(fe));le.add(String.fromCharCode(vt)),le.add(String.fromCharCode(Zt));var de=k(),Le=st(de);Le.write(vt,ce);var Lt=0,bt=String.fromCharCode(tt[Lt]);for(Lt+=1;Lt<tt.length;){var qt=String.fromCharCode(tt[Lt]);Lt+=1,le.contains(bt+qt)?bt=bt+qt:(Le.write(le.indexOf(bt),ce),le.size()<4095&&(le.size()==1<<ce&&(ce+=1),le.add(bt+qt)),bt=qt)}return Le.write(le.indexOf(bt),ce),Le.write(Zt,ce),Le.flush(),de.toByteArray()},ct=function(){var xt={},vt=0,Zt={};return Zt.add=function(ce){if(Zt.contains(ce))throw"dup key:"+ce;xt[ce]=vt,vt+=1},Zt.size=function(){return vt},Zt.indexOf=function(ce){return xt[ce]},Zt.contains=function(ce){return typeof xt[ce]!="undefined"},Zt};return at},H=function(V,W,K){for(var Z=U(V,W),tt=0;tt<W;tt+=1)for(var at=0;at<V;at+=1)Z.setPixel(at,tt,K(at,tt));var st=k();Z.write(st);for(var nt=z(),ct=st.toByteArray(),xt=0;xt<ct.length;xt+=1)nt.writeByte(ct[xt]);return nt.flush(),"data:image/gif;base64,"+nt};return r}();(function(){n.stringToBytesFuncs["UTF-8"]=function(r){function s(u){for(var h=[],o=0;o<u.length;o++){var m=u.charCodeAt(o);m<128?h.push(m):m<2048?h.push(192|m>>6,128|m&63):m<55296||m>=57344?h.push(224|m>>12,128|m>>6&63,128|m&63):(o++,m=65536+((m&1023)<<10|u.charCodeAt(o)&1023),h.push(240|m>>18,128|m>>12&63,128|m>>6&63,128|m&63))}return h}return s(r)}})(),function(r){t.exports=r()}(function(){return n})})(Uw);var kI=Uw.exports;const BI=Nw(kI);function FI(t){let e={};if(e.ObjectName=t.objectName,e.id=t.getObjectID().id,e.handle=t.getHandle(),e.layer=t.layer,e.color=t.trueColor.getColorString(),e.colorVal=t.trueColor.getColorValue(t.layerId),e.linetype=t.linetype,e.textStyle=t.textStyle,e.type=t.objectName,e.dxf0=t.dxf0,t instanceof p.McDbText){let n=t;e.position=Jr(n.position),e.textString=n.textString}else if(t instanceof p.McDbMText){let n=t;e.contents=n.contents,e.location=Jr(n.location)}else if(t instanceof p.McDbLine){let n=t;e.startPoint=Jr(n.startPoint),e.endPoint=Jr(n.endPoint)}else if(t instanceof p.McDbCircle){let n=t;e.center=Jr(n.center),e.radius=n.radius}else if(t instanceof p.McDbArc){let n=t;e.center=Jr(n.center),e.startAngle=n.startAngle,e.endAngle=n.endAngle}else if(t instanceof p.McDbPolyline){let n=t,r=n.numVerts();e.num=r;for(let s=0;s<r;s++){let u=n.getPointAt(s),h=n.getBulgeAt(s);e["pt"+s]=Jr(u.val),e["bulge"+s]=h}}else if(t instanceof p.McDbBlockReference){let n=t;e.position=Jr(n.position),e.blockTransform=n.blockTransform,e.blockName=n.blockName}else if(t instanceof p.McDbAlignedDimension){let n=t;e.xLine1Point=Jr(n.xLine1Point),e.xLine2Point=Jr(n.xLine2Point),n.GetAllText().forEach((s,u)=>{e["txt:"+u]=s})}else if(t instanceof p.McDbRotatedDimension){let n=t;e.xLine1Point=Jr(n.xLine1Point),e.xLine2Point=Jr(n.xLine2Point),n.GetAllText().forEach((s,u)=>{e["txt:"+u]=s})}else if(t instanceof p.McDbDimension)t.GetAllText().forEach((s,u)=>{e["txt:"+u]=s});else if(t instanceof p.McDbHatch){let n=t;e.patternType=n.patternType(),e.patternName=n.patternName(),e.patternAngle=n.patternAngle,e.patternScale=n.patternScale,e.patternSpace=n.patternSpace,e.patternDouble=n.patternDouble,e.hatchStyle=n.hatchStyle(),e.isSolid=n.isSolid(),e.numLoops=n.numLoops;for(let r=0;r<e.numLoops;r++){let s=n.getLoopAt(r);s.vertices.forEach((u,h)=>{s["pt:"+h]={},s["pt:"+h].x=u.x,s["pt:"+h].y=u.y,s["pt:"+h].z=u.z}),e["loop:"+r]=s}e.numPatternDefinitions=n.numPatternDefinitions;for(let r=0;r<e.numPatternDefinitions;r++)e["patternDefinitions:"+r]=n.getPatternDefinitionAt(r)}else if(t instanceof p.McDbRasterImage){let n=t,r=n.getOrientation();e.orientation={},e.orientation.origin=r.origin.toVector3(),e.orientation.uCorner=r.uCorner.toVector3(),e.orientation.vOnPlane=r.vOnPlane.toVector3();let s=n.clipBoundary();e.clipBoundary={},s.forEach((h,o)=>{e.clipBoundary["pt"+o]=h.toVector3()}),e.clipBoundaryType=n.clipBoundaryType();let u=n.imageDefId().getMcDbRasterImageDef();u&&(e.filePath=u.sourceFileName)}return e}function zI(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;t.allSelect(),t.forEach(e=>{let n=e.getMcDbEntity();n&&(n=FI(n),console.log(JSON.stringify(n)))})})}function NI(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet,e=new p.MxCADResbuf;e.AddString("0",8),t.allSelect(e),t.forEach(n=>{let r=n.getMcDbEntity();if(r&&r instanceof p.McDbHatch){let s={},u=r;s.patternType=u.patternType(),s.patternName=u.patternName(),s.patternAngle=u.patternAngle,s.patternScale=u.patternScale,s.patternSpace=u.patternSpace,s.patternDouble=u.patternDouble,s.hatchStyle=u.hatchStyle(),s.isSolid=u.isSolid(),s.numLoops=u.numLoops;for(let h=0;h<s.numLoops;h++){let o=u.getLoopAt(h);o.vertices.forEach((m,y)=>{o["pt:"+y]={},o["pt:"+y].x=m.x,o["pt:"+y].y=m.y,o["pt:"+y].z=m.z}),s["loop:"+h]=o}s.numPatternDefinitions=u.numPatternDefinitions;for(let h=0;h<s.numPatternDefinitions;h++)s["patternDefinitions:"+h]=u.getPatternDefinitionAt(h);console.log(s)}})})}function UI(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=t.getDatabase(),n={};n.name="GRIDMODE",n.isShow=t.getSysVarLong("GRIDMODE");let r=t.getSysVarPoint("SNAPUNIT");n.xdist=r.x,n.ydist=r.x,console.log(n);let s={};s.name="ORTHOMODE",s.isShow=t.getSysVarLong("ORTHOMODE"),console.log(s);let u={};u.name="AUTOSNAP",u.enable=(t.getSysVarLong("AUTOSNAP")&8)!=0,u.polarang=t.getSysVarDouble("POLARANG"),console.log(u);let h={};h.name="OSMODE",h.enable=(t.getSysVarLong("OSMODE")&16384)==0,h.value=t.getSysVarLong("OSMODE"),h.End=(t.getSysVarLong("OSMODE")&1)!=0,h.Mid=(t.getSysVarLong("OSMODE")&2)!=0,h.Cen=(t.getSysVarLong("OSMODE")&4)!=0,h.Node=(t.getSysVarLong("OSMODE")&8)!=0,h.Quad=(t.getSysVarLong("OSMODE")&16)!=0,h.Int=(t.getSysVarLong("OSMODE")&32)!=0,h.Ins=(t.getSysVarLong("OSMODE")&64)!=0,h.Perp=(t.getSysVarLong("OSMODE")&128)!=0,h.Tan=(t.getSysVarLong("OSMODE")&256)!=0,h.Near=(t.getSysVarLong("OSMODE")&512)!=0,console.log(h);let o={};o.name="DYNTRACE",o.enable=t.getSysVarLong("DYNTRACE")!=0,console.log(o);let m={};m.name="DYNINPUT",m.enable=t.getSysVarLong("DYNINPUT")!=0,console.log(m);let y={};y.LTSCALE=t.getSysVarDouble("LTSCALE"),y.CELTSCALE=t.getSysVarDouble("CELTSCALE"),y.CELTYPE=t.getSysVarString("CELTYPE"),y.TEXTSTYLE=t.getSysVarString("TEXTSTYLE"),y.CLAYOUTNAME=t.getSysVarString("CLAYOUTNAME"),y.CLAYER=t.getSysVarString("CLAYER"),y.CECOLOR=e.getCurrentlyTrueColor().getColorValue(),y.INSBASE=t.getSysVarPoint("INSBASE"),y.CELWEIGHT=t.getSysVarLong("CELWEIGHT"),y.PDMODE=t.getSysVarLong("PDMODE"),y.PDSIZE=t.getSysVarDouble("PDSIZE"),console.log(y)})}function VI(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("选择对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity();if(n===null)return;n.getxData().forEach((s,u,h)=>{console.log(JSON.stringify({val:s,type:u,dxf:h}))})})}function GI(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("选择对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity();n!==null&&n.setxDataString("DataName","xxxxx")})}function OI(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定第一点:"));let e=yield t.go();if(e)for(t.setMessage(G(" 指定下一个点:"));;){t.setBasePt(e);let n=yield t.go();if(!n)return;let r=new p.McDbLine(e,n);p.MxCpp.getCurrentMxCAD().drawEntity(r),e=n}})}function Vw(){let t=window.location.hostname;return t.substring(0,4)!="http"&&(t=document.location.protocol+"//"+t),t}function jI(){return Gt(this,null,function*(){let t="http://localhost:3000/mxcad/";t.substring(0,16)=="http://localhost"&&(t=Vw()+t.substring(16));let e=t+"tree.mxweb",n=p.MxCpp.App.getCurrentMxCAD(),r=yield n.insertBlock(e,"tree");if(!r.isValid())return;let s=new p.McDbBlockReference;s.blockTableRecordId=r;let u=s.getBoundingBox();if(u.ret){let M=u.maxPt.distanceTo(u.minPt);M>1e-5&&s.setScale(n.getMxDrawObject().screenCoordLong2Doc(100)/M)}let h=new p.MxCADUiPrPoint;h.setMessage(G("指定插入基点")),h.setUserDraw((M,A)=>{s.position=M,A.drawMcDbEntity(s)});let o=yield h.go();if(!o)return;s.position=o;let m=n.drawEntity(s);if(!m.isValid){console.log("insert error");return}s=m.getMcDbEntity(),s.disableDisplay(!0),r.getMcDbBlockTableRecord().getAllEntityId().forEach((M,A)=>{if(!M.isKindOf("McDbAttributeDefinition"))return;let T=M.getMcDbEntity(),P=T.tag,D=T.textString,k=new p.McDbAttribute;k.position=T.position,k.alignmentPoint=T.alignmentPoint,k.height=T.height,k.trueColor=T.trueColor,k.widthFactor=T.widthFactor,D.length>0?k.textString=D:k.textString="test"+A,k.tag=P,k.isInvisible=T.isInvisible,k.transformBy(s.blockTransform),k=s.appendAttribute(k).getMcDbEntity(),k.textStyle=T.textStyle,k.layer=T.layer}),s.disableDisplay(!1)})}function HI(){let n=p.MxCpp.App.getCurrentMxCAD().getDatabase().getLayerTable().getAllRecordId(),r=[];return n.forEach(s=>{let u=s.getMcDbLayerTableRecord();if(u===null)return;console.log(u),console.log("layerRec.color:"+u.color.getColorString()),console.log("layerRec.name:"+u.name);let h={};h.name=u.name,h.color=u.color.getColorString(),r.push(h)}),$.MxFun.postMessageToParentFrame(r),r}function WI(){let e=p.MxCpp.App.getCurrentMxCAD().getDatabase().getLayerTable();if(!e.has("xxx11")){let n=new p.McDbLayerTableRecord;n.name="xxx11",e.add(n)}e.has("xxx11")&&console.log("add layer ok")}function qI(){p.MxCpp.App.getCurrentMxCAD().getDatabase().getLinetypeTable().getAllRecordId().forEach(r=>{let s=r.getMcDbLinetypeTableRecord();s!==null&&console.log(s)})}function YI(){p.MxCpp.getCurrentMxCAD().getDatabase().getTextStyleTable().getAllRecordId().forEach(r=>{let s=r.getMcDbTextStyleTableRecord();if(s===null)return;let u={};u.name=s.name,u.font=s.font(),u.fileName=s.fileName,u.bigFontFileName=s.bigFontFileName,u.textSize=s.textSize,u.xScale=s.xScale,console.log(u)})}function XI(){return Gt(this,null,function*(){let e=p.MxCpp.getCurrentMxCAD().getDatabase().getTextStyleTable(),n="MyTextStyle";e.has(n,!1)&&e.get(n,!1).erase(!1);let r=new p.McDbTextStyleTableRecord;r.fileName="txt.shx",r.bigFontFileName="hztxt.shx",r.textSize=10,r.name=n,r.xScale=.7,e.add(r).isValid()&&console.log("add ok")})}function KI(){p.MxCpp.App.getCurrentMxCAD().getDatabase().getBlockTable().getAllRecordId().forEach(r=>{let s=r.getMcDbBlockTableRecord();s!==null&&(console.log(s),console.log("blkRec.name:"+s.name),console.log("blkRec.origin:"+s.origin))})}function ZI(){return Gt(this,null,function*(){let t=new zw;t.data.addColumn("序号",30),t.data.addColumn("名称",45),t.data.addColumn("材料",60),t.data.addColumn("长度",50);for(let s=0;s<10;s++){let u=""+s;t.data.addRow([u,"AAAA","BBBB","1000"])}let e=new p.MxCADUiPrPoint;e.setMessage(G(" 指定表格插入点:"));let n=yield e.go();if(!n)return;let r=$.MxFun.screenCoordLong2Doc(100)/200;t.draw(n,r)})}function JI(){return Gt(this,null,function*(){const t=new $.MrxDbgUiPrPoint;t.setMessage(G("指定插入点:"));let e=yield t.go();if(!e)return;let n=$.MxFun.getCurrentDraw();const r=BI(5,"L");r.addData("https://www.mxdraw3d.com"),r.make();const s=r.createDataURL(),u=new zd().load(s),h=new gr({map:u});let o=$.MxFun.screenCoordLong2Doc(80),m=$.MxFun.screenCoordLong2Doc(80),y=new $.MxDbImage;y.setRenderOrder($.MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1),y.setPoint1(e);let x=new kt(e.x+o,e.y+m,e.z);y.setPoint2(x),y.setMaterial(h),n.addMxEntity(y),setInterval(()=>{n.updateDisplay()},100)})}function QI(){return Gt(this,null,function*(){let t="http://localhost:3000/mxcad/";t.substring(0,16)=="http://localhost"&&(t=Vw()+t.substring(16));let e=t+"stamp.mxweb",n=p.MxCpp.App.getCurrentMxCAD(),r=yield n.insertBlock(e,"stamp");if(!r.isValid())return;let s=new p.McDbBlockReference;s.blockTableRecordId=r;let u=s.getBoundingBox();if(u.ret){let m=u.maxPt.distanceTo(u.minPt);m>1e-5&&s.setScale(n.getMxDrawObject().screenCoordLong2Doc(100)/m)}let h=new p.MxCADUiPrPoint;h.setMessage(G("指定插入基点")),h.setUserDraw((m,y)=>{s.position=m,y.drawMcDbEntity(s)});let o=yield h.go();o&&(s.position=o,n.drawEntity(s))})}function $I(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=t.database.getLinetypeTable().get("TestMyLine");e.isErase()||e.erase();let n=t.addLinetypeEx("TestMyLine",'.5,-.2,["HW",STANDARD,S=.1,R=0.0,X=-0.1,Y=-.05],-.2',"");if(!n.isValid())return;let u=(yield new p.MxCADUiPrEntity().go()).getMcDbEntity();u&&(u.linetypeId=n)})}function y1(t){t.getAllObjectName().forEach(n=>{console.log(n);let s=t.getAt(n).getMcDbObject();if(s instanceof p.McDbDictionary){let u=s;console.log(u),y1(u)}else s instanceof p.McDbXrecord&&s.getData().PrintData()})}function tk(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("选择标注对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity();if(n&&n.isHaveExtensionDictionary()){let r=n.getExtensionDictionary();y1(r)}})}function ek(){return Gt(this,null,function*(){let e=p.MxCpp.getCurrentMxCAD().getDatabase().getNamedObjectsDictionary();e.getAllObjectName().forEach(r=>{console.log(r);let u=e.getAt(r).getMcDbObject();if(u instanceof p.McDbDictionary){let h=u;console.log(h),y1(h)}})})}function nk(){return Gt(this,null,function*(){let e=p.MxCpp.getCurrentMxCAD().getDatabase().getNamedObjectsDictionary(),n="MyDict",r=e.getAt(n);if(r.isNull()){let u=new p.McDbDictionary;r=e.addObject(n,u)}let s=r.getMcDbDictionary();if(s){let u=new p.McDbXrecord,h=new p.MxCADResbuf;h.AddString("TestData"),u.setData(h),s.addObject("MyRecord",u),console.log("write xrecord ok")}})}function ik(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("选择标注对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity();n&&(n.trueColor=new p.McCmColor(255,0,255))})}let x1;function rk(){return Gt(this,null,function*(){if(x1){let t=x1.getMcDbEntity();if(!t)return;t.visible=!0}else{let t=new p.MxCADUiPrEntity;t.setMessage(G("选择标注对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity();if(!n)return;n.visible=!1,x1=e}})}function ok(){return Gt(this,null,function*(){let t="WALL";p.MxCpp.getCurrentMxCAD().database.layerTable.has(t)||console.log("no have layer:"+t);let n=new p.MxCADUiPrEntity;n.setMessage(G("选择对象"));let r=yield n.go();if(!r.isValid())return;let s=r.getMcDbEntity();s&&(s.layer=t)})}function sk(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;if(!(yield t.userSelect(G("选择对象"))))return;let n=p.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder().maxDrawOrder+1;t.forEach(r=>{let s=r.getMcDbEntity();s&&(s.drawOrder=n)})})}function ak(t){let e=p.MxCpp.getCurrentMxCAD();e.mxdraw.makeCurrent(),e.loadDwgBackground(t,n=>{let r=e.getBackgroundEntity();r.setShow(t,!1);let s=r.getBackgroundDatabase(t);if(s==null)return;let u=new p.MxCompare;if(u.do(s)){let h=u.getResult();h.length>0&&r.setShow(t,!0),console.log(JSON.stringify(h))}},53962434921)}function lk(){ak("test3.mxweb")}let Xd;function ck(){if(Xd)Xd.DoRestore(),Xd=void 0;else{Xd=new p.MxModifyColor;let t=new p.McCmColor;t.setColorIndex(p.ColorIndexType.kWhite),Xd.Do(p.MxCpp.getCurrentDatabase(),t)}}function uk(){$.MxFun.addCommand("TestGetAllEntity",zI),$.MxFun.addCommand("MxTest_GetSysVars",UI),$.MxFun.addCommand("MxTest_ReadxData",VI),$.MxFun.addCommand("MxTest_WritexData",GI),$.MxFun.addCommand("MxTest_DrawLine",OI),$.MxFun.addCommand("MxTest_InsertBlock",jI),$.MxFun.addCommand("MxTest_GetAllLayer",HI),$.MxFun.addCommand("MxTest_AddLayer",WI),$.MxFun.addCommand("MxTest_GetAllTextStyle",YI),$.MxFun.addCommand("MxTest_GetAllBlock",KI),$.MxFun.addCommand("MxTest_GetAllLinetype",qI),$.MxFun.addCommand("Mx_Test_DrawTable",ZI),$.MxFun.addCommand("Mx_Test_QRCode",JI),$.MxFun.addCommand("MxTest_InsertStamp",QI),$.MxFun.addCommand("MxTest_LineTypeTest",$I),$.MxFun.addCommand("TestGentEntityOnLayer",NI),$.MxFun.addCommand("MxTest_GetNamedObjectsDictionary",ek),$.MxFun.addCommand("MxTest_GetObjectExDictionaryData",tk),$.MxFun.addCommand("MxTest_WriteXRecord",nk),$.MxFun.addCommand("MxTest_AddTextStyleTable",XI),$.MxFun.addCommand("Mx_Test_ChangeColor",ik),$.MxFun.addCommand("Mx_Test_ChangeVisible",rk),$.MxFun.addCommand("Mx_Test_ChangeEntityLayer",ok),$.MxFun.addCommand("Mx_ChaneEntityDrawOrder",sk),$.MxFun.addCommand("Mx_MxCompare",lk),$.MxFun.addCommand("MxTest_ModifyAllEntityColor",ck)}function hk(){return Gt(this,null,function*(){let{baseUrl:t="",saveDwgUrl:e="",mxfilepath:n=""}=Ua().getUploadFileConfig();p.MxCpp.getCurrentMxCAD().saveFileToUrl(e,(r,s)=>{try{let u=JSON.parse(s);if(u.ret=="ok"){let h=t+n+u.file;fetch(h).then(o=>Gt(this,null,function*(){const m=yield o.blob();p.MxTools.saveAsFileDialog({blob:m,filename:u.file,types:[{description:"dwg图纸",accept:{"application/octet-stream":[".dwg"]}}]})}))}else console.log(s)}catch(u){console.log("Mx: sserverResult error")}})})}function dk(){return Gt(this,null,function*(){let{baseUrl:t="",mxfilepath:e="",saveUrl:n=""}=Ua().getUploadFileConfig();p.MxCpp.getCurrentMxCAD().saveFileToUrl(n,(r,s)=>{try{let u=JSON.parse(s);if(u.ret=="ok"){let h=t+e+u.file;p.MxTools.downloadFileFromUrl(h,u.file)}else console.log(s)}catch(u){console.log("Mx: sserverResult error")}})})}function pk(){return Gt(this,null,function*(){p.MxCpp.getCurrentMxCAD().openWebFile("http://localhost:1337/mxcad/file/8c79da20e232495888dbb0da17459399.mxweb")})}function fk(){return Gt(this,null,function*(){p.MxCpp.getCurrentMxCAD().newFile()})}function mk(){return Gt(this,null,function*(){let t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定输出范围第一点:"));let e=yield t.go();if(!e)return;t.setMessage(G(" 指定输出范围第二点:")),t.setUserDraw((o,m)=>{m.setColor(16711680);let y=new p.McDbPolyline;y.addVertexAt(e),y.addVertexAt(new p.McGePoint3d(e.x,o.y)),y.addVertexAt(o),y.addVertexAt(new p.McGePoint3d(o.x,e.y)),y.constantWidth=$.MxFun.screenCoordLong2Doc(2),y.isClosed=!0,m.drawMcDbEntity(y);let x=[];x.push(e.toVector3()),x.push(new THREE.Vector3(e.x,o.y)),x.push(o.toVector3()),x.push(new THREE.Vector3(o.x,e.y)),m.setColor(12868),m.drawSolid(x,.5)}),t.setDisableOsnap(!0),t.setDisableOrthoTrace(!0),t.setDynamicInputType($.DynamicInputType.kXYCoordInput);let n=yield t.go();if(!n)return;let{baseUrl:r="",mxfilepath:s="",printPdfUrl:u=""}=Ua().getUploadFileConfig();console.log(Ua().getUploadFileConfig());let h={width:"2100",height:"2970",bd_pt1_x:""+e.x,bd_pt1_y:""+e.y,bd_pt2_x:""+n.x,bd_pt2_y:""+n.y};p.MxCpp.getCurrentMxCAD().saveFileToUrl(u,(o,m)=>{try{let y=JSON.parse(m);if(y.ret=="ok"){let x=r+s+y.file;p.MxTools.downloadFileFromUrl(x,y.file)}else console.log(m)}catch(y){console.log("Mx: sserverResult error")}},void 0,JSON.stringify(h))})}function gk(){return Gt(this,null,function*(){let t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定输出范围第一点:"));let e=yield t.go();if(!e)return;t.setMessage(G(" 指定输出范围第二点:")),t.setUserDraw((o,m)=>{m.setColor(16711680);let y=new p.McDbPolyline;y.addVertexAt(e),y.addVertexAt(new p.McGePoint3d(e.x,o.y)),y.addVertexAt(o),y.addVertexAt(new p.McGePoint3d(o.x,e.y)),y.constantWidth=$.MxFun.screenCoordLong2Doc(2),y.isClosed=!0,m.drawMcDbEntity(y);let x=[];x.push(e.toVector3()),x.push(new THREE.Vector3(e.x,o.y)),x.push(o.toVector3()),x.push(new THREE.Vector3(o.x,e.y)),m.setColor(12868),m.drawSolid(x,.5)}),t.setDisableOsnap(!0),t.setDisableOrthoTrace(!0),t.setDynamicInputType($.DynamicInputType.kXYCoordInput);let n=yield t.go();if(!n)return;let{baseUrl:r="",mxfilepath:s="",cutDwgUrl:u=""}=Ua().getUploadFileConfig();console.log(Ua().getUploadFileConfig());let h={bd_pt1_x:""+e.x,bd_pt1_y:""+e.y,bd_pt2_x:""+n.x,bd_pt2_y:""+n.y};p.MxCpp.getCurrentMxCAD().saveFileToUrl(u,(o,m)=>{try{let y=JSON.parse(m);if(y.ret=="ok"){let x=r+s+y.file;p.MxTools.downloadFileFromUrl(x,y.file)}else console.log(m)}catch(y){console.log("Mx: sserverResult error")}},void 0,JSON.stringify(h))})}function yk(){let t=window.location.hostname;return t.substring(0,4)!="http"&&(t=document.location.protocol+"//"+t),t}function xk(){return window.location.origin+window.location.pathname}function vk(t){window.open(t,"_blank")||console.error("弹窗被浏览器拦截")}function _k(){return Gt(this,null,function*(){let t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定输出范围第一点:"));let e=yield t.go();if(!e)return;t.setMessage(G(" 指定输出范围第二点:")),t.setUserDraw((o,m)=>{m.setColor(16711680);let y=new p.McDbPolyline;y.addVertexAt(e),y.addVertexAt(new p.McGePoint3d(e.x,o.y)),y.addVertexAt(o),y.addVertexAt(new p.McGePoint3d(o.x,e.y)),y.constantWidth=$.MxFun.screenCoordLong2Doc(2),y.isClosed=!0,m.drawMcDbEntity(y);let x=[];x.push(e.toVector3()),x.push(new THREE.Vector3(e.x,o.y)),x.push(o.toVector3()),x.push(new THREE.Vector3(o.x,e.y)),m.setColor(12868),m.drawSolid(x,.5)}),t.setDisableOsnap(!0),t.setDisableOrthoTrace(!0),t.setDynamicInputType($.DynamicInputType.kXYCoordInput);let n=yield t.go();if(!n)return;let r=yk()+":1337/mxcad/cut_mxweb",{baseUrl:s="",mxfilepath:u=""}=Ua().getUploadFileConfig();console.log(Ua().getUploadFileConfig());let h={bd_pt1_x:""+e.x,bd_pt1_y:""+e.y,bd_pt2_x:""+n.x,bd_pt2_y:""+n.y};p.MxCpp.getCurrentMxCAD().saveFileToUrl(r,(o,m)=>{try{let y=JSON.parse(m);if(y.ret=="ok"){let x=s+u+y.file;vk(xk()+"?file="+x)}else console.log(m)}catch(y){console.log("Mx: sserverResult error")}},void 0,JSON.stringify(h))})}function bk(){$.MxFun.addCommand("Mx_Export_DWG_test",hk),$.MxFun.addCommand("Mx_Export_MxWeb",dk),$.MxFun.addCommand("Mx_Open_MxWeb",pk),$.MxFun.addCommand("MxTest_NewFile",fk),$.MxFun.addCommand("Mx_Export_Pdf",mk),$.MxFun.addCommand("Mx_Cut_Dwg",gk),$.MxFun.addCommand("Mx_Cut_MxWeb",_k)}function Mk(){return Gt(this,null,function*(){let t="0601",e="001A",n=new p.MxCADSelectionSet,r=new p.MxCADResbuf;r.AddMcDbEntityTypes("TEXT,MTEXT,INSERT,ACAD_PROXY_ENTITY"),n.allSelect(r);let s,u,h=n.count();for(let o=0;o<h;o++){let y=n.item(o).getMcDbEntity();if(!y)return;if(y instanceof p.McDbText){let x=y;if(x.textString==t){s=x.position,u=x.getBoundingBox();break}}else if(y instanceof p.McDbMText){let x=y;if(x.contents==t){s=x.location,u=x.getBoundingBox();break}}else if(y instanceof p.McDbBlockReference){let x=y,M=x.getAllAttribute(),A=0;if(M.forEach(T=>{let P=T.getMcDbEntity();(P.textString==t||P.textString==e)&&A++}),A==2){s=x.position,u=x.getBoundingBox();break}}else if(y instanceof p.McDbProxyEntity){let x=y,M=x.getAllTextContent(),A=0;if(M.forEach(T=>{T==t&&A++}),A>=1){u=x.getBoundingBox(),u&&u.ret&&(s=new p.McGePoint3d(u.minPt.x+(u.maxPt.x-u.minPt.x)*.5,u.minPt.y+(u.maxPt.y-u.minPt.y)*.5));break}}}if(u&&u.ret){console.log(u);let o=u.minPt.distanceTo(u.maxPt)*2;$.MxFun.getCurrentDraw().zoomW(new THREE.Vector3(u.minPt.x-o,u.minPt.y-o,0),new THREE.Vector3(u.maxPt.x+o,u.maxPt.y+o,0))}else s?$.MxFun.getCurrentDraw().zoomCenter(s.x,s.y):console.log("没有找到文字:"+t)})}function wk(){return Gt(this,null,function*(){const t=new p.MxCADUiPrEntity;t.setMessage(G("请选择目标文字"));const e=yield t.go();if(!e.id)return;const n=e.getMcDbEntity(),r=new p.MxCADSelectionSet,s=[];r.allSelect(new p.MxCADResbuf([p.DxfCode.kEntityType,"TEXT"])),r.forEach(o=>Gt(this,null,function*(){let m=o.getMcDbEntity();if(m.textString==n.textString){const y=m.position;console.log("文字位置:X："+y.x+"Y："+y.y+"Z："+y.z);const x=m.height;let{minPt:M,maxPt:A,ret:T}=m.getBoundingBox();if(!T)return;const P=p.McGeVector3d.kXAxis.normalize().mult(x*4),D=p.McGeVector3d.kYAxis.normalize().mult(x*4);M.addvec(P.negate()).addvec(D.negate()),A.subvec(P).subvec(D);let k=Math.abs(M.x-A.x),z=Math.abs(M.y-A.y);if(k<1||z<1)return;let O=200,U=O*z/k;s.push({type:"image/bmp",width:O,height:U,range_pt1:M.toVector3(),range_pt2:A.toVector3()})}}));let u="";for(let o=0;o<s.length;o++){let m=yield Kd(Bh({},s[o]));u+='<img src="'+m+'"/>'}let h=window.open();h!=null&&h.document.write(`<div style="display:flex;align-item:center;justify-content:space-evenly;">${u}</div>`)})}function Kd(t){return new Promise((e,n)=>{p.MxCpp.getCurrentMxCAD().setAttribute({ShowCoordinate:!1}),$.MxFun.getCurrentDraw().createCanvasImageData(r=>{let s=new p.MxCanvas2Image(document);const u=p.MxCpp.getCurrentMxCAD();let h=s.convertToImage(u.mxdraw.getCanvas(),void 0,void 0,"bmp");e(h.src),u.setAttribute({ShowCoordinate:!0})},t)})}function Ak(){$.MxFun.addCommand("MxTest_FindText",Mk),$.MxFun.addCommand("Mx_Test_GetText",wk)}class mg extends p.McDbCustomEntity{constructor(e){super(e),this.pt1=new p.McGePoint3d,this.pt2=new p.McGePoint3d}create(e){return new mg(e)}getTypeName(){return"McDbTestLineCustomEntity"}dwgInFields(e){return this.pt1=e.readPoint("pt1").val,this.pt2=e.readPoint("pt2").val,!0}dwgOutFields(e){return e.writePoint("pt1",this.pt1),e.writePoint("pt2",this.pt2),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e==0?(this.pt1.x+=n,this.pt1.y+=r,this.pt1.z+=s):e==1&&(this.pt2.x+=n,this.pt2.y+=r,this.pt2.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.pt1),e.append(this.pt2),e}worldDraw(e){let n=new p.McDbPolyline;n.addVertexAt(this.pt1),n.addVertexAt(this.pt2),e.drawEntity(n)}setPoint1(e){this.assertWrite(),this.pt1=e.clone()}setPoint2(e){this.assertWrite(),this.pt2=e.clone()}getPoint1(){return this.pt1}getPoint2(){return this.pt2}}function Ek(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();const e=new p.MxCADUiPrPoint;e.setMessage(G("指定一点:"));let n=yield e.go();if(!n)return;e.setBasePt(n),e.setUseBasePt(!0),e.setMessage(G("指定二点:"));let r=yield e.go();if(!r)return;let s=new mg;s.setPoint1(n),s.setPoint2(r),t.drawEntity(s)})}class gg extends p.McDbCustomEntity{constructor(e){super(e),this.startPoint=new p.McGePoint3d,this.endPoint=new p.McGePoint3d,this.arrowSize=5,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new gg(e)}getTypeName(){return"McDbTestArrowLine"}dwgInFields(e){return this.startPoint=e.readPoint("startPoint").val,this.endPoint=e.readPoint("endPoint").val,this.arrowSize=e.readDouble("arrowSize").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("startPoint",this.startPoint),e.writePoint("endPoint",this.endPoint),e.writeDouble("arrowSize",this.arrowSize),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.startPoint.x+=n,this.startPoint.y+=r,this.startPoint.z+=s):e===1&&(this.endPoint.x+=n,this.endPoint.y+=r,this.endPoint.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.startPoint),e.append(this.endPoint),e}drawArrow(e,n){const r=[],s=n.sub(e).normalize().mult(this.arrowSize),u=e.clone().addvec(s.clone().rotateBy(Math.PI/6)),h=e.clone().addvec(s.clone().rotateBy(-Math.PI/6)),o=new p.McDbPolyline;o.addVertexAt(u),o.addVertexAt(e),o.addVertexAt(h);const m=e.clone().addvec(n.sub(e).mult(1/2)),y=o.clone();return y.mirror(m,m.clone().addvec(s.clone().perpVector())),r.push(o,y),r}worldDraw(e){const n=this.getAllEntity();n.forEach(r=>e.drawEntity(r)),this.getBox(n)}getAllEntity(){const e=[],n=new p.McDbLine(this.startPoint,this.endPoint);return e.push(n),e.push(...this.drawArrow(this.startPoint,this.endPoint)),e}getBox(e){let n,r=null;e.forEach(s=>{const{minPt:u,maxPt:h}=s.getBoundingBox();n||(n=u.clone()),r||(r=h.clone()),u.x<n.x&&(n.x=u.x),u.y<n.y&&(n.y=u.y),h.x>r.x&&(r.x=h.x),h.y>r.y&&(r.y=h.y)}),n&&r&&(this.assertWrite(),this.maxPt=r,this.minPt=n)}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}setStartPoint(e){this.assertWrite(),this.startPoint=e.clone()}getStartPoint(){return this.startPoint}setEndPoint(e){this.assertWrite(),this.endPoint=e.clone()}getEndPoint(){return this.endPoint}setArrowSize(e){this.assertWrite(),this.arrowSize=e}getArrowSize(){return this.arrowSize}}function Tk(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new gg;e.setArrowSize(5);const n=new p.MxCADUiPrPoint;n.setMessage("请指定直线起点:");const r=yield n.go();if(!r)return;e.setStartPoint(r);const s=new p.MxCADUiPrPoint;s.setMessage("请指定直线终点:"),s.setUserDraw((h,o)=>{e.setEndPoint(h),o.drawMcDbEntity(e)});const u=yield s.go();u&&(e.setEndPoint(u),t.drawEntity(e))})}function Pk(){new mg().rxInit(),new gg().rxInit(),$.MxFun.addCommand("MxTest_DrawArrowLine",Tk),$.MxFun.addCommand("MxTest_DrawCustomEntity",Ek)}function Sk(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;if(!(yield t.userSelect("选择要做成块的对象:"))||t.count()==0)return;let e=p.MxCpp.getCurrentMxCAD(),r=e.getDatabase().getBlockTable().add(new p.McDbBlockTableRecord),s=r.getMcDbBlockTableRecord();if(s==null)return;let u,h,o,m;if(t.forEach(A=>{let T=A.getMcDbEntity();if(!T)return;let P=T.clone();s.appendAcDbEntity(P);let D=T.getBoundingBox();D.ret&&(u?(u>D.minPt.x&&(u=D.minPt.x),h>D.minPt.y&&(h=D.minPt.y),o<D.maxPt.x&&(o=D.maxPt.x),m<D.maxPt.y&&(m=D.maxPt.y)):(u=D.minPt.x,h=D.minPt.y,o=D.maxPt.x,m=D.maxPt.y))}),u===void 0)return;let y=u+(o-u)*.5,x=h+(m-h)*.5;s.origin=new p.McGePoint3d(y,x,0);let M=new p.McDbBlockReference;M.blockTableRecordId=r,M.position=new p.McGePoint3d(y,x,0),M=e.drawEntity(M).getMcDbEntity(),t.forEach(A=>{let T=A.getMcDbEntity();T&&T.erase()})})}function Ck(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;if(!(yield t.userSelect("选择要做成块的对象:"))||t.count()==0)return;let e=p.MxCpp.getCurrentMxCAD(),n=e.getDatabase().getBlockTable(),r=new p.McDbBlockTableRecord,s=n.add(r),u=s.getMcDbBlockTableRecord();if(u==null)return;let h,o,m,y;if(t.forEach(U=>{let H=U.getMcDbEntity();if(!H)return;let V=H.clone();u.appendAcDbEntity(V);let W=H.getBoundingBox();W.ret&&(h?(h>W.minPt.x&&(h=W.minPt.x),o>W.minPt.y&&(o=W.minPt.y),m<W.maxPt.x&&(m=W.maxPt.x),y<W.maxPt.y&&(y=W.maxPt.y)):(h=W.minPt.x,o=W.minPt.y,m=W.maxPt.x,y=W.maxPt.y))}),h===void 0)return;let x=h+(m-h)*.5,M=o+(y-o)*.5;u.origin=new p.McGePoint3d(x,M,0);let A=new p.McDbBlockReference;A.blockTableRecordId=s,A.position=new p.McGePoint3d(x+(m-h)*3,M+(y-o)*3,0),A=e.drawEntity(A).getMcDbEntity();let T=m-h;T<y-o&&(T=y-o),T*=.3;let P=new p.McDbCircle(x,M,0,T),D=P.getSamplePoints(T*1e-5),k=new p.McGePoint3dArray;D.forEach((U,H,V)=>{if(V===1010){const W=new p.McGePoint3d(U.x,U.y,U.z);k.append(W)}}),A.createSpatialFilter(),A.scaleFactors=new p.McGePoint3d(3,3,3),A.getSpatialFilterId().getMcDbObject().setBoundary(k),P.center=A.position,P.radius=P.radius*3,e.drawEntity(P)})}function Dk(){$.MxFun.addCommand("MxTest_SelectEntitysToBlock",Sk),$.MxFun.addCommand("MxTest_SelectEntitysToSpatialFilterBlock",Ck)}function Rk(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定填充区域内部一点:")),t.disableAllTrace(!0),t.setDisableOsnap(!0);let e=yield t.go();if(!e)return;let n=p.MxCADUtility.builderHatchFromPoint(e);if(!n){$.MxFun.acutPrintf(G("没有找到闭合区域 "));return}p.MxCpp.getCurrentMxCAD().drawEntity(n)})}function Lk(){$.MxFun.addCommand("MxTest_DrawHatchFormPoint",Rk)}const v1={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ik(t){if(/^\d+,\s*\d+,\s*\d+$/.test(t))return t.split(",").map(Number);if(/^0x[0-9a-fA-F]{6}$/.test(t)){const e=parseInt(t,16);return[e>>16&255,e>>8&255,e&255]}else if(/^#[0-9a-fA-F]{6}$/.test(t)){const e=parseInt(t.slice(1),16);return[e>>16&255,e>>8&255,e&255]}else if(v1[t.toLowerCase()]){const e=t.toLowerCase();if(v1[e])return v1[e]}else{const e=new p.McCmColor;return e.setColorIndex(256),[e.red,e.green,e.blue]}}const kk=t=>{const e=p.MxCpp.getCurrentDatabase().layerTable;if(e.has(t))return;const n=new p.McDbLayerTableRecord;n.color=new p.McCmColor(0,0,0),n.isFrozen=!1,n.isLocked=!1,n.isOff=!1,n.lineWeight=p.McDb.LineWeight.kLnWtByLayer,n.name=t,e.add(n)},ka=[{name:"color",description:"颜色",type:"str",required:!0},{name:"layer",description:"图层",type:"str",required:!0},{name:"lineweight",description:"线重",type:"float",required:!0}],Ba=(t,e)=>{e.layer&&kk(e.layer);const n=r=>{e.color?r.trueColor=new p.McCmColor(...Ik(e.color)):r.trueColor=new p.McCmColor(p.MxCpp.getCurrentDatabase().getCurrentlyDrawColor()),e.layer?r.layer=e.layer:r.layer=p.MxCpp.getCurrentDatabase().getCurrentlyLayerName(),e.lineweight&&(r.lineweight=e.lineweight)};Array.isArray(t)?t.forEach(n):t&&n(t)},Bk=t=>{const e=t.split(",").map(s=>Number(s)),n=[];let r=0;for(;r<e.length;){const s=e[r];r++;const u=e[r];if(r++,typeof s=="undefined"||typeof u=="undefined")return n;const h=new p.McGePoint3d(s,u);n.push(h)}return n},xr=t=>{if(typeof t=="object"&&"x"in t&&"y"in t)return new p.McGePoint3d(t.x,t.y);if(Array.isArray(t))return new p.McGePoint3d(t[0],t[1]);if(typeof t=="string"){const[e,n]=t.split(",").map(r=>Number(r));if(typeof e=="number"&&typeof n=="number")return new p.McGePoint3d(e,n)}};class Fk{call(e){if(console.log(e),e&&e.pt1&&e.pt2){let n=p.MxCpp.getCurrentMxCAD();e.pt1&&(e.pt1=xr(e.pt1)),e.pt2&&(e.pt2=xr(e.pt2));const r=n.drawLine(e.pt1.x,e.pt1.y,e.pt2.x,e.pt2.y);Ba(r.getMcDbEntity(),e),n.updateDisplay()}}regist_data(){return{filename:"drawline.json",name:"draw_line",description:"根据直线的开始点和结束点绘制一个直线段",params:[{name:"pt1",description:"直线开始点",type:"tuple[float, float]",required:!0},{name:"pt2",description:"直线结束点",type:"tuple[float, float]",required:!0},...ka]}}}function zk(){Lo.regist(Fk)}class Nk{call(e){if(console.log(e),e&&e.cen&&e.radius){e.cen&&(e.center=xr(e.cen));let n=p.MxCpp.getCurrentMxCAD();const r=n.drawCircle(e.center.x,e.center.y,e.radius);Ba(r.getMcDbEntity(),e),n.updateDisplay()}}regist_data(){return{filename:"drawcircle.json",name:"draw_circle",description:"根据圆心和半径绘制一个圆",params:[{name:"center",description:"圆的中心点",type:"tuple[float, float]",required:!0},{name:"radius",description:"圆的半径",type:"float",required:!0},...ka]}}}const Uk=()=>{Lo.regist(Nk)};function Kr(t,e,n,r,s){const u=t.x,h=t.y,o=e.x,m=e.y,y=n.x,x=n.y,M=r.x,A=r.y,T=(u-o)*(x-A)-(h-m)*(y-M);if(T===0)return null;const P=((u-y)*(x-A)-(h-x)*(y-M))/T,D=-((u-o)*(h-x)-(h-m)*(u-y))/T,k=u+P*(o-u),z=h+P*(m-h),O=new p.McGePoint3d(k,z,0);return s||P>0&&P<1&&D>0&&D<1?O:null}function Iu(t,e){const n=e.x,r=e.y;let s=!1;for(let u=0,h=t.length-1;u<t.length;h=u++){const o=t[u].x,m=t[u].y,y=t[h].x,x=t[h].y;m>r!=x>r&&n<(y-o)*(r-m)/(x-m)+o&&(s=!s)}return s}function Zd(t,e,n,r){const s=t-n,u=e-r;let h=0;return s==0?h=Math.PI/2:h=Math.atan(Math.abs(u/s)),s<0&&u>=0?h=Math.PI-h:s<0&&u<0?h=Math.PI+h:s>=0&&u<0&&(h=Math.PI*2-h),h}function Jd(t,e,n,r){const s=new p.McDbArc;return s.center=t,s.radius=e,s.startAngle=n,s.endAngle=r,s}class Vk{call(e){return Gt(this,null,function*(){console.log(e);let{center:n,radius:r,startAngle:s,endAngle:u,is3PDraw:h,point1:o,point2:m,point3:y}=e,x=p.MxCpp.getCurrentMxCAD();x.newFile(),x.zoomAll();const M=new p.MxCADUiPrPoint,A=new p.MxCADUiPrDist;if(h){if(o&&(o=xr(o)),m&&(m=xr(m)),y&&(y=xr(y)),M.setKeyWords(""),!o&&(M.setMessage("指定圆弧起点"),M.setUserDraw((P,D)=>{if(!m||!y)return;const k=new p.McDbArc;k.computeArc(P.x,P.y,m.x,m.y,y.x,y.y),D.drawMcDbEntity(k)}),o=yield M.go(),!o)||!m&&(M.setMessage("指定圆弧第二个点"),M.setUserDraw((P,D)=>{if(!o||!y)return;const k=new p.McDbArc;k.computeArc(o.x,o.y,P.x,P.y,y.x,y.y),D.drawMcDbEntity(k)}),m=yield M.go(),!m)||!y&&(M.setMessage("指定圆弧的端点"),M.setUserDraw((P,D)=>{if(!o||!m)return;const k=new p.McDbArc;k.computeArc(o.x,o.y,m.x,m.y,P.x,P.y),D.drawMcDbEntity(k)}),y=yield M.go(),!y))return;const T=new p.McDbArc;console.log(o.x,o.y,m.x,m.y,y.x,y.y),T.computeArc(o.x,o.y,m.x,m.y,y.x,y.y),Ba(T,e),x.drawEntity(T),x.updateDisplay()}else{if(n&&(n=xr(n)),s&&(s=s*(Math.PI/180)),u&&(u=u*(Math.PI/180)),!n){M.setMessage("指定圆弧圆心"),M.setKeyWords(""),M.setUserDraw((D,k)=>{r&&k.drawMcDbEntity(Jd(D,r,s||0,u||Math.PI*2))});const P=yield M.go();if(!P)return;n=P}if(!r&&(A.setBasePt(n),A.setMessage(p._ML_String("MxAiDrawCircleArc_Radius","指定圆弧半径")),A.setKeyWords(""),A.setUserDraw((P,D)=>{if(!n)return;const k=P.distanceTo(n);D.drawMcDbEntity(Jd(n,k,s||0,u||Math.PI*2))}),r=yield A.go(),!r))return;if(!s){if(!n)return;A.setBasePt(n),A.setMessage(p._ML_String("MxAiDrawCircleArc_StartAngle","指定圆弧开始角")),A.setKeyWords(""),A.setUserDraw((D,k)=>{n&&r&&(s=Zd(n.x,n.y,D.x,D.y)-Math.PI,k.drawMcDbEntity(Jd(n,r,s||0,u||Math.PI*2)))});const P=yield A.go();if(!P)return;A.getDetailedResult()===$.DetailedResult.kCoordIn&&(s=P*(Math.PI/180))}if(!u){if(!n)return;A.setBasePt(n),A.setMessage(p._ML_String("MxAiDrawCircleArc_EndAngle","指定圆弧结束角")),A.setKeyWords(""),A.setUserDraw((D,k)=>{n&&r&&(u=Zd(n.x,n.y,D.x,D.y)-Math.PI,k.drawMcDbEntity(Jd(n,r,s||0,u||Math.PI*2)))});const P=yield A.go();if(!P)return;A.getDetailedResult()===$.DetailedResult.kCoordIn&&(u=P*(Math.PI/180))}const T=Jd(n,r,s,u);Ba(T,e),x.drawEntity(T),x.updateDisplay()}})}regist_data(){return{filename:"drawcirclearc.json",name:"draw_circle_arc",description:"绘制圆弧",params:[{name:"center",description:"圆弧圆心",type:"tuple[float, float]",required:!0},{name:"radius",description:"圆弧半径",type:"float",required:!0},{name:"startAngle",description:"圆弧开始角",type:"float",required:!0},{name:"endAngle",description:"圆弧结束角",type:"float",required:!0},{name:"is3PDraw",description:"是否三点绘制",type:"boolean",required:!0},{name:"point1",description:"三点绘制圆弧的第一个点(起点)",type:"tuple[float, float]",required:!0},{name:"point2",description:"三点绘制圆弧的第二个点",type:"tuple[float, float]",required:!0},{name:"point3",description:"三点绘制圆弧的第三个点(终点)",type:"tuple[float, float]",required:!0},...ka]}}}const Gk=()=>{Lo.regist(Vk)};function Gw(t=new p.McGePoint3d,e=new p.McGePoint3d,n=3){const r=e.x,s=e.y,u=t.x,h=t.y,o=Math.max(3,n),y=Math.sqrt(Jv(r-u,2)+Jv(s-h,2))/Math.cos(Math.PI/o),x=Math.atan2(s-h,r-u)-Math.PI/o,M=[];for(let A=0;A<o;A++){const T=x+A*2*Math.PI/o,P=u+y*Math.cos(T),D=h+y*Math.sin(T);M.push(new p.McGePoint3d(P,D))}return M}function Ow(t=new p.McGePoint3d,e=new p.McGePoint3d,n=3){const r=[];n=Math.max(3,n),r.push(e);const s=Math.PI*2/n;for(let u=1;u<n;u++){const h=Math.cos(s*u),o=Math.sin(s*u),m=t.clone(),y=e.clone(),x=y.x-m.x,M=y.y-m.y,A=x*h-M*o+m.x,T=x*o+M*h+m.y,P=new p.McGePoint3d(A,T);r.push(P)}return r}function Ok(t,e,n){let r=e.x-t.x,s=e.y-t.y,u=Math.sqrt(r*r+s*s),h=Math.atan2(s,r),o=2*Math.PI/Math.max(3,n),m=[t,e];for(let y=0;y<n;y++){let x=t.x+u*Math.cos(h+y*o),M=t.y+u*Math.sin(h+y*o);t=new p.McGePoint3d(x,M),m.push(t)}return m}class jk{call(e){return Gt(this,null,function*(){p.MxCpp.getCurrentMxCAD().newFile(),console.log(e);let{isDrawToCenter:n,sideNum:r,startPoint:s,endPoint:u,radius:h,centerPoint:o,isTangentToTheCircle:m}=e;if(!r){const y=new p.MxCADUiPrInt;y.setMessage("输入边的数目<5>"),y.setKeyWords(""),y.clearLastInputPoint(),r=(yield y.go())||5}if(n){if(o)o=xr(o);else{const A=new p.MxCADUiPrPoint;if(A.setMessage(`
指定正多变形的中心点`),A.setKeyWords(""),A.clearLastInputPoint(),o=yield A.go(),!o)return}let y=p.McGeVector3d.kXAxis,x;if(!h){const A=new p.MxCADUiPrDist;A.setMessage(p._ML_String("MxAiDrawPolygon_radius","指定圆的半径")),A.setKeyWords(""),A.setBasePt(o),A.setUserDraw((P,D)=>{if(m){const k=P.distanceTo(o);y=P.sub(o);const z=o.clone().addvec(P.sub(o).normalize().mult(k)),O=Gw(o,z,r),U=new p.McDbPolyline;O.forEach(H=>{U.addVertexAt(H)}),U.isClosed=!0,D.drawMcDbEntity(U)}else{x=P;const k=new p.McDbPolyline;Ow(o,P,r).forEach(z=>{k.addVertexAt(z)}),k.isClosed=!0,D.drawMcDbEntity(k)}});const T=yield A.go();if(!T)return;h=T}const M=new p.McDbPolyline;if(M.isClosed=!0,m){const A=o.clone().addvec(y.normalize().mult(h));Gw(o,A,r).forEach(P=>{M.addVertexAt(P)})}else{if(!x){const A=p.McGeVector3d.kXAxis.clone().rotateBy(Math.PI/r).mult(h);x=o.clone().addvec(A)}Ow(o,x,r).forEach(A=>{M.addVertexAt(A)})}p.MxCpp.getCurrentMxCAD().drawEntity(M)}else{const y=M=>{const A=new p.McDbPolyline;return Ok(s,M,r||5).forEach(P=>{A.addVertexAt(P)}),A.isClosed=!0,A};if(s)s=xr(s);else{const M=new p.MxCADUiPrPoint;if(M.clearLastInputPoint(),M.setMessage(`
指定边的第一个端点`),M.setKeyWords(""),s=yield M.go(),!s)return;M.setUserDraw((A,T)=>{T.drawMcDbEntity(y(A))})}if(u)u=xr(u);else{const M=new p.MxCADUiPrPoint;M.setBasePt(s),M.setMessage(`
指定边的第二个端点`),u=yield M.go()}if(!u)return;const x=y(u);p.MxCpp.getCurrentMxCAD().drawEntity(x)}})}regist_data(){return{filename:"DrawPolygon.json",name:"draw_polygon",description:"绘制正多边形",params:[{name:"isDrawToCenter",description:"是否用圆绘制多边形",type:"boolean",required:!0},{name:"sideNum",description:"边数",type:"int",required:!0},{name:"startPoint",description:"边绘制提供开始点",type:"tuple[float, float]",required:!0},{name:"endPoint",description:"边绘制提供结束点",type:"tuple[float, float]",required:!0},{name:"radius",description:"圆的半径",type:"number",required:!0},{name:"centerPoint",description:"圆心",type:"tuple[float, float]",required:!0},{name:"isTangentToTheCircle",description:"外切于圆",type:"boolean",required:!0}]}}}const Hk=()=>{Lo.regist(jk)},jw=(t,e,n)=>{const r=Math.cos(n),s=Math.sin(n),u=e.x-t.x,h=e.y-t.y,o=u*r-h*s+t.x,m=u*s+h*r+t.y,y=e.z;return new p.McGePoint3d(o,m,y)},_1=(t,e,n=0)=>{const r=new p.McGePoint3d((t.x+e.x)/2,(t.y+e.y)/2,(t.z+e.z)/2),s=new p.McGePoint3d(t.x,e.y,t.z),u=new p.McGePoint3d(e.x,t.y,e.z),h=jw(r,s,n),o=jw(r,u,n);return[t,h,e,o]},Hw=(t,e)=>[e.x>=t.x&&e.y>=t.y,e.x<t.x&&e.y>=t.y,e.x<t.x&&e.y<t.y,e.x>=t.x&&e.y<t.y];function Ww(t,e,n){if(e===0&&n===0)return t;const[r,s,u,h]=t,o=r.distanceTo(h),m=r.distanceTo(s),[y,x,M,A]=Hw(r,u),T=x||M?-e:e,P=M||A?-n:n;if(o-Math.abs(T)*2<=0||m-Math.abs(P)*2<=0)return t;const D=new p.McGePoint3d(r.x+T,r.y,r.z),k=new p.McGePoint3d(r.x,r.y+P,r.z),z=new p.McGePoint3d(s.x,s.y-P,s.z),O=new p.McGePoint3d(s.x+T,s.y,s.z),U=new p.McGePoint3d(u.x-T,u.y,u.z),H=new p.McGePoint3d(u.x,s.y-P,u.z),V=new p.McGePoint3d(h.x,h.y+P,h.z),W=new p.McGePoint3d(h.x-T,h.y,h.z);return[D,k,z,O,U,H,V,W]}function Wk(t,e,n){if(t.isEqualTo(e))return 0;let r=t.c().addvec(e.c().sub(t).mult(.5)),s=e.c().sub(t);s.rotateBy(Math.PI/2,p.McGeVector3d.kZAxis);let u=new p.McDbLine(r,r.c().addvec(s)),h=n.c();h.rotateBy(Math.PI/2,p.McGeVector3d.kZAxis);let o=new p.McDbLine(t,t.c().addvec(h)),m=u.IntersectWith(o,p.McDb.Intersect.kExtendBoth);if(m.isEmpty())return 0;let y=m.at(0),x=y.distanceTo(t);s.normalize(),s.mult(x);let M=y.c().addvec(s),A=y.c().subvec(s),T=M.c().sub(t),P=A.c().sub(t),D=M;return T.angleTo1(n)>P.angleTo1(n)&&(D=A),p.MxCADUtility.calcBulge(t,D,e).val}class qk{call(e){return Gt(this,null,function*(){console.log(e),p.MxCpp.getCurrentMxCAD().newFile();let{pt1:n,pt2:r,chamfer1Length:s,chamfer2Length:u,filletRadius:h,lineWidth:o,area:m,rectLength:y,rectWidth:x,rotationAngle:M}=e;const A=(D,k)=>{const[z,O,U,H]=_1(D,k,M),V=new p.McDbPolyline;return V.addVertexAt(z,0,o,o),V.addVertexAt(O,0,o,o),V.addVertexAt(U,0,o,o),V.addVertexAt(H,0,o,o),V.isClosed=!0,o&&(V.constantWidth=o),V},T=(D,k)=>{let z;if(h){const O=Ww(_1(D,k,M),h,h),[U,H,V,W]=Hw(D,k);if(O.length===8){z||(z=new p.McDbPolyline);const K=(nt,ct,xt)=>{let vt=new p.McGeVector3d(xt);const Zt=Wk(nt,ct,vt);z.addVertexAt(nt,Zt,o,o),z.addVertexAt(ct,0,o,o)},Z=new p.McGeVector3d(-1,0),tt=new p.McGeVector3d(0,1),at=new p.McGeVector3d(1,0),st=new p.McGeVector3d(0,-1);W&&(tt.y=-1,at.x=1,st.y=1),H&&(Z.x=1,tt.y=1,at.x=-1,st.y=-1),V&&(Z.x=1,tt.y=-1,at.x=-1,st.y=1),K(O[0],O[1],Z),K(O[2],O[3],tt),K(O[4],O[5],at),K(O[6],O[7],st),z.isClosed=!0}}else(s||u)&&(z||(z=new p.McDbPolyline),Ww(_1(D,k,M),s||u,u||s).forEach(U=>{z.addVertexAt(U)}),z.isClosed=!0);return z||(z=A(D,k)),o&&(z.constantWidth=o),z};if(n)n=xr(n);else{const D=new p.MxCADUiPrPoint;if(D.setMessage("指定第一个角点"),D.setKeyWords(""),n=yield D.go(),!n)return}if(m&&(y&&(x=m/y),x&&(y=m/x)),y&&x&&(r=new p.McGePoint3d(n.x+x,n.y+y,0)),r)r=xr(r);else{const D=new p.MxCADUiPrPoint;if(D.setMessage("指定第二个角点"),D.setKeyWords(""),D.setUserDraw((k,z)=>{z.drawMcDbEntity(T(n,k))}),r=yield D.go(),!r)return}const P=T(n,r);Ba(P,e),p.MxCpp.getCurrentMxCAD().drawEntity(P)})}regist_data(){return{filename:"drawRect.json",name:"draw_rect",description:"根据一些信息绘制矩形",params:[{name:"pt1",description:"一个对角点",type:"tuple[float, float]",required:!0},{name:"pt2",description:"另一个对角点",type:"tuple[float, float]",required:!0},{name:"lineWidth",description:"矩形线的宽",type:"float",required:!0},{name:"filletRadius",description:"圆角半径",type:"float",required:!0},{name:"chamfer1Length",description:"第一个倒角距离",type:"float",required:!0},{name:"chamfer2Length",description:"第二个倒角距离",type:"float",required:!0},{name:"rectLength",description:"长度",type:"float",required:!0},{name:"rectWidth",description:"矩形宽度",type:"float",required:!0},{name:"area",description:"面积",type:"float",required:!0},{name:"rotationAngle",description:"旋转角度",type:"float",required:!0},...ka]}}}function Yk(){Lo.regist(qk)}const xs=(t,e,n,r,s)=>{const u=new p.McDbEllipse,h=new p.McGePoint3d((t.x+e.x)/2,(e.y+e.y)/2),o=t.sub(e),m=o,y=t.distanceTo(e)/2,M=n/2/y;return u.center=h,u.majorAxis=o,u.minorAxis=m,u.radiusRatio=M,u.startAngle=r,u.endAngle=s,u};class Xk{call(e){return Gt(this,null,function*(){let{endPoint1:n,endPoint2:r,halfAxisLength:s}=e;const u=p.MxCpp.getCurrentMxCAD();u.newFile();const h=new p.MxCADUiPrPoint,o=new p.MxCADUiPrDist;if(n&&(n=xr(n)),r&&(r=xr(r)),!n&&(h.setMessage("指定椭圆的轴端点1"),h.setKeyWords(""),h.setUserDraw((y,x)=>{r&&s&&x.drawMcDbEntity(xs(y,r,s,0,Math.PI*2))}),n=yield h.go(),!n)||!r&&(h.setMessage("指定椭圆的轴端点2"),h.setKeyWords(""),h.setUserDraw((y,x)=>{n&&s&&x.drawMcDbEntity(xs(n,y,s,0,Math.PI*2))}),r=yield h.go(),!r))return;if(!s){o.setMessage("指定半轴长度"),o.setKeyWords("");const y=new p.McGePoint3d((n.x+r.x)/2,(r.y+r.y)/2);if(o.setBasePt(y),o.setUserDraw((x,M)=>{n&&M.drawMcDbEntity(xs(n,r,y.distanceTo(x),0,Math.PI*2))}),s=yield o.go(),!s)return}const m=xs(n,r,s,0,Math.PI*2);Ba(m,e),u.drawEntity(m)})}regist_data(){return{filename:"drawellipse.json",name:"draw_ellipse",description:"绘制椭圆",params:[{name:"endPoint1",description:"椭圆端点1",type:"tuple[float, float]",required:!0},{name:"endPoint2",description:"椭圆端点2",type:"tuple[float, float]",required:!0},{name:"halfAxisLength",description:"半轴长度",type:"float",required:!0},...ka]}}}class Kk{call(e){return Gt(this,null,function*(){let{endPoint1:n,endPoint2:r,halfAxisLength:s,startAngle:u,endAngle:h}=e;const o=p.MxCpp.getCurrentMxCAD();o.newFile();const m=new p.MxCADUiPrPoint,y=new p.MxCADUiPrDist;if(n&&(n=xr(n)),r&&(r=xr(r)),u&&(u=u*(Math.PI/180)),h&&(h=h*(Math.PI/180)),!n&&(m.setMessage("指定椭圆的轴端点1"),m.setKeyWords(""),m.setUserDraw((T,P)=>{r&&s&&P.drawMcDbEntity(xs(T,r,s,0,Math.PI*2))}),n=yield m.go(),!n)||!r&&(m.setMessage("指定椭圆的轴端点2"),m.setKeyWords(""),m.setUserDraw((T,P)=>{n&&s&&P.drawMcDbEntity(xs(n,T,s,0,Math.PI*2))}),r=yield m.go(),!r))return;const x=new p.McGePoint3d((n.x+r.x)/2,(r.y+r.y)/2);if(!s&&(y.setMessage("指定半轴长度"),y.setKeyWords(""),y.setBasePt(x),y.setUserDraw((T,P)=>{n&&P.drawMcDbEntity(xs(n,r,x.distanceTo(T),0,Math.PI*2))}),s=yield y.go(),!s))return;const M=Zd(x.x,x.y,n.x,n.y);if(!u){y.setMessage(p._ML_String("EllipticalArc_startAngle","指定起点角度")),y.setKeyWords(""),y.setUserDraw((P,D)=>{u=Zd(x.x,x.y,P.x,P.y)-M-Math.PI,D.drawMcDbEntity(xs(n,r,s,u,Math.PI*2))});const T=yield y.go();if(!T)return;y.getDetailedResult()==$.DetailedResult.kCoordIn&&(u=T*(180/Math.PI))}if(!h){y.setLastInputPoint(x),y.setMessage(p._ML_String("EllipticalArc_endAngle","指定端点角度")),y.setKeyWords(""),y.setUserDraw((P,D)=>{h=Zd(x.x,x.y,P.x,P.y)-M-Math.PI,D.drawMcDbEntity(xs(n,r,s,u,h))});const T=yield y.go();if(!T)return;y.getDetailedResult()===$.DetailedResult.kCoordIn&&(h=T*(180/Math.PI))}const A=xs(n,r,s,u,h);Ba(A,e),o.drawEntity(A)})}regist_data(){return{filename:"drawellipseArc.json",name:"draw_ellipse_arc",description:"绘制椭圆弧",params:[{name:"endPoint1",description:"椭圆弧端点1",type:"tuple[float, float]",required:!0},{name:"endPoint2",description:"椭圆弧端点2",type:"tuple[float, float]",required:!0},{name:"halfAxisLength",description:"半轴长度",type:"float",required:!0},{name:"startAngle",description:"开始角度",type:"float",required:!0},{name:"endAngle",description:"结束角度",type:"float",required:!0},...ka]}}}const Zk=()=>{Lo.regist(Xk),Lo.regist(Kk)},qw=class os{constructor(e,n,r=50){this.width=50,this.isDraw=!1,this.update(e,n,r)}update(e,n,r=this.width){let s=e.clone().sub(n).normalize();s=new p.McGeVector3d(-s.y,s.x,0).mult(r/2);const u=s.clone().negate();this.outsidePoints=[e.clone().addvec(s),n.clone().addvec(s)],this.insidePoints=[e.clone().addvec(u),n.clone().addvec(u)],this.width=r,this.startPoint=e.clone(),this.endPoint=n.clone(),this.outsideLine?(this.outsideLine.startPoint=this.outsidePoints[0],this.outsideLine.endPoint=this.outsidePoints[1]):this.outsideLine=new p.McDbLine(this.outsidePoints[0],this.outsidePoints[1]),this.insideLine?(this.insideLine.startPoint=this.insidePoints[0],this.insideLine.endPoint=this.insidePoints[1]):this.insideLine=new p.McDbLine(this.insidePoints[0],this.insidePoints[1]),this.startClosedLine?(this.startClosedLine.startPoint=this.outsidePoints[0],this.startClosedLine.endPoint=this.insidePoints[0]):this.startClosedLine=new p.McDbLine(this.outsidePoints[0],this.insidePoints[0]),this.endClosedLine?(this.endClosedLine.startPoint=this.outsidePoints[1],this.endClosedLine.endPoint=this.insidePoints[1]):this.endClosedLine=new p.McDbLine(this.outsidePoints[1],this.insidePoints[1])}clone(){const e=new os(this.startPoint,this.endPoint,this.width);return e.insideLine=this.insideLine.clone(),e.outsideLine=this.outsideLine.clone(),e}hiddenStartClosedLine(){this.startClosedLine.visible=!1}hiddenEndClosedLine(){this.endClosedLine.visible=!1}getClosedStartLineToDiffWallInsideLineIntersectionPoint(e,n=!1){return this.startClosedLine.visible?Kr(e.insideLine.startPoint,e.insideLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,n):null}getClosedStartLineToDiffWallOutsideLineIntersectionPoint(e,n=!1){return this.startClosedLine.visible?Kr(e.outsideLine.startPoint,e.outsideLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,n):null}getClosedEndLineToDiffWallInsideLineIntersectionPoint(e,n=!1){return this.endClosedLine.visible?Kr(e.insideLine.startPoint,e.insideLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,n):null}getClosedEndLineToDiffWallOutsideLineIntersectionPoint(e,n=!1){return this.endClosedLine.visible?Kr(e.outsideLine.startPoint,e.outsideLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,n):null}getInsideToDiffInsideIntersectionPoint(e,n=!1){return Kr(e.insideLine.startPoint,e.insideLine.endPoint,this.insideLine.startPoint,this.insideLine.endPoint,n)}getOutsideToDiffOutsideIntersectionPoint(e,n=!1){return Kr(e.outsideLine.startPoint,e.outsideLine.endPoint,this.outsideLine.startPoint,this.outsideLine.endPoint,n)}getInsideToDiffOutsideIntersectionPoint(e,n=!1){return Kr(e.outsideLine.startPoint,e.outsideLine.endPoint,this.insideLine.startPoint,this.insideLine.endPoint,n)}getOutsideToDiffInsideIntersectionPoint(e,n=!1){return Kr(e.insideLine.startPoint,e.insideLine.endPoint,this.outsideLine.startPoint,this.outsideLine.endPoint,n)}getClosedStartLineToDiffLineClosedStartLineIntersectionPoint(e,n=!1){return this.startClosedLine.visible?Kr(e.startClosedLine.startPoint,e.startClosedLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,n):null}getClosedStartLineToDiffLineClosedEndLineIntersectionPoint(e,n=!1){return this.startClosedLine.visible?Kr(e.endClosedLine.startPoint,e.endClosedLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,n):null}getClosedEndLineToDiffLineClosedStartLineIntersectionPoint(e,n=!1){return this.endClosedLine.visible?Kr(e.startClosedLine.startPoint,e.startClosedLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,n):null}getClosedEndLineToDiffLineClosedEndLineIntersectionPoint(e,n=!1){return this.endClosedLine.visible?Kr(e.endClosedLine.startPoint,e.endClosedLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,n):null}isCorner(e){const n=e.startPoint.sub(e.endPoint).normalize(),r=n.clone().mult(e.width),s=n.clone().mult(-e.width),u=e.insideLine.startPoint.clone().addvec(r),h=e.insideLine.startPoint.clone().addvec(s),o=e.outsideLine.startPoint.clone().addvec(s),m=e.outsideLine.startPoint.clone().addvec(r),y=e.insideLine.endPoint.clone().addvec(r),x=e.insideLine.endPoint.clone().addvec(s),M=e.outsideLine.endPoint.clone().addvec(s),A=e.outsideLine.endPoint.clone().addvec(r),T=Iu([u,h,o,m],this.startPoint),P=Iu([u,h,o,m],this.endPoint),D=Iu([y,x,M,A],this.startPoint),k=Iu([y,x,M,A],this.endPoint);return[{start:T,end:P},{start:D,end:k}]}handlingCorners(e){const[n,r]=this.isCorner(e);if(r.start){this.outsideLine.startPoint=e.outsideLine.endPoint=this.getOutsideToDiffOutsideIntersectionPoint(e,!0),this.insideLine.startPoint=e.insideLine.endPoint=this.getInsideToDiffInsideIntersectionPoint(e,!0),this.hiddenStartClosedLine(),e.hiddenEndClosedLine();return}else if(r.end){this.outsideLine.endPoint=e.insideLine.endPoint=this.getOutsideToDiffInsideIntersectionPoint(e,!0),this.insideLine.endPoint=e.outsideLine.endPoint=this.getInsideToDiffOutsideIntersectionPoint(e,!0),this.hiddenEndClosedLine(),e.hiddenEndClosedLine();return}else if(n.start){this.insideLine.startPoint=e.outsideLine.startPoint=this.getInsideToDiffOutsideIntersectionPoint(e,!0),this.outsideLine.startPoint=e.insideLine.startPoint=this.getOutsideToDiffInsideIntersectionPoint(e,!0),this.hiddenStartClosedLine(),e.hiddenStartClosedLine();return}else if(n.end){this.outsideLine.endPoint=e.outsideLine.startPoint=this.getOutsideToDiffOutsideIntersectionPoint(e,!0),this.insideLine.endPoint=e.insideLine.startPoint=this.getInsideToDiffInsideIntersectionPoint(e,!0),this.hiddenEndClosedLine(),e.hiddenStartClosedLine();return}}processingIntersection(){const e=[];os.lines.forEach(n=>{const r=this.getInsideToDiffInsideIntersectionPoint(n),s=this.getInsideToDiffOutsideIntersectionPoint(n),u=this.getOutsideToDiffOutsideIntersectionPoint(n),h=this.getOutsideToDiffInsideIntersectionPoint(n);(r||s||u||h)&&e.push({diffLine:n,intersectionPoints:[r,s,u,h]})}),e.forEach(({diffLine:n,intersectionPoints:r})=>{const[s,u]=this.isCorner(n);s.end||s.start||u.start||u.start;const[h,o,m,y]=r,x=[n.insideLine.startPoint,n.insideLine.endPoint,n.outsideLine.endPoint,n.outsideLine.startPoint];if(Iu(x,this.startPoint),Iu(x,this.endPoint),h&&o&&m&&y){const M=Kr(this.startPoint,this.endPoint,n.startPoint,n.endPoint),A=new os(this.startPoint,M,this.width),T=new os(M,this.endPoint,this.width),P=new os(n.startPoint,M,n.width),D=new os(M,n.endPoint,n.width);A.insideLine.startPoint=this.insideLine.startPoint,A.outsideLine.startPoint=this.outsideLine.startPoint,T.insideLine.endPoint=this.insideLine.endPoint,T.outsideLine.endPoint=this.outsideLine.endPoint,n.remove(),this.remove(),A.draw(),T.draw(),P.draw(),D.draw()}else if(m&&o||h&&y){const M=Kr(this.startPoint,this.endPoint,n.startPoint,n.endPoint,!0),A=new os(n.startPoint,M,n.width);A.hiddenEndClosedLine();const T=new os(M,n.endPoint,n.width);T.hiddenStartClosedLine(),n.remove(),A.draw(),T.draw()}else{if(e.length===1)return this.handlingCorners(n);u.start?(console.log("endCorner.start"),m&&(n.outsideLine.endPoint=this.outsideLine.startPoint=m),h&&(n.insideLine.endPoint=this.insideLine.startPoint=h),this.hiddenStartClosedLine(),n.hiddenEndClosedLine()):u.end?(console.log("endCorner.end"),y&&(n.insideLine.endPoint=this.outsideLine.endPoint=y),o&&(n.outsideLine.endPoint=this.insideLine.endPoint=o),this.hiddenEndClosedLine(),n.hiddenEndClosedLine()):s.start?(console.log("startCorner.start"),o&&(n.outsideLine.startPoint=this.insideLine.startPoint=o),y&&(n.insideLine.startPoint=this.outsideLine.startPoint=y),n.hiddenStartClosedLine(),this.hiddenStartClosedLine()):s.end&&(console.log("startCorner.end"),m&&(n.outsideLine.startPoint=this.outsideLine.endPoint=m),h&&(n.insideLine.startPoint=this.insideLine.endPoint=h),n.hiddenStartClosedLine(),this.hiddenEndClosedLine())}})}draw(e=!0){if(this.isDraw)return;const n=p.MxCpp.getCurrentMxCAD();if(this.outsideLine&&this.outsideLine.erase(),this.insideLine&&this.insideLine.erase(),!n)return;this.outsideLine.trueColor=new p.McCmColor(255,0,0),this.outsideId=n.drawEntity(this.outsideLine),this.insideLine.trueColor=new p.McCmColor(0,255,255),this.insideId=n.drawEntity(this.insideLine);const r=this.outsideId.getMcDbEntity();r&&(this.outsideLine=r);const s=this.insideId.getMcDbEntity();s&&(this.insideLine=s),this.startClosedId=n.drawEntity(this.startClosedLine),this.endClosedId=n.drawEntity(this.endClosedLine);const u=this.startClosedId.getMcDbEntity();u&&(this.startClosedLine=u);const h=this.endClosedId.getMcDbEntity();h&&(this.endClosedLine=h),n.updateDisplay(),os.lines.add(this),this.isDraw=!0,e&&this.processingIntersection()}remove(){this.endClosedId&&this.endClosedId.erase(),this.startClosedId&&this.startClosedId.erase(),this.insideId&&this.insideId.erase(),this.outsideId&&this.outsideId.erase(),os.lines.delete(this)}};qw.lines=new Set;let Jk=qw;class Qk{call(e){if(e&&e.points){let n=p.MxCpp.getCurrentMxCAD();const r=Bk(e.points);if(r.length<2)return;r.forEach((s,u)=>{const h=r[u+1];if(!h)return;new Jk(s,h,e.width).draw()}),n.updateDisplay()}}regist_data(){return{filename:"drawWall.json",name:"drawWall",description:"根据坐标点合集绘制墙",params:[{name:"points",description:"绘制墙的坐标点",type:"str",required:!0},{name:"width",description:"绘制墙的宽度",type:"float",required:!1},...ka]}}}class $k{call(e){return Gt(this,null,function*(){let n=p.MxCpp.App.getCurrentMxCAD();if(e.name){const s=n.getDatabase().getBlockTable().get(e.name);if(!s||!s.isValid())return;let u=new p.McDbBlockReference;u.blockTableRecordId=s;let h=u.getBoundingBox(),o=0;if(h.ret){let m=h.maxPt.distanceTo(h.minPt);m>1e-5&&(o=n.getMxDrawObject().screenCoordLong2Doc(100)/m,u.setScale(o))}u.position=new p.McGePoint3d(e.pos[0],e.pos[1]),n.drawEntity(u),n.updateDisplay()}})}regist_data(){return{filename:"insertBock.json",name:"insertBock",description:"放置插入某个物品",params:[{name:"name",description:"要放置插入的物品名称",type:"str",required:!0},{name:"pos",description:"要放置插入物品的位置",type:"tuple[float, float]",required:!0}]}}}function t5(){Lo.regist(Qk),Lo.regist($k)}class e5{call(e){return Gt(this,null,function*(){let n=p.MxCpp.getCurrentMxCAD();console.log(e),n.newFile();let r;const s=typeof e.isMText=="undefined"?!1:e.isMText,u=()=>{const o=new p.McDbMText;return o.textHeight=e.textSize||100,o.location=e.textPos||new p.McGePoint3d,o.contents=e.textString||"",o},h=()=>{const o=new p.McDbText;return o.height=e.textSize||100,o.textString=e.textString||"",o.position=e.textPos||new p.McGePoint3d,o};if(!e.textString){const o=new p.MxCADUiPrString;o.setMessage("请输入文字");const m=yield o.go();if(!m)return;e.textString=m}if(e.textPos)e.textPos=xr(e.textPos);else{const o=new p.MxCADUiPrPoint;o.clearLastInputPoint(),o.setMessage("请指定文字位置");const m=yield o.go();if(o.setUserDraw((y,x)=>{if(e.textPos=y,s){const M=u();x.drawMcDbEntity(M)}else{const M=h();x.drawMcDbEntity(M)}}),!m)return;e.textPos=m}if(!e.textSize){const o=new p.MxCADUiPrPoint;o.clearLastInputPoint(),o.setMessage("通过线段长度确定文字高度");const m=yield o.go();if(m){o.setUserDraw((x,M)=>{if(e.textSize=m.distanceTo(x),s){const A=u();M.drawMcDbEntity(A)}else{const A=h();M.drawMcDbEntity(A)}});const y=yield o.go();y&&(e.textSize=y.distanceTo(m))}}if(s){const o=u();r=n.drawEntity(o)}else{const o=h();r=n.drawEntity(o)}Ba(r.getMcDbEntity(),e),n.updateDisplay()})}regist_data(){return{filename:"drawText.json",name:"draw_text",description:"绘制或者插入文字或者多行文字(文本)",params:[{name:"isMText",description:"绘制的文字是否为多行文字",type:"boolean",required:!0},{name:"textString",description:"绘制的文字的内容",type:"str",required:!0},{name:"textPos",description:"绘制的文字的位置",type:"tuple[float, float]",required:!0},{name:"textSize",description:"绘制的文字的高度",type:"float",required:!0},...ka]}}}function n5(){Lo.regist(e5)}class i5{call(e){if(console.log(e),e.isWithdraw){typeof e.withdrawNum!="number"&&(e.withdrawNum=1);for(let n=0;n<e.withdrawNum;n++)$.MxFun.sendStringToExecute("Mx_Undo")}if(e.isRestore){typeof e.restoreNum!="number"&&(e.restoreNum=1);for(let n=0;n<e.restoreNum;n++)$.MxFun.sendStringToExecute("Mx_Redo")}}regist_data(){return{filename:"call_withdraw_restore.json",name:"call_withdraw_restore",description:"撤回撤销和恢复",params:[{name:"isWithdraw",description:"是否要撤回或撤销",type:"boolean",required:!0},{name:"isRestore",description:"是否要恢复",type:"boolean",required:!0},{name:"withdrawNum",description:"撤回撤销(上)几步",type:"int",required:!1},{name:"restoreNum",description:"恢复(前)几步",type:"int",required:!1}]}}}function r5(){Lo.regist(i5)}class o5{constructor(){this.aryRegData=[]}regist(e){let n=new e,r=n.regist_data();p.MxCpp.Ai.addFunction(r.name,n.call),this.aryRegData.push(r)}regist_server(e){this.aryRegData.forEach(n=>{n.operation_code=e,p.MxCpp.Ai.registTool(n)}),p.MxCpp.Ai.reloadTools({operation_code:e})}}let Lo=new o5;function s5(){return Gt(this,null,function*(){let t=new p.MxCADUiPrString;t.setMessage(`
 human:`);let e=yield t.go();e&&p.MxCpp.Ai.chat_tool(e)})}function a5(){return Gt(this,null,function*(){let t=new p.MxCADUiPrString;t.setMessage(`
 输入 server_operate_code:`);let e=yield t.go();e&&Lo.regist_server(e)})}function l5(){$.MxFun.addCommand("Mx_Ai",s5),$.MxFun.addCommand("Mx_AiRegistServer",a5),zk(),Uk(),Gk(),Hk(),Zk(),t5(),n5(),r5(),Yk()}function c5(t,e){let n=40,r=new p.MxCADResbuf;r.AddString("电杆层",0),r.AddString("INSERT",5020);let s=new p.MxCADSelectionSet;s.crossingSelect(t.x-n,t.y-n,t.x+n,t.y+n,r);let u=[];if(s.forEach(h=>{let o=h.getMcDbEntity();if(o){let m=o;e[m.getObjectID().id]&&u.push({dist:m.position.distanceTo(t),blk:e[m.getObjectID().id]})}}),u.length!=0)return u.sort((h,o)=>h.dist-o.dist),u[0].dist<n?u[0].blk:!1}function u5(t,e,n){let r=e[t],s=r.ref,u=40,h=new p.MxCADResbuf;h.AddString("0",0),h.AddString("LINE",5020);let o=new p.MxCADSelectionSet;o.crossingSelect(s.position.x-u,s.position.y-u,s.position.x+u,s.position.y+u,h),o.forEach(m=>{let y=m.getMcDbEntity();if(y){let x=y,M=x.endPoint,A=x.startPoint.distanceTo(s.position);if(A>x.endPoint.distanceTo(s.position)&&(A=x.endPoint.distanceTo(s.position),M=x.startPoint),A<u&&!x[x.getObjectID().id]){let T=c5(M,e);T&&(n[x.getObjectID().id]={tag1:r.tag,tag2:T.tag,handle:x.getHandle()})}}})}function h5(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet,e=new p.MxCADResbuf;e.AddString("电杆层",0),e.AddString("INSERT",5020),t.allSelect(e);let n={};t.forEach(s=>{let u=s.getMcDbEntity();if(u){let h=u,o=h.getAllAttribute(),m={};o.forEach(y=>{let x=y.getMcDbEntity();x.tag=="杆号"&&(m.tag=x.textString)}),m.tag&&(m.handle=h.getHandle(),n[s.id]={ref:h,tag:m.tag},console.log(m))}});let r={};Object.keys(n).forEach(s=>{u5(s,n,r)}),Object.keys(r).forEach(s=>{console.log(r[s])})})}function d5(){$.MxFun.addCommand("MxTest_UserGetData",h5)}class Fa extends p.McDbCustomEntity{constructor(e){super(e),this.pt1=new p.McGePoint3d,this.pt2=new p.McGePoint3d,this._text="",this._textsize=10}create(e){return new Fa(e)}getTypeName(){return"McDbLineText"}set text(e){this._text=e}get text(){return this._text}set textsize(e){this._textsize=e}get textsize(){return this._textsize}dwgInFields(e){return this.pt1=e.readPoint("pt1").val,this.pt2=e.readPoint("pt2").val,this._text=e.readString("text").val,this._textsize=e.readDouble("textsize").val,!0}dwgOutFields(e){return e.writePoint("pt1",this.pt1),e.writePoint("pt2",this.pt2),e.writeString("text",this._text),e.writeDouble("textsize",this._textsize),!0}fineLink(e){let n={},r=this.getObjectID(),s=this._textsize*.5,u=new p.MxCADResbuf;u.AddString("CUSTOMENTITY",5020);let h=new p.MxCADSelectionSet;return h.crossingSelect(e.x-s,e.y-s,e.x+s,e.y+s,u),h.forEach(o=>{if(o==r)return;let m=o.getMcDbEntity();if(m&&m instanceof Fa){let y=m,x=y.getPoint1(),M=0,A=y.getPoint1().distanceTo(e);A>y.getPoint2().distanceTo(e)&&(A=y.getPoint2().distanceTo(e),x=y.getPoint2(),M=1),A<s&&(n[o.id]={link_point:x,link_pos:M})}}),n}moveGripPointsAt(e,n,r,s){this.assertWrite();let u=this.pt1.clone(),h=u;if(e==0?(this.pt1.x+=n,this.pt1.y+=r,this.pt1.z+=s,h=this.pt1):e==1&&(u=this.pt2.clone(),this.pt2.x+=n,this.pt2.y+=r,this.pt2.z+=s,h=this.pt2),this.getObjectID().isValid()){let o=this.fineLink(u);Object.keys(o).forEach(m=>{let x=new p.McObjectId(m).getMcDbEntity();o[m].link_pos==0?x.setPoint1(h):x.setPoint2(h)})}}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.pt1),e.append(this.pt2),e}worldDraw(e){let n=this._textsize*.4,r=this.pt2.sub(this.pt1);r.normalize().mult(n);let s=new p.McDbLine(this.pt1.clone().addvec(r),this.pt2.clone().subvec(r));e.drawEntity(s);let u=this.pt2.sub(this.pt1).mult(.5),h=this.pt1.clone().addvec(u);u.dotProduct(p.McGeVector3d.kXAxis)<0&&u.negate();let o=u.angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis),m=this._text;m.length==0&&(m=this.pt1.distanceTo(this.pt2).toFixed(2)),u.perpVector(),u.dotProduct(p.McGeVector3d.kYAxis)<0&&u.negate(),u.normalize().mult(this._textsize*.2);let y=new p.McDbText;y.textString=m,y.position=h.clone().addvec(u),y.alignmentPoint=h.clone().addvec(u),y.rotation=o,y.verticalMode=p.McDb.TextVertMode.kTextBottom,y.horizontalMode=p.McDb.TextHorzMode.kTextCenter,y.height=this._textsize,e.drawEntity(y);let x=new p.McDbCircle;x.center=this.pt1,x.radius=n,e.drawEntity(x);let M=new p.McDbCircle;M.center=this.pt2,M.radius=n,e.drawEntity(M)}setPoint1(e){this.assertWrite(),this.pt1=e.clone()}setPoint2(e){this.assertWrite(),this.pt2=e.clone()}getPoint1(){return this.pt1}getPoint2(){return this.pt2}}function p5(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();t.newFile();let e=new p.McGePoint3d(100,100,0),n=new p.McGePoint3d(200,150,0),r=new p.McGePoint3d(400,50,0),s=new p.McGePoint3d(600,60,0),u=new p.McGePoint3d(200,300,0),h=5,o=new Fa;o.setPoint1(e),o.setPoint2(n),o.textsize=h,o.text="xxxx",t.drawEntity(o);let m=new Fa;m.setPoint1(n),m.setPoint2(r),m.textsize=h,t.drawEntity(m);let y=new Fa;y.setPoint1(r),y.setPoint2(s),y.textsize=h,t.drawEntity(y);let x=new Fa;x.setPoint1(n),x.setPoint2(u),x.textsize=h,t.drawEntity(x),t.zoomW(new p.McGePoint3d(-300,-300,0),new p.McGePoint3d(650,500,0)),t.updateDisplay()})}function f5(){$.MxFun.addCommand("MxTest_LineText",p5),new Fa().rxInit()}function m5(){d5(),f5()}class Qd extends p.McDbCustomEntity{create(e){throw new Error("Method not implemented.")}getTypeName(){throw new Error("Method not implemented.")}dwgInFields(e){throw new Error("Method not implemented.")}dwgOutFields(e){throw new Error("Method not implemented.")}worldDraw(e){throw new Error("Method not implemented.")}}class $d extends Qd{constructor(e){super(e),this.pt=new p.McGePoint3d}create(e){return new $d(e)}getTypeName(){return"McDbGisPoint"}dwgInFields(e){return this.pt=e.readPoint("pt").val,!0}dwgOutFields(e){return e.writePoint("pt",this.pt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e==0&&(this.pt.x+=n,this.pt.y+=r,this.pt.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.pt),e}worldDraw(e){e.drawEntity(new p.McDbPoint(this.pt))}setPoint(e){this.assertWrite(),this.pt=e.clone()}getPoint(){return this.pt}}class tp extends Qd{constructor(e){super(e),this.pts=[]}create(e){return new tp(e)}getTypeName(){return"McDbGisMultiPoint"}dwgInFields(e){return this.pts=e.readPoints("pts").val,!0}dwgOutFields(e){return e.writePoints("pts",this.pts),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e>=0&&e<this.pts.length&&(this.pts[e].x+=n,this.pts[e].y+=r,this.pts[e].z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return this.pts.forEach(n=>{e.append(n)}),e}worldDraw(e){this.pts.forEach(n=>{e.drawEntity(new p.McDbPoint(n))})}setPoint(e,n){this.assertWrite(),e>=0&&e<this.pts.length&&(this.pts[e]=n.clone())}getPoint(e){return e>=0&&e<this.pts.length?this.pts[e]:new p.McGePoint3d}addPoint(e){this.pts.push(e.clone())}removeAllPoint(){this.pts=[]}getPointCount(){return this.pts.length}}class ep extends Qd{constructor(e){super(e),this.pts=[]}create(e){return new ep(e)}getTypeName(){return"McDbGisLineString"}dwgInFields(e){return this.pts=e.readPoints("pts").val,!0}dwgOutFields(e){return e.writePoints("pts",this.pts),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e>=0&&e<this.pts.length&&(this.pts[e].x+=n,this.pts[e].y+=r,this.pts[e].z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return this.pts.forEach(n=>{e.append(n)}),e}worldDraw(e){let n=new p.McDbPolyline;this.pts.forEach(r=>{n.addVertexAt(r)}),e.drawEntity(n)}setPoint(e,n){this.assertWrite(),e>=0&&e<this.pts.length&&(this.pts[e]=n.clone())}getPoint(e){return e>=0&&e<this.pts.length?this.pts[e]:new p.McGePoint3d}addPoint(e){this.pts.push(e.clone())}removeAllPoint(){this.pts=[]}getPointCount(){return this.pts.length}}class np extends Qd{constructor(e){super(e),this.ptss=[]}create(e){return new np(e)}getTypeName(){return"McDbGisMultiLineString"}dwgInFields(e){this.ptss=[];let n=e.readLong("ptss_n");for(let r=0;r<n.val;r++){let s=e.readPoints("ptss_"+r);s.ret&&this.ptss.push(s.val)}return!0}dwgOutFields(e){return e.writeLong("ptss_n",this.ptss.length),this.ptss.forEach((n,r)=>{e.writePoints("ptss_"+r,n)}),!0}moveGripPointsAt(e,n,r,s){this.assertWrite();let u=0;for(let h=0;h<this.ptss.length;h++){let o=this.ptss[h];for(let m=0;m<o.length;m++){if(u==e){this.ptss[h][m].x+=n,this.ptss[h][m].y+=r,this.ptss[h][m].z+=s,h=this.ptss.length;break}u++}}}getGripPoints(){let e=new p.McGePoint3dArray;return this.ptss.forEach(n=>{n.forEach(r=>{e.append(r)})}),e}worldDraw(e){for(let n=0;n<this.ptss.length;n++){let r=this.ptss[n],s=new p.McDbPolyline;r.forEach(u=>{s.addVertexAt(u)}),e.drawEntity(s)}}addPoints(e){this.ptss.push(e)}removeAllPoint(){this.ptss=[]}getPointsCount(){return this.ptss.length}getPoints(e){return e>=0&&e<this.ptss.length?this.ptss[e]:[]}}class ip extends Qd{constructor(e){super(e),this.ptss=[]}create(e){return new ip(e)}getTypeName(){return"McDbGisPolygon"}dwgInFields(e){this.ptss=[];let n=e.readLong("ptss_n");for(let r=0;r<n.val;r++){let s=e.readPoints("ptss_"+r);s.ret&&this.ptss.push(s.val)}return!0}dwgOutFields(e){return e.writeLong("ptss_n",this.ptss.length),this.ptss.forEach((n,r)=>{e.writePoints("ptss_"+r,n)}),!0}moveGripPointsAt(e,n,r,s){this.assertWrite();let u=0;for(let h=0;h<this.ptss.length;h++){let o=this.ptss[h];for(let m=0;m<o.length;m++){if(u==e){this.ptss[h][m].x+=n,this.ptss[h][m].y+=r,this.ptss[h][m].z+=s,h=this.ptss.length;break}u++}}}getGripPoints(){let e=new p.McGePoint3dArray;return this.ptss.forEach(n=>{n.forEach(r=>{e.append(r)})}),e}worldDraw(e){let n=new p.McDbHatch;for(let r=0;r<this.ptss.length;r++){let s=this.ptss[r];s.length>2&&n.appendLoop(new p.McGePoint3dArray(s))}n.numLoops>0&&e.drawEntity(n)}addPoints(e){this.ptss.push(e)}removeAllPoint(){this.ptss=[]}getPointsCount(){return this.ptss.length}getPoints(e){return e>=0&&e<this.ptss.length?this.ptss[e]:[]}}function g5(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage("点取一个点坐标");let n=yield e.go();if(n){let r=new $d;r.setPoint(n),t.drawEntity(r)}})}function y5(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage("点取一个点坐标");let n=new tp,r=[];for(;;){e.clearLastInputPoint(),e.setDynamicInputType($.DynamicInputType.kXYCoordInput);let s=yield e.go();if(s){n.addPoint(s);let u=new p.McDbPoint(s);r.push(t.drawEntity(u))}else break}n.getPointCount()>0&&t.drawEntity(n),r.forEach(s=>{s.erase()})})}function x5(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage("点取一个点坐标");let n=new ep,r=[],s;for(;;){s&&(e.setBasePt(s),e.setUseBasePt(!0)),e.setDynamicInputType($.DynamicInputType.kXYCoordInput);let u=yield e.go();if(u){if(n.addPoint(u),s){let h=new p.McDbLine;h.startPoint=s,h.endPoint=u,r.push(t.drawEntity(h))}s=u}else break}n.getPointCount()>1&&t.drawEntity(n),r.forEach(u=>{u.erase()})})}function v5(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage("点取一个点坐标"),e.setKeyWords("[下一段线(N)]");let n=new np,r=[],s=[],u;for(;;){u?e.setBasePt(u):e.setUseBasePt(!1),e.setDynamicInputType($.DynamicInputType.kXYCoordInput);let h=yield e.go();if(e.isKeyWordPicked("N"))r.length>1&&n.addPoints(r),r=[],u=void 0;else if(h){if(r.push(h),u){let o=new p.McDbLine;o.startPoint=u,o.endPoint=h,s.push(t.drawEntity(o))}u=h}else break}r.length>1&&n.addPoints(r),n.getPointsCount()>0&&t.drawEntity(n),s.forEach(h=>{h.erase()})})}function _5(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage("点取一个点坐标");let n=new ip,r=[],s=[],u;for(;;){u?e.setBasePt(u):e.setUseBasePt(!1),r.length>2&&e.setKeyWords("[闭合(C)/退出(E)]"),e.setDynamicInputType($.DynamicInputType.kXYCoordInput);let h=yield e.go();if(e.isKeyWordPicked("C")){let o=new p.McDbLine;o.startPoint=r[0],o.endPoint=r[r.length-1],s.push(t.drawEntity(o)),r.length>2&&n.addPoints(r),r=[],u=void 0}else{if(e.isKeyWordPicked("E"))break;if(h){if(r.push(h),u){let o=new p.McDbLine;o.startPoint=u,o.endPoint=h,s.push(t.drawEntity(o))}u=h}else break}}r.length>2&&n.addPoints(r),n.getPointsCount()>0&&t.drawEntity(n),s.forEach(h=>{h.erase()})})}function b5(){let t=new p.MxCADSelectionSet,e=new p.MxCADResbuf;e.AddMcDbEntityTypes("McDbCustomEntity"),t.allSelect(e);let n={type:"FeatureCollection",features:[]};t.forEach(r=>{let s=r.getMcDbEntity();if(s){if(s instanceof $d){let h=s.getPoint(),o={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[h.x,h.y,h.z]}};n.features.push(o)}else if(s instanceof tp){let u=s,h=[],o=u.getPointCount();for(let y=0;y<o;y++){let x=u.getPoint(y);h.push([x.x,x.y,x.z])}let m={type:"Feature",properties:{},geometry:{type:"MultiPoint",coordinates:h}};n.features.push(m)}else if(s instanceof ep){let u=s,h=[],o=u.getPointCount();for(let y=0;y<o;y++){let x=u.getPoint(y);h.push([x.x,x.y,x.z])}let m={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:h}};n.features.push(m)}else if(s instanceof np){let u=s,h=[],o=u.getPointsCount();for(let y=0;y<o;y++){let x=u.getPoints(y),M=[];for(let A=0;A<x.length;A++){let T=x[A];M.push([T.x,T.y,T.z])}h.push(M)}let m={type:"Feature",properties:{},geometry:{type:"MultiLineString",coordinates:h}};n.features.push(m)}else if(s instanceof ip){let u=s,h=[],o=u.getPointsCount();for(let y=0;y<o;y++){let x=u.getPoints(y),M=[];for(let A=0;A<x.length;A++){let T=x[A];M.push([T.x,T.y,T.z])}h.push(M)}let m={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:h}};n.features.push(m)}}}),console.log(JSON.stringify(n))}function M5(){$.MxFun.addCommand("MxGis_DrawPoint",g5),$.MxFun.addCommand("MxGis_DrawMultiPoint",y5),$.MxFun.addCommand("MxGis_DrawLineString",x5),$.MxFun.addCommand("MxGis_DrawMultiLineString",v5),$.MxFun.addCommand("MxGis_DrawPolygon",_5),$.MxFun.addCommand("MxGis_Get_geojson",b5),new $d().rxInit(),new tp().rxInit(),new ep().rxInit(),new np().rxInit(),new ip().rxInit()}const Ho=b.ref("");b.reactive([]);const za=b.ref(300),w5=b.reactive(["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAAJdJREFUSEvdlsESwBAMRMX/f7N2HJhOJVmh0ZYr9nlUiojoCAsbbQdMKYUYY91DV8M7LFP3AXJ2boYSbA+gZudiuBSIYI8a9sD+C+y1awzzxNF2rZdaRlPaLKvNwdbx7wMtq7baqV8pCkP90jmKvycUiPrNQG1rR2Hw4kvBbkDOcgYGDcs5FMgs7LtAy91EpdH11cbBlwNPJSqCVTTcHlQAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAALNJREFUSEvdlksOgCAMBS33PzOaLjCkPvoBIYpLhE6m0AIR0Xks/Gg7YM75SCndOZxqKGFM3QeI7KYZtmB7ADW7KYZLgRbsVUMP7L9Ar93DEC3kMfnVvZH/dQPl4lagejwCg3tYAliBvPNkdmDzLmmUqasXe+age715W3gNo4+F7wC102fZa9bqBYxKogTT9rcbiCxH7NytrbcEQqdUlgCncNTObRhtX0N7GK0za/7UZyKCX603kVXE3zhDAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAAJdJREFUSEvd1kEOgCAMBEDK/99cDQeMEcqyYlHxiu24KIKIyBYmXrIcqKohxnjMoWvCK5bUdcBaOreEFrYG2ErnknAqiLBHE/Zg/wV70xUJmcLzBsPUFb82pjih7P3vg8xTs+maXylqhsatQ4S5PaGGaJwGW1N7F4ML32rsBtZSjmAwYX4PGRnFvgsyaxOdqV1PbTV8OrgD32GFVQtEr98AAAAASUVORK5CYII="]),b1=()=>{const t=p.MxCpp.getCurrentMxCAD(),{pt1:e,pt3:n}=t.getViewCADCoord(),r=n.sub(e).normalize(),s=n.clone().addvec(r.clone().mult(1e3)),u=n.clone().addvec(r.clone().mult(2e3)),h=s.clone().addvec(u.sub(s).mult(.5));let o=new p.McDbWipeout;o.setVertices(new p.McGePoint3dArray([s,new p.McGePoint3d(s.x,u.y),u,new p.McGePoint3d(u.x,s.y)])),o=t.drawEntity(o).getMcDbObject();let y=p.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder().maxDrawOrder+1;return o.drawOrder=y,{wipeout:o,midPt:h}},Wo=b.ref(),_o=MxPluginContext.useDialogIsShow();var ui=(t=>(t.Straightness="u",t.Flatness="c",t.Roundness="e",t.Cylindricity="g",t.LineContourdegree="k",t.SurfaceContourDegree="d",t.Parallelism="f",t.Perpendicularity="b",t.TiltDegree="a",t.PositionalDegree="j",t.Coaxiality="r",t.SymmetryDegree="i",t.CircleJumping="h",t.FullBeat="t",t.None="",t))(ui||{});class rp extends p.McDbCustomEntity{constructor(e){super(e),this.startPoint=new p.McGePoint3d,this.turningPoint=new p.McGePoint3d,this.dimPoint=new p.McGePoint3d,this.endPoint=new p.McGePoint3d,this.size=4,this.isShowFull=!1,this.toleranceContents=[],this.notesUp="",this.notesDown="",this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new rp(e)}getTypeName(){return"MxDbGeometricTolerances"}set dimSize(e){this.size=e}get dimSize(){return this.size}set isShowFullWeekSymbol(e){this.isShowFull=e}get isShowFullWeekSymbol(){return this.isShowFull}set dimToleranceContents(e){this.toleranceContents=e}get dimToleranceContents(){return this.toleranceContents}set dimNotesUp(e){this.notesUp=e}get dimNotesUp(){return this.notesUp}set dimNotesDown(e){this.notesDown=e}get dimNotesDown(){return this.notesDown}dwgInFields(e){return this.startPoint=e.readPoint("startPoint").val,this.turningPoint=e.readPoint("turningPoint").val,this.dimPoint=e.readPoint("dimPoint").val,this.endPoint=e.readPoint("endPoint").val,this.size=e.readDouble("size").val,this.isShowFull=!!e.readLong("isShowFull").val,this.notesUp=e.readString("notesUp").val,this.notesDown=e.readString("notesDown").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,this.toleranceContents=JSON.parse(e.readString("toleranceContents").val),!0}dwgOutFields(e){return e.writePoint("startPoint",this.startPoint),e.writePoint("turningPoint",this.turningPoint),e.writePoint("dimPoint",this.dimPoint),e.writePoint("endPoint",this.endPoint),e.writeDouble("size",this.size),e.writeLong("isShowFull",this.isShowFull?1:0),e.writeString("notesUp",this.notesUp),e.writeString("notesDown",this.notesDown),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),e.writeString("toleranceContents",JSON.stringify(this.toleranceContents)),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.startPoint.x+=n,this.startPoint.y+=r,this.startPoint.z+=s):e===1?(this.turningPoint.x+=n,this.turningPoint.y+=r,this.turningPoint.z+=s):e===2?(this.dimPoint.x+=n,this.dimPoint.y+=r,this.dimPoint.z+=s,this.endPoint.x+=n,this.endPoint.y+=r,this.endPoint.z+=s):e===3&&(this.endPoint.x+=n,this.endPoint.y+=r,this.endPoint.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.startPoint),e.append(this.turningPoint),e.append(this.dimPoint),e.append(this.endPoint),e}drawArrow(){const e=this.startPoint,n=this.turningPoint,r=this.size,s=n.sub(e).normalize().mult(r),u=e.clone().addvec(s),h=s.clone().rotateBy(Math.PI/2).normalize().mult(r/8),o=u.clone().addvec(h),m=u.clone().subvec(h),y=new p.McDbHatch;y.appendLoop(new p.McGePoint3dArray([e,o,m]));const x=[this.startPoint,this.turningPoint,this.dimPoint,this.endPoint],M=new p.McDbPolyline;return x.forEach(A=>M.addVertexAt(A)),[y,M]}worldDraw(e){const n=p.MxCpp.getCurrentMxCAD();["cxgdtshp","cxgdt"].forEach(h=>{n.getDatabase().getTextStyleTable().has(h)||p.MxCpp.App.loadFonts([`${h}.shx`],[],[`${h}.shx`],()=>{n.addTextStyle(h,`${h}.shx`,`${h}.shx`)})});const{MText:s,allEntityArr:u}=this.getAllEnitty();s.forEach(h=>{h.worldDraw(e)}),u.forEach(h=>{e.drawEntity(h)})}getAllEnitty(){const e=[],n=this.drawArrow();e.push(...n);const r=["k","d"];if(this.toleranceContents.length===1&&r.includes(this.toleranceContents[0].toleranceCode)&&this.isShowFull){const D=new p.McDbCircle(this.dimPoint.x,this.dimPoint.y,0,this.size*.4375);e.push(D)}const s=this.size*(7/4),u=p.McGeVector3d.kYAxis.clone().mult(s*(this.toleranceContents.length/2)),h=this.endPoint.clone().addvec(u),o=this.endPoint.clone().addvec(u.clone().negate());e.push(...this.drawCode(h.clone(),o.clone(),s));const m=p.McGeVector3d.kXAxis.clone().mult(s),{MText:y,entityArr:x,max_x:M}=this.drawToleranceContents(h.clone().addvec(m),o.clone().addvec(m),s);e.push(...x);const{MText:A,entityArr:T}=this.drawBenchmark(new p.McGePoint3d(M,h.y),new p.McGePoint3d(M,o.y),s);return e.push(...T),y.push(...A),[this.notesUp,this.notesDown].forEach((D,k)=>{const z=new p.McDbMText;z.contents=D,z.textHeight=this.size*(3/4),z.location=k==0?h.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size)):o.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate()),e.push(z)}),{allEntityArr:e,MText:y}}drawCode(e,n,r){const s=[],u=new p.McDbPolyline;u.isClosed=!0;const h=p.McGeVector3d.kXAxis.clone().mult(r);[n,e,e.clone().addvec(h),n.clone().addvec(h)].forEach(A=>u.addVertexAt(A)),s.push(u);const m=A=>{const T=[];let P=0;for(;P<A.length;){let D=P+1;for(;D<A.length&&A[D]===A[P];)D++;T.push({value:A[P],count:D-P}),P=D}return T},y=this.toleranceContents.map(A=>A.toleranceCode),x=m(y),M=p.McGeVector3d.kXAxis.clone().mult(r);return x.forEach(A=>{const T=new p.McDbMText;T.textHeight=this.size*(3/4),T.contents=A.value,T.attachment=p.McDb.AttachmentPoint.kBottomMid;const P=n.sub(e).normalize().mult(r*A.count),D=e.clone().addvec(P.clone().mult(1/2)).addvec(M.clone().mult(1/2));T.location=D,T.textStyle="cxgdt",e.addvec(P),s.push(T),T.reCompute();const{maxPt:k,minPt:z}=p.MxCADUtility.getTextEntityBox(T,!1);z.distanceTo(k)>T.textHeight*3&&k.addvec(p.McGeVector3d.kXAxis.clone().negate().mult(T.textHeight*(7/4)));const O=z.clone().addvec(k.sub(z).mult(1/2));T.move(O,D);const U=new p.McDbLine(e,e.clone().addvec(M));s.push(U)}),s}drawToleranceContents(e,n,r){const s=[],u=[],h=p.MxCpp.getCurrentMxCAD();let o=e.x;const m=p.McGeVector3d.kXAxis.clone().mult(this.size/4),y=p.McGeVector3d.kYAxis.clone().mult(r).negate();return this.toleranceContents.forEach((x,M)=>{const A=e.clone(),T=n.clone();if(x.tolerance.length){A.addvec(m).addvec(y.clone().mult(M));const P=p.McGeVector3d.kYAxis.clone().mult(r/2-this.size*(3/8)).negate();x.tolerance.forEach((D,k)=>{if(k===4||k===3&&(D==="{"||D==="@")){const z=new p.MxCADMText;z.data=[{type:"paragraph",children:[{text:D,font:"cxgdtshp.shx"}]}],z.position=A.clone().addvec(P),z.textBaseHeight=this.size*(3/4),u.push(z);const O=p.McGeVector3d.kXAxis.clone().mult(this.size),U=z.position.clone().addvec(O);A.x=T.x=U.x}else{const z=new p.McDbMText;z.contents=D,z.location=A.clone().addvec(P),z.textHeight=this.size*(3/4),k==2||k==4?z.textStyle="cxgdtshp":k==3&&D!=="{"?z.textStyle="cxgdt":z.textStyleId=h.getDatabase().getCurrentlyTextStyleId(),z.reCompute();const{maxPt:O,minPt:U}=p.MxCADUtility.getTextEntityBox(z,!1);A.x=T.x=O.x,s.push(z)}})}A.x>o&&(o=A.x)}),o>e.x&&(this.toleranceContents.forEach((x,M)=>{const A=new p.McDbPolyline,T=new p.McGePoint3d(o,e.y),P=new p.McGePoint3d(o,n.y);if([e,T.clone().addvec(m),P.clone().addvec(m)].forEach(k=>A.addVertexAt(k)),s.push(A),e.addvec(y),M===this.toleranceContents.length-1){const k=new p.McDbLine(P.clone().addvec(m),n);s.push(k)}}),o=new p.McGePoint3d(o,e.y).addvec(m).x),{entityArr:s,MText:u,max_x:o}}drawBenchmark(e,n,r){const s=p.MxCpp.getCurrentMxCAD(),u=p.McGeVector3d.kYAxis.clone().mult(r/2-this.size*(3/8)).negate(),h=p.McGeVector3d.kYAxis.clone().mult(r).negate(),o=p.McGeVector3d.kXAxis.clone().mult(this.size/4);let m=e.x;const y=[],x=[],M=(k,z)=>{const O=[];let U=z.clone();return z.addvec(o),k.length===2&&k.filter(H=>H.length!=0).length===2&&k.splice(1,0,["-"]),k.forEach((H,V)=>{H.length&&H.forEach((W,K)=>{if(K===1&&W==="{"){const Z=new p.MxCADMText;Z.data=[{type:"paragraph",children:[{text:W,font:"cxgdtshp.shx"}]}],Z.position=z.clone().addvec(u),Z.textBaseHeight=this.size*(3/4),x.push(Z);const tt=p.McGeVector3d.kXAxis.clone().mult(this.size),at=Z.position.clone().addvec(tt);z.x=U.x=at.x}else{const Z=new p.McDbMText;Z.contents=W,Z.location=z.clone().addvec(u),Z.textHeight=this.size*(3/4),K==1?Z.textStyle="CXGDT":Z.textStyleId=s.getDatabase().getCurrentlyTextStyleId(),Z.reCompute();const{maxPt:tt,minPt:at}=p.MxCADUtility.getTextEntityBox(Z,!1);m<tt.x&&(m=tt.x),U.x=tt.x,O.push(Z),z.x=tt.x}})}),m<U.x&&(m=U.x),O},A=[],T=[],P=["b1","b2","b3"];let D=e.x;if(P.forEach((k,z)=>{z!=0&&y.length&&(D=Math.max(...y),T.push(D)),y.length=0,this.toleranceContents.forEach((O,U)=>{var H;if((H=O.Benchmark[k])!=null&&H.length&&O.Benchmark[k].filter(V=>V.length).length>0){const V=new p.McGePoint3d(D,e.clone().addvec(h.clone().mult(U)).y);A.push(...M(O.Benchmark[k],V));const W=new p.McGePoint3d(m,e.y);W.addvec(o),m=W.x,y.push(m)}})}),A.length>0){T.forEach(O=>{const U=new p.McDbLine(new p.McGePoint3d(O,e.y),new p.McGePoint3d(O,n.y));A.push(U)});const k=new p.McDbLine(new p.McGePoint3d(m,e.y),new p.McGePoint3d(m,n.y)),z=new p.McDbLine(n,new p.McGePoint3d(m,n.y));A.push(k,z),this.toleranceContents.forEach((O,U)=>{U!=0&&e.addvec(h.clone());const H=new p.McDbLine(e,new p.McGePoint3d(m,e.y));A.push(H)})}return{entityArr:A,MText:x}}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbMText){const x=n.getDatabase().getCurrentlyTextStyleId();h.textStyleId=x,h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setStartPoint(e){this.startPoint=this.turningPoint=this.endPoint=this.dimPoint=e.clone()}getStartPoint(){return this.startPoint}setTurningPoint(e){this.turningPoint=this.endPoint=this.dimPoint=e.clone()}getTurningPoint(){return this.turningPoint}setEndPoint(e){this.endPoint=e.clone()}getEndPoint(){return this.endPoint}getDimPoint(){return this.dimPoint}setDimPoint(e){this.dimPoint=this.endPoint=e.clone()}getBoundingBox(){const{allEntityArr:e}=this.getAllEnitty();return this.getBox(e),{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function A5(){return Gt(this,null,function*(){Ho.value="GemoetricToleranceDialog",_o.showDialog(!0,{title:G("形位公差")}).then(n=>Gt(this,[n],function*({data:t,isCanceled:e}){if(!e){const r=t.formData,s=new rp;s.dimToleranceContents=(r==null?void 0:r.dimToleranceContents)||[],s.isShowFullWeekSymbol=(r==null?void 0:r.isShowFull)||!1,s.dimNotesDown=(r==null?void 0:r.downDim)||"",s.dimNotesUp=(r==null?void 0:r.topDim)||"";const u=new p.MxCADUiPrPoint;u.setMessage("请设置定位点或直线或圆弧或圆");const h=yield u.go();if(!h)return;s.setStartPoint(h);const o=new p.MxCADUiPrPoint;o.setMessage("请设置转折点"),o.setUserDraw((A,T)=>{const P=s.clone();P.setTurningPoint(A),T.drawMcDbEntity(P)});const m=yield o.go();if(!m)return;s.setTurningPoint(m);const y=new p.MxCADUiPrPoint;y.setMessage("拖动确定标注位置"),y.setUserDraw((A,T)=>{const P=s.clone();P.setDimPoint(A),T.drawMcDbEntity(P)});const x=yield y.go();if(x){s.setDimPoint(x);const A=new p.MxCADUiPrPoint;A.setMessage("拖动确定标注位置"),A.setUserDraw((P,D)=>{const k=s.clone();k.setEndPoint(P),D.drawMcDbEntity(k)});const T=yield A.go();T&&s.setEndPoint(T)}p.MxCpp.getCurrentMxCAD().drawEntity(s)}}))})}function E5(){new rp().rxInit(),$.MxFun.addCommand("Mx_Test_DrawGT",A5)}const T5={class:"fcc"},P5={style:{"margin-bottom":"10px"},class:"fcc"},S5=b.defineComponent({__name:"RotateDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=b.reactive({direct:sp.right,lText:"",bText:"",rText:""}),r=b.ref();let s=null;b.onMounted(()=>{za.value=300,u()});const u=()=>Gt(this,null,function*(){let y;s?y=s.getMcDbEntity():y=new _g,y.visible=!0,y.RotateDirect=n.direct,y.leftTextStr=n.lText,y.bottomTextStr=n.bText,y.rightTextStr=n.rText;const x=p.MxCpp.getCurrentMxCAD(),{pt1:M,pt3:A}=x.getViewCADCoord(),T=A.sub(M).normalize(),P=A.clone().addvec(T.clone().mult(1e3)),D=A.clone().addvec(T.clone().mult(2e3)),k=P.clone().addvec(D.sub(P).mult(.5));y.setRotatePos(k);let z=new p.McDbWipeout;z.setVertices(new p.McGePoint3dArray([P,new p.McGePoint3d(P.x,D.y),D,new p.McGePoint3d(D.x,P.y)])),z=x.drawEntity(z).getMcDbObject();let O=p.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder(),U=O.maxDrawOrder+1;z.drawOrder=U,s||(s=x.drawEntity(y),y=s.getMcDbEntity(),e("receiveParameters",{dimHandle:y.getHandle()})),y.drawOrder=O.maxDrawOrder+2;const H=y.getBoundingBox(),V=H.minPt.sub(H.maxPt).normalize().mult(5),W=H.minPt.clone().addvec(V),K=H.maxPt.clone().addvec(V.clone().negate()),Z=yield Kd({type:"image/bmp",width:200,height:80,range_pt1:W.toVector3(),range_pt2:K.toVector3()});r.value.src=Z,z.erase(),y.visible=!1,x.mxdraw.updateCanvasSize()}),h=()=>{n.direct=n.direct===sp.right?sp.left:sp.right,u()},o=m(()=>{u()},300);function m(y,x){let M=null;return function(...A){M&&clearTimeout(M),M=setTimeout(()=>{y.apply(this,A)},x)}}return(y,x)=>(b.openBlock(),b.createElementBlock("div",null,[b.createElementVNode("div",T5,[b.createElementVNode("img",{ref_key:"img",ref:r,style:{margin:"10px 0px",width:"90%"}},null,512)]),b.createElementVNode("div",P5,[b.createVNode(b.unref(on.VBtn),{onClick:h},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(b.unref(G)("改变方向")),1)]),_:1})]),b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.lText,"onUpdate:modelValue":x[0]||(x[0]=M=>n.lText=M),onInput:b.unref(o)},{prepend:b.withCtx(()=>[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("左边文字内容：")),1)]),_:1},8,["modelValue","onInput"]),b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.rText,"onUpdate:modelValue":x[1]||(x[1]=M=>n.rText=M),onInput:b.unref(o)},{prepend:b.withCtx(()=>[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("右边文字内容：")),1)]),_:1},8,["modelValue","onInput"]),b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.bText,"onUpdate:modelValue":x[2]||(x[2]=M=>n.bText=M),onInput:b.unref(o)},{prepend:b.withCtx(()=>[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("底部文字内容：")),1)]),_:1},8,["modelValue","onInput"])]))}}),UO="",C5=zo(S5,[["__scopeId","data-v-a83034f6"],["__file","RotateDialog.vue"]]),D5={style:{"padding-top":"10px"}},R5=["onClick"],L5=["src"],I5=b.defineComponent({__name:"RoundMarkDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=b.reactive([["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAP1JREFUWEftl9EKxCAMBI3//816pGAJou7Gk9I74ksfWnWcqElFRGp6SZOAmUTiiJlSa8oiXwc7YGYK/8NMKeVeYL9bJOet/eM20yCymbAaMEvhhaJhRhBt4hlMe89CUTAKYk30MUAw+j0D9FswyIqumjHD2IFmXgPDgHjMIDtLMwFjj6pmYG8TR5/aZXeb7Y+EiS0hUNgDZruEQGp1YCZMzDhHLr3HYK6Vg0SJYFD/O7szvyposEdhmh19jkqJGcyqBhptYrhn+k6jCXoYL4QrTKNV2Bo46a1qbuFVIba63d1mhmDxEzdxjE4Tm3iPhImdDH0XMNuJEqk9+f4D+0DNahN82WgAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAQZJREFUWEftl20PgyAMhC3//zfTpURMJeAd+BJn8MuMbuXZtVyLiIguL7lkwjQycYkyUXUJIqeTPWFaEn5DGY1x9we9P4QQhuqnW5kSIq8qDiCuoL1QNEwLogaTn/VCUTAIxBb3ypQ5MihGpf+CYVRByth7Rh2ozGtgWBBGGUadQ2UmjN+K1oE373D3yFJ1sGv7bn+YJmYHpFogRwgUb8IMjxBIWjZNTBxoekwQpmaYOBCGMSsEw4Ak42SOKijYozBZHfusjQItmFvmmZ0pVqa4EqYXYjNZJk21rZgXTO/MfZ1bM4NULSZVM6gVoJpBvz+tTNnP5omSlXzke5fUzMjCtxXwJ2F+HwPOahopb8wAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAPtJREFUWEftl+EOwyAIhIvv/8yy0MSVNMqdrmtcZ381qeLHAUJFRHSb5JEF04jEJcpk1S2JfBzsBdOS8BnK5JwPBy1f9LghUkpD+dOtTIHwB54TuLaGoaNhogNa1dQLRcGY0Uh6VNpof1Htt2AYr5Ay5jljByrDGLkFhgHZvSbbAbIXKoM2l8T7Dxjz8l1q7h1dWjrYtX23D8Ok/soHNEK0ABT2BTM8QrChQmFCITJAeOlNBWPEDFCkDKMKpcx0MAxQTZmvzDM++1sh8zC9EF3zTK0Uz1D+H/m2GbgGxjZK1FJgaSMDPSMEsvU8GOQx+/0SZdjD0LoF01LoBeJUzmrUUEc9AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAP5JREFUWEftl8EOhCAMRC3//810UxMiS6AzVWJcFy8ehPI6bWkVEdHtIY8smEEkpiiTVbckcjnYC2Yk4TuUyTkfDlq+6HFDpJRO5U9YmQJRH9gmcG8NQ0fDeAeMqikKRcGYUU96VNpof1Htt2AYr5Ay5jljByrDGLkFhgHZvSbbAbLnKoM2l8T7DxjzMvpIYI823b3u9lPCpHVrAJ6I0yoWzOkRgqkoNkxeiAxwyqV3GwxzlTMwSBVKmcfBFCB790YJpAyjCq1Mnf29gWkEw0KE5pleKdYzcPvHFIW4DPOlFtm1UZuBpY0MREYIZOt9MMhj9vsUZdjD0LoFM1LoA8NFzWpEnyLbAAAAAElFTkSuQmCC"],["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAPNJREFUWEftl9EOxCAIBIv//816sYmGGGFXzwfvQp+atLXjgIgiIuW55JKAMSJxxEwu5UkiXwc7YCyF/2Em59wnOGaLpLSVP8tmGkRSPywKTFOsQtEwM4j2YwumPWehKJgKok2MMUAw9X0G6LdgkJU6a8YMYweauQaGAVkxg+y4ZgJGL9W6A/f6oO63SurkozLs7nq3d8PErhKUC40JhT1gtlsINlSo3KMQvaFGDflVMGxR88wwVigz18EwQDMzXg80S2KYM2zvomFWIXqRRQlsLcMxsfUZ2WvEvEq+bGY2WBziLMVXmTm1ox/JmYA5ZcAa5wMuAbFqpB3bfgAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAPdJREFUWEftl9EOgyAMAC3//82w1IwFG6AH44Et+KJRlPOKbRURSdcmmxyYRiSWmIkpXUHk62AfmJbC/zCTYny8YJkfQghT62fYjIXIs0oBEN+go1AYpgVRg8nnRqEQjAeik5dmbIwUilj6LRhixTOj14kd18w2MBSEmCF2umYOTPkpagX+5I7ieCqlVm5KprqX1b4bJvIF6HyrwnlgplsIEioapl7JuNOD15BvBUOSFTHjWUFmtoPJQLqvtQKeGWIFm3kkxUoXR7o/kjTdBdx6SO7i7jcyg6gJ++xpGFtCzk9cLWxb/d6SxUnGLFkzZCIy5sC0LL0AMqaxakmqNb4AAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAASVJREFUWEftltEOwjAIRaX//82tYRkbmS0XLJpqthcf1O709FIgImqPRR66YQYnkWKmtvYoRNOHfcOMFP6HmVrruUHOSztvCE4PlRLOUNiMQBT1smuA2w4aBXLD9CBk6xpGQLQWL5QLhkG0iat/BMO/9wClwvSsCHgKDLLCLxMzFozHDjSTCYOATBgPiJghVdq9muZjQut9HEZn5Ssw16yMwhqG4TBGHzmi9kbn1t0+7Zg8I0TYjLaC/ty7gS2raL3fMbOVLWgF+tKbsbLdQWggXwrGYwfNwJ4NucwsByNA/NkbJUZmrBmo2zJQZl5ml32Ksya9KMQxZkRhjrvFmIGtQcyqOFhNntaAAuxZwx1gtNgNgwzNfp+SmVmI6WrKAtDrLGXmCfqx7mrfNgvzAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAASBJREFUWEftl+sOgyAMhS3v/8ywVO3WEWpPhaAm8sfEVfh6eqEjIirLTRa9MEYkhiiTS1kSUXewXxhLwucrU3Je/voB50v5vUkpncqfsDIMwovUgXUC590mCgXDCIR2WYCsaopCQTAtEK2OV9oMhajUBSNA02AsVSRcHCoPhm0RdQ6V8UBQZYbAiDceVCGCrgNPnUNl6o8tqEtgdFnXYLrvWB0vrAwnY2TRbs/qnFn6tg+FyfQYHCHCyugDvY/FFiltpKKeowzizWoDhAlR2b0OkE2mwSDqeDCIQ2s3R/6qeJtNhRF1+NkaBabOM3W511DTJ7264ckUt82gF83ArS7s5Qx6TUAJ7G32wngK9f4+JEy9EN95Gml6ow7z9rmVMh/YSO1q8b/D3AAAAABJRU5ErkJggg=="],["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAQRJREFUWEftllkOwyAMRDH3PzNUjoJCUcwMS+kG32Cex6uISHQfcmTDGJGYokyI0XmR4WBvGEvC31AmhHA5qPkSrw7hve/Kn2ZlEkT+YZnAd3cYOhqm9oFVTa1QFIwarUmPShu9T6p9FwzjFVJGPWfsQGUYI0tgGJDDa3IcIHtVZdDjlHj/AaNethw578fOqZ1P++4wxXwcOOeEGAEo7E0wJUBSUFVh9pkpMBbEUhgEoTAaHqaakCqHLbSQI6ClMEpcA2JgGFUoZWowqYJQmKbCWEAI5iX7TN4EU8jyvrJ80yuBnvr0u3bgu1GBcoYdL7C0GUMbhlFp5M6UMI0A5G83jKXkA1FY7WrummwAAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAARlJREFUWEftl8ESwyAIRMX//2btkCmNkxF3tUzapsklhyg+FgQiIlLTlzxywziRCFGm1JqyyNvBvmE8Ca+hTClld1Dzpe4VIue8lD/TyhhEe+AxgXtrGDoaZnSAd5tmoSgYNTqSHl1ttN9U+y0YxiukjHrO2IHKMEZOgWFANq/JdoDsDZVBmy3x/gNGvZx95LmnLnTuttuHhKm2rSGlJE47QGEPgVE1TZ2jqi3Yx2Fe1TVnWGtC68wxXL3c80Koa0+FGYFQMEwptzozUgaBhMOoQQ8oDMbU0XdvlGgrcA+GAaGVaRORmfQMiIWYmmd6t2I0A+sf1CzIkjJdMLJrozYDrzYyMDNCIFvXg0Ees99DlGEPQ+tuGE+hB/YM7mqvcQMKAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAS5JREFUWEftltEOgyAMRS3//82w1KyzI9DbSmfMoq8qHA6XUiKitt3koQdmshMpZmprWyFa3uwHZqbwP8zUWo8Fcl7aUSE4PVRKOENhMwJR1GR9gNsbNArkhhlByNI1jIBoLV4oFwyDaBO9fwTD33uAUmFGVgQ8BQZZ4cnEjAXjsQPNZMIgIBPGAyJmSB3t0ZnmbULj/RxGZ+USmD4rs7CGYTiMkUdvTztxc+vb/vQ2eW3ohYXNWD/Pji4b8fQzKTCoflwCgyCkbng6PWRlHws15Ahorx+OtjMFhonRnYNgPCAuMxaM1JNLYWZACMbqgYZXBspM/9Ooi+vNRCE+bUYURix91emuB7YaMau6w9PkuRpQZjxjuAOMBntgkKHV9ymZWYVYOk1Zk/fj3MrMC5xn8Wqmr+N5AAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAT1JREFUWEftl+0KwyAMRRvf/5l1pCwsDcZ7raXboP4ZFD+OJyY6EZG2/UiTByaJxCVmamtbEVkO9gOTKfx/M63W7VAP9Ly0z5dSyqnzM21GQbSJWzAe4PruMwtFwxiE37IBZdk0C0XB9EC8HZTaCsVYWoIxoNtgMisWLg0VgtG+jJ2hGQTCmrkExnaDoJoIdR0gO0MzcXAG9RUYn9YRzNedrOJNm9HDONPE9VdDs83f9lNhyhZiLU2b8QuiwdZXbXpDvSrNZNQlZkYwh3oEKjGswIwdK3qoBMQLNob9VhiUcRCGiTVjBoHs1pi/KihU/m5CN/wo9SkYs6O/vacAgmGs0GZiukeoeGv3XoNMMaTNxMnsFbd/D29grcOsjUNNYs4M2hXznkFznApTb9IHhlG90uf0AV5ZNBv7wGRmXh7B8Wq6WAC6AAAAAElFTkSuQmCC"],["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAPFJREFUWEftl+EKhTAIhefe/5ndZcFiDM2jjaiL/Sko7dvRHYuIqJWXHJQwSiW2KMOtlUp0u9gJo0n4H8o0ZrVHqNZQ/7iVuYJYCbxQMIwHIgoFwdwBGWCISt+C2aEKqo6pzGtgdoIg6lwqkzCzL/QJfEo6XYcsVQhqy3Sfp/1lmZi5VMDa0U8IK1/ChD8hLGl7YqRMSB7T9JAkj8EcKzca2YKx4s/di/yqWMkehRnq9LO01TWYvggtRmpis2fWIOkFK4wXwlUmaRXjhce97qqTWyNGuUUZESx/4hTrtHYTOmTdDYwmjjyXMOFBGZE7GvMDi6qyam6O39AAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAANlJREFUWEftl9EOgzAIRaX//83FsKwLNkVuO5cwxSdjjT09tIBERLwFuShhjEhcYqYyb4Xo62AnjKXwHma41sMCdX4opSztn2kzPUSblRRAfYPOQsEwFsQIpj2bhYJgPBCZXJvpYyRQiKX/gkGseGZkHLHjmgkDg4IgZhA7p2YSRh9FqcCf3KHuvZTKi1VbV/sM01LVDrWBZQUo0Fk5QI71Kz14DXkoGNTO8wpl2/leuEZmftLP6KMYotPrc0OIHniUsPInzkrjocx4FR0ddzMw+qEr3ksYy+IOAd2yaqrSqYMAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAAPRJREFUWEftlusOgzAIhaXv/8xlYUknMZZzsM3iXP1lItKPw60iIrrd5JEF08nEFGWq6lZEhpO9YHoSPkOZWuseoNWL7hOilHKpftLKNAh/4LGAz2wYOhomOqDXTVkoCsacRtKj1kb/N9V+C4aJCiljkTN+oDKMk6/AMCDvqMl1gPyFyqCfW+H9B4xF+Wk1984MLcZGD9vdb/swTepHPnMSYSPBqlgwl68QM1MVpcgA4dC7FYwRzwBCqlDK3A5mFIhRhVbGV38mZSxE6j5z1ooRVBZiGMYDsosSDWjY2shB5gqBfD0PBkXMfp+iDHsYslswPYVeEmqyaphsodgAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAYAAAAe2bNZAAAAAXNSR0IArs4c6QAAANhJREFUWEftl9EOgCAIRcP//2ZptNmY07hYD1T01Jbp8aCgRES8BXkoYSaReMRMZd4K0e1gJ8xM4TfM1FrPCfarhUpZWj9uMw2iqAFZgWkKLxQMM4JoA89g2ncUCoIREG2ij4EFI+0RoHfBWFZk1ogZxI5pJgwMAuIxY9m5NJMweqtKBfY+5PiHu+quq32Gaalqh1rAMgME6H9Jr8XWsoOY+V6h1HbkfXSUsMwgVo5S4b3EhTjp9bkhxBl4lLDyEjdL46HMeKv8Um16ahC0H/fWRjteaRcKZgc3GrBqJCUxzAAAAABJRU5ErkJggg=="]]),r=b.ref(""),s=[[1,1,Math.PI/2],[2,1,Math.PI/2],[3,1,Math.PI/2],[4,1,Math.PI/2],[1,2,Math.PI/2],[2,2,Math.PI/2],[1,1,Math.PI/4],[2,1,Math.PI/4],[3,1,Math.PI/4],[4,1,Math.PI/4],[1,2,Math.PI/4],[2,2,Math.PI/4],[1,1,Math.PI],[2,1,Math.PI],[3,1,Math.PI],[4,1,Math.PI]],u=(h,o)=>{const m=s[h*4+o];r.value=`${h}${o}`,e("receiveParameters",{param:m})};return b.onMounted(()=>{za.value=250}),(h,o)=>(b.openBlock(),b.createElementBlock("div",D5,[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(n,(m,y)=>(b.openBlock(),b.createElementBlock("div",{class:"row",key:y},[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(m,(x,M)=>(b.openBlock(),b.createElementBlock("div",{class:b.normalizeClass(r.value===`${y}${M}`?"item backColor":"item"),key:M,onClick:A=>u(y,M)},[b.createElementVNode("img",{src:x,style:{margin:"0",height:"35px",width:"35px"}},null,8,L5)],10,R5))),128))]))),128))]))}}),VO="",k5=zo(I5,[["__scopeId","data-v-fff1a9fd"],["__file","RoundMarkDialog.vue"]]),M1=t=>(b.pushScopeId("data-v-ef6011f8"),t=t(),b.popScopeId(),t),B5={class:"fcb"},F5={class:"symbolBox"},z5={class:"symbol"},N5=["onClick"],U5=["src"],V5={class:"formBox"},G5={class:"iconFont"},O5={key:0,class:"icon","aria-hidden":"true"},j5=[M1(()=>b.createElementVNode("use",{"xlink:href":"#icon-a-1"},null,-1))],H5={key:1,class:"icon","aria-hidden":"true"},W5=[M1(()=>b.createElementVNode("use",{"xlink:href":"#icon-a-2"},null,-1))],q5={class:"topData"},Y5={class:"fcb inLine"},X5={style:{width:"80%"}},K5=M1(()=>b.createElementVNode("div",{class:"line"},null,-1)),Z5={class:"bottomData"},J5={class:"cornerData"},Q5={key:0,class:"btnList"},$5={class:"leftDate"},tB=b.defineComponent({__name:"RoughnessDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=b.reactive({textLeftStr:"",rougCornerType:"无",isRoungSameRequire:!1,isShowMostSymbols:!1,textUpStr:[""],textDownStr:[""],isAddLongLine:!1,selectSymbolNum:0}),r=b.ref();let s="";const u=b.ref(!1),h=["=","⊥","X","M","C","R","P","无"];let o=new ta,m=new p.McDbWipeout,y=new p.McGePoint3d;const x=b.reactive(["其余","全部","下料切边"]);b.onMounted(()=>{s=MxPluginContext.useTheme().isDark.value?"dark":"light",za.value=450,Wo.value?o=Wo.value.clone():o=new ta,A();const{wipeout:P,midPt:D}=b1();m=P,y=D.clone()}),b.onBeforeUnmount(()=>{m.erase(),Wo.value=null});let M=null;b.watch(()=>n,(P,D)=>{P&&(n.isRoungSameRequire&&(n.isAddLongLine=!0),M&&clearTimeout(M),M=setTimeout(()=>{T()},300))},{deep:!0});const A=()=>{n.textLeftStr=o.textLeftStr,n.rougCornerType=o.rougCornerType?o.rougCornerType:"无",n.isRoungSameRequire=o.isRoungSameRequire,n.isShowMostSymbols=o.isShowMostSymbols,n.textUpStr=o.textUpStr,n.textDownStr=o.textDownStr,n.isAddLongLine=o.isAddRougLongLine,n.selectSymbolNum=o.rougMarkType},T=()=>Gt(this,null,function*(){var Z,tt;const P=p.MxCpp.getCurrentMxCAD(),D=new ta;D.setPos(y),D.rougMarkType=n.selectSymbolNum,D.textLeftStr=n.textLeftStr,D.rougCornerType=n.rougCornerType==="无"?"":n.rougCornerType,D.isRoungSameRequire=n.isRoungSameRequire,D.isShowMostSymbols=n.isShowMostSymbols;const k=(Z=n==null?void 0:n.textUpStr)==null?void 0:Z.filter(at=>at!="");D.textUpStr=(tt=JSON.parse(JSON.stringify(k)))==null?void 0:tt.reverse(),D.textDownStr=n.textDownStr.filter(at=>at!=""),D.isAddRougLongLine=n.isAddLongLine;const z=P.drawEntity(D),{minPt:O,maxPt:U}=D.getBoundingBox(),H=U.sub(O).normalize().mult(2);O.addvec(H.clone().negate()),U.addvec(H);let V=(U.x-O.x)*5,W=150/230*V;const K=yield Kd({type:"image/bmp",width:V,height:W,range_pt1:O.toVector3(),range_pt2:U.toVector3()});r.value.src=K,P.mxdraw.updateCanvasSize(),z.erase(),e("receiveParameters",{roughnessData:n})});return(P,D)=>(b.openBlock(),b.createElementBlock("div",null,[b.createElementVNode("div",B5,[b.createElementVNode("img",{ref_key:"img",ref:r,style:{margin:"10px 0px",width:"55%"}},null,512),b.createElementVNode("div",F5,[b.createElementVNode("span",z5,b.toDisplayString(b.unref(G)("基本符号")),1),(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(b.unref(w5),(k,z)=>(b.openBlock(),b.createElementBlock("div",{class:b.normalizeClass(n.selectSymbolNum===z?"symbolImg backColor":"symbolImg"),key:z,onClick:()=>n.selectSymbolNum=z},[b.createElementVNode("img",{src:k,style:{width:"25px",height:"25px"}},null,8,U5)],10,N5))),128))])]),b.createElementVNode("div",V5,[b.createElementVNode("div",G5,[b.unref(s)==="dark"?(b.openBlock(),b.createElementBlock("svg",O5,j5)):b.unref(s)==="light"?(b.openBlock(),b.createElementBlock("svg",H5,W5)):b.createCommentVNode("",!0)]),b.createElementVNode("div",q5,[b.createElementVNode("div",Y5,[b.createVNode(b.unref(on.VCheckbox),{label:`${b.unref(G)("相同要求")}`,modelValue:n.isRoungSameRequire,"onUpdate:modelValue":D[0]||(D[0]=k=>n.isRoungSameRequire=k)},null,8,["label","modelValue"]),b.createVNode(b.unref(on.VCheckbox),{label:`${b.unref(G)("多数符号")}`,modelValue:n.isShowMostSymbols,"onUpdate:modelValue":D[1]||(D[1]=k=>n.isShowMostSymbols=k)},null,8,["label","modelValue"])]),b.createElementVNode("div",X5,[b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.textUpStr[0],"onUpdate:modelValue":D[2]||(D[2]=k=>n.textUpStr[0]=k)},null,8,["modelValue"]),b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",disabled:n.textUpStr.filter(k=>k!="").length==0,modelValue:n.textUpStr[1],"onUpdate:modelValue":D[3]||(D[3]=k=>n.textUpStr[1]=k)},null,8,["disabled","modelValue"])])]),K5,b.createElementVNode("div",Z5,[b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.textDownStr[0],"onUpdate:modelValue":D[4]||(D[4]=k=>n.textDownStr[0]=k)},null,8,["modelValue"]),b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.textDownStr[1],"onUpdate:modelValue":D[5]||(D[5]=k=>n.textDownStr[1]=k),disabled:n.textDownStr.filter(k=>k!="").length<1},null,8,["modelValue","disabled"]),b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.textDownStr[2],"onUpdate:modelValue":D[6]||(D[6]=k=>n.textDownStr[2]=k),disabled:n.textDownStr.filter(k=>k!="").length<2},null,8,["modelValue","disabled"])]),b.createElementVNode("div",J5,[b.createVNode(b.unref(on.VBtn),{class:"cornerIcon",onClick:D[7]||(D[7]=()=>u.value=!u.value)},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(n.rougCornerType),1)]),_:1}),u.value?(b.openBlock(),b.createElementBlock("div",Q5,[(b.openBlock(),b.createElementBlock(b.Fragment,null,b.renderList(h,(k,z)=>b.createVNode(b.unref(on.VBtn),{class:"cornerIcon",key:z,onClick:O=>n.rougCornerType=k},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(k),1)]),_:2},1032,["onClick"])),64))])):b.createCommentVNode("",!0)]),b.createElementVNode("div",$5,[b.createVNode(b.unref(on.VCheckbox),{label:`${b.unref(G)("长边加横线")}`,modelValue:n.isAddLongLine,"onUpdate:modelValue":D[8]||(D[8]=k=>n.isAddLongLine=k),disabled:n.isRoungSameRequire},null,8,["label","modelValue","disabled"]),b.createVNode(b.unref(on.VCombobox),{class:"mt-1 mr-2","return-object":"",items:x,modelValue:n.textLeftStr,"onUpdate:modelValue":D[9]||(D[9]=k=>n.textLeftStr=k)},null,8,["items","modelValue"])])])]))}}),jO="",eB=zo(tB,[["__scopeId","data-v-ef6011f8"],["__file","RoughnessDialog.vue"]]),nB={style:{margin:"10px 0px"}},iB={class:"imgBox"},rB=["src"],oB={style:{width:"200px"}},sB={style:{display:"flex"}},aB={style:{width:"25%"}},lB=b.defineComponent({__name:"WeldSymbolDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=b.reactive({symbolType:0,width:10});b.watch(()=>n,(s,u)=>{s&&e("receiveParameters",Bh({},n))},{deep:!0});const r=[{value:0,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAV4AAABNCAYAAADuHgybAAAAAXNSR0IArs4c6QAABdZJREFUeF7tnWGPEzAMQ7f//6MPDYQQHLCmTWI39+5zm9bPrjcOIZ6Px+PjwQ8EIAABCLQReFK8baw5CAIQgMB3AhQvQYAABCDQTIDibQbOcRCAAAQoXjIAAQhAoJkAxdsMnOMgAAEIULxkAAIQgEAzAYq3GTjHQQACEKB4yUCIwMfH4/F8pYYfCEBgm4CseCc/4MnaXkmbrA9t210i3Xibb7Li5QFLc3p8+G1BjwhGW4SWz9qbfJMWL+XrE9qdm9wU9Kg+tEWJeay/xTd58VK+HoHdvcUtQd/Rh7Ydavo9N/hmUbyUrz6sJze4Iei7+tC2S067z903m+KlfLVBPTndPeQn2sjlKT3dfudcWhUvIdeF9PRk55Cj7f8E8O40IfH9FG+c2dEOQn6ET7YZ32Tojw929M6uePnWe5wz6QDHkGcBQVsWyd45jr5ZFi/l2xvMzNMcQ46+NQKTvXPTRvGuZTJ9lVsQMgWiLZNm36zJvrl9mbMtXjdQ2fGfHPLJ2shl9kvom+eUS4q3z/dPJzkFIRsD2rKJ9syb7JvTh6Z18TqBqoj95JBP1kYuK15Dz0yXXFK8PX7/8xSXIFRgQFsF1fqZk31z+dC0L14XUFVxnxzyydrIZdWLqJ/rkEuKt97ntyc4BOHtJTcXoG0TnHgbvtUacEXx8u2iNgSV03nAlXRrZ+NdHV+Kt47t8mQCvozKbiHe2VmydCG1bxTvkk21i9QhqFXHfxVUzbdq/uRcqrVRvFWpDc5VByF43dBytIVw2Sye7Jv615fXFK8aVPVrmBxytFWnp24+3tWwpXhruIanEvAwMpsNeGdjRegiSt8o3pBVdYuVIahT9WvyZH1o60hQ/hlK3yjefD+3JipDsHXh4KbJ+tAWDIPJcqVvFC8haCGgDHm1QLRVE66Zr/SN4q3xdGuqMghbFw5sQlsAltFSfKsxg+Kt4bo1lZBvYZNvwje5BdsXUHlH8W5blr9RFYJ8JZ8noq2Dcv4Zk3170VLpu6p4f4J6PD7yE2Yx8To7AtTQFoBltnS2d8+XvOafq4iqPp26PJmsD21dKco9Z7JvfONdzAohWARluGyyd2gzDNzilVTe8Y130aCOZaoQoO2MAL6d8VPtVvpG8apc/+NcZQg6EEzWh7aOBOWfofSN4s33c2uiMgRbFw5umqwPbcEwmCxX+kbxEoIWAsqQVwtEWzXhmvlK3yjeGk/DU5UhCF82uGGyNuXfjAdt2Fo+2TulNop3K475m5QhyFfz+0S0VROum493NWyvKd7JAeBbU024O6ZOzuVkbeo3R/F2vM43ZxBwAxM2rzDZO7RthmJhG8W7AKl6CQGvJlw3H+/q2FZOVvtG8Va6uzhbHYLFa24tQ9sWNotNeFdnwxXFOzkA6t811UXrx+TJ3qGtOj018x18o3hrvF2e6hCC5csGF07WxodKMAxGyx1yaV+8DpAqMzNZH9oqk1M3e7JvLh+YFG9dft9OnhzwydpcHu/bgG0umOydizbr4nWBtJnft9sm60PbW/stF0z2zekDk+IVxX9ywCdrc3q8FdGd7J2TNtvidYJEwGMEJnuHtlgWnFY7eUfxCpLhFIBs+ZO18W03Oy1989xyaVm8bpAy4zFZG8WUmZTeWZNz6ajNrngdIWU+gcn60JaZlL5Zk31z/TJA8fblm3/F1cg68yiKKZNm7yxX76yK1xVSRlTQlkFRMwPvNNxPT3X2zaZ4nSFNDsCpNtc/ymXoQlsWxf457n1iUbzukE5iM1kbxXSSDO3eybm8QZu8eG+AtPtEJmujdHdTod83OZe3aJMW7y2Qdp7KZG2U7k4iPPZMzuVN2mTFexOk6JOZrI3SjabBZ/3kXN6mTVK8t0HyeTr6m0z2Dm36fH2VG0iK96vARScEIACBvxGgeMkFBCAAgWYCFG8zcI6DAAQgQPGSAQhAAALNBCjeZuAcBwEIQIDiJQMQgAAEmglQvM3AOQ4CEIAAxUsGIAABCDQT+AY4fBYu1nCUKgAAAABJRU5ErkJggg==",name:G("单边V型对接焊缝（前视图）"),style:"height:45%;width:100%"},{value:1,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAV4AAABGCAYAAACE2fxYAAAAAXNSR0IArs4c6QAABWpJREFUeF7tnNuS2zgQQ+X//2in5ClXJXkYs6m+QPDxM9kkDiBY42zt4ziO58EHAhCAAATaCDwo3jbWHAQBCEDgRYDiJQgQgAAEmglQvM3AOQ4CEIAAxUsGIAABCDQToHibgXMcBCAAgdHifT6P43HewPCDtvuZenr2+ocPw0ySR608jhbviYJAaAVi9Tb4tkpKZx2e6XgxXryUr04YojfhQY4Sm1+PZ/MevP6qUvnveAmERiCit8C3KLH59Xg274FM8fLmOx+G3RvwIO+Sm9uHZ3Pspd543xgIxGwgdk939c1VFy86u0nP2Sf1xkv55pg6MYWCmqB+/Ux8u85wZ4Jk8Tp/GxP0nZjO78G3eQ+iN1D2jOKNupmwXjkQV+Wh7SrB/v141s9ctnid33rR1h/0jBMpqAyK/TMUfZMuXgqqP6QZJyoGPUMXecyi2DtHMY8Ub28G/jlNMRBZOFy1ueriSyUr+Wtz5IvXORA8xGshVVuFb2qOfL6PmmcU72fPSleoBSJTrKs2V13OLzlq2m5RvGrQKKc1AhTUGie1Va6+KemieAVSrxSIbByu2lx1Ob/kKGm7TfEqQaOc1glQUOusVFbiWb0TFG8946UTXMPuqsv5RcBZm0oeKd6lWqxfpBKICqWu2lx1ORevijaKt6JpNmbyEG9AG96CZ8MGbB6v4Nutilfl22rT71+3KYShQpezZ87ayGPV0/Azl+Kt5Rua7hp2V13OxeusTSGPFG+oGmsXKwSiSqGrNlddzsWroI3irWqajbk8xBvQhrfg2bABm8dP+0bxbhpXsW06DBWa3jNdtbnqUngrdM4jxVvpbnA2D3EQmMhyV99cdSl8qdyueBWgVT3vBL2KbO1cV99cdSl0CMVb+0yGphP0EC6Zxa6+ueqieDcfHddAuOpSCPpm1Ja24dsSJqlF057xxisUh+kwVKJAWyXdutmuvk3ronjrMhuePB2G8IUDG9AWgCWyFM/qjKB469iGJxP0MDKJDa6+uepS+OnrdsVLGCS6JnwJfAsjG9+AZ3UWULx1bMOTCXoY2fgGPBu3YOsC075RvFu21WyaDkONqp+prtpcdTl7pqCN4q1sm+BsHuIgMIHleCZgwsYVpn2jeDdMq9oyHQZ0xQm4eqbwVhh3Y22HgmcU75pX5asUwlAlEm1VZOvm4lkd23PyrYqXMNSGoWq6q2+uupzfdlW0UbxVbROcy0McBCawHM8ETNi4goJvFO+GcRVbFMKArhgBV89U3gpjbqytVvGM4l3zq3SVShgqRKKtgmrtTDyr5Xur33gJQ30YKk5w9c1Vl/PbrpK227zxugbdVZdSyPlCiRFwzaSSrlsUrxKwWIQ/r0bbZ0ZqK/BMzZG1+yj5RvGueVaySikI2QLRlk20Z56rb2q65ItXDVhm/NGWSbNnFp71cM4+Rc03ijfb4cA8tTAErv7rUldd/G6dlZDeOYp5lC5eRWBZkUFbFsm+OXjWxzrzJEXfZItXEVZWGNCWRbJ3jqtvrrqU/0KheHufXdv/L61yyDMsppwyKPbOUPZMsniVgV2Njqs2V118oVxN/Nx+5UzKFa8yrKsRQttVgv378ayfecaJ6r5JFa86rCuBQNsVenN7XX1z1XWXv1BkipcgzJXLlZPx7Qq9mb14NsP971MlipcgzAdh5wb4tkNtdg+ezfJ/nz5evARBIwjRW+BblNj8ejyb90CieAmCThAiN3H17dR1fh7n64jZx9Wzu/ym+3+cRt94n++km4UcORCAQB+Bxw2/KUeLt88aToIABCCgQ4Di1fGCm0AAAl9CgOL9EqORCQEI6BCgeHW84CYQgMCXEKB4v8RoZEIAAjoE/gALvAEuttoMygAAAABJRU5ErkJggg==",name:G("角焊缝（前视图）"),style:"height:45%;width:100%"},{value:2,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAABICAYAAAC6L9h5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFjSURBVHhe7drRioMwFEXROP//z7aB7odhrHNaTXJvcjaIj+oiRAJ3K6Xsz8ud9PO6u2f7frxejCRkJCEjCRlJyEhCRhIykpCRhIwkZCQhIwkZSchIr94dbmvLI1WcM6DaskgKDi2H9AkOLYP0DQ5Nj3QFh6ZFugOHpkO6E4emQWqBQ+mRWuJQWqQeOJQOqScOpUEagUPhkUbiUFikCDgUDikSDoVBiohDw5Ei49AwpAw41B0pEw51Q8qIQ82RMuPQn5nJ7B90tW2rJL/rNliaBf8IqdueVB9+9AIZ6v53y4jVHYkyYQ1DogxYw5EoMlYYJIqIFQ6JImGFRaIIWOGRaCRWGiQagZUOiXpipUWiHljpkagl1jRI1AJrOiS6E2taJLoDa3okuoK1DBJ9g7UcEn2CtSwSKVjLI9EZlJGEjCRkJCEjCRlJyEhCRhIykpCRhIwkZCShemBZe7RNyCvp30p5AJPejoCkZsQmAAAAAElFTkSuQmCC",name:G("单边V型对接焊缝（侧视图）"),style:"height:90%;width:50%"},{value:3,image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMwAAACVCAYAAAAUoxXNAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALmSURBVHhe7d3djtowFIVR6Pu/Mx3a6c8MAbIhiY/ttaQj31qWPsm+8vl0Ol0+hk+Xy+V0Pl+PBW79+FyBFQQDAcFAQDAQEAwEBAMBwUBAMBAQDAQEAwHBQEAwEBAMBAQDAcFAQDAQEAwEBAMBwUBAMBAQDAQEAwHBQEAwEBAMBAQDAcFAQDAQEAwEBAMBwUBAMBAQDAQEAwHBLLh+2wdLBHOHaFgimAdEw3eCeUI0/E8wK4iGPwSzkmi4EkxANAgmJJq5CeYFopmXYF4kmjkJ5g2imY9g3iSauQhmA6KZh2A2Ipo5CGZDohmfYDYmmrEJZgeiGZdgdiKaMQlmR6IZj2B2JpqxCOYAohmHYA4imjEI5kCi6Z9gDiaavgmmAdH0SzCNiKZPgmlINP0RTGOi6YtgChBNPwRThGj6IJhCRFOfYIoRTW2CKUg0dQmmKNHUJJjCRFOPYIoTTS2C6YBo6hBMJ0RTg2A6Ipr2BNMZ0bQlmA6Jph3BdEo0bQimY6I5nmA6J5pjCWYAojmOYAYhmmMIZiCi2Z9gBiOafQlmQKLZj2AGJZp9CGZgotmeYAYnmm0JZgKi2Y5gJiGabQhmIqJ5n2AmI5r3CGZConmdYCYlmtcIZmKiyQlmcqLJCAbRBATDL6JZRzD8JZrnBMMXonlMMNwQzX2CYZFolgmGu0RzSzA8JJqvBMNTovlHMKwimt8Ew2qiEQyh2aMRDLGZoxEML5k1GsHwshmjEQxvmS0awfC2maIRDJuYJRrBsJkZohEMmxo9GsGwuZGjEQy7GDUawbCbEaMRDLsaLRrBsLuRohEMhxglGsFwmBGiEQyH6j0awXC4nqMRDE30Go1gaKbHaARDU71FIxia6ykawVBCL9EIhjJ6iEYwlFI9GsFQTuVoBENJVaMRDGVVjEYwlFYtmvPH3Oyo+sMLWlkMBljmSgYBwUBAMBAQDAQEAwHBQEAwEBAMBAQDAcFAQDAQEAysdjr9BLIwNQWJI4hAAAAAAElFTkSuQmCC",name:G("角焊缝（侧视图）"),style:"height:90%;width:60%"}];return b.onMounted(()=>{za.value=350,e("receiveParameters",{formData:n})}),(s,u)=>(b.openBlock(),b.createElementBlock("div",null,[b.createElementVNode("p",nB,b.toDisplayString(b.unref(G)("选择要在几何图形上放置的焊缝符号"))+"： ",1),b.createVNode(b.unref(on.VRadioGroup),{modelValue:n.symbolType,"onUpdate:modelValue":u[0]||(u[0]=h=>n.symbolType=h)},{default:b.withCtx(()=>[(b.openBlock(),b.createElementBlock(b.Fragment,null,b.renderList(r,(h,o)=>b.createElementVNode("div",{key:o,class:"radio"},[b.createElementVNode("div",iB,[b.createElementVNode("img",{src:h.image,class:"img",style:b.normalizeStyle(h.style)},null,12,rB)]),b.createElementVNode("div",oB,[b.createVNode(b.unref(on.VRadio),{label:h.name,value:h.value},null,8,["label","value"])])])),64))]),_:1},8,["modelValue"]),b.createElementVNode("div",sB,[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("焊角宽度：")),1),b.createElementVNode("div",aB,[b.createVNode(b.unref(on.VTextField),{type:"number",modelValue:n.width,"onUpdate:modelValue":u[1]||(u[1]=h=>n.width=h)},null,8,["modelValue"])])])]))}}),HO="",cB=zo(lB,[["__scopeId","data-v-a986481d"],["__file","WeldSymbolDialog.vue"]]),Yw=t=>(b.pushScopeId("data-v-253ca580"),t=t(),b.popScopeId(),t),uB={class:"fbc",style:{"margin-top":"10px"}},hB={style:{width:"60%",height:"140px"}},dB=Yw(()=>b.createElementVNode("div",{style:{width:"35%",height:"140px"}},[b.createElementVNode("img",{style:{width:"100%",height:"100%"},src:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAArYAAAGzCAYAAADaJlTCAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AACWLSURBVHhe7dbbroXYkQXR/v+fdhuXsThrR3Jdt4QIaTx0MmGfKkt2/9+/+5ckSZL0AniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUlSRdvouaQq8ChJSmyNno1WRpu3oWgn6TE8SpKSKqPNSGW0uWONno1G0U7SY3iUJCVF0W4UinZXlNFmJIp2kh7DoyQpqSjajkDRbutO9J2Rymgj6TE8SpISo2g3Qq/ot0eiaCfpETxKkhKLou0IPaLfHYminaRH8ChJSiyKtiO0jn5zNIp2kh7BoyQpsSjajlAr+lb5W7OgaCfpETxKkhKjaDfK2ejdLYp2M6BoJ+kRPEqSEqNoNwpFuyMU7WZA0U7SI3iUJCVG0W4UinZHKNrNgKKdpEfwKElKjKLdKBTtjlC0mwFFO0mP4FGSlBhFu1Eo2h2haDcDinaSHsGjJCkxinajULQ7QtFuBhTtJD2CR0lSYhTtRqFod6SMNrOgzu7WaC/pDzxKkhKjaDcKRbs9FO1mUSv6tqT/waMkKTGKdqNQtNu6Er3fWq/otyX9Dx4lSYlRtBuldfSbd80W/Y2S/gePkqTEKNqRbfS8htbRbx7JEP3dkv7AoyQpMerMJqp896nW0W/umSX62yRdgkdJUmK1o994onb0G1e0LvqN8u+Q9BgeJUmJ1Y5+44mz0bstPIm+RyjaSXoEj5KkxGpG33/iSvR+K2W0WZTRhlC0k/QIHiVJiT2JvlcTFd2XyvdHo2hXomgn6RE8SpIS24v2PVF7z5a2748WRdstinaSHsGjJCkxinYjlO09W9tuZkDRbouinaRH8ChJSoyiXW/Umc1SuRspirYrinaSHsGjJCkxina9UWd3S7QdhaLdiqKdpEfwKElKjKJdbxTtFlG0HSGKtguKdpIewaMkKTGKdr1RtFtE0XYUinYLinaSHsGjJCkxinY9UbTbiqLtCBTtFhTtJD2CR0lSYhTteqJoV4qi7QhltFlQtJP0CB4lSYlRtOuJoh2Jom1vZbRZULST9AgeJUmJUbTrhaJdJIq2vZXRZkHRTtIjeJQkJUbRrheKdnuiaNvbGj1bUbST9AgeJUmJUbTrhaLdkSjazoainaRH8ChJSoyiXQ8U7c6Kou1MKNpJegSPkqTEKNq1FkXbs6JoOxOKdpIewaMkKTGKdi1F0faqKNrOgqKdpEfwKElKjKJdSxTt7oqibQ9lR8+Xyo2kx/AoSUqMol0rUbR9Ioq2rVFXnkuqAo+SpMTKaHPHGj1bRdG2hrvRt57YK3pefkPSY3iUJCVWRpvSnc5+o9zV9CT63l13ou9IegSPkqQERnf2b9nuWngSfe+JK9H7kh7BoyRpgIwd/d3lP2Mrd6NvPXU2elfSI3iUJHWUtaO/vfznbO1q9I1azkTvSXoEj5KkjrJ15u/e/vP1tEbPetuL9pIew6MkqaPe0d9wRxRtvyqKtpIew6MkqbMz0XsjUbT7Oop2kh7DoyRJp2yj5/pHGW0kPYZHSZJUmf8PrdQcHiVJkqRs8ChJ+rdt9FySWtlGz4XwKEk/ttHzNyqjjaS2ymjzNhTt9AOPkiaxjZ73QtHuqm30fLQy2rxNGW1IGW1aKaONrlujZz2V0eaONXo2GkU7/cCjpEmU0aYHinZXULQbiaLdm1C0K5XRphWKdke20fMvKaNNLxTtriijzUgU7fQDj5ImQNGuhyjalq5E749E0e5NKNqVymjTCkW7PRTtvoKiXQ8U7ciV6P2RKNrpDzxKmgBFu16o6P6k8ndHomj3JhTtSmW0aYU6szmq/MaXlNGmF2rv2d22vzkDinb6A4+SJkDRrpde0W+PQtHuLSjakTLatNQq+q23o2jXU4/od0eiaKc/8ChpAhTtemod/eZIFO3egqJdiaJdSy2i3/kCinY9tY5+czSKdvoDj5IGo2jXW8vo90ajaPcGUbQtUbTb2kbPr2oR/c4XULTrqXX0m6NRtNMfeJQ0GEW73q5E768o2o1G0e4NqDMb6uk7dzyJ3i+//yUU7Xq6Gn1jVUabGVC00x94lDQYRbveKNodoWg3GkW77GaI/q4rKNpFymjzFWW0GaGMNmeU0WYGFO30Bx4lDUbRrjeKdkco2o1G0S6zWaK/7QqKdoSi3RdQtBuhjDZHKNrNgKKd/sCjpIEo2o1A0e5IGW1mQNEusxmiv+sqinaEot0XULQboYw2RyjazYCinf7Ao6SBKNqVjqJ3rqJod6SMNjOgaJfVqOhveYqiHaFo9wUU7Up70f6OMtocoWg3A4p2+gOPkgZqFf3WVRTt9lC0mwFFu6yu9OTdpfL92ijalY6id96qZfR7V5XR5ghFuxlQtNMfeJTUwYjo77iCot0einYzoGi32Iv2o1FnnkXPl/aeLW2/UVvL6Pey6x39DVdQtDtC0W4GFO0WUbR9OTxKemjG6O+8qow2RyjazaBm9P1RovaeH71/9Hxtu6upZfR7M5sx+juvoGh3pIw2s6gVffvF8CjpgRmjv/OOMtqQM9F7vfSIfneEqKPNlfev7GppFf3WzGaM/s6rKNqVzkbv9tI6+s0Xw6OkB3pHf0MrZXR7Uvl7T80U/X297XV2R115d7utqUX0O7PrGf1+K62j33xqluhvezE8SnqgZvT9UXpEv7snS/S397bX2R21fffM++W+livR+2et0bMZ1Iq+PVLr6DePZIj+7pfDo6SH9jq7p91IraPf3DNb9DfOJOrsjirfpfdp0wJFu6vORO+NFEXbBUW7kVpHv7lnpujv+zA8SuooirYjtYp+64xR0d+SAXV2E1W+T1vatEDRbqtm9P0MKNqN1iL6nbNGRX+L/sCjpI4o2o12NfpGTTWi75bKaJPFtr1n26Jn5furMtq0MjL6ezKgaDfa1egbNT2NvlmiaKc/8CipkyjajnYler+FqDO7chMpo012e9FueyuV0WaxjZ6vMkR/dwYU7Ua7Er3fStSZXbkhFO30Bx4ldULRbgZXovdHomhHymiT2V60P/Kkmt/qUfn3ZhJF29Go6L5Uvj8aRbsSRTv9gUdJHUTRdjRq79nS9v0ZULQrldEmsyjakpq1/PbVyr/lbSjazYDae7a0fX+0KNpuUbTTH3iU1AFFuyMU7Z6gjp4vbTejRdF2q4w2We11ZlO77d/W8rfL3ylto+fZRdF2TxRtn6D2ni1t358BRbstinb6A4+SGoui7daV6P27qDObpXI3EkW7rTLaZDNj9Hcuzra3337vCEW7zCjala5E799VdvR8rdyNFEXbFUU7/YFHSY1Re8/utP29p6gzm6VyN1IUbVdltMlkluhvq4Gi3eJs9G5WUUfPr7b9zSeos7sl2o5C0W5F0U5/4FFSQ72i376rjDaLKNqOQtFuVUabLEZEf0crLaPfy6hX9Nt3ULRbRNF2hCjaLija6Q88SmqkZ/T7d1C0W0XRdgSKdqsy2mRwtaN3yu+vymjTQuvoN7PpFf32XRTtFlG0HYWi3YKinf7Ao6RGWkW/VQtFu60o2o5A0W5RRpuZHRVtznyn3NCONi20jH4vm1bRb9VE0W4VRdsRKNotKNrpDzxKaqBW9O2WKNptRdF2BIp2izLazOqovd32O2c3V3a1tYp+K5ua0fdboWhXiqLtCNSTnf7Ao6TKorbPt/utMtq0QtGORNG2N4p2izLazGqvo932+ZUdVW5auBK9v6Bolw1VPt/+39t7Ge1aoWhHomjbG/Vkpz/wKKmiKNqSMtq0QtEuEkXb3sposyijzayo1juq3LRA0S5C0S6bKNqWKNq1QtEuQtGutzLaLCja6Q88SqokiraRMtq0QtFuTxRte1ujZ6sy2sxsGz1fULRblB09Xyo3rWyj53so2mUSRVtC0a4FinZ7omjb2xo9W1G00x94lFTBXrSPlNGmBYp2R6JoO6My2mRH0W5RdvR8qdzMiKJdFlG0jVC0a4Gi3ZEo2s6Gop3+wKOkh/ai/Z4y2tQWRdszomg7mzLaZEfRblF29Hyp3MyGol0We9E+QtGuNop2Z0XRdiYU7fQHHiU9sBftj5TRpjaKdldE0XYmZbTJjqLdouzo+VK5aa2MNlsU7TLYi/Z7KNrVFEXbKyjazYSinf7Ao6Sb9qL9GWW0qSmKtldF0XYWZbTJjqLdam3v2TbatUTRbhFF29ntRfsjFO1qomh3VRRtZ0HRTn/gUdINe9H+rDLa1BJF2zv2on0PZVefvwFFuzMo2rUUdXZLu9ntRfszKNrVEkXbO6Jo20PZ0fOlcqMfeJR00V60v6KMNpE7+zLaPRFF29ai9jbbZ29B0a60Rrdt2+c97HVmt91ksBftz6JoF7myj6LtE1G0bY268lwIj5Iu2Iv2V1C0W5yJ3ltF0fapq9E3atgr2mzffwuKdltl0X1p+14vUUeb7fMM9qL9FdTZHUXvLqJoW8OV6P1a9oqel9/QDzxKOmkv2p/Vsiu/R9tankTfu2svel6+/wZltCldid7vIeroWRZ70f6sll35PdrW8CT63l13ou/oDzxKOinqyrZ3Z/+uctfC3ehbT1yJ3s+Mol3pSvR+D1ejb8yMOrsb1dm/rdzV9iT63hNXovf1Bx4lXVB29Hx0Z/627aalu9G3njobvZsZRTtyNnq3lyvR+zMrO7MZ2dm/rdy1cjf61lNno3f1Bx4lXbT3XzizdOXvKrct3Ym+U8OZ6L3MKNpFzkTv9XQmei+L6O+fqbN/13bXw9XoG7Wcid7TH3iUVFGr6LfO2ov2rUXRtrWj6J3MKNrtOYre6W0v2r9Fq+i3ztiL9j1QtOvhKHpHf+BRUmVnovdaiaLtF+1F++zKaHNkL9qPEEXbtzgbvdtCFG2/Koq2+oFHSS9H0e7LomibXRltzqBoNwpFO7VD0e7rKNrpBx4lvdw2eq5/lNHmDcpoc1YZbUbaRs/V3jZ6rn+U0UY/8ChJ+q81eiZJLa3RMyE8SpIkSdngUZIkScoGj5IkSVI2eJQ+60vRP78kSYnhUfqkL0b/Ht7gi9G/h+y+GP17eAPLG/3nOTE8Sp/01ejfRWZfjf5dZPfV6N9FdpY7+s90UniUPumL0b+H7L4a/bvI7qvRv4vM7B3Rf7YTwqP0SV+M/j28wRejfw/ZfTH69/AGljv6z3RSeJQkaRpfif7Z38TyRv95TgqPkiRJUjZ4lCRJkrLBoyRJkpQNHiVJkqRs8ChJkiRlg0dJkiQpGzxKkiRJ2eBRkiRJygaPkiRJUjZ4lCRJkrLBoyRJkpQNHiVJkqRs8Ch9kpmZmf1G/5s5KTxKn2NmZmZx9L+dE8Kj9ClmZmYWR//bOSk8Sp9iZmZmcfS/nZPCo/QZUbSVJElTw6P0CVG0lSRJ08Oj9HpRtJUkSSngUXq1KNpKkqQ08Ci9WhRtJUlSGniUXiuKtpIkKRU8Sq8URVtJkpQOHqXXiaKtJElKCY/Sq0TRVpIkpYVH6VWiaKvvWqNnktTbGj1TCI/Sa0TRVv/YRs/fqIw2ksbYRs/fqIw2QniUXiGKtjOY4W+jaHdHzW/VVkabr9hGzyPb6HlL2+i57pnh32cZbe6q/b1aKNoJ4VFKL4q2MyijTQ8U7a7aRs9Ho2j3dhTtSmW0aYWi3Rlr9OxLymjTC0W7K8poMxJFOyE8SqlF0XYGFO16oGi350z03kgU7d6Ool2Jol0LFO2OlNHmKyja9UDRbs+Z6L2RKNrpBx6l1KJoOwOKdr1QR8/vtP3maBTt3o6iXYmiXQsU7RZXove/gqJdD9SZzdXKb45G0U4/8CilFUXbWVC066VX9NujULR7O4p2JYp2rbSKfusLymjTU4/od0eiaKcfeJRSiqLtTMpo01OP6HdHomj3ZhTtSlG0baVV9FtvR9Gupx7R745E0U4/8CilE0XbmVC0661l9HujUbR7M4p2JYp2LbWIfucLKNr11Dr6zdEo2ukHHqVU9qL9TCja9Xans9+h3WgU7d6Kot1iW/l/r+29Q5X7q1pEv/MFFO16u9PZ79BuNIp2+oFHKZUo2s6Gol1vFO2OULQbjaLdG80Q/V1XHEXvbJXR5iso2vVG0e5IGW1mQNFOP/AopRFF2xlRtOuNot0RinajUbR7oxmiv+sKinaRMtp8AUW7Ecpoc0YZbWZA0U4/8CilEEXbGVG0G4Gi3ZEy2syAot3bzBL9bVdQtIuU0eYLKNqNUEabIxTtZkDRTj/wKE0virazomgXoWh3B0W7PRTtZkDR7k1GR3/TXRTtCEW7L6BoF6Fod0cZbY5QtJsBRTv9wKM0vSjazorae3a27W/cRdFuD0W7GVC0e5M73X13+7stULQje9H+zai9Z2fb/sZdZbQ5QtFuBhTt9AOP0tSiaDubHtHvXkXRbg9FuxlQtFtRtJtVVPTszPvRfa38Rk3U3rMrbX/njXpEv3tVGW2OULSbAUW7FUW7D8CjNK0o2vY0U/T3XVVGmyMU7WZARfe9yu/Oijrz7O7zte2uppbR72UwU/T3XUHR7ghFuxlQ0X2v8rsfgEdpSlG07WHG6O+8o4w2e/aifW8to9+bSdTe87PvXt3V0jL6vVnNGP2dV1G027MX7XtrFf3Wy+FRmk4UbXsZGf09tVBHz6+2/V5to6O/aRZRZzZRV97dbmtqFf3WzEZGf08t1NHzq22/V9vI6O95OTxK04mibS+1o98YoUf0u0cyRH/3LKLObPa68v52W9Pd6FuZ1Y5+Y4Qe0e8eyRD93S+HR2kqUbTt7UxH++3zGfSIfnfPjNHfOauos7uoo/e3t3JbE0W7q85E741ytqN3ts9n0Dr6zT2zRn/rB+FRmkYUbTOgaDdSy+j3joyK/pasqDObvcr36Ru0aYGiXeRp9M0Momg7Usvo946Miv4W/cCjNIUo2mZA0W60J9H3nqoZfX9B0S6zbUfP1/bupIw2rZRF9xZt/45MKNqNdjf6Vg01o+8vKNrpBx6l4aJom0EUbUc7G73bypmiXfktQtHuraLo+fa9UhltFmv0bCtL9LfPLoq2o52N3m3lqL3d9jsRinb6gUdpuCjaZkDRbgZldFsr3x2Nol2Jot0bRdH2SFl0p7bfOfvO6Mq/OROKdqNR0X2pfH80inYlinb6gUdpqCjaZhBF29GovWdL2/dHi6LtFkW7t4mi7Z4atfhmjcq/6w2iaDsatfdsafv+aFG03aJopx94lIaJom0WFO3O2EbPn6KuPJ8BRbstinZvsteVba16/2b5e1tr9OwNKNqdsY2eP0XtPVvavj8DinZbFO30A4/SEFG0zSKKtuRM9N5d1NHzpe1mtCjarijavcVRZza1K//GWn8DfXdPGW0yi6ItORO9dxd19HxpuxktirYrinb6gUepuyjaZkKd2Vyp/N4T1JnNUrkbiaLdiqLdG8wU/X1PULTbOoreyYw6s7lS+b0nys5s1mg7CkW7FUU7/cCj1F0UbbPoFf32XWW0WUTRdhSKdqsy2mQ3ou1vb/+WFlpFv5VRr+i376Bot4ii7QhRtF1QtNMPPEpdRdE2i57R799B0W4VRdsRKNqtymiTVavO/E65aaVl9HvZ9Ix+/w6Kdoso2o5C0W5B0U4/8Ch1E0XbTFpHv/kURbtVFG1HoWi3KKNNRnc6841yc2VXW+voNzNpHf1mDRTtVlG0HYGi3YKinX7gUeoiiraZ1Iq+3RJFu60o2o5A0W5RRpts9trbbL9xdnNlV1ur6LcyqhV9u6Uy2pSiaDsC9WSnH3iUmouibSZR9Ozo3fJ5SxTtSBRte6NotyijTSZ7He22z6/sqHLTwp3OfKPcZBRFz47e2z5vjaIdiaJtb9STnX7gUWouirZZRNGWlNGmFYp2kSja9kTRblFGm0yizuzKzdkdVW5aoGi3h6JdJlG0LVG0a4WiHYmibW/Uk51+4FFqKoq2mUTRlpTRphWKdpEo2va2jZ6vymiTzTZ6vqBot6CuPG9pGz3fQ9EukyjaEop2LUTRNhJF29620fMFRTv9wKPUTBRtM4mibaSMNi1QtDsSRdsZldHmjSjaLagrz2dF0S6LvWhPKNq1QNHuSBRtZ0PRTj/wKDURRdtMomi7p4w2LVC0OyOKtrMpo80bUbRbUFeez4iiXRZ70T5C0a62KNqeEUXbmVC00w88StVF0TaTKNruoWhXG0W7K6JoO5My2rwRRbtF2dHzpXLTWhlttijaZbAX7fdQtKuNot1ZUbSdCUU7/cCjVF0UbbOIou0RinY1RdH2iijazqSMNm9E0W61be/ZWrlpjaLdiqLd7Pai/RGKdjVF0faKKNrOgqKdfuBRqiqKthnsRfszKNrVEkXbO6Jo28u2o+dLtHkjinZnULRriaLdgqLd7Pai/RkU7WqJou0dUbTtZdves7VyI4RHqZoo2mawF+3PomhXSxRt74qibWvU0aZ8/lYU7c6gaNdS1Nkt7Wa2F+3PomhXQxRtn4iibWvUlecK4VGqIoq2GexF+yso2pWiaLuKou1TUbRtaa9os33/zSjabZVF96Xte71EHW22zzPYi/ZXULQrRdF2FUXbJ/aifUtRe8+37yuER+mxvWg/u71of1WLrvwObWt4Gn3zjqNoU37jrSjabVF79xGijp5lsRftr2rRld+hbQ1Pou/ddSf6jn7gUXosirYZRNF2Nbqzf0+5q+1J9L0nrkTvvxFFu60r0fs9XI2+MbMo2q5Gd/bvKXe1PYm+d9fV6Bv6gUfpkSjaZkGd2Yzs7N+23bVyN/rWU2ejd98mirZbV6L3e7kSvT8z6sxmZGf+tu2mpbvRt546G72rH3iUbouibTbbjp6P7uzftd21dif6Tg1novfeJoq25Ez0Xk9novcy2Hb0fHRn/67trrU70XdqOBO9px94lG6Jou0b9Wr7e9vfJ3vRvrWz0bu1HUXvvBFFu8hR9E5vR9E7b9Cj8ve2/zfZi/YtXYner+0oekc/8Chdthft3+hO9J1a9qL9F+1F+zeiaLdnL9qPEEXbt7gTfaeWvWj/RXvRXj/wKF0WRVv1EUXbL4ui7RuV0eYMinajULRTO1G0/TKKdkJ4lC6Joq36KqONvv3vqYw2Z5XRZqRt9FztbaPn+kcZbYTwKJ0WRVtpZtvo+Zut0TNJY2yj50J4lE6Joq0kSVJjeJROiaKtJElSY3iUDkXRVpIkqQM8SruiaCtJktQJHqVQFG0lSZI6wqOEomgrSZLUGR4lFEVbSZKkzvAo/YiirSRJ0gB4lP6Ioq0k6S//+1LqBo/S/0TRVpL2rNGztyqjjaRq8Cj9RxRtJY23jZ6PVEabt6FoJ6kaPEr/EUVbSWNRtBuFot0VZbQZiaKdpGrwKP33v4J/o62k8SjajULR7shR9M5IFO0kVYFHfVwUbSXNg6LdCNTZ3ZXomyNRtJNUBR71YVG0lTSXKNqO0CP63ZEo2kmqAo/6qCjaSpoTRbsRekS/OxJFO0lV4FEfFUVbSXOiaDdC6+g3R6NoJ6kKPOqDomgraU4U7UZ50plvlZsZULSTVAUe9TFRtJU0L4p2I0XRdk8ZbWZA0U5SFXjUh0TRVtLcKNqNVEabM8poMwOKdpKqwKM+Ioq2kuZH0W6kMtocoWg3A4p2kqrAoz4iiraS5kfRbqQy2hyhaDcDinaSqsCjPiCKtpJyoGg3UhltjlC0mwFFO0lV4FEvF0VbSXlQtBupjDZHKNrNgKLdqow2kkJ41ItF0VZSLhTtRqFod4Si3QyovWdR229KCuFRLxVFW0n5ULQbhaLdkSjajtAi+h1JP/Col4qiraR8KNqNQp3ZnK38Vgujor9F0g886oWiaCspJ4p2o/SIfveM2aO/WdIPPOplomgrKS+KdltRtH2qdfSbe2aO/l5Jh/CoF4miraTcqOh+pvL7T7WMfu/IqOhvkVQFHvUSe9FeUm61o9944mn0zSdqd/Y3aCepCjzqJaJoKym/2tFvPHE2ereFJ9H3CEU7SVXgUS8QRVtJ71Az+v4TVHRfKt8fjaJdiaKdpCrwqOSiaCvpPa5G32iFiu5L5fujUbQrUbSTVAUelVgUbSW9C0W7Eai9Z0vb92dA0W6Lop2kKvCoxKJoK+ldKNqNQB09X9puRoui7YqinaQq8Kikomgr6X0o2o1QdmazRttRKNqtKNpJqgKPSiiKtpLeiaJdb9TZ3RJtR4mi7YKinaQq8Khkomgr6b0o2vVG0W4RRdtRKNotKNpJqgKPSiSKtpLejaJdbxTtVlG0HYGi3YKinaQq8KhEomgr6d0o2vVWRptSFG1HKKPNgqKdpCrwqCSiaCvp/Sja9UTRjlC0G4F6spNUBR6VQBRtJX0DRbueKNqRKNr2Rj3ZSaoCj5pcFG0lfQdFu16iaBuJom1v2+j5gqKdpCrwqIlF0VbSt1C064Wi3ZEo2s6Gop2kKvCoiUXRVtK3ULTrIYq2Z1C0mw1FO0lV4FGTiqKtpO+haNcDRbuzomg7E4p2kqrAoyYURVtJ30TRrrUo2l4RRdtZULSTVAUeNZko2kr6Lop2LUXR9o4o2vaybe/ZWrmRVA0eNZEo2kr6Nop2LVG0eyKKtq1RV55LqgqPmkgUbSV9G0W7VqJo+8RetG8pau/59n1JVeFRk4iirSRRtDuLot0iirY1PIm+d9de0fPyG5KqwaMmEEVbSVr06uzvlrvankTfu+tq9A1JVeBRg0XRVtJ7zdzR37j952jpbvStJ65E70uqAo8aKIq2kvLL2tHfXv5ztnI3+lYNZ6L3JFWBRw0URVtJuWXt6G8v/zlbuxp9o6aj6B1JVeBRg0TRVlJ+s0Z/69ZetP+ao+gdSVXgUQNE0VbSe9SMvt9CFG2/Koq2kqrBozqLoq2k99lGz2e0jZ6L/7uddpKqwaM6iqKtJCmXMtpIqgaP6iiKtpIkSQrhUZ1E0VaSJEm78KgOomgrSZKkQ3hUY1G0lSRJ0il4VENRtJUkSdJpeFRDUbSVJEnSaXhUI1G0lSRJ0iV4VANRtJUkSdJleFRlUbSVJEnSLXhURXvRXpIkSbfgURVF0VaSJEm34VGVRNFWkiRJj+BRFUTRVpIkSY/hUQ9F0VaSJElV4FEPRdFWkiRJVeBRD0TRVpIkSdXgUTdF0VaSJElV4VE3RNFWkiRJ1eFRF0XRVpIkSU3gURdF0VaSJElN4FEXRNFWkiRJzeBRJ0XRVpIkSU3hUSdE0VaSJEnN4fHzjv4f1CjaSpIkqQs8fto2er6Ioq0kSZK6wOOnlR09Xyt3kiRJ6gqPn7XX3vPyO5IkSeoOj590N/qWJEmSusPjJ92JviNJkqQh8Pg5d6NvSZIkaQg8fs7d6FuSJEkaAo+f8jT6piRJkrrD42fUir4tSZKkrvD4GTWj70uSJKkbPH5Ci+h3JEmS1AUeP6F29BuSJEnqBo+vVzv6DUmSJHWFx1erHf2GJEmSusPjq9WMvi9JkqQh8PhaNaPvS5IkaRg8vlat6NuSJEkaCo+vVCv6tiRJkobD4+vUir4tSZKkKeDxdWpE35UkSdI08PgqNaLvSpIkaSp4fI0a0XclSZI0HTy+xtPom5IkSZoSHl/hafRNSZIkTQuPr/Ak+p4kSZKmhsf0nkTfkyRJ0vTwmNqT6HuSJElKAY+p3Y2+JUmSpDTwmNbd6FuSJElKBY9p3Ym+I0mSpHTwmNKd6DuSJElKCY/p3Im+I0mSpLTwmM7V6BuSJElKDY+pXI2+IUmSpPTwmMqV6H1JkiS9Ah7TuBK9L0mSpNfAYwpXovclSZL0KnhM4Wz0riRJkl4Hj9M7E70nSZKk18Lj9I6idyRJkvRqeJzaUfSOJEmSXg+P0zqK3pEkSdIn4HFae9FekiRJn4HHKe1Fe0mSJH0KHqezF+0lSZL0OXicThRtJUmS9El4nEoUbSVJkvRZeJxGFG0lSZL0aXicQhRtJUmS9Hl4nEIUbSVJkvR5eBwuiraSJEnSv+FxqCjaSpIkSf+Fx2GiaCtJkiRt4HGIKNpKkiRJBTwOEUVbSZIkqYDH7qJoK0mSJAE8dhVFW0mSJCmAx26iaCtJkiTtwGM3UbSVJEmSduCxG4p2kiRJ0gE8drWNnkuSJEkn4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEnZ4FGSJEnKBo+SJElSNniUJEmSssGjJEmSlA0eJUmSpGzwKEmSJGWDR0mSJCkbPEqSJEmJ/N+//h9F8ivAZObHiQAAAABJRU5ErkJggg==",alt:""})],-1)),pB={class:"fbc"},fB={class:"btnBox"},mB={class:"tiltle"},gB=["onClick"],yB=["src"],xB={class:"btnBox"},vB={class:"tiltle"},_B=["onClick"],bB=["src"],MB={class:"btnBox"},wB={class:"tiltle"},AB=["onClick"],EB=["src"],TB={class:"fbc"},PB={class:"btnBox",style:{width:"45%"}},SB={class:"tiltle"},CB={style:{display:"flex","justify-content":"space-around",width:"100%"}},DB={class:"btnBox",style:{width:"50%"}},RB={class:"tiltle"},LB=["onClick"],IB=["src"],kB={class:"fbc",style:{"margin-bottom":"5px"}},BB={style:{width:"70%",height:"150px"}},FB={class:"fbc",style:{height:"30%"}},zB={class:"btnBox",style:{width:"25%",height:"100%",display:"flex"}},NB={class:"tiltle"},UB={style:{width:"80%"}},VB={class:"btnBox",style:{width:"25%",height:"100%",display:"flex"}},GB={class:"tiltle"},OB={style:{width:"80%"}},jB={class:"btnBox",style:{width:"45%",height:"100%",display:"flex"}},HB={class:"tiltle"},WB={class:"fbc"},qB={style:{width:"40%","margin-left":"10px"}},YB=Yw(()=>b.createElementVNode("span",null,"×",-1)),XB={style:{width:"40%","margin-right":"10px"}},KB={class:"fbc",style:{height:"55%","margin-top":"20px"}},ZB={class:"btnBox",style:{width:"45%",height:"100%",display:"flex"}},JB={class:"tiltle"},QB={style:{width:"75%",padding:"0px 10px"},class:"fbc"},$B={class:"btnBox",style:{width:"30%",height:"100%",display:"flex"}},tF={class:"tiltle"},eF={style:{width:"80%"}},nF={class:"btnBox",style:{width:"20%",height:"100%",display:"flex"}},iF={class:"tiltle"},rF={class:"btnBox",style:{width:"25%",height:"150px"}},oF={class:"tiltle"},sF=b.defineComponent({__name:"WeldingSymbolDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=b.reactive([{typeName:Ge.RolledEdge,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIsAAACLCAYAAABRGWr/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAM2SURBVHhe7c1BjuNGEEXBuf+lx+OFYYCIoqhuqcXKeR+IzVMW9evPficXMSbCmAhjIoyJMCbCmAhjIoyJMCbCmAhjIoyJMCbCmAhjIoyJMCbCmAhjIoyJMCbCmAhjIoyJMCbCmAhjIoyJMCbCmAhjIoyJMP41/p36Ff9Nvw3FON5xujlznG4GYhxP093KcboZiHE8TXcrx+lmIMbxNN2tHKebgRjH03S3cpxuBmIcT9PdynG6GYhxPE13K8fpZiDG8TTdrRynm4EYx9N0t3KcbgZiHE/T3cpxuhmIcTxNdyvH6WYgxvE03a0cp5uBGMfTdLdynG4GYhzvON2c0XQ3DON4x+nmjKa7YRjHO043ZzTdDcM4mqa7M5ruhmEcTdPdGU13wzCOpunujKa7YRhH03T3iKa7QRhHO043V2i6G4RxLE13V2i6G4RxLE13V2i6G4RxLE13V2m6G4JxJE13z9B0NwTjSJrunqHpbgjGcVbT7bM03Q3AOI6mu6/QdDcA4zia7r5K093mGEfRdPcdmu42xziKprvvWE23G2McYzXdfpemu40xjrCabl9hNd1uinEETXevtJpuN8S4vdV0+2qa7jbEuD1Nd++wmm43w7g1TXfvtJpuN8K4rdV0+05n0/0mGLe0mm5/wmq63QTjdlbT7U9aTbcbYNzKarr9hNV0e3OM2zib7j9lNd3eGOMWzqb7T1tNtzfFeHtn0/0dPJre3AzjrZ1N93fyaHpzI4y39Gh6c1dn0/1NMN7Oo+nN3T2a3nwY4208mt7s5NH05oMYP+7K9G5HV6Z3H8D4MVent7u7Mr37QYw/7ur0dpJnpvdvxvgjnpneT/bM9P5NGN/iq9O3/gbfmb73AoxPe8f0P3+rd0z/8wDjZa+e/iP/e/X0HycYL3vV9O2svXL6/gLjZV+dvpWv+870vQXGy65Ob/M+V6e3JxgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMTn49fsfRY10KYgEzyAAAAAASUVORK5CYII=",name:G("卷边焊缝")},{typeName:Ge.IWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIYAAACECAYAAABVsVOaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAM/SURBVHhe7coxcgIBDARB/v9pTHhB54PwTlUn0r4+vWeAxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4THzTP9f8Uz/L8BjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZjQml3ndIuxmNCaXed0i7GY0Jpd53SLsZj5pn+v+KZ/l+AxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4XGGxxkeZ3ic4XGGxxke5197vf8A1pjJf8df5dQAAAAASUVORK5CYII=",name:G("I型焊缝")},{typeName:Ge.VWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIsAAACGCAYAAADth3khAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAO9SURBVHhe7dBBltQ6EEVB9r9pPjCApn8k7XJZdkp695yYpJ9qUN9+9D3iIB4jhMcI4TFCeIwQHiOExwjhMUJ4jBAeI4THCOExQniMEB4jhMcI4TFCeIwQHiOExwjhMUJ4jBAeI4THCOExQniMEB4jhMcI4TFCeIwQHiOExwjh8SUf0/e43sf0fRAeD1PaxXWUdgPweJjSLq6jtBuAx8OqtI33VWk7AI8vUdrF+5R2g/D4kipt47wqbQfh8WVKuzhPaTcQj6co7eJ1SrvBeDylSts4rkrbwXg8TWkXxyntbsDjaVXaxteqtL0Bj29R2sXXlHY34fEtVdpGrUrbm/D4NqVd1JR2N+LxEkq7+D+l3c14vESVtvFHlbY34/EySrv4Q2n3AB4vU6VttP+/eLyU0i7a/1c8XqpK251VafsQHi+ntNuZ0u5BPA6htNuR0u5hPA5Rpe1OqrR9GI/DKO12orRrgMdhqrTdQZW2DfA4lNJuB0q7JngcqkrblVVp2wSPwyntVqa0a4THWyjtVqS0a4bHW1Rpu5IqbZvh8TZKu5Uo7Rri8TZV2q6gStuGeLyV0m4FSrumeLxVlbYzq9K2KR5vp7SbmdKuMR4fobSbkdKuOR4fUaXtTKq0bY7HxyjtZqK0mwCPj6nSdgZV2k6Ax0cp7WagtJsEj4+q0razKm0nwePjlHadKe0mwmMLSruOlHaT4bGFKm07qdJ2Mjy2obTrRGk3IR7bqNK2gyptJ8RjK0q7DpR2k+KxlSptn1Sl7aR4bEdp9ySl3cR4bElp9wSl3eR4bKlK2ztVaTs5HttS2t1JabcAHtuq0vYOVdougMfWlHZ3UNotgsfWqrQdqUrbRfDYntJuJKXdQnicgtJuBKXdYnicQpW2V6rSdjE8TkNpdyWl3YJ4nEaVtleo0nZBPE5FaXcFpd2ieJxKlbbvqNJ2UTxOR2n3DqXdwnicktLuDKXd4nicUpW2r6jSdnE8Tktp9wql3QZ4nFaVtkdUabsBHqemtDtCabcJHqdWpe2/VGm7CR6np7T7F6XdRnhcgtJOlHab4XEJVdp+VKXtZnhchtLuI6XdhnhcRpW2P1VpuyEel6K0+0lptykel1J1drcxHpejzmw2x+OS1JFv8RuPS3o1/cbmeFzW0fQ2fFzW0fQ2fFzaV+lN/MLj0r5Kb+IXHpdXpW38xuMWPqdN/IXHLXxOm/gLjxHCY4TwGCE8RgiPEcJjhPAYITxGCI8RwmOE8BghPEYIjxHCY4TwGCE8RgiPEZ98+/4famIFigcWF7IAAAAASUVORK5CYII=",name:G("V型焊缝")},{typeName:Ge.SingleVWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAYAAABRRIOnAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAPJSURBVHhe7dLLstMIEERB/v+nYYDwYEy6ryy79Oo+EblplbTSt//6PsYdHkdfPI6+eBx98Tj64nH0xePoi8fRF4+jLx5HXzyOvngcffE4+uJx9MXj6IvH0RePoy8eR188jr54HH3xOPricfTF4+iLx9EXj6MvHkdfPI6+eBx98Tj64nH0xePoi8e4+/R8LHNLz1biMe4xbUbtMW1W4DFKaTeee5a2L+IxSmk37FnarsBjlNJu/KtK+xV4jFLajb9Vab8Sj1FKu/FHlfZv4DFKaTd+q9L+TTxGKe3G5j/DTzxGKe26q9L+Q3iMUtp1VqX9B/EYpbTrqkr7D+MxSmnXUZX2ATxGKe26qdI+hMcopV0nVdoH8RiltOuiSvswHqOUdh1Uab8BHqOUdldXpf1GeIxS2l1ZlfYb4jFKaXdVVdpvjMcopd0VVWm/Ax6jlHZXU6X9TniMUtpdSZX2O+IxSml3FVXa74zHKKXdFVRpfwA8Rintzq5K+4PgMUppd2ZV2h8Ij1FKu7Oq0v5geIxS2p1RlfYHxGOU0u5sqrQ/KB6jlHZnUqX9gfEYpbQ7iyrtD47HKKXdGVRpfwI8Rintjq5K+5PgMUppd2RV2p8Ij1FKu6Oq0v5keIxS2h1RlfYnxGOU0u5oqrQ/KR6jlHZHUqX9ifEYpbQ7iirtT47HKKXdEVRpfwE8Rint9lal/UXwGKW021OV9hfCY5TSbi9V2l8Mj1FKuz1UaX9BPEYp7bZWpf1F8RiltNtSlfYXxmOU0m4rVdpfHI9RSrstVGnfAI9RSru0Ku2b4DFKaZdUpX0jPEYp7VKqtG+GxyilXUKV9g3xGKW0+7Qq7ZviMUpp90lV2jfGY5TS7lOqtG+Oxyil3SdUaT98jFLavatK+/ELj1FKu3dUaT/+x2OU0m6tKu3HX3iMUtqtUaX9+AePUUq7V1VpP4jHKKXdK6q0H0/xGKW0W6pK+1HiMUppt0SV9uNLPEYp7b5Spf1YhMcopV2lSvuxGI9RSrtnqrQfL+ExSmknVdqPl/EYpbR7VKX9WIXHKKXdvSrtx2o8Rintbqq0H2/hMUpp91OV9uNtPEappbtb2o+P4DFKLdncetyOj+IxSn31/Nb9bkTwGKWqZ7fuvzFieIxSz+63Hr8xYniMejV9Y8TwGPVKen9E8Ri1NL074niMWpLeG5vgMeqr9M7YDI9RVdqPTfEY9Sxtx+Z4jHtMm7ELHkdfPI6+eBx98Tj64nH0xePoi8fRF4+jLx5HXzyOvngcffE4+uJx9MXj6IvH0dK37z8A73de+HhGe7kAAAAASUVORK5CYII=",name:G("单边V型焊缝")},{typeName:Ge.SingleSteepVWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIYAAACGCAYAAAAYefKRAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAANoSURBVHhe7c8xbiRADANB///TPl9qVLpDSWYDlQhM9PXTdxXwWMVjFY9VPFbxWMVjFY9VPFbxWMVjFY9VPFbxWMVjFY9VPFbxWMVjFY9VPFbxWMVjFY9VPFbxWMXjGP/T/a8I/s/jCL/T5rLfafNBPMYp7a5S2n0Qj3FKu6uUdh/EY5zS7iql3QfxGKe0u0hp92E8xintLlLafRiPcUq7i5R2H8ZjnNLuGqXdAzzGKe2uUdo9wGOc0u4Spd0jPMYp7S5R2j3CY5zS7hKl3SM8xintrlDaPcRjnNLuCqXdQzzGKe2uUNo9xGOc0u4Cpd1jPMYp7S5Q2j3GY5zS7gKl3WM8xinttlPaBfAYp7TbTmkXwGOc0m47pV0Aj3FKu82UdiE8xintNlPahfAYp7TbSmkXxGOc0m4rpV0Qj3FKu62UdkE8xintNlLahfEYp7TbSGkXxmOc0m4jpV0Yj3FKu22UdgPwGKe020ZpNwCPcUq7bZR2A/AYp7TbRGk3BI9xSrtNlHZD8BintNtEaTcEj3FKuy2UdoPwGKe020JpNwiPcUq7DZR2w/AYp7TbQGk3DI9xSrsNlHbD8BintJtOaTcQj3FKu+mUdgPxGKe0m05pNxCPcUq7yZR2Q/EYp7SbTGk3FI9xSrvJlHZD8RintJtKaTcYj3FKu6mUdoPxGKe0m0ppNxiPcUq7iZR2w/EYp7SbSGk3HI9xSrtplHYL8BintJtGabcAj3FKu2mUdgvwGKe0m0RptwSPcUq7SZR2S/AYp7SbRGm3BI9xSrsplHaL8BintJtCabcIj3FKuymUdovwGKe0m0BptwyPcUq7CZR2y/AYp7SbQGm3DI9xSrs0pd1CPMYp7dKUdgvxGKe0S1LaLcVjnNIuSWm3FI9xSrskpd1SPMYp7VKUdovxGKe0S1HaLcZjnNIuRWm3GI9xSrsEpd1yPMYp7RKUdsvxGKe0S1DaLcdjnNLuNaXdATzGKe1eU9odwGOc0u41pd0BPMYp7V5S2h3BY5zS7iWl3RE8xintXlHaHcJjnNLuFaXdITzGXUr/LcBj3KX03wI8xl1LPw7H4whX0m8L8DjG9vTTEjxW8VjFYxWPVTxW8VjFYxWPVTxW8VjFYxWPVTxW8VjFYxWPVTxW8VjFYxWPVTzWn/b1/Q8BUEg5iTSvRAAAAABJRU5ErkJggg==",name:G("单边陡侧V型坡口堆焊")},{typeName:Ge.InclinedWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIgAAACKCAYAAABxcgJZAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAL9SURBVHhe7ctZbiMxEATRuf+lPYbhAryEO0tSq8UlEng/Qda/971JBzBKBaNUMEoFo1QwSgWjVDBKBaNUMEoFo1QwSgWjVDBKBaNUMEoFo1QwSgWjVDBKBaNUMEoFo1QwSgWjVDBKBaOepEZvg8Kok9Ho34Aw6kRHo/+DwaiTHI3+DwijHpRGN4PCqAek0c3AMOoOndHd4DDqRml0MwmMauqM7iaCUQ1pdDMhjArS6GZSGPWHNLqZHEaBNLpZAEZ90RndLQKjPqXRzWIwbq8zulsQxq2l0c3CMG4rjW4Wh3E7aXSzCYxbSaObjWDcQmd0txmMy0ujm01hXFZndLcxjEtKoxtxXE4a3egDxmWk0Y2+wbiENLrRLxin1hndCWGcVhrd6BDG6XRGd4owTiWNbtSGcRppdKObYBxeGt3oLhiHlkY3uhvGIXVGd3oIxuGk0Y1OgXEYndGdToNxCGl0o9NhfLk0utFTYHyZNLrRU2F8iTS60dNhvFRndDejr6P3AWG81NHo/4xo9G9AGC/11+jvjI5G/weD8VI/R39mlEY3A8J4uRq9zSiNbgaFUXfqjO4GhlF3SKObCWDUjdLoZhIY1ZRGN5PBqIY0upkQRh3ojO4mhVF/SKObyWHUD53R3QIw6os0ulkIRn1Ko5vFYNxeGt0sCuPW0uhmYRi31BndLQ7jdtLoZhMYt9EZ3W0E4xbS6GZDGJeXRjebwrisNLrZHMYlpdGNOC6lM7rTB4zLSKMbfYNxep3RnX7BOLU0utGfME4rjW50CON00uhGLRinkkY3asM4hc7oTjfBOLw0utFdMA6rM7rT3TAOKY1u9DCMw0mjG50C4zDS6EanwjiENLrR6TC+VGd0p6fA+DJpdKOnwni5zuhOT4fxUml0o8tgvNTR6L8uhfFSNPqnl8B4qZ+jP3oZjFLBKBWMUsEoFYxSwSgVjFLBKBWMUsEoFYxSwSgVjFLBKBWMUsEoFYxSwSgVjFLBKBWMUsEoFYxSwSgVjFLBKL379/YfTIZSIZ+GYOYAAAAASUVORK5CYII=",name:G("倾斜焊缝")},{typeName:Ge.RemovablePadding1,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAYAAABSZ763AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAorSURBVHhe7dLLimNBDkXR/v+f7m4PEhKx/AjLkm8WZ8Oa6J4oXJD/+X//jYh1PEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8ePSemvp7/rD+DxI1L6V9LfdxOPbSn9a+nvvIHHtpT+tfR33sBjW0r/Wvo7b+CxTWkXcUVKuwYe25R2EVektGvgsU1pF3FFSrsGHtuUdhFXpLRr4LFNabftd/p+Jb/T93dsp9/wFyjtGnhsU9ptqmlzFUq7U99Mv+eqlHYNPLYp7TYp7a5AaXfqCul3XY3SroHHNqXdJqXdt91L21NXSr/vKpR2DTy2Ke02Ke2+7V7anrpa+o1XoLRr4LFNabfpXtp+0720PVXT5pNeSe++TWnXwGOb0m7TvbT9pntpe6qmzYRn6c03Ke0aeGxT2m26l7bf8ijtT9W0mXYvbb9FadfAY5vSbtO9tP2WR2l/qqbNBqXdtyjtGnhsU9ptepT23/Ao7U/VtNlwL22/QWnXwGOb0m7To7Tf9iy9OVXTZovS7huUdg08tintNj1K+23P0ptTNW02Ke22Ke0aeGxT2m16lt5sepbenKpps0lpt01p18Bjm9Ju07P0Zssr6d2pmjablHbblHYNPLYp7TY9S2+2vJLenapps01pt0lp18Bjm9Ju0yvp3YZX0rtTNW22Ke02Ke0aeGxT2m16Jb3b8Ep6d6qmzTal3SalXQOPbUq7Ta+kd9NeTW9P1bTZprTbpLRr4LFNabepptut+m7aq+ntqZo225R2m5R2DTy2Ke021XS7Vd9NezW9PVXTZpvSbpPSroHHNqXdppput+q7SerRvaumzTal3SalXQOPbUq7TbVn9w3q0b2rps02pd0mpV0Dj21Ku021e/dbv99NUo/uXTVttintNintGnhsU9ptqt273/r9bop65VtHTZttSrtNSrsGHtuUdptq9+63fr+bol751lHTZtO9tN2ktGvgsU1pt6n26Nut398nqFe+ddS02aS026a0a+CxTWm3qfbo263f3z9NnXx/V02bTUq7bUq7Bh7blHabao++3fr9/dPUyfd31bTZorT7BqVdA49tSrtNtWffb9XNp6iT7++qabNFafcNSrsGHtuUdptqz77fqptPqT37fqtu3lHTZsO9tP0GpV0Dj21Ku021Z99v1c0nqHc276hpM+1e2n6L0q6Bxzal3abau5su9c7mHTVtpjxK+29S2jXw2Ka021R7ZXNLuw71zuYdNW0+7Vl6821KuwYe25R2m2qvbG5p9y7V2Z2qafMJJ+n9tyntGnhsU9ptqr2yuaXdu1Rnd+pq6TdegdKugcc2pd2mmjY3Srt3qM7u1FXSb7sSpV0Dj21Ku001bW6UdqeUdjdKu1PfTL/nqpR2DTy2Ke021bS5UdqdUtrdKO1OfSP9jqtT2jXw2Ka021TT5ofS7oTS7kZpd6qmzavupe1fo7Rr4LFNabepps0Ppd2JmjY/lHanatqcUNr9NUq7Bh7blHabatr8UNq9Smn3Q2l3qqbNiXtp+5co7Rp4bFPabapp85vS7hVKux9Ku1M1bU4p7f4SpV0Dj21Ku001bX5T2r1CafdDaXeqps2pe2n7VyjtGnhsU9ptqmnzm9LuGaXdb0q7UzVt3qG0+yuUdg08tintNtW0qWraPKO0+01pd6qmzbuUdn+B0q6Bxzal3aaaNpXS7hGl3W9Ku1M1bd6ltPsLlHYNPLYp7TbVtKmUdvco7Sql3amaNh1Ku6tT2jXw2Ka021TTplLa3aO0q5R2p2radCjtrk5p18Bjm9JuU00bUdqJ0q5S2p2qadOltLsypV0Dj21Ku001bURpVyntRGl3qqZNl9LuypR2DTy2Ke021bQRpV2ltBOl3amaNp+gtLsqpV0Dj21Ku001be5R2v2mtBOl3amaNp+gtLsqpV0Dj21Ku001be5R2v1W0+Yepd2pmjaforS7IqVdA49tSrtNNW3uUdr9UNrdo7Q7VdPmU5R2V6S0a+CxTWm3qabNIzVtfijt7lHanapp80lKu6tR2jXw2Ka021TT5hGl3Y3S7h6l3amaNp+ktLsapV0Dj21Ku001bR5Rnd0jSrtTNW0+TWl3JUq7Bh7blHabato8ojq7R5R2p2rafJrS7kqUdg08tintNtW0eUa9s3lGaXeqps0Epd1VKO0aeGxT2m2qafOMOvn+KqXdqZo2E5R2V6G0a+CxTWm3qabNM+rk+6uUdqdq2kxR2l2B0q6Bxzal3aaaNq9Qr3w7obQ7VdNmitLuCpR2DTy2Ke021bR5hXp0f4fS7lRNm0lKu29T2jXw2Ka021TT5hXq0f0dSrtTNW0mKe2+TWnXwGOb0m5TTZtXvZrevkJpd6qmzTSl3Tcp7Rp4bFPabapp86pX09tXKO1O1bSZdi9tv0Vp18Bjm9JuU02bV72S3r1KaXeqps0Gpd23KO0aeGxT2m2qaXPiWXrzKqXdqZo2G+6l7Tco7Rp4bFPabappc+JZevMqpd2pmjZblHbfoLRr4LFNabepps2JR2l/Qml3qqbNlntpu01p18Bjm9JuU02bE4/S/oTS7lRNm01Ku21KuwYe25R2m2ranLqXtieUdqdq2my6l7ablHYNPLYp7TbVtDmltDultDtV02ab0m6T0q6Bxzal3aaaNqeUdqeUdqdq2mxT2m1S2jXw2Ka021TT5h01bU7VtHlHTZtvqGmzSWnXwGOb0u5fMfX/m/p3r+hK/1elXQOPbUq7iCtS2jXw2Ka0i7gipV0Dj21Ku4grUto18NimtIu4IqVdA49tSruIK1LaNfDYprSLuCKlXQOPH1HTJuKKato08fgxP+lbxJX9pG8fwGNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbEmP/893/f80bLRIOECQAAAABJRU5ErkJggg==",name:G("可移除衬垫")},{typeName:Ge.RemovablePadding2,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAANgAAADHCAYAAAB7oJ2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAakSURBVHhe7dPLrhtXEkVB//9PuxvwQH7ElX2OkiWKuRYQk+QuoAbF3/7f70lehsckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3hMMoPHJDN4TDKDxyQzeEwyg8ckM3i8UvUJ6dv+ATweq/qk9I1f4vFY1Selb/wSj8eqPil945d4PFb1Sekbv8TjMaVd8m6Udpd4PKa0S96N0u4Sj8eUdsm7Udpd4vGY0i55N0q7SzweU9pt9TPSe+SflHaXeDymtNvoZ6d3yjdKu0s8HlPabfRO6f22U9pd4vGY0m6jd0zvuZXS7hKPx5R2GyntJpyk5zdS2l3i8ZjSbiOl3aT/kp7bSGl3icdjSruNlHav8r2030Zpd4nHY0q7jZR2r/ZV2m6itLvE4zGl3UZKuyco7TZR2l3i8ZjSbiOl3RO+StstlHaXeDymtNtIafcUpd0WSrtLPB5T2m2ktHvKV2m7gdLuEo/HlHYbKe2epLTbQGl3icdjSruNlHZPUtptoLS7xOMxpd1GSrunKe0+ndLuEo/HlHYbKe2eprT7dEq7SzweU9ptpLR7mtLu0yntLvF4TGm3kdLuaUq7T6e0u8TjMaXdRkq7pyntPp3S7hKPx5R2Gyntnqa0+3RKu0s8HlPabaS0e5rS7tMp7S7xeExpt5HS7mlKu0+ntLvE4zGl3UZKu6cp7T6d0u4Sj8eUdhsp7Z70Vdp+OqXdJR6PKe02Uto9SWm3gdLuEo/HlHYbKe2epLTbQGl3icdjSruNlHZPUdptobS7xOMxpd1GSrunKO22UNpd4vGY0m4jpd0TvkrbLZR2l3g8prTbSGn3al+l7SZKu0s8HlPabaS0e6Xvpf0mSrtLPB5T2m2ktHuFf0vPbKO0u8TjMaXdRkq7Kf81PbuR0u4Sj8eUdhu9Y3rPrZR2l3g8prTb6N3SO26mtLvE4zGl3Ubvkt4t/cF+eT8zvU/+Sml3icdjSruNfkZ6j5jS7hKPx5R2Gynt/quv0jb/Tml3icdjSruNlHYnlHb5d0q7SzweU9ptpLQ78VXa5vuUdpd4PKa020hpd0ppl+9T2l3i8ZjSbiOl3amv0jZfU9pd4vGY0m4jpd0NpV2+prS7xOMxpd1GSrsbX6VtTGl3icdjSruNlHa3lHYxpd0lHo8p7TZS2t36Km3zT0q7SzweU9ptpLT7EUq7/JPS7hKPx5R2GyntfsRXaZu/Utpd4vGY0m4jpd2PUtrlr5R2l3g8prTbSGk3QWmXb5R2l3g8prTbSGk3QWmXb5R2l3g8prTbSGk3RWmXPyjtLvF4TGm3kdJuitIuf1DaXeLxmNJuI6XdJKVd+oP98pR2k5R26Q/2y1PaTVPabae0u8TjMaXdRkq7aUq77ZR2l3g8prTbSGn3Ckq7zZR2l3g8prTbSGn3Ckq7zZR2l3g8prTbSGn3Kkq7rZR2l3g8prTbSGn3Kkq7rZR2l3g8prTbSGn3Skq7jZR2l3g8prTbSGn3Skq7jZR2l3g8prTbSGn3akq7bZR2l3g8prTbSGn3akq7bZR2l3g8prTbSGn3BKXdJkq7SzweU9ptpLR7gtJuE6XdJR6PKe02Uto9RWm3hdLuEo/HlHYbKe2eorTbQml3icdjSruNlHZPUtptoLS7xOMxpd1GSrsnKe02UNpd4vGY0m4jpd3TlHafTml3icdjSruNlHZPU9p9OqXdJR6PKe22+nP6/Wf5c/p9A6XdJR6PKe2Sd6O0u8TjMaVd8m6Udpd4PKa0S96N0u4Sj8eUdsm7Udpd4vGY0i55N0q7SzweU9ol70Zpd4nHY0q75N0o7S7xeOzvaZO8q7+nzSUek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpPM4DHJDB6TzOAxyQwek8zgMckMHpP8sN9+/x86HHd2B1To+QAAAABJRU5ErkJggg==",name:G("可移除衬垫")},{typeName:Ge.DurableLiner,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADMCAYAAAAceR0nAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAgjSURBVHhe7dLBjsNGDETB/P9PJ9HBgEGUbMlc7hoz/YC6UD03/fN//0bEr+MxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbx+CNSWiX93008tqW0UvrHm3hsS2ml9I838diW0krpH2/isU1pF/GNato08dimtIv4RjVtmnhsU9pFfKOaNk08tintIr5RTZsmHtuUdqt7pG/f5pG+7aamTROPbUq7ldW0+RY1bXZS06aJxzal3cqUdt9AabeLmjZNPLYp7VamtPsGSrtd1LRp4rFNabcypd1fO0vbXdS0aeKxTWm3MqXdXztL213UtGnisU1pt7KztP1LZ2m7i5o2TTy2Ke1Wdpa2f+VV2u+ipk0Tj21Ku5Wdpe1feZX2u6hp08Rjm9JuZa/S/i+8Svtd1LRp4rFNabeyV2n/296lN7uoadPEY5vSbmWv0v63vUtvdlHTponHNqXdyt6lN7/pXXqzi5o2TTy2Ke1W9i69+U3v0ptd1LRp4rFNabeyd+nNb7mS3u2ipk0Tj21Ku5VdSe9+w5X0bhc1bZp4bFParexKevcbrqR3u6hp08Rjm9JuZVfSu2lX09td1LRp4rFNabeyK+ndtKvp7S5q2jTx2Ka0W1lNt6P6btrV9HYXNW2aeGxT2q2spttRfTdJvbrvqqZNE49tSruV1XQ7qu8mqVf3XdW0aeKxTWm3strZ/ej53ST16r6rmjZNPLYp7VZWO7sfPb+bVDu7Hz2/201NmyYe25R2K6ud3Y+e301RV77tqKZNE49tSruV1V59O3r+PkFd+bajmjZNPLYp7VZWe/Xt6Pn7BHXl245q2jTx2Ka0W1nt1bej5+8/Td35vpuaNk08tintVla7+/0nqTvfd1PTponHNqXdymrvvh/VzU9Rd77vpqZNE49tSruV1d59P6qbn6A+2eykpk0Tj21Ku5XV3n0/qpufoD7Z7KSmTROPbUq7ldWubI6061CfbHZS06aJxzal3cpqVzZH2n1KdXa7qGnTxGOb0m5ltSubI+0+pTq7XdS0aeKxTWm3spo2B6XdJ1Rnt4uaNk08tintVlbT5qC0+0RNm4PSbhc1bZp4bFParaymzUFpd5fS7qC020VNmyYe25R2K6tp86C0u0Npd1Da7aKmTROPbUq7ldW0eVDa3aG0OyjtdlHTponHNqXdymraPCjtrlLaPSjtdlHTponHNqXdymraPKtpc5XS7kFpt4uaNk08tintVlbT5pnS7gql3YPSbhc1bZp4bFParaymzTOl3TtKu2dKu13UtGnisU1pt7KaNs+Udu8o7Z4p7XZR06aJxzal3cpq2lRKu1eUds+UdruoadPEY5vSbmU1bSql3RmlXaW020VNmyYe25R2K6tpUyntzijtKqXdLmraNPHYprRbWU0bUdqJ0q5S2u2ipk0Tj21Ku5XVtBGlnSjtKqXdLmraNPHYprRbWU0bUdpVSjtR2u2ipk0Tj21Ku5XVtDlT06ZS2onSbhc1bZp4bFParaymzRml3TOlnSjtdlHTponHNqXdymranFHaPSjtzijtdlHTponHNqXdymranFHaPSjtzijtdlHTponHNqXdymravKK0OyjtzijtdlHTponHNqXdymravKI6u1eUdruoadPEY5vSbmU1bV5Rnd0rSrtd1LRp4rFNabeymjbvqE827yjtdlHTponHNqXdymravKPeber3K5R2u6hp08Rjm9JuZTVt3lF3vl+ltNtFTZsmHtuUdiuraXOFuvLtDqXdLmraNPHYprRbWU2bK9SVb3co7XZR06aJxzal3cpq2lyhXt0/obTbRU2bJh7blHYrq2lzVU23o/ruKqXdLmraNPHYprRbWU2bq66mt1co7XZR06aJxzal3cpq2lx1Jb27Smm3i5o2TTy2Ke1WVtPmqivp3VVKu13UtGnisU1pt7KaNne8S2+uUtrtoqZNE49tSruV1bS541Xa36G020VNmyYe25R2K6tpc8ertL9DabeLmjZNPLYp7VZW0+aus7S9Q2m3i5o2TTy2Ke1WVtPmrrO0vUNpt4uaNk08tintVlbT5i6l3V1Ku13UtGnisU1pt7KaNp+oaXNXTZud1LRp4rFNabe6R/r2qef0/VPP6ftOato08dimtIv4RjVtmnhsU9pFfKOaNk08tintIr5RTZsmHtuUdhHfqKZNE49tSruIb1TTponHNqVdxDeqadPEY5vSLuIb1bRp4vFHPKfvEd+qpk0TjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIhZPEbELB4jYhaPETGLx4iYxWNEzOIxImbxGBGzeIyIWTxGxCweI2IWjxExi8eImMVjRMziMSJm8RgRs3iMiFk8RsQsHiNiFo8RMYvHiJjFY0TM4jEiZvEYEbN4jIgx//z7H//k+3DTA6wPAAAAAElFTkSuQmCC",name:G("持久衬垫")},{typeName:Ge.VFlangedEdgeSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAI8AAACZCAYAAAAW7GkVAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAARYSURBVHhe7cvRbh03EERB//9POwmNGIpTI1HS3V2S0weol2Hzx9/9jPgiHiNm8Bgxg8eIGTxGzOAxYgaPETN4jJjBY8QMHiNm8Bgxg8eIGTxGzOAxYgaPETN4jJjB40u9Te/xPW/T+4V4fBmlXXyN0u4iPL5MlbbxOVXaXoTHl1Laxeco7S7E40tVaRtzqrS9EI8vV6VtfExpdzEeL6G0i/cp7W7A4yWqtA2r0vYGPF6mStv4P6XdTXi8lNIu/qtK25vweKkqbeOXKm1vxOPllHbxi9LuZjxerkrb7qq0vRmPt6jStjOl3QN4vI3Sriul3UN4vE2Vtt1UafsQHm9VpW0nSrsH8Xg7pV0XVdo+iMfbVWl7uiptH8bjI5R2p1PaLYDHR1Rpe6oqbRfA42OqtD2R0m4RPD5KaXcapd1CeHxUlbanqNJ2ITw+rkrbEyjtFsPjEpR2u6vSdjE8LqFK211VabsgHpehtNuV0m5RPC6jStvdVGm7KB6XUqXtTpR2C+NxOUq7XSjtFsfjcqq0XV2VtovjcUlV2q5MabcBHpeltFtVlbYb4HFZVdqupkrbTfC4NKXdapR2G+FxaVXarqJK243wuLwqbVegtNsMj1tQ2j1NabchHrdQpe1TqrTdEI/bqNL2CUq7TfG4FaXd3aq03RSPW6nS9i5V2m6Mx+0o7e6itNscj9up0vZqVdpujsctVWl7JaXdAXjcltLuKkq7Q/C4rSptX61K20PwuLUqbV9JaXcQHrentHuVKm0PwuP2qrT9riptD8PjEZR236W0OxCPR6jS9quqtD0Qj8eo0vYrlHaH4vEoSrvPUtodjMejVGk7q0rbg/F4nCptZyjtDsfjkZR2H6nS9nA8HqlK20qVtg3weCylXUVp1wSPx6rS9k9V2jbB49GqtH1LadcIj8dT2v1LadcMj8er+u62GR5bqJrZ/blpisc21Efv//R20xiPbVR99BYDj62o9+7xG4+tfCb9b4zHdmbSv+Z4bOm9tA8fW3ov7cPHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsS2lXQw8tqW0i4HHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsS2lXQw8tqW0i4HHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsS2lXQw8tqW0i4HHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsS2lXQw8tqW0i4HHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsS2lXQw8tqW0i4HHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsS2lXQw8tqW0i4HHtpR2MfDYltIuBh7bUtrFwGNbSrsYeGxLaRcDj20p7WLgsbW36T1+4zFiBo8RM3iMmMFjxAweI2bwGDGDx4gZPEbM4DFiBo8RH/jx8y+Pl33WETfr+QAAAABJRU5ErkJggg==",name:G("带顿边V型焊缝")},{typeName:Ge.UFlangedEdgeSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJIAAACfCAYAAAAS5YBQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAATXSURBVHhe7c7bbgM3EETB/P9PJwQTBAlRK3tmL5TsPkC9jJpr/zH6M+ICPEZU8RhRxWNEFY8RVTxGVPEYUcVjRBWPEVU8RlTxGFHFY0QVjxFVPEZU8RhRxWNEFY8RVTxGVPEYUcVjRBWPEVU8tvw3/R77rWnTxGPLmjax15o2TTyWKe1irzVtmngsU9rFXmvaNPFYprSLvda0aeKxTGkXe61p08RjmdIu9lrTponHMqVd7LWmTROPZUq72GtNmyYey5R2sdeaNk08lintYq81bZp4LFPaxV5r2jTxWKa0i73WtGnisUxpF3utadPEY5nSLvZa06aJxzKlXey1pk0Tj2VKu9hrTZsmHsuUdrHXmjZNPJYp7WKvNW2aeCxT2sVea9o08VimtIu91rRp4rFMaRd7rWnTxGOZ0i72WtOmiccypV3staZNE49lSrvYa02bJh7LlHax15o2TTyWKe1irzVtmngsU9rFXmvaNPFYprSLvda0aeKxTGkXe61p08RjmdIu9lrTponHMqVd7LWmTROPZUq72GtNmyYey5R2sdeaNk08lintYq81bZp4LFPaxV5r2jTxWKa0i73WtGnisUxpF3utadPEY8uaNrHXmjZNPLasaRN7rWnTxGPLmjaxj9KuiccWpV3sobRr4rFFaRd7KO2aeGxR2sUeSrsmHluUdrGH0q6JxxalXeyhtGvisUVpF3so7Zp4bFHaxR5r2pzAY5vSLp6ltDuBxzalXTxLaXcCj21Ku3iW0u4EHtuUdvGsNW1O4vEUpV08Q2l3Eo+nKO3iGUq7k3g8RWkXz1DancTjaUq7uJfS7gI8nqa0i3sp7S7A42lHaRv3OErbC/B4CaVd3ENpdxEeL3GUtnGto7S9CI+XUdrFtZR2F+LxMkq7uM5R2l6Ix0sp7eIaSruL8Xipo7SNc47S9mI8Xk5pF+co7W7A4+WO0jZ6jtL2Bjze4ihto+YobW/C422UdvF9R2l7Ix5vc5S28T1HaXsjHm91lLbx2lHa3ozH2x2lbdhR2j6Ax9u9Svv4v6O0fQiPj3iV9vG3V2n/EB4f8yrtf7tXaf8gHh/1Ku1/q1dp/zAeH/cq7X+bV2m/AY9bvEr73+JV2m/C4zav0v4n+yq92YjHrb5Kb36ar9KbzXjc7qv05qf4Kr15Azy+ja/Sm0/1VXrzRnh8K99J7z7Fd9K7N8Pj2/luevuuvpveviEe39Z309t38d309o3x+NYq6f0ulfT+zfH4ETrpO3fppO98CB4/Sjd964wz6XsfhsePdEdPfv/D8fjR3j39zz8Ajz/GO6X/7wfh8cd6Mv39H4zHX+PK9P1fhMcYlHYx8RiD0i4mHmNQ2sXEYwxKu5h4jEFpFxOPMSjtYuIxBqVdTDzGoLSLiccYlHYx8RiD0i4mHmNQ2sXEYwxKu5h4jEFpFxOPMSjtYuIxBqVdTDzGoLSLiccYlHYx8RiD0i4mHmNQ2sXEYwxKu5h4jEFpFxOPMSjtYuIxBqVdTDzGoLSLiccYlHYx8RiD0i4mHmNQ2sXEYwxKu5h4jEFpFxOPMSjtYuIxBqVdTDzGoLSLiccYlHYx8RiD0i4mHuMf/02/x794jKjiMaKKx4gqHiOqeIyo4jGiiseIKh4jqniMqOIxoorHiII//vwLaaN9R7Ov7yUAAAAASUVORK5CYII=",name:G("带顿边U型焊缝")},{typeName:Ge.SingleVFlangedEdgeSeam,img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJkAAACdCAYAAACnzdqsAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAASxSURBVHhe7dJBctRAEERR7n9pgyEAk/zpmrFLyi4pf8Tb5FRr4fC3H71FHAzHiE44RnTCMaITjhGdcIzohGNEJxwjOuEY0QnHiE44RnTCMaITjhGdcIzohGNEJxwjOuEY0QnHiE44RnTCMaITjhGdcIzohOM23qM9vu7Evy2OdhrdxOdpdNMIRzuNbuJ1j6LbRjjaaXQTr1lF941wtNPoJp63iu6b4Win0U08ZxXdHwBHO41uYq2K3hwERzuNbuKxKnpzIBztNLoJVkVvDoajnUY38b9VdH8SHO00uom/qujNiXC00+gmfqmiNyfD0U6jmxjxD/YORzuNbu5uFd0b4Win0c1dVdEbMxztNLq5oyp6swEc7TS6uZsqerMJHO00urmTVXS/GRztNLq5gyp6syEc7TS6uboqerMpHO00urmyKnqzMRztNLq5qlV0PwCOdhrdXE0VvRkCRzuNbq6kit4MgqOdRjdXUUVvhsHRTqObK1hF90PhaKfRzWRV9GYwHO00upmqit4Mh6OdRjcTVdGbC8DRTqObaVbR/YXgaKfRzRRV9OZicLTT6GaCKnpzQTjaaXSzuyp6c1E42ml0s7NVdH9xONppdLOjKnpzAzjaaXSzmyp6cxM42ml0s5MqenMjONppdLOLVXR/QzjaaXTjVkVvbgpHO41unKrozY3haKfRjUsVvbk5HO00unFYRffxE452Gt2cqYrexB842ml0c5YqehP/wNFOo5szVNGb+A+OdhrdHG0V3cdDONppdHOUKnoTSzjaaXRzhCp6EyUc7TS66VZFb+IpONppdNNpFd3HS3C00+imQxW9iZfhaKfRzVdV0Zv4FBztNLr5iip6E5+Go51GN5+1iu7jy3C00+jmVVX0JlrgaKfRzSuq6E20wdFOo5tnVdGbaIWjnUY3z1hF93EIHO00ulmpojdxGBztNLp5pIrexKFwtNPohlTRmzgcjnYa3ahVdB+nwdFOo5vfquhNnApHO41u3lXRmzgdjnbaMzcavQkLHO206veP6W3Y4WinPdq1j9+IbeBop9Gm6TdiGzjavRp9I7aBo92z0dvYDo52z0TvYks42lXRm9gWjnar6D62hqMdRXcxAo52Gt3EGDjaaXQTY+Bop9FNjIGjnUY3MQaOdhrdxBg42ml0E2PgaKfRTYyBo51GNzEGjnYa3cQYONppdBNj4Gin0U2MgaOdRjcxBo52Gt3EGDjaaXQTY+Bop9FNjIGjnUY3MQaOdhrdxBg42ml0E2PgaKfRTYyBo51GNzEGjnYa3cQYONppdBNj4Gin0U2MgaOdRjcxBo52Gt3EGDjaaXQTY+Bop9FNjIGjnUY3MQaOdhrdxBg42ml0E2PgaKfRTYyBo51GNzEGjnYa3cQYONppdBNj4Gin0U2MgaOdRjcxBo52Gt3EGDjaaXQTY+Bop9FNjIGjnUY3MQaOdhrdxBg42ml0E2PgaKfRTYyBo51GNzEGjnYa3cQYONppdBNj4Gin0U2MgaOdRjcxBo52Gt3EGDjaaXQTY+Bop9FNjIGjnUY3MQaOdhrdxBg4buFj9HuMgWNEJxwjOuEY0QnHiE44RnTCMaITjhFNvr19B8xBuQucEkh1AAAAAElFTkSuQmCC",name:G("带顿边单边V型焊缝")},{typeName:Ge.SingleUFlangedEdgeSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJsAAACmCAYAAADNhf3/AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAShSURBVHhe7c1bbmNHFATB2f+mx4YBA7YQ1LzUaiZVCcTPYTXvt7/7PvNJeJw5gceZE3icOYHHmRN4nDmBx5kTeJw5gceZE3icOYHHmRN4nDmBx5kTeJw5gceZE3icOYHHmRN4nDmBx5kTeJw5gcest2lT89/0ewiPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSrsSpV0Ej0lKuxKlXQSPSUq7EqVdBI9JSruSt2kTwmOS0q7kbdqE8JiktCt5mzYhPCYp7Urepk0Ij0lKuwqlXQiPSUq7CqVdCI9JSrsKpV0Ij0lKu4q3aRPDY5LSrkBpF8NjktKuQGkXw2OS0q5AaRfDY5LSrkBpF8NjktLu2SntgnhMUto9O6VdEI9JSrtn9ihtg3hMUto9M6VdFI9JSrtnprSL4jFJafeslHZhPCYp7Z6V0i6MxySl3TNS2sXxmKS0e0ZKuzgek5R2z+ZR2sbxmKS0eyaP0vYF8JiktHsmSrsXwWOS0u5ZPErbF8FjktLuWSjtXgiPSUq7Z/AobV8Ij0lKu9sepe2L4TFJaXfTo7R9QTwmKe1ueZS2L4rHJKXdDe+l/YviMUlp99neS/sXxmOS0u4zvZf2L47HJKXdZ3kv7b8AHpOUdp/hvbT/InhMUtqd9l7afyE8JintTnov7b8YHpOUdif8KL35gnhMUtp9tB+lN18Uj0lKu4/yo/Tmi+MxSWn3p34mvRsfk5R2v+tn09v5B49JSrtf9bPp7fwPj0lKu5/xK+n9EI9JSrtHfif9zzzEY5LS7l9/kv5vfojHpNPpm/NLeEw6lb41v4XHpI9O35g/wmPSn6T/mw/HY9KvpPdzHI9JSru5hsckpd1cw2OS0m6u4TFJaTfX8JiktJtreExS2s01PCYp7eYaHpOUdnMNj0lKu7mGxySl3VzDY5LSbq7hMUlpN9fwmKS0m2t4TFLazTU8Jint5hoek5R2cw2PSUq7uYbHJKXdXMNjktJuruExSWk31/CYpLSba3hMUtrNNTwmKe3mGh6TlHZzDY9JSru5hsckpd1cw2OS0m6u4TFJaTfX8JiktJtreExS2s01PCYp7eYaHpOUdnMNj0lKu7mGx6y3aTPX8Jj1Nm3mGh5nTuBx5gQeZ07gceYEHmdO4HHmBB5nTuBx5gQeZ07gceYEHmdO4HHmBB5nTuBx5gQeZ07gceYEHmdO4HHmBB5nPti3738BHyoaKTaEOZ4AAAAASUVORK5CYII=",name:G("带顿边单边U型焊缝")},{typeName:Ge.EndWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAKIAAACiCAYAAADC8hYbAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAZbSURBVHhe7coxamBBEENB3//S3g2NqFB8RDMPKunWz/9+n2cAj8/zNR6f52s8Ps/XeHyer/H4PF/j8Xm+xuPzfI3H5/kaj8/zNR6f52s8Ps/XeHyer/H4PF/j8Xm+xuPzfI3H5/kaj8/zNR6f52s8Ps/XeJyXadOQadPyN/2P43Ga0q4h06ZBaXcYj9OUdg2ZNg1Ku8N4nKa0a8i0aVDaHcbjNKVdQ6ZNg9LuMB6nKe0aMm0alHaH8ThNadeQadOgtDuMx2lKu4ZMmwal3WE8TlPaNWTaNCjtDuNxmtKuIdOmQWl3GI/TlHYNmTYNSrvDeJymtGvItGlQ2h3G4zSlXUOmTYPS7jAepyntGjJtGpR2h/E4TWnXkGnToLQ7jMdpSruGTJsGpd1hPE5T2jVk2jQo7Q7jcZrSriHTpkFpdxiP05R2DZk2DUq7w3icprRryLRpUNodxuM0pV1Dpk2D0u4wHqcp7RoybRqUdofxOE1p15Bp06C0O4zHaUq7hkybBqXdYTxOU9o1ZNo0KO0O43Ga0q4h06ZBaXcYj9OUdg2ZNg1Ku8N4nKa0a8i0aVDaHcbjNKVdQ6ZNg9LuMB6nKe0aMm0alHaH8ThNadeQadOgtDuMx2lKu4ZMmwal3WE8TlPaNWTaNCjtDuNxmtKuIdOmQWl3GI/TlHYNmTYNSrvDeJymtGvItGlQ2h3G4zSlXUOmTYPS7jAepyntGjJtGpR2h/E4TWnXkGnToLQ7jMdpSruGTJsGpd1hPE5T2jVk2jQo7Q7jcZrSriHTpkFpdxiP05R2DZk2DUq7w3icprRryLRpUNodxuM0pV1Dpk2D0u4wHqcp7RoybRqUdofxOE1p15Bp06C0O4zHaUq7hkybBqXdYTxOU9o1ZNo0KO0O43Ga0q4h06ZBaXcYj9OUdg2ZNg1Ku8N4nKa0a8i0aVDaHcbjNKVdQ6ZNg9LuMB6nKe0aMm0alHaH8ThNadeQadOgtDuMx2lKu4ZMmwal3WE8TlPaNWTaNCjtDuNxmtKuIdOmQWl3GI/TlHYNmTYNSrvDeJymtGvItGlQ2h3G4zSlXUOmTYPS7jAepyntGjJtGpR2h/E4TWnXkGnToLQ7jMdpSruGTJsGpd1hPE5T2jVk2jQo7Q7jcZrSriHTpkFpdxiP05R2DZk2DUq7w3icprRryLRpUNodxuM0pV1Dpk2D0u4wHqcp7RoybRqUdofxOE1p15Bp06C0O4zHaUq7hkybBqXdYTxOU9o1ZNo0KO0O43Ga0q4h06ZBaXcYj9OUdg2ZNg1Ku8N4nKa0a8i0aVDaHcbjNKVdQ6ZNg9LuMB6nKe0aMm0alHaH8ThNadeQadOgtDuMx2lKu4ZMmwal3WE8TlPaNWTaNCjtDuNxmtKuIdOmQWl3GI/TlHYNmTYNSrvDeJymtGvItGlQ2h3G4zSlXUOmTYPS7jAepyntGjJtGpR2h/E4TWnXkGnToLQ7jMdpSruGTJsGpd1hPE5T2jVk2jQo7Q7jcZrSriHTpkFpdxiP05R2DZk2DUq7w3icprRryLRpUNodxuM0pV1Dpk2D0u4wHqcp7RoybRqUdofxOE1p15Bp06C0O4zHaUq7hkybBqXdYTxOU9o1ZNo0KO0O43Ga0q4h06ZBaXcYj9OUdg2ZNg1Ku8N4nKa0a8i0aVDaHcbjNKVdQ6ZNg9LuMB6nKe0aMm0alHaH8ThNadeQadOgtDuMx2lKu4ZMmwal3WE8TlPaNWTaNCjtDuNxmtKuIdOmQWl3GI/TlHYNmTYNSrvDeJymtGvItGlQ2h3G4zSlXUOmTYPS7jAepyntGjJtGpR2h/E4TWnXkGnToLQ7jMdpSruGTJsGpd1hPE5T2jVk2jQo7Q7jcZrSriHTpkFpdxiP05R2DZk2DUq7w3icprRryLRpUNodxuM0pV1Dpk2D0u4wHqcp7RoybRqUdofxOE1p15Bp06C0O4zHaUq7hkybBqXdYTxOU9o1ZNo0KO0O43Ga0q4h06ZBaXcYj9OUdg2ZNg1Ku8N4nKa0a8i0aVDaHcbjNKVdQ6ZNg9LuMB6nKe0aMm0alHaH8Tjvb/q3ZNq0/E3/43h8nq/x+Dxf4/F5vsbj83yNx+f5Go/P8zUen+drPD7P13h8nq/x+Dxf4/F5vsbj83yNx+f5Go/P8zUen+dDP7//AH3T0OK7CueMAAAAAElFTkSuQmCC",name:G("端接焊缝")},{typeName:Ge.SurfacingJoint,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAKYAAACfCAYAAABz/aISAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAHxSURBVHhe7dKxbQNBAANB9d+0rAIWf/cRHQyBSTbm57cv/EMZYS0jrGWEtYywlhHWMsJaRljLCGsZYS0jrGWEtYywlhHWMsJaRljLCGsZYS0jrGWEtYywlhHWMsJaRljLCGsZYS0jrGWEtYywlhHWMsJaRljLCGsZYS0jrGWEtYywlhHWMsJaRljLCGsZYS0jrGWEtYywlhHWMsJaRljLCGsZYS0jrGWEtYywlvGK2dPqMy9kPDK7WX3nUsYjs5vVdy5lvGL2tPrMCxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYyXjF7Wn3mhYxHZjer71zKeGR2s/rOpYxHZqfVb17IeM2sVl95KSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEdYywlpGWMsIaxlhLSOsZYS1jLCWEYY+3z/ZxhhVTz23HAAAAABJRU5ErkJggg==",name:G("堆焊接头")},{typeName:Ge.BottomSeamWeld,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACpCAYAAACyCQZWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAOhSURBVHhe7dJZiuRIFAXR2v+ma6AoaGhz1xCSwiTZhfNjPBeZED9+72dyQxgTO4yJHcbEDmNihzGxw5jYYUzsMCZ2GBM7jIkdxsQOY2KHMbHDmNhhTOwwJnYYEzuMiR3GxA5jYocxscOY2GFM7DAmdhgTO4yJHcbEDmNihzGxw5jYYUzsMCZ2GBM7jIkdxsQOY2KHMbHDmNhhTOwwJnYYEzuMiR3GxA5jYocxscOY2GFM7DAmdhgTO4yJHcbEDmNihzETR4y+m00w5rdvjf6W/A/G1zGP/t5wfLw7j/6fF8L4SE8c/Z8vgfFRjhx9/xNHjr7/YBhv79PRN6/0yeh7D4TxtvaOvmWyd/Sth8B4O1tH37iLPaPv3BzG29gyen93W0ffuCmMeltG759oy+j9zWDUWjt6+xZrR29vBKPSmtG7t1o7ensDGFXWjN7lrzWjd3IYNZZGb8LWjN5JYfy6NaN3WbY0eiOE8auWRm+yzZrROxGMX7M0epP9lkZvJDBebmn0JsdYGr0RwHippdGbHG82uv8yjJeZje5zrqXRmy/BeInZ6D7XWBq9+QKMp5uN7nO92ej+YhhPNRvd53tmo/sLYTzNbHSf75uN7i+C8RSz0X08ZqP7C2A83Gx0H5/Z6P5kGA81G93HazS6PRnGw8xG9/EbjW5PhPEQs9F97mM0uj0JxkOMRre5n9Ho9gQYPzYa3ea+RqPbg2H8yGh0m3ubje4PhHG30eg2zzAa3R4I4y6j0W2eZTS6PQjGXUaj2zzPaHR7AIybjUa3eS4a3R0A42Y0usuzjUa3H8K4yWh0m+cbjW4/gHG10eg270Gjuw9gXI1Gd3mX0eh2J4yrjEa3eR8a3e2EcRUa3eW9aHS3A8ZFNLrLu9HobgeMi2h0l9DobiOMUzS6S/6g0d1GGKdodJf8Q6O7DTAO0egu+S8a3W2Acai1I0e/sZUwotaOHv3OVsKIWjt69DtbCeNQa0eOfmMrYUzsMCZ2GBM7jIkdxsQOY2KHMbHDmNhhTOwwJnYYEzuMiR3GxA5jYocxscOY2GFM7DAmdhgTO4yJHcbEDmNihzGxw5jYYUzsMCZ2GBM7jIkdxsQOY2KHMbHDmNhhTOwwJnYYEzuMiR3GxA5jYocxscOY2GFM7DAmdhgTO4yJHcbEDmNihzGxw5jYYUzsMCZ2GBM7jIkdxsQOY2KHMbHDmNhhTOwwJnYYEzuMiR3GxA5jYocxscOYiP34+Qvm+ETtbiRVRQAAAABJRU5ErkJggg==",name:G("封底焊缝")},{typeName:Ge.FilletWeld,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAALAAAACwCAYAAACvt+ReAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAWNSURBVHhe7dLRduPWEURR//9PO+MkSsbyVouSWCAaqLPWfmkW+HT/+NWfVYvxWLUFj1Vb8Fi1BY9VW/BYtQWPVVvwWLUFj1Vb8Fi1BY9VW/BYtQWPVVvwWLUFj1Vb8Fi1BY9VW/BYtQWPVVvwWLUFj1Vb8HiYv9K96kE8HuJ92lR9gse4j9K2asBj3JT2VR/gMe6z9E0V8Bj3SPqu6h0e4x5N31b9hse4r6Tvq/6Lx7ivpv+o+oXHOPXR/a33/1H1C49xavrtrd//o+oXHuPUZ7+/9fuubo/HOPXI5q3327otHuPUo7u3tK/b4TFOafeXKe3rVniMU9q9mdK+boPHOKXd76a0r1vgMU5p996U9nV5PMYp7WRK+7o0HuOUdh+Z0r4ui8c4pd1kSvu6JB7jlHafmdK+LofHOKXdI6a0r0vhMU5p96gp7esyeIxT2n3FlPZ1CTzGKe2+akr7Wo/HOKXdd0xpX6vxGKe0+64p7WstHuOUdj8xpX2txGOc0u6nprSvdXiMU9o9w5T2tQqPcUq7Z5nSvtbgMU5p90xT2tcKPMYp7Z5tSvs6PR7jlHYJU9rXqfEYp7RLmdK+TovHOKVd0pT2dUo8xint0qa0r9PhMU5pd4Qp7etUeIxT2h1lSvs6DR7jlHZHmtK+ToHHOKXd0aa0r5fjMU5p9wpT2tdL8RintHuVKe3rZXiMU9q90pT29RI8xintXm1K+zocj3FKuzOY0r4OxWOc0u4sprSvw/AYp7Q7kynt6xA8xintzmZK+4rjMU5pd0ZT2lcUj3FKu7Oa0r5ieIxT2p3ZlPYVwWOc0u7sprSvp+MxTmm3wZT29VQ8xinttpjSvp6Gxzil3SZT2tdT8BintNtmSvv6MR7jlHYbTWlfP8JjnNJuqynt69t4jFPabTalfX0Lj3FKu+2mtK8v4zFOaXcFU9rXl/AYp7S7iint62E8xintrmRK+3oIj3FKu6uZ0r4+xWOc0u6KprSvEY9xSrurmtK+PsRjnNLuyqa0L+IxTml3dVPa1z/wGKe0u4Mp7etveIxT2t3FlPb1PzzGKe3uZEr7+jce45R2dzOlffkYp7S7oyntb47HOKXdXU1pf2M8xint7mxK+5viMU5pd3dT2t8Qj3FKu+oj/gSPcUq7+o8p7W+ExzilXf3flPY3wWOc0q7+bkr7G+AxTmlX/zSl/cXxGKe0K5vS/sJ4jFPa1cemtL8oHuOUdjWb0v6CeIxT2tXnprS/GB7jlHb1mCntL4THOKVdPW5K+4vgMU5pV18zpf0F8BintKuvm9J+OR7jlHb1PVPaL8ZjnNKuvm9K+6V4jFPa1c9Mab8Qj3FKu/q5Ke2X4TFOaVfPMaX9IjzGKe3qeaa0X4LHOKVdPdeU9gvwGKe0q+eb0v7keIxT2lXGlPYnxmOc0q5yprQ/KR7jlHaVNaX9CfEYp7SrvCntT4bHOKVdHWNK+xPhMU5pV8eZ0v4keIxT2tWxprQ/AR7jlHZ1vCntX4zHOKVdvcaU9i/EY5zSrl5nSvsX4TFOaVevNaX9C/AYp7Sr15vS/mA8xint6hymtD8Qj3FKuzqPKe0PwmOc0q7OZUr7A/AYp7Sr85nSPozHOKVdndOU9kE8xint6rymtA/hMU5pV+c2pX0Aj3FKuzq/Ke2fjMc4pV3tMKX9E/EYp7SrPaa0fxIe45R2tcuU9k/AY5zSrvaZ0v6HeIxr903v4Qd4jGv3Tm/im3iMa/dOb+KbeDxEu296D9/E4yHaPdNb+AEeq7bgsWoLHqu24LFqCx6rtuCxagseq7bgsWoLHqu24LFqCx6rtuCxagseq7bgsWoLHqu24LFqCx6rtuCxagseq7bgsWoLHqu24LFqCx6rtuCxagseq7bgsWoLHqsW+OPPfwEO3L8pilDAyQAAAABJRU5ErkJggg==",name:G("角焊缝")},{typeName:Ge.GrooveWeldSeam,img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALwAAAC7CAYAAADfTPQTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAARxSURBVHhe7dIxaiVADAVB3//SXk+w8DGVSZHcDZW8UThfP30nfwjH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruKYXMUxuYpjchXH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruKYXMVxTdU0/asBjmuqpulfDXBcUzVN/2qA45qqafpXAxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3yKN0NcFyjdJc8SncDHNco3SWP0t0AxzVKd8mjdDfAcY3SXfIo3Q1wXKN0lzxKdwMc1yjdJY/S3QDHNUp3yaN0N8BxjdJd8ijdDXBco3SXPEp3AxzXKN0lj9LdAMc1SnfJo3Q3wHGN0l3y3+90M8Bx1Wd6Tz59pvchjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruKYXMUxuYpjchXH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruKYXMUxuYpjchXH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+Sgr+9/dULPl8OKWbkAAAAASUVORK5CYII=",name:G("塞焊缝或槽焊缝")},{typeName:Ge.SpotWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAOoAAADXCAYAAAAUcM09AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAeDSURBVHhe7dPbjhY3FAXhvP9Lk0AgIj9l98nTXtuukr6breVmBmn++qdvkuLhUVIWPErKgkdJWfAoKQseJWXBo6QseJSUBY+SsuBRUhY8SsqCR0lZ8CgpCx4lZcGjpCx4lJQFj5Ky4FFSFjxKyoJHSVnwKCkLHiVlwaOkLHiUlAWPkrLgUVIWPErKgkdJWfAoKQseFehp9E2VgUdNMiP6ORQHj3pJavSzaio86otUjX4XvQqPGmi16HfUl8OjHhoZff+u0dG/oS+BR93wNPrmm55E39NQeNQFd6NvpXgSfU+P4VEnXI2+UcWd6Du6DY/quBp9o7Kr0Td0GR4FrkTvV3Mleq9L8KjfXIne7+Bs9Fan4FE/nY3e7uhs9FZdeNze2eitzv3/0Ts14XFrZ6J3+tOZ6J3+gMctnYne6dhR9Eb/g8ftHEVvdM2Z6J1+wONWjqI3uu8oeiM+bqMX7TXGUfRmc3hc3lH0RuP1ov3G8Li0o+iNvs5R9GZDeFxWL9rrHUfRm83gcUm9aK/39aL9RvC4nF601zy9aL8JPC6lF+01Xy/abwCPy+hFe+XoRfvF4XEJvWivPL1ovzA8lteL9srVi/aLwmNpvWivfK1ouyg8ltaKtqqjFW0XhMeyWtFW9bSi7WLwWFIr2qquVrRdCB7LaUVb1deKtovAYymtaKs1tKLtIvBYSivaah2taLsAPJbRirZaTyvaFofHElrRVuuiaFccHkugaKe1taJtYXiM14q2Wl8r2haFx2itaKt9ULQrCo/RKNppL61oWxAeY7WirfZD0a4gPMaiaKd9UbQrBo+RKNppbxTtisFjJIp2EkW7QvAYh6Kd9B1Fu0LwGIeinfQLRbsi8BiFop30u1a0LQCPUSjaSZ8o2hWAxxgU7SRC0a4APMagaCe1ULQLh8cYFO2kFop24fAYgaKd1NOKtsHwGIGinXSEol0wPE5H0U46g6JdMDxOR9FOOouiXSg8TkfRTjqLol0oPE5F0U66gqJdKDxORdFOuoqiXSA8TkXRTrqKol0gPE71GW2kOyjaBcLjNBTtpDso2gXC4zQU7aS7KNqFweM0FO2kuyjahcHjNJ/RRnqCol0YPE5B0U56gqJdGDxOQdFOeuoz2oTB4xQU7aSnKNoFweMUFO2kpyjaBcHjFBTtpKco2gXB4xSf0UYagaJdEDy+jqKdNAJFuyB4fB1FO2mUz2gTBI+vo2gnjfIZbYLg8XUU7aRRKNqFwOPrKNpJo1C0C4HH11G0k0ahaBcCj6+jaCeNQtEuBB5fR9FOGoWiXQg8dpnZ+ehv6AY8NpnZtejv6AY8NpnZtejv6AY8dpnZ+ehv6AY8vo6inTQKRbsQeHwdRTtpFIp2IfD4Oop20igU7ULg8XUU7aRRKNqFwOPrKNpJo1C0C4HH11G0k0b5jDZB8Pg6inbSKJ/RJggeX0fRThqBol0QPE7xGW2kESjaBcHjFJ/RRhqBol0QPE5B0U56iqJdEDxOQdFOeoqiXRA8TkHRTnrqM9qEweMUFO2kpz6jTRg8TvMZbaQnKNqFweM0FO2kuyjahcHjNBTtpLso2oXB4zQU7aS7PqNNIDxO9RltpDso2gXC41QU7aSrKNoFwuNUFO2kqyjaBcLjVBTtpCso2oXC43QU7aSzKNqFwuN0FO2ksyjahcLjdBTtpDMo2gXDYwSKdtIRinbB8BiBop10hKJdMDxGaEVbqYWiXTg8xqBoJ7VQtAuHxxgU7SRC0a4APEahaCd9omhXAB6jULSTfteKtgXgMQ5FO+kXinZF4DEORTvpu1a0LQKPkSjaSRTtCsFjJIp22lsr2haCx1gU7bQvinbF4DFWK9pqP61oWwweo1G0015a0bYgPEZrRVvtg6JdUXiM14q2Wl8r2haFxxIo2mltrWhbGB5LaEVbrYuiXXF4LKMVbbWeVrQtDo9ltKKt1tKKtgvAYymtaKs19KL9AvBYTivaqr5WtF0EHktqRVvV1Yq2C8FjWa1oq3pa0XYxeCyrFW1VSyvaLgiPpbWirWroRfsF4bG8VrRVtl60XxQel9CKtsrUi/YLw+MyWtFWWXrRfnF4XEor2ipDL9pvAI/L6UV7zdOL9pvA45J60V7v60X7jeBxWb1or/f0ov1m8Li0XrTX1zqK3mwIj8s7it5ovKPozabwuIWj6I3G6UX7zeFxK0fRG913FL0RH7dzFL3RdUfRG/2Axy2did7p2Jnonf6Dx60dRW/EzkTv9Ac8bu9M9E7/Ohu9FcKjfjoTvdvV2eituvCo35yN3u7iSvReh/AocCV6v6Ir0Xudhkd1XIneV3c1+oYuw6NOuBp9o5Kr0Td0Gx51wZ3oO2nuRt/SY3jUDU+i783wJPqehsGjHhgZfX+EUdG39SXwqEFWjX5XfSk86gtUj34nvQaPekF69DNrGjxqgtnRz6QYeFSQkdH3VQIeJWXBo6QseJSUBY+SsuBRUhY8SsqCR0lZ8CgpCx4lZcGjpCx4lJQFj5Ky4FFSFjxKyoJHSVnwKCkLHiVlwaOkLHiUlAWPkrLgUVIWPErKgkdJWfAoKcZf3/4GIK9JdCFPKLgAAAAASUVORK5CYII=",name:G("点焊缝")},{typeName:Ge.FoldingInterface,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACtCAYAAAApmERAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAATfSURBVHhe7dLhjts6DAXhvv9L9xbForjrjBw7S5GUPAN8fw6ooNn0159+SwvCUeoOR6k7HKXucJS6w1HqDkepOxyl7nCUusNR6g5HqTscpe5wlLrDUeoOR6k7HKXucJS6w1HqDkepOxyl7nCUusNR6g5HqTscpe5wlLrDMZT9LPqbiscwNjf6mz8EjmEsN/oNNoVjGKuJfovN4BjK6qLfYxM4qqmfRJ+3MBy1iLvRZywKRy3qavR2MThqcVeidwvBUZu4Er1bAI7azLvoTXM4akPvojeN4aiNnUX3TeGozZ1F9w3hqAc4i+6bwVEPcRbdN4KjHuQsum8CRz3MKLptAkc90Ci6bQBHPdQoui2Gox5sFN0WwlEPNopuC+GohxtFt0VwlL7+q36P7orgKH39V32NbgvgKP1F0V0BHKW/RtFtMhylfyi6S4aj9M8ouk2Eo/QNRXeJcJS+oeguEY7Si2N0kwhH6QVFd0lwlF5QdJcER+kFRXdJcJTQMbpJgqOEKLpLgKOEKLpLgKOEKLpLgKOEKLpLgKOEKLpLgOMjdI/+zdUoukuA41ZWjr5PJYruEuC4tJ2i71ftGN0kwHE5u0bftRJFdwlwXMbO0fetRtFdAhzb+zT6LF1H0V0CHNu6G32GPkfRXQIcW7oavVUMiu4S4NjOleidYlF0lwDHNq5E7zQHRXcJcGzhXfRGc1F0lwDHcu+iN5qLorskOJY6i+6Vg6K7JDiWOYvulYeiuyQ4lhhFt8p3jG4S4ZhuFN0qH0V3iXBMNYpuVYOiu0Q4phlFt6oxim4T4ZiGojvVoeguGY4pRtGtaoyi22Q4TjeKblWHorsCOE5H0Z1qUXRXAMepRtGt6lB0VwTHqSi6U51RdFsEx2koulMtiu4K4TgNRXeqM4puC+E4BUV3qjOKbovhOAVFd6oxim4bwDEcRXeqMYpum8AxHEV3yncW3TeBYziK7pTrLLpvBMdQFN0p11l03wyOoSi6U56z6L4hHENRdKccZ9F9UziGOkY3mu9d9KYxHMNQdKe53kVvmsMxDEV3muNK9G4BOIah6E6xrkTvFoJjGIruFONq9HYxOIah6E6fuxO9XxSOYY7Rje75NPqsheEY5hjddLBz9H03gGOYY3RTbcfoe24GxzDH6KbSbtF33BSOYY7RTbWVo+/zEDiGOUY3HXSP/s0Ph2OYY3QjfQDHMBTdSTfhGIaiO+kmHMNQdCfdhGMYiu6km3AMQ9GddBOOoY7RjXQTjqEoupNuwDEURXfSDTiGouhOugHHcBTdSRfhGI6iO+kiHMNRdCddhOMUFN1JF+A4BUV30gU4TkPRnfQGjtNQdCe9geNUFN1JJ3CcahTdSgM4TkfRnTSA43Sj6FYCOKYYRbfSAY5pKLqTDnBMM4pupf/BMdUoupW+4JhuFN1Kf+BYYhTd6vFwLHMW3euxcCx1Ft3rkXAsdxbd63FwbOFd9EaPgWMbV6J32h6O7VyJ3mlbOLZ0NXqr7eDY1t3oM7QFHNv7NPosLQnHZVht9JskwXE5Vhf9HglwXJrlRr9BAhy3YnOjv3kCHB/Bfh79XZPgKHWHo9QdjlJ3OErd4Sh1h6PUHY5SdzhK3eEodYej1B2OUnc4St3hKHWHo9QdjlJ3OErd4Sh1h6PUHY5SdzhKjf36/R9vDJRU5LBTnQAAAABJRU5ErkJggg==",name:G("折叠接口")},{typeName:Ge.InclinedInterface,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAK0AAAC3CAYAAABg4t6+AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAWfSURBVHhe7cpbjhxXDERB73/TtmAIwngclObR1c2blQeIHzL/+tHfVYfhsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxHuxt+id6nzZfxGM9kNIuidLui3isB5nSNonS7ot4rAdR2iWZ0vaLeKwHmNI2idLuG3isB1DaJZnS9ht4rG+a0jaJ0u6beKxvUtolmdL2m3isb5jSNonS7gF4rG9Q2iWZ0vYBeKwvmtI2idLuQXisL1LaJZnS9kF4rC+Y0jaJ0u6BeKwvUNolmdL2gXisT5rSNonS7sF4rE9S2iWZ0vbBeKxPmNI2idLuAjzWJyjtkkxpewEe64OmtE2itLsIj/VBSrskU9pehMf6gCltkyjtLsRjfYDSLsmUthfisf5gStskSruL8Vh/oLRLMqXtxXis35jSNonS7gl4rN9Q2iWZ0vYJeKzBlLZJlHZPwmMNlHZJprR9Eh4LprRNorR7Ih4LlHZJprR9Ih7rnSltkyjtnozHekdpl2RK2yfjsd6Y0jaJ0u4FeKw3lHZJprR9AR7rpyltkyjtXoTH+klpl2RK2xfhsX6Y0jaJ0u6FeKwflHZJprR9IR5vb0rbJEq7F+Px9pR2Saa0fTEeb21K2yRKuwV4vDWlXZIpbRfg8bamtE2itFuCx9tS2iWZ0nYJHm9pStskSrtFeLwlpV2SKW0X4fF2prRNorRbhsfbUdolmdJ2GR5vZUrbJEq7hXi8FaVdkiltF+LxNqa0TaK0W4rH21DaJZnSdikeb2FK2yRKu8V4vAWlXZIpbRfjMd6UtkmUdsvxGE9pl2RK2+V4jDalbRKl3QF4jKa0SzKl7QF4jDWlbRKl3SF4jKW0SzKl7SF4jDSlbRKl3UF4jKS0SzKl7UF4jDOlbRKl3WF4jKO0SzKl7WF4jDKlbRKl3YF4jKK0SzKl7YF4jDGlbRKl3aF4jKG0SzKl7aF4jDClbRKl3cF4jKC0SzKl7cF4PN6UtkmUdofj8XhKuyRT2h6Ox6NNaZtEaReAx6Mp7ZJMaRuAx2NNaZtEaReCx2Mp7ZJMaRuCxyNNaZtEaReExyMp7ZJMaRuEx+NMaZtEaReGx+Mo7ZJMaRuGx6NMaZtEaReIx6Mo7ZJMaRuIx2NMaZtEaReKx2Mo7ZJMaRuKxyNMaZtEaReMxyMo7ZJMaRuMx/WmtE2itAvH43pKuyRT2objcbUpbZMo7W6Ax9WUdkmmtL0BHtea0jaJ0u4meFxLaZdkStub4HGlKW2TKO1uhMeVlHZJprS9ER7XmdI2idLuZnhcR2mXZErbm+FxlSltkyjtbojHVZR2Saa0vSEe15jSNonS7qZ4XENpl2RK25vicYUpbZMo7W6MxxWUdkmmtL0xHl9uStskSrub4/HllHZJprS9OR5fakrbJEq78vGllHZJprQtH19mStskSrv6F48vo7RLMqVt/YvHl5jSNonSrn7h8SWUdkmmtK1feHy6KW2TKO3qP3h8OqVdkilt6z94fKopbZMo7ep/eHwqpV2SKW3rf3h8miltkyjtinh8GqVdkilti3h8iiltkyjtasTjUyjtkkxpWyMeLzelbRKlXf0Wj5dT2iWZ0rZ+i8dLTWmbRGlXf8TjpZR2Saa0rT/i8TJT2iZR2tWH8HgZpV2SKW3rQ3i8jNIuidKuPozHy7xPmzRKu/owHi/zPm0SvU3/+hQeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHqs247FqMx6rNuOxajMeqzbjsWozHquW+uvvfwAguGJAxsc1MAAAAABJRU5ErkJggg==",name:G("倾斜接口")},{typeName:Ge.SpotWeldSeamOffset,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAANcAAADaCAYAAAA149drAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAeMSURBVHhe7dNJbiA3EAXRvv+lbTc8oF0dZA3J5BgBvE3isyQt9OOv/pCUAo+S4vAoKQ6PkuLwKCkOj5Li8CgpDo+S4vAoKQ6PkuLwKCkOj5Li8CgpDo+S4vAoKQ6PkuLwKCkOj5Li8CgpDo+S4vAoKQ6PkuLwKCkOj5Li8CgpDo+S4vAoKQ6PkuLwKCkOj5Li8CgpDo+S4vAoKQ6PkuLwqEGi0Tc1DB6VZHT0OykNHtXIzNHvq6bwqI9Wjv4eheBRL+wa/a16BY+60TL6fgutom/rETyqIBJ9r7dI9D1V4VEXX6NvzeRr9C39Bo/6x9voG6v4En1H/8Hj8d5E73fwJnovPh7pbfSNHb2J3h8Mj8d5Gr09xZvo/YHweIyn0dtTPY3eHgaPR3gSvdPfnkTvDoLH7d1Fb8SeRO8OgMdt3UVv9Mxd9GZzeNzSXfRG7zyJ3m0Kj1u5i94o5i56syE8buMueqM2nkTvNoLHLdxFb9TeXfRmE3hcXi3aK9dd9GYDeFxaLdqrn1q0Xxwel1WKthqjFu0XhscllaKtxqpF+0XhcTmlaKs51KL9gvC4lFK01Vxq0X4xeFxGKdpqTrVovxA8LqEUbTW3WrRfBB6nV4q2WkMt2i8Aj1MrRVutpRRtF4DHaZWirdZUiraTw+OUStFWaytF24nhcUqlaKv1laLtpPA4nVK01R5K0XZSeJxKKdpqL6VoOyE8ToWinfZUiraTweM0StFW+6JoNxk8TqEUbbW3UrSdCB6nQNFOZyhF20ngcbhStNU5KNpNAo9DlaKtzlKKthPA41AU7XSmUrQdDI/DlKKtzkXRbjA8DkPRTmcrRduB8DhEKdpKFO0GwuMQFO2knyjaDYTH7krRVvoXRbtB8NgdRTvpVxTtBsFjV6VoK11RtBsAj11RtJMIRbsB8NgVRTuphKJdZ3jshqKdVEPRrjM8dkPRTrpD0a4jPHZB0U56gqJdR3jsgqKd9ARFu47w2AVFO+kpinad4DEdRTvpDYp2neAxHUU76Q2Kdp3gMR1FO+ktinYd4DHdNdpIX1C06wCPqSjaSV9QtOsAj6ko2klfULTrAI+pKNpJX1G0S4bHNBTtpAiKdsnwmIainRRB0S4ZHtNQtJOirtEmGR7TULSToijaJcJjCop2UgsU7RLhMQVFO6kFinaJ8JiCop3UAkW7RHhMQdFOaoGiXSI8pqBoJ7VA0S4RHlNQtJNauUabRHhMQdFOauUabRLhMQVFO6mVa7RJhMcUFO2kVijaJcFjimu0kVqiaJcEjymu0UZqiaJdEjymuEYbqSWKdknw2BxFO6klinZJ8NgcRTupJYp2SfDYHEU7qSWKdknw2BxFO6klinZJ8NgcRTupJYp2SfCY4hptpJYo2iXBY4prtJFaomiXBI8prtFGaomiXRI8pqBoJ7VC0S4JHlNQtJNauUabRHhMQdFOauUabRLhMQVFO6kFinaJ8JiCop3UAkW7RHhMQdFOaoGiXSI8pqBoJ7VA0S4RHlNQtJNaoGiXCI9prtFGaoGiXSI8pqFoJ0VRtEuExzQU7aQIinbJ8JiGop0UQdEuGR5TUbSTvqJolwyPqSjaSV9do00HeExF0U76gqJdB3hMRdFO+oKiXQd4TEfRTnqLol0HeExH0U56g6JdJ3hMR9FOeoOiXSd47OIabaQ3KNp1gscuKNpJT1G06wSPXVC0k56gaNcRHrsoRVvpDkW7jvDYDUU7qYaiXWd47KYUbaUSinad4bErinYSKUXbzvDYFUU7iVC0GwCP3VG0k35VirYD4LE7inbSryjaDYLHISjaST+Vou0geByCop30E0W7gfA4DEU7iaLdQHgchqKdzkbRbjA8DkXRTmcqRdvB8DhUKdrqPBTtJoDH4Sja6SylaDsBPA5XirY6QynaTgKPUyhFW+2Pot1E8DiNUrTVvkrRdiJ4nEYp2mpPpWg7GTxOpRRttZdStJ0QHqdTirbaRynaTgiPU6Jopz2Uou2k8DilUrTV2krRdmJ4nFYp2mpNpWg7OTxOrRRttZZatJ8cHqdWi/ZaQy3aLwCP06tFe82tFu0Xgccl1KK95lSL9gvB4zJq0V5zqUX7xeBxKbVorznUov2C8LicWrTXWLVovyg8LqkW7TVGLdovDI/LqkV79VWL9ovD49LuojfKV4v2G8Dj8u6iN8pxF73ZBB638CR6p3buojcbweNW7qI3inkSvdsMHrdzF73RN3fRm03hcVt30Rs98yR6tzE8bu0ueqO6u+jNAfC4vSfRO/3fk+jdIfB4jKfR25M9id4dBo9HeRO9P8nT6O2B8HikN9H7nb2J3h8Kj0d7E73fxdvoG4fDo/7yNvrGit5E7/UfPOoXX6LvzOpL9B39Bo8Ckeh7o0Si76kIj6poEX03UzT6pm7hUQ9lRz/zXz2in6vH8KgPdoj+Ln2GRzWwSvS7qwk8qrGZot9PKfCoTrKjn6lu8KgJ+c+yHDxKisOjpDg8SorDo6Q4PEqKw6OkODxKisOjpDg8SorDo6Q4PEqKw6OkODxKisOjpDg8SorDo6Q4PEqKw6OkODxKisOjpDg8Sgr58cefJsbWo2zdXpgAAAAASUVORK5CYII=",name:G("点焊缝（偏移中心）")},{typeName:Ge.SeamWeld,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAASkAAAEWCAYAAAA6tWH6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAmsSURBVHhe7dNZDtxGEARR3f/SsmzAsEVFc5lpklXZEcD7SVRTCzA/fvVTkgrDUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUZKqwFGSqsBRkqrAUdr1bfRNaQBHLapa9HfUcnDUIjpFf38tAUcFS4n+bYqEo4KsEv3bFQFHNXZX9GfNcFf0Z6klHNXMrOjbb5oRfVet4Kgmvo2+Wdk30ffUAo4q7tPoW519Gn1LZeGooq5G30j1SfQdlYOjirkSvV/Rlei9ysBRRVyJ3sv/wwA46mVXovf605XovV6Do15yJXqvY1ei93ocjnrYlei9rjsbvdWjcNSDzkTvNMfZ6K0egaMechS90X2Ooje6HY662VH0Rs84E73TbXDUjY6iN3reUfRGt8BRNziK3uhdZ6J3mgpHTXYUvVEdR9EbTYOjJjkTvVM9R9EbTYGjJjiK3qi+o+iNvoKjvnQUvVEfR9EbfQxHfWEvuldPR9EbfQRHfWgvuld/e9G9LsNRHxhFt8qyF93rEhx10Si6Vaa96F6n4agLRtGtsu1F9zoFR500im61hr3oXodw1Amj6FZr2YvutQtHHRhFt1rTXnSvIRy1YxTdam170b0QjhoYRbfS3/aie/0BR4FRdCv93150r9/gOJWZZUe/+4lwnMrM8qPf/iQ4TmVm+dFvfxIcpzKz/Oi3PwmO05lZbvSbnwjH5Y2iW+lTFN0tDsflUXQnfWMU3S4Mx6WNolvpW6PodlE4LmsU3UqzjKLbBeG4LIrupJlG0e2CcFzSKLqVZhtFt4vBcTmj6Fa6yyi6XQiOSxlFt9LdKLpbCI5LGUW30t1G0e0icFzGKLqVnjKKbheA4zIoupOeRtHdAnBcAkV30htG0W04HJdA0Z30ForuwuEYj6I76U2j6DYYjvEoupPeRtFdMByjjaJb6W0U3QXDMRpFd1IVFN2FwjHWKLqVqqDoLhSOsSi6k6qh6C4QjpFG0a1UDUV3gXCMRNGdVBVFd2FwjDOKbqWqKLoLg2Mciu6k6ii6C4JjHIrupOoouguCYxSK7qQORtFtCByjUHQndUHRXQgcY1B0J3VC0V0IHGNQdCd1Q9FdABxjUHQndUPRXQAcY1B0J3VD0V0AHCNQdCd1RNFdABwjUHQndUXRXXM4RqDoTuqKorvmcIywjW6kzii6aw7H9ii6k7rbRjfN4dgeRXdSdxTdNYZjexTdSd1RdNcYju1toxspAUV3jeHYGkV3UoptdNMYjq1RdCeloOiuKRxbo+hOSkHRXVM4tkXRnZSEorumcGyLojspzTa6aQrHtii6k9Jso5umcGyLojspDUV3DeHYFkV3UhqK7hrCsS2K7qQ0FN01hGNbFN1JaSi6awjHtii6k9JQdNcQjm1toxspEUV3DeHY1ja6kRJRdNcQjm1toxspEUV3DeHYEkV3UqptdNMQji1RdCel2kY3DeHYEkV3UqptdNMQji1RdCelouiuGRxbouhOSkXRXTM4TmVm2dHvfiIcpzGz/Oi3PxGO05hZfvTbnwjHacwsP/rtT4TjdGaWGf3eJ8OxJYrupFTb6KYhHFui6E5KtY1uGsKxJYrupFTb6KYhHNvaRjdSIoruGsKxrW10IyWi6K4hHNvaRjdSIoruGsKxLYrupDQU3TWEY1sU3UlpKLprCMe2KLqT0lB01xCObVF0J6Wh6K4hHNui6E5KQ9FdQzi2RdGdlIaiu4ZwbIuiOynNNrppCse2KLqT0myjm6ZwbG0b3UhJKLprCsfWKLqTUlB01xSOrVF0J6Wg6K4pHFuj6E5KQNFdYzi2R9Gd1B1Fd43h2B5Fd1J3FN01hmN7FN1J3VF01xiO7VF0J3VG0V1zOEag6E7qiqK75nCMQNGd1BVFd83hGIGiO6mrbXQTAMcY2+hG6oiiuwA4xqDoTuqGorsAOMag6E7qhqK7ADjGoOhO6mYb3YTAMQpFd1IXFN2FwDEKRXdSFxTdhcAxyii6laqj6C4IjnEoupOqo+guCI5xKLqTKqPoLgyOkSi6k6qi6C4MjpEoupMqGkW3YXCMRdGdVA1Fd4FwjEXRnVTJKLoNhGM0iu6kKii6C4VjNIrupApG0W0oHONRdCe9jaK7YDjGo+hOehtFd8FwjDeKbqW3UHQXDsclUHQnvYWiu3A4LmEU3UpPo+huATgug6I76Umj6HYBOC5jFN1KT6HobhE4LmUU3Up3G0W3i8BxOaPoVrrLKLpdCI7LGUW30l0oulsMjksaRbfSbKPodjE4LmsU3UqzjKLbBeG4NIrupBlG0e2icFzaKLqVvkXR3cJwXN4oupU+NYpuF4ajfqHoTvrEKLpdHI5TmVl29LufCMepzCw/+u1PguNUZpYf/fYnwXEqM8uPfvuT4DidmWVGv/fJcBTYi+6lf+1F9/oNjhrYi+6lvehef8BRO/aie61rL7oXwlEH9qJ7rWcvutcQjjphL7rXOvaie+3CUSftRffKtxfd6xCOumAvuleuvehep+Coi/aie+XZi+51Go76wF50rxx70b0uwVEfOoreqK+j6I0uw1FfOIreqJ+j6I0+gqO+dBS9UQ9nonf6GI6a5Ch6o7qOojf6Go6a6Ch6o1rORO80BY6a7Ez0Tu87it5oKhx1k6Pojd5zFL3RdDjqRmeid3rOUfRGt8FRDziK3uh+R9Eb3QpHPeRM9E5znY3e6nY46mFnonf6ztnorR6Do15wJXqv865E7/UoHPWiK9F7jV2J3usVOKqAK9F7/edK9F6vwlGFXIner+xK9F4l4KiCrkTvV3E1+oZKwVGFfRJ9J8kn0XdUEo5q4Jvoe518E31PpeGoRmZE363k2+ibagNHNTUj+u7TZkXfVjs4KsBT0Z9Nnor+bLWGowKlRv9WRcFR4TpH/x5Fw1GLqR79nbUMHKV/PB39HbQ8HKWPbKMb6SIcJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJakKHCWpChwlqQocJamAHz//AmoSckzD+QH2AAAAAElFTkSuQmCC",name:G("缝焊缝")},{typeName:Ge.SeamWeldOffset,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAARsAAAD/CAYAAADBj3IBAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAhKSURBVHhe7dTLrhvJFQVR//9Pt+WGbaipKBYfh7xk5gpgTTZOlqQB9a9f/QXwBjkCTMsRYFqOANNyBJiWI8C0HAGm5QgwLUeAaTkCTMsRYFqOANNyBJiWI8C0HAGm5QgwLUeAaTkCTMsRYFqOANNyBJiWI8C0HAGm5QgwLUeAaTkCTMsRYFqOANNyBJiWI8C0HAGm5QgwLUeAaTkCTMsRYFqOANNyBJiWI8C0HAGm5QgwLUeAaTkCTMsRYFqOANNyBJiWI/x1rbqHEzmyqJ+o/h5sKUcW8mnV35Et5MgX+7bq38CScuSLrFT9+1hGjny4V1Z/3jWvqv4svlqOfKhnq2++2kT1Xb5OjnyYR6tv/bRnqu/xNXLkQzxSfeeTPVJ9h4+XIz/snur9N7unes/HypEfcG/1jZXcU73n4+TIG91TvV/dPdV7PkaOvMmt1dvd3Fq95SPkyBvcUr3b3a3VW35UjrzQLdU7/nRWveHH5MiLnFVvuO6W6h1vlyPDbqnecbuz6g1vlSODzqo3POaW6h1vkSNDzqo3PO+sesPL5ciTzqo3zDqr3vBSOfKEs+oNr3OtuudlcuRB16p73uNadc9L5MgDrlX3vNe16p5xOXKna9U9P+eoumVUjtzhWnXPzzuqbhmTIze6Vt3zOY6qW0bkyA2uVfd8nqPqlqflyIlr1T2f66i65Sk5csW16p7Pd1Td8rAcOXCtuud7HFW3PCRHDhxVt3yfo+qWu+VIOKpu+V5H1S13yZELR9Ut36+qO+6SI785qm5Zw1F1y81y5DdH1S3rOKpuuUmO/NdRdct6qrrjJjnyy1F1y5qOqltO5cgvVd2xtqPqlqty3N5Rdcv6jqpbDuW4taPqlj0cVbccynFrVd2xl6PqlpTjto6qW/ZT1R0px21Vdce+qrrjDzluqao79lbVHX/IcUtV3UFVd/xDjtup6g7+o6o7/iHH7VR1B/9T1R3/l+NWqrqD31V1x//luJWq7uBSVXf8LcdtVHUHpao7/pbjNqq6g3JU3dLjFo6qWzhS1R09bqGqO7jmqLrdXI6nJK1d/e6flOMpSetXv/0n5HiVpD2q3/8Tcjwlaf3qt/+EHG8iac3q9z4gx6VVdQf3uqxuNpbj0qq6g3tVdbepHJdV1R08oqq7TeW4rKru4BFV3W0qx2VVdQePqupuQzkuq6o7eFRVdxvKcUlV3cEzqrrbUI5LquoOnlHV3YZyXFJVd/Csqu42k+OSLqsbmFDV3WZyXNJldQMTqrrbTI7LqeoOJlR1t5kcl1PVHUyo6m4zOS6nqjuYclndbCbH5VR1B1Muq5vN5Licqu5gymV1s5kcl1PVHUyp6m4jOS6nqjuYUtXdRnJcTlV3MKWqu43kuJzL6gYmVXW3kRyXc1ndwKSq7jaS43IuqxuYVNXdRnJcSlV3MKmqu43kuJSq7mBSVXcbyXEpVd3BpKruNpLjci6rG5hU1d1GclzOZXUDk6q620iOy7msbmBSVXcbyXE5Vd3BlKruNpLjcqq6gylV3W0kx+VUdQdTqrrbSI7LqeoOplxWN5vJcTlV3cGUy+pmMzkup6o7mHJZ3Wwmx+VUdQcTqrrbTI7LqeoOJlR1t5kcl1PVHUyo6m4zOS7psrqBCVXdbSbHJVV1B8+q6m4zOS6pqjt41mV1s6Ecl1TVHTyjqrsN5bisy+oGnlHV3YZyXFZVd/Coqu42lOOyqrqDR1R1t6kcl1XVHTyiqrtN5bi0qu7gXlXdbSrHpVV1B/eq6m5TOS6tqju4R1V3G8txaVXdwT2quttYjsur6g5uVdXdxnJcXlV3cIuq7jaX4/KOqls4U9Xd5nLcQlV3cKaqu83luIWq7uCaqu7ocRtV3cGRqu7ocRtV3UGp6o6/5XgTSWtWv/cBOZ6StH71239CjldJ2qP6/T8hx1OS1q9++0/I8ZSktavf/ZNy3FJVd+ztqLrlH3Lc0lF1y76quuMPOW6rqjv2dFTd8occt3VU3bKXo+qWlOPWjqpb9lHVHYdy3N5Rdcv6jqpbDuXIL1Xdsbaj6parcuSXo+qWdVV1x6kc+a+j6pb1HFW3nMqR31R1x1qOqltukiO/OapuWcNRdcvNcuTCUXXL96vqjrvkSDiqbvleR9Utd8mRcK265/scVbfcLUcOXKvu+R5H1S0PyZErrlX3fL6j6paH5ciJa9U9n+uouuUpOXKDa9U9n+eouuVpOXKja9U9n+OoumVEjtzhWnXPzzuqbhmTI3e6Vt3zc46qW0blyAOuVfe831F1y7gcedC16p73uFbd8xI58oSz6g2vc62652Vy5Eln1RtmnVVveKkcGXBWvWHGWfWGl8uRQWfVGx53Vr3hLXJk2Fn1hvucVW94qxx5kbPqDefOqje8XY680C3VO/50S/WOH5EjL3Zr9Rb/yXypHHmTW6u3O7q1esuPy5E3uqd6v7p7qvd8jBz5AfdU71dzb/UNPkqO/KB7qvff7p7qPR8rRz7AI9V3vsG91Tf4eDnyQZ6pvvcJHq2+xdfIkQ/1TPW9d3m2+iZfJ0c+3HT1Z9zrFdWfw9fKkS+yWvVvZAk58qW+sfp3sKQcWcSnVn9Xlpcji/qp6u/CdnJkY/dU7+FAjgDTcgSYliPAtBwBpuUIMC1HgGk5AkzLEWBajgDTcgSYliPAtBwBpuUIMC1HgGk5AkzLEWBajgDTcgSYliPAtBwBpuUIMC1HgGk5AkzLEWBajgDTcgSYliPAtBwBpuUIMC1HgGk5AkzLEWBajgDTcgSYliPAtBwBpuUIMC1HgGk5AkzLEWBajgDTcgSYliPAtBwBpuUIMC1HgGk5Agz611//Bmp8EmEmP0iZAAAAAElFTkSuQmCC",name:G("缝焊缝（偏离中心）")},{typeName:Ge.SteepVWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAALkAAACyCAYAAAAeam6fAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAVgSURBVHhe7dJLbhhHEERB3f/Ssi0DEigGIYrkdNcnHxCbQq6m59u/fY8YjseISXiMmITHiEl4jJiEx4hJeIyYhMeISXiMmITHiEl4jJiEx4hJeIyYhMeISXiMmITHiEl4jJiEx4hJeIyYhMeISXiMmITHiEl4jJiEx4hJeHzUf+ke8xR5ax4f83vaxAy/p80hPD5CaRf9Ke0O4fERSrvoT2l3CI+PUdpFX0q7g3h8jNIu+lLaHcTjY5R20ZfS7iAeH6W0i36Udofx+CilXfSjtDuMx8cp7aIXpd1hPD5OaRd9KO0u4PFxSrvoQ2l3AY9HKO2iB6XdBTweobSL+pR2l/B4hNIu6lPaXcLjMUq7qE1pdwmPxyjtoi6l3UU8HqO0i7qUdhfxeJTSLupR2l3G41FKu6hHaXcZj0cp7aIepd1lPB6ntIs6lHYF8Hic0i7qUNoVwOMVSruoQWlXAI9XKO3iPqVdETxeobSL+5R2RfB4jdIu7lLaFcHjNUq7uEdpVwiP1yjt4h6lXSE8XqW0izuUdoXweJXSLs5T2hXD41VKuzhPaVcMj9cp7eIcpV1BPF6ntItzlHYF8Xid0i7OUdoVxGMJSrt4ntKuKB5LUNrF85R2RfFYhtIunqW0K4rHMpR28RylXWE8lqG0i+co7QrjsRSlXTxDaVcYj6Uo7eLrKe2K47EUpV18PaVdcTyWo7SLr6W0K47HcpR28XWUdg3wWI7SLr6O0q4BHktS2sXnKe2a4LEkpV18ntKuCR5LUtrF5yntmuCxLKVdfJzSrhEey1Laxccp7RrhsTSlXXyM0q4RHktT2sXfU9o1w2NpSrv4e0q7ZngsT2kXf0dp1wyP5Snt4v2Udg3xWJ7SLt5PadcQjy0o7eJ9lHYN8diC0i7+TGnXFI8tKO3iz5R2TfHYhtIu3qa0a4zHNpR28TalXWM8tqG0i7cp7RrjsRWlXbymtGuOx1aUdvGa0q45HttR2sVLSrvmeGxHaRe/KO0G4LEdpV38orQbgMeWlHbxP6XdADy2pLSLdd+Kx5aUdpGfvDWl3XZKuyF4bEtpt5nSbhAe21Labaa0G4TH1pR2GynthuGxNaXdRkq7YXhsTWm3kdJuGB7bU9ptorQbiMf2lHabKO0G4nEEpd0WSruBeBxBabeB0m4oHkdQ2m2gtBuKxzGUdtMp7YbicQyl3WRKu8F4HENpN5nSbjAeR1HaTaW0G4zHUZR2EynthuNxFKXdREq74XgcR2k3idJuAR7HUdpNorRbgMdxlHaTKO0W4HEkpd0ESrsleBxJaTeB0m4JHsdS2nWntFuCx7GUdp0p7RbhcSylXWdKu0V4HE1p15XSbhEeR1PadaS0W4bH0ZR2HSntluFxPKVdN0q7ZXgcT2nXidJuIR7HU9p1orRbiMcVlHYdKO2W4nEFpV0HSruleFxBadeB0m4pHtdQ2lWmtFuMxzWUdpUp7RbjcRWlXVVKu8V4XEVpV5HSbjkeV1HaVaS0W47HdZR21SjtluNxHaVdJUq78HEdpV0lSrvwcSWlXRVKu/BxJaVdBUq7+IHHlZR2FSjt4gce11La3aS0i594XEtpd5PSLn7icS2l3U1Ku/iJx9WUdjco7eIFHldT2t2gtIsXeFxPaXea0i5e4HE9pd1JSrt4hcfy0pn07RvisbR0Nr1BMzyWls6mN2iGx9LS2fQGzfBYXjqXvn8zPEZMwmPEJDxGTMJjxCQ8RkzCY8QkPEZMwmPEJDxGTMJjxCQ8RkzCY8QkPEZMwmPEJDxGTMJjxCQ8RkzCY8QkPEZMwmPEJDxGTMJjxCQ8RkzCY8QkPEZMwmPEEN++/wNOQL1V0LJ5GQAAAABJRU5ErkJggg==",name:G("陡侧V型坡口堆焊")},{typeName:Ge.none,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAANcAAADYCAYAAAB4K3ZgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAb9SURBVHhe7dLRbiM3EAXR/f+f3jhINlCIIkdSz7CbZBVwXjqX9krOr59+S3oEHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFCbbTRf/CoQ0Wjn3kwPOogT0S/50B41CKqRv/WA+FRDzoh+twHwqMa9ln0HR4Ij0ew+6LvV3w8wunRd6Jb4XF7q0afRWXh8Qgzot/7CYp2KgmPx6Bol4WinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4poo43KwqMKoGinsvCoAijaqSw8qgCKdioLjyqAop3KwqMKaKONSsOjklG0U2l4VDKKdioNj0pG0U6l4VHJKNqpNDwqGUU7lYZHJWujjcrDoxJRtFN5eFQiinYqD49KRNFO5eFRiSjaqTw8KlEbbbQEPCoJRTstAY9KQtFOS8CjklC00xLwqCQU7bQEPCoJRTstAY9K0kYbLQOPSkDRTsvAoxJQtNvBn+i/bQSPSkDRbkVX0ZsN4FEJKNpVF4l+3sLwqARttKnoiej3LAiPmoyi3Z2qR//mxeBRkxlH39VC8Kgflhv9TRaDx7LsjOhvvyA8lmT1o7/bwfBYjn0XfZeaBo/l7NK7n412r9poo3R4LOmJ6PfMRtHuFUU7pcKjJqJo94qinVLhURO10aZF0U6p8KhJKNq1KNopFR41CUU70kYbpcKjJqFoRyjaKQ0eNUkbbXoo2ikNHjUBRbseinZKg0dNQNGuh6Kd0uBRE1C066FopzR41AQU7Xoo2ikNHjVBG21GKNopDR71MIp2IxTtlAaPehhFuxGKdkqDRz2Mot0IRTulwaMe1Iu2I220USo86kEU7a600Uap8KgHUbS70kYbpcKjHkLR7h1ttFEqPOohFO2uULRTKjzqIRTtrlC0Uyo86gEU7d5B0U6p8KgHULR7B0U7pcKjbkbR7l0U7ZQKj7oZRbt3UbRTKjzqZhTt3kXRTqnwqBtRtPsERTulwqNuRNHuExTtlAqPukkv2n6Cop1S4VE3oWj3KYp2SoVH3YSi3aco2ikVHnUDinbfoGinVHjUDSjafaONNkqHRwX1ou032mijdHhUEEW7b7XRRunwqIBetP1WG22UDo/6Ui/aRrTRRunwqC9RtItqo43S4VFf6EXbqDbaKB0e9aFetL1DG22UDo/6EEW7u7TRRunwqA/0ou1d2mijdHjUByja3amNNkqHR72pF23v1EYbpcOj3tCLtndro43S4VFvoGj3hDbaKB0edaEXbZ/QRhulw6MGetH2KW20UTo8aoCi3ZPaaKN0eFRHL9o+qY02SodHgV60fVobbZQOjwIU7WZoo43S4VGNXrSdoY02O1rss+JRL3rRdpY22uykjTYF4VEvKNrN1EabnVC0KwaP+lcv2s7URpudULQrBo/60Yu2s7XRZicU7YrB4/F60TZDG212QtGuGDwebRTtM1C02wVFu2LweKxRtM9C0W4XFO2KweORRtE+E0W7XfSibSF4PM4o2mejaLeLXrQtBI9HGUX7Cija7aIXbQvB4zFG0b4Kina76EXbQvB4hFG0r6aNNrvoRdtC8Li9UbSvqI02O6FoVwgetzaK9lVRtNtFL9oWgcdtjaJ9ZRTtdtGLtkXgcUujaF8dRbtd9KJtEXjcylX0ZgUU7XbRi7ZF4HEbV9GbVVC020Uv2haBxy1cRW9W00abXfSibRF4XNpV9GZVFO120Iu2ReBxWVfRm5VRtNvBKNoXgMclXUVvVkfRbgejaF8AHpdyFb3ZBUW7HYyifQF4XMZV9GYnFO12MIr2BeBxCVfRmx1RtFvdKNoXgMfyRtF+Z71ou7JRtC8Aj6WNov3uetF2ZaNoXwAeyxpF+1P0ou2qrqI3yfBYzlX05jS9aLuiq+hNMjyWMor2J+tF29VcRW+S4bGMUbTX9f+Ef0fvqruK3iTDYwmjaK9/RKKfN1Mk+nnJ8JhuFO31f6dF30EBeExzFb0ROyH63IXgMcVV9Ebv2TH6nMXgcbpRtFfcqtFnKQqPU42ivZ43K/rdG8HjFFfRG2kheJxiFO2lxeBxCop20qLwOEUbbaSF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiWF/Pr9F7bAHIjtpL7/AAAAAElFTkSuQmCC",name:G("清除"),isChecked:!0}]),r=b.reactive([{typeName:Ge.FirstPlaneSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJ8AAACfCAYAAADnGwvgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAHcSURBVHhe7dGxDQJBAANB+m8aKGCje2Gk01iaZFO/vnvDn2SEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCxmN29+rzBzIes/tXvx/KeMzuX/1+KOMxu3v1+QMZH7E7V18/lBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZYSEjLGSEhYywkBEWMsJCRljICAsZ4cde7w9ec2Vfw1YpGgAAAABJRU5ErkJggg==",name:G("第一种平面符号")},{typeName:Ge.SecondConcaveSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJsAAACZCAYAAAA4qUiHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAMSSURBVHhe7c9LcttAFMVQ73/TTiapuBI0xR/IpoRbdSbQa8n++r3v5CIYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8ZNfo4+z/P8HH2+E8ZN/h3d5DlodLcDxtVGo9vMbzS63QHjJjS6y/xodLcTxk1Go9vMazS63QnjZqPRbeYzGt0egHEXGt1lPjS6OwjjLqPRbeYxGt0ehHG30eg29xuNbk+A8ZDR6Db3otHdSTAeMhrd5j6j0e1JMB42Gt3meqPR7YkwnmI0us11RqPbk2E8zWh0G9/S6P5kGE+zNLqPZ2l0L8B4qqXRfc63NLqXYDzd0ug+51ka3YswKpZG9zluaXQvw6hZGt1nv6XR/QUwqpZG99luaXR/EYy6pdF91lsa3V8I4yWWRvd5bWl0fzGMl3k1epP/vRq9uQHGS70avclfr0ZvboLxcmtG7z7ZmtG7G2G8zavRm0/0avRmAhhvtWb07hOsGb2bBMYprBm9e0drRu8mg3Eaa0dv38Ha0dsJYZzO2tHbJ9oyej8pjFPaMnr/BFtG7yeHcWpbR98xk62j73gIjI+wd/RdV9o7+q6Hwfg4R0bfd6ajo+98KIyPZYx+5ydj9DtvAOPjPXX0v7wRjG9n1tHf+sYwvrW7R3/Th8D4UezRb34ojBn4M/osL2FMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPGxIAxMWBMDBgTA8bEgDExYEwMGBMDxsSAMTFgTAwYEwPG5GRf378A7t91CbVjKP8AAAAASUVORK5CYII=",name:G("第二种凹面符号")},{typeName:Ge.SecondConvexeSymbol,img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKIAAACUCAYAAAAQ0fKrAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAL8SURBVHhe7dHBjtswFMXQ/v9PT7ttS9lJLNOywwucDfFkZNpff/aTLABjYsOY2DAmNoyJDWNiw5jYMCY2jIkNY2LDmNgwJjaMiQ1jYsOY2DAmNoyJDWNiw5jYMCY2jIkNY2LDmNgwJjaMiQ1jYsOY2DAmNoyJDWNiw5jYMCY2jIkNY2LDmNgwJjaMiQ1jYsOY2DAmNoyJDWNiw5jYMCY2jIkNY2LDmNgwZuDT0bfyF4xfzR79hi+E8ausNvqNXwDj491l9NsfCuMj3X30Nz0Ixkc5OvrmETNG3705jLd3ZPS9Mx0Zfe+mMN7WJ6PvXOmT0XduBuPtvDN6v7J3Ru9vAuNtvDN6fyfvjN4vDuMtvDp6e2evjt4uDOPSXh29fZJXR28XhHFZr4zePdkro3eLwbikvdGbb/LK6N0iMC5lb/Tmm+2N3iwA4zL2Rm9yy383jJfbG73J//ZGby6C8VJ7ozcZ2xu9uQDGy+yN3mTf3uiNDOMltkb3ed/W6F6EUbc1us/ntkb3EoyqrdF9jtsa3QswarZG95lna3R/MoyKrdF95tsa3Z8Io2I0us15RqPbE2E83Wh0m/ONRrcnwXiq0eg2ntHo9gQYTzMa3cY3Gt1OhvE0NLrLdWh0NxnGU4xGt7nOaHQ7EcbpRqPbXG80up0E43Q0uss6aHQ3CcapRqPbrGM0up0A4zSj0W3WMxrdHoRxGhrdZV00ujsI4xSj0W3WNRrdHoBxChrdZX00ujsA42E0ust90OjuQxin+Hd0k/v4d3RzAMZpTvjBudhJ/6cYExvGxIYxsWFMbBgTG8bEhjGxYUxsGBMbxsSGMbFhTGwYExvGxIYxsWFMbBgTG8bEhjGxYUxsGBMbxsSGMbFhTGwYExvGxIYxsWFMbBgTG8bEhjGxYUxsGBMbxsSGMbFhTGwYExvGxIYxsWFMbBgTG8bEhjGxYUxsGBMbxsSGMbFhTGwYExvGxIYxsWFMbBgTG8bEhjGxYUxsGBMbxsSGMbFhTGwYE9Gvn98b42oiTSRi9wAAAABJRU5ErkJggg==",name:G("第二种凸面符号")},{typeName:Ge.SecondPlaneSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAKYAAACmCAYAAABQiPR3AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAO2SURBVHhe7dJbTh1BEARR9r9pjC1kYRwkF5jp7EekdH5C9VlPL3uWJoRRasMotWGU2jBKbRilNoxSG0apDaPUhlFqwyi1YZTaMEptGKU2jFIbRqkNo9SGUWrDKLVhlNowSm0YpTaMUhtGqQ2j1IZRasMotWGU2jBKbRilNoxSG0apDaPUhlFqwyi1YZTaMF7u/ehGegPj5Wh0J73CeLmPRrfSC4yXS6N7HQ/jLdLoXkfDeJs0utexMN4qje51JIy3S6N7HQfjEGl0r6NgHCaN7nUMjEOl0b2OgHG4NLrX9jBWpNG9toaxJo3utS2MVWl0ry1hrEuje20H4xTS6F5bwTiNNLrXNjBOJY3utQWM00mjey0P45TS6F5LwzitNLrXsjBOLY3utSSM00ujey0H4xLS6F5LwbiMNLrXMjAuJY3utQSMy0mje00P45LS6F5Tw7isNLrXtDAuLY3uNSWMy0uje00H4xbS6F5TwbiNNLrXNDBuJY3uNQWM20mje9Vh3FIa3asK47bS6F41GLeWRveqwLi9NLrXcBiPkEb3GgrjMdLoXsNgPEoa3WsIjMdJo3vdDuOR0uhet8J4rDS6120wHi2N7nULjMdLo3tdDqNepNG9LoVRr9LoXpfBqDfS6F6XwKh30uheP4ZRII3u9SMY9YE0ute3YVSQRvf6Foz6RBrd68sw6gFpdK8vwagHpdG9HoZRX5BG93oIRn1RGt3rUxj1DWl0rwijvimN7vUhjPqBNLoXwqgfSqN7/QejLpBG9/oHRl0kje71F0ZdKI3u9QdGXSyN7sVRN0ij+8Nh1E3S6P5gGHWjNLo/FEbdLI3uD4RRA6TR/WEwapA0uj8IRg2URveHwKjB0uj+ABhVkEb3m8OokjS63xhGFaXR/aYwqiyN7jeEURNIo/vNYNQk0uh+Ixg1kTS63wRGTSaN7jeAURNKo/vFYdSk0uh+YRg1sTS6XxRGTS6N7heEUQtIo/vFYNQi0uh+IRi1kDS6XwRGLSaN7heAUQtKo/vJYdSi0uh+Yhi1sDS6nxRGLS6N7ieEURtIo/vJYNQm0uh+Ihi1kTS6nwRGbSaN7ieAURtKo/syjNpUGt0XYdTG0ui+BKM2l0b3BRh1gDS6HwyjDpFG9wNh1EHS6H4QjDpMGt0PgFEHSqP7m2HUoT4a3d4Mow72fnQzAEap+ZS/YZTaMEptGKU2jFIbRqkNo9SGUWrDKLVhlNowSm0YpTaMUhtGqQ2j1IZRasMotWGU2jBKRU/PvwBx2jYpMoLBBAAAAABJRU5ErkJggg==",name:G("第二种平面符号")},{typeName:Ge.FirstConvexeSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIEAAACDCAYAAACqaHhbAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAK3SURBVHhe7c3bjtNAFERR/v+nhwGBBNGy4yTu9qWqpPWyc9r58b2visdYWRgrC2NlYawsjJWFsbIwVhbGysJYWRgrC2NlYawsjJWFsbIwVhbGysJYWRgrC2NlYawsjJWFsbIwVhbGysJYWRgrC2NlYawsjLv6NfU6DcbdvDt9q4Zh3MWe0/drN4y7GDn9X72NcTezpv+uzRiHGzX9Vz3FeLhPp2/WIsZTenf6Vv2H8RJenb5RvzFeyqvTN8IxXtbW6W0wxsvbOr0NxHgrW6Z3QRhvZ8v0LgTjbW2Z3t0c4+09m97cGGOEZ9Obm2KMsjbd3xBjnGfTmxthjLU23d8EY7S16f4GGOOtTfcXx1jf1qb7C2OsP9am+4tirH+sTfcXxFiwNN1eDGPB2nR/IYy1YGm6vRDGWrE03V4EYz2xNN1eAGNtsDTdnhxjbbQ03Z4YY71A092JMdYLlqbbk2KsFy1NtyfEWG/QdHdCjPWGpen2ZBjrTZruToaxPqDp7kQY6wNL0+1JMNaHNN2dBGN9aGm6PQHG2oGmuxNgrB0sTbcHY6ydaLo7GGPtRNPdwRhrR5ruDsRYO9J0dyDG2pmmu4Mw1s403R2EsXam6e4gjDWAprsDMNYAmu4OwFgDaLo7AGMNouluMsYaRNPdZIw1iKa7yRhrEE13kzHWQJruJmKsgTTdTcRYA2m6m4ixBtJ0NxFjDabpbhLGGkzT3SSMNZimu0kYazBNd5Mw1mCa7iZhrME03U3CWINpupuEsQbTdDcJYw2m6W4SxprgcbqZhLEmeJxuJmGsCR6nm0kYa4LH6WYSxprgcbqZhLEm+Tv9NhFjZWGsLIyVhbGyMFYWxsrCWFkYKwtjZWGsLIyVhbGyMFYWxsrCWFkYKwtjZWGsLIyVhbGyMFYWxsrCWFkYKwtjxfjx9ROiaSHTn3voRQAAAABJRU5ErkJggg==",name:G("第一种凸面符号")},{typeName:Ge.none,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAANcAAADYCAYAAAB4K3ZgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAb9SURBVHhe7dLRbiM3EAXR/f+f3jhINlCIIkdSz7CbZBVwXjqX9krOr59+S3oEHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFCbbTRf/CoQ0Wjn3kwPOogT0S/50B41CKqRv/WA+FRDzoh+twHwqMa9ln0HR4Ij0ew+6LvV3w8wunRd6Jb4XF7q0afRWXh8Qgzot/7CYp2KgmPx6Bol4WinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4poo43KwqMKoGinsvCoAijaqSw8qgCKdioLjyqAop3KwqMKaKONSsOjklG0U2l4VDKKdioNj0pG0U6l4VHJKNqpNDwqGUU7lYZHJWujjcrDoxJRtFN5eFQiinYqD49KRNFO5eFRiSjaqTw8KlEbbbQEPCoJRTstAY9KQtFOS8CjklC00xLwqCQU7bQEPCoJRTstAY9K0kYbLQOPSkDRTsvAoxJQtNvBn+i/bQSPSkDRbkVX0ZsN4FEJKNpVF4l+3sLwqARttKnoiej3LAiPmoyi3Z2qR//mxeBRkxlH39VC8Kgflhv9TRaDx7LsjOhvvyA8lmT1o7/bwfBYjn0XfZeaBo/l7NK7n412r9poo3R4LOmJ6PfMRtHuFUU7pcKjJqJo94qinVLhURO10aZF0U6p8KhJKNq1KNopFR41CUU70kYbpcKjJqFoRyjaKQ0eNUkbbXoo2ikNHjUBRbseinZKg0dNQNGuh6Kd0uBRE1C066FopzR41AQU7Xoo2ikNHjVBG21GKNopDR71MIp2IxTtlAaPehhFuxGKdkqDRz2Mot0IRTulwaMe1Iu2I220USo86kEU7a600Uap8KgHUbS70kYbpcKjHkLR7h1ttFEqPOohFO2uULRTKjzqIRTtrlC0Uyo86gEU7d5B0U6p8KgHULR7B0U7pcKjbkbR7l0U7ZQKj7oZRbt3UbRTKjzqZhTt3kXRTqnwqBtRtPsERTulwqNuRNHuExTtlAqPukkv2n6Cop1S4VE3oWj3KYp2SoVH3YSi3aco2ikVHnUDinbfoGinVHjUDSjafaONNkqHRwX1ou032mijdHhUEEW7b7XRRunwqIBetP1WG22UDo/6Ui/aRrTRRunwqC9RtItqo43S4VFf6EXbqDbaKB0e9aFetL1DG22UDo/6EEW7u7TRRunwqA/0ou1d2mijdHjUByja3amNNkqHR72pF23v1EYbpcOj3tCLtndro43S4VFvoGj3hDbaKB0edaEXbZ/QRhulw6MGetH2KW20UTo8aoCi3ZPaaKN0eFRHL9o+qY02SodHgV60fVobbZQOjwIU7WZoo43S4VGNXrSdoY02O1rss+JRL3rRdpY22uykjTYF4VEvKNrN1EabnVC0KwaP+lcv2s7URpudULQrBo/60Yu2s7XRZicU7YrB4/F60TZDG212QtGuGDwebRTtM1C02wVFu2LweKxRtM9C0W4XFO2KweORRtE+E0W7XfSibSF4PM4o2mejaLeLXrQtBI9HGUX7Cija7aIXbQvB4zFG0b4Kina76EXbQvB4hFG0r6aNNrvoRdtC8Li9UbSvqI02O6FoVwgetzaK9lVRtNtFL9oWgcdtjaJ9ZRTtdtGLtkXgcUujaF8dRbtd9KJtEXjcylX0ZgUU7XbRi7ZF4HEbV9GbVVC020Uv2haBxy1cRW9W00abXfSibRF4XNpV9GZVFO120Iu2ReBxWVfRm5VRtNvBKNoXgMclXUVvVkfRbgejaF8AHpdyFb3ZBUW7HYyifQF4XMZV9GYnFO12MIr2BeBxCVfRmx1RtFvdKNoXgMfyRtF+Z71ou7JRtC8Aj6WNov3uetF2ZaNoXwAeyxpF+1P0ou2qrqI3yfBYzlX05jS9aLuiq+hNMjyWMor2J+tF29VcRW+S4bGMUbTX9f+Ef0fvqruK3iTDYwmjaK9/RKKfN1Mk+nnJ8JhuFO31f6dF30EBeExzFb0ROyH63IXgMcVV9Ebv2TH6nMXgcbpRtFfcqtFnKQqPU42ivZ43K/rdG8HjFFfRG2kheJxiFO2lxeBxCop20qLwOEUbbaSF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiWF/Pr9F7bAHIjtpL7/AAAAAElFTkSuQmCC",name:G("清除"),isChecked:!0},{typeName:Ge.ThirdPlaneSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAKIAAACdCAYAAAA33qNjAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAOZSURBVHhe7cpRTl1BDARR9r9pgiISEVIND7jja89US+en7KeXPUsNYJSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYZSqYdSB3o7ui2HUYWj0txBGHSSNfhfCqEOk0e9iGHWANPotgFGbS6PfIhi1sTT6LYRRm0qj32IYtaE0+r0BRm0mjX5vglEbSaPfG2HUJtLo92YYtYE0+m0Ao4ZLo98mMGqwNPptBKOGSqPfZjBqoDT6bQijhkmj36YwapA0+m0Mo4ZIo9/mMGqANPodAKOaS6PfITCqsTT6HQSjmkqj32EwqqE0+h0Io5pJo9+hMKqRNPodDKOaSKPf4TCqgTT63QBG3SyNfjeBUTdKo9+NYNRN0uh3Mxh1gzT63RBGFUuj301hVKE0+t0YRhVJo9/NYVSBNPo9AEYtlka/h8CohdLo9yAYtUga/R4GoxZIo98DYdTF0uj3UBh1oTT6PRhGXSSNfg+HURdIo19x1A+l0a9+w6gfSKNf/YVR35RGv/oHRn1DGv3qPxj1RWn0K4RRX5BGv4ow6kFp9KsPYdQD0uhXn8KoT6TRrx6CUR9Io189DKOCNPrVl2AUSKNffRlGvZNGv/oWjHojjX71bRj1Ko1+9SMY9SKNfvVjGI+XRr+6BMajpdGvLoPxWGn0q0thPFIa/epyGI+TRr9aAuNR0uhXy2A8Rhr9aimMR0ijXy2HcXtp9KsSGLeWRr8qg3FbafSrUhi3lEa/KodxO2n0q1tg3Eoa/eo2GLeRRr+6FcYtpNGvbodxvDT6VQsYR0ujX7WBcaw0+lUrGEdKo1+1g3GcNPpVSxhHSaNftYVxjDT6VWsYR0ijX7WHsb00+tUIGFtLo1+NgbGtNPrVKBhbSqNfjYOxnTT61UgYW0mjX42FsY00+tVoGFtIo1+Nh/F2afSrLWC8VRr9ahsYb5NGv9oKxluk0a+2g7FcGv1qSxhLpdGvtoWxTBr9amsYS6TRr7aHcbk0+tURMC6VRr86BsZl0uhXR8G4RBr96jgYL5dGvzoSxkul0a+OhfEyafSro2G8RBr96ngYL0GjP+kFxku8H/1IrzBe5s/oJr2BUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUaqGUSr09PwLe560Hv6Ev1kAAAAASUVORK5CYII=",name:G("第三种平面符号")},{typeName:Ge.FirstConcaveSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAI0AAACNCAYAAACKXvmlAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAALXSURBVHhe7c1LktswEARR3//S4094MZYTJZIi0Q0yK+JtUg3xx699STthlBKMUoJRSjBKCUYpwSglGKUEo5RglBKMUoJRSjBKCUYpwSglGKUEo5RglBKMUoJRSjBKCUYpwSglGKUEo5RglBKMUoJRSjBKCcZyv0ddLWAs9Tq6USmMZWh0p1IYy9DoTqUwlqHRnUphLPU6ulEpjKVeRzcqhbHU6+hGpTCWeh3dqBTGUjS6UxmMpWh0pzIYS9HoTmUwlqLRncpgLEWjO5XBWIpGdyqDsRSN7lQGYzka3akExnI0ulMJjOVodKcSGMvR6E4lMLZAoztNh7EFGt1pOowt0OhO02FsgUZ3mg5jGzS601QY26DRnabC2AaN7jQVxlZodKdpMLZCoztNg7EdGt1pCozt0OhOU2Bsh0Z3mgJjSzS60+UwtkSjO10OY1s0utOlMLZFoztdCmNbo9GtLoOxtdHoVpfA2B6N7nQJjO2NRrc6HcYl0OhOp8O4DBrd6VQYlzEa3eo0GJdCozudBuNSRqNbnQLjckajW30M45JGo1t9BOOS0uheh2FcVhrd6xCMSxuNbnUIxuWNRrfaDeMtjEa32gXjbYxGt9oM462MRrfaBOOtvBu9UYTxdt6N3mgI422l0b0QxltLo3v9B+PtpdG9/oHxEd6N3ugPjI/xbvRGHB/n3ejNg2F8pC2jdw+E8bG2jN49DMbH2zJ69xAY9deW0bubw6hv9oze3xBGgT2j9zeCUQNHRv+zOIza4OjovxaDUTt8OvrP5jDqoCtG3ymGUR+aNfr2BBh1oitH35sAoy509ugbF8OoyY6O/msCjGrq++j3STBKCUYpwSglGKUEo5RglBKMUoJRSjBKCUYpwSglGKUEo5RglBKMUoJRSjBKCUYpwSglGKUEo5RglBKMUoJRSjBKCUYpwSglGKUEo5RglBKMUoJRSjBKCUYpwSgN/Pj6CVeUv88NZ939AAAAAElFTkSuQmCC",name:G("第一种凹面符号")},{typeName:Ge.FlattenWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAC0CAYAAAAw03Z1AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAR0SURBVHhe7dFBbttQEARR3//SiRU4hqLUSKRE0b9nqoG3KQ4XBD8+90tqAKOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqOUBqMGux3dLAijhqLR3YIwaiga3S0IowaqRrcLwqiBaHS3KIwaphrdLgqjhqHR3cIwapBqdLswjBqERneLw6ghqtHt4jBqCBrdBcCoAarRbQCMGoBGdyEwqrlqdBsCo5qj0V0QjGqsGt0GwajGaHQXBqOaqka3YTCqKRrdBcKohqrRbSCMaohGd6EwqplqdBsKo5qh0V0wjGqkGt0Gw6hGaHQXDqOaqEa34TCqCRrdNYBRDVSj2wYwqgEa3TWBUeGq0W0TGBWORneNYFSwanTbCEYFo9FdMxgVqhrdNoNRoWh01xBGBapGtw1hVCAa3TWFUWGq0W1TGBWGRneNYVSQanTbGEYFodFdcxgVohrdNodRIWh0NwBGBahGtwNgVAAa3Q2BUYurRrdDYNTiaHQ3CEYtrBrdDoJRC6PR3TAYtahqdDsMxnY6j753IIytdB9980AYW+k8+t6hMLbTdfStQ2FspxrdrohGd4NhbIlGd6upRreDYWypGt2uhEZ3w2Fsi0Z3q6hGt8NhbKsa3a6ARnfi2BqN7n5aNboVx9aq0e1PotGd/sDYHo3ufko1utUfGNurRrc/gUZ3+oZxBBrdna0a3eobxhGq0e2ZaHSnf2Acg0Z3Z6lGt/oHxjGq0e0ZaHSn/2AchUZ371aNbvUfjKNUo9t3otGdEMZxaHT3LtXoVgjjONXo9h1odKcSxpFodHe0anSrEsaRqtHtkWh0p7swjkWju6NUo1vdhXGsanR7BBrd6SGMo9Ho7lXV6FYPYRytGt2+gkZ32gTjeDS6e1Y1utUmGMerRrfPoNGdNsOoTzS626sa3WozjPpUjW73oNGddsGoLzS626oa3WoXjPpSjW63oNGddsOoKzS6e6Qa3Wo3jLpSjW7vodGdnoJRN2h0V6lGt3oKRt2oRreERnd6GkYBGt3dqka3ehpGgWp0e41Gd3oJRhVodPdXNbrVSzCqUI1uL2h0p5dh1B20rXeX0a1ehlF3VNtyd3ujw2DUA7RHzy+7vtGhMOqBaveeX7+vw2HUBrSqX3b7vg6FURvsGb2vQ2HURltH7+pQGLXRltF7OhxG7fBo9I4Oh1E73Bvd6y0waqdqdKu3wKidaHSnt8GoJ9yObvQ2GKU0GKU0GKU0GKU0GKU0GKU0GKU0GKU0GKU0GKU0GE/l1h39r0VhPI1bf/TfFoTxNG790X9bEMZTubVH/2xBGE/n1hz9q0VhlNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglNJglIJ8/PoN/NebMT+KMDUAAAAASUVORK5CYII=",name:G("削平焊缝")},{typeName:Ge.ToeAareaTranSmoothly,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAALUAAAC1CAYAAAAZU76pAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAATfSURBVHhe7c5Bjhs5FARR3//SHs+igYYQpErtZBWTjgTeJvQp6def/ZYOg1FqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlFqhlELfI0+UxRGhb2ObhSDUUE0ulMMRgXR6E4xGBVEozvFYFQQje4Ug1FBNLpTDEYF0ehOMRgVRKM7xWBUEI3uFINRQTS6UwxGBdHoTjEYFUSjO8VgVBCN7hSDUUE0ulMMRgXR6E4xGBVEozvFYFQQje4Ug1FBNLpTDEYF0ehOMRgVRKM7xWBUEI3uFINRQTS6UwxGBdHoTjEYFUSjO8VgVBCN7hSDUUE0ulMMRgXR6E4xGBVEozvFYFQQje4Ug1FBNLpTDEYF0ehOMRgVRKM7xWBUEI3uFINRQTS6UwxGBdHoTjEYFUSjO8VgVBCN7hSDUUE0ulMMRgXR6E4xGBVEozvFYFQQje4Ug1FBNLpTDEYF0ehOMRgVRKM7xWBUEI3uFINRQTS6UwxGBdHoTjEYFUSjO8VgVBCN7hSDUUE0ulMMRgXR6E4xGBVEozvFYFQQje4Ug1FBNLpTDEYF0ehOMRijvkaf/QtodPcv+Bp9FoQx5nV0czoa3Z3udXQTgjGGRncno9Hd6V5HNyEYY2h0dzIa3Z3udXQTgjGGRncno9Hd6V5HNyEYY2h0dzIa3Z2MRnchGGNodHcyGt2djEZ3IRhjaHR3MhrdnYxGdyEYY2h0d7LR6PZUNLoLwRhFo7sTzUb3p6LRXQjGKBrdnWg2uj/V6+gmCGMUje5ONBvdn4hGd0EYo2h0d6J3ozenodFdEMY4Gt2d5Mro3WlodBeEMY5Gdye5Onp7ChrdhWGMG41uT/DJ6P0paHQXhnEJGt2dgDbrJxqNbsMwLjEa3TYbbfb59/enoNHdAhiXodFdM9q7z//f95t2o9HtAhiXGY1uG4125e71phmN7hbBuNRodNtktL+9bTMa3S6CcanR6LYJje6+jEa3LUaj24UwLjca3TYYjW6/o9Fdg9HodjGMtxiNbnc2Gt2+Go1udzYb3S+G8Taj0e2ORqPbkdHodkez0f0NMN5mNrrfyWx0PzMa3e5kNrq/CcZbzUb3O5iN7q+Yje6fNhvd3wjj7d6N3jzh3ejNJ2aj+6fMRvc3w/iId6M3d3o3evMT70Zv7vJu9OYBGB9zZfRupSujd3/j3ejNSldG7x6C8XFXRu+SrozepVwZvUu6Onr7IIxb+GT0/ic+Gb1f4ero7U9dHb3dAMatfDr6jplPR9+x2k9G3zPyk9H3bALjdnYZ/bc77TD6X5vBuK2nRv/lSU+M/semMFZYPfrN3dwx+t3NYayTGn13i9Tou8tgPMZodHuq2ej+ABilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilZhilUr9+/we+LQDMYXMVmgAAAABJRU5ErkJggg==",name:G("趾部平滑过渡")}]),s=b.reactive([{typeName:Ge.WithPadSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACyCAYAAADrlOUvAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAARaSURBVHhe7dGxbUBRCARB99+07QImBT2+dqVJTmT8/PebfAjH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruKYXMUxuYpjchXH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruK4or6Zfr2I47j6bvr3Io7j6rvp34s4jqvvpn8v4jhO6S5vU7pbxHGc0l3epnS3iOM4pbu8TeluEcdxSnd5m9LdIo7jlO7yNqW7RRzHKd3lbUp3iziOU7rL25TuFnEcp3SXtyndLeI4Tukub1O6W8RxnNJd3qZ0t4jjOKW7vE3pbhHHcUp3eZvS3SKO45Tu8jalu0Ucxynd5W1Kd4s4jlO6y9uU7hZxHKd0l7cp3S3iOE7pLm9TulvEcZzSXd6mdLeI4zilu7xN6W4Rx3FKd3mb0t0ijuOU7vI2pbtFHMcp3eVtSneLOI5TusvblO4WcRyndJe3Kd0t4jhO6S5vU7pbxHGc0l3epnS3iOM4pbu8TeluEcdxSnd5m9LdIo7jlO7yNqW7RRzHKd3lbUp3iziOU7rL25TuFnEcp3SXtyndLeI4Tukub1O6W8RxnNJd3qZ0t4jjOKW7vE3pbhHHcUp3eZvS3SKO45Tu8jalu0Ucxynd5W1Kd4s4jlO6y9uU7hZxHKd0l7cp3S3iOE7pLm9TulvEcZzSXd6mdLeI4zilu7xN6W4Rx3FKd3mb0t0ijuOU7vI2pbtFHMcp3eVtSneLOI5TusvblO4WcRyndJe3Kd0t4jhO6S5vU7pbxHGc0l3epnS3iOM4pbu8TeluEcdxSnd5m9LdIo7jlO7yNqW7RRzHKd3lbUp3iziOU7rL25TuFnEcp3SXtyndLeI4Tukub1O6W8RxnNJd3qZ0t4jjOKW7vE3pbhHHcUp3eZvS3SKO45Tu8jalu0Ucxynd5W1Kd4s4jlO6y9uU7hZxHKd0l7cp3S3iOE7pLm9TulvEcZzSXd6mdLeI4zilu7xN6W4Rx3FKd3mb0t0ijuOU7vI2pbtFHMcp3eVtSneLOI5TusvblO4WcRyndJe3Kd0t4jhO6S5vU7pbxHGc0l3epnS3iOM4pbu8TeluEcdxSnd5m9LdIo7jlO7yNqW7RRzHKd3lbUp3iziOU7rL25TuFnEcp3SXtyndLeI4Tukub1O6W8RxXH03/XsRx3H13fTvRRzH1XfTvxdxHFffTf9exHFFfS/9eRnH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JVRyTqzgmV3FMruKYXMUxuYpjchXH5CqOyVUck6s4JldxTK7imFzFMbmKY3IVx+QqjslVHJOrOCZXcUyu4phcxTG5imNyFcfkKo7JQT+/fzC8n2Uj/0mSAAAAAElFTkSuQmCC",name:G("带垫板符号")},{typeName:Ge.ThreeSidedWeldSeamSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIsAAACKCAYAAACaRblaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAJuSURBVHhe7dExaiQBEARB/f/T0tlHGKI0sNOQBeEk7fXXv30nv8SYCGMijIkwJsKYCGMijIkwJsKYCGMijIkwJsKYCGMijIkwJsKYCGMijIkwJsKYCGMijIkwJsKYCGMijIkwJsKYCGMijIkw/kn77PSThzDO2jum3zyAcdbeMf3mAYyz9o7pNw9gnLXPT395CONM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpxpustJjDNNdzmJcabpLicxzjTd5STGmaa7nMQ403SXkxhnmu5yEuNM011OYpy1z09/eQjjrL1j+s0DGGftHdNvHsA4a++YfvMAxj9pn51+8hDGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUyEMRHGRBgTYUz+8/X9AzBU0hEUOBzfAAAAAElFTkSuQmCC",name:G("三面焊缝符号"),rotation:0},{typeName:Ge.ThreeSidedWeldSeamSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHUAAAB2CAYAAAD2kNwSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAMnSURBVHhe7dAxbhwwEARB/f/TshMli0pbwOjYQCXLifj1v+/nz+Hx2cbjs43HZxuPzzYen208Ptt4fLbx+Gzj8dnG47ONx2cbj882Hp9tPD7beHy28fhs4/HZxuOzjcdnG4+5T0t/EOIx94npHyI85j4x/UOEx9wnpn+I8Jj7xPQPER5zN22WKe0iPOZu2ixT2kV4zN20Waa0i/CYu2mzTGkX4TF302aZ0i7CY+6mzTKlXYTH3E2bZUq7CI+5mzbLlHYRHnM3bZYp7SI85m7aLFPaRXjM3bRZprSL8Ji7abNMaRfhMXfTZpnSLsJj7qbNMqVdhMfcTZtlSrsIj7mbNsuUdhEeczdtlintIjzmbtosU9pFeMzdtFmmtIvwmLtps0xpF+Exd9NmmdIuwmPups0ypV2Ex9xNm2VKuwiPuZs2y5R2ER5zN22WKe0iPOZu2ixT2kV4zN20Waa0i/CYu2mzTGkX4TF302aZ0i7CY+6mzTKlXYTH3E2bZUq7CI+5mzbLlHYRHnM3bZYp7SI85m7aLFPaRXjM3bRZprSL8Ji7abNMaRfhMXfTZpnSLsJj7qbNMqVdhMfcTZtlSrsIj7mbNsuUdhEeczdtlintIjzmbtosU9pFeMzdtFmmtIvwmLtps0xpF+Exd9NmmdIuwmPups0ypV2Ex9xNm2VKuwiPuZs2y5R2ER5zN22WKe0iPOZu2ixT2kV4zN20Waa0i/CYu2mzTGkX4TF302aZ0i7CY+6mzTKlXYTH3E2bZUq7CI+5mzbLlHYRHnM3bZYp7SI85m7aLFPaRXjM3bRZprSL8Ji7abNMaRfhMXfTZpnSLsJj7qbNMqVdhMfcTZtlSrsIj7mbNsuUdhEeczdtlintIjzmbtosU9pFeMzdtFmmtIvwmLtps0xpF+Exd9NmmdIuwmPups0ypV2Ex9xNm2VKuwiPuZs2y5R2ER5zN22WKe0iPOZu2ixT2kV4zN20WXfTJsLjr/hJb3/FT3oL8fhs4/HZxuOzjcdnG4/PNh6fbTw+23h8tvH4bOPx2cbjs43HZxuPzzYen208Ptt4fLbx+Mz6+v4HDsQyYEjLLcEAAAAASUVORK5CYII=",name:G("三面焊缝符号"),rotation:Math.PI*(3/2)},{typeName:Ge.SurroundingWeldSeamSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIoAAACICAYAAAA4T3NvAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAQZSURBVHhe7c7BjqRIEETB+f+fnh2pL9shSwpUGZCAP8kurkiq/vzrb8QOHCMqjhEVx4iKY0TFMaLiGFFxjKg4RlQcIyqOERXHiIpjRMUxouIYUXGMqDhGVBwjKo4RFceIimNExTGi4hhRcYyoOEZUHCMqjq9U082LcXykmen7D8fxEc5Mv/8wHG9rhfS/HoDj7ayY/ueNcbyNb9L3Rr5J37shjss7mr7xraPpGzfCcVlH0vsuR9L7G+C4pL3p7Zn2pHeL47iUPend1fakd4viuIxP6c1qPqU3C+K4hE/pzao+pTeL4Xi5rXR/F1vpfiEcL7WV7u9mK90vguNlttL9XW2l+wVwvMRWur+7rXR/MY6nG6Xbpxml2wtxPNUo3T7VKN1ehONpttL9k43S7QU4nmaUbp9ulG4vwPEUo3T7FqN0ezKO7Ubp9m1G6fZEHNsp3b2V0t2JOLYapdu3GqXbk3BspXT3dqN0ewKObZTu4ofS3Qk4tlG6ix9Kdyfg2ELpLn5TumvGsYXSXfymdNeM43RKd2FKd404Tqd0F6Z014jjdEp3YaN024TjVEp3sU3prgnHqZTuYpvSXROOUyndxTaluyYcp6rpJvZRumvAcRqlu9hH6a4Bx2mU7mIfpbsGHKdRuot9lO4acJympps4pqabBhynqekmjqnppgHHaWq6iWNqumnAcZqabuIYpbvJOE6hdBfHKN1NxnEKpbs4RuluMo5TKN3FMUp3k3GcQukujlG6m4zjFEp3cYzS3WQcp1C6i2OU7ibjOE1NN3FMTTcNOE5T000cU9NNA47T1HQTx9R004DjNEp3sY/SXQOO0yjdxT5Kdw04TqN0F/so3TXgOI3SXeyjdNeA41RKd7FN6a4Jx6mU7mKb0l0TjlMp3cU2pbsmHKcapdsYU7prwnE6pbswpbtGHKdTugtTumvEsYXSXfymdNeMYwulu/hN6a4ZxzZKd/FjlG6bcWyjdBc/lO5OwLHNKN2+3SjdnoBjq1G6fTOlu5NwbKd091ZKdyfi2G6Ubt9mlG5PxPEUo3T7FqN0ezKOpxil27cYpduTcTzNKN0+3SjdXoDjqUbp9qlG6fYiHE83SrdPM0q3F+J4iVG6fYpRur0Yx8uM0u3dbaX7i3G8zKf05m4+pTcL4Hi5rXR/F5/Sm0VwXMJWul/dVrpfDMdlfEpvVvMpvVkQx6XsSe+utie9WxTH5exNb8+2N71dGMdl7U1vu+1Nb2+A4/KOpPezHEnvb4TjLXyTvvfJN+l7N8PxVlZO//emON7WCul/PQDH27si/Y8H4fg4Hel3Hozja+xJ716IY0TFMaLiGFFxjKg4RlQcIyqOERXHiIpjRMUxouIYUXGMqDhGVBwjKo4RFceIimNExTGi4hjxP3/+/gemz7sMOoigvwAAAABJRU5ErkJggg==",name:G("周围焊接符")},{typeName:Ge.OnSiteSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAOgAAADjCAYAAACPbli7AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAYQSURBVHhe7dPhbhxFFAVh3v+lIQKBAlQSez2zdXtulfT9Oe7YuzOd3771e5KxcEwyA45JZsAxyQw4JpkBxyQz4JhkBhyTzIBjkhlwTDIDjklmwDHJDDgmmQHHJDPgmGQGHJPMgGOSGXBMMgOOSWbAMckMOCaZAcckM+Co+jv6WbIMjqrvo58ni+CoouhcsgCOqh9FZ5OHw1H1q+jfJA+Fo+oj0b9LHghH1Weif588CI6qz0a/I3kIHFWvRL8neQAcVV+Jfl9yMBxVX41+Z3IoHFVXRb87OQyOqiuj358cBEfVHdHfSQ6Ao+qu6G8lw+GoujP6e8lgOKreEf3dZCAcVe+K/nYyDI6qd0efIRkCR5URfY5kABxVZvR5EhGOKjv6TIkER9WE6HMlAhxVk6LPl7wRjqpp0WdM3gRH1dTosyY3w1E1Ofq8yY1wVJ0Qfe7kBjiqTok+e3IxHFUnRZ8/uRCOqhOj75FcAEfVqdF3Sb4IR9Xp0XdKXoSj6gnR90pegKPqSdH3Sz4BR9XTou+YfBCOqidG3zP5ABxVT46+b/ITOKqeHn3n5AdwVG2JvnvyHziqNkXfP/kOjqqN0XNIvsFRtTV6FlkPR9Xm6HlkNRxV1X/U/ANHVf0VPZusg6Oq/h09o6yBo6r+Hz2nrICjqn4cPa88Go6q+nn0zPJYOKrq19FzyyPhqKqPR88vj4Kjqj4XPcM8Bo6qei16ljkejqp6PXqeORqOqvp69FxzJBxVdU30bHMcHFV1XfR8cxQcVXV99JxzBBxVdU/0rDMejqq6N3rmGQtHVd0fPfeMhKOq3hc9/4yCo6reG72DjIGjqt4fvYeMgKOqvOh9RIWjqtzonUSDo6pmRO8mb4ejquZE7ydvhaOq5kXvKW+Bo6pmRu8qt8NRVXOj95Vb4aiq+dF7yy1wVNUZ0bvL5XBU1VnRO8xlcFTVedF7zCVwVNW50fvMl+CoqrOjd5qX4aiq86P3mpfgqKrnRO83n4Kjqp4VveN8GI6qemb0rvNLOKrqudH7zk/hqKrnR+89CEdV7Yjeff4HR1Xtid5//gVHVe2L7kH+hKOqdkZ3ITyqand0JxbDUVVF92IpHFVVf0f3YxkcVVXfR3dkERxVVf+N7skSOKqqfhTdl4fDUVX1s+jOPBiOqqqPRHfngXBUVX00uj8Pg6Oq6rPRPXoIHFVVr0R36QFwVFW9Gt2nw+GoqvpqdK8OhaOq6orobh0IR1XVldEdOwiOqqqro3t2CBxVVXdF9204HFVVd0Z3bjAcVVV3R/duKBxVVe+K7t8wOKqq3hndwUFwVFUZ0V0cAEdVlRXdRxmOqio7upcSHFVVE6K7KcBRVTUlup9vhqOqalp0T98ER1XVxOiuvgGOqqrJ0Z29EY6qqunRvb0JjqqqU6L7ezEcVVUnRXf4Qjiqqk6L7vFFcFRVnRrd5y/CUVV1cnSnvwBHVdXp0b1+EY4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kii6FyyAI4qis4lC+CoouhcsgCOKorOJQvgqKLoXLIAjiqKziUL4Kj7Pvp5sgSOSWbAMckMOCaZAcckM+CYZAYck8yAY5IZcEwyA45JZsAxyQw4JpkBxyQz4JhkBhyTzIBjkhlwTDIDjklmwDHJDDgmmQHHJDPgmGQGHJPMgGOSGXBMMgOOSWbAMckMOCbR/fb7H7ITK2QTDTxwAAAAAElFTkSuQmCC",name:G("现场符号")},{typeName:Ge.none,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAANcAAADYCAYAAAB4K3ZgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAb9SURBVHhe7dLRbiM3EAXR/f+f3jhINlCIIkdSz7CbZBVwXjqX9krOr59+S3oEHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFCbbTRf/CoQ0Wjn3kwPOogT0S/50B41CKqRv/WA+FRDzoh+twHwqMa9ln0HR4Ij0ew+6LvV3w8wunRd6Jb4XF7q0afRWXh8Qgzot/7CYp2KgmPx6Bol4WinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4poo43KwqMKoGinsvCoAijaqSw8qgCKdioLjyqAop3KwqMKaKONSsOjklG0U2l4VDKKdioNj0pG0U6l4VHJKNqpNDwqGUU7lYZHJWujjcrDoxJRtFN5eFQiinYqD49KRNFO5eFRiSjaqTw8KlEbbbQEPCoJRTstAY9KQtFOS8CjklC00xLwqCQU7bQEPCoJRTstAY9K0kYbLQOPSkDRTsvAoxJQtNvBn+i/bQSPSkDRbkVX0ZsN4FEJKNpVF4l+3sLwqARttKnoiej3LAiPmoyi3Z2qR//mxeBRkxlH39VC8Kgflhv9TRaDx7LsjOhvvyA8lmT1o7/bwfBYjn0XfZeaBo/l7NK7n412r9poo3R4LOmJ6PfMRtHuFUU7pcKjJqJo94qinVLhURO10aZF0U6p8KhJKNq1KNopFR41CUU70kYbpcKjJqFoRyjaKQ0eNUkbbXoo2ikNHjUBRbseinZKg0dNQNGuh6Kd0uBRE1C066FopzR41AQU7Xoo2ikNHjVBG21GKNopDR71MIp2IxTtlAaPehhFuxGKdkqDRz2Mot0IRTulwaMe1Iu2I220USo86kEU7a600Uap8KgHUbS70kYbpcKjHkLR7h1ttFEqPOohFO2uULRTKjzqIRTtrlC0Uyo86gEU7d5B0U6p8KgHULR7B0U7pcKjbkbR7l0U7ZQKj7oZRbt3UbRTKjzqZhTt3kXRTqnwqBtRtPsERTulwqNuRNHuExTtlAqPukkv2n6Cop1S4VE3oWj3KYp2SoVH3YSi3aco2ikVHnUDinbfoGinVHjUDSjafaONNkqHRwX1ou032mijdHhUEEW7b7XRRunwqIBetP1WG22UDo/6Ui/aRrTRRunwqC9RtItqo43S4VFf6EXbqDbaKB0e9aFetL1DG22UDo/6EEW7u7TRRunwqA/0ou1d2mijdHjUByja3amNNkqHR72pF23v1EYbpcOj3tCLtndro43S4VFvoGj3hDbaKB0edaEXbZ/QRhulw6MGetH2KW20UTo8aoCi3ZPaaKN0eFRHL9o+qY02SodHgV60fVobbZQOjwIU7WZoo43S4VGNXrSdoY02O1rss+JRL3rRdpY22uykjTYF4VEvKNrN1EabnVC0KwaP+lcv2s7URpudULQrBo/60Yu2s7XRZicU7YrB4/F60TZDG212QtGuGDwebRTtM1C02wVFu2LweKxRtM9C0W4XFO2KweORRtE+E0W7XfSibSF4PM4o2mejaLeLXrQtBI9HGUX7Cija7aIXbQvB4zFG0b4Kina76EXbQvB4hFG0r6aNNrvoRdtC8Li9UbSvqI02O6FoVwgetzaK9lVRtNtFL9oWgcdtjaJ9ZRTtdtGLtkXgcUujaF8dRbtd9KJtEXjcylX0ZgUU7XbRi7ZF4HEbV9GbVVC020Uv2haBxy1cRW9W00abXfSibRF4XNpV9GZVFO120Iu2ReBxWVfRm5VRtNvBKNoXgMclXUVvVkfRbgejaF8AHpdyFb3ZBUW7HYyifQF4XMZV9GYnFO12MIr2BeBxCVfRmx1RtFvdKNoXgMfyRtF+Z71ou7JRtC8Aj6WNov3uetF2ZaNoXwAeyxpF+1P0ou2qrqI3yfBYzlX05jS9aLuiq+hNMjyWMor2J+tF29VcRW+S4bGMUbTX9f+Ef0fvqruK3iTDYwmjaK9/RKKfN1Mk+nnJ8JhuFO31f6dF30EBeExzFb0ROyH63IXgMcVV9Ebv2TH6nMXgcbpRtFfcqtFnKQqPU42ivZ43K/rdG8HjFFfRG2kheJxiFO2lxeBxCop20qLwOEUbbaSF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiWF/Pr9F7bAHIjtpL7/AAAAAElFTkSuQmCC",name:G("清除"),isChecked:!0},{typeName:Ge.ThreeSidedWeldSeamSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJEAAACNCAYAAAC3zJjDAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAQNSURBVHhe7dBBah1ADERB3//STpZBFOYPgXaD9KA2ml7N19++z/lPPJ7zgsdzXvB4zgsez3nB4zkveDznBY/nvODxnBc8nvOCx3Ne8HjOCx7PecHjOS94POcFj+e84PGcFzye84LHc17weM4LHs95weM5L3j8Ff+m941m2hTgMW6mzUYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMU9ptM9OmAI9xSrttZtoU4DFOabfNTJsCPMYp7baZaVOAxzil3TYzbQrwGKe022amTQEe45R228y0KcBjnNJum5k2BXiMuz5Lf1eAx7jrs/R3BXiMuz5Lf1eAx7jrs/R3BXj8FdfP6c9K8HjOCx7PecHjOS94POcFj+e84PGcFzye84LHc17weM4LHs95weM5L3g85wWP57zg8ZwXPJ7zgsdzXvB4zgsez3nB4zkveDznBY/nfOjr+w916ZqBJkXEfQAAAABJRU5ErkJggg==",name:G("三面焊缝符号"),rotation:Math.PI/2},{typeName:Ge.ThreeSidedWeldSeamSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAABjCAYAAABzLpVfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAHPSURBVHhe7dAxakMBEENB3//STsCFmyn2gwqFSDDNY6t9/e49fwLj9GGcPozTh3H6ME4fxunDOH0Ypw/j9GGcPozTh3H6ME4fxunDOH0Ypw/j9GGcPozTh3H6ME4fxunD+Nj25l+CGB/ZvtN/Qhgf2b7Tf0IYH9s+029CGOdA010I4xxougthnANNdyGMc6DpLoRxDjTdhTDOgaa7EMY50HQXwjgHmu5CGOdA010I4xxougthnANNdyGMc6DpLoRxDjTdhTDOgaa7EMY50HQXwjgHmu5CGOdA010I4xxougthnANNdyGMc6DpLoRxDjTdhTDOgaa7EMY50HQXwjgHmu5CGOdA010I4xxougthnANNdyGMc6DpLoRxDjTdhTDOgaa7EMY50HQXwjgHmu5CGOdA010I4xxougthnANNdyGMc6DpLoRxDjTdhTDOgaa7EMY50HQXwjgHmu5CGOdA010I4xxougthfGz7TL8JYXxk+07/CWF8ZPtO/wlhfGT7TL8JYnzsv08/CWOcPozTh3H6ME4fxunDOH0Ypw/j9GGcPozTh3H6ME4fxunDOH0Ypw/j9GGcPozTh3H6ME4fxunDOH0Ypw/j9GGcKq/3D2Q2PYJIa+R5AAAAAElFTkSuQmCC",name:G("三面焊缝符号"),rotation:Math.PI},{typeName:Ge.TailSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJsAAACfCAYAAADu8KuaAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAOrSURBVHhe7dLRTiNBDAVR/v+nWYRYBKHsTJJ2T4+7rnReSn7028fepUkwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwShUwarLb0U0DGDURje4awKhJotFtAxg1QTa6bwCjimWj+yYwqlA2um8Eo4pko/tmMKpANrpvCKMGy0b3TWHUQNnovjGMGiQb3TeHUQNko/sNYNSLstH9JjDqBdnofiMY9aRsdL8ZjHpCNrrfEEY9KBvdbwqjHpCN7jeGUQdlo/vNYdQB2eheHHVHNrrXJ4xKZKN7fcOoQDa61y8YBbLRvf7AqBvZ6F4Io37IRvcKYdSXbHSvFEZ9yEb3ugvj9rLRvQ7BuLVsdK/DMG4rG93rIRi3lI3u9TCM28lG93oKxq1ko3s9DeM2stG9XoJxC9noXi/D2F42utcQGFvLRvcaBmNb2eheQ2FsKRvdaziM7WSje5XA2Eo2ulcZjG1ko3uVwthCNrpXOYyXl43uNQXGS8tG95oG42Vlo3tNhfGSstG9psN4OdnoXqfAeCnZ6F6nwXgZ2ehep8J4CdnoXqfDuLxsdK8lYFxaNrrXMjAuKxvdaykYl5SN7rUcjEuKRrdaEsZlRaNbLQfj0qLRrZaCcXnR6FbLwHgJ0ehWS8B4GdHoVqfDeCnR6Fanwng50ehWp8F4SdHoVqfAeFnR6FbTYby0aHSrqTBeXjS61TQYW4hGt5oCYxvR6FblMLYSjW5VCmM70ehWZTC2FI1uVQJjW9HoVsNhbC0a3WoojO1Fo1sNg3EL0ehWQ2DcRjS61cswbiUa3eolGLcTjW71NIxbika3egrGbUWjWz0M49ai0a0egnF70ehWh2HUh2h0q0Mw6ks0utVdGPVDNLpVCqNuRKNbhTAKRKNbIYwKRKNb/YFRiWh0q18w6o5odKtvGHVANLrVJ4w6KBrdiqMeEI1uN4dRD4pGtxvDqCdEo9tNYdSTotHthjDqBdHodjMY9aJodLsRjBogGt1uAqMGiUa3G8CogaLRbXMYNVg0um0MowpEo9umMKpINLptCKMKRaPbZjCqWDS6bQSjJohGt01g1CTR6LYBjJqIRncNYNRkt6ObBjDqBI2f7D+MUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWMUgWM0mBv7/8ABNZSZLbQ7LwAAAAASUVORK5CYII=",name:G("尾部符号")},{typeName:Ge.ZSymbol,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAMUAAACwCAYAAAC/16qCAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAQxSURBVHhe7c85khxJEARB/P/T2CFAYNFaM33UkVlpLqKMSTDx62u/k/wPY7IyxmRljMnKGJOVMSYrY0xWxpisjDFZGWOyMsZkZYzJyhiTlTEmK2NMVsaYrIwxWRljsjLGZGWMycoYk5UxLmeF6e8Q41JWmv7PA8alrDT9nweMy1ll+j0PGDM5TXchxkxO012IMRPTdJdNjJmYprtsYsykNN3lW4yZlKa7fIsxk9J0l28xZkKa7vIjxkxI011+xJjJaLrLUxgzGU13eQpjJrI13eYpjJmIprs8jTET0XSXpzFmEpru8hLGTELTXV7CmAlsTbd5CWMmoOkuL2PMBDTd5WWMGZymu7yFMYPTdJe3MGZgmu7yNsYMTNNd3saYgWm6y9sYMyhNd/kIYwal6S4fYcyANN3lY4wZkKa7fIwxg9mabvMxxgxG0112wZjBaLrLLhgzEE132Q1jBqLpLrthzCC2ptvshjGD0HSXXTFmEJrusivGDEDTXXbHmAFousvuGHMxTXc5BGMupukuh2DMxTTd5RCMuZCmuxyGMRfSdJfDMOYimu5yKMZcRNNdDsWYC2xNtzkUYy6g6S6HY8wFNN3lcIw5maa7nIIxJ9N0l1Mw5kRb021OwZgTabrLaRhzIk13OQ1jTqLpLqdizEk03eVUjDmBprucjjEn0HSX0zHmBJrucjrGHEzTXS7BmINpusslGHMgTXe5DGMOpOkul2HMQbam21yGMQfRdJdLMeYgmu5yKcYcQNNdLseYA2i6y+UYs7Ot6TaXY8zONN1lCIzZmaa7DIExO9J0l2EwZkea7jIMxuxE012GwpidaLrLUBizE013GQpjdqDpLsNhzA403WU4jPmQprsMiTEf0nSXITHmA1vTbYbEmA9ousuwGPMBTXcZFmPepOkuQ2PMmzTdZWiMecPWdJuhMeYNmu4yPMa8QdNdhseYF2m6yxQY8yJNd5kCY16g6S7TYMwLNN1lGox5gaa7TIMxT9J0l6kw5kma7jIVxjxB012mw5gnaLrLdBjzg63pNtNhzA803WVKjPmBprtMiTHf0HSXaTHmG5ruMi3GbNiabjMtxmzQdJepMWaDprtMjTGg6S7TYwxousv0GPMPTXe5Bcb8Q9NdboEx/9B0l1tgzF803eU2GPMXTXe5Dcb8oekut8KYPzTd5VYY82Vrus2tMOaLprvcDmO+aLrL7TAuT9NdbolxeZruckuMS9uabnNLjEvTdJfbYlyaprvcFuOyNN3l1hiXpekut8a4JE13uT3GJWm6y+0xLknTXW6PcTma7rIExuWsMP0dYlzKStP/ecC4lJWm//OAcSkrTf/nAeNyVpj+DjEmK2NMVsaYrIwxWRljsjLGZGWMycoYk5UxJitjTFbGmKyMMVkZY7IyxmRljMnKGJOVMSYrY0xWxpgs6tfv/wDi6qJ+m/lFTwAAAABJRU5ErkJggg==",name:G("交错断续焊接符号")}]),u=b.reactive([{typeName:Ge.BellShapedWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIYAAACGCAYAAAAYefKRAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAMJSURBVHhe7dFLbiNJEAXBvv+lewaYzaBkWaTEX2XIH2AbV2RxoT//7m8CjAljwpgwJowJY8KYMCaMCWPCmDAmjAljwpgwJowJY8KYMCaMCWPCmDAmjAljwpgwJowJY8KYMCaMCWPCmDAmjAljwpgwJowJY8KYMCaMCeMX905v8zr3Tm9vYPzikel7+ZlHpu+dYPziWdO3s/bM6fsnGL94xfQ7+c+zp9+4gXHpFdPv/FbPnn7jTowP+en0rd/gp9O3nojxqb47fWOq70zvX4jxZe6d3k7ynen9GzC+3L3T293dM717M8a3uWd6t6N7pncfwvh2t6Y3O7k1vfkwxo+5Nb25ulvTmwtg/Khb05urOpvuL4TxEs6m+yu5Nb25GMbLOJvur+DW9OaCGC/lbLr/tNV0e2GMl3M23X/Karq9OMZLOpvu32013W6A8bJW0+07rabbTTBe2mq6fYfVdLsRxstbTbevdDbdb4RxC6vp9lVW0+1mGLeh6e4VVtPthhi3sZpun03T3aYYt6Lp7plW0+2mGLeymm6fYTXdboxxO6vp9lGa7jbHuCVNd49YTbebY9ySprtHaLobgHFbmu5+StPdAIzb0nT3E5ruhmDcmqa779J0NwTj1jTdfYemu0EYt6bp7js03Q3CuD1Nd/fSdDcI4/Y03d1D090wjNvTdHcPTXfDMI5wnG7uoeluGMYRNN3douluGMYRNN3dcpxuBmIcQdPdGU13AzGOcZxuzmi6G4hxjON0c0bT3UCMYxynmzOa7gZiHEPT3Yqmu4EYx9B0t6LpbiDGMTTdrRynm6EYx9B0t3KcboZiHEPT3cpxuhmKcQxNdyvH6WYoxjE03a0cp5uhGMfQdLdynG6GYhxD093KcboZinEMTXcrx+lmKMYxNN2tHKeboRjH0HS3cpxuhmIcQ9PdynG6GYpxlP9Pfz9znG6GYhznkX/qI283xpgwJowJY8KYMCaMCWPCmDAmjAljwpgwJowJY8KYMCaMCWPCmDAmjAljwpgwJowJY8KYX+3P338AJHckMzDP7f4AAAAASUVORK5CYII=",name:G("喇叭形焊缝")},{typeName:Ge.SingleBellShapedWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAABnCAYAAAAdQVz5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAK5SURBVHhe7dBBjuNADAPA+f+nZ+e4CKptJ6ETtSACdWGoNpCfv/yOsliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGliOGljG/R/9vrOr0e0JllGKdrt4NXrrBMsoRbuqUtHbJ1hGKdpVk46+cYJllKJdBXdE37mIZZSi3Te9Gr0VxDJK0e5bnonub8QyStHu065Gtx/CMkrR7lOuRrcfxjJK0e4TrkR3X8IyStHubmfRzZexjFK0u9NRtC+CZZSi3R3OoptCWEYp2qUdRfuCWEYp2iUdRfuiWEYp2qUcRfvCWEYp2iUcRfviWEYp2iWsou0GWEYp2r1rFW03wTJK0e4dq2i7EZZRinavWkXbzbCMUrR7laLdhlhGKdq9YhVtN8QyStHuWatouymWUYp2z1K02xjLKEW7Z6yi7cZYRinaPUPRbnMsoxTtrlK0a4BllKLdVYp2DbCMUrS7QtGuCZZRinZXKNo1wTJK0e4KRbsmWEYp2p1RtGuEZZSi3RlFu0ZYRinaHVG0a4ZllKLdEUW7ZlhGKdodUbRrhmWUot0RRbtmWEYp2q0o2jXEMkrRbkXRriGWUYp2K4p2DbGMUrRbUbRriGWUot2Kol1DLKMU7VYeo01TLKMU7VYeo01TLKMU7VYeo01TLKMU7UTRrimWUYp2omjXFMsoRTtRtGuKZZSinSjaNcUyStFOFO2aYhmlaCeKdk2xjFK0E0W7plhGKdqJol1TLKMU7UTRrimWUYp2omjXFMsoRTtRtGuKZdRjtDnyGG2aYnmLd/7Yd243xnLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHLUwHJ83c/vPxMESWh6J6w5AAAAAElFTkSuQmCC",name:G("单边喇叭形焊缝")},{typeName:Ge.HeapWeldSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAJYAAACWCAYAAAA8AXHiAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAANZSURBVHhe7c5BrtswFMXQ7n/TbScfKALKlk3bsQpe4EyYpyS//u53cgOMiYUxsTAmFsbEwphYGBMLY2JhTCyMiYUxsTAmFsbEwphYGBMLY2JhTCyMiYUxsTAmFsbEwphYGBMLY2JhTCyMiYUxsTAmFsbEwphYGBMLY2JhTCyMiYUxsTAmFsbEwphYGBMLY2JhTCyMiYUxsTAmFsbEwphYGBMLY2JhTCyMiYUxsTAmFsbEwvgqe6M3q9ka3S8A41ddMfret7hi9L0vg/Fxd45+72l3jn7vBTA+4unRf7jbk6Pf/yKMt/r26D9d7Zuj//MFGG9zdPQd5OjoO65yZPR+5OjoOx6E8RYzo3dnzI7enjU7envGzOjdQzBeamb07gozo3dHzYzeXWFm9O5mGC+zN3pzh73Rm1l7ozd32Bu9uRHGS2yN7p+wNbrfszW6v9ve6M1NMGpbo/snbY3uR7ZG90/aGt3fAKOyNbr/hq3R/afR6PZbRqPbG2BURqPbb9oa3f8YjW6/bTS6vRjG00aj2zcYjW5/0OjuLUaj2wthPGU0un2T0eztm4xGtxfBeNhodPtGox29eavR6PYiGA8bjW7finbk87cbjW4vgPEwGt292Wijzz7fr4BGdxfAeAiN7lZA2+qrGY1uJYyH0OhuBbOjt6ug0Z2EcRqN7lYyM3q3itHoVsA4jUZ3K5kZvVsJje4EjNNodLeardH9amh0J2CcQqO7FW2N7ldDozsB4xQa3a1oa3S/IhrdnYRxCo3uVjQa3a6KRncnYZzyObpZGY3uVkWju5MwTvkc3ayMRnerotHdSRinfI5uVkaju1XR6O4kjLtodLcyGt2t7HN0cxLGXTS6WxmN7lb2Obo5CeMuGt2tjEZ3K/sc3ZyEccq/o8//B/+OPl/d5+jmJIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMLIyJhTGxMCYWxsTCmFgYEwtjYmFMhF+//wCT9z8Vxt/ZFwAAAABJRU5ErkJggg==",name:G("堆焊缝")},{typeName:Ge.SeamSeam,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAIsAAACPCAYAAADKiCjpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAANiSURBVHhe7c/RTiRHEEVB//9Pr40lWxhHwbBUQ1bPuVK8nMmWpv74a7+SBzEmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKM471MfarT/u8C42ivp9+neTvdHIJxLE13U2i6OwTjWJruJlhNt4dgHEvT3U9bTbcHYRxL091PWk23h2EcS9PdT1lNtwdiHEvT3U9YTbeHYhxL0913W023B2McS9Pdd1pNt4djHEvT3XdZTbc3wDiWprvvsJpub4JxLE13V1tNtzfCOJamuyutptubYRxL091VVtPtDTGOpenuCqvp9qYYx9J0t9tqur0xxrE03e20mm5vjnEsTXe7rKbbJ8A4lqa7HVbT7ZNgHEvT3VetptsnwjiWpruvWE23T4ZxLE13v2s13T4hxrE03f2O1XT7pBjH0nT3Wavp9okxjqXp7jNW0+2TYxxL092jVtNtHMfSdPeI1XSbvzGOpenuI6vpNv9iHEvT3XtW023+g3EsTXcrq+k2/8M4lqY7WU23IcaxNN29tZpus8Q4lqa711bTbd7FOJamu3+sptt8iHEsTXcvVtNtHsI4lvbo3ct0m4cxjqU9cvOyt3f5NMaxtI9+f9nrm/w2xrG093572evv8yWMY2mr/rK33+dLGMf6zPR9voRxrEenb/NljGM9Mn2XLRjH+mj6JtswjvXedJ+tGMdaTbfZjnEsTXe5BONYmu5yCcaxNN3lEoxjabrLJRjH0nSXSzCOpekul2AcS9NdLsE4lqa7XIJxLE13uQTjWJrucgnGsU6f3nQQxrHuML3rEIxj3WF61yEYx7rD9K5DMI52+vSmQzBmE013h2DMJpruDsGYTTTdHYIxm2i6OwRjNtF0dwjGbKLp7hCM2UTT3SEYs4mmu0MwZhNNd4dgzCaa7g7BmE003R2CMZtoujsEYzbRdHcIxmyi6e4QjNlE090hGLOJprtDMGYTTXeHYBzt9OlNh2Ac6w7Tuw7BONYdpncdgnGsO0zvOgTjaCdP7zkIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmwpgIYyKMiTAmb/zx609Bd0um/KSnwAAAAABJRU5ErkJggg==",name:G("锁边焊缝")},{typeName:Ge.LockTheSlopeOpening,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABxCAYAAADifkzQAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAALeSURBVHhe7c5BjuMwFAPRvv+le2YWAwRCUXESyxQdEnib8k+gn7/7rXgYKwvGyoKxsmCsLBgrC8bKgrGyYKwsGCsLxsqCsbJgrCwYKwvGyoKxsmCsLBgrC8bKgrGyYKwsGA95HH3/Ro+j74tgfIpGd9+ERncLYHxKjW6/gRrdLoDxKTW6vbvZ6H4BjIeo0e1dzUb3i2A8TI1u70iNbhfC+BI1ur0TNbpdDOPL1Oj2DtTo9gIY36JGt8nU6PYiGN+mRreJ1Oj2QhjfNhvdJ1Gj24th/MhsdJ9gNrq/GMaPzUb3O5uN7g0wnkKNbnc1G92bYDyNGt3uZja6N8J4KjW63Yka3ZphPJ0a3e5AjW43gHEJNbp1UqPbTWBcRo1uHdTodiMYl1Kj2yup0e1mMC41G91fQY1uN4RxudnofqXZ6H5DGC8xG92vMBvdbwrjZdTo9myz0f3GMF5KjW7PpEa3m8N4OTW6PYMa3QbAaKFGt59Qo9sQGG3U6PYdanQbBKOVGt2+Qo1uw2C0U6PbI9ToNhBGu9nofkaNbkNh3MJsdE9mo/tQGLcxG90/mo3ug2Hcihrd/jcb3YfDuB01uv1HjW5vAOOW1N69uxGM21I7+v2mMG7t1dF/3AzG7R0d/faGMEbYYfQuA4wRdhi9ywBjDPfoTQYYozhH7zHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAWMI4ujHAGMU5eo8BxijO0XsMMEZxjt5jgDGKc/QeA4yVBWNlwVhZMFYWjJUFY2XBWFkwVhaMlQVjZcFYWTBWFoyVBWNlwVhZMFYWjJUFY2XBWFkwVhaMlQVjxfj5/QNv9lDtDk628AAAAABJRU5ErkJggg==",name:G("锁边坡口")}]),h=b.reactive({symbolPos:ii.top,dottedLinePos:0,leftDim:"",rightDim1:"",rightDim2:"",topDim:"",weldingSymbolInfo:"",description:"",intWeldSeam:""}),o=[{label:G("上"),value:1},{label:G("下"),value:2},{label:G("无"),value:0}],m=()=>{h.intWeldSeam=h.weldingSymbolInfo=h.leftDim=h.topDim=h.rightDim1=h.rightDim2="",T.basicSymbol.forEach(nt=>{H.includes(nt.typeName)&&nt.position===h.symbolPos&&(nt.info="")}),["rightDim1","rightDim2","leftDim","topDim"].forEach(nt=>{T[nt].forEach(ct=>{ct.position===h.symbolPos&&(ct.content="")})}),T.intWeldSeam.forEach(nt=>{nt.position===h.symbolPos&&(nt.content="")}),Z()};let y=new p.McDbWipeout,x=new p.McGePoint3d,M;b.onMounted(()=>{za.value=520;const{wipeout:st,midPt:nt}=b1();if(y=st,x=nt.clone(),Wo.value){M=Wo.value.clone();const ct=M.fixedPos.sub(M.weldingPosition).normalize().mult(10);M.weldingPosition=x,M.turningPoint=x.clone().addvec(ct),P()}else{M=new ap,M.weldingPosition=x;const ct=new p.McGeVector3d(10,10,0);M.turningPoint=x.clone().addvec(ct)}Z()});const A=(st,nt)=>{const ct=[];for(let xt=0;xt<st.length;xt+=nt)ct.push(st.slice(xt,xt+nt));return ct},T=b.reactive({basicSymbol:[{typeName:Ge.none,position:ii.top},{typeName:Ge.none,position:ii.down}],suppleSymbol:[{typeName:Ge.none}],specialSymbol:[],auxiliarySymbol:[{typeName:Ge.none,position:ii.top},{typeName:Ge.none,position:ii.down}],rightDim1:[{position:ii.top,content:""},{position:ii.down,content:""}],rightDim2:[{position:ii.top,content:""},{position:ii.down,content:""}],leftDim:[{position:ii.top,content:""},{position:ii.down,content:""}],topDim:[{position:ii.top,content:""},{position:ii.down,content:""}],intWeldSeam:[{position:ii.top,content:""},{position:ii.down,content:""}]}),P=()=>{const st=Wo.value.clone();T.basicSymbol=st.getBaseSymbok(),T.suppleSymbol=st.getSuppleSymbol(),T.specialSymbol=st.getSpecialSymbol(),T.auxiliarySymbol=st.getAuxiliarySymbol(),T.leftDim=st.getLeftDim(),T.topDim=st.getTopDim(),T.intWeldSeam=st.getIntWeldSeam(),st.getRightDim().forEach(vt=>{const Zt=vt.content.split("×");T.rightDim1.forEach(ce=>{ce.position===vt.position&&(ce.content=Zt[0]||"")}),T.rightDim2.forEach(ce=>{ce.position===vt.position&&(ce.content=Zt[1]||"")})}),h.dottedLinePos=st.dottedLinePos,h.description=st.weldingSymbolInfo.replace(/\\P/g,`
`),T.specialSymbol.length&&(h.symbolPos=T.specialSymbol[0].position),["topDim","rightDim1","leftDim","rightDim2"].forEach(vt=>{T[vt].length==0?T[vt]=[{position:ii.top,content:""},{position:ii.down,content:""}]:T[vt].forEach(Zt=>{Zt.position===h.symbolPos&&(h[vt]=Zt.content)})}),[{arr:n,flag:"basic",num:7,name:G("basicSymbol")},{arr:r,flag:"auxi",num:3,name:G("auxiliarySymbol")},{arr:s,flag:"supple",num:3,name:G("suppleSymbol")},{arr:u,flag:"special",num:5,name:G("specialSymbol")}].forEach(vt=>{if(!T[vt.name].length)vt.name==="suppleSymbol"?T[vt.name]=[{typeName:Ge.none}]:T[vt.name]=[{typeName:Ge.none,position:ii.top},{typeName:Ge.none,position:ii.down}];else{let Zt=T[vt.name].filter(ce=>ce.position===h.symbolPos);vt.name==="suppleSymbol"&&(Zt=T[vt.name]),Zt.length&&Zt.forEach(ce=>{const le=ce.typeName,fe=A(vt.arr,vt.num);ce.info&&(h.weldingSymbolInfo=ce.info),fe.forEach((de,Le)=>{de.forEach((Lt,bt)=>{Lt.typeName===le&&D(Le,bt,vt.num,vt.flag,Lt,!1)})})})}}),T.intWeldSeam.length?T.intWeldSeam.forEach(vt=>{vt.position===h.symbolPos&&(h.intWeldSeam=vt.content)}):T.intWeldSeam=[{position:ii.top,content:""},{position:ii.down,content:""}],["basicSymbol","auxiliarySymbol","intWeldSeam"].forEach((vt,Zt)=>{if(T[vt].length!==2){const le=T[vt].filter(fe=>fe.position===ii.top).length?ii.down:ii.top;Zt===2?T[vt].push({content:"",position:le}):T[vt].push({typeName:Ge.none,position:le})}})},D=(st,nt,ct,xt,vt,Zt=!0)=>{if(vt.isDisable)return;const ce=st*ct+nt;let le=[];if(xt==="basic")le=n,le.forEach(de=>de.isChecked=!1),T.basicSymbol.forEach(de=>{de.position===h.symbolPos&&(de.typeName=vt.typeName),H.includes(vt.typeName)&&de.position===h.symbolPos&&(de.info=h.weldingSymbolInfo)}),u.forEach(de=>de.isChecked=!1),T.specialSymbol.length=[],[s,r].forEach(de=>{de.forEach(Le=>Le.isDisable=!1)}),T.specialSymbol.length=0,u.forEach(de=>de.isChecked=!1),W(),le[ce].isChecked=!0;else if(xt==="auxi")le=r,le.forEach(fe=>fe.isChecked=!1),Zt&&T.auxiliarySymbol.forEach(fe=>{fe.position===h.symbolPos&&(fe.typeName=vt.typeName)}),le[ce].isChecked=!0;else if(xt==="supple"){if(le=s,le[ce].isChecked)vt.typeName!==Ge.ThreeSidedWeldSeamSymbol&&(le[ce].isChecked=!1,T.suppleSymbol=T.suppleSymbol.filter(fe=>fe.typeName!==vt.typeName));else{if(le.forEach(fe=>{fe.typeName===Ge.none&&(fe.isChecked=!1)}),vt.typeName===Ge.ThreeSidedWeldSeamSymbol){const fe=T.suppleSymbol.findIndex(de=>de.typeName===Ge.ThreeSidedWeldSeamSymbol);le.forEach(de=>{de.typeName===Ge.ThreeSidedWeldSeamSymbol&&(de.isChecked=!1)}),fe>0?T.suppleSymbol[fe].rotation=vt.rotation:T.suppleSymbol.push({typeName:vt.typeName,rotation:vt.rotation})}else vt.typeName===Ge.none?(Zt&&(T.suppleSymbol.length=0,T.suppleSymbol.push({typeName:Ge.none})),le.forEach(de=>{de.typeName!==Ge.none&&(de.isChecked=!1)}),[u,n].forEach(de=>{de.forEach(Le=>{Le.isDisable&&(Le.isDisable=!1)})})):vt.typeName===Ge.WithPadSymbol?(u.forEach(fe=>{fe.isChecked=!1,fe.isDisable=!0}),T.specialSymbol.length=[],Zt&&T.suppleSymbol.push({typeName:vt.typeName})):(T.suppleSymbol=T.suppleSymbol.filter(fe=>fe.typeName!=Ge.none),Zt&&T.suppleSymbol.push({typeName:vt.typeName}));le[ce].isChecked=!0}U()}else if(xt==="special"){le=u,le.forEach(de=>de.isChecked=!1),Zt&&(T.specialSymbol.length=0,T.specialSymbol.push({typeName:vt.typeName,position:h.symbolPos})),r.forEach(de=>{de.typeName!==Ge.none?(de.isDisable=!0,de.isChecked=!1):de.isChecked=!0}),T.auxiliarySymbol.length=0,T.auxiliarySymbol.push({typeName:Ge.none,position:ii.top},{typeName:Ge.none,position:ii.down});const fe=[Ge.ThreeSidedWeldSeamSymbol,Ge.WithPadSymbol];s.forEach(de=>{fe.includes(de.typeName)&&(de.isDisable=!0,de.isChecked=!1)}),T.suppleSymbol=T.suppleSymbol.filter(de=>!fe.includes(de.typeName)),T.basicSymbol.forEach(de=>{de.typeName=Ge.none}),n.forEach(de=>{de.isChecked=!1}),le[ce].isChecked=!0}Zt&&Z()},k=()=>{const st=T.specialSymbol.length>0;T.auxiliarySymbol.forEach(ct=>{ct.position===h.symbolPos&&r.forEach(xt=>{xt.isChecked=!1,ct.typeName===xt.typeName&&(xt.isChecked=!0)})}),T.basicSymbol.forEach(ct=>{ct.position===h.symbolPos&&(st||(h.weldingSymbolInfo=(ct==null?void 0:ct.info)||""),ct.info&&(h.weldingSymbolInfo=ct.info),n.forEach(xt=>{xt.isChecked=!1,xt.typeName===ct.typeName&&(xt.isChecked=!0)}))}),["topDim","rightDim1","rightDim2","leftDim"].forEach(ct=>{T[ct].forEach(xt=>{xt.position===h.symbolPos&&(h[ct]=xt.content)})}),T.specialSymbol.forEach(ct=>ct.position=h.symbolPos),T.intWeldSeam.forEach(ct=>{ct.position===h.symbolPos&&(h.intWeldSeam=ct.content)}),U(),Z()},z=()=>{T.basicSymbol.forEach(st=>{H.includes(st.typeName)&&st.position===h.symbolPos&&(st.info=h.weldingSymbolInfo)}),Z()},O=st=>{let nt="item";return st.isChecked&&(nt+=" checked"),st.isDisable||(nt+=" itemHover"),nt},U=()=>{if(!T.suppleSymbol.filter(nt=>nt.typeName===Ge.WithPadSymbol).length)[n,u].forEach(ct=>{ct.forEach(xt=>{xt.isDisable&&(xt.isDisable=!1)})});else if(h.symbolPos===ii.top){const nt=[Ge.SeamWeld,Ge.SpotWeldSeam];let ct=!1;n.forEach(xt=>{nt.includes(xt.typeName)?(xt.isDisable=!0,xt.isChecked===!0&&(xt.isChecked=!1,ct=!0)):xt.isDisable=!1}),ct&&n.forEach(xt=>{xt.typeName===Ge.none&&(xt.isChecked=!0)}),T.basicSymbol.forEach(xt=>{nt.includes(xt.typeName)&&xt.position===h.symbolPos&&(xt.typeName=Ge.none)})}else h.symbolPos===ii.down&&(n.forEach(nt=>{nt.typeName!=Ge.none?(nt.isDisable=!0,nt.isChecked=!1):(nt.isChecked=!0,nt.isDisable=!1)}),T.basicSymbol.forEach(nt=>{nt.position===h.symbolPos&&(nt.typeName=Ge.none)}));W()},H=[Ge.VWeldSeam,Ge.SingleVWeldSeam,Ge.SingleSteepVWeldSeam,Ge.InclinedWeldSeam,Ge.VFlangedEdgeSeam,Ge.SingleVFlangedEdgeSeam,Ge.UFlangedEdgeSeam],V=()=>!T.basicSymbol.filter(nt=>H.includes(nt.typeName)&&nt.position===h.symbolPos).length,W=()=>{T.basicSymbol.filter(nt=>H.includes(nt.typeName)&&nt.position===h.symbolPos).length||(h.weldingSymbolInfo="")},K=b.ref(),Z=st=>Gt(this,null,function*(){T.suppleSymbol.filter(wt=>wt.typeName===Ge.TailSymbol).length||(h.description=""),T.suppleSymbol.filter(wt=>wt.typeName===Ge.ZSymbol).length?h.dottedLinePos=0:h.intWeldSeam="",T.basicSymbol.filter(wt=>wt.position===h.symbolPos&&H.includes(wt.typeName)).length||(h.weldingSymbolInfo=""),T.suppleSymbol.filter(wt=>wt.typeName===Ge.WithPadSymbol).length&&T.basicSymbol.forEach(wt=>{wt.position===ii.down&&(wt.typeName=Ge.none)});const Zt=Bh({weldingSymbolInfo:h.description,dottedLinePos:h.dottedLinePos},T),ce=p.MxCpp.getCurrentMxCAD();M.setSpecialSymbol(Zt.specialSymbol);const le=[ii.top,ii.down],fe=[];le.forEach(wt=>{const Ct=Zt.rightDim1.filter(ee=>ee.position===wt)[0],Mt=Zt.rightDim2.filter(ee=>ee.position===wt)[0],jt=Ct.content&&Mt.content?"×":"";fe.push({position:wt,content:Ct.content+jt+Mt.content})}),M.setRightDim(fe),M.setSuppleSymbol(Zt.suppleSymbol),M.setLeftDim(Zt.leftDim),M.setTopDim(Zt.topDim),M.setAuxiliarySymbol(Zt.auxiliarySymbol),M.setBaseSymbok(Zt.basicSymbol),M.setIntWeldSeam(Zt.intWeldSeam),M.dottedLinePos=Zt.dottedLinePos,M.weldingSymbolInfo=Zt.weldingSymbolInfo.replace(/\n/g,"\\P");const de=ce.drawEntity(M),{minPt:Le,maxPt:Lt}=M.getBoundingBox(),bt=Lt.sub(Le).normalize().mult(2);Le.addvec(bt.clone().negate()),Lt.addvec(bt);let qt=new p.McGeLongArray;qt.copyFormAryId([de]),p.MxCpp.App.MxCADAssist.MxExplode(qt.imp);let Wt=(Lt.x-Le.x)*5,Nt=120/300*Wt;const se=yield Kd({type:"image/bmp",width:Wt,height:Nt,range_pt1:Le.toVector3(),range_pt2:Lt.toVector3()});K.value.src=se,ce.mxdraw.updateCanvasSize();let _t=new p.MxCADSelectionSet;_t.crossingSelect(Le.x,Le.y,Lt.x,Lt.y),_t.forEach(wt=>{wt.erase()}),e("receiveParameters",{formData:Zt})}),tt=()=>{["topDim","rightDim1","leftDim","rightDim2"].forEach(nt=>{T[nt].forEach(ct=>{ct.position===h.symbolPos&&(ct.content=Object.values(h)[Object.keys(h).findIndex(xt=>xt===nt)])})}),Z()},at=()=>{T.intWeldSeam.forEach(st=>{st.position===h.symbolPos&&(st.content=h.intWeldSeam)}),Z()};return b.onBeforeUnmount(()=>{y.erase(),Wo.value=null}),(st,nt)=>(b.openBlock(),b.createElementBlock("div",null,[b.createElementVNode("div",uB,[b.createElementVNode("div",hB,[b.createElementVNode("img",{alt:"",ref_key:"img",ref:K,style:{width:"100%",height:"100%"}},null,512)]),dB]),b.createElementVNode("div",pB,[b.createElementVNode("div",fB,[b.createElementVNode("span",mB,b.toDisplayString(b.unref(G)("基本符号")),1),(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(A(n,7),(ct,xt)=>(b.openBlock(),b.createElementBlock("div",{class:"row",key:xt},[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(ct,(vt,Zt)=>(b.openBlock(),b.createBlock(b.unref(on.VTooltip),{key:vt.name,text:vt.name,disabled:vt.isDisable},{activator:b.withCtx(({props:ce})=>[b.createElementVNode("div",{class:b.normalizeClass(O(vt)),onClick:le=>D(xt,Zt,7,"basic",vt)},[b.createElementVNode("img",b.mergeProps({src:vt.img,alt:""},ce,{style:vt.isDisable?"opacity: 0.3;":""}),null,16,yB)],10,gB)]),_:2},1032,["text","disabled"]))),128))]))),128))]),b.createElementVNode("div",xB,[b.createElementVNode("span",vB,b.toDisplayString(b.unref(G)("辅助符号")),1),(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(A(r,3),(ct,xt)=>(b.openBlock(),b.createElementBlock("div",{class:"row",key:xt},[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(ct,(vt,Zt)=>(b.openBlock(),b.createBlock(b.unref(on.VTooltip),{key:vt.name,text:vt.name,disabled:vt.isDisable},{activator:b.withCtx(({props:ce})=>[b.createElementVNode("div",{class:b.normalizeClass(O(vt)),onClick:le=>D(xt,Zt,3,"auxi",vt)},[b.createElementVNode("img",b.mergeProps({src:vt.img,alt:""},ce,{style:vt.isDisable?"opacity: 0.3;":""}),null,16,bB)],10,_B)]),_:2},1032,["text","disabled"]))),128))]))),128))]),b.createElementVNode("div",MB,[b.createElementVNode("span",wB,b.toDisplayString(b.unref(G)("补充符号")),1),(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(A(s,3),(ct,xt)=>(b.openBlock(),b.createElementBlock("div",{class:"row",key:xt},[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(ct,(vt,Zt)=>(b.openBlock(),b.createBlock(b.unref(on.VTooltip),{key:vt.name,text:vt.name,disabled:vt.isDisable},{activator:b.withCtx(({props:ce})=>[b.createElementVNode("div",{class:b.normalizeClass(O(vt)),onClick:le=>D(xt,Zt,3,"supple",vt)},[b.createElementVNode("img",b.mergeProps({src:vt.img,alt:""},ce,{style:vt.isDisable?"opacity: 0.3;":""}),null,16,EB)],10,AB)]),_:2},1032,["text","disabled"]))),128))]))),128))])]),b.createElementVNode("div",TB,[b.createElementVNode("div",PB,[b.createElementVNode("span",SB,b.toDisplayString(b.unref(G)("符号位置")),1),b.createVNode(b.unref(on.VRadioGroup),{modelValue:h.symbolPos,"onUpdate:modelValue":nt[0]||(nt[0]=ct=>h.symbolPos=ct),onChange:k},{default:b.withCtx(()=>[b.createElementVNode("div",CB,[b.createVNode(b.unref(on.VRadio),{label:"上",value:b.unref(ii).top},null,8,["value"]),b.createVNode(b.unref(on.VRadio),{label:"下",value:b.unref(ii).down},null,8,["value"])])]),_:1},8,["modelValue"])]),b.createElementVNode("div",DB,[b.createElementVNode("span",RB,b.toDisplayString(b.unref(G)("特殊符号")),1),(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(A(u,5),(ct,xt)=>(b.openBlock(),b.createElementBlock("div",{class:"row",key:xt},[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(ct,(vt,Zt)=>(b.openBlock(),b.createBlock(b.unref(on.VTooltip),{key:vt.name,text:vt.name,disabled:vt.isDisable},{activator:b.withCtx(({props:ce})=>[b.createElementVNode("div",{class:b.normalizeClass(O(vt)),onClick:le=>D(xt,Zt,5,"special",vt)},[b.createElementVNode("img",b.mergeProps({src:vt.img,alt:""},ce,{style:vt.isDisable?"opacity: 0.3;":""}),null,16,IB)],10,LB)]),_:2},1032,["text","disabled"]))),128))]))),128))])]),b.createElementVNode("div",kB,[b.createElementVNode("div",BB,[b.createElementVNode("div",FB,[b.createElementVNode("div",zB,[b.createElementVNode("span",NB,b.toDisplayString(b.unref(G)("左尺寸")),1),b.createElementVNode("div",UB,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:h.leftDim,"onUpdate:modelValue":nt[1]||(nt[1]=ct=>h.leftDim=ct),onBlur:nt[2]||(nt[2]=ct=>tt())},null,8,["modelValue"])])]),b.createElementVNode("div",VB,[b.createElementVNode("span",GB,b.toDisplayString(b.unref(G)("上尺寸")),1),b.createElementVNode("div",OB,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:h.topDim,"onUpdate:modelValue":nt[3]||(nt[3]=ct=>h.topDim=ct),onBlur:nt[4]||(nt[4]=ct=>tt())},null,8,["modelValue"])])]),b.createElementVNode("div",jB,[b.createElementVNode("span",HB,b.toDisplayString(b.unref(G)("右尺寸")),1),b.createElementVNode("div",WB,[b.createElementVNode("div",qB,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:h.rightDim1,"onUpdate:modelValue":nt[5]||(nt[5]=ct=>h.rightDim1=ct),onBlur:nt[6]||(nt[6]=ct=>tt())},null,8,["modelValue"])]),YB,b.createElementVNode("div",XB,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:h.rightDim2,"onUpdate:modelValue":nt[7]||(nt[7]=ct=>h.rightDim2=ct),onBlur:nt[8]||(nt[8]=ct=>tt())},null,8,["modelValue"])])])])]),b.createElementVNode("div",KB,[b.createElementVNode("div",ZB,[b.createElementVNode("span",JB,b.toDisplayString(b.unref(G)("交错焊缝")),1),b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("间距")),1),b.createElementVNode("div",QB,[b.createVNode(b.unref(on.VTextField),{onBlur:nt[9]||(nt[9]=ct=>at()),type:"text",modelValue:h.intWeldSeam,"onUpdate:modelValue":nt[10]||(nt[10]=ct=>h.intWeldSeam=ct),disabled:!T.suppleSymbol.filter(ct=>ct.typeName===b.unref(Ge).ZSymbol).length},null,8,["modelValue","disabled"])])]),b.createElementVNode("div",$B,[b.createElementVNode("span",tF,b.toDisplayString(b.unref(G)("扩充文字")),1),b.createElementVNode("div",eF,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:h.weldingSymbolInfo,"onUpdate:modelValue":nt[11]||(nt[11]=ct=>h.weldingSymbolInfo=ct),disabled:V(),onBlur:z},null,8,["modelValue","disabled"])])]),b.createElementVNode("div",nF,[b.createElementVNode("span",iF,b.toDisplayString(b.unref(G)("虚线位置")),1),b.createVNode(b.unref(on.VRadioGroup),{modelValue:h.dottedLinePos,"onUpdate:modelValue":nt[13]||(nt[13]=ct=>h.dottedLinePos=ct)},{default:b.withCtx(()=>[(b.openBlock(),b.createElementBlock(b.Fragment,null,b.renderList(o,ct=>b.createVNode(b.unref(on.VRadio),{onChange:nt[12]||(nt[12]=xt=>Z()),key:ct.value,label:ct.label,value:ct.value,style:{"margin-left":"10px"},disabled:T.suppleSymbol.filter(xt=>xt.typeName===b.unref(Ge).ZSymbol).length},null,8,["label","value","disabled"])),64))]),_:1},8,["modelValue"])])])]),b.createElementVNode("div",rF,[b.createElementVNode("span",oF,b.toDisplayString(b.unref(G)("焊接说明")),1),b.createVNode(b.unref(on.VTextarea),{modelValue:h.description,"onUpdate:modelValue":nt[14]||(nt[14]=ct=>h.description=ct),rows:"6",class:"mb-3",disabled:!T.suppleSymbol.filter(ct=>ct.typeName===b.unref(Ge).TailSymbol).length,onBlur:nt[15]||(nt[15]=ct=>Z())},null,8,["modelValue","disabled"])])]),b.createVNode(b.unref(on.VBtn),{onClick:m,class:"btn"},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(b.unref(G)("清除行")),1)]),_:1})]))}}),WO="",aF=zo(sF,[["__scopeId","data-v-253ca580"],["__file","WeldingSymbolDialog.vue"]]),lF={class:"fbc",style:{"margin-top":"10px"}},cF={style:{width:"100%",height:"140px"}},uF={class:"fbc"},hF={class:"btnBox"},dF={class:"tiltle"},pF=["onClick"],fF=["src"],mF={style:{width:"60%"}},gF={class:"btnBox fbc",style:{padding:"10px 5px"}},yF={class:"tiltle"},xF={class:"btnBox fbc",style:{padding:"10px 5px"}},vF={class:"tiltle"},_F={class:"fbc"},bF={style:{width:"75%"}},MF={class:"btnBox"},wF={class:"tiltle"},AF={class:"fbc",style:{margin:"10px",width:"75%"}},EF={style:{width:"85%",padding:"0px 10px"},class:"fbc"},TF={class:"fbc",style:{width:"75%",margin:"0px 10px"}},PF={style:{width:"85%",padding:"0px 10px"},class:"fbc"},SF={class:"fbc"},CF={class:"tiltle"},DF={style:{width:"58%"}},RF={style:{width:"20%"}},LF={class:"btnBox"},IF={class:"tiltle"},kF={style:{display:"flex","align-items":"center",width:"100%","justify-content":"center"}},BF={style:{width:"50%"}},FF={style:{display:"flex",margin:"5px 0px 10px"}},zF={style:{display:"flex","margin-left":"10px"}},NF={style:{display:"flex","justify-content":"center",width:"100%","margin-top":"5px"}},UF=b.defineComponent({__name:"GemoetricToleranceDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=[ui.LineContourdegree,ui.SurfaceContourDegree],r=b.reactive([{typeName:ui.Straightness,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGoAAABqCAYAAABUIcSXAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAFCSURBVHhe7dQxCoAwEAXR3P/SKlikmSYSYcT58Jopt9hx7cgnYIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8b4YIwPxvhgjA/G+GCMD8bH/jy6x0YYl7V7dJtNMC5rc3SfDTAua3N0nw0wPtI+8PryOozxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGB+M8cEYH4zxwRgfjPHBGJVxnJpUjwbRh+nHAAAAAElFTkSuQmCC",name:G("直线度")},{typeName:ui.Flatness,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAABuCAYAAADGWyb7AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAJ+SURBVHhe7dAxDtxQDEPB3P/SSWpjGq/1DQomgWkeVOnP//2tlRgrH2PlY6x8jJWPsfIxVj7GysdY+RgrH2PlY6x8jJWPsfIxVj7GysdY+RgrH2PlY6x8jJWPsfIxVj7GysdY+RgrH2PlY6x8jJWPsfIxVj7GysdY+RgrH+NxX5t+8BDjUV+dfvEA4zFfnv7xAOMxX57+8QDjMV+dfvEQ4zHX6WY7TXcPMR6h6W47TXcPMR6h6W47TXcPMR6h6W6763QzgHGcprvtNN0NYByn6W47TXcDGMdputtO090AxnGa7ra7TjdDGEdputtO090QxlGa7rbTdDeEcZSmu+003Q1hHKXpbrvrdDOIcYymu+003Q1iHKPpbjtNd4MYx2i6207T3SDGMZrutrtON8MYR2i6207T3TDGEZruttN0N4xxhKa77TTdDWMcoeluu+t0cwDjY5ruttN0dwDjY5ruttN0dwDjY5ruttN0dwDjY5rutrtON4cwPqLpbjtNd4cwPqLpbjtNd4cwPqLpbjtNd4cwPqLpbjNNdwcx/kzT3Xaa7g5i/Jmmu+003R3E+DNNd9tpujuI8WfX6WY7TXeHMf5E0912mu4OY/yJprvtNN0dxvgTTXfbabo7jPEn1+lmO013L2C8TdPddpruXsB4m6a77TTdvYDxNk1322m6ewHjbdfpZjtNdy9hvEXT3Xaa7l7CeIumu+003b2E8ZYvT/94CeMtX51+8SLGW746/eJFjLd8dfrFixgrH2PlY6x8jJWPsfIxVj7GysdY+RgrH2PlY6x8jJWPsfIxVj7GysdY+RgrH2PlY6x8jJWPsfIxVj7GysdY+Rgr2p+//wDqI2fIuIp4ZQAAAABJRU5ErkJggg==",name:G("平面度")},{typeName:ui.Roundness,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHEAAABvCAYAAADboi87AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAMRSURBVHhe7c5LDiM3EETBuf+lx14LwW7JLn6SqAfEJlGU+s+//W3xOLYsHFsWji0Lx5aFY8vCsWXh2LJwbFk4tiwcWxaOLQvHloVjy8KxZeHYsnBsWTi2LBxbFo4tC8eWhWPLwjHWr+k3AnGMUZ3+IwDH461I/3sojkfalb7lMByPc0L6rkNwPMav6Tfe/JLeH4DjEb5J7/6Pb9PbjThu9U16V+0tvdmE4zZv6c1Mb+nNBhy3eEtvVnlK94txXO4p3e/wlO4X4rjUU7rfbZRuF+G4zFO6P8Uo3S7AcZlRuj3NKN1OxnGJUbo91SjdTsRxulG6Pdko3U7EcTqluwSjdDsJx6lG6TaF0t0kHKdSuksySrcTcJxG6S6R0t0EHKdRukuldFeM4xRKd8mU7opxnELpLp3SXSGOUyjdpVO6K8SxnNLdDZTuCnEsp3R3i890U4hjOaW7WyjdFeFY7jPd3ETprgjHUkp3N1G6K8KxlNLdTZTuinAspXR3m890U4RjKaW723ymmyIcSynd3eYz3RThWErp7jZKdwU4llK6u43SXQGOpZTubvOZbopwLKV0d5vPdFOEYymlu9t8ppsiHEsp3d1E6a4Ix1JKdzdRuivCsZzS3S2U7opwLKd0dwuluyIcyynd3eIz3RTiWE7p7gZKd4U4TqF0l07prhDHKZTuko3SbSGOU4zSbSqlu2Icp1G6S6V0V4zjNKN0m0bpbgKOUyndJRml2wk4TjVKtymU7ibhOJ3SXYJRup2E43SjdHuyUbqdiOMSo3R7KqW7yTguM0q3pxml28k4LjVKt6cYpdsFOC71lO53ekr3i3Bc7ind7/CU7hfiuMVberPKU7pfjOM2b+nNTG/pzQYct/omvav0TXq3CccjfJve/lffprcbcTzGr+k33vyS3h+A43FOSN91CI7H2pG+4zAcj7ci/e+hOMaoTv8RgGO0X9L7QBxbFo4tC8eWhWPLwrFl4diycGxZOLYsHFsWji0Lx5aFY8vCsWXh2LJwbFk4tiwcWxaOLQvHloVjy8Kxxfjz9x8ogK+OZ4gxTQAAAABJRU5ErkJggg==",name:G("圆度")},{typeName:ui.Cylindricity,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGwAAABsCAYAAACPZlfNAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAANQSURBVHhe7c7BCuM4EATQ+f+fnt0cBoJ57cixJVWgC96lVI395//8bT+FZcvFsuVi2XKxbLlYtlwsWy6WLRfLlotly8Wy5WLZcrFsuVi2XCxbLpYtF8uWi2XLxbLlYtlysWy5WLZcLFsuli0Xy5aL5U95j95TvEfvg1j+DEW7BMdoM4Dlz1C0203RbgDLn1BF290U7Qaw/AmKdrsp2g1iGa+Ktrsp2g1iGU/RbjdFuwtYRlO0262KthewjFVF290U7S5iGUv59P6e9+1MVbS9iGWkGdF3nqBo9wWWkWZG3/tWFW2/wDLOiui731C0+xLLOCuj749StLuBZZTR6FZGorsRinY3sIzyKboZ8Sm6OaNodxPLGGfR/htn0V6qaHsTywhn0f6Os2h/pGj3AJYRqmj7hCravqui7QNYbldF2ydV0fYfRbuHsNyqirYzKNq9VNH2ISy3qqLtLMqd3YNYbqVoN5PyzWYClttU0XY25eztlff7SVhuo2i3gjLyNhnLLRTtVlGq/pXj/SQsl6ui7UrHqHvleDcRy+WqaLvSaHQ7CculzqL9SiPR3UQslzqL9iuNRHcTsVzmU3Sz0qfoZjKWy3yKblY6i/YLsFxiJLpb6SzaL8ByiZHobqUq2i7CcrrR6HalKtouwnKqKtXb8X6VKtouxHIqZeRttSraLsRymipn7+/3KynaLcZyGuWbzWxVtF2M5RRVRnbHzUxVtN2A5RSKdi+KdjMo2m3C8nFVtH2pou2Tqmi7CcvHKdq9q6LtE6pouxHLRynaHZ1F+zvOov1GLB9TRVs5i/ZXfYpuNmP5GEW7M5+imxEj0d1mLB9RRdtPRqPbd1ei+wAsH6FoN2p19A8BWN5WRdurVkTfDcHyNkW7O2ZF3wrC8hZFu6c8HX0jCMtbFO1mqTKyO24Csfyaot1uVbQNw/IrVbTdTdEuEMuvKNrtVkXbQCwvq6Ltbop2oVhepmi3WxVtQ7G8pIq2uynaBWN5iaLdbop24VgOU7RLoGgXjuUlx2iT4BhtfgDLy/5Fb0n+RW8/gmXLxbLlYtlysWy5WLZcLFsuli0Xy5aLZcvFsuVi2XKxbLlYtlwsWy6WLRfLlotly8Wy5WLZcrFsuVi2SH/+/gesHHGw7eaGswAAAABJRU5ErkJggg==",name:G("圆柱度")},{typeName:ui.LineContourdegree,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGgAAABoCAYAAAAdHLWhAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAI1SURBVHhe7c5BjqNAFETBvv+le2bZsgKMigKSUqYUm+dftn/+77eiMVYOxsrBWDkYKwdj5WCsHIyVg7FyMFYOxsrBWDkYKwdj5WCsHIyVg7FyMFYOxsrBWDkYKwdj5WCsHIyVg7FyMFYOxsrBWDkYKwdj5WCsHIyvsjfdvwxjrFnTd4dijHL19JtBGCPcPf2HAIyPenr6Tw9ifMTI9D0yMn3PAxhvd3R6O+Lo9PZmjLc5Mr2b5cj07kaMt/g2vbnKkendDRgv9216c4dv05uLMV5qb7p/wt50fyHGy+xN90/am+4vwniJvek+wd50fwHG6fam+yRb0+0FGKfbmm4TbU23kzFOtTXdJtuabidinGZrun0DTXcTMU6j6e4ttqbbSRin2Jpu32Rrup2AcQpNd2+k6W4CxtM03b3V1nR7EuNpmu7eTNPdSYynaLp7O013JzGeouluBZruTmA8RdPdCjTdncA4TNPdKjTdncA4TNPdSjTdDWIcpuluJZruBjEO03S3Ek13gxiHfU43q9F0N4hxiKa7FX1ON4MYh2i6W9HndDOIcYimuxV9TjeDGIdouluRprsBjEM03a1I090AxiGa7lb0Od0MYhz2d/p8ZX+nzwcxVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrws/vP1gI08FUACh8AAAAAElFTkSuQmCC",name:G("线轮廓度")},{typeName:ui.SurfaceContourDegree,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGgAAABoCAYAAAAdHLWhAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAIvSURBVHhe7dDLauRAFERB//9PewyzMG5C/agqSSmRCbE53LIbff3su6IxVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYLyET6b3F8EYafX0PwIxxjhi+r9BGE931vRbTsZ4moTpd52I8RSfTO9f+XT6GydgPNS709sZ70zvDsZ4mHemdyu9M707COMhXk1v9vRqenMAxt09m+6P8mp6szPGXT2b7s/wbLrfEeNutqbbsz2b7nfCuIut6TbFs+l+B4zLbU23aZ5N94sxLrU13abamm4XY1xqa7pNtjXdLsS4zNZ0ewVb0+0ijMtoursSTXeLMC6h6e5qtqbbBRinbU23V6TpbgHGaZrurmprup3EOE3T3ZVpupvEOEXT3dVpupvEOEXT3R1oupvAOEXT3R1oupvAOEzT3V1oupvAOEzT3Z1ouhvEOEzT3Z1ouhvEOOxxurkbTXeDGIdoursbTXeDGIdourujx+lmEOMQTXd39DjdDGIc0v1O32cQ45Du7/SNBjAO6f5O32gA45Dud/o+gxiHdf+nbzOIsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrB2PlYKwcjJWDsXIwVg7GysFYORgrwtf3P04oQotbv3IGAAAAAElFTkSuQmCC",name:G("面轮廓度")},{typeName:ui.Parallelism,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHUAAAB2CAYAAAD2kNwSAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAMfSURBVHhe7cpBbiQxDARB///T3j0ag+CFDalVGiYQF7J+/vc7rsPjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbjyMbj1/ib/k/9Tf9FePwKn2nz1GfaLMDj9aq07VLaLcDj9ZR2XVXaLsDj1aq07VLaLcLj1ZR2XVXaLsLjtaq07VLaLcTjtZR2XVXaLsTjlaq07VLaLcbjlZR2XUq7DXi8jtLuCaXdBjxepUrbLqXdJjxeRWnXVaXtJjxeo0rbLqXdRjxeQ2nXVaXtRjxeoUrbLqXdZjxeQWnXVaXtZjzGq9K2S2n3Ah7jKe26lHYv4TGa0u4Jpd1LeIxVpW2X0u5FPMZS2nVVafsiHiNVadultHsZj5GUdl1V2r6MxzhV2nYp7Q7AYxylXVeVtgfgMYrS7gml3SF4jKK061LaHYTHGEq7riptD8JjhCptu5R2h+ExgtKuq0rbw/B4vCptu5R2B+LxeEq7riptD8Tj0aq07VLaHYrHoyntuqq0PRSPx1LaPaG0OxiPx1LadSntDsfjkZR2XVXaHo7H41Rp26W0C8DjcZR2XVXaBuDxKFXadintQvB4FKVdV5W2IXg8RpW2XUq7IDweQ2nXVaVtEB6PoLR7QmkXhscjKO26lHaBeHyd0q6rSttAPL6qStsupV0oHl+ltOuq0jYUj6+p0rZLaReMx9co7bqqtA3G4yuqtO1S2oXj8RVKu64qbcPxuJ3S7gml3QV43KpK2y6l3SV43Epp11Wl7SV43KZK2y6l3UV43EZp11Wl7UV43KJK2y6l3WV43EJp11Wl7WV4XK5K2y6l3YV4XE5p11Wl7YV4XEpp94TS7lI8LlOlbZfS7mI8LqO066rS9mI8LqO061LaXY7HZT7T5gml3eV4XOYzbZ76m/5fgMeRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjceRjccR6+f3HzqUJkJd55AeAAAAAElFTkSuQmCC",name:G("平行度")},{typeName:ui.Perpendicularity,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAAB2CAYAAAAdp2cRAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAIOSURBVHhe7dAxbhwwEARB/f/TJ4c2VMroYBszQCXNjfj1Z59JYpz7GOc+xrmPce5jnPsY5z7GuY9x7mOc+xjnPsa5j3HuY5z7GOc+xrmPce5jnPsY5z7GuY9x7mPM+Xt6D2JM0XQXw5ii6S6GMUXTXQxjiqa7GMYUTXcxjCma7mIYUzTdxTCmaLqLYUzRdBfDmKLpLoYxRdNdDGOKprsYxhRNdzGMKZruYhhTNN3FMKZouothTNF0F8OYoukuhjFF010MY4qmuxjGFE13MYwpmu5iGFM03cUwpmi6i2FM0XQXw5ii6S6GMUXTXQxjiqa7GMYUTXcxjCma7mIYUzTdxTCmaLqLYUzRdBfDmKLpLoYxRdNdDGOKprsYxhRNdzGMKZruYhhTNN3FMKZouothTNF0F8OYoukuhjFF010MY4qmuxjGFE13MYwpmu5iGFM03cUwpmi6i2FM0XQXw5ii6S6GMUXTXQxjiqa7GMYUTXcxjCma7mIYUzTdxTCmaLqLYUzRdBfDmKLpLobxqe3n9E+PMT6zefqrxxif2X6f/ushxmc2T3/1GONT27/TH/0HjHMf49zHOPcxzn2Mcx/j3Mc49zHOfYxzH+Pcxzj3Mc59jHMf49zHOPcxzn2Mcx/j3Mc49zHOfYxzH+Pcxzj3Mc59jHMf49zHOPcxzn2Mcx/j3Mc49zHOfYxz2tfnG9KSrK0xvl/KAAAAAElFTkSuQmCC",name:G("垂直度")},{typeName:ui.TiltDegree,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGgAAABoCAYAAAAdHLWhAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAJFSURBVHhe7dRJbsQwEEPR3P/SSSfInM9KD5ZMqUjgbT5qJRh+uuw5rGEMHxjDB8bwgTF8YAwfGMMHxvCBMXxgDB8YwwfG8IExfGAM4XXUB8IYv/we3QyCMb5Ro9sBMMa7anQ/AMa4qEb3g2CMCzW6HQhje2p0OxjG1tTodgKMbanR7SQYW1Kj24kwtqNGt5NhbEWNbk+AsQ01uj0JxhbU6PZEGLenRrcnw7g1Nbo1gHFb1ejeAMYtVaN7Exi3U43ujWDcSjW6N4NxG9Xo3hDGLVSje1MYl1eN7o1hXFo1ujeHcVnV6H4BGJdUje4XgXE51eh+IRiXUo3uF4NxGdXofkEYl1CN7heFcQlqdLswjPbU6HZxGK2p0e0GMNpSo9tNYLSkRrcbwWhHjW43g9GKGt1uCKMNNbrdFEYLanS7MYynU6PbzWE8lRrdNoDxNNXovgGMp6hG901gnK4a3TeCcapqdN8Mxmmq0X1DGKeoRvdNYRyuGt03hnGoanTfHMZhqtF9cByiGt3HG4yHq0b38QnjoarRffyA8TDV6D7+wHiIanQfCOMh1Og2JIwPU6PbKGF8iBrdxr8w3k2NbuMqGO+iRrdxNYw3U6PbuAnGm6jRbdwM49XU6DbugvEqanQbd8P4LzW6jYdgLGVTP0SMUvY1ep8BMErZ1+h9BsBYyox/cR86j95jIIzhA2P4wBg+MIYPjOEDY/jAGD4whg+M4QNj+MAYPjCGD4zhA2P4wBg+MIYPjOEDY/jAGD4whg+MYeHp+QW0S7wDo2QXJQAAAABJRU5ErkJggg==",name:G("倾斜度")},{typeName:ui.PositionalDegree,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGwAAABsCAYAAACPZlfNAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAMaSURBVHhe7dDhSuVQDIXRef+XdkZEkLBOe6rXnGTIB+tP3G3l/vnX22iFx1EXj6MuHkddPI66eBx18Tjq4nHUxeOoi8dRF4+jLh5HXTyOungcdfE46uJx1MXjqIvHURePoy4eR108tvaZ/vYf4LGtmDbN8dhWTJvmeGwrpk1zPLYV06Y5HtuKadMcj23FtGmOx7Zi2jTHY1sxbZrjsa2YNs3x2FZMm+Z4bONpekczPJb2qvTuBngs6bfStwrjsZSs9O2CeCwjO/0PxfBYwk53z9z9XcVniuHxuLv0zLuYNu/u0jNF8HjUVdp/FdPmq6u0L4DHY67SPoppE12l/WE8HnGV9hLTZmWVtgfxeMQqbVdi2qys0vYgHtOt0vZKTJsrq7Q9hMd0Srs7MW3uKO0O4TGV0m5HTJsdSrsDeEyltNsR02aH0u4AHtMo7XbFtNmltEvGYxql3a6YNruUdsl4TKO02xXTZpfSLhmPaWLaPBHT5gmlXSIeUyjtnohp84TSLhGPKZR2T8S0eUJpl4jHH5k+0m/zAjz+yPSRfpsX4PFHpo/027wAjz8yfaTf5gV4TKG0eyKmzRNKu0Q8plDaPRHT5gmlXSIeUyjtnohp84TSLhGPaZR2u2La7FLaJeMxjdJuV0ybXUq7ZDymUdrtimmzS2mXjMdUSrsdMW12KO0O4DGV0m5HTJsdSrsDeEy1Sts7MW3urNL2AB7TrdL2SkybK6u0PYTHI5R2V2LaXFml7SE8HrFK25WYNiurtD2Ix2NWaSsxbWSVtofxeNRV2n8V0+arq7QvgMfjrtL+U0ybT1dpXwSPJdy188zOJqZnCuGxjN1W++++pzAeS8lK3y6Ix5J+K32rMB5Le1V6dwM8tvDd9K5GeGwrpk1zPLYV06Y5HtuKadMcj23FtGmOx7Zi2jTHY1sxbZrjsa2YNs3x2FZMm+Z4bCumTXM8thXTpjke24pp0xyPoy4eR108jrp4HHXxOOricdTF46iLx1EXj6MuHkddPI66eBx18Tjq4nHUxeOoi8dRF4+jLh5HXTyOungcJf15+wsBQMJfZ/0u7gAAAABJRU5ErkJggg==",name:G("位置度")},{typeName:ui.Coaxiality,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHYAAACDCAYAAABY+O+7AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAWxSURBVHhe7c7LDuQoEEXB/v+f7pklSkViFy9DiyPFJnVx1Z//+3v9k3i8zsfjdT4er/PxeJ2Px+t8PF7n4/E6H4/X+Xi8zsfjdT4er/PxeJ2Px+t8PP5TsrT9h/B4pBHpu4fi8Rgz0+8dhMftrU7/YXM8buvr9J82xeN2WtJ3pCV9ZzM8buVtetvibXq7ER638Da9HeFtersBHj/3lN7M8ia9+xiPn3pKb1Z4Sm8+xONnamn/hVraf4THT9TS/ku1tP8Aj8vV0n4HtbRfjMelsrTdTS3tF+JxmSxtd1VL+0V4XCJL293V0n4BHqfL0vYUWdouwON0Wdq2+DV9o0WWtpPxOFWWtr8Ylb79iyxtJ+Jxmixt35qVfuutLG0n4XEapd0bK9LvvpGl7SQ8TpGl7ZOWRrz9RZa2E/A4XJa2T96kdzVv0rsnSrsJeBxOaVfzJr37xVN6U5Ol7WA8DpWlbeYpvelRS/sapd1gPA6ltMvU0n6UWtrXKO0G4nEopV0mS9sZsrTNKO0G4nEYpV0mS9uZsrTNKO0G4XEYpZ1kabtClraitBuExyGUdpKl7UpKO1HaDcLjEEo7UdqtlqWtKO0G4HEIpV2Upe0XsrSNlHYD8NhNaSdKuy8p7URp14nHbkq7SGn3tSxtI6VdJx67Ke0ipd0OlHaR0q4Tj12UdpHSbhdZ2kYxbTrx2EVpFyntdqK0i5R2HXjsorQrZWm7E6VdpLTrwGOXmDaR0m5HSruS0q4Dj82UdpHSbkdKuyimTQcemyntSkq7XSntIqVdIx6bKe1KSrudKe1KSrtGPDZT2pWUdjtT2pWUdo14bKa0Kyntdqa0KyntGvHYLKZNFNNmd0q7ktKuEY/NYtqUlHYniGlTUto14rGJ0q6ktDtBTJsopk0jHpso7UpKuxMo7UoxbRrx2ERpV1LanUBpV4pp04jHJkq7ktLuBEq7UkybRjw2UdqVlHYnUNqVYto04rGJ0q6ktDuB0q6ktGvAYxOlXUlpdwKlXUlp14DHJkq7ktLuBEq7UkybRjw2UdqVlHYnUNqVYto04rGJ0q6ktDuB0q4U06YRj02UdiWl3QmUdqWYNo14bBbTpqS0O0FMmyimTSMem8W0iWLa7E5pV1LaNeKxWUybKKbN7pR2JaVdIx6bKe1KSrudKe1KSrtGPDZT2pWUdjtT2pWUdo14bKa0KyntdhbTJlLaNeKxmdIuUtrtSGkXxbTpwGOXmDaR0m5HSruS0q4Dj12UdiWl3Y6UdiWlXQceuyjtIqXdTpR2kdKuA49dlHaR0m4nSrtIadeBxy5KuyhL2x0o7SKlXSceuyntIqXdDpR2kdKuE4/dlHZRlrZfUtqJ0q4Tj92UdqK0+0qWtpHSbgAeh1DaRVnafkFpJ0q7AXgcQmknWdqulKWtKO0G4HGILG0lS9sVsrQVpd0gPA6jtJMsbWfL0jajtBuEx2GUdpksbWeppb1kaTsIj0Mp7TK1tB+plvYZpd1APA6ltKuppf0ItbTPZGk7EI/DKe1qntKbFk/pTY3SbjAeh8vStuYpvXnrTXpXk6XtYDxOobR78ja9lbfp7ROl3QQ8TpGl7ZOV6fffUNpNwuM0Wdq+MTv95htZ2k7C41RKu1+MTr/xC6XdRDxOlaXtr3rTN3+Vpe1EPE6XpW2Pp/SmR5a2k/G4RJa2J8jSdgEel6il/c6ytF2Ex2Vqab+jWtovwuNStbTfSS3tF+JxuVra76CW9ovx+Ila2n/lKb35AI+feUpvVnpKbz7C46ee0pvZ3qR3H+Lxc2/Su9HepHcb4HEbb9PbHm/T203wuJVf0vu3fk3f2AiPW9ol/bcN8bi1r9J/2RiPR1iVfvsAPB5ndPqNw/B4tNb0rYPxeJ2Px+t8PF7n4/E6H4/X+Xi8zsfjdT4er/PxeJ2Px+t8PF7n4/E6H4/X+Xi8jvbn73/ATYsgsquSGAAAAABJRU5ErkJggg==",name:G("同轴度")},{typeName:ui.SymmetryDegree,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGUAAABlCAYAAABUfC3PAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAFHSURBVHhe7dAhDsAwEMTA/v/TbVlADaKA+oBXGmKSU653d8bBGBfGuDDGhTEujHFhjAtjXBjjwhgXxrgwxoUxLoxxYYwLY1wY48Ko+XP0/hAYFdboFhlGhTW6RYZRYY1ukWFUGKM7BsAYF8a4MMaFMS6McWGMC2NcGOPCGBfGuDDGhTEujHFhjAtjXBjjwhgXxrgwxoUxLoxxYYwLY1wY48IYF8ZtbY3+5xDGLe07+qcDGLe07+ifDmDc1tbofw5hjAtjXBjjwhgXxrgwxoUxLoxxYYwLY1wY48IYF8a4MMaFMS6McWGMC2NcGOPCGBfGuDDGhTEujHFhVBijOwbAqLBGt8gwKqzRLTKMCmN0xwAY48IYF8a4MMaFMS6McWGMC2NcGOPCGBfGuDDGhTEujHFhjAtjXBjjwhgXxrgwxoUxLozRXPcDtK31g/W1X9AAAAAASUVORK5CYII=",name:G("对称度")},{typeName:ui.CircleJumping,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAABnCAYAAAAdQVz5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAKbSURBVHhe7cxLimMxEATAvv+le8YLgzAh+bUNrz5SQmyyUvr5n98jLZZHDiyPHFgeObA8cmB55MDyyIHlkQPLIweWRw4sjxxYHjmwPHJgeeTAcjtjdA/CciuKdgFYbmMWbQOw3MIq2gdg2d676E0Alq1did4FYNnW1ehtAJbt/DX6IwDLVj6J/gnAso1Po78CsGzhm+i/ACzL+zb6MwDL0lZ5d3/m9c8gLMta5d19zOu/QViWtMqVzZjx30Asy1lltVn1CbAsZZV3u1WfAMsyVnm3u3ILxrKEVa5sr9yCsUxvlavb1X18H4hlarNo+6D85R6IZVqzaPuk/OUeiGU6q2j/pHyyCcIylVW0HymfbIKwTGMV7UfKN7sALFNYRftXyje7ACzDraL9q1mubrULwDLcLNqKot2Dol0AluEU7WYU7R4U7QKwTGGM7jOKdk+KdgFYlqZo96RoF4BlWYp2I0W7ACzLUrQbKdoFYFnSLNq+GqN7EJYlKdoVwrKcWbQthGU5inbFsCxH0a4YlqUo2hXEshRFu4JYlqFoVxTLMhTtimJZwizaFsWyBEW7wliWoGhXGMv0FO2KY5meol1xLFNTtGuAZWqKdg2wTGsWbRtgmZaiXRMsU5pF2yZYpqRo1wjLlBTtGmGZjqJdMyzTUbRrhmUqinYNsUxF0a4hlmnMom1DLNNQtGuKZRqKdk2xTEHRrjGWKSjaNcYynKJdcyzDKdo1xzLULNo2xzKUot0GWIZStNsAyzCKdptgGUbRbhMsQyjabYRlCEW7jbC8naLdZljeTtFuMyxvNYu2m2F5K0W7DbG8laLdhlje6jXabIrl7cbovimWRw4sjxxYHjmwPHJgeeTA8siB5ZEDyyMHlkcOLI9wP7//ACh6RmsONhjLAAAAAElFTkSuQmCC",name:G("圆跳动")},{typeName:ui.FullBeat,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAABzCAYAAACrQz3mAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAQ7SURBVHhe7c9BjuQgEAXRvv+le6YWliz0wC6wE7JFSLH5GVhVP//53f4ZOW5zynGbU47bnHLc5pTjNqcctznluM0px21OOW5zynGbU47bnHLc5pTjNqcctznluM0px21OOW5zynGbU47bnHL8E5aomWGJmk45pleoi1ao65RjamuojbSG2k45prWF+ihbqO+UY0qv0JsIr9CbTjmm8w5697Z30LtOOabyLnr7pnfR2045pvEb9P4tv0HvO+WYwm/RN97wW/SNTjkubw/6ztP2oO90ynFpe9G3nnIEfa9Tjks6ir75hKPom51yXM4WV/eD8ptP2OLqflB+c0COS9niTnNw/uYTtri6nym/OyDHZWzRarQf/RO2aDXaj/4BOS5hi6tO+/nNiC2uOu3nN4NynG6Lq652O7/rtcVVV7ud3w3Kcaot7rS12/ldjy3utLXb+d2gHKfZ4k7bup9v39riTtu6n2+Dcpxii7t9636+fWOLu33rfr4NyjHcFt/0reZ8u2uLb/pWc74NyjHUFuo/iqumvF/ZQv1HcdWU9wE5htlC/aG4asp7yxbqP9a46sr7gBxDbKH+UNzp1Mgaas+KO52aTjm+bgv1Z8WdTk1pDbWl4k6nplOOr1pDbalQ97FEzWEL9aVC3ccSNZ1yfM0aaqVQ97FEzWENtVKo+1iiplOOrynUyRpqP5aoORTqpFB3WKKmU46vWaKmplB3WKLmsERNTaHusERNpxxf9UC3lkLdYYmaswe61ayh9rBETaccl1OoO1uiZlSh7myJmk45LqdQd7ZEzahC3dkSNZ1yXEqhrrREzYhCXWmJmk45LqVQJw90G1Wokwe6DchxGWuojVSoC5bjMgp10Qp1wXJcwhpqI62hNliOSyjURSvUTZDjEgp10Qp1E+Q4XaEuWqFukhynK9RFK9RNkuNUhbpohbqJcpyqUBetUDdRjtOsoTZSoW6yHKcp1EUr1E2W4zSFukhrqJ0sxykKddEKdQvIcYpCXbRC3QJyDFeoi1aoW0SO4Qp10Qp1i8gx1BpqIxXqFpJjqEJdtELdQnIMs4baSGuoXUiOYQp10Qp1i8kxTKEuWqFuMTmGKNRFK9QtKMcQhbpohboF5fi6Ql20Qt2icnxdoS5aoW5ROb5qDbWRCnULy/FVhbpohbqF5fiqQl2kNdQuLMfXFOqiFeoWl+NrCnXRCnWLy/EVhbpohboEcnxFoS5aoS6BHB+3htpIhbokcnxcoS5aoS6JHB9XqIu0htokcnxUoS5aoS6RHB9VqItWqEskx8cU6qIV6pLJ8TGFumiFumRyfEShLlqhLqEcHzET+v0J5ThsNvQfEspx2Ezo9yeV4yNmQb89qRwfc3X0mxPLcZtTjtucctzmlOM2pxy3OeW4zSnHbU45bnPKcZtTjtucctzmlOM2pxy3OeW4zSnHbU45btP58/sPTui//PWeJpwAAAAASUVORK5CYII=",name:G("全跳动")},{typeName:ui.None,img:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAANcAAADYCAYAAAB4K3ZgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAGdYAABnWARjRyu0AAAb9SURBVHhe7dLRbiM3EAXR/f+f3jhINlCIIkdSz7CbZBVwXjqX9krOr59+S3oEHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFCbbTRf/CoQ0Wjn3kwPOogT0S/50B41CKqRv/WA+FRDzoh+twHwqMa9ln0HR4Ij0ew+6LvV3w8wunRd6Jb4XF7q0afRWXh8Qgzot/7CYp2KgmPx6Bol4WinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4qgaKeS8KgiKNqpJDyqCIp2KgmPKoKinUrCo4poo43KwqMKoGinsvCoAijaqSw8qgCKdioLjyqAop3KwqMKaKONSsOjklG0U2l4VDKKdioNj0pG0U6l4VHJKNqpNDwqGUU7lYZHJWujjcrDoxJRtFN5eFQiinYqD49KRNFO5eFRiSjaqTw8KlEbbbQEPCoJRTstAY9KQtFOS8CjklC00xLwqCQU7bQEPCoJRTstAY9K0kYbLQOPSkDRTsvAoxJQtNvBn+i/bQSPSkDRbkVX0ZsN4FEJKNpVF4l+3sLwqARttKnoiej3LAiPmoyi3Z2qR//mxeBRkxlH39VC8Kgflhv9TRaDx7LsjOhvvyA8lmT1o7/bwfBYjn0XfZeaBo/l7NK7n412r9poo3R4LOmJ6PfMRtHuFUU7pcKjJqJo94qinVLhURO10aZF0U6p8KhJKNq1KNopFR41CUU70kYbpcKjJqFoRyjaKQ0eNUkbbXoo2ikNHjUBRbseinZKg0dNQNGuh6Kd0uBRE1C066FopzR41AQU7Xoo2ikNHjVBG21GKNopDR71MIp2IxTtlAaPehhFuxGKdkqDRz2Mot0IRTulwaMe1Iu2I220USo86kEU7a600Uap8KgHUbS70kYbpcKjHkLR7h1ttFEqPOohFO2uULRTKjzqIRTtrlC0Uyo86gEU7d5B0U6p8KgHULR7B0U7pcKjbkbR7l0U7ZQKj7oZRbt3UbRTKjzqZhTt3kXRTqnwqBtRtPsERTulwqNuRNHuExTtlAqPukkv2n6Cop1S4VE3oWj3KYp2SoVH3YSi3aco2ikVHnUDinbfoGinVHjUDSjafaONNkqHRwX1ou032mijdHhUEEW7b7XRRunwqIBetP1WG22UDo/6Ui/aRrTRRunwqC9RtItqo43S4VFf6EXbqDbaKB0e9aFetL1DG22UDo/6EEW7u7TRRunwqA/0ou1d2mijdHjUByja3amNNkqHR72pF23v1EYbpcOj3tCLtndro43S4VFvoGj3hDbaKB0edaEXbZ/QRhulw6MGetH2KW20UTo8aoCi3ZPaaKN0eFRHL9o+qY02SodHgV60fVobbZQOjwIU7WZoo43S4VGNXrSdoY02O1rss+JRL3rRdpY22uykjTYF4VEvKNrN1EabnVC0KwaP+lcv2s7URpudULQrBo/60Yu2s7XRZicU7YrB4/F60TZDG212QtGuGDwebRTtM1C02wVFu2LweKxRtM9C0W4XFO2KweORRtE+E0W7XfSibSF4PM4o2mejaLeLXrQtBI9HGUX7Cija7aIXbQvB4zFG0b4Kina76EXbQvB4hFG0r6aNNrvoRdtC8Li9UbSvqI02O6FoVwgetzaK9lVRtNtFL9oWgcdtjaJ9ZRTtdtGLtkXgcUujaF8dRbtd9KJtEXjcylX0ZgUU7XbRi7ZF4HEbV9GbVVC020Uv2haBxy1cRW9W00abXfSibRF4XNpV9GZVFO120Iu2ReBxWVfRm5VRtNvBKNoXgMclXUVvVkfRbgejaF8AHpdyFb3ZBUW7HYyifQF4XMZV9GYnFO12MIr2BeBxCVfRmx1RtFvdKNoXgMfyRtF+Z71ou7JRtC8Aj6WNov3uetF2ZaNoXwAeyxpF+1P0ou2qrqI3yfBYzlX05jS9aLuiq+hNMjyWMor2J+tF29VcRW+S4bGMUbTX9f+Ef0fvqruK3iTDYwmjaK9/RKKfN1Mk+nnJ8JhuFO31f6dF30EBeExzFb0ROyH63IXgMcVV9Ebv2TH6nMXgcbpRtFfcqtFnKQqPU42ivZ43K/rdG8HjFFfRG2kheJxiFO2lxeBxCop20qLwOEUbbaSF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiXF4VFSHB4lxeFRUhweJcXhUVIcHiWF/Pr9F7bAHIjtpL7/AAAAAElFTkSuQmCC",name:G("清除"),isChecked:!0}]),s=b.reactive({isShowFull:!1,topDim:"",downDim:""}),u=b.reactive([{toleranceCode:ui.None,tolerance:[],Benchmark:{b1:[[],[]],b2:[[],[]],b3:[[],[]]}}]),h=()=>{u.push({toleranceCode:ui.None,tolerance:[],Benchmark:{b1:[[],[]],b2:[[],[]],b3:[[],[]]}}),x.value+=1},o=()=>{u.splice(x.value-1,1),x.value===1?x.value=1:x.value-=1,k()},m=z=>{let O="item";return u[x.value-1].toleranceCode===z.typeName&&(O+=" checked"),O},y=(z,O)=>{const U=[];for(let H=0;H<z.length;H+=O)U.push(z.slice(H,H+O));return U},x=b.ref(1),M=(z,O,U,H)=>{const V=z*U+O;r.forEach(W=>{W.isChecked=!1}),r[V].isChecked=!0,u[x.value-1].toleranceCode=r[V].typeName,n.includes(u[x.value-1].toleranceCode)||(s.isShowFull=!1),k()};let A,T;b.onMounted(()=>{za.value=500;const{wipeout:z,midPt:O}=b1();A=O.clone(),Wo.value?(T=Wo.value.clone(),s.isShowFull=T.isShowFullWeekSymbol,s.downDim=T.dimNotesDown,s.topDim=T.dimNotesUp,u.length=0,u.push(...T.dimToleranceContents),u.forEach(H=>{Object.keys(H.Benchmark).forEach(W=>{var K,Z;((K=H.Benchmark[W])==null?void 0:K.length)===3&&((Z=H.Benchmark[W])==null||Z.splice(1,1))})})):T=new rp,T.setStartPoint(A);const U=new p.McGeVector3d(10,10,0);T.setTurningPoint(A.clone().addvec(U)),T.setEndPoint(A.clone().addvec(U).addvec(p.McGeVector3d.kXAxis.clone().mult(5))),k()});const P=()=>{u[x.value-1]={toleranceCode:ui.None,tolerance:[],Benchmark:{b1:[[],[]],b2:[[],[]],b3:[[],[]]}},s.downDim=s.topDim="",k()},D=b.ref(),k=()=>Gt(this,null,function*(){const z=u.filter(nt=>nt.toleranceCode!==ui.None);T.dimToleranceContents=JSON.parse(JSON.stringify(z)),T.isShowFullWeekSymbol=s.isShowFull,T.dimNotesDown=s.downDim,T.dimNotesUp=s.topDim;const O=p.MxCpp.getCurrentMxCAD(),U=O.drawEntity(T),{minPt:H,maxPt:V}=T.getBoundingBox(),W=V.sub(H).normalize().mult(2);H.addvec(W.clone().negate()),V.addvec(W);let K=new p.McGeLongArray;K.copyFormAryId([U]),p.MxCpp.App.MxCADAssist.MxExplode(K.imp);let Z=(V.x-H.x)*10,tt=120/300*Z;const at=yield Kd({type:"image/bmp",width:Z,height:tt,range_pt1:H.toVector3(),range_pt2:V.toVector3()});D.value.src=at,O.mxdraw.updateCanvasSize();let st=new p.MxCADSelectionSet;st.crossingSelect(H.x,H.y,V.x,V.y),st.forEach(nt=>{nt.erase()}),e("receiveParameters",{formData:Bh({dimToleranceContents:z},s)})});return(z,O)=>(b.openBlock(),b.createElementBlock("div",null,[b.createElementVNode("div",lF,[b.createElementVNode("div",cF,[b.createElementVNode("img",{alt:"",ref_key:"img",ref:D,style:{width:"100%",height:"100%"}},null,512)])]),b.createElementVNode("div",uF,[b.createElementVNode("div",hF,[b.createElementVNode("span",dF,b.toDisplayString(b.unref(G)("公差代号")),1),(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(y(r,5),(U,H)=>(b.openBlock(),b.createElementBlock("div",{class:"row",key:H},[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(U,(V,W)=>(b.openBlock(),b.createBlock(b.unref(on.VTooltip),{key:V.name,text:V.name},{activator:b.withCtx(({props:K})=>[b.createElementVNode("div",{class:b.normalizeClass(m(V)),onClick:Z=>M(H,W,5)},[b.createElementVNode("img",b.mergeProps({src:V.img,alt:""},K,{style:V.isDisable?"opacity: 0.3;":""}),null,16,fF)],10,pF)]),_:2},1032,["text"]))),128))]))),128))]),b.createElementVNode("div",mF,[b.createElementVNode("div",gF,[b.createElementVNode("span",yF,b.toDisplayString(b.unref(G)("公差1")),1),b.createVNode(b.unref(on.VCombobox),{style:{width:"15%"},items:["","S","R","φ","SR","CR","Sφ"],modelValue:u[x.value-1].tolerance[0],"onUpdate:modelValue":O[0]||(O[0]=U=>u[x.value-1].tolerance[0]=U),disabled:u[x.value-1].toleranceCode===b.unref(ui).None,onBlur:O[1]||(O[1]=U=>k())},null,8,["modelValue","disabled"]),b.createVNode(b.unref(on.VCombobox),{style:{width:"20%","margin-left":"10px"},"return-object":"",modelValue:u[x.value-1].tolerance[1],"onUpdate:modelValue":O[2]||(O[2]=U=>u[x.value-1].tolerance[1]=U),disabled:u[x.value-1].toleranceCode===b.unref(ui).None,onBlur:O[3]||(O[3]=U=>k())},null,8,["modelValue","disabled"]),b.createVNode(b.unref(on.VSelect),{style:{width:"15%","margin-left":"10px","font-size":"12px"},items:[{text:"",value:""},{text:"(+)",value:"+"},{text:"(-)",value:"-"},{text:"(◁)",value:"<"},{text:"(▷)",value:">"}],"item-title":"text","item-value":"value",modelValue:u[x.value-1].tolerance[2],"onUpdate:modelValue":[O[4]||(O[4]=U=>u[x.value-1].tolerance[2]=U),O[5]||(O[5]=U=>k())],disabled:u[x.value-1].toleranceCode===b.unref(ui).None},null,8,["modelValue","disabled"]),b.createVNode(b.unref(on.VSelect),{style:{width:"10%","margin-left":"10px"},"item-title":"text","item-value":"value",items:[{text:"",value:""},{text:"Ⓟ",value:"p"},{text:"Ⓜ",value:"m"},{text:"Ⓔ",value:"{"},{text:"Ⓛ",value:"l"},{text:"Ⓕ",value:"@"}],modelValue:u[x.value-1].tolerance[3],"onUpdate:modelValue":[O[6]||(O[6]=U=>u[x.value-1].tolerance[3]=U),O[7]||(O[7]=U=>k())],disabled:u[x.value-1].toleranceCode===b.unref(ui).None},null,8,["modelValue","disabled"]),b.createVNode(b.unref(on.VBtn),{style:{"margin-left":"10px","font-size":"12px",padding:"0px","min-width":"0px",height:"20px",width:"30px",display:"flex","align-items":"center","justify-content":"center"},class:b.normalizeClass(u[x.value-1].tolerance[4]?"checkBtn":""),disabled:u[x.value-1].toleranceCode===b.unref(ui).None||!["m","l"].includes(u[x.value-1].tolerance[3]),onClick:O[8]||(O[8]=()=>{u[x.value-1].tolerance[4]?u[x.value-1].tolerance[4]="":u[x.value-1].tolerance[4]="}",k()})},{default:b.withCtx(()=>[b.createTextVNode("Ⓡ")]),_:1},8,["class","disabled"])]),b.createElementVNode("div",xF,[b.createElementVNode("span",vF,b.toDisplayString(b.unref(G)("公差2")),1),b.createVNode(b.unref(on.VCombobox),{style:{width:"10%"},disabled:""}),b.createVNode(b.unref(on.VCombobox),{style:{width:"15%","margin-left":"10px"},disabled:""}),b.createVNode(b.unref(on.VSelect),{style:{width:"20%","margin-left":"10px","font-size":"12px"},disabled:""}),b.createVNode(b.unref(on.VSelect),{style:{width:"10%","margin-left":"10px"},disabled:""}),b.createVNode(b.unref(on.VBtn),{disabled:"",style:{"margin-left":"10px","font-size":"12px",padding:"0px","min-width":"0px",height:"20px",width:"30px",display:"flex","align-items":"center","justify-content":"center"}},{default:b.withCtx(()=>[b.createTextVNode("Ⓡ")]),_:1})])])]),b.createElementVNode("div",_F,[b.createElementVNode("div",bF,[b.createElementVNode("div",MF,[b.createElementVNode("span",wF,b.toDisplayString(b.unref(G)("附注")),1),b.createElementVNode("div",AF,[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("顶端")),1),b.createElementVNode("div",EF,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:s.topDim,"onUpdate:modelValue":O[9]||(O[9]=U=>s.topDim=U),disabled:u[x.value-1].toleranceCode===b.unref(ui).None,onBlur:O[10]||(O[10]=U=>k())},null,8,["modelValue","disabled"])])]),b.createElementVNode("div",TF,[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("底端")),1),b.createElementVNode("div",PF,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:s.downDim,"onUpdate:modelValue":O[11]||(O[11]=U=>s.downDim=U),disabled:u[x.value-1].toleranceCode===b.unref(ui).None,onBlur:O[12]||(O[12]=U=>k())},null,8,["modelValue","disabled"])])])]),b.createElementVNode("div",SF,[(b.openBlock(!0),b.createElementBlock(b.Fragment,null,b.renderList(Object.keys(u[x.value-1].Benchmark),(U,H)=>(b.openBlock(),b.createElementBlock("div",{class:"btnBox",style:{width:"32%",padding:"10px 5px 0px"},key:U},[b.createElementVNode("span",CF,b.toDisplayString(b.unref(G)("基准"))+b.toDisplayString(H+1),1),(b.openBlock(),b.createElementBlock(b.Fragment,null,b.renderList(2,V=>b.createElementVNode("div",{class:"fbc",key:V,style:{"margin-bottom":"5px"}},[b.createElementVNode("div",DF,[b.createVNode(b.unref(on.VTextField),{type:"text",modelValue:u[x.value-1].Benchmark[U][V-1][0],"onUpdate:modelValue":W=>u[x.value-1].Benchmark[U][V-1][0]=W,disabled:u[x.value-1].toleranceCode===b.unref(ui).None,onBlur:O[13]||(O[13]=W=>k())},null,8,["modelValue","onUpdate:modelValue","disabled"])]),b.createVNode(b.unref(on.VSelect),{style:{width:"40%","margin-left":"5px"},"item-title":"text","item-value":"value",items:[{text:"",value:""},{text:"Ⓜ",value:"m"},{text:"Ⓔ",value:"{"},{text:"Ⓛ",value:"l"}],modelValue:u[x.value-1].Benchmark[U][V-1][1],"onUpdate:modelValue":[W=>u[x.value-1].Benchmark[U][V-1][1]=W,O[14]||(O[14]=W=>k())],disabled:u[x.value-1].toleranceCode===b.unref(ui).None},null,8,["modelValue","onUpdate:modelValue","disabled"])])),64))]))),128))])]),b.createElementVNode("div",RF,[b.createVNode(b.unref(on.VCheckbox),{label:`${b.unref(G)("全周符号")}`,modelValue:s.isShowFull,"onUpdate:modelValue":O[15]||(O[15]=U=>s.isShowFull=U),disabled:!(u.length==1&&n.includes(u[x.value-1].toleranceCode)),onChange:O[16]||(O[16]=U=>k())},null,8,["label","modelValue","disabled"]),b.createElementVNode("div",LF,[b.createElementVNode("span",IF,b.toDisplayString(b.unref(G)("当前行")),1),b.createElementVNode("div",kF,[b.createElementVNode("div",BF,[b.createElementVNode("div",FF,[b.createElementVNode("span",null,b.toDisplayString(x.value),1),b.createElementVNode("div",zF,[b.createVNode(b.unref(on.VBtn),{style:{padding:"0px","min-width":"0px",height:"20px",width:"20px","margin-right":"5px"},disabled:u.length===1,onClick:O[17]||(O[17]=()=>x.value>1?x.value-=1:x.value=1)},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString("<"))]),_:1},8,["disabled"]),b.createVNode(b.unref(on.VBtn),{style:{padding:"0px","min-width":"0px",height:"20px",width:"20px"},disabled:u.length===1,onClick:O[18]||(O[18]=()=>x.value<u.length?x.value+=1:x.value=u.length)},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(">"))]),_:1},8,["disabled"])])]),b.createVNode(b.unref(on.VBtn),{style:{"margin-bottom":"10px"},disabled:u.length===3,onClick:h},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(b.unref(G)("增加行")),1)]),_:1},8,["disabled"]),b.createVNode(b.unref(on.VBtn),{disabled:u.length===1,onClick:o},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(b.unref(G)("删除行")),1)]),_:1},8,["disabled"])])])]),b.createElementVNode("div",NF,[b.createVNode(b.unref(on.VBtn),{onClick:P},{default:b.withCtx(()=>[b.createTextVNode(b.toDisplayString(b.unref(G)("清零")),1)]),_:1})])])])]))}}),qO="",VF=zo(UF,[["__scopeId","data-v-13e7c51f"],["__file","GemoetricToleranceDialog.vue"]]),GF={class:"contents"},OF={style:{"margin-bottom":"10px"}},jF={class:"tips"},HF={class:"tips"},WF={style:{display:"flex","justify-content":"space-around",width:"100%"}},qF=b.defineComponent({__name:"NumberTextDialog",emits:["receiveParameters"],setup(t,{emit:e}){const n=b.ref(""),r=b.ref(1),s=b.ref("start"),u=()=>{const h={textContent:n.value,textNumber:Number(r.value),numPos:s.value};e("receiveParameters",h)};return b.onMounted(()=>{za.value=350}),(h,o)=>(b.openBlock(),b.createElementBlock("div",GF,[b.createElementVNode("p",OF,b.toDisplayString(b.unref(G)("请输入文本内容和编号：")),1),b.createVNode(b.unref(on.VRow),null,{default:b.withCtx(()=>[b.createVNode(b.unref(on.VCol),{cols:"3"},{default:b.withCtx(()=>[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("文本内容：")),1)]),_:1}),b.createVNode(b.unref(on.VCol),{cols:"5"},{default:b.withCtx(()=>[b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"text",modelValue:n.value,"onUpdate:modelValue":[o[0]||(o[0]=m=>n.value=m),u]},null,8,["modelValue"])]),_:1}),b.createVNode(b.unref(on.VCol),{cols:"4"},{default:b.withCtx(()=>[b.createElementVNode("span",jF,b.toDisplayString(b.unref(G)("(输入0-20个字)")),1)]),_:1})]),_:1}),b.createVNode(b.unref(on.VRow),null,{default:b.withCtx(()=>[b.createVNode(b.unref(on.VCol),{cols:"3"},{default:b.withCtx(()=>[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("起始编号：")),1)]),_:1}),b.createVNode(b.unref(on.VCol),{cols:"4"},{default:b.withCtx(()=>[b.createVNode(b.unref(on.VTextField),{class:"mt-1",type:"number",modelValue:r.value,"onUpdate:modelValue":[o[1]||(o[1]=m=>r.value=m),u]},null,8,["modelValue"])]),_:1}),b.createVNode(b.unref(on.VCol),{cols:"5"},{default:b.withCtx(()=>[b.createElementVNode("span",HF,b.toDisplayString(b.unref(G)("(编号自动递增1)")),1)]),_:1})]),_:1}),b.createVNode(b.unref(on.VRow),{justify:"flex-start"},{default:b.withCtx(()=>[b.createVNode(b.unref(on.VCol),{cols:"3"},{default:b.withCtx(()=>[b.createElementVNode("span",null,b.toDisplayString(b.unref(G)("编号位置：")),1)]),_:1}),b.createVNode(b.unref(on.VCol),{cols:"6"},{default:b.withCtx(()=>[b.createVNode(b.unref(on.VRadioGroup),{modelValue:s.value,"onUpdate:modelValue":[o[2]||(o[2]=m=>s.value=m),u]},{default:b.withCtx(()=>[b.createElementVNode("div",WF,[b.createVNode(b.unref(on.VRadio),{label:b.unref(G)("编号在前"),value:"start"},null,8,["label"]),b.createVNode(b.unref(on.VRadio),{label:b.unref(G)("编号在后"),value:"end"},null,8,["label"])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}}),YO="",YF=zo(qF,[["__scopeId","data-v-7d640c71"],["__file","NumberTextDialog.vue"]]),XF=zo(b.defineComponent({__name:"dialog",setup(t){const{MxDialog:e}=MxPluginContext.components,n=[{name:G("取消"),fun:()=>{const y=p.MxCpp.getCurrentMxCAD();_o.cancel(o),r.value=!1,y.mxdraw.clearMxCurrentSelect(),y.updateDisplay()}},{name:G("确定"),primary:!0,fun:()=>{_o.confirm(o),r.value=!1}}],{isShow:r,onReveal:s}=_o,u=b.ref("弹框标题");s(y=>{y.title&&(u.value=y.title)});const h={RotateDialog:C5,RoundMarkDialog:k5,RoughnessDialog:eB,WeldSymbolDialog:cB,WeldingSymbolDialog:aF,GemoetricToleranceDialog:VF,NumberTextDialog:YF};let o;const m=y=>{o=y};return(y,x)=>(b.openBlock(),b.createBlock(b.unref(e),{title:u.value,modelValue:b.unref(r),"onUpdate:modelValue":x[0]||(x[0]=M=>b.isRef(r)?r.value=M:null),"max-width":b.unref(za),footerBtnList:n},{default:b.withCtx(()=>[(b.openBlock(),b.createBlock(b.resolveDynamicComponent(h[b.unref(Ho)]),{onReceiveParameters:m},null,32))]),_:1},8,["title","modelValue","max-width"]))}}),[["__file","dialog.vue"]]);function KF(){const t=document.createElement("div");document.body.appendChild(t);const e=b.createVNode(XF),n=MxPluginContext.getApp();e.appContext=n._context,b.render(e,t)}const Xw=(t,e)=>{var u;const n=new ta;n.setPos(new p.McGePoint3d(0,0,0)),n.rouDimHeight=(e!=null&&e.fontSize?e.fontSize:1)*t.textBaseHeight;const r=e.props;n.rougMarkType=r.selectSymbolNum,n.textLeftStr=r.textLeftStr,n.rougCornerType=r.rougCornerType==="无"?"":r.rougCornerType,n.isRoungSameRequire=r.isRoungSameRequire,n.isShowMostSymbols=r.isShowMostSymbols;const s=(u=r==null?void 0:r.textUpStr)==null?void 0:u.filter(h=>h!="");return n.textUpStr=JSON.parse(JSON.stringify(s)).reverse(),n.textDownStr=r.textDownStr.filter(h=>h!=""),n.isAddRougLongLine=r.isAddLongLine,n};class ZF extends p.MxCADBaseCustomText{constructor(){super(),this.type="MxCADTestRoughnessText"}calculate(e,n){const s=Xw(e,n).getBoundingBox(),u=s.maxPt.x-s.minPt.x,h=s.maxPt.y-s.minPt.y;return{width:u,height:h}}create(e,n,r,s){const u=Xw(e,n),h=u.getPos(),{minPt:o,maxPt:m}=u.getBoundingBox(),y=new p.McGePoint3d(o.x,m.y),x=h.sub(y),M=s.position.clone().addvec(x);return u.setPos(M),e.getMTextImp().entityType=="mtext"&&!e.getMTextImp().isEditState?[u]:[...u.getAllEntity()]}}function JF(){const t=MxPluginContext.registerEditorCustomTextPlugin(new ZF,{onDbClick:n=>{e(!0,n)},uiData:{icon:"icon-a-1",tip:"粗糙度",onClick:()=>{e(!1)}}}),e=(n=!1,r)=>{var s,u;if(Ho.value="RoughnessDialog",n){const h=new ta,o=r.props;h.rougMarkType=o.selectSymbolNum,h.textLeftStr=o.textLeftStr,h.rougCornerType=o.rougCornerType==="无"?"":o.rougCornerType,h.isRoungSameRequire=o.isRoungSameRequire,h.isShowMostSymbols=o.isShowMostSymbols,Wo.value=h;const m=(s=o==null?void 0:o.textUpStr)==null?void 0:s.filter(y=>y!="");h.textUpStr=(u=JSON.parse(JSON.stringify(m)))==null?void 0:u.reverse(),h.textDownStr=o.textDownStr.filter(y=>y!=""),h.isAddRougLongLine=o.isAddLongLine}_o.showDialog(!0,{title:nP("表面粗糙度")}).then(m=>Gt(this,[m],function*({data:h,isCanceled:o}){o||t(h.roughnessData,n)}))}}function QF(){JF()}class yg extends p.McDbCustomEntity{constructor(e){super(e),this._text="",this._textsize=20,this._radius=15}create(e){return new yg(e)}getTypeName(){return"McDbRectBoxLeadComment"}set text(e){this._text=e}get text(){return this._text}set textsize(e){this._textsize=e}get textsize(){return this._textsize}set radius(e){this._radius=e}get radius(){return this._radius}dwgInFields(e){return this.pt1=e.readPoint("pt1").val,this.pt2=e.readPoint("pt2").val,this.pt3=e.readPoint("pt3").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,this._text=e.readString("text").val,this._textsize=e.readDouble("textsize").val,!0}dwgOutFields(e){return e.writePoint("pt1",this.pt1),e.writePoint("pt2",this.pt2),e.writePoint("pt3",this.pt3),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),e.writeString("text",this._text),e.writeDouble("textsize",this._textsize),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.pt1.x+=n,this.pt1.y+=r,this.pt1.z+=s):e===1?(this.pt2.x+=n,this.pt2.y+=r,this.pt2.z+=s):e===2&&(this.pt3.x+=n,this.pt3.y+=r,this.pt3.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.pt1),e.append(this.pt2),e.append(this.pt3),e}worldDraw(e){const n=[],r=this._radius;if(this.pt1.x<this.pt2.x){const A=this.pt2.x-this.pt1.x,T=parseInt((A/(r*2)).toString());this.pt2.x=this.pt1.x+r*2*T}else{const A=this.pt1.x-this.pt2.x,T=parseInt((A/(r*2)).toString());this.pt1.x=this.pt2.x+r*2*T}if(this.pt1.y<this.pt2.y){const A=this.pt2.y-this.pt1.y,T=parseInt((A/(r*2)).toString());this.pt2.y=this.pt1.y+r*2*T}else{const A=this.pt1.y-this.pt2.y,T=parseInt((A/(r*2)).toString());this.pt1.y=this.pt2.y+r*2*T}const s=new p.McDbPolyline;s.isClosed=!0,s.addVertexAt(this.pt1),s.addVertexAt(new p.McGePoint3d(this.pt2.x,this.pt1.y)),s.addVertexAt(this.pt2),s.addVertexAt(new p.McGePoint3d(this.pt1.x,this.pt2.y));let h=s.getLength().val/r;const o=[];for(let A=1;A<=h;A++){const T=s.getPointAtDist(r*A).val;o.push(T)}o.forEach((A,T)=>{const P=new p.McDbCircle(A.x,A.y,A.z,r);if(T%2===0){const D=[];P.IntersectWith(s,p.McDb.Intersect.kOnBothOperands).forEach(k=>{D.push(k)}),P.splitCurves(D).forEach(k=>{const z=k.getPointAtDist(k.getLength().val/2).val;(z.x<Math.min(this.pt1.x,this.pt2.x)||z.x>Math.max(this.pt1.x,this.pt2.x))&&(e.drawEntity(k),n.push(k)),(z.y<Math.min(this.pt1.y,this.pt2.y)||z.y>Math.max(this.pt1.y,this.pt2.y))&&(e.drawEntity(k),n.push(k))})}});const m=[];for(let A=0;A<s.numVerts();A++){const T=s.getPointAt(A).val.distanceTo(this.pt3);m.push(T)}const y=m.indexOf(Math.min(...m)),x=s.getPointAt(y).val,M=new p.McDbPolyline;if(M.addVertexAt(x),M.addVertexAt(this.pt3),this._text){const A=new p.McDbText;A.textString=this._text,A.position=A.alignmentPoint=this.pt3,A.height=20,e.drawEntity(A),n.push(A);const{minPt:T,maxPt:P,ret:D}=A.getBoundingBox();if(!D)return;const k=P.x-T.x;M.addVertexAt(new p.McGePoint3d(this.pt3.x+k,this.pt3.y)),e.drawEntity(M),n.push(M)}else e.drawEntity(M),n.push(M);this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setPoint1(e){this.assertWrite(),this.pt1=e.clone()}setPoint2(e){this.assertWrite(),this.pt2=e.clone()}setPoint3(e){this.assertWrite(),this.pt3=e.clone()}getPoint1(){return this.pt1}getPoint2(){return this.pt2}getPoint3(){return this.pt3}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function $F(){return Gt(this,null,function*(){const t=new yg,e=new p.MxCADUiPrString;e.setMessage(G("请输入审批意见"));let n=yield e.go();n||(n="审批意见XXXX"),t.text=n;const r=new p.MxCADUiPrPoint;r.setMessage(G("指定云线框起始点"));const s=yield r.go();if(!s)return;const u=new p.MxCADUiPrPoint;u.setMessage(G("指定云线框终止点")),u.setUserDraw((y,x)=>{t.setPoint1(s),t.setPoint2(y),t.setPoint3(y),x.drawMcDbEntity(t)});const h=yield u.go();if(!h)return;t.setPoint2(h);const o=new p.MxCADUiPrPoint;o.setMessage(G("指定审图标注点")),o.setUserDraw((y,x)=>{t.setPoint3(y),x.drawMcDbEntity(t)});const m=yield o.go();m&&(t.setPoint3(m),p.MxCpp.getCurrentMxCAD().drawEntity(t))})}class xg extends p.McDbCustomEntity{constructor(e){super(e),this.pt1=new p.McGePoint3d,this.pt2=new p.McGePoint3d}create(e){return new xg(e)}getTypeName(){return"McDbTestRectangle"}dwgInFields(e){return this.pt1=e.readPoint("pt1").val,this.pt2=e.readPoint("pt2").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("pt1",this.pt1),e.writePoint("pt2",this.pt2),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e==0?(this.pt1.x+=n,this.pt1.y+=r,this.pt1.z+=s):e==1&&(this.pt2.x+=n,this.pt2.y+=r,this.pt2.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.pt1),e.append(this.pt2),e}worldDraw(e){const n=[],r=new p.McDbPolyline;r.isClosed=!0,r.addVertexAt(this.pt1),r.addVertexAt(new p.McGePoint3d(this.pt2.x,this.pt1.y)),r.addVertexAt(this.pt2),r.addVertexAt(new p.McGePoint3d(this.pt1.x,this.pt2.y)),e.drawEntity(r),n.push(r);let s=p.MxCpp.getCurrentMxCAD();const u=new p.McGePoint3d(this.pt2.x,this.pt1.y);s.addDimStyle("MyDimStyle","41,0.18,141,0.09,40,200","77,1,271,3","",""),s.drawDimStyle="MyDimStyle";const h=s.drawDimAligned(this.pt1.x,this.pt1.y+20,u.x,u.y+20,(this.pt1.x+u.x)/2,this.pt1.y+20);e.drawEntity(h.getMcDbEntity()),n.push(h.getMcDbEntity()),h.erase();const o=s.drawDimAligned(this.pt2.x+20,this.pt2.y,u.x+20,u.y,u.x+20,(this.pt2.y+u.y)/2);e.drawEntity(o.getMcDbEntity()),n.push(o.getMcDbEntity()),o.erase(),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setPoint1(e){this.assertWrite(),this.pt1=e.clone()}setPoint2(e){this.assertWrite(),this.pt2=e.clone()}getPoint1(){return this.pt1}getPoint2(){return this.pt2}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function tz(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();const e=new p.MxCADUiPrPoint;e.setMessage(G("指定第一个角点:"));let n=yield e.go();if(!n)return;const r=new xg;r.setPoint1(n),e.setMessage(G("指定第二个角点:")),e.setUserDraw((u,h)=>{r.setPoint2(u),h.drawMcDbEntity(r)});let s=yield e.go();s&&(r.setPoint2(s),t.drawEntity(r))})}class op extends p.McDbCustomEntity{constructor(e){super(e),this.center=new p.McGePoint3d,this._radius=1,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new op(e)}getTypeName(){return"MxDbTestDivide"}set radius(e){this._radius=e}get radius(){return this._radius}dwgInFields(e){return this.center=e.readPoint("center").val,this._radius=e.readDouble("radius").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("center",this.center),e.writeDouble("radius",this._radius),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.center.x+=n,this.center.y+=r,this.center.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.center),e}worldDraw(e){const n=[],r=new p.McDbCircle(this.center.x,this.center.y,this.center.z,this._radius);e.drawEntity(r);const{minPt:s,maxPt:u,ret:h}=r.getBoundingBox();if(!h)return;const o=new p.McDbLine(s,u),m=new p.McDbLine(new p.McGePoint3d(s.x,u.y,0),new p.McGePoint3d(u.x,s.y,0));e.drawEntity(o),e.drawEntity(m),n.push(r),n.push(o),n.push(m),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setCenter(e){this.assertWrite(),this.center=e.clone()}getCenter(){return this.center}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function ez(){return Gt(this,null,function*(){const t=new p.MxCADUiPrKeyWord;t.setMessage("选择要对齐水平标注或竖直标注："),t.setKeyWords("[水平(H)/竖直(V)]");const e=yield t.go();if(!e)return;const n=new p.MxCADSelectionSet;if(!(yield n.userSelect("选择对齐标注:"))||n.count()==0)return;const r=[];if(n.forEach(y=>{const x=y.getMcDbEntity();if(x.objectName==="McDbRotatedDimension"){const M=x.clone(),A=Math.abs(M.xLine1Point.x-M.xLine2Point.x).toFixed(0),T=Math.abs(M.xLine1Point.y-M.xLine2Point.y).toFixed(0),P=Math.abs(M.dimLinePoint.x-M.xLine1Point.x)+Math.abs(M.dimLinePoint.x-M.xLine2Point.x),D=Math.abs(M.dimLinePoint.y-M.xLine1Point.y)+Math.abs(M.dimLinePoint.y-M.xLine2Point.y);e==="H"&&P.toFixed(0)==A&&r.push(x),e==="V"&&D.toFixed(0)==T&&r.push(x)}}),r.length===0)return;const s=p.MxCpp.getCurrentMxCAD(),u=new p.MxCADUiPrPoint;u.setMessage("设置尺寸线位置");const h=yield u.go();if(!h)return;r.forEach(y=>{y.dimLinePoint=h}),s.updateDisplay();const o=new p.MxCADUiPrPoint;o.setMessage("设置尺寸线界限");const m=yield o.go();m&&(r.forEach(y=>{e==="H"?(y.xLine1Point=new p.McGePoint3d(y.xLine1Point.x,m.y),y.xLine2Point=new p.McGePoint3d(y.xLine2Point.x,m.y)):e==="V"&&(y.xLine1Point=new p.McGePoint3d(m.x,y.xLine1Point.y),y.xLine2Point=new p.McGePoint3d(m.x,y.xLine2Point.y))}),s.updateDisplay())})}class vg extends p.McDbCustomEntity{constructor(e){super(e),this.numPos=new p.McGePoint3d,this.labelPos=new p.McGePoint3d,this.labelSize=$.MxFun.screenCoordLong2Doc(5),this.numSize=$.MxFun.screenCoordLong2Doc(10),this.index="1",this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new vg(e)}getTypeName(){return"McDbTestIndex"}set symbolIndex(e){this.index=e}get symbolIndex(){return this.index}dwgInFields(e){return this.numPos=e.readPoint("numPos").val,this.labelPos=e.readPoint("labelPos").val,this.index=e.readString("index").val,this.labelSize=e.readDouble("labelSize").val,this.numSize=e.readDouble("numSize").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("labelPos",this.labelPos),e.writePoint("numPos",this.numPos),e.writeString("index",this.index),e.writeDouble("labelSize",this.labelSize),e.writeDouble("numSize",this.numSize),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.labelPos.x+=n,this.labelPos.y+=r,this.labelPos.z+=s):(this.numPos.x+=n,this.numPos.y+=r,this.numPos.z+=s,this.labelPos.x+=n,this.labelPos.y+=r,this.labelPos.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.labelPos),e.append(this.numPos),e}worldDraw(e){const n=[],r=new p.McDbHatch;r.appendCircleLoop(this.labelPos.x,this.labelPos.y,this.labelSize),e.drawEntity(r),n.push(r);const s=new p.McDbText;s.textString=this.index,s.height=this.numSize*(4/5),s.position=this.numPos.clone().subvec(p.McGeVector3d.kYAxis.clone().mult(this.numSize*(2/5))),s.alignmentPoint=s.position,s.horizontalMode=p.McDb.TextHorzMode.kTextMid,e.drawEntity(s),n.push(s);const u=new p.McDbCircle(this.numPos.x,this.numPos.y,this.numPos.z,this.numSize);e.drawEntity(u),n.push(u);const h=this.labelPos.sub(this.numPos).normalize().mult(this.numSize),o=this.numPos.addvec(h),m=new p.McDbLine(this.labelPos,o);e.drawEntity(m),n.push(m),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setLabelPos(e){this.labelPos=e.clone()}getLabelPos(){return this.labelPos}setNumPos(e){this.numPos=e.clone()}getNumPos(){return this.numPos}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function nz(){return Gt(this,null,function*(){let t=1;for(;;){const e=new p.MxCADUiPrPoint;e.setMessage(G("指定标注点:"));let n=yield e.go();if(!n)break;const r=new vg;r.setLabelPos(n);const s=new p.MxCADUiPrPoint;s.setMessage(G("指定序号位置:")),s.setUserDraw((o,m)=>{const y=r.clone();y.setNumPos(o),m.drawMcDbEntity(y)});let u=yield s.go();if(!u)break;r.setNumPos(u),r.symbolIndex=t.toString(),p.MxCpp.getCurrentMxCAD().drawEntity(r),t+=1}})}var sp=(t=>(t[t.right=0]="right",t[t.left=1]="left",t))(sp||{});class _g extends p.McDbCustomEntity{constructor(e){super(e),this.position=new p.McGePoint3d,this.rightText="",this.leftText="",this.bottomText="",this._textHeight=7,this.direct=0,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new _g(e)}getTypeName(){return"McDbTestRotationLabel"}set rightTextStr(e){this.rightText=e}get rightTextStr(){return this.rightText}set leftTextStr(e){this.leftText=e}get leftTextStr(){return this.leftText}set bottomTextStr(e){this.bottomText=e}get bottomTextStr(){return this.bottomText}set textHeight(e){this._textHeight=e}get textHeight(){return this._textHeight}set RotateDirect(e){this.direct=e}get RotateDirect(){return this.direct}dwgInFields(e){return this.position=e.readPoint("position").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,this.rightText=e.readString("rightText").val,this.leftText=e.readString("leftText").val,this.bottomText=e.readString("bottomText").val,this._textHeight=e.readDouble("textHeight").val,this.direct=e.readDouble("direct").val,!0}dwgOutFields(e){return e.writePoint("position",this.position),e.writePoint("maxPt",this.maxPt),e.writePoint("minPt",this.minPt),e.writeString("rightText",this.rightText),e.writeString("leftText",this.leftText),e.writeString("bottomText",this.bottomText),e.writeDouble("textHeight",this._textHeight),e.writeDouble("direct",this.direct),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.position.x+=n,this.position.y+=r,this.position.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e}getAllEntity(){const e=[],r=this.position.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(7)),s=this.position.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(7)),u=this.position.clone().addvec(p.McGeVector3d.kXAxis.clone().negate().mult(7)),h=this.direct===0?u.clone():r.clone(),o=r.clone().sub(this.position),m=this.direct===0?o.rotateBy(Math.PI/180*140):o.rotateBy(Math.PI/180*40),y=this.position.clone().addvec(m),x=h.sub(y).normalize().perpVector(),M=y.clone().addvec(x.clone().mult(.9)),A=y.clone().addvec(x.clone().negate().mult(.9)),T=new p.McDbHatch;T.appendLoop(new p.McGePoint3dArray([M,A,h])),e.push(T);const P=new p.McDbArc;return this.direct===0?P.computeArc(r.x,r.y,s.x,s.y,y.x,y.y):P.computeArc(y.x,y.y,s.x,s.y,u.x,u.y),e.push(P),e.push(...this.drawText()),e}worldDraw(e){this.getAllEntity().forEach(r=>{e.drawEntity(r)})}drawText(){const r=new p.McDbText;r.height=this._textHeight;const s=[];if(this.rightText){const u=r.clone();u.textString=this.rightText,u.horizontalMode=p.McDb.TextHorzMode.kTextLeft,u.position=u.alignmentPoint=this.position.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(10)),s.push(u)}if(this.leftText){const u=r.clone();u.textString=this.leftText,u.horizontalMode=p.McDb.TextHorzMode.kTextRight,u.position=u.alignmentPoint=this.position.clone().addvec(p.McGeVector3d.kXAxis.clone().negate().mult(10)),s.push(u)}if(this.bottomText){const u=r.clone();u.textString=this.bottomText,u.horizontalMode=p.McDb.TextHorzMode.kTextCenter,u.position=u.alignmentPoint=this.position.clone().addvec(p.McGeVector3d.kYAxis.clone().negate().mult(10));const h=this.position.clone().addvec(p.McGeVector3d.kXAxis.clone().negate().mult(7*2)),o=this.position.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(7*2)),m=new p.McDbLine(h,o);m.move(this.position,this.position.clone().addvec(p.McGeVector3d.kYAxis.clone().negate().mult(2))),s.push(m),s.push(u)}return s}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setRotatePos(e){this.position=e.clone()}getRotatePos(){return this.position}getBoundingBox(){const e=this.getAllEntity();return this.getBox(e),{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function iz(){return Gt(this,null,function*(){Ho.value="RotateDialog",_o.showDialog(!0,{title:G("旋转符号")}).then(n=>Gt(this,[n],function*({data:t,isCanceled:e}){const r=p.MxCpp.getCurrentMxCAD();if(e)t&&t.dimHandle&&r.database.handleToIdIndex(t.dimHandle).erase();else{const s=r.database.handleToIdIndex(t.dimHandle),h=s.getMcDbEntity().clone();s.erase();const o=new p.MxCADUiPrPoint;o.setMessage("请指定旋转标注位置"),o.setUserDraw((y,x)=>{const M=h.clone();M.setRotatePos(y),x.drawMcDbEntity(M)});const m=yield o.go();if(!m)return;h.visible=!0,h.setRotatePos(m),r.drawEntity(h)}}))})}class bg extends p.McDbCustomEntity{constructor(e){super(e),this.center=new p.McGePoint3d,this.radius=0,this.circlePoints=[],this.midPoints=[],this.circleMidPts=[],this.originPt=new p.McGePoint3d,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new bg(e)}getTypeName(){return"McDbTestRoundHoleMark"}dwgInFields(e){return this.center=e.readPoint("center").val,this.originPt=e.readPoint("originPt").val,this.circlePoints=e.readPoints("circlePoints").val,this.circleMidPts=e.readPoints("circleMidPts").val,this.midPoints=e.readPoints("midPoints").val,this.radius=e.readDouble("radius").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("center",this.center),e.writePoint("originPt",this.originPt),e.writePoints("circlePoints",this.circlePoints),e.writePoints("circleMidPts",this.circleMidPts),e.writePoints("midPoints",this.midPoints),e.writeDouble("radius",this.radius),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite();const u=()=>{this.originPt.x+=n,this.originPt.y+=r,this.originPt.z+=s,this.center.x+=n,this.center.y+=r,this.center.z+=s,[...this.circleMidPts,...this.circlePoints,...this.midPoints].forEach(y=>{y.x+=n,y.y+=r,y.z+=s})},h=()=>{this.circlePoints.forEach((m,y)=>{const x=this.center.clone().addvec(m.sub(this.center).mult(.5));this.midPoints[y]=x})},o=()=>{let m=0;for(let y=0;y<this.circlePoints.length;y+=2){const x=new p.McDbArc;x.computeArc(this.circlePoints[y].x,this.circlePoints[y].y,this.circleMidPts[m].x,this.circleMidPts[m].y,this.circlePoints[y+1].x,this.circlePoints[y+1].y);const M=x.getPointAtDist(x.getLength().val/2).val;this.circleMidPts[m]=M.clone(),m+=1}};if(e===0)u();else if(e===1)this.center.clone().distanceTo(this.originPt)<1e-4?u():(this.center.x+=n,this.center.y+=r,this.center.z+=s,h());else if(e<this.circlePoints.length+2){const m=e-2,y=this.circlePoints[m].clone();y.x+=n,y.y+=r,y.z+=s,this.circlePoints[m]=y,o();const x=this.center.clone().addvec(y.sub(this.center).mult(.5));this.midPoints[m]=x}else if(e<this.circlePoints.length+2+this.circleMidPts.length){const m=e-2-this.circlePoints.length,y=this.circleMidPts[m].clone();y.x+=n,y.y+=r,y.z+=s,this.circleMidPts[m]=y,o()}else{const m=e-2-this.circlePoints.length-this.circleMidPts.length;this.center.x+=n,this.center.y+=r,this.center.z+=s,this.midPoints[m].x+=n,this.midPoints[m].y+=r,this.midPoints[m].z+=s,this.circlePoints[m].x+=n,this.circlePoints[m].y+=r,this.circlePoints[m].z+=s,o(),h()}}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.originPt),e.append(this.center),this.circlePoints.forEach(n=>{e.append(n)}),this.circleMidPts.forEach(n=>{e.append(n)}),this.midPoints.forEach(n=>{e.append(n)}),e}worldDraw(e){const n=[];for(let r=0;r<this.circlePoints.length;r+=2){const s=(r+2)/2,u=p.MxCADUtility.calcBulge(this.circlePoints[r],this.circleMidPts[s-1],this.circlePoints[r+1]).val,h=new p.McDbHatch;h.appendLoop(new p.McGePoint3dArray([this.center,this.circlePoints[r],this.circlePoints[r+1]]),[0,u,0]),e.drawEntity(h),n.push(h)}this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setRoundData(e,n,r=1,s=1,u=Math.PI/2){this.center=this.originPt=e.clone(),this.radius=n;let h;switch(r){case 1:h=p.McGeVector3d.kXAxis.clone();break;case 2:h=p.McGeVector3d.kYAxis.clone();break;case 3:h=p.McGeVector3d.kXAxis.clone().negate();break;case 4:h=p.McGeVector3d.kYAxis.clone().negate();break;default:h=p.McGeVector3d.kXAxis.clone();break}u>0&&Math.PI/2-u>1e-4&&h.rotateBy(u/2,p.McGeVector3d.kZAxis);const o=this.center.clone().addvec(h.clone().mult(this.radius)),m=this.center.clone().addvec(h.clone().rotateBy(u/2).mult(this.radius)),y=this.center.clone().addvec(h.clone().rotateBy(u).mult(this.radius));this.circlePoints=[o,y],this.circleMidPts=[m];const x=this.center.clone().addvec(o.sub(this.center).mult(.5)),M=this.center.clone().addvec(y.sub(this.center).mult(.5));this.midPoints=[x,M];const A=T=>{const P=[],D=new p.McGeMatrix3d;return D.setToRotation(Math.PI,p.McGeVector3d.kZAxis,this.center),T.forEach(k=>{P.push(k.clone().transformBy(D))}),P};s>1&&(this.circlePoints.push(...A(this.circlePoints)),this.circleMidPts.push(...A(this.circleMidPts)),this.midPoints.push(...A(this.midPoints)))}getRoundData(){return{center:this.center,radius:this.radius}}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function rz(){return Gt(this,null,function*(){Ho.value="RoundMarkDialog",_o.showDialog(!0,{title:G("标记类型")}).then(n=>Gt(this,[n],function*({data:t,isCanceled:e}){const r=p.MxCpp.getCurrentMxCAD();if(!e){const s=new p.MxCADResbuf([p.DxfCode.kEntityType,"CIRCLE"]),u=new p.MxCADSelectionSet;if(!(yield u.userSelect(G("请选择需要标记的圆:"),s))||u.count()==0)return;u.forEach(h=>{const o=h.getMcDbEntity(),m=new bg;m.setRoundData(o.center,o.radius,...t.param),m.trueColor=new p.McCmColor(0,255,0),r.drawEntity(m)})}}))})}class ta extends p.McDbCustomEntity{constructor(e){super(e),this.position=new p.McGePoint3d,this.textDownString=["1.6"],this.textUpString=[],this.textLeftString="",this.CornerType="",this.markType=0,this.isSameRequire=!1,this.isAddLongLine=!1,this.isMostSymbols=!1,this.dimSize=5,this.rotation=0,this.dimHeight=10,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new ta(e)}getTypeName(){return"McDbTestRoughness"}set textDownStr(e){this.textDownString=e}get textDownStr(){return this.textDownString}set textUpStr(e){this.textUpString=e}get textUpStr(){return this.textUpString}set textLeftStr(e){this.textLeftString=e}get textLeftStr(){return this.textLeftString}set rougCornerType(e){this.CornerType=e}get rougCornerType(){return this.CornerType}set rougMarkType(e){this.markType=e}get rougMarkType(){return this.markType}set isRoungSameRequire(e){this.isSameRequire=e,e&&(this.isAddLongLine=!0)}get isRoungSameRequire(){return this.isSameRequire}set isAddRougLongLine(e){this.isAddLongLine=e}get isAddRougLongLine(){return this.isAddLongLine}set isShowMostSymbols(e){this.isMostSymbols=e}get isShowMostSymbols(){return this.isMostSymbols}set rouDimHeight(e){this.dimHeight=e}get rouDimHeight(){return this.dimHeight}dwgInFields(e){this.position=e.readPoint("position").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val;const n=e.readString("textDownStr").val;this.textDownString=n.split(",").filter(s=>s!="");const r=e.readString("textUpStr").val;return this.textUpString=r.split(",").filter(s=>s!=""),this.textLeftString=e.readString("textLeftStr").val,this.CornerType=e.readString("CornerType").val,this.markType=e.readLong("markType").val,this.dimSize=e.readDouble("dimSize").val,this.rotation=e.readDouble("rotation").val,this.dimHeight=e.readDouble("dimHeight").val,this.isSameRequire=e.readLong("isSameRequire").val==1,this.isAddLongLine=e.readLong("isAddLongLine").val==1,this.isMostSymbols=e.readLong("isMostSymbols").val==1,!0}dwgOutFields(e){e.writePoint("position",this.position),e.writePoint("maxPt",this.maxPt),e.writePoint("minPt",this.minPt);const n=this.textDownString.join(","),r=this.textUpString.join(",");return e.writeString("textDownStr",n),e.writeString("textUpStr",r),e.writeString("textLeftStr",this.textLeftString),e.writeString("CornerType",this.CornerType),e.writeLong("markType",this.markType),e.writeDouble("dimSize",this.dimSize),e.writeDouble("rotation",this.rotation),e.writeDouble("dimHeight",this.dimHeight),e.writeLong("isSameRequire",this.isSameRequire?1:0),e.writeLong("isAddLongLine",this.isAddLongLine?1:0),e.writeLong("isMostSymbols",this.isMostSymbols?1:0),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.position.x+=n,this.position.y+=r,this.position.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e}worldDraw(e){const n=this.getAllEntity();this.getBox(n),n.forEach(r=>{const s=r.clone();this.rotation&&s.rotate(this.position,this.rotation),e.drawEntity(s)})}getAllEntity(){p.MxCpp.getCurrentMxCAD();const e=this.drawShape(this.markType,this.position,this.dimSize,!0),n=e[0],r=n.getPointAt(n.numVerts()-1).val;if(this.textLeftString){const P=new p.McDbText;P.textString=this.textLeftString,P.height=this.dimSize*(9/10),P.alignmentPoint=P.position=this.position.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.dimSize*(1/10))).addvec(p.McGeVector3d.kXAxis.clone().negate().mult(this.dimSize)),P.horizontalMode=p.McDb.TextHorzMode.kTextRight,e.push(P)}if(this.CornerType){const P=new p.McDbText;P.textString=this.CornerType,P.height=this.dimSize*(7/10),P.alignmentPoint=P.position=this.position.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.dimSize*(3/10))).addvec(p.McGeVector3d.kXAxis.clone().mult(this.dimSize*(9/10))),P.horizontalMode=p.McDb.TextHorzMode.kTextLeft,e.push(P)}if(this.isSameRequire){const P=new p.McDbCircle;P.center=r.clone(),P.radius=this.dimSize*(3/10),e.push(P)}let s=r.x;const u=7/10*this.dimSize,h=r.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.dimSize*(1/2))).addvec(p.McGeVector3d.kYAxis.clone().mult(this.dimSize*(1/5)));let o=h.x,m=[];if(this.textUpString.length===1){const P=new p.McDbText;P.textString=this.textUpString[0],P.height=u,P.alignmentPoint=P.position=h,e.push(P);const{maxPt:D}=this.getTextBox(P);D.x>s&&(s=D.x),o=P.position.x}else if(this.textUpString.length===2){const P=new p.McDbText;P.textString=this.textUpString[0],P.height=u;const D=h.clone(),k=new p.McDbText;k.height=u,k.textString=this.textUpString[1];const z=r.sub(this.position).mult(2/3),O=D.clone().addvec(z),U=r.clone().addvec(z);P.alignmentPoint=P.position=new p.McGePoint3d(O.x,D.y),k.alignmentPoint=k.position=O,o=O.x;const H=this.getTextBox(P),V=this.getTextBox(k),W=H.maxPt.x>V.maxPt.x?H.maxPt.x:V.maxPt.x;s<W&&(s=W+u*.3);const K=new p.McGePoint3d(s,U.y),Z=new p.McDbLine(U.x,U.y,U.z,K.x,K.y,K.y),tt=new p.McDbLine(r.x,r.y,r.z,U.x,U.y,U.z);m.push(Z),e.push(k),e.push(P),e.push(tt)}if(this.textDownString.length){const P=new p.McGePoint3d(o,r.y);this.textDownString.forEach((D,k)=>{const z=new p.McDbText;z.textString=D,z.height=u;let O=new p.McGeVector3d;O=p.McGeVector3d.kYAxis.clone().negate().mult(u*(k+1+1/6)),z.alignmentPoint=z.position=P.clone().addvec(O),e.push(z);const U=this.getTextBox(z);s=s<U.maxPt.x?U.maxPt.x:s})}if(this.isAddLongLine){const P=r.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.dimSize*2)),D=new p.McDbLine(r.x,r.y,r.z,P.x,P.y,P.y);s<P.x&&(s=P.x,e.push(D))}const y=new p.McGePoint3d(s,r.y),x=new p.McDbLine(r.x,r.y,r.z,y.x,y.y,y.y);e.push(x),m.length&&m.forEach(P=>{P.endPoint.x=s,e.push(P)});const M=P=>{const D=new p.McDbArc;D.computeArc(P[0].x,P[0].y,P[1].x,P[1].y,P[2].x,P[2].y),e.push(D)};if(this.isMostSymbols){const P=this.position.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.dimSize)),D=new p.McGePoint3d(s,P.y),k=this.dimSize*(7/5),z=D.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.dimSize*(7/5))),O=p.McGeVector3d.kXAxis.clone().mult(k),U=z.clone().addvec(O.clone().rotateBy(40*(Math.PI/180))),H=z.clone().addvec(O.clone()),V=z.clone().addvec(O.clone().rotateBy(320*(Math.PI/180)));M([U,H,V]);const W=D.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.dimSize*(12/5))),K=W.clone().addvec(O.clone().rotateBy(140*(Math.PI/180))),Z=W.clone().addvec(O.clone().negate()),tt=W.clone().addvec(O.clone().rotateBy(220*(Math.PI/180)));M([K,Z,tt]);const at=z.clone().addvec(W.sub(z).mult(1/3)).addvec(p.McGeVector3d.kYAxis.clone().negate().mult(this.dimSize*(4/5)));this.drawShape(2,at,this.dimSize*(4/5),!1).forEach(st=>{e.push(st)})}this.getBox(e);const A=new p.McGeMatrix3d,T=this.maxPt.y-this.minPt.y;if(this.dimHeight){const P=this.dimHeight/T;A.setToScaling(P,this.position)}else A.setToScaling(1,this.position);return e.forEach(P=>{P.transformBy(A)}),e}getTextBox(e){const n=new p.McDbMText;switch(n.contents=e.textString,n.textHeight=e.height,n.location=e.position,e.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:n.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:n.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:n.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:n.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:n.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const r=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();return n.textStyleId=r,n.reCompute(),p.MxCADUtility.getTextEntityBox(n,!1)}getBox(e){let n,r=null,s;e.forEach(u=>{u instanceof p.McDbText?s=this.getTextBox(u):u instanceof p.McDbMText?(u.reCompute(),s=p.MxCADUtility.getTextEntityBox(u,!1)):s=u.getBoundingBox();const{minPt:h,maxPt:o,ret:m}=s;n||(n=h.clone()),r||(r=o.clone()),h.x<n.x&&(n.x=h.x),h.y<n.y&&(n.y=h.y),o.x>r.x&&(r.x=o.x),o.y>r.y&&(r.y=o.y)}),n&&r&&(this.maxPt=r,this.minPt=n)}drawShape(e,n,r,s){const u=[],h=p.McGeVector3d.kYAxis.clone().mult(r),o=p.McGeVector3d.kXAxis.clone().mult(r*(3/5)),m=n.clone().addvec(h),y=m.clone().addvec(o),x=m.clone().addvec(o.clone().negate());let M=r*(2/5);this.textDownStr.length>2&&s&&(M=r*(1/2));const A=n.clone().addvec(y.sub(n).mult(M));if(e===0){const T=new p.McDbPolyline;T.addVertexAt(y),T.addVertexAt(x),T.addVertexAt(n),T.addVertexAt(A),u.push(T)}else{const T=new p.McDbPolyline;T.addVertexAt(x),T.addVertexAt(n),T.addVertexAt(A),u.push(T)}if(e===1){const T=n.distanceTo(y),P=n.distanceTo(x),D=y.distanceTo(x),k=(T+P+D)/2,z=n.distanceTo(m),O=D*z/2,U=new p.McDbCircle;U.radius=O/k,U.center=m.clone().addvec(p.McGeVector3d.kYAxis.clone().negate().mult(U.radius)),u.push(U)}return u}setPos(e){this.position=e.clone()}getPos(){return this.position}setRotation(e){this.rotation=e}getRotation(){return this.rotation}getBoundingBox(){const e=this.getAllEntity();return this.getBox(e),{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function oz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD();let e=0;const n=new ta;n.rougMarkType=0,n.rougCornerType="";const r=new p.MxCADUiPrPoint;r.setMessage(G("请设置定位点或直线或圆弧或圆")),r.setUserDraw((o,m)=>{n.setPos(o),m.drawMcDbEntity(n)});const s=yield r.go();let u=new p.MxCADResbuf([p.DxfCode.kEntityType,"LINE,ARC,CIRCLE,LWPOLYLINE"]),h=p.MxCADUtility.findEntAtPoint(s.x,s.y,s.z,-1,u);if(h.isValid()){const o=h.getMcDbEntity(),m=new p.MxCADUiPrPoint;if(m.setMessage(G("拖动确定标注位置")),m.setUserDraw((x,M)=>{const T=o.clone().getClosestPointTo(x,!0).val;e=x.sub(T).angleTo2(p.McGeVector3d.kYAxis,p.McGeVector3d.kNegateZAxis),n.setPos(T),n.setRotation(e),M.drawMcDbEntity(n)}),m.setDisableDynInput(!0),m.disableAllTrace(!0),!(yield m.go()))return;t.drawEntity(n)}else{n.setPos(s);const o=new p.MxCADUiPrAngle;if(o.setBasePt(s),o.setMessage(G("请指定或输入角度")),o.setUserDraw((x,M)=>{const A=new p.McDbLine(x,s);M.drawMcDbEntity(A),e=x.sub(s).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis),n.setRotation(e),M.drawMcDbEntity(n)}),!(yield o.go()))return;const y=o.value();n.setRotation(y),t.drawEntity(n)}})}class Mg extends p.McDbCustomEntity{constructor(e){super(e),this.symbolType=0,this.width=10,this.startPt=new p.McGePoint3d,this.endPt=new p.McGePoint3d,this.midPt=new p.McGePoint3d,this.directPt=new p.McGePoint3d,this.isArc=0,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Mg(e)}get weldWidth(){return this.width}set weldWidth(e){this.width=e}get weldSymbolType(){return this.symbolType}set weldSymbolType(e){this.symbolType=e}set startPoint(e){this.startPt=e.clone()}set endPoint(e){this.endPt=e.clone()}set directPoint(e){this.directPt=e.clone()}set entityHandle(e){this.entHandle=e;const s=p.MxCpp.getCurrentMxCAD().database.handleToIdIndex(this.entHandle).getMcDbCurve();this.startPt=s.getStartPoint().val,this.endPt=s.getEndPoint().val,s instanceof p.McDbArc&&(this.isArc=1,this.midPt=s.getPointAtDist(s.getLength().val/2).val)}getTypeName(){return"McDbTestWeldSymbolBefore"}dwgInFields(e){return this.startPt=e.readPoint("startPt").val,this.endPt=e.readPoint("endPt").val,this.midPt=e.readPoint("midPt").val,this.directPt=e.readPoint("directPt").val,this.symbolType=e.readLong("symbolType").val,this.entHandle=e.readString("entHandle").val,this.isArc=e.readLong("isArc").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("startPt",this.startPt),e.writePoint("endPt",this.endPt),e.writePoint("midPt",this.midPt),e.writePoint("directPt",this.directPt),e.writeLong("symbolType",this.symbolType),e.writeLong("isArc",this.isArc),e.writeString("entHandle",this.entHandle),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.startPt.x+=n,this.startPt.y+=r,this.startPt.z+=s,this.endPt.x+=n,this.endPt.y+=r,this.endPt.z+=s,this.isArc&&(this.midPt.x+=n,this.midPt.y+=r,this.midPt.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.startPt),e}worldDraw(e){const n=[],s=.626*this.width;let u;this.isArc?(u=new p.McDbArc,u.computeArc(this.startPt.x,this.startPt.y,this.midPt.x,this.midPt.y,this.endPt.x,this.endPt.y)):u=new p.McDbLine(this.startPt,this.endPt);const h=51.5*Math.PI/180;if(this.symbolType===0||this.symbolType===1){const o=u.getLength().val,m=Math.ceil(o/this.width),y=o/m;for(let x=0;x<=m;x++){const M=u.getPointAtDist(x*y).val,A=u.getFirstDeriv(M).val.normalize().mult(s),T=A.angleTo2(p.McGeVector3d.kXAxis),P=new p.McDbArc;if(P.center=M.clone().subvec(A),P.startAngle=T-h,P.endAngle=T+h,P.radius=s,this.symbolType===1){const D=P.getStartPoint().val,k=P.getEndPoint().val;if(u instanceof p.McDbLine){const z=D.distanceTo(this.directPt),O=k.distanceTo(this.directPt);z<O?P.move(k,M):P.move(D,M)}else if(u instanceof p.McDbArc){const z=u.center.distanceTo(this.directPt),O=D.distanceTo(u.center),U=k.distanceTo(u.center);z<u.radius?(O<=u.radius&&P.move(k,M),U<=u.radius&&P.move(D,M)):(O>=u.radius&&P.move(k,M),U>=u.radius&&P.move(D,M))}}e.drawEntity(P),n.push(P)}}this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}class wg extends p.McDbCustomEntity{constructor(e){super(e),this.originPt=new p.McGePoint3d,this.symbolType=0,this.width=10,this.angle=0,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new wg(e)}getTypeName(){return"McDbTestWeldSymbolSide"}get weldSymbolType(){return this.symbolType}set weldSymbolType(e){this.symbolType=e}get weldWidth(){return this.width}set weldWidth(e){this.width=e}get weldAngle(){return this.angle}set weldAngle(e){this.angle=e}dwgInFields(e){return this.originPt=e.readPoint("originPt").val,this.symbolType=e.readLong("symbolType").val,this.angle=e.readDouble("angle").val,this.width=e.readDouble("width").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("originPt",this.originPt),e.writeLong("symbolType",this.symbolType),e.writeDouble("angle",this.angle),e.writeDouble("width",this.width),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.originPt.x+=n,this.originPt.y+=r,this.originPt.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.originPt),e}worldDraw(e){const n=[];if(this.symbolType===2){const r=this.originPt.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.width/2)),s=this.originPt.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.width/2).negate()),u=this.originPt.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.width)),h=new p.McDbHatch;h.appendLoop(new p.McGePoint3dArray([r,s,u])),this.angle&&h.rotate(this.originPt,this.angle),e.drawEntity(h),n.push(h)}else if(this.symbolType===3){const r=this.originPt.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.width)),s=this.originPt.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.width)),u=new p.McDbHatch;u.appendLoop(new p.McGePoint3dArray([r,s,this.originPt])),this.angle&&u.rotate(this.originPt,this.angle),e.drawEntity(u),n.push(u)}this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setOriginPt(e){this.originPt=e.clone()}getOriginPt(){return this.originPt}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function sz(){return Gt(this,null,function*(){Ho.value="WeldSymbolDialog",_o.showDialog(!0,{title:G("焊缝符号")}).then(n=>Gt(this,[n],function*({data:t,isCanceled:e}){if(p.MxCpp.getCurrentMxCAD(),!e&&t){const r=t.symbolType;for(;;)if(r==0||r==1){const s=new p.MxCADUiPrPoint;s.setMessage(G("请拾取定位点、直线或圆弧"));const u=yield s.go();if(!u)break;let h=new p.MxCADResbuf([p.DxfCode.kEntityType,"LINE,ARC,CIRCLE"]),o=p.MxCADUtility.findEntAtPoint(u.x,u.y,u.z,-1,h);const m=new Mg;if(m.weldSymbolType=r,m.weldWidth=t.width?t.width:10,o.isValid()){const T=o.getMcDbEntity().getHandle();m.entityHandle=T}else{const A=new p.MxCADUiPrPoint;A.setMessage(`${G("请指定第二点")}`),A.setUserDraw((P,D)=>{const k=new p.McDbLine(u,P);D.drawMcDbEntity(k)});const T=yield A.go();if(!T)break;m.startPoint=u,m.endPoint=T}const y=new p.MxCADUiPrPoint;y.setDisableDynInput(!0),y.setMessage("左键确定，右键结束当前命令"),y.setUserDraw((A,T)=>{m.directPoint=A,T.setColor("#00FF00"),T.drawMcDbEntity(m)});const x=yield y.go();if(!x)break;m.directPoint=x,m.trueColor=new p.McCmColor(255,255,0),p.MxCpp.getCurrentMxCAD().drawEntity(m)}else if(r==2||r==3){const s=new wg;s.weldSymbolType=r;const u=new p.MxCADUiPrPoint;u.setMessage(`${G("请设置定位点")}`),u.setUserDraw((x,M)=>{s.setOriginPt(x),M.drawMcDbEntity(s)});const h=yield u.go();if(!h)break;const o=new p.MxCADUiPrAngle;o.setMessage(`${G("请设置角度")}`),o.setBasePt(h),o.setUserDraw((x,M)=>{const T=x.sub(h).angleTo2(p.McGeVector3d.kXAxis);s.weldAngle=T,M.drawMcDbEntity(s)});let m=yield o.go();if(!m&&m!=0)break;const y=o.value();s.weldAngle=y,s.weldWidth=t.width?t.width:10,p.MxCpp.getCurrentMxCAD().drawEntity(s)}else break}}))})}class Ag extends p.McDbCustomEntity{constructor(e){super(e),this.startPt=new p.McGePoint3d,this.endPt=new p.McGePoint3d,this.size=4,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Ag(e)}getTypeName(){return"McDbTestDirectionaSymbol"}set startPoint(e){this.startPt=e.clone()}get startPoint(){return this.startPt}set endPoint(e){this.endPt=e.clone()}get endPoint(){return this.endPt}set dimSize(e){this.size=e}get dimSize(){return this.size}dwgInFields(e){return this.startPt=e.readPoint("startPt").val,this.endPt=e.readPoint("endPt").val,this.size=e.readDouble("size").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("startPt",this.startPt),e.writePoint("endPt",this.endPt),e.writeDouble("size",this.size),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.startPt.x+=n,this.startPt.y+=r,this.startPt.z+=s,this.endPt.x+=n,this.endPt.y+=r,this.endPt.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.startPt),e}worldDraw(e){const n=[],r=this.endPt.sub(this.startPt).normalize(),s=this.startPt.clone().addvec(r.clone().mult(3*this.size)),u=this.startPt.clone().addvec(r.clone().mult(this.size)),h=new p.McDbLine(this.startPt,s);e.drawEntity(h),n.push(h);const o=u.clone().addvec(r.clone().perpVector().mult(this.size*(1/8))),m=u.clone().addvec(r.clone().perpVector().mult(this.size*(1/8)).negate()),y=new p.McDbHatch;y.appendLoop(new p.McGePoint3dArray([o,m,this.startPt])),e.drawEntity(y),n.push(y),this.getBox(n)}getBox(e){let n,r=null;e.forEach(s=>{const{minPt:u,maxPt:h,ret:o}=s.getBoundingBox();n||(n=u.clone()),r||(r=h.clone()),u.x<n.x&&(n.x=u.x),u.y<n.y&&(n.y=u.y),h.x>r.x&&(r.x=h.x),h.y>r.y&&(r.y=h.y)}),n&&r&&(this.maxPt=r,this.minPt=n)}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function az(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage("请确定向视符号的起点位置");const n=yield e.go();if(!n)return;const r=new Ag;r.startPoint=n;const s=new p.MxCADUiPrPoint;s.setMessage("请确定向视符号固定长度的终点位置"),s.setUserDraw((h,o)=>{r.endPoint=h,o.drawMcDbEntity(r)});const u=yield s.go();if(u){r.endPoint=u,t.drawEntity(r);for(let h=0;h<2;h++){const o=new p.MxCADMText;o.data=[{type:"paragraph",children:[{text:"A",fontSize:.2}]}];const m=new p.MxCADUiPrPoint;h==0?m.setMessage("请确定文本位置"):h==1&&m.setMessage("请确定向视图标识的位置");const y=yield m.go();o.position=y,t.drawEntity(o)}}})}var ii=(t=>(t[t.top=1]="top",t[t.down=2]="down",t))(ii||{}),Ge=(t=>(t[t.WithPadSymbol=0]="WithPadSymbol",t[t.SurroundingWeldSeamSymbol=1]="SurroundingWeldSeamSymbol",t[t.OnSiteSymbol=2]="OnSiteSymbol",t[t.ThreeSidedWeldSeamSymbol=3]="ThreeSidedWeldSeamSymbol",t[t.TailSymbol=4]="TailSymbol",t[t.ZSymbol=5]="ZSymbol",t[t.RolledEdge=6]="RolledEdge",t[t.IWeldSeam=7]="IWeldSeam",t[t.VWeldSeam=8]="VWeldSeam",t[t.SingleVWeldSeam=9]="SingleVWeldSeam",t[t.SingleSteepVWeldSeam=10]="SingleSteepVWeldSeam",t[t.InclinedWeldSeam=11]="InclinedWeldSeam",t[t.RemovablePadding1=12]="RemovablePadding1",t[t.RemovablePadding2=13]="RemovablePadding2",t[t.DurableLiner=14]="DurableLiner",t[t.VFlangedEdgeSeam=15]="VFlangedEdgeSeam",t[t.UFlangedEdgeSeam=16]="UFlangedEdgeSeam",t[t.SingleVFlangedEdgeSeam=17]="SingleVFlangedEdgeSeam",t[t.SingleUFlangedEdgeSeam=18]="SingleUFlangedEdgeSeam",t[t.EndWeldSeam=19]="EndWeldSeam",t[t.SurfacingJoint=20]="SurfacingJoint",t[t.BottomSeamWeld=21]="BottomSeamWeld",t[t.FilletWeld=22]="FilletWeld",t[t.GrooveWeldSeam=23]="GrooveWeldSeam",t[t.SpotWeldSeam=24]="SpotWeldSeam",t[t.FoldingInterface=25]="FoldingInterface",t[t.InclinedInterface=26]="InclinedInterface",t[t.SpotWeldSeamOffset=27]="SpotWeldSeamOffset",t[t.SeamWeld=28]="SeamWeld",t[t.SeamWeldOffset=29]="SeamWeldOffset",t[t.SteepVWeldSeam=30]="SteepVWeldSeam",t[t.BellShapedWeldSeam=31]="BellShapedWeldSeam",t[t.SingleBellShapedWeldSeam=32]="SingleBellShapedWeldSeam",t[t.HeapWeldSeam=33]="HeapWeldSeam",t[t.SeamSeam=34]="SeamSeam",t[t.LockTheSlopeOpening=35]="LockTheSlopeOpening",t[t.FirstPlaneSymbol=36]="FirstPlaneSymbol",t[t.SecondConcaveSymbol=37]="SecondConcaveSymbol",t[t.SecondConvexeSymbol=38]="SecondConvexeSymbol",t[t.SecondPlaneSymbol=39]="SecondPlaneSymbol",t[t.ThirdPlaneSymbol=40]="ThirdPlaneSymbol",t[t.FirstConvexeSymbol=41]="FirstConvexeSymbol",t[t.FirstConcaveSymbol=42]="FirstConcaveSymbol",t[t.FlattenWeldSeam=43]="FlattenWeldSeam",t[t.ToeAareaTranSmoothly=44]="ToeAareaTranSmoothly",t[t.none=45]="none",t))(Ge||{});class ap extends p.McDbCustomEntity{constructor(e){super(e),this.size=4,this.baseSymbok=[],this.auxiliarySymbol=[],this.specialSymbol=[],this.suppleSymbol=[],this.leftDim=[],this.topDim=[],this.rightDim=[],this.dottedPos=0,this.height=this.size*(7/8),this.weldingInfo="",this.interlacedWeldSeam=[],this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new ap(e)}getTypeName(){return"McDbTestWeldingSymbol"}set weldingPosition(e){this.position=this.fixedPoint=this.turningPoint=e.clone()}get weldingPosition(){return this.position}set turningPoint(e){this.turningPt=this.fixedPoint=e.clone()}get turningPoint(){return this.turningPt}set fixedPos(e){this.fixedPoint=e.clone()}get fixedPos(){return this.fixedPoint}set dimSize(e){this.size=e,this.height=this.size*(7/8)}get dimSize(){return this.size}set dottedLinePos(e){this.dottedPos=e}get dottedLinePos(){return this.dottedPos}set weldingSymbolInfo(e){this.weldingInfo=e}get weldingSymbolInfo(){return this.weldingInfo}dwgInFields(e){this.position=e.readPoint("position").val,this.turningPt=e.readPoint("turningPt").val,this.fixedPoint=e.readPoint("fixedPoint").val,this.size=e.readDouble("size").val,this.dottedPos=e.readLong("dottedPos").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val;const n=e.readString("baseSymbok").val;this.baseSymbok=JSON.parse(n);const r=e.readString("AuxiliarySymbol").val;this.auxiliarySymbol=JSON.parse(r);const s=e.readString("specialSymbol").val;this.specialSymbol=JSON.parse(s);const u=e.readString("suppleSymbol").val;this.suppleSymbol=JSON.parse(u);const h=e.readString("leftDim").val;this.leftDim=JSON.parse(h);const o=e.readString("topDim").val;this.topDim=JSON.parse(o);const m=e.readString("rightDim").val;this.rightDim=JSON.parse(m);const y=e.readString("interlacedWeldSeam").val;return this.interlacedWeldSeam=JSON.parse(y),this.weldingInfo=e.readString("weldingInfo").val,!0}dwgOutFields(e){return e.writePoint("turningPt",this.turningPt),e.writePoint("position",this.position),e.writePoint("fixedPoint",this.fixedPoint),e.writeDouble("size",this.size),e.writeLong("dottedPos",this.dottedPos),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),e.writeString("baseSymbok",JSON.stringify(this.baseSymbok)),e.writeString("AuxiliarySymbol",JSON.stringify(this.auxiliarySymbol)),e.writeString("specialSymbol",JSON.stringify(this.specialSymbol)),e.writeString("suppleSymbol",JSON.stringify(this.suppleSymbol)),e.writeString("leftDim",JSON.stringify(this.leftDim)),e.writeString("topDim",JSON.stringify(this.topDim)),e.writeString("rightDim",JSON.stringify(this.rightDim)),e.writeString("interlacedWeldSeam",JSON.stringify(this.interlacedWeldSeam)),e.writeString("weldingInfo",this.weldingInfo),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.position.x+=n,this.position.y+=r,this.position.z+=s):e===1?(this.turningPt.x+=n,this.turningPt.y+=r,this.turningPt.z+=s):e===2&&(this.fixedPoint.x+=n,this.fixedPoint.y+=r,this.fixedPoint.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e.append(this.turningPt),e.append(this.fixedPoint),e}worldDraw(e){const n=this.getAllEntity();n.forEach((r,s)=>{s===n.length-1&&e.setupForEntity(r),e.drawEntity(r)})}getAllEntity(){const e=[],n=[];let r=this.fixedPoint.x<this.position.x,s=this.fixedPoint.clone();s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(1/8)));const u=new p.McDbPolyline;u.addVertexAt(this.position),u.addVertexAt(this.turningPt),u.addVertexAt(this.fixedPoint),n.push(u);const h=this.turningPoint.sub(this.position).normalize(),o=this.position.clone().addvec(h.mult(this.size)),m=h.clone().perpVector().mult(this.size*(1/8)),y=o.clone().addvec(m),x=o.clone().addvec(m.clone().negate()),M=new p.McDbHatch;if(M.appendLoop(new p.McGePoint3dArray([y,x,this.position])),n.push(M),this.suppleSymbol.length){const{entityArr:T,noChangeArr:P,v:D}=this.drawSuppleSymbol(r);s.addvec(D),e.push(...T),n.push(...P)}if(this.leftDim.length){const{entityArr:T,v:P}=this.drawLeftDim(s);s.addvec(P),e.push(...T)}if(this.specialSymbol.length){const{entityArr:T}=this.drawSpecialSymbol(s);e.push(...T),s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/2))}if(this.suppleSymbol.length&&this.suppleSymbol.filter(T=>T.typeName===0).length){const T=this.drawWidth(s);e.push(...T)}if(this.baseSymbok.length){const{entityArr:T}=this.drawBasicSymbol(s);e.push(...T)}if(this.auxiliarySymbol.length){const{entityArr:T}=this.drawAuxiliarySymbol(s);e.push(...T)}if(this.topDim.length){const{entityArr:T}=this.drawTopDim(s);e.push(...T)}if(s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(7/4))),this.rightDim.length){const{entityArr:T,v:P}=this.drawRightDim(s);s.addvec(P),e.push(...T)}if(s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(4/8))),this.suppleSymbol.length&&this.suppleSymbol.filter(T=>T.typeName===5).length){(this.baseSymbok.length||this.suppleSymbol.filter(V=>V.typeName===0))&&s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/2));const T=p.McGeVector3d.kXAxis.clone().mult(this.size*(1/16)),P=p.McGeVector3d.kYAxis.clone().mult(this.size*(17/16)),D=p.McGeVector3d.kXAxis.clone().mult(this.height).negate(),k=s.clone().addvec(P),z=s.clone().addvec(P.clone().negate()),O=k.clone().addvec(D),U=z.clone().addvec(D),H=new p.McDbPolyline;if(H.addVertexAt(O),H.addVertexAt(k),H.addVertexAt(U),H.addVertexAt(z),e.push(H),this.interlacedWeldSeam.length){let V=null;this.interlacedWeldSeam.forEach(W=>{const K=new p.McDbMText;K.contents=W.content,K.textHeight=this.height,K.attachment=p.McDb.AttachmentPoint.kTopLeft,W.position===2?K.location=s.clone().addvec(T):W.position===1&&(K.location=s.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size)).addvec(T));const Z=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();K.textStyleId=Z,K.reCompute();const{maxPt:tt}=p.MxCADUtility.getTextEntityBox(K,!1);(!V||V<tt.x)&&(V=tt.x),e.push(K)}),s.x=V}}if(this.suppleSymbol.length&&this.suppleSymbol.filter(T=>T.typeName===4).length){const T=this.fixedPoint.sub(s).mult(2),P=p.McGeVector3d.kYAxis.clone().mult(this.height),D=r?p.McGeVector3d.kXAxis.clone().negate().mult(this.height):p.McGeVector3d.kXAxis.clone().mult(this.height),k=s.clone().addvec(P).addvec(D),z=s.clone().addvec(P.clone().negate()).addvec(D),O=new p.McDbPolyline;if(O.addVertexAt(k),O.addVertexAt(s),O.addVertexAt(z),r&&O.move(s,s.clone().addvec(T)),n.push(O),this.weldingInfo){const U=new p.McDbMText;U.contents=this.weldingInfo;const H=r?p.McGeVector3d.kXAxis.clone().mult(this.size*(5/4)).negate():p.McGeVector3d.kXAxis.clone().mult(this.size*(5/4));U.location=s.clone().addvec(H),U.attachment=r?p.McDb.AttachmentPoint.kMiddleRight:p.McDb.AttachmentPoint.kMiddleLeft,U.textHeight=this.height,r&&U.move(s,s.clone().addvec(T)),n.push(U)}}const A=new p.McDbLine(s,this.fixedPoint);if(r&&A.move(s,this.fixedPoint),n.push(A),this.dottedPos&&!this.suppleSymbol.filter(T=>T.typeName===5).length){const T=p.McGeVector3d.kYAxis.clone().mult(this.size*.25);this.dottedPos===2&&T.negate();const P=this.fixedPoint.clone().addvec(T),D=A.clone();D.move(this.fixedPoint,P);const k=p.MxCpp.getCurrentMxCAD();let z=this.dimSize/8,O=k.database,U=k.getSysVarDouble("LTSCALE");z=z/U;let H=O.getLinetypeTable(),V="weldingDottedLineType",W=H.get(V);if(W.isNull()){let K=new p.McDbLinetypeTableRecord;K.numDashes=2,K.setDashLengthAt(0,z),K.setDashLengthAt(1,-z),K.name=V,W=H.add(K)}D.linetypeId=W,n.push(D)}if(r){let T=this.fixedPoint.clone();this.suppleSymbol.filter(P=>P.typeName===2).length&&(T=this.fixedPoint.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/4)).negate())),e.forEach(P=>{P.move(s,T)})}return e.push(...n),e}drawSuppleSymbol(e){const n=[],r=[];let s=this.fixedPoint.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.125)),u=this.fixedPoint.clone(),h=p.McGeVector3d.kYAxis.clone().mult(this.size*(1/4));if(this.suppleSymbol.filter(m=>m.typeName===1).length){const m=new p.McDbCircle(this.fixedPoint.x,this.fixedPoint.y,0,this.size*.375);r.push(m),s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(3/8))),u=new p.McGePoint3d(s.x,this.fixedPoint.y)}if(this.suppleSymbol.filter(m=>m.typeName===2).length){const m=p.McGeVector3d.kYAxis.clone().mult(this.size*.375),y=this.fixedPoint.clone().addvec(m),x=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(7/8))),M=p.McGeVector3d.kXAxis.clone().mult(this.size*(5/4)),A=y.clone().addvec(M),T=new p.McDbLine(this.fixedPoint,y);let P=new p.McDbHatch;P.appendLoop(new p.McGePoint3dArray([y,x,A]));const{maxPt:D}=P.getBoundingBox();if(u=new p.McGePoint3d(D.x,this.fixedPoint.y),e){P=new p.McDbHatch;const k=y.clone().addvec(M.clone().negate());P.appendLoop(new p.McGePoint3dArray([y,x,k]))}r.push(P),r.push(T),s.addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(7/8)))}if(this.suppleSymbol.filter(m=>m.typeName===3).length){const m=this.suppleSymbol.filter(H=>H.typeName===3)[0],y=this.dottedPos===1?s.clone().addvec(h):s.clone(),x=p.McGeVector3d.kYAxis.clone(),M=y.clone().addvec(x.clone().mult(this.size*(1/8))),A=M.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),T=M.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(3/4))),P=A.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(3/4))),D=new p.McDbPolyline;D.addVertexAt(A),D.addVertexAt(M),D.addVertexAt(T),D.addVertexAt(P);const{minPt:k,maxPt:z}=D.getBoundingBox();let O=z.x;const U=k.clone().addvec(z.sub(k).mult(1/2));if(m.rotation){D.rotate(U,m.rotation),m.rotation!=Math.PI&&D.move(y,M);const{maxPt:H}=D.getBoundingBox();O=H.x}u=new p.McGePoint3d(O,this.fixedPoint.y),n.push(D)}const o=u.sub(this.fixedPoint);return{entityArr:n,noChangeArr:r,v:o}}drawWidth(e){const n=[];let r=p.McGeVector3d.kYAxis.clone().mult(this.size*.25);const s=p.McGeVector3d.kXAxis.clone().mult(this.size/2),u=p.McGeVector3d.kYAxis.clone().mult(this.size*(7/16)).negate(),h=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size));this.dottedLinePos===2&&h.addvec(r.clone().negate());const o=h.clone().addvec(s),m=o.clone().addvec(u),y=h.clone().addvec(s.clone().negate()),x=y.clone().addvec(u),M=[o,m,x,y],A=new p.McDbPolyline;return M.forEach(T=>{A.addVertexAt(T)}),n.push(A),n}drawLeftDim(e){const n=[];let r=null;const s=p.McGeVector3d.kXAxis.clone().mult(this.size*(1/16)),u=p.McGeVector3d.kYAxis.clone().mult(this.size*(1/4));this.leftDim.forEach(o=>{const m=new p.McDbMText;if(m.contents=o.content,m.textHeight=this.height,m.attachment=p.McDb.AttachmentPoint.kTopLeft,o.position===2){const M=this.dottedPos===2&&!this.suppleSymbol.filter(A=>A.typeName===5).length?e.clone().addvec(u.negate()):e.clone();m.location=M.clone().addvec(s)}else if(o.position===1){const M=this.dottedPos===1&&this.suppleSymbol.filter(A=>A.typeName===5).length?e.clone().addvec(u):e.clone();m.location=M.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size)).addvec(s)}const y=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();m.textStyleId=y,m.reCompute();const{maxPt:x}=p.MxCADUtility.getTextEntityBox(m,!1);if((!r||r<x.x)&&(r=x.x),this.dottedLinePos&&o.position===this.dottedLinePos){const M=this.dottedLinePos===1?p.McGeVector3d.kYAxis.clone().mult(this.size/4):p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate();m.location=m.location.addvec(M)}n.push(m)});const h=new p.McGePoint3d(r,e.y).sub(e);return{entityArr:n,v:h}}drawTopDim(e){const n=[],r=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*1.75));return this.topDim.forEach(s=>{const u=new p.McDbMText;if(u.contents=s.content,u.textHeight=this.height,u.attachment=p.McDb.AttachmentPoint.kBaseCenter,u.location=r.clone(),u.location=r.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),s.position===2&&(u.mirror(this.fixedPoint,e),u.attachment=p.McDb.AttachmentPoint.kBaseCenter,u.location=u.location.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height))),this.dottedLinePos&&s.position===this.dottedLinePos){const h=this.dottedLinePos===1?p.McGeVector3d.kYAxis.clone().mult(this.size/4):p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate();u.location=u.location.addvec(h)}n.push(u)}),{entityArr:n}}drawRightDim(e){const n=[],r=p.McGeVector3d.kXAxis.clone();let s=null;return this.rightDim.forEach(u=>{const h=new p.McDbMText;h.contents=u.content,h.textHeight=this.height,h.attachment=p.McDb.AttachmentPoint.kTopLeft,u.position===1?h.location=e.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height+this.size/8)):u.position===2&&(h.location=e.clone());const o=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();h.textStyleId=o,h.reCompute();const{maxPt:m}=p.MxCADUtility.getTextEntityBox(h,!1);if((!s||s<m.x)&&(s=m.x),this.dottedLinePos&&u.position===this.dottedLinePos){const y=this.dottedLinePos===1?p.McGeVector3d.kYAxis.clone().mult(this.size/4):p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate();h.location=h.location.addvec(y)}n.push(h)}),r.mult(Math.abs(s-e.x)),{entityArr:n,v:r}}drawBasicSymbol(e){const n=[],r=[],s=(o,m)=>{let y=[];const{maxPt:x,minPt:M}=m.getBoundingBox(),A=M.clone().addvec(x.sub(M).mult(1/2)),T=new p.McGePoint3d(A.x,e.y),P=new p.McDbMText;P.contents=o.info,P.attachment=p.McDb.AttachmentPoint.kTopCenter,P.textHeight=this.size*.3333333333333333,P.location=T.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*.9166666666666666));const D=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();P.textStyleId=D,P.reCompute();const{minPt:k,maxPt:z}=p.MxCADUtility.getTextEntityBox(P,!1);if(o.position===2){const H=P.clone();H.mirror(this.fixedPoint,e),P.attachment=p.McDb.AttachmentPoint.kTopCenter,P.location=H.location.addvec(p.McGeVector3d.kYAxis.clone().mult(P.textHeight*1.1666666666666667))}n.push(P);const U=new p.McDbLine(k,new p.McGePoint3d(z.x,k.y)).IntersectWith(m,p.McDb.Intersect.kOnBothOperands);return U.length()===2?y=[U.at(0),m.getPointAt(1).val,U.at(1)]:U.length()===1&&(y=[m.getPointAt(0).val,m.getPointAt(1).val,U.at(0)]),y},u=o=>{const m=new p.McDbPolyline;return o.forEach(y=>{m.addVertexAt(y)}),m},h=(o,m)=>{const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.375)),x=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(5/8))),M=x.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/4))),A=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/4))),T=u([y,x,M,A]),{minPt:P,maxPt:D}=T.getBoundingBox(),k=P.clone().addvec(D.sub(P).mult(1/2)),z=new p.McDbMText;z.contents=o,z.attachment=p.McDb.AttachmentPoint.kBaseFit,z.textHeight=this.size*.625,z.location=k,z.reCompute();const O=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();z.textStyleId=O,z.reCompute();const{minPt:U,maxPt:H}=p.MxCADUtility.getTextEntityBox(z,!1),V=U.clone().addvec(H.sub(U).mult(.5)),W=k.sub(V);if(z.location=k.clone().addvec(W).addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/15)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/17)),m.position===2){const K=z.clone();K.mirror(this.fixedPoint,e),z.location=K.location.addvec(p.McGeVector3d.kYAxis.clone().mult(z.textHeight*1.1666666666666667))}n.push(T,z)};return this.baseSymbok.forEach(o=>{if(n.length=0,o.typeName===6){const m=this.size*.75,y=new p.McDbArc;y.center=e.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(m)).addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/8)),y.radius=m,y.startAngle=Math.PI*(3/2),y.endAngle=0;const x=y.center.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(m)),M=x.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(1/8))),A=new p.McDbLine(M,x),T=x.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(1/8))),P=y.clone();P.mirror(T,new p.McGePoint3d(T.x,e.y));const D=A.clone();D.mirror(T,new p.McGePoint3d(T.x,e.y)),n.push(y,P,D,A)}else if(o.typeName===7){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.6875)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),x=new p.McDbLine(m,y),M=x.clone(),A=m.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/8)));M.move(m,A),n.push(x,M)}else if(o.typeName===8){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.5)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(7/8))),x=m.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(1/2))),M=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size));let A=[y,x,M];const T=u(A);if(o.info){const D=s(o,T);D.length&&(A=D)}const P=u(A);n.push(P)}else if(o.typeName===9){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.625)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),x=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.height));let M=[y,m,x];const A=u(M);if(o.info){const P=s(o,A);P.length&&(M=P)}const T=u(M);n.push(T)}else if(o.typeName===10){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.625));m.addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(1/8)));const y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),x=m.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/2)),M=x.clone().addvec(m.sub(x).mult(1/4)),A=M.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)).addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/16))),T=new p.McDbLine(M,A),D=u([y,m,x]);n.push(D,T)}else if(o.typeName===11){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/2)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height/2)),x=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/8))),M=x.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height/2)),A=new p.McDbLine(y,M),T=new p.McDbLine(m,x);n.push(A,T)}else if(o.typeName===12)h("MR",o);else if(o.typeName===13)h("R",o);else if(o.typeName===14)h("M",o);else if(o.typeName===15){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(3/8))),x=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/16))).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/2)),M=x.clone().addvec(p.McGeVector3d.kXAxis.clone().negate().mult(this.size*(5/8)));let A=[x,y,M];const T=new p.McDbLine(m,y),P=u(A);if(o.info){const k=s(o,P);k.length&&(A=k)}const D=u(A);n.push(D,T)}else if(o.typeName===17){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.6875)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(3/8))),x=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/2)),M=x.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(5/8)));let A=[x,y,M];const T=new p.McDbLine(m,y),P=u(A);if(o.info){const k=s(o,P);k.length&&(A=k)}const D=u(A);n.push(D,T)}else if(o.typeName===16){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(1/4))),x=new p.McDbLine(m,y),M=this.size*(3/8),A=new p.McDbArc;A.center=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(M)),A.radius=M,A.startAngle=Math.PI,A.endAngle=Math.PI*2;const T=A.getStartPoint().val,P=T.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4)),D=A.getEndPoint().val,k=D.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4));let z=[P,m,k];const O=u(z);if(o.info){const U=s(o,O);U.length&&(z=U);const V=new p.McDbLine(z[0],z[2]).IntersectWith(A,p.McDb.Intersect.kOnBothOperands);if(V.length()){const W=new p.McDbArc;W.computeArc(V.at(0).x,V.at(0).y,y.x,y.y,V.at(1).x,V.at(1).y),n.push(W)}else n.push(A)}else{const U=new p.McDbLine(T,P),H=new p.McDbLine(D,k);n.push(U,H,A)}n.push(x)}else if(o.typeName===18){const m=this.size*.375,y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size-m/2)),x=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),M=new p.McDbLine(y,x),A=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(1/4))),T=new p.McDbArc;T.center=A.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(m)),T.radius=m,T.startAngle=Math.PI*(3/2),T.endAngle=Math.PI*2;const P=T.getEndPoint().val,D=P.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4)),k=new p.McDbLine(P,D);n.push(k,T,M)}else if(o.typeName===19){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),x=new p.McDbLine(m,y),M=p.McGeVector3d.kXAxis.clone().mult(this.size*(3/16)),A=x.clone();A.move(m,m.clone().addvec(M));const T=x.clone();T.move(m,m.clone().addvec(M.clone().negate())),n.push(x,A,T)}else if(o.typeName===20){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*.6875)),y=p.McGeVector3d.kXAxis.clone().mult(this.size*(3/8)),x=m.clone().addvec(y),M=m.clone().addvec(y.clone().negate()),A=new p.McDbLine(x,M),T=A.clone();T.mirror(this.fixedPoint,e),n.push(A,T)}else if(o.typeName===21){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(1/4))),x=new p.McDbCircle;x.center=y,x.radius=this.size*(11/16);const M=new p.McDbLine(this.fixedPoint,e),A=x.IntersectWith(M,p.McDb.Intersect.kExtendBoth);if(A.length()===2){const T=new p.McDbArc,P=y.clone().addvec(p.McGeVector3d.kYAxis.clone().negate().mult(x.radius)),D=A.at(0),k=A.at(1);T.computeArc(D.x,D.y,P.x,P.y,k.x,k.y),T.mirror(this.fixedPoint,e);const z=new p.McDbLine(D,k);n.push(T,z)}}else if(o.typeName===22){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=p.McGeVector3d.kXAxis.clone().mult(this.height/2),x=m.clone().addvec(y),M=m.clone().addvec(y.clone().negate()),A=M.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),T=u([x,M,A]);T.isClosed=!0,n.push(T)}else if(o.typeName===23){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=p.McGeVector3d.kXAxis.clone().mult(this.size/2),x=p.McGeVector3d.kYAxis.clone().mult(this.size*(5/8)),M=m.clone().addvec(y),A=M.clone().addvec(x),T=A.clone().addvec(y.negate().mult(2)),P=T.clone().addvec(x.clone().negate()),D=u([M,A,T,P]);n.push(D)}else if(o.typeName===24){const m=new p.McDbCircle;m.center=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),m.radius=this.size*(3/8),n.push(m)}else if(o.typeName===25){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height*(2/3))),x=p.McGeVector3d.kXAxis.clone().mult(this.size*(1/8)),M=y.clone().addvec(x),A=y.clone().addvec(x.clone().negate()),T=new p.McDbLine(M,A),P=p.McGeVector3d.kYAxis.clone().mult(this.height/3),D=T.clone();D.move(M,M.clone().addvec(P)),D.endPoint=D.endPoint.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.height/3).negate());const k=T.clone();k.move(M,M.clone().addvec(P.clone().negate()));const z=new p.McDbArc;z.center=A.clone().addvec(P.clone().negate()),z.radius=this.height/3,z.startAngle=Math.PI/2,z.endAngle=Math.PI*(3/2);const O=new p.McDbArc;O.center=M,O.radius=this.height/3,O.startAngle=Math.PI*(3/2),O.endAngle=Math.PI/2,n.push(T,D,k,z,O)}else if(o.typeName===26){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size-this.height/2)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)).addvec(p.McGeVector3d.kXAxis.clone().mult(this.height/2)),x=new p.McDbLine(m,y),M=x.clone();M.move(m,m.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.height/2))),n.push(x,M)}else if(o.typeName===27){const m=new p.McDbCircle;m.center=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),m.radius=this.height/2,n.push(m)}else if(o.typeName===28){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=new p.McDbCircle;y.center=m,y.radius=this.size*(11/16);const x=p.McGeVector3d.kXAxis.clone().mult(this.height),M=m.clone().addvec(x),A=m.clone().addvec(x.clone().negate()),T=new p.McDbLine(M,A),P=p.McGeVector3d.kYAxis.clone().mult(this.height/2),D=T.clone();D.move(m,m.clone().addvec(P));const k=T.clone();k.move(m,m.clone().addvec(P.clone().negate())),n.push(y,D,k)}else if(o.typeName===29){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=p.McGeVector3d.kYAxis.clone().mult(this.size*(9/16)),x=new p.McDbCircle;x.center=m.clone().addvec(y),x.radius=this.size*(9/16);const M=p.McGeVector3d.kXAxis.clone().mult(this.height),A=m.clone().addvec(M),T=m.clone().addvec(M.clone().negate()),P=new p.McDbLine(A,T),D=x.center.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(3/16))),k=x.center.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate()),z=P.clone();z.move(m,D);const O=P.clone();O.move(m,k),n.push(x,z,O)}else if(o.typeName===30){const m=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),y=m.addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4)),x=p.McGeVector3d.kXAxis.clone().mult(this.size*(5/16)),M=y.clone().addvec(x),A=y.clone().addvec(x.clone().negate()),T=new p.McDbLine(M,A),P=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/8)),D=P.clone().addvec(x).addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),k=new p.McDbLine(P,D),z=k.clone();z.mirror(m,y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size))),n.push(T,k,z)}if(o.position===2&&n.forEach(m=>{m instanceof p.McDbMText||m.mirror(this.fixedPoint,e)}),this.dottedLinePos&&o.position===this.dottedLinePos){const m=this.dottedLinePos===1?p.McGeVector3d.kYAxis.clone().mult(this.size/4):p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate();n.forEach(y=>{y.move(e,e.clone().addvec(m))})}r.push(...n)}),{entityArr:r}}drawSpecialSymbol(e){const n=[],r=[];return this.specialSymbol.forEach(s=>{if(n.length=0,s.typeName===31){const u=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*1.25)),h=p.McGeVector3d.kXAxis.clone().mult(this.size/8),o=u.clone().addvec(h),m=o.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/8)),y=new p.McDbLine(o,m),x=new p.McDbArc,M=this.size*(3/4);x.center=m.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(M)),x.radius=M,x.startAngle=Math.PI/2,x.endAngle=Math.PI;const A=u.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size)),T=y.clone();T.mirror(u,A);const P=x.clone();P.mirror(u,A),n.push(y,x,T,P)}else if(s.typeName===32){const u=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.375)),h=u.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),o=new p.McDbLine(u,h),m=u.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/4)),y=m.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/8)),x=new p.McDbLine(m,y),M=new p.McDbArc;M.center=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(3/4))),M.radius=this.size*(3/4),M.startAngle=Math.PI/2,M.endAngle=Math.PI,n.push(o,x,M)}else if(s.typeName===33){const u=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.375)),h=this.size*(9/16),o=new p.McDbArc;o.center=u.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(h)),o.radius=h,o.startAngle=0,o.endAngle=Math.PI;const m=o.clone(),y=u.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(h*2));m.mirror(y,y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size))),n.push(o,m)}else if(s.typeName===34){const u=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*.375)),h=p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate(),o=u.clone().addvec(h),m=p.McGeVector3d.kXAxis.clone().mult(this.height),y=o.clone().addvec(m),x=y.clone().addvec(h.clone().mult(7/4)),M=x.clone().addvec(m.clone().negate()),A=new p.McDbPolyline;[u,o,y,x,M].forEach(O=>A.addVertexAt(O));const P=u.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.height)),D=P.clone().addvec(m),k=new p.McDbPolyline;[P,u,D].forEach(O=>k.addVertexAt(O)),n.push(A,k)}else if(s.typeName===35){const u=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().negate().mult(this.size/4)),h=p.McGeVector3d.kXAxis.clone().mult(this.size*(7/16)),o=u.clone().addvec(h),m=o.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(7/16)).negate()),y=m.clone().addvec(h.clone().negate()),x=new p.McDbPolyline;[u,o,m,y].forEach(O=>x.addVertexAt(O));const A=u.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(5/8))),T=p.McGeVector3d.kXAxis.clone().mult(this.size*(9/16)),P=A.clone().addvec(T),D=A.clone().addvec(T.clone().negate()),k=new p.McDbPolyline;[P,u,D].forEach(O=>k.addVertexAt(O)),n.push(x,k)}if(s.position===2&&n.forEach(u=>{u.mirror(this.fixedPoint,this.fixedPoint.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*10)))}),this.dottedLinePos&&s.position===this.dottedLinePos){const u=this.dottedLinePos===1?p.McGeVector3d.kYAxis.clone().mult(this.size/4):p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate();n.forEach(h=>{h.move(e,e.clone().addvec(u))})}r.push(...n)}),{entityArr:r}}drawAuxiliarySymbol(e){const n=[],r=[];return this.auxiliarySymbol.forEach(s=>{n.length=0;const u=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(21/16))),h=p.McGeVector3d.kXAxis.clone().mult(this.size*(5/8)),o=u.clone().addvec(h),m=u.clone().addvec(h.clone().negate());if(s.typeName===36){const y=new p.McDbLine(o,m);n.push(y)}else if(s.typeName===37){const y=u.clone().addvec(p.McGeVector3d.kYAxis.clone().negate().mult(this.size*.375)),x=new p.McDbArc;x.computeArc(o.x,o.y,y.x,y.y,m.x,m.y),n.push(x)}else if(s.typeName===38){const y=u.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*.375)),x=new p.McDbArc;x.computeArc(o.x,o.y,y.x,y.y,m.x,m.y),n.push(x)}else if(s.typeName===39){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4)),x=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size*(11/16))),M=y.clone().addvec(p.McGeVector3d.kXAxis.clone().negate().mult(this.size/4)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(15/16))),A=new p.McDbLine(x,M);n.push(A)}else if(s.typeName===40){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/4)),x=y.clone().addvec(p.McGeVector3d.kXAxis.clone().negate().mult(this.size*(11/16))),M=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size/4)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(15/16))),A=new p.McDbLine(x,M);n.push(A)}else if(s.typeName===41){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*.625)),x=new p.McDbArc;x.center=y,x.startAngle=0,x.endAngle=Math.PI/2,x.radius=this.size*(5/8),n.push(x)}else if(s.typeName===42){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*.625)),x=this.size*(5/8),M=y.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(x)).addvec(p.McGeVector3d.kYAxis.clone().mult(x)),A=new p.McDbArc;A.center=M,A.radius=x,A.startAngle=Math.PI,A.endAngle=Math.PI*(3/2),n.push(A)}else if(s.typeName===43){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)).addvec(p.McGeVector3d.kYAxis.clone().mult(this.size)),x=p.McGeVector3d.kXAxis.clone().mult(this.size*(7/16)),M=y.clone().addvec(x),A=y.clone().addvec(x.clone().negate()),T=new p.McDbLine(M,A),P=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size/8)),D=p.McGeVector3d.kXAxis.clone().mult(this.size*(7/32)),k=P.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(7/16))).addvec(D.clone().negate()),z=k.clone().addvec(D.clone().mult(2)),O=z.sub(P),U=z.clone().addvec(O),H=[z,k,P,U],V=new p.McDbPolyline;H.forEach(W=>V.addVertexAt(W)),n.push(V,T)}else if(s.typeName===44){const y=e.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(this.size)),x=y.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(5/4))),M=x.clone().addvec(p.McGeVector3d.kYAxis.clone().mult(this.size*(3/8))),A=new p.McDbLine(x,M),T=this.size*(7/32),P=x.clone().addvec(p.McGeVector3d.kXAxis.clone().mult(T)),D=new p.McDbArc;D.center=P,D.radius=T,D.startAngle=Math.PI,D.endAngle=0;const k=D.clone();k.mirror(y,x),n.push(A,D,k)}if(s.position===2&&n.forEach(y=>{y.mirror(this.fixedPoint,e)}),this.dottedLinePos&&s.position===this.dottedLinePos){const y=this.dottedLinePos===1?p.McGeVector3d.kYAxis.clone().mult(this.size/4):p.McGeVector3d.kYAxis.clone().mult(this.size/4).negate();n.forEach(x=>{x.move(e,e.clone().addvec(y))})}r.push(...n)}),{entityArr:r}}getBox(e){let n,r=null;e.forEach(s=>{if(s instanceof p.McDbMText){const o=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();s.textStyleId=o,s.reCompute()}const{minPt:u,maxPt:h}=s instanceof p.McDbMText?p.MxCADUtility.getTextEntityBox(s,!1):s.getBoundingBox();n||(n=u.clone()),r||(r=h.clone()),u.x<n.x&&(n.x=u.x),u.y<n.y&&(n.y=u.y),h.x>r.x&&(r.x=h.x),h.y>r.y&&(r.y=h.y)}),n&&r&&(this.assertWrite(),this.maxPt=r,this.minPt=n)}getBoundingBox(){const e=this.getAllEntity();return this.getBox(e),{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}getBaseSymbok(){return this.baseSymbok}setBaseSymbok(e){const n=e.filter(r=>r.typeName!==45);this.baseSymbok=n}getAuxiliarySymbol(){return this.auxiliarySymbol}setAuxiliarySymbol(e){const n=e.filter(r=>r.typeName!==45);this.auxiliarySymbol=n}getSpecialSymbol(){return this.specialSymbol}setSpecialSymbol(e){const n=e.filter(r=>r.typeName!==45);this.specialSymbol=n}getSuppleSymbol(){return this.suppleSymbol}setSuppleSymbol(e){const n=e.filter(r=>r.typeName!==45);this.suppleSymbol=n}getLeftDim(){return this.leftDim}setLeftDim(e){const n=e.filter(r=>r.content!=="");this.leftDim=n}getTopDim(){return this.topDim}setTopDim(e){const n=e.filter(r=>r.content!=="");this.topDim=n}getRightDim(){return this.rightDim}setRightDim(e){const n=e.filter(r=>r.content!=="");this.rightDim=n}getIntWeldSeam(){return this.interlacedWeldSeam}setIntWeldSeam(e){const n=e.filter(r=>r.content!=="");this.interlacedWeldSeam=n}}function lz(){return Gt(this,null,function*(){Ho.value="WeldingSymbolDialog",_o.showDialog(!0,{title:G("焊接符号")}).then(n=>Gt(this,[n],function*({data:t,isCanceled:e}){if(!e&&t.formData){const r=t.formData,s=new ap;if(r.specialSymbol.length&&s.setSpecialSymbol(r.specialSymbol),r.rightDim1||r.rightDim2){const D=[1,2],k=[];D.forEach(z=>{const O=r.rightDim1.filter(V=>V.position===z)[0],U=r.rightDim2.filter(V=>V.position===z)[0],H=O.content&&U.content?"×":"";k.push({position:z,content:O.content+H+U.content})}),s.setRightDim(k)}r.suppleSymbol.length&&s.setSuppleSymbol(r.suppleSymbol),r.leftDim&&s.setLeftDim(r.leftDim),r.topDim&&s.setTopDim(r.topDim),r.auxiliarySymbol.length&&s.setAuxiliarySymbol(r.auxiliarySymbol),r.basicSymbol.length&&s.setBaseSymbok(r.basicSymbol),r.intWeldSeam&&s.setIntWeldSeam(r.intWeldSeam),r.dottedLinePos&&(s.dottedLinePos=r.dottedLinePos),r.weldingSymbolInfo&&(s.weldingSymbolInfo=r.weldingSymbolInfo.replace(/\n/g,"\\P"));let u=!1;const h=new p.MxCADUiPrPoint;h.setMessage(`${G("请设置定位点或直线或圆弧")}`);const o=yield h.go();if(!o)return;s.weldingPosition=o;const m=new p.MxCADResbuf;m.AddMcDbEntityTypes("ARC,CIRCLE");let y=p.MxCADUtility.findEntAtPoint(o.x,o.y,o.z,-1,m);y.isValid()&&(u=!0);const x=new p.MxCADUiPrPoint;x.setMessage(`${G("请设置引线转折点")}`),x.setUserDraw((D,k)=>{if(u){const O=y.getMcDbEntity().getClosestPointTo(D,!0).val;s.weldingPosition=O}s.turningPoint=D,k.drawMcDbEntity(s)});const M=yield x.go();if(!M)return;s.turningPoint=M;const A=new p.MxCADUiPrPoint;A.setMessage(`${G("拖动确定定位点")}`),A.setUserDraw((D,k)=>{const z=s.clone();z.fixedPos=D,k.drawMcDbEntity(z)});const T=yield A.go();T&&(s.fixedPos=T),p.MxCpp.getCurrentMxCAD().drawEntity(s)}}))})}class Eg extends p.McDbCustomEntity{constructor(e){super(e),this.startPoint=new p.McGePoint3d,this.endPoint=new p.McGePoint3d,this.anchorPoint=new p.McGePoint3d,this.arrowSize=4,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Eg(e)}getTypeName(){return"McDbTestRayAnnotation"}dwgInFields(e){return this.startPoint=e.readPoint("startPoint").val,this.endPoint=e.readPoint("endPoint").val,this.anchorPoint=e.readPoint("anchorPoint").val,this.arrowSize=e.readDouble("arrowSize").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("startPoint",this.startPoint),e.writePoint("endPoint",this.endPoint),e.writePoint("anchorPoint",this.anchorPoint),e.writeDouble("arrowSize",this.arrowSize),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite();const u=new p.McDbLine(this.startPoint,this.endPoint);if(e===0){const h=this.startPoint.clone();h.x+=n,h.y+=r,h.z+=s,this.startPoint=u.getClosestPointTo(h,!0).val}else if(e===1){const h=this.endPoint.clone();h.x+=n,h.y+=r,h.z+=s,this.endPoint=u.getClosestPointTo(h,!0).val}else e===2&&(this.anchorPoint.x+=n,this.anchorPoint.y+=r,this.anchorPoint.z+=s,this.resetAnchorPoint())}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.startPoint),e.append(this.endPoint),e.append(this.anchorPoint),e}sortPointsByXAxis(e){const n=e.map(r=>r.clone());for(let r=0;r<n.length-1;r++)for(let s=0;s<n.length-1-r;s++)if(n[s].x>n[s+1].x){const u=n[s];n[s]=n[s+1],n[s+1]=u}return n}worldDraw(e){this.getAllEntity().forEach(n=>{e.drawEntity(n)})}getAllEntity(){const e=new p.McDbLine(this.startPoint,this.endPoint),n=this.startPoint.sub(this.endPoint).normalize().mult(this.arrowSize),r=this.endPoint.clone().addvec(n),s=n.clone().perpVector().mult(this.arrowSize/8),u=r.clone().addvec(s),h=r.clone().addvec(s.clone().negate()),o=new p.McDbHatch;o.appendLoop(new p.McGePoint3dArray([u,h,this.endPoint]));const m=new p.McDbMText;m.contents=`${e.getLength().val.toFixed(2)}`,m.textHeight=this.arrowSize*(7/8),m.attachment=p.McDb.AttachmentPoint.kBottomCenter,m.location=this.anchorPoint.clone(),m.textStyleId=p.MxCpp.getCurrentMxCAD().getDatabase().getCurrentlyTextStyleId();const y=this.sortPointsByXAxis([this.endPoint,this.startPoint]),x=y[y.length-1].sub(y[0]),M=x.clone().angleTo2(p.McGeVector3d.kXAxis);m.rotate(m.location,M),m.location=m.location.clone().addvec(x.clone().rotateBy(Math.PI/2).normalize().mult(this.arrowSize/8)),m.reCompute();const{maxPt:A,minPt:T}=p.MxCADUtility.getTextEntityBox(m,!1),P=e.getClosestPointTo(A,!0).val,D=e.getClosestPointTo(T,!0).val,k=this.sortPointsByXAxis([P,D,this.startPoint,this.endPoint,this.anchorPoint]),z=new p.McDbLine(k[0],k[k.length-1]);return[o,z,m]}getBox(e){let n,r=null;e.forEach(s=>{s instanceof p.McDbMText&&s.reCompute();const{minPt:u,maxPt:h}=s instanceof p.McDbMText?p.MxCADUtility.getTextEntityBox(s,!1):s.getBoundingBox();n||(n=u.clone()),r||(r=h.clone()),u.x<n.x&&(n.x=u.x),u.y<n.y&&(n.y=u.y),h.x>r.x&&(r.x=h.x),h.y>r.y&&(r.y=h.y)}),n&&r&&(this.assertWrite(),this.maxPt=r,this.minPt=n)}resetAnchorPoint(){const e=new p.McDbLine(this.startPoint,this.endPoint),n=e.getClosestPointTo(this.anchorPoint,!0).val;e.getDistAtPoint(this.anchorPoint).val?this.anchorPoint=e.getPointAtDist(e.getLength().val/2).val:this.anchorPoint=n}getBoundingBox(){return this.getBox(this.getAllEntity()),{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}setStartPoint(e){this.assertWrite(),this.startPoint=this.endPoint=this.anchorPoint=e.clone()}getStartPoint(){return this.startPoint}setEndPoint(e){this.assertWrite(),this.endPoint=this.anchorPoint=e.clone()}getEndPoint(){return this.endPoint}setAnchorPoint(e){this.assertWrite(),this.anchorPoint=e.clone(),this.resetAnchorPoint()}getAnchorPoint(){return this.anchorPoint}setArrowSize(e){this.assertWrite(),this.arrowSize=e}getArrowSize(){return this.arrowSize}}function cz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new Eg;e.setArrowSize(5);const n=new p.MxCADUiPrPoint;n.setMessage(G("请指定第一点:"));const r=yield n.go();if(!r)return;e.setStartPoint(r);const s=new p.MxCADUiPrPoint;s.setMessage(G("请指定第二点:")),s.setUserDraw((m,y)=>{e.setEndPoint(m),y.drawMcDbEntity(e)});const u=yield s.go();if(!u)return;e.setEndPoint(u);const h=new p.MxCADUiPrPoint;h.setMessage("请指定定位点:"),h.setUserDraw((m,y)=>{e.setAnchorPoint(m),y.drawMcDbEntity(e)});const o=yield h.go();o&&(e.setAnchorPoint(o),t.drawEntity(e))})}function uz(){new yg().rxInit(),new xg().rxInit(),new op().rxInit(),new vg().rxInit(),new _g().rxInit(),new bg().rxInit(),new ta().rxInit(),new Mg().rxInit(),new wg().rxInit(),new Ag().rxInit(),new ap().rxInit(),new Eg().rxInit(),$.MxFun.addCommand("Mx_Approval",$F),$.MxFun.addCommand("Mx_AnnotatedRectangle",tz),$.MxFun.addCommand("Mx_Alignment",ez),$.MxFun.addCommand("Mx_indexSymbol",nz),$.MxFun.addCommand("Mx_RotationLabel",iz),$.MxFun.addCommand("Mx_RoundHoleMark",rz),$.MxFun.addCommand("Mx_Roughness",oz),$.MxFun.addCommand("Mx_weldSymbol",sz),$.MxFun.addCommand("Mx_DirectionaSymbol",az),$.MxFun.addCommand("Mx_WeldingSymbol",lz),$.MxFun.addCommand("MxTest_DrawRayAnnotation",cz),KF(),E5(),QF()}function hz(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;if(!(yield t.userSelect(G("选择对象:")))||t.count()==0)return;const e=[],n=p.MxCpp.getCurrentMxCAD(),r=new p.MxCADUiPrPoint;r.setMessage(G("指定基点"));const s=yield r.go();if(s)for(;;){const u=new p.MxCADUiPrPoint;u.setMessage(G("指定第二个点 ")),e.length>0?u.setKeyWords(`[${G("阵列")}(A)/${G("退出")}(E)/${G("放弃")}(U)]`):u.setKeyWords(`[${G("阵列")}(A)/${G("退出")}(E)]`),u.setUserDraw((o,m)=>{m.drawLine(o.toVector3(),s.toVector3()),t.forEach(y=>{let x=y.getMcDbEntity();if(!x)return;let M=x.clone();M.move(s,o),m.drawMcDbEntity(M)})});const h=yield u.go();if(u.getStatus()===$.MrxDbgUiPrBaseReturn.kKeyWord){if(u.isKeyWordPicked("E"))return;if(u.isKeyWordPicked("U"))if(e.length>0)e[e.length-1].forEach(o=>{o.erase()}),e.pop();else return;else if(u.isKeyWordPicked("A")){const o=new p.MxCADUiPrInt;o.clearLastInputPoint(),o.setMessage(G("输入要进行阵列的项目数 "));const m=(yield o.go())||1;let y=[];if(u.setUserDraw((M,A)=>{A.drawLine(M.toVector3(),s.toVector3()),y.length=0;let T=M.clone();y.push(T);for(let P=0;P<m-1;P++)T=T.clone().addvec(M.sub(s)),y.push(T);t.forEach(P=>{let D=P.getMcDbEntity();D&&y.forEach(k=>{let z=new p.McGeMatrix3d,O=D.clone();z.clone(),z.setToTranslation(k.sub(s)),O.transformBy(z),A.drawMcDbEntity(O)})})}),!(yield u.go()))return;e.push([]),t.forEach(M=>{let A=M.getMcDbEntity();A&&y.forEach(T=>{let P=new p.McGeMatrix3d,D=A.clone();P.clone(),P.setToTranslation(T.sub(s)),D.transformBy(P),e[e.length-1].push(n.drawEntity(D))})})}}else if(u.getStatus()===$.MrxDbgUiPrBaseReturn.kOk){if(!h)return;e.push([]),t.forEach(o=>{let m=o.getMcDbEntity();if(!m)return;let y=m.clone();y.move(s,h),e[e.length-1].push(n.drawEntity(y))})}else return}})}function dz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("ARC");let e=yield p.MxCADUtility.userSelect(G("选择圆弧对象"),t);e.length!=0&&e.forEach(n=>Gt(this,null,function*(){let r=yield n.getMcDbEntity(),s=r,u=s.center,h=s.radius,o=new p.McDbCircle;o.center=u,o.radius=h,r.erase(),p.MxCpp.getCurrentMxCAD().drawEntity(o)}))})}function pz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD();let e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("选择复制旋转对象:")))||e.count()==0)return;const n=new p.MxCADUiPrPoint;n.setMessage(G("指定基点"));const r=yield n.go(),s=new p.MxCADUiPrPoint;s.setMessage(G("请指定目标点 ")),s.setUserDraw((x,M)=>{M.drawLine(x.toVector3(),r.toVector3()),e.forEach(A=>{let T=A.getMcDbEntity();if(!T)return;let P=T.clone();P.move(r,x),M.drawMcDbEntity(P)})});const u=yield s.go();if(!u)return;let h=[];e.forEach(x=>{let M=x.getMcDbEntity();if(!M)return;let A=M.clone();A.move(r,u),h.push(t.drawEntity(A))});let o=new p.MxCADUiPrAngle;if(o.setMessage(G("请指定旋转角度")),o.setBasePt(u),o.setUserDraw((x,M)=>{M.drawLine(x.toVector3(),u.toVector3()),h.forEach(A=>{let T=A.getMcDbEntity();if(!T)return;let P=T.clone(),D=x.sub(u).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis);P.rotate(u,D),M.drawMcDbEntity(P)})}),!(yield o.go()))return;const y=o.value();h.forEach(x=>{let M=x.getMcDbEntity();if(!M)return;let A=M.clone();A.rotate(u,y),t.drawEntity(A),M.erase()})})}function fz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("CIRCLE");let e=yield p.MxCADUtility.userSelect(G("选择要转成多边形的对象"),t);if(e.length==0)return;let n=new p.MxCADUiPrInt;n.setMessage(G("设置多边形边数"));let r=(yield n.go())||5;if(n.clearLastInputPoint(),!r)return;const s=new p.MxCADUiPrPoint;s.setMessage(G(" 输入选项")),s.setKeyWords(`[${G("内接于圆")}(I)/${G("外切于圆")}(C)]`),s.clearLastInputPoint(),yield s.go();let u="inside";s.isKeyWordPicked("i")&&(u="inside"),s.isKeyWordPicked("c")&&(u="outside");let h=p.MxCpp.getCurrentMxCAD();e.forEach(o=>Gt(this,null,function*(){let m=yield o.getMcDbEntity(),y=m,x=[];if(u==="inside"){for(let A=0;A<r;A++){let T=y.getPointAtDist(y.getLength().val/r*A);T.ret&&x.push(T.val)}let M=new p.McDbPolyline;x.forEach(A=>{M.addVertexAt(A)}),M.isClosed=!0,h.drawEntity(M)}else if(u==="outside"){let M=90-360/(r*2),A=Math.sin(M*Math.PI/180),T=y.radius/A,P=new p.McDbCircle;P.center=y.center,P.radius=T;let D=[];for(let z=0;z<r;z++){let O=P.getPointAtDist(P.getLength().val/r*z);O.ret&&D.push(O.val)}let k=new p.McDbPolyline;D.forEach(z=>{k.addVertexAt(z)}),k.isClosed=!0,h.drawEntity(k)}m.erase()}))})}function mz(){return Gt(this,null,function*(){let t=yield p.MxCADUtility.userSelect(G("选择要修改颜色的对象"));if(t.length==0)return;const e=new p.MxCADUiPrInt;e.setMessage(`${G("输入颜色索引")}(0~256)`);let n=(yield e.go())||20,r=new p.McCmColor;r.setColorIndex(n),t.forEach(s=>Gt(this,null,function*(){let u=s.getMcDbEntity();u.trueColor=r}))})}function gz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("ARC");let e=yield p.MxCADUtility.userSelect(G("选择圆弧对象"),t);e.length!=0&&e.forEach(n=>Gt(this,null,function*(){let r=yield n.getMcDbEntity();if(!r)return;let s=r.clone(),u=s.getLength(),h=s.getStartPoint().val,o=p.MxCpp.getCurrentMxCAD(),m=new p.McDbCircle;m.center=s.center,m.radius=s.radius;let y=m.getDistAtPoint(h),x=m.getPointAtDist(u.val+y.val).val,M=s.getFirstDeriv(h);if(!M.ret)return;let A=h.clone();A.addvec(M.val);let T=s.getFirstDeriv(x);if(!T.ret)return;let P=x.clone();P.addvec(T.val);let D=new p.McDbLine;D.startPoint=h,D.endPoint=A;let k=new p.McDbLine;k.startPoint=x,k.endPoint=P;let z=D.IntersectWith(k,p.McDb.Intersect.kExtendBoth);if(z.length()===0)return;let O=z.at(0);D.endPoint=O,k.endPoint=O,o.drawEntity(D),o.drawEntity(k)}))})}function yz(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();const e=new p.MxCADUiPrKeyWord;e.setMessage(G(" 输入选项")),e.setKeyWords(`[${G("隐藏")}(A)/${G("隐藏未选")}(B)/${G("全部显示")}(C)]`);const n=yield e.go();if(n){if(n==="A"||n==="B"){let r=yield p.MxCADUtility.userSelect(G("选择目标的对象"));if(r.length==0)return;let s=[];if(r.forEach(u=>s.push(u.id)),n==="A")r.forEach(u=>Gt(this,null,function*(){let h=yield u.getMcDbEntity();h&&(h.visible=!1)}));else if(n==="B"){let u=new p.MxCADSelectionSet;u.allSelect(),u.forEach(h=>Gt(this,null,function*(){if(!s.includes(h.id)){let o=yield h.getMcDbEntity();o&&(o.visible=!1)}}))}}else if(n==="C"){let r=new p.MxCADSelectionSet;r.allSelect(),r.forEach(s=>Gt(this,null,function*(){let u=yield s.getMcDbEntity();u&&u.visible===!1&&(u.visible=!0)}))}else return;t.updateDisplay()}})}function xz(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;let e=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();t.setMessage(G(" 指定删除方框第一点:"));let n=yield t.go();if(!n)return;let r=p.MxCpp.getCurrentMxCAD(),s=new $.MxDbRect;s.pt1=n.toVector3(),t.setUserDraw((x,M)=>{s.pt2=x.toVector3(),s.setColor(e),M.drawCustomEntity(s)}),t.setMessage(G(" 指定删除方框第二点:")),t.setDynamicInputType($.DynamicInputType.kXYCoordInput);let u=yield t.go();if(!u)return;s.pt2=u.toVector3();let h=new p.McDbPolyline;h.addVertexAt(n),h.addVertexAt(new p.McGePoint3d(n.x,u.y)),h.addVertexAt(u),h.addVertexAt(new p.McGePoint3d(u.x,n.y)),h.isClosed=!0;let o=r.drawEntity(h);const m=new p.MxCADSelectionSet;for(m.crossingSelect(n.x,n.y,u.x,u.y),m.getIds().forEach(x=>{if(x&&x.id!==o.id){let M=x.getMcDbEntity(),A=M.IntersectWith(h,p.McDb.Intersect.kOnBothOperands);if(A.length()===0)x.erase();else{let T=[];A.forEach(P=>T.push(P)),M.splitCurves(T).forEach(P=>{r.drawEntity(P)}),x.erase()}}});;){const x=new p.MxCADUiPrPoint;x.setMessage(G(" 选择需要精确删除的实体"));const M=yield x.go();if(!M)break;let A=p.MxCADUtility.findEntAtPoint(M.x,M.y,M.z,-1);r.addCurrentSelect(A)}p.MxCADUtility.getCurrentSelect().forEach(x=>{x.erase()}),r.mxdraw.clearMxCurrentSelect()})}function vz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrEntity;e.setMessage(G(" 请选择角度复制对象"));const n=yield e.go();if(n===null)return;const r=yield n.getMcDbEntity(),s=new p.MxCADUiPrInt;s.setMessage(G(" 请输入角度复制数量"));const u=(yield s.go())||1,h=new p.MxCADUiPrPoint;h.setMessage(G(" 请输入角度复制的基点"));const o=yield h.go();if(!o)return;const m=new p.MxCADUiPrAngle;if(m.setMessage(G(" 请输入复制角度")),m.setBasePt(o),m.setUserDraw((M,A)=>{const T=M.sub(o).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis);for(let P=1;P<u+1;P++){let D=r.clone();D.rotate(o,T*P),A.drawMcDbEntity(D)}}),!(yield m.go()))return;const x=m.value();for(let M=1;M<u+1;M++){let A=r.clone();A.rotate(o,x*M),t.drawEntity(A)}})}function _z(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LWPOLYLINE");let e=yield p.MxCADUtility.userSelect(G("请选择顶点对象"),t);if(e.length==0)return;let n=yield p.MxCADUtility.userSelect(G("请选择复制对象"));if(n.length==0)return;const r=new p.MxCADUiPrPoint;r.setMessage(G("请确定复制基点"));const s=yield r.go();if(!s)return;const u=p.MxCpp.getCurrentMxCAD();e.forEach(h=>{let o=h.getMcDbEntity();if(!o)return;let m=o.numVerts();for(let y=0;y<m;y++){const x=o.getPointAt(y).val;n.forEach(M=>{const T=M.getMcDbEntity().clone();T.move(s,x),u.drawEntity(T)})}})})}function bz(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("请选择参考曲线"));let e=yield t.go(),n=yield e.getMcDbEntity();if(n===null)return;const r=p.MxCpp.App.getCurrentMxCAD();let s=n.clone(),u=new p.MxCADResbuf;u.AddMcDbEntityTypes("CIRCLE,ARC,LINE,LWPOLYLINE,ELLIPSE");let h=yield p.MxCADUtility.userSelect(G("选择打断对象"),u);if(h.length==0)return;let o=r.mxdraw.viewCoordLong2Cad(.5);h.forEach(m=>Gt(this,null,function*(){if(m.id!==e.id){let y=yield m.getMcDbEntity(),x=y.IntersectWith(s,p.McDb.Intersect.kOnBothOperands);if(x.length()!=0){let M=[];x.forEach(P=>{M.push(P)});let A=[];M.forEach(P=>{let D=y.getClosestPointTo(P,!1);if(!D.ret)return;let k=y.getFirstDeriv(D.val);if(!k.ret)return;k.val.normalize().mult($.MxFun.viewCoordLong2Cad(10));let z=D.val.clone();z.addvec(k.val);let O=D.val.clone();O.subvec(k.val);const U=y.getPointAtDist(0).val,H=y.getPointAtDist(y.getLength().val).val;if(U.distanceTo(D.val)<o||H.distanceTo(D.val)<o){const V=y.getDistAtPoint(z);A.push(D.val),V.ret?A.push(z):A.push(O)}else A.push(z),A.push(O)});let T=y.splitCurves(A);if(T.empty()){y.highlight(!1);return}T.forEach((P,D)=>{D%2==0&&r.drawEntity(P)}),y.erase()}}}))})}function Mz(){return Gt(this,null,function*(){let t=p.MxCpp.App.getCurrentMxCAD(),e=new p.MxCADResbuf;e.AddMcDbEntityTypes("CIRCLE,ARC,LINE,LWPOLYLINE,ELLIPSE");let n=new p.MxCADUiPrEntity;n.setFilter(e),n.setMessage(G("指定偏移对象"));let r=yield n.go();if(!r)return;const s=new p.MxCADUiPrDist;if(s.setMessage(G("请输入偏移距离")),!(yield s.go()))return;const h=s.value();let o=yield r.getMcDbEntity();const m=o.getStartPoint().val,x=o.getFirstDeriv(m).val.rotateBy(p.McGeVector3d.kYAxis.angleTo1(p.McGeVector3d.kXAxis)),M=m.clone().addvec(x),A=m.clone().subvec(x);let T=o.offsetCurves(h,M);if(T.length()===0)return;T.forEach(D=>{t.drawEntity(D)});let P=o.offsetCurves(h,A);P.length()!==0&&P.forEach(D=>{t.drawEntity(D)})})}function wz(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("ARC,LINE,LWPOLYLINE");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("指定伸缩对象(选择直线、多段线、圆弧)"));const n=yield e.go();if(!n)return;const r=p.MxCpp.App.getCurrentMxCAD(),s=n.getMcDbEntity();if(s instanceof p.McDbArc){const u=s.clone(),h=u.center,o=new p.MxCADUiPrPoint;o.setMessage(G("伸缩至")),s.visible=!1,o.setUserDraw((y,x)=>{u.endAngle=y.sub(h).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis),x.drawMcDbEntity(u)});const m=yield o.go();if(s.visible=!0,!m)return;s.endAngle=m.sub(h).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis),r.updateDisplay()}else if(s instanceof p.McDbLine){const u=s.clone(),h=new p.MxCADUiPrPoint;h.setMessage(G("伸缩至")),s.visible=!1;let o;h.setUserDraw((y,x)=>{o=u.getClosestPointTo(y,!0).val,u.endPoint=o,x.drawMcDbEntity(u)});const m=yield h.go();if(s.visible=!0,!m)return;s.endPoint=o,r.updateDisplay()}else if(s instanceof p.McDbPolyline){const u=s.clone(),h=new p.MxCADUiPrPoint;h.setMessage(G("伸缩至")),s.visible=!1;let o;const m=s.numVerts(),y=s.getBulgeAt(m-1),x=s.getWidthsAt(m-1);h.setUserDraw((A,T)=>{o=u.getClosestPointTo(A,!0).val,u.setPointAt(m-1,o),u.setBulgeAt(m-1,y),u.setWidthsAt(m-1,x.val1,x.val2),T.drawMcDbEntity(u)});const M=yield h.go();if(s.visible=!0,!M)return;s.setPointAt(m-1,o),s.setBulgeAt(m-1,y),s.setWidthsAt(m-1,x.val1,x.val2),r.updateDisplay()}})}function Az(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("CIRCLE");let e=yield p.MxCADUtility.userSelect(G("选择对象"),t);if(e.length==0)return;const n=new p.MxCADUiPrDist;n.setMessage(G("请输入圆半径"));const r=e[0].getMcDbEntity();if(n.setBasePt(r.center),n.setUserDraw((h,o)=>{const m=h.distanceTo(r.center);e.forEach(y=>{const M=y.getMcDbEntity().clone();M.radius=m,o.drawMcDbEntity(M)})}),!(yield n.go()))return;const u=n.value();e.forEach(h=>{const o=h.getMcDbEntity();o.radius=u})})}function Ez(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LWPOLYLINE,ARC,LINE,CIRCLE,ELLIPSE");let e=yield p.MxCADUtility.userSelect(G("选择要修改线型比例的对象"),t);if(e.length==0)return;const n=new p.MxCADUiPrString;if(n.setMessage(G("请输入线型比例")),!(yield n.go()))return;const s=Number(n.value());s&&e.forEach(u=>Gt(this,null,function*(){let h=u.getMcDbEntity();h.linetypeScale=s}))})}function Tz(){return Gt(this,null,function*(){const t=p.MxCpp.App.getCurrentMxCAD(),e=new p.MxCADUiPrDist;if(e.setMessage(G("请输入阵列间距")),!(yield e.go()))return;const r=e.value(),s=new p.MxCADResbuf;s.AddMcDbEntityTypes("ARC");const u=new p.MxCADUiPrEntity;u.setFilter(s),u.setMessage(G("请选择圆弧"));const h=yield u.go();if(!h.id)return;const o=h.getMcDbEntity(),m=yield p.MxCADUtility.userSelect(G("选择排列对象"));if(m.length==0)return;const y=new p.MxCADUiPrPoint;y.setMessage(G("指定排列基点"));const x=yield y.go();x&&m.forEach(M=>Gt(this,null,function*(){let A=M.getMcDbEntity(),T=o.getLength().val/r;if(!(T<1))for(let P=0;P<T;P++){let D=A.clone(),k=o.getPointAtDist(P*r);if(!k.ret)return;let z=k.val.sub(x),O=new p.McGeMatrix3d;O.setToTranslation(z),D.transformBy(O);let V=o.getFirstDeriv(k.val).val.rotateBy(p.McGeVector3d.kYAxis.angleTo1(p.McGeVector3d.kXAxis)).negate().angleTo2(p.McGeVector3d.kYAxis,p.McGeVector3d.kNegateZAxis);D.rotate(k.val,V),t.drawEntity(D)}}))})}function Pz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LWPOLYLINE");let e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("选择目标多段线:"),t))||e.count()==0)return;const n=new p.MxCADUiPrDist;n.setMessage(G("请输入圆角半径<5>"));let r=5;(yield n.go())&&(r=n.value());const u=p.MxCpp.getCurrentMxCAD();e.forEach(h=>{const o=h.getMcDbEntity(),m=new p.McDbPolyline;m.trueColor=o.trueColor,m.isClosed=o.isClosed,m.colorIndex=o.colorIndex,m.layerId=o.layerId;const y=o.numVerts(),x=[];for(let M=0;M<y;M++)x.push(o.getPointAt(M).val);o.isClosed===!0&&x.push(x[0],x[1]),x.forEach((M,A)=>{if(A+2>=x.length)return;const T=x[A+1],P=x[A+2],D=new p.McDbLine(T,M),k=new p.McDbLine(T,P),z=M.sub(T).angleTo2(P.sub(T),p.McGeVector3d.kNegateZAxis);let O=r*Math.sin(Math.PI/2-z/2)/Math.sin(z/2);O<0&&(O=-O);const U=D.getPointAtDist(O).val,H=k.getPointAtDist(O).val;D.rotate(U,Math.PI/2),k.rotate(H,Math.PI/2);const V=D.IntersectWith(k,p.McDb.Intersect.kExtendBoth);if(!V.length())return;const W=V.at(0),Z=new p.McDbLine(W,T).getPointAtDist(r).val;let tt=p.MxCADUtility.calcBulge(U,Z,H).val;if(A===0&&o.isClosed===!1){let st=o.getWidthsAt(A);m.addVertexAt(M,0,st.val1,st.val2)}let at;o.isClosed===!0&&A+2===x.length-1?at=o.getWidthsAt(A):at=o.getWidthsAt(A+1),m.addVertexAt(U,tt,at.val1,at.val2),m.addVertexAt(H,0,at.val1,at.val2),A+2===x.length-1&&o.isClosed===!1&&m.addVertexAt(P,0,at.val1,at.val2)}),o.erase(),u.drawEntity(m)})})}function Sz(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LWPOLYLINE");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择线对象")),e.setFilter(t);const n=yield e.go();if(console.log(n),!n.id)return;const r=n.getMcDbEntity(),s=r.numVerts(),u=new p.McDbPolyline;for(let o=s-1;o>=0;o--){const m=r.getPointAt(o).val;if(o>0){const y=r.getWidthsAt(o-1),x=r.getBulgeAt(o-1);u.addVertexAt(m,-x,y.val2,y.val1)}else{const y=r.getWidthsAt(o),x=r.getBulgeAt(o);u.addVertexAt(m,-x,y.val2,y.val2)}}const h=p.MxCpp.getCurrentMxCAD();u.isClosed=r.isClosed,h.drawEntity(u),r.erase()})}function Cz(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;t.allSelect(new p.MxCADResbuf([p.DxfCode.kEntityType,"LINE"])),console.log("得到对象数目:"+t.count()),t.forEach(e=>{e.getMcDbEntity().highlight(!0)}),p.MxCpp.getCurrentMxCAD().updateDisplay()})}function Dz(){return Gt(this,null,function*(){const t=new p.MxCADUiPrKeyWord;t.setMessage(G("选择等分模式")),t.setKeyWords(`[${G("定距等分")}(ME)/${G("定数等分")}(DIV)/${G("偏移等分")}(O)/${G("复制等分")}(CO)]`);let e=yield t.go();if(!e)return;const n=new p.MxCADResbuf;n.AddMcDbEntityTypes("LINE");const r=new p.MxCADUiPrEntity;r.setFilter(n),e==="O"?r.setMessage(G("请选择偏移等分对象")):e==="CO"?r.setMessage(G("请选择复制等分对象")):r.setMessage(G("请选择需要等分的线段"));const s=yield r.go();if(!s.id)return;const u=s.getMcDbEntity(),h=u.getLength().val,o=p.MxCpp.getCurrentMxCAD();if(e==="ME"){const m=new p.MxCADUiPrDist;if(m.setMessage(G("请设置等分距离")),!(yield m.go()))return;const x=m.value(),M=h/x;for(let A=1;A<M;A++){const T=u.getPointAtDist(A*x).val,P=new op;P.setCenter(T),o.drawEntity(P)}}else if(e==="DIV"){const m=new p.MxCADUiPrInt;if(m.setMessage(G("请设置等分的数量")),!(yield m.go()))return;const x=m.value(),M=h/x;for(let A=1;A<x;A++){const T=u.getPointAtDist(A*M).val,P=new op;P.setCenter(T),o.drawEntity(P)}}else if(e==="O"){const m=new p.MxCADUiPrDist;if(m.setMessage(G("请设置偏移距离")),!(yield m.go()))return;const x=m.value();let M=1;for(;;){const A=new p.MxCADUiPrPoint;A.setMessage(G("请指定偏移点")),A.setUserDraw((P,D)=>{u.offsetCurves(x*M,P).forEach(k=>{D.drawMcDbEntity(k)})});const T=yield A.go();if(!T)return;u.offsetCurves(x*M,T).forEach(P=>{o.drawEntity(P),M++})}}else if(e==="CO"){const m=new p.MxCADUiPrPoint;m.setMessage(G("请指定复制基点"));const y=yield m.go();if(!y)return;const x=new p.MxCADUiPrInt;if(x.setMessage(G("请指定复制等分数量")),!(yield x.go()))return;const A=x.value(),T=new p.MxCADUiPrPoint;T.setMessage(G("请指定复制等分端点")),T.setUserDraw((z,O)=>{const U=new p.McDbLine(y,z);O.drawMcDbEntity(U);const H=U.getLength().val/A;for(let V=1;V<A+1;V++){const W=u.clone();W.move(y,U.getPointAtDist(H*V).val),O.drawMcDbEntity(W)}});const P=yield T.go();if(!P)return;const D=new p.McDbLine(y,P),k=D.getLength().val/A;for(let z=1;z<A+1;z++){const O=u.clone();O.move(y,D.getPointAtDist(k*z).val),o.drawEntity(O)}}})}function Rz(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;if(!(yield t.userSelect(G("请选择需要矩形缩放的实体:")))||t.count()==0)return;let e=p.MxCpp.getCurrentMxCAD(),r=e.getDatabase().getBlockTable().add(new p.McDbBlockTableRecord),s=r.getMcDbBlockTableRecord();if(s==null)return;t.forEach(O=>{const U=O.getMcDbEntity();if(!U)return;const H=U.clone();s.appendAcDbEntity(H)});let u=new p.McDbBlockReference;u.blockTableRecordId=r;const{ret:h,maxPt:o,minPt:m}=u.getBoundingBox();if(!h)return;const y=new p.McDbLine(m,o),x=y.getLength().val;s.origin=y.getPointAtDist(x/2).val;const M=new p.MxCADUiPrPoint;M.setMessage(G("请指定矩形的角点1"));const A=yield M.go();if(!A)return;const T=new p.MxCADUiPrPoint;T.setMessage(G("请指定矩形角点2")),T.setUserDraw((O,U)=>{let H=new p.McDbPolyline;H.addVertexAt(A),H.addVertexAt(new p.McGePoint3d(A.x,O.y)),H.addVertexAt(O),H.addVertexAt(new p.McGePoint3d(O.x,A.y)),H.isClosed=!0,U.drawMcDbEntity(H)});const P=yield T.go();if(!P)return;const D=Math.abs(A.x-P.x)/Math.abs(m.x-o.x),k=Math.abs(A.y-P.y)/Math.abs(m.y-o.y);u.scaleFactors=new p.McGePoint3d(D,k,0);const z=new p.McDbLine(A,P);u.position=z.getPointAtDist(z.getLength().val/2).val,e.drawEntity(u)})}class Tg extends p.McDbCustomEntity{constructor(e){super(e),this.center=new p.McGePoint3d,this.radius=20,this.scale=50,this.position=new p.McGePoint3d,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Tg(e)}getTypeName(){return"McDbTestEnlarge"}set enlargeCenter(e){this.center=e}get enlargeCenter(){return this.center}set enlargeRadius(e){this.radius=e}get enlargeRadius(){return this.radius}set enlargeScale(e){this.scale=e}get enlargeScale(){return this.scale}dwgInFields(e){return this.center=e.readPoint("center").val,this.position=e.readPoint("position").val,this.radius=e.readDouble("radius").val,this.scale=e.readDouble("scale").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("center",this.center),e.writePoint("position",this.position),e.writeDouble("radius",this.radius),e.writeDouble("scale",this.scale),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e==0?(this.center.x+=n,this.center.y+=r,this.center.z+=s):e==1&&(this.position.x+=n,this.position.y+=r,this.position.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.center),e.append(this.position),e}worldDraw(e){const n=[],r=new p.McDbCircle;r.center=this.center,r.radius=this.radius,e.drawEntity(r),n.push(r);const{minPt:s,maxPt:u,ret:h}=r.getBoundingBox();if(!h)return;let o=new p.MxCADSelectionSet;o.crossingSelect(s.x,s.y,u.x,u.y);const m=p.MxCpp.getCurrentMxCAD();let y=m.getDatabase().getBlockTable(),x=new p.McDbBlockTableRecord,M=y.add(x),A=M.getMcDbBlockTableRecord();if(A==null)return;o.forEach(K=>{let Z=K.getMcDbEntity();if(!Z)return;let tt=Z.clone();A.appendAcDbEntity(tt)}),A.origin=new p.McGePoint3d(this.center.x,this.center.y,0);let T=new p.McDbBlockReference;T.blockTableRecordId=M,T.position=this.position;const P=m.drawEntity(T);T=P.getMcDbEntity();let D=r.getSamplePoints(this.radius*1e-5),k=new p.McGePoint3dArray;D.forEach((K,Z,tt)=>{if(tt===1010){const at=new p.McGePoint3d(K.x,K.y,K.z);k.append(at)}}),T.createSpatialFilter(),T.setScale(this.scale),T.getSpatialFilterId().getMcDbObject().setBoundary(k),e.drawEntity(T),n.push(T),P.erase();const U=this.position.sub(this.center).normalize(),H=this.center.clone().addvec(U.mult(this.radius)),V=this.position.clone().subvec(U.mult(this.scale)),W=new p.McDbLine(H,V);e.drawEntity(W),n.push(W),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setPosition(e){this.assertWrite(),this.position=e.clone()}getPosition(){return this.position}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function Lz(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请选择放大中心点"));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrDist;if(n.setMessage(G("请选择放大范围")),n.setBasePt(e),n.setUserDraw((T,P)=>{const D=e.distanceTo(T),k=new p.McDbCircle(e.x,e.y,e.z,D);P.drawMcDbEntity(k)}),!(yield n.go()))return;const s=n.value(),u=p.MxCpp.getCurrentMxCAD(),h=new p.McDbCircle(e.x,e.y,e.z,s),o=new p.MxCADUiPrDist;if(o.setMessage(G("请设置放大倍数")),o.setBasePt(e),o.setUserDraw((T,P)=>{const D=e.distanceTo(T),k=new p.McDbCircle(e.x,e.y,e.z,D);P.drawMcDbEntity(k),P.drawMcDbEntity(h)}),!(yield o.go()))return;const y=o.value(),x=new p.MxCADUiPrPoint;x.setMessage(G("请选择放大插入点")),x.setUserDraw((T,P)=>{const D=new p.McDbCircle(T.x,T.y,T.z,y);P.drawMcDbEntity(D),P.drawMcDbEntity(h)});const M=yield x.go();if(!M)return;const A=new Tg;A.enlargeCenter=e,A.enlargeRadius=s,A.enlargeScale=y/s,A.setPosition(M),u.drawEntity(A)})}function Iz(){return Gt(this,null,function*(){const t=new p.MxCADUiPrEntity;t.setMessage(G("请选择一条需要打断的曲线"));const e=new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE,LINE,ARC,CIRCLE,ELLIPSE"]);t.setFilter(e);const n=yield t.go();if(!n.id)return;const r=n.getMcDbEntity();r.highlight(!0);const s=new p.MxCADUiPrPoint;s.setMessage(G("请在曲线上选取打断点"));const u=[],h=$.MxFun.screenCoordLong2Doc(5);for(;;){s.setUserDraw((y,x)=>{u.length>0&&u.forEach(M=>{const A=new p.McDbCircle;A.center=M,A.radius=h,x.drawMcDbEntity(A)}),x.drawCircle(new THREE.Vector3(y.x,y.y),h)});const m=yield s.go();if(!m)break;u.push(m)}const o=p.MxCpp.getCurrentMxCAD();u.length!==0&&(r.splitCurves(u).forEach(m=>{o.drawEntity(m)}),r.highlight(!1),n.erase(),o.updateDisplay())})}function kz(){return Gt(this,null,function*(){const t=new p.MxCADUiPrInt;t.setMessage(`${G("请输入阵列数量")}<5>`);let e=yield t.go();e||(e=5);const n=new p.MxCADUiPrKeyWord;n.setMessage(`${G("是否开启旋转")}？<N>`),n.setKeyWords(`[${G("是")}(Y)/${G("否")}(N)]`);let r=yield n.go();r||(r="N");const s=new p.MxCADSelectionSet;if(!(yield s.userSelect(G("请选择需要阵列的图形:")))||s.count()==0)return;let u=null,h=null;s.forEach(A=>{const T=A.getMcDbEntity();if(!T)return;const{minPt:P,maxPt:D,ret:k}=T.getBoundingBox();u||(u=P.clone()),h||(h=D.clone()),console.log(u,h),P.x<u.x&&(u.x=P.x),P.y<u.y&&(u.y=P.y),D.x>h.x&&(h.x=D.x),D.y>h.y&&(h.y=D.y)});const o=new p.McDbLine(u,h),m=o.getPointAtDist(o.getLength().val/2).val,y=new p.MxCADUiPrPoint;y.setMessage(G("请选择阵列中心点"));let x=[];y.setUserDraw((A,T)=>{x.length=0;const P=A.distanceTo(m),D=new p.McDbCircle(A.x,A.y,A.z,P);T.drawMcDbEntity(D);const k=D.getLength().val,z=D.getDistAtPoint(m).val,O=k/e;for(let U=1;U<e;U++){const H=D.getPointAtDist(U*O+z).val,W=D.getFirstDeriv(H).val.angleTo2(p.McGeVector3d.kXAxis);s.forEach(K=>{const Z=K.getMcDbEntity();if(!Z)return;const tt=Z.clone();r==="Y"&&tt.rotate(m,W),tt.move(m,H),T.drawMcDbEntity(tt),x.push(tt)})}}),(yield y.go())&&x.forEach(A=>{p.MxCpp.getCurrentMxCAD().drawEntity(A)})})}function Bz(t,e,n){if(!Array.isArray(t))throw new Error("第一个参数必须是数组");if(!Array.isArray(e)||e.length!==2)throw new Error("第二个参数必须是一个包含两个元素的数组");function r(s,u){let h=0,o=s.length-1;for(;h<=o;){const m=Math.floor((h+o)/2),y=n.getDistAtPoint(s[m]).val,x=n.getDistAtPoint(u).val;y<x?h=m+1:o=m-1}return h}for(const s of e){const u=r(t,s);t.splice(u,0,s)}return t=lp(t),{array:t}}function Fz(){return Gt(this,null,function*(){const t=new p.MxCADUiPrEntity;t.setMessage("请选择一条PL线");const e=new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE"]);t.setFilter(e);const n=yield t.go();if(!n.id)return;const r=n.getMcDbEntity();if(!r.isClosed)return $.MxFun.acutPrintf(G("请选择闭合多边形！"));const s=[],u=r.numVerts();for(let k=0;k<u;k++)s.push(r.getPointAt(k).val);const h=new p.MxCADUiPrPoint;h.setMessage(G("请选择第一个点"));const o=yield h.go();if(!o)return;const m=r.getClosestPointTo(o,!1).val,y=new p.MxCADUiPrPoint;y.setMessage(G("请选择第二个点")),y.setUserDraw((k,z)=>{z.drawMcDbEntity(new p.McDbLine(o,k))});const x=yield y.go();if(!x)return;const M=r.getClosestPointTo(x,!1).val,A=Bz(s,[m,M],r),T=[];A.array.forEach((k,z)=>{k.distanceTo(m)<1e-4&&T.push(z),k.distanceTo(M)<1e-4&&T.push(z)}),T.sort((k,z)=>k-z);const P=A.array.slice(T[0],T[1]+1),D=A.array.slice(0,T[0]+1).concat(A.array.slice(T[1]));Kw([P,D]),n.erase()})}const Kw=t=>{t.forEach(e=>{const n=new p.McDbPolyline;e.forEach(r=>n.addVertexAt(r)),n.isClosed=!0,p.MxCpp.getCurrentMxCAD().drawEntity(Gz(n))})};function zz(){return Gt(this,null,function*(){new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE"]);const t=new p.MxCADUiPrEntity;t.setMessage(G("请选择第一个闭合多边形"));const e=yield t.go();if(!e.id)return;const n=e.getMcDbEntity().clone();t.setMessage(G("请选择第二个闭合多边形"));const r=yield t.go();if(!r.id)return;const s=r.getMcDbEntity().clone();if(!n.isClosed||!s.isClosed)return $.MxFun.acutPrintf(G("请选择两个闭合多边形"));const u=p.MxCpp.getCurrentMxCAD(),h=n.IntersectWith(s,p.McDb.Intersect.kOnBothOperands);if(h.length()<2)return $.MxFun.acutPrintf(G("两个多边形没有重合边！"));const o=[n,s];let m=[],y=[];o.forEach((M,A)=>{const T=[],P=M.numVerts();for(let k=0;k<P;k++){const z=M.getPointAt(k).val;T.push({point:z,dist:M.getDistAtPoint(z).val})}const D=Uz(T,M,h);A===0?m.push(...D):y.push(...D)});let x=[];m[0].distanceTo(y[0])<1e-5?x.push(...m,...y.reverse()):x.push(...m,...y),x=lp(x),Kw([x]),e.erase(),r.erase(),u.updateDisplay()})}function lp(t){const e=[];return t.forEach((n,r)=>{t.filter((u,h)=>h>r&&n.distanceTo(u)<1e-5).length||e.push(n)}),e}function Nz(t){function e(u){for(let h=1;h<u.length;h++)if(u[h]-u[h-1]!==1)return!1;return!0}const n=[...new Set(t)].sort((u,h)=>u-h);if(e(n))return n.reverse();const r=[];let s=[n[0]];for(let u=1;u<n.length;u++)n[u]-n[u-1]===1?s.push(n[u]):(r.push(s),s=[n[u]]);return s.length&&r.push(s),r.forEach(u=>u.sort((h,o)=>o-h)),r.sort((u,h)=>u[u.length-1]-h[h.length-1]),r.flat()}function Uz(t,e,n){let r=[];for(let x=0;x<n.length();x++)r.push(n.at(x));r=lp(r);const s=lp([...t.map(x=>x.point),...r]);s.sort((x,M)=>e.getDistAtPoint(x).val-e.getDistAtPoint(M).val);let u=[];s.forEach((x,M)=>{r.includes(x)&&u.push(M)});const h=new p.McDbPolyline;u=Nz(u);for(let x=0;x<u.length;x++){const M=s[u[x]];h.addVertexAt(M)}const o=t.filter(x=>h.getClosestPointTo(x.point,!1).val.distanceTo(x.point)>1e-5),m=[h.getPointAt(0).val,h.getPointAt(u.length-1).val];return m.forEach(x=>{const M=o.map(D=>D.dist),A=e.getDistAtPoint(x).val;let T=0,P=M.length-1;for(;T<=P;){const D=Math.floor((T+P)/2);M[D]<A?T=D+1:P=D-1}o.splice(T,0,{point:x,dist:A})}),Vz(o.map(x=>x.point),m[0],m[1])}function Zw(t,e){let n=0,r=1/0;for(let s=0;s<t.length;s++){const u=t[s],h=e.distanceTo(u);h<r&&(r=h,n=s)}return n}function Vz(t,e,n){if(!Array.isArray(t)||t.length<2)throw new Error("至少需要两个点");const r=Zw(t,e),s=Zw(t,n),u=t.length,h=[...t,...t],o=[];let m=r;for(;o.push(h[m]),!(m===s||(m=(m+1)%u,m===r)););return o}function Gz(t){const e=t.numVerts(),n=[];for(let y=0;y<e;y++){const x=t.getPointAt(y).val;n.push(x)}const r=[...n];r.push(t.getPointAt(0).val);const s=[];let u=null;r.forEach((y,x)=>{let M=new p.McGeVector3d;if(x<r.length-1?M=r[x+1].sub(y):M=r[1].sub(y),u){const A=u.angleTo2(p.McGeVector3d.kXAxis),T=M.angleTo2(p.McGeVector3d.kXAxis);Math.abs(A-T)<1e-4&&s.push(x)}u=M.clone()});const h=s.findIndex(y=>y===r.length-1);h>0&&(s[h]=0);const o=s.length>0?n.filter((y,x)=>!s.includes(x)):n,m=new p.McDbPolyline;return o.forEach(y=>{m.addVertexAt(y)}),m.isClosed=!0,m}function Jw(t,e){const n=[];for(let u=0;u<t.numVerts();u++){const h=t.getDistAtPoint(t.getPointAt(u).val).val;n.push(h)}let r=0,s=n.length-1;for(;r<=s;){const u=Math.floor((r+s)/2);n[u]===e||n[u]<e?r=u+1:s=u-1}return n.splice(r,0,e),{index:r,newArray:n}}function Oz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE"]),n=new p.MxCADUiPrEntity;n.setMessage(G("请选择目标多边形")),n.setFilter(e);const r=yield n.go();if(!r)return;const s=r.getMcDbEntity(),u=new p.MxCADUiPrPoint;u.setMessage(G("请选择多边形需要添加顶点的边"));const h=yield u.go();if(!h)return;const o=s.getClosestPointTo(h,!1);if(!o.ret)return;const m=s.getDistAtPoint(o.val).val,{index:y}=Jw(s,m),{val2:x}=s.getWidthsAt(y),{val1:M}=s.getWidthsAt(y+1===s.numVerts()?0:y+1),A=new p.MxCADUiPrPoint;A.setMessage(G("请设置添加的顶点位置")),A.setUserDraw((P,D)=>{const k=s.clone();k.addVertexAt(P,0,x,M,y),D.drawMcDbEntity(k)});const T=yield A.go();T&&(s.addVertexAt(T,0,x,M,y),t.updateDisplay())})}function jz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE"]),n=new p.MxCADUiPrEntity;n.setMessage(G("请选择目标多边形")),n.setFilter(e);const r=yield n.go();if(!r)return;const s=r.getMcDbEntity(),u=new p.MxCADUiPrPoint;u.setMessage(G("请选择多边形需要删除的顶点"));const h=yield u.go();if(!h)return;const o=s.getClosestPointTo(h,!1);if(!o.ret)return;const m=s.numVerts(),y=[];for(let M=0;M<m;M++){const A=o.val.distanceTo(s.getPointAt(M).val);y.push({index:M,dist:A})}y.sort((M,A)=>M.dist-A.dist);const x=y[0].index;s.removeVertexAt(x),t.updateDisplay()})}function Hz(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE"]),n=new p.MxCADUiPrEntity;n.setMessage(G("请选择目标多边形")),n.setFilter(e);const r=yield n.go();if(!r)return;const s=r.getMcDbEntity(),u=new p.MxCADUiPrPoint;u.setMessage(G("请选择多边形需要拉伸的边"));const h=yield u.go();if(!h)return;const o=s.getClosestPointTo(h,!1);if(!o.ret)return;const m=s.getDistAtPoint(o.val).val;let{index:y}=Jw(s,m);y===s.numVerts()&&(y=0);const x=y-1<0?s.numVerts()-1:y-1,M=s.getPointAt(y).val,A=s.getPointAt(x).val,T=M.clone().addvec(A.sub(M).mult(1/2)),P=new p.MxCADUiPrPoint;P.setMessage(G("请指定拉伸位置")),P.setUserDraw((z,O)=>{const U=s.clone(),H=z.sub(T);U.setPointAt(y,M.clone().addvec(H)),U.setPointAt(x,A.clone().addvec(H)),O.drawMcDbEntity(U)});const k=(yield P.go()).sub(T);s.setPointAt(y,M.clone().addvec(k)),s.setPointAt(x,A.clone().addvec(k)),t.updateDisplay()})}function Wz(){new Tg().rxInit(),$.MxFun.addCommand("Mx_Multicopy",hz),$.MxFun.addCommand("Mx_ArcToCircle",dz),$.MxFun.addCommand("Mx_CopyRotation",pz),$.MxFun.addCommand("Mx_CricleTotoll",fz),$.MxFun.addCommand("Mx_ChangeColor",mz),$.MxFun.addCommand("Mx_ArcToAngle",gz),$.MxFun.addCommand("Mx_TemHiding",yz),$.MxFun.addCommand("Mx_BoxDel",xz),$.MxFun.addCommand("Mx_AngleCopy",vz),$.MxFun.addCommand("Mx_VertexRep",_z),$.MxFun.addCommand("Mx_IntersectBreak",bz),$.MxFun.addCommand("Mx_DoubleOff",Mz),$.MxFun.addCommand("Mx_Telescoping",wz),$.MxFun.addCommand("Mx_EitCircle",Az),$.MxFun.addCommand("Mx_LayerTypeScale",Ez),$.MxFun.addCommand("Mx_ArcOrder",Tz),$.MxFun.addCommand("Mx_PlRoundCorners",Pz),$.MxFun.addCommand("Mx_PlReverse",Sz),$.MxFun.addCommand("Mx_TestGetAllLineByLayer",Cz),$.MxFun.addCommand("Mx_Bisection",Dz),$.MxFun.addCommand("Mx_RectangularScaling",Rz),$.MxFun.addCommand("Mx_Enlarge",Lz),$.MxFun.addCommand("Mx_Interrupt",Iz),$.MxFun.addCommand("Mx_PolarArray",kz),$.MxFun.addCommand("Mx_PolygonClipping",Fz),$.MxFun.addCommand("Mx_MergePolygons",zz),MxPluginContext.addCommand("Mx_AddVertex",Oz),MxPluginContext.addCommand("Mx_DeleteVertex",jz),MxPluginContext.addCommand("Mx_StretchPolygon",Hz)}function qz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LINE");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择目标对齐线对象(选择直线)")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity(),s=new p.MxCADUiPrEntity;let u=new p.MxCADResbuf;u.AddMcDbEntityTypes("TEXT"),s.setMessage(G("请选择目标文字对象")),s.setFilter(u);const h=yield s.go();if(!h.id)return;const o=h.getMcDbEntity();let y=r.getFirstDeriv(r.getStartPoint().val).val.angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis),x=o.rotation;o.rotate(o.position,y-x),p.MxCpp.App.getCurrentMxCAD().updateDisplay()})}function Yz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT, MTEXT");const e=yield p.MxCADUtility.userSelect(G("选择文字对象"),t);if(e.length==0)return;const n=new p.MxCADUiPrString;n.setMessage(G("请设置字高"));const r=yield n.go();!r||!Number(r)||(e.forEach(s=>{const u=s.getMcDbEntity();u.height=Number(r)}),p.MxCpp.getCurrentMxCAD().updateDisplay())})}function Xz(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT, MTEXT");const e=yield p.MxCADUtility.userSelect(G("选择文字对象"),t);if(e.length==0)return;const n=new p.MxCADUiPrString;n.setMessage(G("请设置字宽"));const r=yield n.go();!r||!Number(r)||(e.forEach(s=>{const u=s.getMcDbEntity();u.widthFactor=Number(r)}),p.MxCpp.getCurrentMxCAD().updateDisplay())})}function Kz(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择源文字")),e.setFilter(t);const n=yield e.go();if(!(n!=null&&n.id))return;const r=n.getMcDbEntity();let s=yield p.MxCADUtility.userSelect(G("请选择目标文字"),t);if(s.length==0)return;const u=p.MxCpp.App.getCurrentMxCAD();s.forEach(h=>{let o=h.getMcDbEntity();o.textString=r.textString}),u.updateDisplay()})}function Zz(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("请选择第一个文字"));const n=yield e.go();if(!(n!=null&&n.id))return;const r=n.getMcDbEntity(),s=p.MxCpp.App.getCurrentMxCAD(),u=new p.MxCADUiPrEntity;u.setFilter(t),u.setMessage(G("请选择第二个文字"));const h=yield u.go();if(!(h!=null&&h.id))return;const o=h.getMcDbEntity();let m=r.textString,y=o.textString,x=r.clone(),M=o.clone();x.textString=y,M.textString=m,s.drawEntity(x),s.drawEntity(M),n.erase(),h.erase()})}function Jz(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择需要对齐的文字"),t);if(e.length==0)return;const n=new p.MxCADUiPrKeyWord;n.setMessage(G("请选择对齐方式")),n.setKeyWords(`[${G("左")}(L)/${G("中")}(M)/${G("右")}(R)]`);const r=yield n.go();if(!r)return;const s=new p.MxCADUiPrPoint;s.setMessage(G("请选择对齐基点"));const u=yield s.go();if(!u)return;const h=p.MxCpp.getCurrentMxCAD();r==="L"?e.forEach(o=>{const m=o.getMcDbEntity(),y=m.clone(),x=m.alignmentPoint,M=m.position;y.horizontalMode=p.McDb.TextHorzMode.kTextLeft,y.alignmentPoint=new p.McGePoint3d(u.x,x.y),y.position=new p.McGePoint3d(u.x,M.y),h.drawEntity(y),o.erase()}):r==="R"?e.forEach(o=>{const m=o.getMcDbEntity(),y=m.clone(),x=m.alignmentPoint,M=m.position;y.horizontalMode=p.McDb.TextHorzMode.kTextRight,y.alignmentPoint=new p.McGePoint3d(u.x,x.y),y.position=new p.McGePoint3d(u.x,M.y),h.drawEntity(y),o.erase()}):r==="M"&&e.forEach(o=>{const m=o.getMcDbEntity(),y=m.clone(),x=m.alignmentPoint,M=m.position;y.horizontalMode=p.McDb.TextHorzMode.kTextCenter,y.alignmentPoint=new p.McGePoint3d(u.x,x.y),y.position=new p.McGePoint3d(u.x,M.y),h.drawEntity(y),o.erase()})})}function Qz(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择需要对齐的文字"),t);if(e.length==0)return;const n=new p.MxCADUiPrPoint;n.setMessage(G("请选择对齐基点"));const r=yield n.go();r&&(e.forEach(s=>{const u=s.getMcDbEntity(),h=u.position;u.alignmentPoint=u.position=new p.McGePoint3d(h.x,r.y)}),p.MxCpp.getCurrentMxCAD().updateDisplay())})}function $z(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择需要反转的文字"),t);if(e.length==0)return;const n=p.MxCpp.App.getCurrentMxCAD();e.forEach(r=>{const s=r.getMcDbEntity(),u=s.clone();let h=s.getBoundingBox();if(!h.ret)return;const o=h.maxPt,m=h.minPt,y=new p.McDbLine(m,o),x=y.getPointAtDist(y.getLength().val/2).val,M=p.McGeVector3d.kXAxis.angleTo1(new p.McGeVector3d(-1,0,0))+s.rotation;u.rotate(x,M),r.erase(),n.drawEntity(u)})})}function t6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT, MTEXT");let e=yield p.MxCADUtility.userSelect(G("请选择需要去空格的文字"),t);e.length!=0&&e.forEach(n=>{const r=n.getMcDbEntity();let s;r instanceof p.McDbText?(s=r.clone(),s.textString=r.textString.replace(/\s+/g,"")):r instanceof p.McDbMText&&(s=r.clone(),s.contents=r.contents.replace(/\s+/g,"")),n.erase(),p.MxCpp.App.getCurrentMxCAD().drawEntity(s)})})}function e6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT, MTEXT");let e=yield p.MxCADUtility.userSelect(G("请选择文字对象"),t);e.length!=0&&e.forEach(n=>{let s=n.getMcDbEntity().getBoundingBox();if(!s.ret)return;const u=s.maxPt,h=s.minPt,o=new p.McGePoint3d(h.x,u.y),m=new p.McGePoint3d(u.x,h.y),y=h.clone().sub(u).normalize().mult(2),x=o.clone().sub(m).normalize().mult(2),M=new p.McDbPolyline;M.addVertexAt(h.addvec(y)),M.addVertexAt(o.addvec(x)),M.addVertexAt(u.subvec(y)),M.addVertexAt(m.subvec(x)),M.isClosed=!0,p.MxCpp.getCurrentMxCAD().drawEntity(M)})})}function n6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择文字对象"),t);if(e.length==0)return;const n=new p.MxCADUiPrInt;n.setMessage(G("请输入下划线宽度 "));const r=(yield n.go())||0,s=new p.MxCADUiPrDist;s.setMessage(G("请设置下划线距离 "));const u=yield s.go();let h=0;u&&(h=s.value());const o=new p.MxCADUiPrDist;o.setMessage(G("请设置下划线延长距离 "));const m=yield o.go();let y=0;m&&(y=o.value()),e.forEach(x=>{let A=x.getMcDbEntity().getBoundingBox();if(!A.ret)return;const T=A.maxPt,P=A.minPt,D=new p.McDbLine(P.x,P.y,0,T.x,P.y,0),k=new p.McDbLine(T.x,P.y,0,P.x,P.y,0),z=k.getLength().val,O=D.getPointAtDist(z+y).val,U=k.getPointAtDist(z+y).val,H=new p.McDbPolyline;H.addVertexAt(O,0,r,r),H.addVertexAt(U,0,r,r);const V=H.getClosestPointTo(T,!0).val,W=V.clone().sub(T);W.normalize().mult(h);const K=V.clone().addvec(W),Z=new p.McGeMatrix3d;Z.setToTranslation(K.sub(V)),H.transformBy(Z),p.MxCpp.getCurrentMxCAD().drawEntity(H)})})}function i6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择文字对象"),t);e.length!=0&&e.forEach(n=>{let s=n.getMcDbEntity().getBoundingBox();if(!s.ret)return;const u=s.maxPt,h=s.minPt,o=new p.McDbPolyline;o.addVertexAt(h,0,2,2),o.addVertexAt(new p.McGePoint3d(u.x,h.y),0,2,2);const m=new p.McDbPolyline;m.addVertexAt(h),m.addVertexAt(new p.McGePoint3d(u.x,h.y));const y=o.getClosestPointTo(u,!0).val,x=y.clone().sub(u),M=y.clone().sub(u);x.normalize().mult(2),M.normalize().mult(4);const A=y.clone().addvec(x),T=y.clone().addvec(M),P=new p.McGeMatrix3d,D=new p.McGeMatrix3d;P.setToTranslation(A.sub(y)),o.transformBy(P),D.setToTranslation(T.sub(y)),m.transformBy(D),p.MxCpp.getCurrentMxCAD().drawEntity(o),p.MxCpp.getCurrentMxCAD().drawEntity(m)})})}function r6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择文字对象"),t);if(e.length==0)return;const n=new p.MxCADUiPrKeyWord;n.setMessage(G("请选择操作选项 ")),n.setKeyWords(`[${G("大写")}(C)/${G("小写")}(S)/${G("句首大写")}(I)]`);const r=yield n.go();if(!r)return;const s=p.MxCpp.getCurrentMxCAD();r==="C"?e.forEach(u=>{const h=u.getMcDbEntity(),o=h.textString,m=h.clone();m.textString=o.toUpperCase(),console.log(m.textString),h.erase(),s.drawEntity(m)}):r==="S"?e.forEach(u=>{const h=u.getMcDbEntity(),o=h.textString,m=h.clone();m.textString=o.toLowerCase(),console.log(m.textString),h.erase(),s.drawEntity(m)}):r==="I"&&e.forEach(u=>{const h=u.getMcDbEntity(),o=h.textString,m=h.clone();m.textString=o.charAt(0).toUpperCase()+o.slice(1),h.erase(),s.drawEntity(m)})})}function o6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=yield p.MxCADUtility.userSelect(G("请选择数字对象"),t);if(e.length==0)return;let n=[];if(e.forEach(m=>{const y=m.getMcDbEntity(),x=Number(y.textString);isNaN(x)||n.push(x)}),n.length!==e.length)return;let r=n.reduce((m,y)=>m+y,0);const s=new p.MxCADUiPrPoint,u=new p.McDbText;u.textString=r.toString(),u.height=10,s.setMessage(G("请选择文字插入点 ")),s.setUserDraw((m,y)=>{u.position=m,u.alignmentPoint=m,y.drawMcDbEntity(u)});const h=yield s.go();if(!h)return;const o=p.MxCpp.getCurrentMxCAD();u.position=h,u.alignmentPoint=h,o.drawEntity(u)})}function s6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("选择要查找的范围:"),t))||e.count()==0)return;const n=new p.MxCADUiPrKeyWord;n.setMessage(G("请选择查找模式 ")),n.setKeyWords(`[${G("等于")}(A)/${G("包含")}(B)/${G("前缀为")}(C)/${G("后缀为")}(D)]`);const r=yield n.go();if(!r)return;const s=new p.MxCADUiPrString;s.setMessage(G("请输入关键字 "));const u=yield s.go();if(!u)return;const h=p.MxCpp.getCurrentMxCAD();let o=[];e.forEach(m=>{const x=m.getMcDbEntity().textString;r==="A"?x===u&&o.push(m):r==="B"?x.includes(u)&&o.push(m):r==="C"?x.startsWith(u)&&o.push(m):r==="D"&&x.endsWith(u)&&o.push(m)}),o.length>0&&o.forEach(m=>{h.addCurrentSelect(m)})})}function a6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");let e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("选择要操作的范围:"),t))||e.count()==0)return;const n=new p.MxCADUiPrKeyWord;n.setMessage(G("选择操作方式")),n.setKeyWords(`[${G("添加")}(A)/${G("删除")}(D)]`);let r=yield n.go();if(!r)return;const s=new p.MxCADUiPrKeyWord;s.setMessage(G("选择操作位置")),s.setKeyWords(`[${G("前缀")}(P)/${G("后缀")}(S)]`);let u=yield s.go();if(!u)return;const h=new p.MxCADUiPrString;h.setMessage(G("请输入内容"));const o=yield h.go();o&&e.forEach(m=>{const y=m.getMcDbEntity(),x=y.textString;r==="A"?u==="P"?y.textString=o+x:u==="S"&&(y.textString=x+o):r==="D"&&(u==="P"?x.startsWith(o)&&(y.textString=x.slice(o.length)):u==="S"&&x.endsWith(o)&&(y.textString=x.slice(0,-o.length)))})})}function l6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");const e=p.MxCpp.getCurrentMxCAD();for(;;){const u=new p.MxCADUiPrPoint;u.setMessage(G("请选择文本 "));const h=yield u.go();if(!h)break;let o=p.MxCADUtility.findEntAtPoint(h.x,h.y,h.z,-1,t);e.addCurrentSelect(o)}const n=p.MxCADUtility.getCurrentSelect();if(!n.length)return;let r="";n.forEach((u,h)=>{const o=u.getMcDbEntity();r+=o.textString,h!==0&&u.erase()});const s=n.at(0).getMcDbEntity();s.textString=r,e.mxdraw.clearMxCurrentSelect()})}function c6(){return Gt(this,null,function*(){new p.MxCADResbuf().AddMcDbEntityTypes("TEXT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择文本 "));const n=yield e.go();if(!n)return;const r=n.getMcDbEntity(),s=r.textString.split("").join("\\P"),u=new p.McDbMText;u.contents=s,u.textHeight=r.height,u.location=r.position,u.trueColor=r.trueColor,u.colorIndex=r.colorIndex,u.layerId=r.layerId;const h=p.MxCpp.getCurrentMxCAD();n.erase(),h.drawEntity(u)})}function u6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("TEXT");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("请选择文本 "));const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity();r.highlight(!0);const s=new p.MxCADResbuf;s.AddMcDbEntityTypes("ARC");const u=new p.MxCADUiPrEntity;u.setFilter(s),u.setMessage(G("请选择圆弧 "));const h=yield u.go();if(!h.id)return;const o=h.getMcDbEntity();o.highlight(!0);const m=r.textString.split("");m.reverse();const y=o.getLength().val/(m.length-1),x=p.MxCpp.getCurrentMxCAD();for(let M=0;M<m.length;M++){const A=o.getPointAtDist(y*M).val,T=new p.McDbText;T.textString=m[M],T.position=T.alignmentPoint=A,T.horizontalMode=p.McDb.TextHorzMode.kTextMid,T.trueColor=r.trueColor,T.colorIndex=r.colorIndex,T.height=r.height,T.widthFactor=r.widthFactor,T.rotation=r.rotation,x.drawEntity(T)}r.highlight(!1),o.highlight(!1)})}function h6(){return Gt(this,null,function*(){const n=p.MxCpp.getCurrentMxCAD().getDatabase().getTextStyleTable().getAllRecordId();let r="",s=[];n.forEach((m,y)=>{const x=m.getMcDbTextStyleTableRecord();r+=`${x.name}(${y})/`,s.push(m)});const u=new p.MxCADUiPrKeyWord;u.setMessage(G("请选择文字样式")),u.setKeyWords(`[${r}]`);const h=yield u.go(),o=new p.MxCADSelectionSet;o.allSelect(new p.MxCADResbuf([p.DxfCode.kEntityType,"TEXT, MTEXT"])),o.forEach(m=>{let y=m.getMcDbEntity();y.textStyleId=s[Number(h)]}),p.MxCpp.getCurrentMxCAD().updateDisplay()})}function d6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf([p.DxfCode.kEntityType,"MTEXT,TEXT"]),e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("请设置文字提取范围"),t))||e.count()==0)return;let n="";e.forEach(u=>{const h=u.getMcDbEntity(),o=h.objectName;if(o==="McDbText"){const m=h.clone();n+=`${m.textString} `}else if(o==="McDbMText"){const m=h.clone();n+=m.contents.replace("\\P"," ")}});const{isDialogVisible:r,excelText:s}=If();r.value=!0,s.value=n})}function p6(){return Gt(this,null,function*(){Ho.value="NumberTextDialog",_o.showDialog(!0,{title:G("输入编号文字")}).then(n=>Gt(this,[n],function*({data:t,isCanceled:e}){if(!e){let{textContent:r,textNumber:s,numPos:u}=t;const h=new p.McDbText;for(h.height=$.MxFun.docCoordLong2Screen(20);;){let o="";u==="start"&&(o=`${s||""}${r||""}`),u==="end"&&(o=`${r||""}${s||""}`),h.textString=o;const m=new p.MxCADUiPrPoint;m.setMessage("点击左键指定文本标注的位置，右键退出"),m.setDisableOsnap(!0),m.disableAllTrace(!0),m.setDisableDynInput(!0),m.setUserDraw((x,M)=>{h.position=h.alignmentPoint=x,M.drawMcDbEntity(h)});const y=yield m.go();if(!y)break;h.position=h.alignmentPoint=y,p.MxCpp.getCurrentMxCAD().drawEntity(h),s+=1}}}))})}function f6(){$.MxFun.addCommand("Mx_AlignByLine",qz),$.MxFun.addCommand("Mx_TextHeight",Yz),$.MxFun.addCommand("Mx_TextWidth",Xz),$.MxFun.addCommand("Mx_BrushCon",Kz),$.MxFun.addCommand("Mx_ReplaceCon",Zz),$.MxFun.addCommand("Mx_AlignLeft",Jz),$.MxFun.addCommand("Mx_AlignUp",Qz),$.MxFun.addCommand("Mx_TextReversal",$z),$.MxFun.addCommand("Mx_TextTrim",t6),$.MxFun.addCommand("Mx_TextTraming",e6),$.MxFun.addCommand("Mx_Underline",n6),$.MxFun.addCommand("Mx_TitleLine",i6),$.MxFun.addCommand("Mx_Case",r6),$.MxFun.addCommand("Mx_NumSum",o6),$.MxFun.addCommand("Mx_SSWords",s6),$.MxFun.addCommand("Mx_Prefix",a6),$.MxFun.addCommand("Mx_ConnectText",l6),$.MxFun.addCommand("Mx_VerticalText",c6),$.MxFun.addCommand("Mx_AlignByArc",u6),$.MxFun.addCommand("Mx_EditTextStyle",h6),$.MxFun.addCommand("Mx_ExtractText",d6),$.MxFun.addCommand("Mx_NumberText",p6)}function m6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择目标块对象")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=new p.MxCADUiPrString;r.setMessage(G("请输入新块名"));const s=yield r.go();if(!s)return;const u=n.getMcDbEntity().blockTableRecordId.getMcDbBlockTableRecord();console.log("原块名",u.name),u.name=s,console.log("新块名",u.name)})}function g6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("选择需要修改基点的块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity(),s=new p.MxCADUiPrPoint,u=p.MxCpp.getCurrentMxCAD();s.setMessage(G("设置基点"));const h=yield s.go();if(!h)return;let o=r.blockTableRecordId.getMcDbBlockTableRecord(),m=o.origin.clone(),y=r.blockTransform;m.transformBy(y);const x=h.sub(m);y.invert(),h.transformBy(y),o.origin=h,r.position=r.position.addvec(x),u.updateDisplay()})}function Qw(t){t.getAllEntityId().forEach(e=>{let n=e.getMcDbEntity();n.colorIndex=p.ColorIndexType.kByblock,n instanceof p.McDbBlockReference&&Qw(n.blockTableRecordId.getMcDbBlockTableRecord())})}function y6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("选择需要修改颜色的块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity();let s=r.blockTableRecordId.getMcDbBlockTableRecord();Qw(s);const u=new p.MxCADUiPrInt;u.setMessage(G("输入颜色索引(0~256)"));let h=(yield u.go())||0,o=new p.McCmColor;o.setColorIndex(h),r.trueColor=o,p.MxCpp.getCurrentMxCAD().updateDisplay()})}function x6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择源块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity();let s=new p.MxCADSelectionSet;(yield s.userSelect(G("选择要刷的目标块:"),t))&&s.count()!=0&&s.forEach(u=>{const h=u.getMcDbEntity(),o=r.clone();o.position=h.position,u.erase(),p.MxCpp.getCurrentMxCAD().drawEntity(o)})})}function v6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrKeyWord;t.setMessage(G("选择连接方式")),t.setKeyWords(`[${G("手动逐个连线")}(H)/${G("自动批量连线")}(A)]`);const e=yield t.go();if(!e)return;const n=p.MxCpp.getCurrentMxCAD();let r=new p.MxCADResbuf;if(r.AddMcDbEntityTypes("INSERT"),e==="A"){let s=new p.MxCADSelectionSet;if(!(yield s.userSelect(G("选择要刷的目标块:"),r))||s.count()==0)return;const u=new p.McDbPolyline;s.forEach(h=>{const o=h.getMcDbEntity();u.addVertexAt(o.position)}),n.drawEntity(u)}else if(e==="H"){const s=new p.McDbPolyline;for(;;){const u=new p.MxCADUiPrEntity;u.setMessage(G("请选择连线的块")),u.setFilter(r),u.setUserDraw((m,y)=>{const x=s.clone();x.addVertexAt(m),y.drawMcDbEntity(x)});const h=yield u.go();if(!h.id)break;const o=h.getMcDbEntity();s.addVertexAt(o.position)}n.drawEntity(s)}})}function _6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择连线的块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;let s=n.getMcDbEntity().getBoundingBox();const u=new p.McDbPolyline;u.addVertexAt(s.minPt),u.addVertexAt(s.maxPt);const h=u.getPointAtDist(u.getLength().val/2).val,o=new p.MxCADUiPrDist;o.setMessage(G("设置中心线长度")),o.setBasePt(h),o.setUserDraw((T,P)=>{const D=T.distanceTo(h);let k=new p.McDbLine(h.x+D,h.y,h.z,h.x-D,h.y,h.z),z=k.clone();z.rotate(h,Math.PI/2),P.drawMcDbEntity(z),P.drawMcDbEntity(k)});const m=yield o.go();let y=10;m&&(y=o.value());const x=p.MxCpp.App.getCurrentMxCAD();let M=new p.McDbLine(h.x+y,h.y,h.z,h.x-y,h.y,h.z);M.trueColor=new p.McCmColor(255,0,0);let A=M.clone();A.rotate(h,Math.PI/2),x.drawEntity(A),x.drawEntity(M)})}function b6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");let e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("选择要旋转的目标块:"),t))||e.count()==0)return;const n=e.item(0).getMcDbEntity(),r=new p.MxCADUiPrDist;r.setMessage(G("设置旋转角度")),r.setBasePt(n.position);let s=0;r.setUserDraw((o,m)=>{s=o.sub(n.position).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis),e.forEach(y=>{const M=y.getMcDbEntity().clone();M.rotate(M.position,s),m.drawMcDbEntity(M)})});const u=yield r.go();if(!u)return;r.getDetailedResult()===$.DetailedResult.kCoordIn&&(s=u*Math.PI/180),e.forEach(o=>{const m=o.getMcDbEntity();m.rotate(m.position,s)}),p.MxCpp.getCurrentMxCAD().updateDisplay()})}function M6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");let e=new p.MxCADSelectionSet;if(!(yield e.userSelect("选择要旋转的目标块:",t))||e.count()==0)return;const n=new p.MxCADUiPrDist;n.setMessage(G("请设置缩放比例"));let r=e.item(0).getMcDbEntity();if(n.setBasePt(r.position),n.setUserDraw((o,m)=>{const y=o.distanceTo(r.position);e.forEach(x=>{const A=x.getMcDbEntity().clone();let T=new p.McGeMatrix3d;T.setToScaling(y,A.position),A.transformBy(T),m.drawMcDbEntity(A)})}),!(yield n.go()))return;const u=n.value()||1;e.forEach(o=>{const m=o.getMcDbEntity();let y=new p.McGeMatrix3d;y.setToScaling(u,m.position),m.transformBy(y)}),p.MxCpp.getCurrentMxCAD().updateDisplay()})}function w6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择源块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const s=n.getMcDbEntity().rotation;let u=new p.MxCADSelectionSet;if(!(yield u.userSelect("选择要刷的目标块:",t))||u.count()==0)return;u.forEach(o=>{const m=o.getMcDbEntity();m.rotation=s}),p.MxCpp.getCurrentMxCAD().updateDisplay()})}function A6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择源块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const s=n.getMcDbEntity().blockName;let u=new p.MxCADSelectionSet;(yield u.userSelect(G("请设置选择范围:"),t))&&u.count()!=0&&u.forEach(h=>{h.getMcDbEntity().blockName==s&&p.MxCpp.getCurrentMxCAD().addCurrentSelect(h)})})}function E6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择目标块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const s=n.getMcDbEntity().blockName;let u=new p.MxCADSelectionSet;u.allSelect(t),u.count()!=0&&u.forEach(h=>{h.getMcDbEntity().blockName==s&&p.MxCpp.getCurrentMxCAD().addCurrentSelect(h)})})}function T6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择目标块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const s=n.getMcDbEntity().blockName,u=new p.MxCADSelectionSet;if(!(yield u.userSelect(G("请设置统计范围"),t))||u.count()==0)return;let h=0;u.forEach(o=>{o.getMcDbEntity().blockName==s&&(h+=1)}),console.log(`找到块${s}：共${h}个`)})}function P6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADSelectionSet;if(!(yield e.userSelect(G("请设置统计范围"),t))||e.count()==0)return;let n=[];e.forEach(m=>{const x=m.getMcDbEntity().blockName;n.push(x)});let r=[];Array.from(new Set(n)).forEach(m=>{const y=n.filter(x=>x===m).length;r.push({blkName:m,num:y})});let s=new zw;s.data.addColumn("名称",100),s.data.addColumn("数量",30),r.forEach(m=>{s.data.addRow([m.blkName,m.num])});let u=new p.MxCADUiPrPoint;u.setMessage(G("指定表格插入点:"));let h=yield u.go();if(!h)return;let o=$.MxFun.screenCoordLong2Doc(100)/200;s.draw(h,o)})}function S6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择目标块")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity(),s=p.MxCpp.getCurrentMxCAD(),u=s.addLayer("测试图层");r.layerId=u,console.log(r.layer),s.updateDisplay()})}function C6(){$.MxFun.addCommand("Mx_ChangeBN",m6),$.MxFun.addCommand("Mx_BushBlk",x6),$.MxFun.addCommand("Mx_ConBlk",v6),$.MxFun.addCommand("Mx_BlkCenterLine",_6),$.MxFun.addCommand("Mx_BlkPt",g6),$.MxFun.addCommand("Mx_BlkColor",y6),$.MxFun.addCommand("Mx_BlkRotate",b6),$.MxFun.addCommand("Mx_BlkScale",M6),$.MxFun.addCommand("Mx_BlkAngle",w6),$.MxFun.addCommand("Mx_BlkSelect",A6),$.MxFun.addCommand("Mx_BlkAllSelect",E6),$.MxFun.addCommand("Mx_SSBlk",T6),$.MxFun.addCommand("Mx_SMBlk",P6),$.MxFun.addCommand("Mx_BlkLayer",S6)}function D6(){return Gt(this,null,function*(){const t=p.MxCpp.App.getCurrentMxCAD(),e=new p.McDbText;e.height=10;let n=new p.McGePoint3d,r=new p.MxCADResbuf;r.AddMcDbEntityTypes("CIRCLE,ARC,LINE,LWPOLYLINE,ELLIPSE");let s=yield p.MxCADUtility.userSelect(G("选择目标曲线"),r);if(s.length==0)return;let u=0;s.forEach(o=>Gt(this,null,function*(){let m=o.getMcDbEntity();u+=m.getLength().val})),e.textString=u.toFixed(2).toString();const h=new p.MxCADUiPrPoint;h.setMessage(G("指定长度标注点")),h.setUserDraw((o,m)=>{e.position=o,e.alignmentPoint=o,m.drawMcDbEntity(e)}),n=yield h.go(),n&&(e.alignmentPoint=n,e.position=n,t.drawEntity(e))})}function R6(){return Gt(this,null,function*(){const t=p.MxCpp.App.getCurrentMxCAD(),e=new p.McDbText;e.height=10;let n=new p.McGePoint3d,r=new p.MxCADResbuf;r.AddMcDbEntityTypes("CIRCLE,LWPOLYLINE,ELLIPSE");let s=yield p.MxCADUtility.userSelect(G("选择目标对象"),r);if(s.length==0)return;let u=0;s.forEach(o=>Gt(this,null,function*(){let m=o.getMcDbEntity();u+=m.getArea().val})),e.textString=u.toFixed(2).toString();const h=new p.MxCADUiPrPoint;h.setMessage(G("指定长度标注点")),h.setUserDraw((o,m)=>{e.position=o,e.alignmentPoint=o,m.drawMcDbEntity(e)}),n=yield h.go(),n&&(e.alignmentPoint=n,e.position=n,t.drawEntity(e))})}function L6(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LINE");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("请选择目标斜率对象"));const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity(),s=new p.MxCADUiPrDist;if(s.setMessage(G("请设置标注文字高度")),!(yield s.go()))return;const h=s.value(),o=new p.MxCADUiPrPoint;o.setMessage(G("指定斜率标注点"));let m=new p.McDbBlockReference;const y=p.MxCpp.getCurrentMxCAD();o.setUserDraw((M,A)=>{const T=r.getClosestPointTo(M,!0).val,P=new p.McGePoint3d(T.x,T.y+h*4),D=new p.McDbLine(T,P),k=D.clone();k.rotate(P,Math.PI*1/2);const z=r.IntersectWith(k,p.McDb.Intersect.kExtendBoth).at(0),O=r.getClosestPointTo(T,!1).val,U=new p.McDbPolyline;U.isClosed=!0,U.addVertexAt(O),U.addVertexAt(T),U.addVertexAt(P),U.addVertexAt(z);const H=new p.McDbText;H.height=h,H.position=D.getPointAtDist(D.getLength().val/2).val,H.alignmentPoint=H.position,H.rotation=-Math.PI/2,H.horizontalMode=p.McDb.TextHorzMode.kTextMid,H.textString="1000";const V=new p.McDbText,W=new p.McDbLine(z,P);V.height=h,V.position=W.getPointAtDist(z.distanceTo(P)/2).val,V.alignmentPoint=V.position,V.horizontalMode=p.McDb.TextHorzMode.kTextMid,V.textString=(1e3*z.distanceTo(P)/D.getLength().val).toFixed(0).toString();let Z=y.getDatabase().getBlockTable().add(new p.McDbBlockTableRecord),tt=Z.getMcDbBlockTableRecord();tt!=null&&(tt.appendAcDbEntity(U),tt.appendAcDbEntity(H),tt.appendAcDbEntity(V),tt.name="斜率test",tt.origin=T,m.blockTableRecordId=Z,m.position=T,A.drawMcDbEntity(m))}),(yield o.go())&&y.drawEntity(m)})}class Pg extends p.McDbCustomEntity{constructor(e){super(e),this.point=new p.McGePoint3d,this.position=new p.McGePoint3d,this.height=30}create(e){return new Pg(e)}getTypeName(){return"McDbTestCoordinateLabeling"}set coordinatePoint(e){this.point=e.clone()}get coordinatePoint(){return this.point}set coordinateHeight(e){this.height=e}get coordinateHeight(){return this.height}dwgInFields(e){return this.point=e.readPoint("point").val,this.position=e.readPoint("position").val,this.height=e.readDouble("height").val,!0}dwgOutFields(e){return e.writePoint("point",this.point),e.writePoint("position",this.position),e.writeDouble("height",this.height),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.point.x+=n,this.point.y+=r,this.point.z+=s):(this.position.x+=n,this.position.y+=r,this.position.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.point),e.append(this.position),e}worldDraw(e){const n=new p.McDbMText;n.textHeight=$.MxFun.screenCoordLong2Doc(this.height),n.attachment=p.McDb.AttachmentPoint.kMiddleLeft,n.contents=`X=${this.point.x.toFixed(3)}\\PY=${this.point.y.toFixed(3)}`,n.location=this.position,e.drawEntity(n);const s=p.MxCpp.getCurrentMxCAD().drawEntity(n),{maxPt:u,minPt:h}=s.getMcDbEntity().getBoundingBox();s.erase();const o=Math.abs(u.x-h.x),m=new p.McGePoint3d(this.position.x+o*1.2,this.position.y),y=new p.McDbPolyline;y.addVertexAt(this.point),y.addVertexAt(this.position),y.addVertexAt(m),e.drawEntity(y)}setPosition(e){this.assertWrite(),this.position=e.clone()}getPosition(){return this.position}}function I6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请选择目标坐标点"));const e=yield t.go();if(!e)return;const n=new Pg;n.coordinatePoint=e;const r=new p.MxCADUiPrPoint;r.setMessage(G("请指定标注位置")),r.setUserDraw((u,h)=>{n.setPosition(u),h.drawMcDbEntity(n)});const s=yield r.go();s&&(n.setPosition(s),p.MxCpp.getCurrentMxCAD().drawEntity(n))})}function k6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("指定起点"));const e=yield t.go();if(!e)return;const n=10,r=p.MxCpp.getCurrentMxCAD(),s=new p.McDbText;s.height=n,s.textString=e.y.toFixed(2),s.position=e;const u=r.drawEntity(s);let h,o,m;setTimeout(()=>Gt(this,null,function*(){const y=u.getMcDbEntity().getBoundingBox(),x=y.maxPt.distanceTo(new p.McGePoint3d(y.minPt.x,y.maxPt.y));u.erase();const M=new p.MxCADUiPrPoint;if(M.setMessage(G("指定终点")),M.setUserDraw((D,k)=>{h=new p.McDbLine(e,new p.McGePoint3d(e.x+n,e.y,0)),h.startPoint=e,h.endPoint=h.getClosestPointTo(D,!0).val,k.drawMcDbEntity(h);const z=new p.McGePoint3d(D.x,e.y+n,0),O=h.getPointAtDist(h.getLength().val-n).val,U=h.getPointAtDist(h.getLength().val-n*2).val;o=new p.McDbPolyline,o.addVertexAt(z),o.addVertexAt(O),o.addVertexAt(new p.McGePoint3d(U.x,U.y+n,0)),D.x>e.x?o.addVertexAt(new p.McGePoint3d(z.x+x,z.y,0)):o.addVertexAt(new p.McGePoint3d(z.x-x,z.y,0)),k.drawMcDbEntity(o),m=s.clone(),m.position=m.alignmentPoint=z,D.x>e.x?s.horizontalMode=p.McDb.TextHorzMode.kTextLeft:s.horizontalMode=p.McDb.TextHorzMode.kTextRight,k.drawMcDbEntity(m)}),!(yield M.go()))return;const T=new p.MxCADUiPrPoint;T.setMessage(G("指定标注方向")),T.setUserDraw((D,k)=>{const z=o.clone(),O=m.clone();if(D.y<h.endPoint.y){z.mirror(o.getPointAt(1).val,h.endPoint);const U=z.getPointAt(0).val;O.position=O.alignmentPoint=new p.McGePoint3d(U.x,U.y-n,0)}k.drawMcDbEntity(O),k.drawMcDbEntity(z),k.drawMcDbEntity(h)});const P=yield T.go();if(P){if(P.y<h.endPoint.y){o.mirror(o.getPointAt(1).val,h.endPoint);const D=o.getPointAt(0).val;m.position=m.alignmentPoint=new p.McGePoint3d(D.x,D.y-n,0)}r.drawEntity(h),r.drawEntity(m),r.drawEntity(o)}}),0)})}class ku extends p.McDbCustomEntity{constructor(e){super(e),this.ptArr=[],this.height=30,this.dbulges=[],this.isReactFlag=!1,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new ku(e)}getTypeName(){return"McDbTestAreaComment"}set textHeight(e){this.height=e}get textHeight(){return this.height}set isReact(e){this.isReactFlag=e}get isReact(){return this.isReactFlag}dwgInFields(e){this.ptArr=e.readPoints("ptArr").val,this.pt=e.readPoint("pt").val;const n=e.readString("dbulges").val;return this.dbulges=n.split(",").map(Number),this.isReactFlag=!!e.readLong("isReactFlag").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){e.writePoints("ptArr",this.ptArr),e.writePoint("pt",this.pt);const n=this.dbulges.toString();return e.writeString("dbulges",n),e.writeLong("isReactFlag",this.isReactFlag?1:0),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.ptArr.forEach((u,h)=>{h===e&&(u.x+=n,u.y+=r,u.z+=s)}),e===this.ptArr.length&&(this.pt.x+=n,this.pt.y+=r,this.pt.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return this.ptArr.forEach(n=>{e.append(n)}),e.append(this.pt),e}worldDraw(e){const n=[],r=new p.McDbPolyline;r.isClosed=!0,this.isReactFlag?(r.addVertexAt(this.ptArr[0],0,.1,.1),r.addVertexAt(new p.McGePoint3d(this.ptArr[1].x,this.ptArr[0].y),0,.1,.1),r.addVertexAt(this.ptArr[1],0,.1,.1),r.addVertexAt(new p.McGePoint3d(this.ptArr[0].x,this.ptArr[1].y),0,.1,.1)):this.ptArr.forEach((o,m)=>{r.addVertexAt(o,this.dbulges[m],.1,.1)});const s=r.getArea().val,u=r.getLength().val,h=new p.McDbMText;h.contents=`面积：${s.toFixed(2)}\\P周长：${u.toFixed(2)} `,h.attachment=p.McDb.AttachmentPoint.kMiddleCenter,h.location=this.pt,h.textHeight=$.MxFun.screenCoordLong2Doc(this.height),h.trueColor=this.trueColor,e.trueColor=this.trueColor,e.drawEntity(h),e.drawEntity(r),n.push(h),n.push(r),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setPoint(e){this.assertWrite(),this.pt=e.clone()}addVertex(e,n){this.assertWrite(),this.ptArr.push(e.clone()),this.dbulges.push(n||0)}getPoint(){return this.pt}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function B6(){return Gt(this,null,function*(){const t=[],e=new p.MxCADUiPrPoint;e.setMessage(G("请选择面积的第一个点"));const n=yield e.go();if(!n)return;for(t.push(n);;){const o=new p.MxCADUiPrPoint;o.setMessage(G("请选择下一个点")),o.setKeyWords("[回退(B)/结束(O)]"),o.setUserDraw((x,M)=>{const A=new p.McDbPolyline;t.forEach(T=>{A.addVertexAt(T,0,.1,.1)}),A.addVertexAt(x),M.drawMcDbEntity(A)});const m=yield o.go(),y=o.keyWordPicked();if(y==="B")t.length>1&&t.pop();else{if(y==="O")break;if(!m)break;t.push(m)}}if(t.length<3)return;const r=p.MxCpp.getCurrentMxCAD(),s=new ku;t.forEach(o=>{s.addVertex(o,0)});const u=new p.MxCADUiPrPoint;u.setMessage(G("请选择面积标注的位置")),u.setUserDraw((o,m)=>{m.setColor(16711680),s.setPoint(o),m.drawMcDbEntity(s)});const h=yield u.go();h&&(s.setPoint(h),s.trueColor=new p.McCmColor(255,0,0),r.drawEntity(s))})}function F6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请选择矩形的角点1"));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrPoint;n.setMessage(G("请选择矩形的角点2")),n.setUserDraw((o,m)=>{const y=new p.McDbPolyline;y.isClosed=!0,y.addVertexAt(e),y.addVertexAt(new p.McGePoint3d(o.x,e.y)),y.addVertexAt(o),y.addVertexAt(new p.McGePoint3d(e.x,o.y)),m.drawMcDbEntity(y)});const r=yield n.go();if(!r)return;const s=new ku;s.isReact=!0,s.addVertex(e),s.addVertex(r);const u=new p.MxCADUiPrPoint;u.setMessage(G("请设置面积标注的位置")),u.setUserDraw((o,m)=>{m.setColor(16711680),s.setPoint(o),m.drawMcDbEntity(s)});const h=yield u.go();h&&(s.setPoint(h),s.trueColor=new p.McCmColor(255,0,0),p.MxCpp.getCurrentMxCAD().drawEntity(s))})}function z6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请选择一个测量点"));const e=yield t.go();if(!e)return;const n=new p.MxCADResbuf([p.DxfCode.kEntityType,"LINE"]),r=new p.MxCADUiPrEntity;r.setMessage(G("请选择一条直线")),r.setFilter(n);const s=yield r.go();if(!s.id)return;const h=s.getMcDbEntity().getClosestPointTo(e,!0).val;let o;const m=p.MxCpp.getCurrentMxCAD(),y=new p.MxCADUiPrPoint;y.setMessage(G("请设置尺寸线的位置")),y.setUserDraw((M,A)=>{o&&o.erase(),o=m.drawDimAligned(e.x,e.y,h.x,h.y,M.x,M.y)});const x=yield y.go();if(!x){o&&o.erase();return}o&&o.erase(),m.drawDimAligned(e.x,e.y,h.x,h.y,x.x,x.y)})}class Sg extends p.McDbCustomEntity{constructor(e){super(e),this.center=new p.McGePoint3d,this.position=new p.McGePoint3d,this.height=30,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Sg(e)}getTypeName(){return"McDbTestArcComment"}set arcCenter(e){this.center=e.clone()}get arcCenter(){return this.center}set arcRadius(e){this.radius=e}get arcRadius(){return this.radius}set textHeight(e){this.height=e}get textHeight(){return this.height}set arcStartAngle(e){this.startAngle=e}get arcStartAngle(){return this.startAngle}set arcEndAngle(e){this.endAngle=e}get arcEndAngle(){return this.endAngle}dwgInFields(e){return this.position=e.readPoint("position").val,this.center=e.readPoint("center").val,this.startAngle=e.readDouble("startAngle").val,this.endAngle=e.readDouble("endAngle").val,this.radius=e.readDouble("radius").val,this.height=e.readDouble("textHeight").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("position",this.position),e.writePoint("center",this.center),e.writeDouble("startAngle",this.startAngle),e.writeDouble("endAngle",this.endAngle),e.writeDouble("radius",this.radius),e.writeDouble("textHeight",this.height),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.position.x+=n,this.position.y+=r,this.position.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e}drawLine(e,n){const r=n.sub(e).normalize().mult($.MxFun.screenCoordLong2Doc(this.height*.4)),s=n.clone().addvec(r),u=n.clone().subvec(r),h=new p.McDbLine(s,u);return h.rotate(n,Math.PI/4),{line:h,pt:s}}worldDraw(e){const n=[],r=new p.McDbArc;r.center=this.center,r.startAngle=this.startAngle,r.endAngle=this.endAngle,r.radius=this.radius;const s=r.getLength().val,u=r.getPointAtDist(0).val,h=r.getPointAtDist(s).val,o=new p.McDbText;o.textString=`${s.toFixed(2)}`,o.height=$.MxFun.screenCoordLong2Doc(this.height),o.horizontalMode=p.McDb.TextHorzMode.kTextCenter,o.position=o.alignmentPoint=this.position;const y=r.getClosestPointTo(this.position,!0).val.distanceTo(this.position);r.offsetCurves(y,this.position).forEach(k=>{const z=k.clone(),O=z.getLength().val;this.pt1=z.getPointAtDist(0).val,this.pt2=z.getPointAtDist(O).val;const U=z.getPointAtDist(O/2).val;this.dbulge=p.MxCADUtility.calcBulge(this.pt1,U,this.pt2).val});const x=new p.McDbPolyline;x.addVertexAt(this.pt1,this.dbulge),x.addVertexAt(this.pt2);const M=this.pt1.sub(this.pt2).angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis);o.rotation=M===Math.PI?0:M;const{line:A,pt:T}=this.drawLine(u,this.pt1),{line:P,pt:D}=this.drawLine(h,this.pt2);x.trueColor=o.trueColor=A.trueColor=P.trueColor=this.trueColor,e.drawEntity(x),e.drawEntity(o),e.drawEntity(A),e.drawEntity(P),e.drawEntity(new p.McDbLine(u,T)),e.drawEntity(new p.McDbLine(h,D)),n.push(x),n.push(o),n.push(A),n.push(P),n.push(new p.McDbLine(u,T)),n.push(new p.McDbLine(h,D)),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setPosition(e){this.assertWrite(),this.position=e.clone()}getPoint(){return this.position}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function N6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf([p.DxfCode.kEntityType,"ARC"]),e=new p.MxCADUiPrEntity;e.setMessage(G("请选择一条弧线")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity(),s=new Sg;s.arcCenter=r.center,s.arcStartAngle=r.startAngle,s.arcEndAngle=r.endAngle,s.arcRadius=r.radius;const u=new p.MxCADUiPrPoint;u.setMessage(G("请指定尺寸线位置")),u.setUserDraw((m,y)=>{y.setColor(16711680),s.setPosition(m),y.drawMcDbEntity(s)});const h=yield u.go();if(!h)return;s.setPosition(h),s.trueColor=new p.McCmColor(255,0,0),p.MxCpp.getCurrentMxCAD().drawEntity(s)})}class Cg extends p.McDbCustomEntity{constructor(e){super(e),this.center=new p.McGePoint3d,this.position=new p.McGePoint3d,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Cg(e)}getTypeName(){return"McDbTestMeasuringCircle"}set circleRadius(e){this.radius=e}get circleRadius(){return this.radius}dwgInFields(e){return this.center=e.readPoint("center").val,this.position=e.readPoint("position").val,this.radius=e.readDouble("radius").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("center",this.center),e.writePoint("position",this.position),e.writeDouble("radius",this.radius),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),this.position.x+=n,this.position.y+=r,this.position.z+=s}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e}worldDraw(e){const n=[],r=new p.McDbCircle;r.center=this.center,r.radius=this.radius;const s=r.getLength().val,u=r.radius,h=Math.PI*u*u,o=new p.McDbMText;o.contents=`半径：${u.toFixed(2)} \\P 周长：${s.toFixed(2)} \\P 面积：${h.toFixed(2)}`,o.textHeight=u/6,o.attachment=p.McDb.AttachmentPoint.kMiddleCenter,o.location=this.position,o.trueColor=r.trueColor=this.trueColor,e.drawEntity(o),e.drawEntity(r),n.push(o),n.push(r),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}setCenter(e){this.assertWrite(),this.center=e.clone()}getCenter(){return this.center}setPosition(e){this.assertWrite(),this.position=e.clone()}getPosition(){return this.position}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function U6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf([p.DxfCode.kEntityType,"CIRCLE"]),e=new p.MxCADUiPrEntity;e.setMessage(G("请选择一个圆对象")),e.setFilter(t);const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity();r.highlight(!0);const s=new Cg;s.setCenter(r.center),s.circleRadius=r.radius;const u=new p.MxCADUiPrPoint;u.setMessage(G("请指定文字位置")),u.setUserDraw((m,y)=>{y.setColor(16711680),s.setPosition(m),y.drawMcDbEntity(s)});const h=yield u.go();if(!h)return;s.setPosition(h),s.trueColor=new p.McCmColor(255,0,0),p.MxCpp.getCurrentMxCAD().drawEntity(s),r.highlight(!1)})}class Dg extends p.McDbCustomEntity{constructor(e){super(e),this.points=[],this.dbulges=[],this.position=new p.McGePoint3d,this.height=30,this.dimColor=new p.McCmColor(255,0,0),this.width=.1,this.showSegLength=!1,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Dg(e)}getTypeName(){return"McDbTestConMeasurement"}set textHeight(e){this.height=e}get textHeight(){return this.height}set color(e){this.dimColor=e.clone()}get color(){return this.dimColor}set conWidth(e){this.width=$.MxFun.screenCoordLong2Doc(e)}get conWidth(){return this.width}set isShowSegLength(e){this.showSegLength=e}get isShowSegLength(){return this.showSegLength}dwgInFields(e){this.points=e.readPoints("points").val,this.position=e.readPoint("position").val;const n=e.readString("dbulges").val;this.dbulges=n.split(",").map(Number);const r=e.readString("dimColor").val;return this.dimColor=new p.McCmColor(...r.split(",").map(Number)),this.width=e.readDouble("conWidth").val,this.showSegLength=e.readLong("showSegLength").val===1,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){const n=this.dbulges.toString(),r=`${this.dimColor.red},${this.dimColor.green},${this.dimColor.blue}`,s=this.showSegLength?1:0;return e.writePoints("points",this.points),e.writePoint("position",this.position),e.writeString("dbulges",n),e.writeString("dimColor",r),e.writeDouble("conWidth",this.width),e.writeLong("showSegLength",s),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e<this.points.length?(this.points[e].x+=n,this.points[e].y+=r,this.points[e].z+=s):(this.position.x+=n,this.position.y+=r,this.position.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return this.points.forEach(n=>{e.append(n)}),e.append(this.position),e}worldDraw(e){const n=[],r=new p.McDbPolyline,s=[];this.points.forEach((H,V)=>{let W=this.width;if(V===this.points.length-1&&(W=0),r.addVertexAt(H,this.dbulges[V],W,W),V>0){const K=this.points[V-1],Z=new p.McDbPolyline;Z.addVertexAt(K,this.dbulges[V-1]),Z.addVertexAt(H,this.dbulges[V]);const tt=Z.getLength().val,at=Z.getPointAtDist(tt/2).val,st=new p.McDbText;st.textString=`${tt.toFixed(2)}`,st.height=$.MxFun.screenCoordLong2Doc(this.height*.6),st.horizontalMode=p.McDb.TextHorzMode.kTextCenter;let nt;K.x<=H.x?nt=H.sub(K):nt=K.sub(H);const ct=nt.clone().perpVector().normalize(),xt=$.MxFun.screenCoordLong2Doc(this.height*.15),vt=new p.McDbLine(K,H);vt.getPointAtDist(vt.getLength().val/2).val.y>=at.y?at.addvec(ct.mult(xt)):at.subvec(ct.mult(xt)),st.position=st.alignmentPoint=at;const ce=nt.angleTo2(p.McGeVector3d.kXAxis,p.McGeVector3d.kNegateZAxis);st.rotation=ce===Math.PI?0:ce,s.push(st)}});const u=p.MxCpp.getCurrentMxCAD(),h=u.drawEntity(r),o=h.getMcDbEntity().getLength().val,m=this.points[this.points.length-1],x=r.getFirstDeriv(m).val.clone();x.rotateBy(Math.PI/4).normalize().mult(this.width*5);const M=m.clone().addvec(x),A=m.clone().subvec(x),T=new p.McDbPolyline;T.addVertexAt(M,0,this.width,this.width),T.addVertexAt(A),h.erase();const P=new p.McDbText;P.textString=`${o.toFixed(2)}`,P.height=$.MxFun.screenCoordLong2Doc(this.height);const D=$.MxFun.screenCoordLong2Doc(4);P.position=P.alignmentPoint=new p.McGePoint3d(this.position.x+D,this.position.y+D),P.horizontalMode=p.McDb.TextHorzMode.kTextLeft;const k=u.drawEntity(P),{minPt:z,maxPt:O}=k.getMcDbEntity().getBoundingBox();k.erase();const U=new p.McGePoint3d(this.position.x+Math.abs(z.x-O.x)+D*6,this.position.y);r.addVertexAt(this.position),r.addVertexAt(U),this.showSegLength&&s.forEach(H=>{e.drawEntity(H),n.push(H)}),e.trueColor=this.dimColor,e.drawEntity(r),e.drawEntity(P),e.drawEntity(T),n.push(r),n.push(P),n.push(T),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}addVertex(e,n){this.assertWrite(),this.dbulges.push(n),this.points.push(e)}getPoints(){return this.points}setPosition(e){this.assertWrite(),this.position=e.clone()}getPosition(){return this.position}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}let $w=[];function tA(t){const e=p.MxCpp.getCurrentMxCAD();t===1?($w.push({name:"ORTHOMODE",value:e.getSysVarLong("ORTHOMODE")},{name:"GRIDMODE",value:e.getSysVarLong("GRIDMODE")},{name:"OSMODE",value:e.getSysVarLong("OSMODE")}),e.setSysVarLong("ORTHOMODE",0),e.setSysVarLong("GRIDMODE",0),e.setSysVarLong("OSMODE",16383)):t===0&&$w.forEach(n=>{e.setSysVarLong(n.name,n.value)})}function eA(){return Gt(this,null,function*(){tA(1);let t=[],e=!1;const n=new p.MxCADResbuf([p.DxfCode.kEntityType,"ARC"]);let s=p.MxCpp.getCurrentMxCAD().mxdraw.screenCoordLong2Doc(.5),u=null;for(;;){const h=new p.MxCADUiPrPoint;h.setMessage(G("请选择直线的端点或弧线")),h.setKeyWords("[回退(B)/结束(O)]"),t.length>0&&h.setBasePt(t[t.length-1].pt),h.setUserDraw((y,x)=>{const M=new p.McDbPolyline;t.forEach(A=>{M.addVertexAt(A.pt,A.dbulge,.1,.1)}),x.drawMcDbEntity(M)});const o=yield h.go(),m=h.keyWordPicked();if(m==="B")t.length>1&&t.pop(),u=null;else{if(m==="O")break;{if(!o)break;const y=p.MxCADUtility.findEntAtPoint(o.x,o.y,o.z,-1,n);if(!y.id)u=null,e?t.filter(M=>M.pt.distanceTo(o)<s).length||alert("请选择连续的线段！"):t.push({pt:o,dbulge:0});else{const x=y.getMcDbEntity(),M=x.getLength().val,A=x.getPointAtDist(0).val,T=x.getPointAtDist(M).val;if(A.distanceTo(o)<s||T.distanceTo(o)<s)if(e){const P=-t[0].dbulge,D=t[t.length-2].pt,k=t[t.length-1].pt;D.distanceTo(o)<s&&(t.slice(0,t.length-2),t.push({pt:k,dbulge:P}),t.push({pt:D,dbulge:0})),e=!1,u=y}else t.push({pt:o,dbulge:0});else if(t.length>0){const P=t[t.length-1].pt;if(A.distanceTo(P)<s||T.distanceTo(P)<s)if((u==null?void 0:u.id)===y.id){console.log("点击同一个圆弧"),t.pop();const D=t[t.length-1],k=x.getDistAtPoint(D.pt).val,z=x.getDistAtPoint(o).val;let O=x.getPointAtDist(k+(z-k)/2).val,U=new p.McDbArc;if(U.computeArc(D.pt.x,D.pt.y,O.x,O.y,o.x,o.y),U.getLength().val>x.getLength().val){const H=U.clone();U.startAngle=H.endAngle,U.endAngle=H.startAngle,O=U.getPointAtDist(U.getLength().val/2).val}D.dbulge=p.MxCADUtility.calcBulge(D.pt,O,o).val,t.push({pt:o,dbulge:0}),u=null}else{const D=A.distanceTo(P)<s?T:A;t[t.length-1].dbulge=p.MxCADUtility.calcBulge(P,o,D).val,t.push({pt:D,dbulge:0}),u=y}else alert("请选择连续的线段！")}else{const P=p.MxCADUtility.calcBulge(A,o,T).val;t.push({pt:A,dbulge:P}),t.push({pt:T,dbulge:0}),e=!0,u=y}}}}}return tA(0),t})}function V6(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=yield eA();if(e.length<2)return;const n=new Dg;e.forEach(u=>{n.addVertex(u.pt,u.dbulge)});const r=new p.MxCADUiPrPoint;r.setMessage(G("请指定文字的位置")),r.setUserDraw((u,h)=>{n.setPosition(u),h.drawMcDbEntity(n)});const s=yield r.go();s&&(n.setPosition(s),t.drawEntity(n))})}function G6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrEntity;t.setMessage(G("请选择一个连续测量的标注"));const e=yield t.go();if(!e.id)return;const n=e.getMcDbEntity();if(n instanceof p.McDbCustomEntity&&n.getTypeName()==="McDbTestConMeasurement"){const r=n.clone();r.isShowSegLength=!r.isShowSegLength,p.MxCpp.getCurrentMxCAD().drawEntity(r),e.erase()}})}function O6(){return Gt(this,null,function*(){const t=yield eA(),e=p.MxCpp.getCurrentMxCAD(),n=new ku;t.forEach(u=>{n.addVertex(u.pt,u.dbulge)});const r=new p.MxCADUiPrPoint;r.setMessage(G("请选择面积标注的位置")),r.setUserDraw((u,h)=>{n.setPoint(u),h.drawMcDbEntity(n)});const s=yield r.go();s&&(n.setPoint(s),n.trueColor=new p.McCmColor(255,0,0),e.drawEntity(n))})}function j6(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LINE");const e=new p.MxCADUiPrEntity;e.setMessage(G("请选择一条直线")),e.setFilter(t);const n=yield e.go();if(!n)return;const r=n.getMcDbEntity();r.highlight(!0);const s=new p.MxCADUiPrEntity;s.setMessage(G("请选择第二条直线")),s.setFilter(t);const u=yield s.go();if(!u)return;const h=u.getMcDbEntity();h.highlight(!0);const o=new p.MxCADUiPrPoint;o.setMessage(G("请设置角度标注的位置"));const m=p.MxCpp.getCurrentMxCAD().addDimStyle("MyDimStyle2","41,0.18,141,0.09,40,20","77,1,271,3","",""),y=new p.McDb2LineAngularDimension;y.xLine1Start=r.startPoint,y.xLine1End=r.endPoint,y.xLine2Start=h.startPoint,y.xLine2End=h.endPoint,y.dimensionStyle=m,r.highlight(!1),h.highlight(!1),o.setUserDraw((M,A)=>{y.arcPoint=M,A.drawMcDbEntity(y)});const x=yield o.go();x&&(y.arcPoint=x,p.MxCpp.getCurrentMxCAD().drawEntity(y))})}function H6(){new ku().rxInit(),new Dg().rxInit(),new Cg().rxInit(),new Sg().rxInit(),new Pg().rxInit(),$.MxFun.addCommand("Mx_StaLength",D6),$.MxFun.addCommand("Mx_StaArea",R6),$.MxFun.addCommand("Mx_StandardSlope",L6),$.MxFun.addCommand("Mx_CoordAnnotation",I6),$.MxFun.addCommand("Mx_Elevation",k6),$.MxFun.addCommand("Mx_Area",B6),$.MxFun.addCommand("Mx_ReactArea",F6),$.MxFun.addCommand("Mx_DistFromPointToLine",z6),$.MxFun.addCommand("Mx_ArcLength",N6),$.MxFun.addCommand("Mx_MeasuringCircle",U6),$.MxFun.addCommand("Mx_ContinueMeasurement",V6),$.MxFun.addCommand("Mx_CountList",G6),$.MxFun.addCommand("Mx_AreaArc",O6),$.MxFun.addCommand("Mx_MeasuringAngle",j6)}function W6(){return Gt(this,null,function*(){const t=new p.MxCADUiPrKeyWord;t.setMessage(G("请设置图框方向<N>")),t.setKeyWords(`[${G("横向")}(T)/${G("纵向")}(P)]`);let e=yield t.go();switch(e){case"T":e="T";break;case"P":e="P";break;default:e="T";break}const n=new q6;n.direct=e;const r=new p.MxCADUiPrKeyWord;r.setMessage(G("请设置图框尺寸<4>")),r.setKeyWords("[A0(0)/A1(1)/A2(2)/A3(3)/A4(4)]");let s=yield r.go();s||(s="4"),n.size=s;const u=new p.MxCADUiPrPoint;u.setMessage(G("请设置图框位置"));let h=yield u.go();h&&(n.framePos=h,n.tableScale="1:10",n.draw())})}class q6{constructor(){this.size="4",this.direct="T",this.scale=1,this.tableData=[{width:18,data:[{rowNum:1},{label:"比例",value:`1:${this.scale}`,rowNum:1},{label:"尺寸",value:`A${this.size}`,rowNum:1}]},{width:30,data:[{label:"日期",rowNum:1},{label:"审核",rowNum:1},{label:"绘制",rowNum:1}]},{width:45,data:[{label:"图号",rowNum:1},{label:"图名",rowNum:2}]}],this.framePos=new p.McGePoint3d,this.rowNum=3,this.lableWidth=18,this.lableHeight=6,this._pos=new p.McGePoint3d,this.drawFrameOutside=()=>{const e=p.MxCpp.getCurrentMxCAD(),n=this.getFrameSpecifications(this.size,this.direct),r=p.McGeVector3d.kYAxis.clone().mult(n.height),s=p.McGeVector3d.kXAxis.clone().negate().mult(n.width),u=this.framePos.clone().addvec(r),h=this.framePos.clone().addvec(s),o=this.framePos.clone().addvec(r).addvec(s),m=new p.McDbPolyline;m.addVertexAt(this.framePos),m.addVertexAt(u),m.addVertexAt(o),m.addVertexAt(h),m.isClosed=!0,e.drawEntity(m);const y=this.framePos.clone().addvec(o.sub(this.framePos).mult(1/2)),x=5*this.scale;let M=new p.McDbPolyline;m.offsetCurves(x,y).forEach(A=>{M=A.clone(),e.drawEntity(A)}),this._pos=M.getPointAt(0).val},this.drawContent=()=>{const e=p.MxCpp.getCurrentMxCAD(),n=this.tableData.reduce((y,x)=>y+x.width,0)*this.scale,r=p.McGeVector3d.kXAxis.clone().negate().mult(this.tableData.length*this.lableWidth+n),s=p.McGeVector3d.kYAxis.clone().mult(this.lableHeight*this.rowNum),u=this._pos.clone().addvec(s),h=this._pos.clone().addvec(r).addvec(s),o=new p.McDbLine(u,h);e.drawEntity(o);let m=this._pos.clone();this.tableData.forEach(y=>{const x=p.McGeVector3d.kXAxis.clone().negate().mult(y.width*this.scale),M=p.McGeVector3d.kXAxis.clone().negate().mult(this.lableWidth);let A=0;const T=m.clone();y.data.forEach((P,D)=>{A+=P.rowNum;const k=p.McGeVector3d.kYAxis.clone().mult(this.lableHeight*A),z=T.clone().addvec(x),O=T.clone().addvec(k),U=T.clone().addvec(k).addvec(x),H=new p.McDbLine(z,U),V=new p.McDbLine(O,U);if(P.value){const at=V.getPointAtDist(V.getLength().val/2).val,st=this.getText(at,P.value,this.lableHeight,P.rowNum);e.drawEntity(st)}const W=U.clone().addvec(M),K=z.clone().addvec(M);D===0&&(m=K.clone());const Z=new p.McDbLine(W,U),tt=new p.McDbLine(W,K);if(D<y.data.length-1&&(e.drawEntity(V),e.drawEntity(Z)),D===y.data.length-1&&(e.drawEntity(H),e.drawEntity(tt)),P.label){const at=Z.getPointAtDist(Z.getLength().val/2).val,st=this.getText(at,P.label,this.lableHeight,P.rowNum);e.drawEntity(st)}})})},this.getText=(e,n,r,s)=>{const u=new p.McDbText;return u.textString=n,u.height=r*(3/5),u.position=u.alignmentPoint=e.clone().subvec(p.McGeVector3d.kYAxis.clone().mult(s*r/2+u.height*(1/2))),u.horizontalMode=p.McDb.TextHorzMode.kTextCenter,u},this.getFrameSpecifications=(e,n)=>{const r={width:0,length:0};switch(e){case"0":r.width=841,r.length=1189;break;case"1":r.width=594,r.length=841;break;case"2":r.width=420,r.length=594;break;case"3":r.width=297,r.length=420;break;case"4":r.width=210,r.length=297;break}if(n==="P")return{height:r.length*this.scale,width:r.width*this.scale};if(n==="T")return{height:r.width*this.scale,width:r.length*this.scale}},this.draw=()=>{this.direct==="T"&&this.tableData.push({width:55,data:[{label:"建设单位",rowNum:1},{label:"设计单位",rowNum:1},{label:"工程名称",rowNum:1}]}),this.lableWidth=this.lableWidth*this.scale,this.lableHeight=this.lableHeight*this.scale,this.drawFrameOutside(),this.drawContent()}}set tableScale(e){this.scale=Number(e.split(":")[1]),this.tableData.forEach(n=>{n.data.forEach(r=>{r.label==="比例"&&(r.value=`1:${this.scale}`)})})}get tableScale(){return`1:${this.scale}`}}function Y6(){MxPluginContext.addCommand("Mx_InsterFrame",W6)}let Na=class{constructor(e,n){this.data=e,this.text=n.text||e,this.options=n}};class X6 extends Na{constructor(e,n){e=e.toUpperCase(),n.mod43&&(e+=J6(Q6(e))),super(e,n)}encode(){var e=w1("*");for(let n=0;n<this.data.length;n++)e+=w1(this.data[n])+"0";return e+=w1("*"),{data:e,text:this.text}}valid(){return this.data.search(/^[0-9A-Z\-\.\ \$\/\+\%]+$/)!==-1}}var nA=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","-","."," ","$","/","+","%","*"],K6=[20957,29783,23639,30485,20951,29813,23669,20855,29789,23645,29975,23831,30533,22295,30149,24005,21623,29981,23837,22301,30023,23879,30545,22343,30161,24017,21959,30065,23921,22385,29015,18263,29141,17879,29045,18293,17783,29021,18269,17477,17489,17681,20753,35770];function w1(t){return Z6(iA(t))}function Z6(t){return K6[t].toString(2)}function J6(t){return nA[t]}function iA(t){return nA.indexOf(t)}function Q6(t){var e=0;for(let n=0;n<t.length;n++)e+=iA(t[n]);return e=e%43,e}const cp=0,Rg=1,rA=2,$6=98,tN=103,eN=104,nN=105,iN=103,rN=106,oN=207,sN={[tN]:cp,[eN]:Rg,[nN]:rA},aN={101:cp,100:Rg,99:rA},oA=String.fromCharCode(208),sA=String.fromCharCode(209),aA=String.fromCharCode(210),A1="[\0-_È-Ï]",E1="[ -È-Ï]",lA="(Ï*[0-9]{2}Ï*)",cA=[11011001100,11001101100,11001100110,10010011e3,10010001100,10001001100,10011001e3,10011000100,10001100100,11001001e3,11001000100,11000100100,10110011100,10011011100,10011001110,10111001100,10011101100,10011100110,11001110010,11001011100,11001001110,11011100100,11001110100,11101101110,11101001100,11100101100,11100100110,11101100100,11100110100,11100110010,11011011e3,11011000110,11000110110,10100011e3,10001011e3,10001000110,10110001e3,10001101e3,10001100010,11010001e3,11000101e3,11000100010,10110111e3,10110001110,10001101110,10111011e3,10111000110,10001110110,11101110110,11010001110,11000101110,11011101e3,11011100010,11011101110,11101011e3,11101000110,11100010110,11101101e3,11101100010,11100011010,11101111010,11001000010,11110001010,1010011e4,10100001100,1001011e4,10010000110,10000101100,10000100110,1011001e4,10110000100,1001101e4,10011000010,10000110100,10000110010,11000010010,1100101e4,11110111010,11000010100,10001111010,10100111100,10010111100,10010011110,10111100100,10011110100,10011110010,11110100100,11110010100,11110010010,11011011110,11011110110,11110110110,10101111e3,10100011110,10001011110,10111101e3,10111100010,11110101e3,11110100010,10111011110,10111101110,11101011110,11110101110,11010000100,1101001e4,11010011100,1100011101011];class Zr extends Na{constructor(e,n){super(e.substring(1),n),this.bytes=e.split("").map(r=>r.charCodeAt(0))}valid(){return/^[\x00-\x7F\xC8-\xD3]+$/.test(this.data)}encode(){const e=this.bytes,n=e.shift()-105,r=sN[n];if(r===void 0)throw new RangeError("The encoding does not start with a start character.");this.shouldEncodeAsEan128()===!0&&e.unshift(oN);const s=Zr.next(e,1,r);return{text:this.text===this.data?this.text.replace(/[^\x20-\x7E]/g,""):this.text,data:Zr.getBar(n)+s.result+Zr.getBar((s.checksum+n)%iN)+Zr.getBar(rN)}}shouldEncodeAsEan128(){let e=this.options.ean128||!1;return typeof e=="string"&&(e=e.toLowerCase()==="true"),e}static getBar(e){return cA[e]?cA[e].toString():""}static correctIndex(e,n){if(n===cp){const r=e.shift();return r<32?r+64:r-32}else return n===Rg?e.shift()-32:(e.shift()-48)*10+e.shift()-48}static next(e,n,r){if(!e.length)return{result:"",checksum:0};let s,u;if(e[0]>=200){u=e.shift()-105;const m=aN[u];m!==void 0?s=Zr.next(e,n+1,m):((r===cp||r===Rg)&&u===$6&&(e[0]=r===cp?e[0]>95?e[0]-96:e[0]:e[0]<32?e[0]+96:e[0]),s=Zr.next(e,n+1,r))}else u=Zr.correctIndex(e,r),s=Zr.next(e,n+1,r);const h=Zr.getBar(u),o=u*n;return{result:h+s.result,checksum:o+s.checksum}}}const uA=t=>t.match(new RegExp(`^${A1}*`))[0].length,hA=t=>t.match(new RegExp(`^${E1}*`))[0].length,dA=t=>t.match(new RegExp(`^${lA}*`))[0];function T1(t,e){const n=e?A1:E1,r=t.match(new RegExp(`^(${n}+?)(([0-9]{2}){2,})([^0-9]|$)`));if(r)return r[1]+String.fromCharCode(204)+pA(t.substring(r[1].length));const s=t.match(new RegExp(`^${n}+`))[0];return s.length===t.length?t:s+String.fromCharCode(e?205:206)+T1(t.substring(s.length),!e)}function pA(t){const e=dA(t),n=e.length;if(n===t.length)return t;t=t.substring(n);const r=uA(t)>=hA(t);return e+String.fromCharCode(r?206:205)+T1(t,r)}const lN=t=>{let e;if(dA(t).length>=2)e=aA+pA(t);else{const r=uA(t)>hA(t);e=(r?oA:sA)+T1(t,r)}return e.replace(/[\xCD\xCE]([^])[\xCD\xCE]/,(r,s)=>String.fromCharCode(203)+s)};class cN extends Zr{constructor(e,n){/^[\x00-\x7F\xC8-\xD3]+$/.test(e)?super(lN(e),n):super(e,n)}}class uN extends Zr{constructor(e,n){super(oA+e,n)}valid(){return new RegExp(`^${A1}+$`).test(this.data)}}class hN extends Zr{constructor(e,n){super(sA+e,n)}valid(){return new RegExp(`^${E1}+$`).test(this.data)}}class dN extends Zr{constructor(e,n){super(aA+e,n)}valid(){return new RegExp(`^${lA}+$`).test(this.data)}}const Lg="101",fA="01010",pN={L:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],G:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"],R:["1110010","1100110","1101100","1000010","1011100","1001110","1010000","1000100","1001000","1110100"],O:["0001101","0011001","0010011","0111101","0100011","0110001","0101111","0111011","0110111","0001011"],E:["0100111","0110011","0011011","0100001","0011101","0111001","0000101","0010001","0001001","0010111"]},fN=["LL","LG","GL","GG"],mN=["GGLLL","GLGLL","GLLGL","GLLLG","LGGLL","LLGGL","LLLGG","LGLGL","LGLLG","LLGLG"],gN=["LLLLLL","LLGLGG","LLGGLG","LLGGGL","LGLLGG","LGGLLG","LGGGLL","LGLGLG","LGLGGL","LGGLGL"],qo=(t,e,n)=>{let r=t.split("").map((s,u)=>pN[e[u]]).map((s,u)=>s?s[t[u]]:"");if(n){const s=t.length-1;r=r.map((u,h)=>h<s?u+n:u)}return r.join("")};class mA extends Na{constructor(e,n){super(e,n),this.fontSize=!n.flat&&n.fontSize>n.width*10?n.width*10:n.fontSize,this.guardHeight=n.height+this.fontSize/2+n.textMargin}encode(){return this.options.flat?this.encodeFlat():this.encodeGuarded()}leftText(e,n){return this.text.substr(e,n)}leftEncode(e,n){return qo(e,n)}rightText(e,n){return this.text.substr(e,n)}rightEncode(e,n){return qo(e,n)}encodeGuarded(){const e={fontSize:this.fontSize},n={height:this.guardHeight};return[{data:Lg,options:n},{data:this.leftEncode(),text:this.leftText(),options:e},{data:fA,options:n},{data:this.rightEncode(),text:this.rightText(),options:e},{data:Lg,options:n}]}encodeFlat(){return{data:[Lg,this.leftEncode(),fA,this.rightEncode(),Lg].join(""),text:this.text}}}const gA=t=>(10-t.substr(0,12).split("").map(n=>+n).reduce((n,r,s)=>s%2?n+r*3:n+r,0)%10)%10;class yN extends mA{constructor(e,n){e.search(/^[0-9]{12}$/)!==-1&&(e+=gA(e)),super(e,n),this.lastChar=n.lastChar}valid(){return this.data.search(/^[0-9]{13}$/)!==-1&&+this.data[12]===gA(this.data)}leftText(){return super.leftText(1,6)}leftEncode(){const e=this.data.substr(1,6),n=gN[this.data[0]];return super.leftEncode(e,n)}rightText(){return super.rightText(7,6)}rightEncode(){const e=this.data.substr(7,6);return super.rightEncode(e,"RRRRRR")}encodeGuarded(){const e=super.encodeGuarded();return this.options.displayValue&&(e.unshift({data:"000000000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),this.options.lastChar&&(e.push({data:"00"}),e.push({data:"00000",text:this.options.lastChar,options:{fontSize:this.fontSize}}))),e}}const yA=t=>(10-t.substr(0,7).split("").map(n=>+n).reduce((n,r,s)=>s%2?n+r:n+r*3,0)%10)%10;class xN extends mA{constructor(e,n){e.search(/^[0-9]{7}$/)!==-1&&(e+=yA(e)),super(e,n)}valid(){return this.data.search(/^[0-9]{8}$/)!==-1&&+this.data[7]===yA(this.data)}leftText(){return super.leftText(0,4)}leftEncode(){const e=this.data.substr(0,4);return super.leftEncode(e,"LLLL")}rightText(){return super.rightText(4,4)}rightEncode(){const e=this.data.substr(4,4);return super.rightEncode(e,"RRRR")}}const vN=t=>t.split("").map(n=>+n).reduce((n,r,s)=>s%2?n+r*9:n+r*3,0)%10;class _N extends Na{constructor(e,n){super(e,n)}valid(){return this.data.search(/^[0-9]{5}$/)!==-1}encode(){const e=mN[vN(this.data)];return{data:"1011"+qo(this.data,e,"01"),text:this.text}}}class bN extends Na{constructor(e,n){super(e,n)}valid(){return this.data.search(/^[0-9]{2}$/)!==-1}encode(){const e=fN[parseInt(this.data)%4];return{data:"1011"+qo(this.data,e,"01"),text:this.text}}}class MN extends Na{constructor(e,n){e.search(/^[0-9]{11}$/)!==-1&&(e+=P1(e)),super(e,n),this.displayValue=n.displayValue,n.fontSize>n.width*10?this.fontSize=n.width*10:this.fontSize=n.fontSize,this.guardHeight=n.height+this.fontSize/2+n.textMargin}valid(){return this.data.search(/^[0-9]{12}$/)!==-1&&this.data[11]==P1(this.data)}encode(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}flatEncoding(){var e="";return e+="101",e+=qo(this.data.substr(0,6),"LLLLLL"),e+="01010",e+=qo(this.data.substr(6,6),"RRRRRR"),e+="101",{data:e,text:this.text}}guardedEncoding(){var e=[];return this.displayValue&&e.push({data:"00000000",text:this.text.substr(0,1),options:{textAlign:"left",fontSize:this.fontSize}}),e.push({data:"101"+qo(this.data[0],"L"),options:{height:this.guardHeight}}),e.push({data:qo(this.data.substr(1,5),"LLLLL"),text:this.text.substr(1,5),options:{fontSize:this.fontSize}}),e.push({data:"01010",options:{height:this.guardHeight}}),e.push({data:qo(this.data.substr(6,5),"RRRRR"),text:this.text.substr(6,5),options:{fontSize:this.fontSize}}),e.push({data:qo(this.data[11],"R")+"101",options:{height:this.guardHeight}}),this.displayValue&&e.push({data:"00000000",text:this.text.substr(11,1),options:{textAlign:"right",fontSize:this.fontSize}}),e}}function P1(t){var e=0,n;for(n=1;n<11;n+=2)e+=parseInt(t[n]);for(n=0;n<11;n+=2)e+=parseInt(t[n])*3;return(10-e%10)%10}const wN=["XX00000XXX","XX10000XXX","XX20000XXX","XXX00000XX","XXXX00000X","XXXXX00005","XXXXX00006","XXXXX00007","XXXXX00008","XXXXX00009"],AN=[["EEEOOO","OOOEEE"],["EEOEOO","OOEOEE"],["EEOOEO","OOEEOE"],["EEOOOE","OOEEEO"],["EOEEOO","OEOOEE"],["EOOEEO","OEEOOE"],["EOOOEE","OEEEOO"],["EOEOEO","OEOEOE"],["EOEOOE","OEOEEO"],["EOOEOE","OEEOEO"]];class EN extends Na{constructor(e,n){if(super(e,n),this.isValid=!1,e.search(/^[0-9]{6}$/)!==-1)this.middleDigits=e,this.upcA=xA(e,"0"),this.text=n.text||`${this.upcA[0]}${e}${this.upcA[this.upcA.length-1]}`,this.isValid=!0;else if(e.search(/^[01][0-9]{7}$/)!==-1)if(this.middleDigits=e.substring(1,e.length-1),this.upcA=xA(this.middleDigits,e[0]),this.upcA[this.upcA.length-1]===e[e.length-1])this.isValid=!0;else return;else return;this.displayValue=n.displayValue,n.fontSize>n.width*10?this.fontSize=n.width*10:this.fontSize=n.fontSize,this.guardHeight=n.height+this.fontSize/2+n.textMargin}valid(){return this.isValid}encode(){return this.options.flat?this.flatEncoding():this.guardedEncoding()}flatEncoding(){var e="";return e+="101",e+=this.encodeMiddleDigits(),e+="010101",{data:e,text:this.text}}guardedEncoding(){var e=[];return this.displayValue&&e.push({data:"00000000",text:this.text[0],options:{textAlign:"left",fontSize:this.fontSize}}),e.push({data:"101",options:{height:this.guardHeight}}),e.push({data:this.encodeMiddleDigits(),text:this.text.substring(1,7),options:{fontSize:this.fontSize}}),e.push({data:"010101",options:{height:this.guardHeight}}),this.displayValue&&e.push({data:"00000000",text:this.text[7],options:{textAlign:"right",fontSize:this.fontSize}}),e}encodeMiddleDigits(){const e=this.upcA[0],n=this.upcA[this.upcA.length-1],r=AN[parseInt(n)][parseInt(e)];return qo(this.middleDigits,r)}}function xA(t,e){const n=parseInt(t[t.length-1]),r=wN[n];let s="",u=0;for(let h=0;h<r.length;h++){let o=r[h];o==="X"?s+=t[u++]:s+=o}return s=`${e}${s}`,`${s}${P1(s)}`}class TN extends Na{constructor(e,n){e.search(/^[0-9\-\$\:\.\+\/]+$/)===0&&(e="A"+e+"A"),super(e.toUpperCase(),n),this.text=this.options.text||this.text.replace(/[A-D]/g,"")}valid(){return this.data.search(/^[A-D][0-9\-\$\:\.\+\/]+[A-D]$/)!==-1}encode(){for(var e=[],n=this.getEncodings(),r=0;r<this.data.length;r++)e.push(n[this.data.charAt(r)]),r!==this.data.length-1&&e.push("0");return{text:this.text,data:e.join("")}}getEncodings(){return{0:"101010011",1:"101011001",2:"101001011",3:"110010101",4:"101101001",5:"110101001",6:"100101011",7:"100101101",8:"100110101",9:"110100101","-":"101001101",$:"101100101",":":"1101011011","/":"1101101011",".":"1101101101","+":"1011011011",A:"1011001001",B:"1001001011",C:"1010010011",D:"1010011001"}}}const PN={CODE39:X6,CODE128:cN,CODE128A:uN,CODE128B:hN,CODE128C:dN,EAN13:yN,EAN8:xN,EAN5:_N,EAN2:bN,UPC:MN,UPCE:EN,codabar:TN};class Ol extends p.McDbCustomEntity{constructor(e){super(e),this.position=new p.McGePoint3d,this.textHeight=120,this.text="",this.codeHeight=300,this.codeWidth=10,this.codeType="CODE39",this.codeContent="ABCDEFG",this.showText=!1,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Ol(e)}getTypeName(){return"McDbTestBarCode"}set barCodePos(e){this.position=e.clone()}get barCodePos(){return this.position}set barCodeText(e){this.text=e}get barCodeText(){return this.text}set barCodeHeight(e){this.codeHeight=e}get barCodeHeight(){return this.codeHeight}set barCodeType(e){this.codeType=e}get barCodeType(){return this.codeType}set barCodeWidth(e){this.codeWidth=e}get barCodeWidth(){return this.codeWidth}set barCodeTextHeight(e){this.textHeight=e}get barCodeHeigth(){return this.textHeight}set barCodeShowText(e){this.showText=e}get barCodeShowText(){return this.showText}set barCodeContent(e){this.codeContent=e}get barCodeContent(){return this.codeContent}dwgInFields(e){this.position=e.readPoint("position").val,this.codeWidth=e.readDouble("codeWidth").val,this.codeHeight=e.readDouble("codeHeight").val,this.textHeight=e.readDouble("textHeight").val,this.text=e.readString("text").val,this.codeType=e.readString("codeType").val,this.codeContent=e.readString("codeContent").val;const n=e.readLong("showText").val;return this.showText=!!n,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){e.writePoint("position",this.position),e.writeDouble("codeWidth",this.codeWidth),e.writeDouble("codeHeight",this.codeHeight),e.writeString("text",this.text),e.writeDouble("textHeight",this.textHeight),e.writeString("codeType",this.codeType),e.writeString("codeContent",this.codeContent);const n=this.showText?1:0;return e.writeLong("showText",n),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0&&(this.position.x+=n,this.position.y+=r,this.position.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e}worldDraw(e){const n=[],r=new PN[this.codeType](this.codeContent,{flat:!0});if(!r.valid())return alert("条形码类型与内容不匹配！请重新设置！");let s=r.encode();const u=p.McGeVector3d.kYAxis.clone().mult(this.codeHeight),h=p.McGeVector3d.kXAxis.clone().mult(this.codeWidth);if(s.data.split("").forEach((o,m)=>{const y=new p.McDbHatch,x=new p.McGePoint3d(this.position.x+m*this.codeWidth,this.position.y,this.position.z),M=x.clone().addvec(u),A=M.clone().addvec(h),T=x.clone().addvec(h),P=new p.McGePoint3dArray([x,M,A,T]);y.appendLoop(P),o=="1"&&(e.drawEntity(y),n.push(y))}),this.showText){const o=this.getCodeText();e.drawEntity(o),n.push(o)}this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}getCodeText(){this.text||(this.text=this.codeContent);const e=new p.McDbText;e.textString=this.text,e.height=this.textHeight;const n=p.McGeVector3d.kYAxis.clone().negate().mult(this.textHeight*(4/3));return e.position=e.alignmentPoint=this.position.clone().addvec(n),e.horizontalMode=p.McDb.TextHorzMode.kTextLeft,e}transformBy(e){return this.position.transformBy(e),!0}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function SN(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD();t.newFile(),t.setViewBackgroundColor(255,255,255);const e=new Ol;e.barCodePos=new p.McGePoint3d(100,100,0),e.barCodeShowText=!0,t.drawEntity(e);const n=new Ol;n.barCodeContent="A little test!",n.barCodeType="CODE128",n.barCodePos=new p.McGePoint3d(-2e3,100,0),n.barCodeShowText=!0,t.drawEntity(n);const r=new Ol;r.barCodeContent="5901234123457",r.barCodeType="EAN13",r.barCodePos=new p.McGePoint3d(-2e3,-800,0),r.barCodeShowText=!0,t.drawEntity(r);const s=new Ol;s.barCodeContent="C1234567890D",s.barCodeType="codabar",s.barCodePos=new p.McGePoint3d(100,-800,0),s.barCodeShowText=!0,t.drawEntity(s),t.zoomAll(),t.zoomScale(4)})}var jl;(function(){function t(U){this.mode=n.MODE_8BIT_BYTE,this.data=U,this.parsedData=[];for(var H=0,V=this.data.length;H<V;H++){var W=[],K=this.data.charCodeAt(H);K>65536?(W[0]=240|(K&1835008)>>>18,W[1]=128|(K&258048)>>>12,W[2]=128|(K&4032)>>>6,W[3]=128|K&63):K>2048?(W[0]=224|(K&61440)>>>12,W[1]=128|(K&4032)>>>6,W[2]=128|K&63):K>128?(W[0]=192|(K&1984)>>>6,W[1]=128|K&63):W[0]=K,this.parsedData.push(W)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}t.prototype={getLength:function(U){return this.parsedData.length},write:function(U){for(var H=0,V=this.parsedData.length;H<V;H++)U.put(this.parsedData[H],8)}};function e(U,H){this.typeNumber=U,this.errorCorrectLevel=H,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}e.prototype={addData:function(U){var H=new t(U);this.dataList.push(H),this.dataCache=null},isDark:function(U,H){if(U<0||this.moduleCount<=U||H<0||this.moduleCount<=H)throw new Error(U+","+H);return this.modules[U][H]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(U,H){this.moduleCount=this.typeNumber*4+17,this.modules=new Array(this.moduleCount);for(var V=0;V<this.moduleCount;V++){this.modules[V]=new Array(this.moduleCount);for(var W=0;W<this.moduleCount;W++)this.modules[V][W]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(U,H),this.typeNumber>=7&&this.setupTypeNumber(U),this.dataCache==null&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,H)},setupPositionProbePattern:function(U,H){for(var V=-1;V<=7;V++)if(!(U+V<=-1||this.moduleCount<=U+V))for(var W=-1;W<=7;W++)H+W<=-1||this.moduleCount<=H+W||(0<=V&&V<=6&&(W==0||W==6)||0<=W&&W<=6&&(V==0||V==6)||2<=V&&V<=4&&2<=W&&W<=4?this.modules[U+V][H+W]=!0:this.modules[U+V][H+W]=!1)},getBestMaskPattern:function(){for(var U=0,H=0,V=0;V<8;V++){this.makeImpl(!0,V);var W=u.getLostPoint(this);(V==0||U>W)&&(U=W,H=V)}return H},createMovieClip:function(U,H,V){var W=U.createEmptyMovieClip(H,V),K=1;this.make();for(var Z=0;Z<this.modules.length;Z++)for(var tt=Z*K,at=0;at<this.modules[Z].length;at++){var st=at*K,nt=this.modules[Z][at];nt&&(W.beginFill(0,100),W.moveTo(st,tt),W.lineTo(st+K,tt),W.lineTo(st+K,tt+K),W.lineTo(st,tt+K),W.endFill())}return W},setupTimingPattern:function(){for(var U=8;U<this.moduleCount-8;U++)this.modules[U][6]==null&&(this.modules[U][6]=U%2==0);for(var H=8;H<this.moduleCount-8;H++)this.modules[6][H]==null&&(this.modules[6][H]=H%2==0)},setupPositionAdjustPattern:function(){for(var U=u.getPatternPosition(this.typeNumber),H=0;H<U.length;H++)for(var V=0;V<U.length;V++){var W=U[H],K=U[V];if(this.modules[W][K]==null)for(var Z=-2;Z<=2;Z++)for(var tt=-2;tt<=2;tt++)Z==-2||Z==2||tt==-2||tt==2||Z==0&&tt==0?this.modules[W+Z][K+tt]=!0:this.modules[W+Z][K+tt]=!1}},setupTypeNumber:function(U){for(var H=u.getBCHTypeNumber(this.typeNumber),V=0;V<18;V++){var W=!U&&(H>>V&1)==1;this.modules[Math.floor(V/3)][V%3+this.moduleCount-8-3]=W}for(var V=0;V<18;V++){var W=!U&&(H>>V&1)==1;this.modules[V%3+this.moduleCount-8-3][Math.floor(V/3)]=W}},setupTypeInfo:function(U,H){for(var V=this.errorCorrectLevel<<3|H,W=u.getBCHTypeInfo(V),K=0;K<15;K++){var Z=!U&&(W>>K&1)==1;K<6?this.modules[K][8]=Z:K<8?this.modules[K+1][8]=Z:this.modules[this.moduleCount-15+K][8]=Z}for(var K=0;K<15;K++){var Z=!U&&(W>>K&1)==1;K<8?this.modules[8][this.moduleCount-K-1]=Z:K<9?this.modules[8][15-K-1+1]=Z:this.modules[8][15-K-1]=Z}this.modules[this.moduleCount-8][8]=!U},mapData:function(U,H){for(var V=-1,W=this.moduleCount-1,K=7,Z=0,tt=this.moduleCount-1;tt>0;tt-=2)for(tt==6&&tt--;;){for(var at=0;at<2;at++)if(this.modules[W][tt-at]==null){var st=!1;Z<U.length&&(st=(U[Z]>>>K&1)==1);var nt=u.getMask(H,W,tt-at);nt&&(st=!st),this.modules[W][tt-at]=st,K--,K==-1&&(Z++,K=7)}if(W+=V,W<0||this.moduleCount<=W){W-=V,V=-V;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(U,H,V){for(var W=y.getRSBlocks(U,H),K=new x,Z=0;Z<V.length;Z++){var tt=V[Z];K.put(tt.mode,4),K.put(tt.getLength(),u.getLengthInBits(tt.mode,U)),tt.write(K)}for(var at=0,Z=0;Z<W.length;Z++)at+=W[Z].dataCount;if(K.getLengthInBits()>at*8)throw new Error("code length overflow. ("+K.getLengthInBits()+">"+at*8+")");for(K.getLengthInBits()+4<=at*8&&K.put(0,4);K.getLengthInBits()%8!=0;)K.putBit(!1);for(;!(K.getLengthInBits()>=at*8||(K.put(e.PAD0,8),K.getLengthInBits()>=at*8));)K.put(e.PAD1,8);return e.createBytes(K,W)},e.createBytes=function(U,H){for(var V=0,W=0,K=0,Z=new Array(H.length),tt=new Array(H.length),at=0;at<H.length;at++){var st=H[at].dataCount,nt=H[at].totalCount-st;W=Math.max(W,st),K=Math.max(K,nt),Z[at]=new Array(st);for(var ct=0;ct<Z[at].length;ct++)Z[at][ct]=255&U.buffer[ct+V];V+=st;var xt=u.getErrorCorrectPolynomial(nt),vt=new m(Z[at],xt.getLength()-1),Zt=vt.mod(xt);tt[at]=new Array(xt.getLength()-1);for(var ct=0;ct<tt[at].length;ct++){var ce=ct+Zt.getLength()-tt[at].length;tt[at][ct]=ce>=0?Zt.get(ce):0}}for(var le=0,ct=0;ct<H.length;ct++)le+=H[ct].totalCount;for(var fe=new Array(le),de=0,ct=0;ct<W;ct++)for(var at=0;at<H.length;at++)ct<Z[at].length&&(fe[de++]=Z[at][ct]);for(var ct=0;ct<K;ct++)for(var at=0;at<H.length;at++)ct<tt[at].length&&(fe[de++]=tt[at][ct]);return fe};for(var n={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},r={L:1,M:0,Q:3,H:2},s={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(U){for(var H=U<<10;u.getBCHDigit(H)-u.getBCHDigit(u.G15)>=0;)H^=u.G15<<u.getBCHDigit(H)-u.getBCHDigit(u.G15);return(U<<10|H)^u.G15_MASK},getBCHTypeNumber:function(U){for(var H=U<<12;u.getBCHDigit(H)-u.getBCHDigit(u.G18)>=0;)H^=u.G18<<u.getBCHDigit(H)-u.getBCHDigit(u.G18);return U<<12|H},getBCHDigit:function(U){for(var H=0;U!=0;)H++,U>>>=1;return H},getPatternPosition:function(U){return u.PATTERN_POSITION_TABLE[U-1]},getMask:function(U,H,V){switch(U){case s.PATTERN000:return(H+V)%2==0;case s.PATTERN001:return H%2==0;case s.PATTERN010:return V%3==0;case s.PATTERN011:return(H+V)%3==0;case s.PATTERN100:return(Math.floor(H/2)+Math.floor(V/3))%2==0;case s.PATTERN101:return H*V%2+H*V%3==0;case s.PATTERN110:return(H*V%2+H*V%3)%2==0;case s.PATTERN111:return(H*V%3+(H+V)%2)%2==0;default:throw new Error("bad maskPattern:"+U)}},getErrorCorrectPolynomial:function(U){for(var H=new m([1],0),V=0;V<U;V++)H=H.multiply(new m([1,h.gexp(V)],0));return H},getLengthInBits:function(U,H){if(1<=H&&H<10)switch(U){case n.MODE_NUMBER:return 10;case n.MODE_ALPHA_NUM:return 9;case n.MODE_8BIT_BYTE:return 8;case n.MODE_KANJI:return 8;default:throw new Error("mode:"+U)}else if(H<27)switch(U){case n.MODE_NUMBER:return 12;case n.MODE_ALPHA_NUM:return 11;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 10;default:throw new Error("mode:"+U)}else if(H<41)switch(U){case n.MODE_NUMBER:return 14;case n.MODE_ALPHA_NUM:return 13;case n.MODE_8BIT_BYTE:return 16;case n.MODE_KANJI:return 12;default:throw new Error("mode:"+U)}else throw new Error("type:"+H)},getLostPoint:function(U){for(var H=U.getModuleCount(),V=0,W=0;W<H;W++)for(var K=0;K<H;K++){for(var Z=0,tt=U.isDark(W,K),at=-1;at<=1;at++)if(!(W+at<0||H<=W+at))for(var st=-1;st<=1;st++)K+st<0||H<=K+st||at==0&&st==0||tt==U.isDark(W+at,K+st)&&Z++;Z>5&&(V+=3+Z-5)}for(var W=0;W<H-1;W++)for(var K=0;K<H-1;K++){var nt=0;U.isDark(W,K)&&nt++,U.isDark(W+1,K)&&nt++,U.isDark(W,K+1)&&nt++,U.isDark(W+1,K+1)&&nt++,(nt==0||nt==4)&&(V+=3)}for(var W=0;W<H;W++)for(var K=0;K<H-6;K++)U.isDark(W,K)&&!U.isDark(W,K+1)&&U.isDark(W,K+2)&&U.isDark(W,K+3)&&U.isDark(W,K+4)&&!U.isDark(W,K+5)&&U.isDark(W,K+6)&&(V+=40);for(var K=0;K<H;K++)for(var W=0;W<H-6;W++)U.isDark(W,K)&&!U.isDark(W+1,K)&&U.isDark(W+2,K)&&U.isDark(W+3,K)&&U.isDark(W+4,K)&&!U.isDark(W+5,K)&&U.isDark(W+6,K)&&(V+=40);for(var ct=0,K=0;K<H;K++)for(var W=0;W<H;W++)U.isDark(W,K)&&ct++;var xt=Math.abs(100*ct/H/H-50)/5;return V+=xt*10,V}},h={glog:function(U){if(U<1)throw new Error("glog("+U+")");return h.LOG_TABLE[U]},gexp:function(U){for(;U<0;)U+=255;for(;U>=256;)U-=255;return h.EXP_TABLE[U]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},o=0;o<8;o++)h.EXP_TABLE[o]=1<<o;for(var o=8;o<256;o++)h.EXP_TABLE[o]=h.EXP_TABLE[o-4]^h.EXP_TABLE[o-5]^h.EXP_TABLE[o-6]^h.EXP_TABLE[o-8];for(var o=0;o<255;o++)h.LOG_TABLE[h.EXP_TABLE[o]]=o;function m(U,H){if(U.length==null)throw new Error(U.length+"/"+H);for(var V=0;V<U.length&&U[V]==0;)V++;this.num=new Array(U.length-V+H);for(var W=0;W<U.length-V;W++)this.num[W]=U[W+V]}m.prototype={get:function(U){return this.num[U]},getLength:function(){return this.num.length},multiply:function(U){for(var H=new Array(this.getLength()+U.getLength()-1),V=0;V<this.getLength();V++)for(var W=0;W<U.getLength();W++)H[V+W]^=h.gexp(h.glog(this.get(V))+h.glog(U.get(W)));return new m(H,0)},mod:function(U){if(this.getLength()-U.getLength()<0)return this;for(var H=h.glog(this.get(0))-h.glog(U.get(0)),V=new Array(this.getLength()),W=0;W<this.getLength();W++)V[W]=this.get(W);for(var W=0;W<U.getLength();W++)V[W]^=h.gexp(h.glog(U.get(W))+H);return new m(V,0).mod(U)}};function y(U,H){this.totalCount=U,this.dataCount=H}y.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],y.getRSBlocks=function(U,H){var V=y.getRsBlockTable(U,H);if(V==null)throw new Error("bad rs block @ typeNumber:"+U+"/errorCorrectLevel:"+H);for(var W=V.length/3,K=[],Z=0;Z<W;Z++)for(var tt=V[Z*3+0],at=V[Z*3+1],st=V[Z*3+2],nt=0;nt<tt;nt++)K.push(new y(at,st));return K},y.getRsBlockTable=function(U,H){switch(H){case r.L:return y.RS_BLOCK_TABLE[(U-1)*4+0];case r.M:return y.RS_BLOCK_TABLE[(U-1)*4+1];case r.Q:return y.RS_BLOCK_TABLE[(U-1)*4+2];case r.H:return y.RS_BLOCK_TABLE[(U-1)*4+3];default:return}};function x(){this.buffer=[],this.length=0}x.prototype={get:function(U){var H=Math.floor(U/8);return(this.buffer[H]>>>7-U%8&1)==1},put:function(U,H){for(var V=0;V<H;V++)this.putBit((U>>>H-V-1&1)==1)},getLengthInBits:function(){return this.length},putBit:function(U){var H=Math.floor(this.length/8);this.buffer.length<=H&&this.buffer.push(0),U&&(this.buffer[H]|=128>>>this.length%8),this.length++}};var M=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function A(){return typeof CanvasRenderingContext2D!="undefined"}function T(){var U=!1,H=navigator.userAgent;if(/android/i.test(H)){U=!0;var V=H.toString().match(/android ([0-9]\.[0-9])/i);V&&V[1]&&(U=parseFloat(V[1]))}return U}var P=function(){var U=function(H,V){this._el=H,this._htOption=V};return U.prototype.draw=function(H){var V=this._htOption,W=this._el,K=H.getModuleCount();Math.floor(V.width/K),Math.floor(V.height/K),this.clear();function Z(ct,xt){var vt=document.createElementNS("http://www.w3.org/2000/svg",ct);for(var Zt in xt)xt.hasOwnProperty(Zt)&&vt.setAttribute(Zt,xt[Zt]);return vt}var tt=Z("svg",{viewBox:"0 0 "+String(K)+" "+String(K),width:"100%",height:"100%",fill:V.colorLight});tt.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),W.appendChild(tt),tt.appendChild(Z("rect",{fill:V.colorLight,width:"100%",height:"100%"})),tt.appendChild(Z("rect",{fill:V.colorDark,width:"1",height:"1",id:"template"}));for(var at=0;at<K;at++)for(var st=0;st<K;st++)if(H.isDark(at,st)){var nt=Z("use",{x:String(st),y:String(at)});nt.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),tt.appendChild(nt)}},U.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},U}(),D=document.documentElement.tagName.toLowerCase()==="svg",k=D?P:A()?function(){function U(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function H(W,K){var Z=this;if(Z._fFail=K,Z._fSuccess=W,Z._bSupportDataURI===null){var tt=document.createElement("img"),at=function(){Z._bSupportDataURI=!1,Z._fFail&&Z._fFail.call(Z)},st=function(){Z._bSupportDataURI=!0,Z._fSuccess&&Z._fSuccess.call(Z)};tt.onabort=at,tt.onerror=at,tt.onload=st,tt.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return}else Z._bSupportDataURI===!0&&Z._fSuccess?Z._fSuccess.call(Z):Z._bSupportDataURI===!1&&Z._fFail&&Z._fFail.call(Z)}var V=function(W,K){this._bIsPainted=!1,this._android=T(),this._htOption=K,W&&(this._elCanvas=document.createElement("canvas"),this._elCanvas.width=K.width,this._elCanvas.height=K.height,W.appendChild(this._elCanvas),this._el=W,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null)};return V.prototype.draw=function(W){var K=this._elImage,Z=this._oContext,tt=this._htOption,at=W.getModuleCount(),st=tt.width/at,nt=tt.height/at,ct=Math.round(st),xt=Math.round(nt);K.style.display="none",this.clear();for(var vt=0;vt<at;vt++)for(var Zt=0;Zt<at;Zt++){var ce=W.isDark(vt,Zt),le=Zt*st,fe=vt*nt;Z.strokeStyle=ce?tt.colorDark:tt.colorLight,Z.lineWidth=1,Z.fillStyle=ce?tt.colorDark:tt.colorLight,Z.fillRect(le,fe,st,nt),Z.strokeRect(Math.floor(le)+.5,Math.floor(fe)+.5,ct,xt),Z.strokeRect(Math.ceil(le)-.5,Math.ceil(fe)-.5,ct,xt)}this._bIsPainted=!0},V.prototype.drawMxcadHatch=function(W){const K=[];for(var Z=this._htOption,tt=W.getModuleCount(),at=Z.width/tt,st=Z.height/tt,nt=0;nt<tt;nt++)for(var ct=0;ct<tt;ct++){var xt=W.isDark(nt,ct),vt=ct*at,Zt=nt*st;if(xt){const ce=new p.McGePoint3d(vt,Zt,0),le=p.McGeVector3d.kYAxis.clone().negate().mult(st),fe=p.McGeVector3d.kXAxis.clone().mult(at),de=ce.clone().addvec(le),Le=ce.clone().addvec(fe),Lt=ce.clone().addvec(fe).addvec(le),bt=new p.McDbHatch,qt=new p.McGePoint3dArray([ce,de,Lt,Le]);bt.appendLoop(qt),K.push(bt)}}return K},V.prototype.makeImage=function(){this._bIsPainted&&H.call(this,U)},V.prototype.isPainted=function(){return this._bIsPainted},V.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},V.prototype.round=function(W){return W&&Math.floor(W*1e3)/1e3},V}():function(){var U=function(H,V){this._el=H,this._htOption=V};return U.prototype.draw=function(H){for(var V=this._htOption,W=this._el,K=H.getModuleCount(),Z=Math.floor(V.width/K),tt=Math.floor(V.height/K),at=['<table style="border:0;border-collapse:collapse;">'],st=0;st<K;st++){at.push("<tr>");for(var nt=0;nt<K;nt++)at.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+Z+"px;height:"+tt+"px;background-color:"+(H.isDark(st,nt)?V.colorDark:V.colorLight)+';"></td>');at.push("</tr>")}at.push("</table>"),W.innerHTML=at.join("");var ct=W.childNodes[0],xt=(V.width-ct.offsetWidth)/2,vt=(V.height-ct.offsetHeight)/2;xt>0&&vt>0&&(ct.style.margin=vt+"px "+xt+"px")},U.prototype.clear=function(){this._el.innerHTML=""},U}();function z(U,H){for(var V=1,W=O(U),K=0,Z=M.length;K<=Z;K++){var tt=0;switch(H){case r.L:tt=M[K][0];break;case r.M:tt=M[K][1];break;case r.Q:tt=M[K][2];break;case r.H:tt=M[K][3];break}if(W<=tt)break;V++}if(V>M.length)throw new Error("Too long data");return V}function O(U){var H=encodeURI(U).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return H.length+(H.length!=U?3:0)}jl=function(U,H){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:r.H},typeof H=="string"&&(H={text:H}),H)for(var V in H)this._htOption[V]=H[V];typeof U=="string"&&(U=document.getElementById(U)),this._htOption.useSVG&&(k=P),this._android=T(),this._el=U,this._oQRCode=null,this._oDrawing=new k(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},jl.prototype.makeCode=function(U){this._oQRCode=new e(z(U,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(U),this._oQRCode.make(),this._el.title=U,this._oDrawing.draw(this._oQRCode),this.makeImage()},jl.prototype.makeMxcadCode=function(U){return this._oQRCode=new e(z(U,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(U),this._oQRCode.make(),this._oDrawing.drawMxcadHatch(this._oQRCode)},jl.prototype.makeImage=function(){typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},jl.prototype.clear=function(){this._oDrawing.clear()},jl.CorrectLevel=r})();class Ig extends p.McDbCustomEntity{constructor(e){super(e),this.position=new p.McGePoint3d,this.codeHeight=300,this.codeWidth=10,this.codeContent="https://demo.mxdraw3d.com:3000/mxcad/",this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Ig(e)}getTypeName(){return"McDbTestQrCode"}set qrCodePos(e){this.position=e.clone()}get qrCodePos(){return this.position}set qrCodeHeight(e){this.codeHeight=e}get qarCodeHeight(){return this.codeHeight}set qrCodeWidth(e){this.codeWidth=e}get qrCodeWidth(){return this.codeWidth}set qrCodeContent(e){this.codeContent=e}get qrCodeContent(){return this.codeContent}dwgInFields(e){return this.position=e.readPoint("position").val,this.codeWidth=e.readDouble("codeWidth").val,this.codeHeight=e.readDouble("codeHeight").val,this.codeContent=e.readString("codeContent").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("position",this.position),e.writeDouble("codeWidth",this.codeWidth),e.writeDouble("codeHeight",this.codeHeight),e.writeString("codeContent",this.codeContent),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0&&(this.position.x+=n,this.position.y+=r,this.position.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.position),e}worldDraw(e){const n=[];new jl("",{width:this.codeWidth,height:this.codeHeight}).makeMxcadCode(this.codeContent).forEach(u=>{const h=u.clone();h.move(new p.McGePoint3d(0,0,0),this.position),e.drawEntity(h),n.push(h)}),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}transformBy(e){return this.position.transformBy(e),!0}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function CN(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD();t.newFile();const e=new Ig;e.qrCodePos=new p.McGePoint3d(1e3,1e3,0),e.qrCodeContent="https://demo.mxdraw3d.com:3000/mxcad/",e.qrCodeWidth=1500,e.qrCodeHeight=1500,t.drawEntity(e),t.zoomAll()})}function DN(){new Ol().rxInit(),new Ig().rxInit(),MxPluginContext.addCommand("Mx_TestDrawBarCode",SN),MxPluginContext.addCommand("Mx_TestdrawQrCode",CN)}function RN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请设置道路起点"));const e=yield t.go();if(!e)return;let n=e.clone();const r=30,s=20,u=p.MxCpp.getCurrentMxCAD(),h=u.getDatabase().getCurrentlyLayerName();for(;;){const o=new p.MxCADUiPrPoint;o.setMessage(G("请设置下一点")),o.setBasePt(n),o.setUserDraw((x,M)=>{const A=new p.McDbLine(n,x);M.drawMcDbEntity(A);const T=n.sub(x).perpVector().normalize().mult(r),P=x.clone().addvec(T),D=x.clone().subvec(T);A.offsetCurves(r,P).forEach(k=>{M.drawMcDbEntity(k)}),A.offsetCurves(r,D).forEach(k=>{M.drawMcDbEntity(k)})});const m=yield o.go();if(!m)break;const y=new LN;y.startPt=n,y.endPt=m,y.drawRoads(),y.radius=s,n=m.clone()}u.getDatabase().setCurrentlyLayerName(h)})}class LN{constructor(){this.offsetDist=30,this.radius=20,this.startPt=new p.McGePoint3d,this.endPt=new p.McGePoint3d,this.mxcad=p.MxCpp.getCurrentMxCAD(),this.dTol=1e-4,this.setLayer=()=>{const e=this.mxcad.getDatabase().getLayerTable();if(!e.has("ROAD_DOTE")){const n=this.mxcad.addLayer("ROAD_DOTE");n.getMcDbLayerTableRecord().color=new p.McCmColor(255,0,0)}if(!e.has("ROAD")){const n=this.mxcad.addLayer("ROAD");n.getMcDbLayerTableRecord().color=new p.McCmColor(255,255,0)}},this.drawRoads=()=>{this.setLayer();const e=new p.McDbLine(this.startPt,this.endPt);this.mxcad.getDatabase().setCurrentlyLayerName("ROAD_DOTE");const n=this.mxcad.drawEntity(e);this.processingCross(n)},this.drawOffsetEntity=(e,n=!0)=>{if(!e.length)return;const r=[];return this.mxcad.getDatabase().setCurrentlyLayerName("ROAD"),e.forEach(s=>{const u=s.getPointAtDist(s.getLength().val/2).val,h=s.getEndPoint().val.sub(s.getStartPoint().val).perpVector().normalize().mult(this.offsetDist),o=u.clone().addvec(h),m=u.clone().subvec(h);s.offsetCurves(this.offsetDist,o).forEach(y=>{r.push(y),n&&this.mxcad.drawEntity(y)}),s.offsetCurves(this.offsetDist,m).forEach(y=>{r.push(y),n&&this.mxcad.drawEntity(y)})}),r}}processingCross(e){const n=e.getMcDbEntity(),r=n.startPoint,s=n.endPoint;this.assessTheSituation(r,s,e)}processingRoundedCorners(e,n,r,s,u=!0){const h={curveArr:[new p.McDbCurve],objId:new p.McObjectId},o=(tt,at)=>{const st=at.distanceTo(tt.startPoint),nt=at.distanceTo(tt.endPoint);let ct,xt;return st>nt?(ct=tt.endPoint.sub(tt.startPoint),xt=new p.McDbLine(at,tt.startPoint)):(ct=tt.startPoint.sub(tt.endPoint),xt=new p.McDbLine(at,tt.endPoint)),{v:ct,newLine:xt}},m=e.IntersectWith(n,p.McDb.Intersect.kExtendBoth);if(m.length()!=1)return h;const y=m.at(0),{v:x,newLine:M}=o(e,y),{v:A,newLine:T}=o(n,y),P=x.angleTo2(A,p.McGeVector3d.kNegateZAxis);let D=r*Math.sin(Math.PI/2-P/2)/Math.sin(P/2);D<0&&(D=-D);const k=M.getPointAtDist(D).val,z=T.getPointAtDist(D).val,O=M.clone(),U=T.clone();M.startPoint=k,T.startPoint=z,O.rotate(k,Math.PI/2),U.rotate(z,Math.PI/2);const H=O.IntersectWith(U,p.McDb.Intersect.kExtendBoth);if(!H.length())return h;const V=H.at(0),K=new p.McDbLine(V,y).getPointAtDist(r).val;let Z=new p.McDbArc;return Z.computeArc(k.x,k.y,K.x,K.y,z.x,z.y),e.erase(),n.erase(),this.mxcad.getDatabase().setCurrentlyLayerName(s),this.mxcad.drawEntity(M),this.mxcad.drawEntity(Z),u||(T.visible=!1),h.objId=this.mxcad.drawEntity(T),h.curveArr=[M,T,Z],h}delectAllRoad(e,n=!0,r){if(!n&&!(r!=null&&r.length))return;const s=p.McGeVector3d.kXAxis.clone().mult(this.offsetDist+this.radius),u=p.McGeVector3d.kYAxis.clone().mult(this.offsetDist+this.radius),h=e.clone().addvec(s).addvec(u),o=e.clone().subvec(s).subvec(u),m=new p.MxCADResbuf;m.AddMcDbEntityTypes("LINE"),m.AddString("ROAD",8);const y=new p.MxCADSelectionSet;o.x>h.x?y.crossingSelect(o.x,o.y,h.x,h.y,m):y.crossingSelect(h.x,h.y,o.x,o.y,m),y.forEach(x=>{if(n)x.erase();else{const M=x.getMcDbEntity();r.forEach(A=>{const T=A.getStartPoint().val,P=A.getEndPoint().val,D=T.distanceTo(M.getClosestPointTo(T,!1).val),k=P.distanceTo(M.getClosestPointTo(P,!1).val),z=A.getPointAtDist(A.getLength().val/2).val;if(D<this.dTol){const O=z.sub(T),U=M.startPoint.sub(T),H=M.endPoint.sub(T);U.angleTo1(O)<Math.PI/2&&(M.startPoint=T),H.angleTo1(O)<Math.PI/2&&(M.endPoint=T)}else if(k<this.dTol){const O=z.sub(P),U=M.startPoint.sub(P),H=M.endPoint.sub(P);U.angleTo1(O)<Math.PI/2&&(M.startPoint=P),H.angleTo1(O)<Math.PI/2&&(M.endPoint=P)}})}})}assessTheSituation(e,n,r){const s=n.sub(e).normalize().mult(e.distanceTo(n)/5),u=s.angleTo1(p.McGeVector3d.kYAxis);(u<this.dTol||Math.abs(Math.PI-u)<this.dTol||Math.abs(u-Math.PI/2)<this.dTol)&&s.rotateBy(Math.PI/12);const h=e.clone().subvec(s),o=n.clone().addvec(s),m=new p.MxCADResbuf;m.AddString("ROAD_DOTE",8),m.AddMcDbEntityTypes("LINE");const y=new p.MxCADSelectionSet;y.crossingSelect(h.x,h.y,o.x,o.y,m);const x=r.getMcDbEntity();let M=0;if(y.count()<1)return this.drawOffsetEntity([x]);const A=[],T=[],P=[];if(y.forEach(D=>{if(D.id!=r.id){const k=D.getMcDbEntity(),z=k.IntersectWith(x,p.McDb.Intersect.kExtendBoth);if(z.length()===1){const O=z.at(0),U=O.distanceTo(x.getClosestPointTo(O,!1).val),H=O.distanceTo(k.getClosestPointTo(O,!1).val);if(U<this.dTol&&H<this.dTol){M+=1;const V=x.startPoint.distanceTo(O),W=x.endPoint.distanceTo(O),K=k.startPoint.distanceTo(O),Z=k.endPoint.distanceTo(O);V>this.offsetDist&&W>this.offsetDist||K>this.offsetDist&&Z>this.offsetDist?P.push(k):V<=this.offsetDist&&(K<=this.offsetDist||Z<=this.offsetDist)?A.push(k):W<=this.offsetDist&&(K<=this.offsetDist||Z<=this.offsetDist)&&T.push(k)}}}}),M||this.drawOffsetEntity([x]),A.length&&!P.length&&!T.length&&A.forEach(D=>{this.handleTheBeginningAndEnd(D,x,x.startPoint,"start")}),T.length&&!P.length&&!A.length&&T.forEach(D=>{this.handleTheBeginningAndEnd(D,x,x.endPoint,"end")}),T.length===1&&!P.length&&A.length===1){const D=this.handleTheBeginningAndEnd(A[0],x,x.startPoint,"start");setTimeout(()=>{if(!D.objId)return;const k=D.objId.getMcDbEntity();this.handleTheBeginningAndEnd(T[0],k,x.endPoint),D.objId.erase()},10)}if(P.length&&!A.length&&!T.length&&this.processingCrossingRoad(P,x),P.length&&A.length&&!T.length){let D=new p.McDbLine;A.forEach(k=>{const z=this.processingRoundedCorners(k,x,this.radius+this.offsetDist,"ROAD_DOTE"),O=this.drawOffsetEntity([z.curveArr[2]]);k.getxData().AtString(0).val==="isCrossingLine"?this.delectAllRoad(x.startPoint,!1,O):(this.drawOffsetEntity([z.curveArr[0]]),this.delectAllRoad(x.startPoint)),D=z.objId.getMcDbEntity(),D.setxData(new p.MxCADResbuf([{type:p.DxfCode.kExDataName,val:"isCrossingLine"},{type:p.DxfCode.kString,val:"1"}]))}),setTimeout(()=>{this.processingCrossingRoad(P,D)},10)}if(P.length&&!A.length&&T.length){let D=new p.McDbLine;T.forEach(k=>{const z=this.processingRoundedCorners(k,x,this.radius+this.offsetDist,"ROAD_DOTE"),O=this.drawOffsetEntity([z.curveArr[2]]);k.getxData().AtString(0).val==="isCrossingLine"?this.delectAllRoad(x.startPoint,!1,O):(this.drawOffsetEntity([z.curveArr[0]]),this.delectAllRoad(x.startPoint)),D=z.objId.getMcDbEntity(),D.setxData(new p.MxCADResbuf([{type:p.DxfCode.kExDataName,val:"isCrossingLine"},{type:p.DxfCode.kString,val:"1"}]))}),setTimeout(()=>{this.processingCrossingRoad(P,D)},10)}if(P.length&&A.length&&T.length){const D=this.handleTheBeginningAndEnd(A[0],x,x.startPoint);setTimeout(()=>{if(!D.objId)return;const k=D.objId.getMcDbEntity(),z=this.handleTheBeginningAndEnd(T[0],k,x.endPoint);D.objId.erase(),setTimeout(()=>{const O=z.objId.getMcDbEntity();this.processingCrossingRoad(P,O)})},10)}}crossRoundedCorners(e,n,r,s){const u=[];return n.forEach(h=>{const o=e.IntersectWith(h,p.McDb.Intersect.kOnBothOperands);if(o.length()>0){const m=o.at(0),y=m.sub(s),x=e.startPoint.sub(s),M=e.endPoint.sub(s),A=y.angleTo1(x),T=y.angleTo1(M);let P=new p.McDbLine;A<=Math.PI/2&&(P=new p.McDbLine(e.startPoint,m)),T<=Math.PI/2&&(P=new p.McDbLine(e.endPoint,m));const D=this.processingRoundedCorners(P,h,r,"ROAD",!1);u.push(D.curveArr[2])}}),u}getNewRoads(e,n,r){const s=p.McGeVector3d.kXAxis.clone().mult(this.offsetDist+this.radius),u=p.McGeVector3d.kYAxis.clone().mult(this.offsetDist+this.radius),h=e.clone().addvec(s).addvec(u),o=e.clone().subvec(s).subvec(u),m=new p.MxCADResbuf;m.AddMcDbEntityTypes("LINE"),m.AddString("ROAD",8);const y=new p.MxCADSelectionSet;y.crossingSelect(o.x,o.y,h.x,h.y,m);let x=new p.McDbLine,M=[],A=new p.McGePoint3d;y.forEach(P=>{const D=P.getMcDbEntity();D.getClosestPointTo(e,!1).val.sub(e).angleTo1(n)<Math.PI/2&&(x=D,M=this.drawOffsetEntity([r],!1),A=r.startPoint,D.highlight(!0))});const T=this.crossRoundedCorners(x,M,this.radius,A);return x.erase(),T}handleTheBeginningAndEnd(e,n,r,s){const u=this.processingRoundedCorners(e,n,this.radius+this.offsetDist,"ROAD_DOTE");if(e.getxData().AtString(0).val==="isCrossingLine"){s&&s=="start"&&this.drawOffsetEntity([u.curveArr[1]]),s&&s==="end"&&this.drawOffsetEntity([u.curveArr[0]]);const h=this.drawOffsetEntity([u.curveArr[2]]);return this.delectAllRoad(r,!1,h),u}else return this.drawOffsetEntity(u.curveArr),this.delectAllRoad(r),u}processingCrossingRoad(e,n){const r=(M,A,T)=>{M.forEach(P=>{const D=P.getStartPoint().val,k=P.getEndPoint().val,z=D.sub(A),O=k.sub(A),U=z.angleTo1(T),H=O.angleTo1(T);U<H?s([D],T):s([k],T)})},s=(M,A)=>{if(!o.length)o.push(...M);else{const T=M[0].sub(o[0]);T.angleTo1(A)<this.dTol||Math.abs(Math.PI-T.angleTo1(A))<this.dTol?o.push(...M):m.push(...M)}},u=this.drawOffsetEntity([n],!1),h=n.endPoint.sub(n.startPoint),o=[],m=[];let y=[];if(n.setxData(new p.MxCADResbuf([{type:p.DxfCode.kExDataName,val:"isCrossingLine"},{type:p.DxfCode.kString,val:"1"}])),e.forEach(M=>{M.setxData(new p.MxCADResbuf([{type:p.DxfCode.kExDataName,val:"isCrossingLine"},{type:p.DxfCode.kString,val:"1"}]));const A=M.IntersectWith(n,p.McDb.Intersect.kExtendBoth).at(0),T=n.startPoint.sub(A),P=n.endPoint.sub(A),D=new p.McDbLine(A,n.startPoint),k=new p.McDbLine(A,n.endPoint),z=A.distanceTo(n.startPoint)>this.dTol?this.getNewRoads(A,T,D):[],O=A.distanceTo(n.endPoint)>this.dTol?this.getNewRoads(A,P,k):[];z.length&&O.length&&z.forEach(U=>{const H=U.getStartPoint().val,V=U.getEndPoint().val,W=H.distanceTo(n.getClosestPointTo(H,!0).val),K=V.distanceTo(n.getClosestPointTo(V,!0).val);O.forEach(Z=>{const tt=Z.getStartPoint().val,at=tt.distanceTo(n.getClosestPointTo(tt,!0).val);if(Math.abs(at-this.offsetDist)<this.dTol){if(Math.abs(W-this.offsetDist)<this.dTol){const ct=tt.sub(H);(ct.angleTo1(h)<this.dTol||Math.abs(Math.PI-ct.angleTo1(h))<this.dTol)&&s([tt,H],h)}if(Math.abs(K-this.offsetDist)<this.dTol){const ct=tt.sub(V);(ct.angleTo1(h)<this.dTol||Math.abs(Math.PI-ct.angleTo1(h))<this.dTol)&&s([tt,V],h)}}const st=Z.getEndPoint().val,nt=st.distanceTo(n.getClosestPointTo(st,!0).val);if(Math.abs(nt-this.offsetDist)<this.dTol){if(Math.abs(W-this.offsetDist)<this.dTol){const ct=st.sub(H);(ct.angleTo1(h)<this.dTol||Math.abs(Math.PI-ct.angleTo1(h))<this.dTol)&&s([st,H],h)}if(Math.abs(K-this.offsetDist)<this.dTol){const ct=st.sub(V);(ct.angleTo1(h)<this.dTol||Math.abs(Math.PI-ct.angleTo1(h))<this.dTol)&&s([st,V],h)}}})}),z.length&&!O.length&&(r(z,A,T),y.push("end")),!z.length&&O.length&&(r(O,A,P),y.push("start"))}),!o.length||!m.length)return;const x=o[0].sub(u[0].getStartPoint().val);h.angleTo1(x)<this.dTol||Math.abs(Math.PI-h.angleTo1(x))<this.dTol?(this.countCrossRoadPt(u[0],o,y),this.countCrossRoadPt(u[1],m,y)):(this.countCrossRoadPt(u[1],o,y),this.countCrossRoadPt(u[0],m,y)),this.recombinationPtArr(o).forEach((M,A)=>{if(A%2===0){const T=new p.McDbLine(M,o[A+1]);this.mxcad.drawEntity(T)}}),this.recombinationPtArr(m).forEach((M,A)=>{if(A%2===0){const T=new p.McDbLine(M,m[A+1]);this.mxcad.drawEntity(T)}})}countCrossRoadPt(e,n,r){const s=e.getStartPoint().val,u=e.getEndPoint().val,h=s.distanceTo(n[0]),o=s.distanceTo(n[n.length-1]);h<o?((!r.length||!r.includes("start"))&&n.unshift(s),(!r.length||!r.includes("end"))&&n.push(u)):((!r.length||!r.includes("start"))&&n.push(s),(!r.length||!r.includes("end"))&&n.unshift(u))}recombinationPtArr(e){return e.sort((n,r)=>n.distanceTo(e[0])-r.distanceTo(e[0])),e}}function IN(){MxPluginContext.addCommand("Mx_drawRoads",RN)}function kN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrInt;t.setMessage(G(" 请输入星形顶点数："));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrPoint;n.setMessage(G(" 指定星形中心点:"));const r=yield n.go();if(!r)return;const s=new p.MxCADUiPrDist;s.setBasePt(r),s.setMessage(G("请设置星形的内半径:"));const u=yield s.go();let h;u?h=s.value():h=5;const o=new p.McDbCircle(r.x,r.y,r.z,h);let m=[];const y=new p.MxCADUiPrDist;if(y.setBasePt(r),y.setMessage(G(" 指定星形的外半径:")),y.setUserDraw((T,P)=>{let D=new p.McDbCircle(r.x,r.y,r.z,T.distanceTo(r)),k=o.getLength(),z=D.getLength();if(!k||!z)return;let O=[];for(let H=0;H<e*2;H++){let V=o.getPointAtDist(k.val/(e*2)*H);if(!V.ret)return;let W=D.getPointAtDist(z.val/(e*2)*H);if(!W.ret)return;H%2===0?O.push(V.val):O.push(W.val)}let U=new p.McDbPolyline;O.forEach(H=>{U.addVertexAt(H)}),U.isClosed=!0,P.drawMcDbEntity(U),m=[...O]}),!(yield y.go()))return;let M=p.MxCpp.getCurrentMxCAD(),A=new p.McDbPolyline;m.forEach(T=>{A.addVertexAt(T)}),A.isClosed=!0,M.drawEntity(A)})}function BN(){return Gt(this,null,function*(){let t=5;const e=new p.MxCADUiPrDist;e.setMessage(G(" 请输入凹凸线宽度<5>")),(yield e.go())&&(t=e.value());let r=10;const s=new p.MxCADUiPrDist;s.setMessage(G(" 请输入凹凸线高度<10>")),(yield s.go())&&(r=s.value());let h=new p.MxCADUiPrPoint;h.setMessage(G("请点击确定起始点"));let o=yield h.go();if(!o)return;let m=new p.MxCADUiPrPoint;m.setMessage(G("请点击确定终点")),m.setUserDraw((at,st)=>{let nt=new p.McDbLine(o.x,o.y,o.z,at.x,at.y,at.z);st.drawMcDbEntity(nt)});let y=yield m.go();if(!y)return;let x=new p.McDbLine(o.x,o.y,o.z,y.x,y.y,y.z),M=x.clone(),A=x.getLength(),T=x.getPointAtDist(A.val/2).val,P=p.McGeVector3d.kYAxis.angleTo1(p.McGeVector3d.kXAxis);M.rotate(T,P);let D=M.getPointAtDist(A.val/2+r/2).val,k=M.getPointAtDist(A.val/2-r/2).val,z=x.offsetCurves(r/2,D),O=x.offsetCurves(r/2,k),U=p.MxCpp.App.getCurrentMxCAD();if(z.length()===0||O.length()===0)return;let H,V;z.forEach(at=>{H=at.clone()}),O.forEach(at=>{V=at.clone()});let W=[],K=A.val/t;for(let at=0;at<K;at++)at%2===0?(W.push(H.getPointAtDist(t*at).val),W.push(V.getPointAtDist(t*at).val)):(W.push(V.getPointAtDist(t*at).val),W.push(H.getPointAtDist(t*at).val));let Z=new p.McDbPolyline;W.forEach(at=>{Z.addVertexAt(at)});let tt=x.getPointAtDist(t*parseInt(K.toString())).val;Z.setPointAt(0,x.startPoint),Z.setPointAt(W.length-1,tt),U.drawEntity(Z)})}function FN(){return Gt(this,null,function*(){let t=5;const e=new p.MxCADUiPrDist;e.setMessage(G(" 请输入锯齿线宽度<5>")),(yield e.go())&&(t=e.value());let r=10;const s=new p.MxCADUiPrDist;s.setMessage(G(" 请输入锯齿线高度<10>")),(yield s.go())&&(r=s.value());let h=new p.MxCADUiPrPoint;h.setMessage(G("请点击确定起始点"));let o=yield h.go();if(!o)return;let m=new p.MxCADUiPrPoint;m.setMessage(G("请点击确定终点")),m.setUserDraw((at,st)=>{let nt=new p.McDbLine(o.x,o.y,o.z,at.x,at.y,at.z);st.drawMcDbEntity(nt)});let y=yield m.go();if(!y)return;let x=new p.McDbLine(o.x,o.y,o.z,y.x,y.y,y.z),M=x.clone(),A=x.getLength(),T=x.getPointAtDist(A.val/2).val,P=p.McGeVector3d.kYAxis.angleTo1(p.McGeVector3d.kXAxis);M.rotate(T,P);let D=M.getPointAtDist(A.val/2+r/2).val,k=M.getPointAtDist(A.val/2-r/2).val,z=x.offsetCurves(r/2,D),O=x.offsetCurves(r/2,k),U=p.MxCpp.App.getCurrentMxCAD();if(z.length()===0||O.length()===0)return;let H,V;z.forEach(at=>{H=at.clone()}),O.forEach(at=>{V=at.clone()});let W=[],K=A.val/(t/2);for(let at=0;at<K;at++)at%2===0?W.push(H.getPointAtDist(t/2*at).val):W.push(V.getPointAtDist(t/2*at).val);let Z=new p.McDbPolyline;W.forEach(at=>{Z.addVertexAt(at)});let tt=x.getPointAtDist(t/2*parseInt(K.toString())).val;Z.setPointAt(0,x.startPoint),Z.setPointAt(W.length-1,tt),U.drawEntity(Z)})}function zN(){return Gt(this,null,function*(){let t=5;const e=new p.MxCADUiPrDist;e.setMessage(G(" 请输入矩形宽度<5>")),(yield e.go())&&(t=e.value());let r=10;const s=new p.MxCADUiPrDist;s.setMessage(G(" 请输入矩形高度<10>")),(yield s.go())&&(r=s.value());const h=A=>{const T=[];return T.push(new p.McGePoint3d(A.x+t/2,A.y+r/2,A.z)),T.push(new p.McGePoint3d(A.x-t/2,A.y+r/2,A.z)),T.push(new p.McGePoint3d(A.x-t/2,A.y-r/2,A.z)),T.push(new p.McGePoint3d(A.x+t/2,A.y-r/2,A.z)),T},o=new p.MxCADUiPrPoint;o.setMessage(G("请点击确定矩形中心")),o.setUserDraw((A,T)=>{const P=h(A);let D=new p.McDbPolyline;P.forEach(k=>{D.addVertexAt(k)}),D.isClosed=!0,T.drawMcDbEntity(D)});const m=yield o.go();if(!m)return;const y=h(m);let x=new p.McDbPolyline;y.forEach(A=>{x.addVertexAt(A)});const M=p.MxCpp.App.getCurrentMxCAD();x.isClosed=!0,M.drawEntity(x)})}function NN(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("CIRCLE");let e=yield p.MxCADUtility.userSelect(G("选择目标对象"),t);e.length!=0&&e.forEach(n=>Gt(this,null,function*(){let r=yield n.getMcDbEntity(),s=r.center,u=r.radius,h=p.MxCpp.App.getCurrentMxCAD(),o=new p.McDbLine(s.x+u*1.3,s.y,s.z,s.x-u*1.3,s.y,s.z);o.trueColor=new p.McCmColor(255,0,0);let m=new p.McDbLine(s.x,s.y+u*1.3,s.z,s.x,s.y-u*1.3,s.z);m.trueColor=new p.McCmColor(255,0,0),h.drawEntity(o),h.drawEntity(m)}))})}function UN(){return Gt(this,null,function*(){let t=10;const e=new p.MxCADUiPrDist;e.setMessage(G(" 请输入管径<10>")),(yield e.go())&&(t=e.value());let r=10;const s=new p.MxCADUiPrDist;s.setMessage(G(" 请输入长出管口长度<5>")),(yield s.go())&&(r=s.value());let h=new p.MxCADUiPrPoint;h.setMessage(G("请点击确定起点"));const o=yield h.go();if(!o)return;const m=new p.MxCADUiPrPoint;m.setMessage(G("请点击确定终点")),m.setUserDraw((V,W)=>{const K=new p.McDbLine(o.x,o.y,o.z,V.x,V.y,V.z);W.drawMcDbEntity(K)});const y=yield m.go();if(!y)return;const x=new p.McDbLine(o.x,o.y,o.z,y.x,y.y,y.z),M=p.MxCpp.App.getCurrentMxCAD();let A=x.getLength().val,T=x.getPointAtDist(A+r),P=x.getPointAtDist(0-r),D=x.getPointAtDist(A/2).val,k=p.McGeVector3d.kXAxis.angleTo1(p.McGeVector3d.kYAxis),z=x.clone();z.rotate(D,k);let O=z.getPointAtDist(A/2+t/2).val,U=z.getPointAtDist(A/2-t/2).val;x.offsetCurves(t/2,O).forEach(V=>{V.trueColor=new p.McCmColor(0,255,0),M.drawEntity(V)}),x.offsetCurves(t/2,U).forEach(V=>{V.trueColor=new p.McCmColor(0,255,0),M.drawEntity(V)});let H=M.addLinetypeEx("TestMyLine","25,-5");H.isValid()&&(x.linetypeId=H,x.endPoint=P.val,x.startPoint=T.val,x.trueColor=new p.McCmColor(255,0,0),M.drawEntity(x))})}function VN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("指定剖管线起点"));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrPoint;n.setMessage(G("指定剖管线终点")),n.setUserDraw((V,W)=>{let K=new p.McDbLine(e.x,e.y,e.z,V.x,V.y,V.z);W.drawMcDbEntity(K)});const r=yield n.go();if(!r)return;const s=new p.McDbLine(e.x,e.y,e.z,r.x,r.y,r.z),u=s.getLength().val,h=u/8,o=s.getPointAtDist(u/2).val,m=s.clone();m.rotate(o,Math.PI/2);const y=m.getPointAtDist(u/2+h).val,x=m.getPointAtDist(u/2-h).val,M=p.MxCpp.App.getCurrentMxCAD();let A;s.clone().offsetCurves(h,y).forEach(V=>{A=V});let T;s.clone().offsetCurves(h,x).forEach(V=>{T=V});const P=[],D=[];for(let V=0;V<4;V++)V%2!==0&&(P.push(A.getPointAtDist(V*h*2).val),D.push(T.getPointAtDist(V*h*2).val));let k,z=new p.McDbArc;z.computeArc(e.x,e.y,P[0].x,P[0].y,o.x,o.y),M.drawEntity(z);let O=new p.McDbArc;O.computeArc(e.x,e.y,D[0].x,D[0].y,o.x,o.y),M.drawEntity(O);let U=new p.McDbArc;U.computeArc(o.x,o.y,D[1].x,D[1].y,r.x,r.y),k=M.drawEntity(U);let H=new p.MxCADUiPrKeyWord;for(;;){H.setMessage(G("选择剖管线圆弧方向")),H.setKeyWords(`[${G("左边")}(L)/${G("右边")}(R)]`);const V=yield H.go();if(!V)return;if(V=="L"){let W=new p.McDbArc;k.erase(),W.computeArc(o.x,o.y,D[1].x,D[1].y,r.x,r.y),k=M.drawEntity(W)}else if(V=="R"){k.erase();let W=new p.McDbArc;W.computeArc(o.x,o.y,P[1].x,P[1].y,r.x,r.y),k=M.drawEntity(W)}}})}function GN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrKeyWord;t.setMessage(G("选择模式")),t.setKeyWords(`[${G("直线焊缝")}(L)/${G("弧线焊缝")}(A)]`);const e=yield t.go();if(!e)return;let n=5;const r=new p.MxCADUiPrDist;r.setMessage(G(" 请输入焊缝半径<5>")),(yield r.go())&&(n=r.value());let u=new p.McDbCurve;if(e==="L"){let A=new p.MxCADUiPrPoint;A.setMessage(G("请点击确定起始点"));let T=yield A.go();if(!T)return;let P=new p.MxCADUiPrPoint;P.setMessage(G("请点击确定终点")),P.setUserDraw((k,z)=>{let O=new p.McDbLine(T.x,T.y,T.z,k.x,k.y,k.z);z.drawMcDbEntity(O)});let D=yield P.go();if(!D)return;u=new p.McDbLine(T.x,T.y,T.z,D.x,D.y,D.z)}else if(e==="A"){let A=new p.MxCADUiPrPoint;A.setMessage(G("指定起点"));let T=yield A.go();if(!T)return;let P=new p.MxCADUiPrPoint;P.setMessage(G("指定圆弧的第二个点")),P.setUserDraw((U,H)=>{H.drawLine(T.toVector3(),U.toVector3())});let D=yield P.go();if(!D)return;let k=new p.MxCADUiPrPoint;k.setMessage(G("指定圆弧的端点")),k.setUserDraw((U,H)=>{let V=new p.McDbArc;V.computeArc(T.x,T.y,D.x,D.y,U.x,U.y),H.drawMcDbEntity(V)});let z=yield k.go();if(!z)return;let O=new p.McDbArc;O.computeArc(T.x,T.y,D.x,D.y,z.x,z.y),u=O}const h=p.MxCpp.App.getCurrentMxCAD();let m=u.getLength().val/n,y=[],x,M;e==="A"&&(x=u.center,M=u.radius);for(let A=0;A<m;A++){let T=u.getPointAtDist(n*A).val,P=new p.McDbCircle(T.x,T.y,T.z,n);const D=P.IntersectWith(u,p.McDb.Intersect.kExtendBoth);if(!D.length())return;let k=[];D.forEach(U=>{k.push(U)});let z=[],O=[];P.splitCurves(k).forEach((U,H)=>{if(e==="L")H%2!==0&&y.push(U);else if(e==="A"){let V=U.clone();V.getPointAtDist(V.getLength().val/2).val.distanceTo(x)>M?z.push(V):O.push(V)}}),z.length===1&&e==="A"?y.push(z[0]):e==="A"&&z.length>1&&(O[0].rotate(P.center,Math.PI),y.push(O[0]))}y.forEach((A,T)=>{if(T===0)h.drawEntity(A);else{let P=A.IntersectWith(y[T-1],p.McDb.Intersect.kExtendThis);if(P.length()===0)return;let D=[];P.forEach(O=>{D.push(O)});let k=[];A.splitCurves(D).forEach((O,U)=>{k.push({obj_cur:O,lenth:O.getLength().val})});let z=k.map(O=>O.lenth);h.drawEntity(k[z.indexOf(Math.max(...z))].obj_cur)}})})}function ON(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LINE,LWPOLYLINE");let e=yield p.MxCADUtility.userSelect(G("选择对象"),t);e.length!=0&&e.forEach(n=>Gt(this,null,function*(){let r=yield n.getMcDbEntity();if(!r)return;let s=r.clone(),u=s.getLength(),h=s.getPointAtDist(u.val/2).val;if(!s.getFirstDeriv(h).ret)return;let m=p.McGeVector3d.kYAxis.angleTo1(p.McGeVector3d.kXAxis);s.rotate(h,m);let y=p.MxCpp.App.getCurrentMxCAD();s.trueColor=new p.McCmColor(255,0,0),y.drawEntity(s)}))})}function jN(){return Gt(this,null,function*(){let t=25;const e=new p.MxCADUiPrDist;e.setMessage(G("请输入宽度<25>")),(yield e.go())&&(t=e.value());let r=15;const s=new p.MxCADUiPrDist;s.setMessage(G("请输入高度<15>")),(yield s.go())&&(r=s.value());const h=new p.MxCADUiPrInt;h.setMessage(G("请输入楼梯级数<10>"));const o=(yield h.go())||10,m=Math.sqrt(t*t+r*r),y=new p.MxCADUiPrPoint;y.setMessage(G("请点击确定起点"));const x=yield y.go();if(!x)return;const M=new p.MxCADUiPrPoint;M.setMessage(G("请点击确定终点")),M.setUserDraw((z,O)=>{const U=new p.McDbLine(x.x,x.y,x.z,z.x,z.y,z.z);O.drawMcDbEntity(U)});const A=yield M.go();if(!A)return;const T=new p.McDbLine(x.x,x.y,x.z,A.x,A.y,A.z),P=[];for(let z=0;z<o+1;z++){let O=T.getPointAtDist(m*z).val;P.push(O)}const D=new p.McDbPolyline;P.forEach((z,O)=>{if(D.addVertexAt(z),O!=P.length-1){let U=new p.McGePoint3d(z.x,P[O+1].y,z.z);D.addVertexAt(U)}}),p.MxCpp.App.getCurrentMxCAD().drawEntity(D)})}function HN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请确定圆心位置 "));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrDist;if(n.setBasePt(e),n.setMessage(G("请输入圆半径")),n.setUserDraw((h,o)=>{const m=h.distanceTo(e),y=new p.McDbCircle;y.center=e,y.radius=m,o.drawMcDbEntity(y)}),!(yield n.go()))return;const s=n.value(),u=p.MxCpp.getCurrentMxCAD();u.pathCircle(e.x,e.y,s),u.drawPathToHatch()})}function WN(){return Gt(this,null,function*(){let t=5;const e=new p.MxCADUiPrDist;e.setMessage(G(" 请输入保温棉宽度<5>")),(yield e.go())&&(t=e.value());let r=10;const s=new p.MxCADUiPrDist;s.setMessage(G(" 请输入保温棉高度<10>")),(yield s.go())&&(r=s.value());const h=new p.MxCADUiPrPoint;h.setMessage(G("请点击确定起点"));const o=yield h.go();if(!o)return;const m=new p.MxCADUiPrPoint;m.setMessage(G("请点击下一个点")),m.setUserDraw((K,Z)=>{const tt=new p.McDbLine(o.x,o.y,o.z,K.x,K.y,K.z);Z.drawMcDbEntity(tt)});const y=yield m.go();if(!y)return;const x=new p.McDbLine(o.x,o.y,o.z,y.x,y.y,y.z);o.y<y.y&&(x.startPoint=new p.McGePoint3d(y.x,y.y,y.z),x.endPoint=new p.McGePoint3d(o.x,o.y,o.z));const M=x.getPointAtDist(x.getLength().val/2).val,A=x.clone();A.rotate(M,Math.PI/2);const T=A.getPointAtDist(x.getLength().val/2+r/2).val,P=A.getPointAtDist(x.getLength().val/2-r/2).val;let D,k;x.offsetCurves(r/2,T).forEach(K=>{D=K}),x.offsetCurves(r/2,P).forEach(K=>{k=K});let z=x.getLength().val/t*2,O=[],U=[],H=[];for(let K=0;K<z;K++)if(K%2==0){let Z=k.getPointAtDist(K*(t/2)).val,tt=D.getPointAtDist(K*(t/2)).val;U.push(tt),O.push(Z)}else{let Z=D.getPointAtDist(K*(t/2)).val,tt=k.getPointAtDist(K*(t/2)).val;H.push(tt),O.push(Z)}const V=new p.McDbPolyline;O.forEach(K=>{V.addVertexAt(K)});const W=p.MxCpp.App.getCurrentMxCAD();W.drawEntity(V),U.forEach(K=>{const Z=new p.McDbArc;Z.center=K,Z.radius=t/2,Z.startAngle=-new p.McGeVector3d(x.endPoint.x-x.startPoint.x,x.endPoint.y-x.startPoint.y).angleTo1(p.McGeVector3d.kXAxis),Z.endAngle=new p.McGeVector3d(x.startPoint.x-x.endPoint.x,x.startPoint.y-x.endPoint.y).angleTo1(p.McGeVector3d.kXAxis),W.drawEntity(Z)}),H.forEach(K=>{const Z=new p.McDbArc;Z.center=K,Z.radius=t/2,Z.startAngle=new p.McGeVector3d(x.startPoint.x-x.endPoint.x,x.startPoint.y-x.endPoint.y).angleTo1(p.McGeVector3d.kXAxis),Z.endAngle=-new p.McGeVector3d(x.endPoint.x-x.startPoint.x,x.endPoint.y-x.startPoint.y).angleTo1(p.McGeVector3d.kXAxis),W.drawEntity(Z)})})}function qN(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LINE");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("请选择第一条线"));const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity(),s=new p.McDbLine(r.startPoint,r.endPoint),u=new p.MxCADUiPrEntity;u.setFilter(t),u.setMessage(G("请选择第二条线"));const h=yield u.go();if(!h.id)return;const o=h.getMcDbEntity(),m=new p.McDbLine(o.startPoint,o.endPoint),y=p.MxCpp.getCurrentMxCAD();let x=r.IntersectWith(m,p.McDb.Intersect.kExtendBoth);if(console.log(x.length()),x.length()===0){const M=r.getLength().val>o.getLength().val?o.clone():r.clone(),A=r.getLength().val>o.getLength().val?s:m,T=M.clone(),P=M.getPointAtDist(M.getLength().val/2).val;if(M.rotate(P,Math.PI/2),x=M.IntersectWith(A,p.McDb.Intersect.kExtendBoth),!x.length())return;const D=x.at(0).distanceTo(P)/2;T.offsetCurves(D,x.at(0)).forEach(k=>{k.trueColor=new p.McCmColor(255,0,0),y.drawEntity(k)})}else{const M=new p.McDbCircle;let A,T=s.endPoint.distanceTo(x.at(0)),P=s.startPoint.distanceTo(x.at(0));T!==0&&P!==0&&(T>P?s.startPoint=x.at(0):s.endPoint=x.at(0));let D=m.endPoint.distanceTo(x.at(0)),k=m.startPoint.distanceTo(x.at(0));D!==0&&k!==0&&(k>D?m.startPoint=x.at(0):m.endPoint=x.at(0)),s.getLength().val>m.getLength().val?(A=m.getLength().val,new p.McDbLine(o.startPoint,m.endPoint)):(A=r.getLength().val,new p.McDbLine(s.startPoint,s.endPoint)),M.center=x.at(0),M.radius=A;let z=M.IntersectWith(s,p.McDb.Intersect.kOnBothOperands),O=M.IntersectWith(m,p.McDb.Intersect.kOnBothOperands);if(!z.length()||!O.length())return;let U=z.at(0).sub(x.at(0)).angleTo2(p.McGeVector3d.kXAxis),H=O.at(0).sub(x.at(0)).angleTo2(p.McGeVector3d.kXAxis),V=new p.McDbArc;V.center=x.at(0),V.radius=A,V.startAngle=U,V.endAngle=H;const W=V.getPointAtDist(V.getLength().val/2).val,K=new p.McDbLine(x.at(0),W),Z=new p.MxCADUiPrPoint;Z.setMessage(G("请选择终点")),Z.setUserDraw((at,st)=>{let nt=K.getClosestPointTo(at,!0).val,ct=K.clone();ct.endPoint=nt,st.drawMcDbEntity(ct)});const tt=yield Z.go();if(!tt)return;K.endPoint=K.getClosestPointTo(tt,!0).val,K.trueColor=new p.McCmColor(255,0,0),y.drawEntity(K)}})}function YN(){return Gt(this,null,function*(){let t=new p.MxCADResbuf;t.AddMcDbEntityTypes("LWPOLYLINE");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("请选择目标矩形"));const n=yield e.go();if(!n.id)return;const r=n.getMcDbEntity();let s=[];const u=r.numVerts();for(let x=0;x<u;x++)s.push(r.getPointAt(x).val);const h=new p.MxCADUiPrPoint;let o;h.setUserDraw((x,M)=>{let A=[];s.forEach(P=>{A.push(P.distanceTo(x))}),o=A.findIndex(P=>P===Math.min(...A));let T=r.clone();T.setPointAt(o,x),M.drawMcDbEntity(T)});const m=yield h.go();if(!m)return;let y=r.clone();y.setPointAt(o,m),p.MxCpp.getCurrentMxCAD().drawEntity(y)})}function XN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("设置指北针中心点"));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrDist;if(n.setMessage(G("设置指北针半径")),n.setBasePt(e),n.setUserDraw((k,z)=>{const O=k.distanceTo(e);z.drawCircle(e.toVector3(),O)}),!(yield n.go()))return;const s=n.value(),u=p.MxCpp.App.getCurrentMxCAD(),h=new p.McDbCircle;h.trueColor=new p.McCmColor(0,255,0),h.center=e,h.radius=s,u.drawEntity(h);const o=new p.McGePoint3d(e.x,e.y+s),m=new p.McGePoint3d(e.x,e.y-s),y=new p.McDbLine;y.startPoint=o,y.endPoint=m;const x=y.clone();x.rotate(o,Math.PI/30);const M=y.clone();M.rotate(o,-Math.PI/30);let A,T;x.IntersectWith(h,p.McDb.Intersect.kOnBothOperands).forEach(k=>{k.x!==o.x&&k.y!==o.y&&(A=k)}),M.IntersectWith(h,p.McDb.Intersect.kOnBothOperands).forEach(k=>{k.x!==o.x&&k.y!==o.y&&(T=k)});let P=p.MxCADUtility.calcBulge(A,m,T);u.pathMoveToEx(A.x,A.y,0,0,P.val),u.pathLineTo(T.x,T.y),u.pathLineTo(o.x,o.y),u.pathLineTo(A.x,A.y),u.drawColor=new p.McCmColor(25,255,0),u.drawPathToHatch(1);const D=new p.McDbText;D.height=s/3,D.position=new p.McGePoint3d(e.x,e.y+s*1.2),D.alignmentPoint=D.position,D.textString="N",D.horizontalMode=p.McDb.TextHorzMode.kTextMid,D.trueColor=new p.McCmColor(25,255,0),u.drawEntity(D)})}function KN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrKeyWord;t.setMessage(G("选择提示框指向")),t.setKeyWords("[向上(U)/向下(D)]");const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrPoint;let r=p.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();n.setMessage(G(" 指定消息框第一点:"));let s=yield n.go();if(!s)return;let u=p.MxCpp.getCurrentMxCAD(),h=new $.MxDbRect;h.pt1=s.toVector3(),n.setUserDraw((z,O)=>{h.pt2=z.toVector3(),h.setColor(r),O.drawCustomEntity(h)}),n.setMessage(G(" 指定消息框第二点:")),n.setDynamicInputType($.DynamicInputType.kXYCoordInput);let o=yield n.go();if(!o)return;h.pt2=o.toVector3();let m=new p.McDbPolyline;m.isClosed=!0;let y;s.y>o.y&&e==="U"||s.y<o.y&&e==="D"?(y=new p.McDbLine(s,new p.McGePoint3d(o.x,s.y)),m.addVertexAt(new p.McGePoint3d(o.x,s.y)),m.addVertexAt(o),m.addVertexAt(new p.McGePoint3d(s.x,o.y)),m.addVertexAt(s)):(s.y>o.y&&e==="D"||s.y<o.y&&e==="U")&&(y=new p.McDbLine(o,new p.McGePoint3d(s.x,o.y)),m.addVertexAt(new p.McGePoint3d(s.x,o.y)),m.addVertexAt(s),m.addVertexAt(new p.McGePoint3d(o.x,s.y)),m.addVertexAt(o));const x=s.distanceTo(o)/6,M=y.getPointAtDist(x).val,A=y.getPointAtDist(y.getLength().val-x).val;y.startPoint=M,y.endPoint=A;const T=new p.MxCADUiPrPoint;T.setMessage(G(" 设置消息框指向:"));let P,D;T.setUserDraw((z,O)=>{const U=y.getClosestPointTo(z,!1).val;let H=m.getFirstDeriv(U);if(!H.ret)return;H.val.normalize().mult(x/4),P=U.clone(),P.addvec(H.val),D=U.clone(),D.subvec(H.val);let V=m.clone();V.addVertexAt(D),V.addVertexAt(z),V.addVertexAt(P),O.drawMcDbEntity(V)});let k=yield T.go();k&&(m.addVertexAt(D),m.addVertexAt(k),m.addVertexAt(P),u.drawEntity(m))})}class kg extends p.McDbCustomEntity{constructor(e){super(e),this.basePt=new p.McGePoint3d,this.symbolPos=new p.McGePoint3d,this.angle=null,this.size=30,this.text="A",this.isEntity=!1,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new kg(e)}getTypeName(){return"McDbTestDatumSymbol"}set datumBasePt(e){this.basePt=e.clone()}get datumBasePt(){return this.basePt}set symbolPosition(e){if(this.isEntity){const n=p.McGeVector3d.kXAxis.clone().rotateBy(this.angle).mult(this.size),r=this.basePt.clone().addvec(n.perpVector()),s=new p.McDbLine(r,this.basePt);this.symbolPos=s.getClosestPointTo(e,!0).val}else this.symbolPos=e.clone()}get symbolPosition(){return this.symbolPos}set symbolAngle(e){this.isEntity=!0,this.angle=e}get symbolAngle(){return this.angle}set symbolSize(e){this.size=e}get symbolSize(){return this.size}set symbolText(e){this.text=e}get symbolText(){return this.text}dwgInFields(e){this.basePt=e.readPoint("basePt").val,this.symbolPos=e.readPoint("symbolPos").val,this.angle=e.readDouble("angle").val,this.size=e.readDouble("size").val,this.text=e.readString("text").val;const n=e.readLong("isEntity").val;return this.isEntity=!!n,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){e.writePoint("basePt",this.basePt),e.writePoint("symbolPos",this.symbolPos),e.writeDouble("angle",this.angle),e.writeDouble("size",this.size),e.writeString("text",this.text);const n=this.isEntity?1:0;return e.writeLong("isEntity",n),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){if(this.assertWrite(),e===0)this.basePt.x+=n,this.basePt.y+=r,this.basePt.z+=s,this.symbolPos.x+=n,this.symbolPos.y+=r,this.symbolPos.z+=s,this.isEntity=!1;else if(e===1&&(this.symbolPos.x+=n,this.symbolPos.y+=r,this.symbolPos.z+=s,this.isEntity)){const u=p.McGeVector3d.kXAxis.clone().rotateBy(this.angle).mult(this.size),h=this.basePt.clone().addvec(u.perpVector()),o=new p.McDbLine(h,this.basePt);this.symbolPos=o.getClosestPointTo(this.symbolPos,!0).val}}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.basePt),e.append(this.symbolPos),e}worldDraw(e){const n=[],r=p.McGeVector3d.kXAxis.angleTo2(this.basePt.sub(this.symbolPos)),s=p.McGeVector3d.kXAxis,u=p.McGeVector3d.kYAxis,h=s.clone().mult(this.size/2),o=this.basePt.clone().addvec(h),m=this.basePt.clone().subvec(h),y=this.basePt.clone().addvec(h.clone().perpVector().mult(this.size*(4/5))),x=new p.McDbHatch,M=new p.McGePoint3dArray;M.append(o),M.append(m),M.append(y),x.appendLoop(M),x.rotate(this.basePt,Math.PI/2-r),e.drawEntity(x),n.push(x);const A=new p.McDbLine(this.basePt,this.symbolPos),T=this.symbolPos.sub(this.basePt),D=this.basePt.clone().addvec(T).clone().addvec(u.clone().negate().mult(this.size/2)),k=new p.McDbText;k.textString=this.text,k.height=this.size,k.position=D,k.alignmentPoint=k.position,k.horizontalMode=p.McDb.TextHorzMode.kTextMid,e.drawEntity(k),n.push(k);const z=D.clone().addvec(s.clone().mult(this.size*(3/4))).addvec(u.clone().negate().mult(this.size*(1/4))),O=D.clone().subvec(s.clone().mult(this.size*(3/4))).addvec(u.clone().negate().mult(this.size*(1/4))),U=O.clone().addvec(u.clone().mult(this.size*(3/2))),H=z.clone().addvec(u.clone().mult(this.size*(3/2))),V=new p.McDbPolyline;V.isClosed=!0,V.addVertexAt(z),V.addVertexAt(O),V.addVertexAt(U),V.addVertexAt(H),e.drawEntity(V),n.push(V),V.IntersectWith(A,p.McDb.Intersect.kOnBothOperands).forEach(W=>{const K=new p.McDbLine(W,this.basePt);e.drawEntity(K),n.push(K)}),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function ZN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrString;t.setMessage(G("请设置基准符文字"));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrDist;if(n.setMessage(G("请设置文字高度")),!(yield n.go()))return;const s=n.value(),u=new p.MxCADUiPrPoint;u.setMessage(G("请设置基准符位置"));const h=p.MxCpp.getCurrentMxCAD();let o=new p.McDbBlockReference;u.setUserDraw((y,x)=>{const M=new p.McDbPolyline;M.addVertexAt(new p.McGePoint3d(y.x+s,y.y,0),0,2,2),M.addVertexAt(new p.McGePoint3d(y.x-s,y.y,0));const A=new p.McDbLine(y,new p.McGePoint3d(y.x,y.y+s*(8/7),0)),T=new p.McDbCircle;T.center=new p.McGePoint3d(y.x,y.y+s*(15/7),0),T.radius=s;const P=new p.McDbText;P.textString=e,P.height=s,P.position=P.alignmentPoint=new p.McGePoint3d(y.x,y.y+s*(25/14),0),P.horizontalMode=p.McDb.TextHorzMode.kTextMid;let k=h.getDatabase().getBlockTable().add(new p.McDbBlockTableRecord),z=k.getMcDbBlockTableRecord();z!=null&&(z.appendAcDbEntity(M),z.appendAcDbEntity(A),z.appendAcDbEntity(T),z.appendAcDbEntity(P),z.name="基准符",z.origin=y,o.blockTableRecordId=k,o.position=y,x.drawMcDbEntity(o))}),(yield u.go())&&h.drawEntity(o)})}function JN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请设置定位点或圆弧或直线"));const e=yield t.go();if(!e)return;const n=new p.MxCADResbuf;n.AddMcDbEntityTypes("LINE,ARC,CIRCLE");let r=p.MxCADUtility.findEntAtPoint(e.x,e.y,e.z,-1,n);const s=new kg;if(s.datumBasePt=e,r.isValid()){const x=r.getMcDbEntity().getFirstDeriv(e).val.angleTo2(p.McGeVector3d.kXAxis);s.symbolAngle=x}const u=new p.MxCADUiPrPoint;u.setMessage(G("请设置符号位置")),u.setUserDraw((m,y)=>{s.symbolPosition=m,y.drawMcDbEntity(s)});const h=yield u.go();if(!h)return;s.symbolPosition=h,p.MxCpp.getCurrentMxCAD().drawEntity(s)})}function QN(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请设置圆心"));let e=yield t.go();if(!e)return;const n=p.MxCpp.getCurrentMxCAD();for(let r=1;r<4;r++){const s=new p.McDbCircle;s.center=e,s.radius=10*r,n.drawEntity(s)}})}function $N(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G("请设置齿轮圆心"));const e=yield t.go();if(!e)return;const n=new p.MxCADUiPrDist;n.setBasePt(e),n.setMessage(G("请设置齿轮半径")),n.setUserDraw((O,U)=>{const H=new p.McDbCircle;H.center=e,H.radius=O.distanceTo(e),U.drawMcDbEntity(H)});const r=yield n.go();let s=10;r&&(s=n.value());const u=p.MxCpp.getCurrentMxCAD(),h=new p.McDbCircle;h.center=e,h.radius=s;const o=30,m=h.getLength().val/(o*2),y=new p.McGePoint3d(e.x,e.y+s,e.z),x=h.getDistAtPoint(y).val,M=h.getPointAtDist(x+m/2).val,A=h.getPointAtDist(x-m/2).val,T=[],P=new p.McDbPolyline;P.addVertexAt(M),P.addVertexAt(new p.McGePoint3d(M.x,M.y+5,M.z)),P.addVertexAt(new p.McGePoint3d(A.x,A.y+5,A.z)),P.addVertexAt(A),T.push(P);for(let O=0;O<o*2;O++){let U=P.clone(),H=h.getPointAtDist(x+O*m);if(!H.ret)return;let V=H.val.sub(y),W=new p.McGeMatrix3d;W.setToTranslation(V),U.transformBy(W);let tt=h.getFirstDeriv(H.val).val.rotateBy(p.McGeVector3d.kYAxis.angleTo1(p.McGeVector3d.kXAxis)).negate().angleTo2(p.McGeVector3d.kYAxis,p.McGeVector3d.kNegateZAxis);U.rotate(H.val,tt),T.push(U)}const D=[];T.forEach((O,U)=>{U%2!==0&&(O.IntersectWith(h,p.McDb.Intersect.kOnBothOperands).forEach(V=>{D.push(V)}),u.drawEntity(O))});const k=new p.McDbArc,z=new p.McGePoint3d(e.x,e.y-s,e.z);k.computeArc(M.x,M.y,z.x,z.y,A.x,A.y),k.splitCurves(D).forEach((O,U)=>{U%2!==0&&u.drawEntity(O)})})}function tU(){return Gt(this,null,function*(){const t=new p.MxCADResbuf;t.AddMcDbEntityTypes("INSERT");const e=new p.MxCADUiPrEntity;e.setFilter(t),e.setMessage(G("请选择目标块"));const n=yield e.go();if(!n.id)return;const s=n.getMcDbEntity().getBoundingBox(),u=new p.McDbLine(s.minPt,s.maxPt),h=u.getPointAtDist(u.getLength().val/2).val,o=new p.MxCADUiPrDist;let m=10;o.setMessage(G(" 请设置中心线长度10>")),o.setBasePt(h),o.setUserDraw((z,O)=>{const U=z.distanceTo(h),H=h.clone().addvec(p.McGeVector3d.kXAxis.normalize().mult(U)),V=h.clone().addvec(p.McGeVector3d.kXAxis.normalize().mult(U).negate()),W=h.clone().addvec(p.McGeVector3d.kYAxis.normalize().mult(U)),K=h.clone().addvec(p.McGeVector3d.kYAxis.normalize().mult(U).negate()),Z=new p.McDbLine(H,V),tt=new p.McDbLine(W,K);O.drawMcDbEntity(Z),O.drawMcDbEntity(tt)}),(yield o.go())&&(m=o.value());const x=p.MxCpp.getCurrentMxCAD(),M=h.clone().addvec(p.McGeVector3d.kXAxis.normalize().mult(m)),A=h.clone().addvec(p.McGeVector3d.kXAxis.normalize().mult(m).negate()),T=h.clone().addvec(p.McGeVector3d.kYAxis.normalize().mult(m)),P=h.clone().addvec(p.McGeVector3d.kYAxis.normalize().mult(m).negate()),D=new p.McDbLine(M,A),k=new p.McDbLine(T,P);x.drawEntity(D),x.drawEntity(k)})}function eU(){return Gt(this,null,function*(){const t=new p.MxCADResbuf([p.DxfCode.kEntityType,"CIRCLE"]),e=p.MxCpp.getCurrentMxCAD(),n=new p.MxCADUiPrEntity;n.setFilter(t),n.setMessage(G("请选择第一个圆"));const r=yield n.go();if(!r)return;const s=new p.MxCADUiPrEntity;s.setFilter(t),s.setMessage(G("请选择第二个圆"));const u=yield s.go();if(!u)return;const h=r.getMcDbEntity(),o=u.getMcDbEntity(),m=h.center,y=o.center,x=m.sub(y).normalize(),M=m.clone().addvec(x.clone().perpVector().mult(h.radius)),A=y.clone().addvec(x.clone().perpVector().mult(o.radius)),T=new p.McDbLine(M,A);if(Math.abs(h.radius-o.radius)>1e-4){const P=new p.McDbLine(m,y),D=T.IntersectWith(P,p.McDb.Intersect.kExtendBoth);if(D.length()>0){const k=D.at(0);let z,O;k.distanceTo(m)>k.distanceTo(y)?(z=o,O=h):(z=h,O=o);const U=k.clone().addvec(z.center.sub(k).mult(1/2)),H=k.distanceTo(z.center)/2,V=Math.asin(z.radius/(2*H)),W=z.center.sub(U),K=U.clone().addvec(W.clone().rotateBy(V*2)),Z=U.clone().addvec(W.clone().rotateBy(-V*2)),tt=K.sub(z.center).normalize(),at=Z.sub(z.center).normalize(),st=O.center.clone().addvec(tt.clone().mult(O.radius)),nt=O.center.clone().addvec(at.clone().mult(O.radius));e.drawLine(K.x,K.y,st.x,st.y),e.drawLine(Z.x,Z.y,nt.x,nt.y)}}else{const P=m.clone().addvec(x.clone().perpVector().negate().mult(h.radius)),D=y.clone().addvec(x.clone().perpVector().negate().mult(o.radius)),k=new p.McDbLine(P,D);e.drawEntity(T),e.drawEntity(k)}})}class Bg extends p.McDbCustomEntity{constructor(e){super(e),this.point1=new p.McGePoint3d,this.point2=new p.McGePoint3d,this.radius=30,this.minPt=new p.McGePoint3d,this.maxPt=new p.McGePoint3d}create(e){return new Bg(e)}getTypeName(){return"McDbTestRoundedRectangle"}set CornerPoint1(e){this.point1=e.clone()}get CornerPoint1(){return this.point1}set CornerPoint2(e){this.point2=e.clone()}get CornerPoint2(){return this.point2}set arcRadius(e){this.radius=e}get arcRadius(){return this.radius}dwgInFields(e){return this.point1=e.readPoint("point1").val,this.point2=e.readPoint("point2").val,this.radius=e.readDouble("radius").val,this.minPt=e.readPoint("minPt").val,this.maxPt=e.readPoint("maxPt").val,!0}dwgOutFields(e){return e.writePoint("point1",this.point1),e.writePoint("point2",this.point2),e.writeDouble("radius",this.radius),e.writePoint("minPt",this.minPt),e.writePoint("maxPt",this.maxPt),!0}moveGripPointsAt(e,n,r,s){this.assertWrite(),e===0?(this.point1.x+=n,this.point1.y+=r,this.point1.z+=s):e===1&&(this.point2.x+=n,this.point2.y+=r,this.point2.z+=s)}getGripPoints(){let e=new p.McGePoint3dArray;return e.append(this.point1),e.append(this.point2),e}worldDraw(e){const n=[];let r=this.radius;const s=new p.McGePoint3d(this.point1.x,this.point2.y),u=new p.McGePoint3d(this.point2.x,this.point1.y),h=this.point1.distanceTo(s),o=this.point2.distanceTo(s),m=h<o?h:o;this.radius>m/2&&(r=m/2);const y=[this.point1,s,this.point2,u],x=new p.McDbPolyline;x.isClosed=!0,y.forEach(H=>{x.addVertexAt(H)});const M=s.sub(this.point1).normalize().mult(r),A=u.sub(this.point1).normalize().mult(r),T=this.point1.clone().addvec(M).addvec(A),P=s.clone().addvec(M.clone().negate()).addvec(A),D=this.point2.clone().addvec(M.clone().negate()).addvec(A.clone().negate()),k=u.clone().addvec(M).addvec(A.clone().negate()),z=[T,P,D,k],O=[],U=1e-4;z.forEach(H=>{const V=new p.McDbCircle;V.center=H,V.radius=r;const W=x.IntersectWith(V,p.McDb.Intersect.kExtendBoth),K=[];W.length()>0&&W.forEach(Z=>K.push(Z)),O.push(...K),V.splitCurves(K).forEach((Z,tt)=>{const at=Z.clone(),st=at.getLength().val,nt=at.getPointAtDist(0).val,ct=at.getPointAtDist(st).val,xt=K.filter(Zt=>Zt.distanceTo(nt)<U||Zt.distanceTo(ct)<U),vt=Math.abs(st-V.getLength().val/4);xt.length===K.length&&vt<U&&(e.drawEntity(Z),n.push(Z))})}),x.splitCurves(O).forEach((H,V)=>{const W=H.clone(),K=W.getLength().val;if(Math.abs(K-this.radius)>U&&Math.abs(K-2*this.radius)>U&&(e.drawEntity(H),n.push(H)),Math.abs(K-2*this.radius)<U){const Z=W.numVerts();let tt=[];for(let at=0;at<Z;at++){const st=W.getPointAt(at).val;tt=y.filter(nt=>st.distanceTo(nt)<U)}Z!==3&&tt.length===0&&(e.drawEntity(H),n.push(H))}}),this.getBox(n)}getBox(e){const n=p.MxCpp.getCurrentMxCAD();let r,s=null,u;e.forEach(h=>{if(h instanceof p.McDbText){const x=new p.McDbMText;switch(x.contents=h.textString,x.textHeight=h.height,x.location=h.position,h.horizontalMode){case p.McDb.TextHorzMode.kTextLeft:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break;case p.McDb.TextHorzMode.kTextCenter:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;case p.McDb.TextHorzMode.kTextRight:x.attachment=p.McDb.AttachmentPoint.kBottomRight;break;case p.McDb.TextHorzMode.kTextMid:x.attachment=p.McDb.AttachmentPoint.kBottomCenter;break;default:x.attachment=p.McDb.AttachmentPoint.kBottomLeft;break}const M=n.getDatabase().getCurrentlyTextStyleId();x.textStyleId=M,x.reCompute(),u=p.MxCADUtility.getTextEntityBox(x,!1)}else h instanceof p.McDbMText?(h.reCompute(),u=p.MxCADUtility.getTextEntityBox(h,!1)):u=h.getBoundingBox();const{minPt:o,maxPt:m,ret:y}=u;r||(r=o.clone()),s||(s=m.clone()),o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),m.x>s.x&&(s.x=m.x),m.y>s.y&&(s.y=m.y)}),r&&s&&(this.maxPt=s,this.minPt=r)}getBoundingBox(){return{minPt:this.minPt,maxPt:this.maxPt,ret:!0}}}function nU(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint;e.setMessage(G("请设置矩形左上角点"));const n=yield e.go();if(!n)return;let r=new $.MxDbRect;r.pt1=n.toVector3();const s=new p.MxCADUiPrPoint;s.setMessage(G("请设置矩形右下角点")),s.setUserDraw((M,A)=>{r.pt2=M.toVector3(),A.drawCustomEntity(r)});const u=yield s.go();if(!u)return;let h=new p.McDbPolyline;h.addVertexAt(n),h.addVertexAt(new p.McGePoint3d(n.x,u.y)),h.addVertexAt(u),h.addVertexAt(new p.McGePoint3d(u.x,n.y)),h.isClosed=!0;const o=t.drawEntity(h),m=new p.MxCADUiPrDist;m.setMessage(G("请设置圆角半径")),m.setBasePt(n);let y=yield m.go();y||(y=$.MxFun.screenCoordLong2Doc(20)),o.erase();const x=new Bg;x.CornerPoint1=n,x.CornerPoint2=u,x.arcRadius=y,t.drawEntity(x)})}function iU(){return Gt(this,null,function*(){const t=p.MxCpp.getCurrentMxCAD(),e=[],n=new p.MxCADUiPrPoint;n.setMessage(G("请选择多边形起点"));const r=yield n.go();if(!r)return;e.push(r);let s=null;for(;;){if(s&&s.erase(),e.length>=2){const m=new p.McDbPolyline;e.forEach(y=>m.addVertexAt(y)),s=t.drawEntity(m)}const h=new p.MxCADUiPrPoint;h.setMessage(G("请选择多边形顶点")),h.setUserDraw((m,y)=>{const x=new p.McDbLine(m,e[e.length-1]);y.drawMcDbEntity(x)});const o=yield h.go();if(!o||(e.push(o),o&&o.distanceTo(e[0])<1e-4))break}s&&s.erase();const u=new p.McDbPolyline;lp(e).forEach(h=>u.addVertexAt(h)),u.isClosed=!0,t.drawEntity(u)})}function rU(){new Bg().rxInit(),new kg().rxInit(),Y6(),DN(),IN(),MxPluginContext.addCommand("Mx_DrawStart",kN),MxPluginContext.addCommand("Mx_ConcavoVex",BN),MxPluginContext.addCommand("Mx_ZigzagLine",FN),MxPluginContext.addCommand("Mx_CenterRect",zN),MxPluginContext.addCommand("Mx_RREC",nU),MxPluginContext.addCommand("Mx_CCLine",NN),MxPluginContext.addCommand("Mx_Piping",UN),MxPluginContext.addCommand("Mx_CutPipeline",VN),MxPluginContext.addCommand("Mx_WelLine",GN),MxPluginContext.addCommand("Mx_PerpLine",ON),MxPluginContext.addCommand("Mx_StairLine",jN),MxPluginContext.addCommand("Mx_SolidCircle",HN),MxPluginContext.addCommand("Mx_CottonInsulation",WN),MxPluginContext.addCommand("Mx_CenterLine",qN),MxPluginContext.addCommand("Mx_DoHole",YN),MxPluginContext.addCommand("Mx_Compass",XN),MxPluginContext.addCommand("Mx_MassegeBox",KN),MxPluginContext.addCommand("Mx_DatumSymbol",ZN),MxPluginContext.addCommand("Mx_ConcentricCircles",QN),MxPluginContext.addCommand("Mx_Gear",$N),MxPluginContext.addCommand("Mx_BlkCenterLine",tU),MxPluginContext.addCommand("Mx_RoundCutPublicLine",eU),MxPluginContext.addCommand("Mx_DatumSymbol2",JN),MxPluginContext.addCommand("Mx_DrawPolygon",iU)}const vA=12868,oU=16711680;class S1 extends $.MxDbEntity{constructor(){super(...arguments),this.points=[],this.isFill=!1,this.fillColor=6697540,this.fillOpacity=.7}getTypeName(){return"MxDbTestReact"}create(){return new S1}worldDraw(e){if(this.points.length<3){this.points.length==2&&e.drawLine(this.points[0],this.points[1]);return}let n=this.points[0],r=this.points.length;for(let s=1;s<r;s++){let u=this.points[s];e.drawLine(n,u),n=u}if(e.drawLine(n,this.points[0]),e.getType()==$.McGiWorldDrawType.kWorldDraw&&this.isFill){e.setColor(this.fillColor),e.setOpacity(this.fillOpacity),e.setRenderOrder(e.getRenderOrder()-1);const s=new $.MxDbHatch;s.points=this.points,s.worldDraw(e)}}getGripPoints(){return this.points}moveGripPointsAt(e,n){return e>=this.points.length?!1:(this.points[e].add(n),!0)}dwgIn(e){this.onDwgIn(e);let n=e.points;return this.points=[],n.forEach(r=>{this.points.push(new THREE.Vector3(r.x,r.y,r.z))}),this.dwgInHelp(e,["isFill","fillColor","fillOpacity"]),!0}dwgOut(e){return this.onDwgOut(e),e.points=this.points,this.dwgOutHelp(e,["isFill","fillColor","fillOpacity"]),e}addPoint(e){this.points.push(e.clone())}getPoints(){return this.points}clearPoint(){this.points=[]}}function sU(t,e){let n=0;return function(...r){const s=Date.now();s-n>=e&&(t.apply(this,r),n=s)}}let _A=0;function aU(){const t=p.MxCpp.getCurrentMxCAD(),e=document.getElementById("myCanvas"),n=s=>{const u=$.MxFun.getCurrentDraw(),h=u.getAllMxEntity(),o=u.findMxEntityAtPoint(s);h.length&&(h.forEach(m=>{m.getTypeName()==="MxDbTestReact"&&(o.includes(m)?m.fillColor=oU:m.fillColor=vA,m.setNeedUpdateDisplay(!0))}),t.updateDisplay())};_A||e==null||e.addEventListener("mousemove",sU(s=>{const u=t.mxdraw.viewCoord2Cad(s.clientX,s.clientY,0);n(u)},100)),t.newFile();const r=new S1;r.addPoint(new THREE.Vector3(1e3,1e3)),r.addPoint(new THREE.Vector3(1e3,3e3)),r.addPoint(new THREE.Vector3(3e3,3e3)),r.addPoint(new THREE.Vector3(3e3,1e3)),r.isFill=!0,r.fillColor=vA,r.fillOpacity=.5,$.MxFun.getCurrentDraw().addMxEntity(r),_A+=1}function lU(){return Gt(this,null,function*(){let t=new p.MxCADUiPrPoint;t.setMessage(G("指定裁剪角点1"));const e=yield t.go();if(!e)return;t.setMessage(G("指定裁剪角点2")),t.setUserDraw((o,m)=>{m.setColor(16711680);let y=new p.McDbPolyline;y.addVertexAt(e),y.addVertexAt(new p.McGePoint3d(e.x,o.y)),y.addVertexAt(o),y.addVertexAt(new p.McGePoint3d(o.x,e.y)),y.constantWidth=$.MxFun.screenCoordLong2Doc(2),y.isClosed=!0,m.drawMcDbEntity(y);let x=[];x.push(e.toVector3()),x.push(new THREE.Vector3(e.x,o.y)),x.push(o.toVector3()),x.push(new THREE.Vector3(o.x,e.y)),m.setColor(12868),m.drawSolid(x,.5)}),t.setDisableOsnap(!0),t.setDisableOrthoTrace(!0),t.setDynamicInputType($.DynamicInputType.kXYCoordInput);let n=yield t.go();if(!n)return;let r=window.location.protocol,s=window.location.hostname,u=r+"//"+s+":1337/mxcad/cut_mxweb",h={bd_pt1_x:""+e.x,bd_pt1_y:""+e.y,bd_pt2_x:""+n.x,bd_pt2_y:""+n.y};p.MxCpp.getCurrentMxCAD().saveFileToUrl(u,(o,m)=>{try{let y=JSON.parse(m);if(y.ret=="ok"){let x=r+"//"+s+":1337/mxcad/file/"+y.file;cU(x,"MxWeb"+Math.random())}else console.log(m)}catch(y){console.log("Mx: sserverResult error")}},void 0,JSON.stringify(h))})}function cU(t,e){return Gt(this,null,function*(){var M;let n=p.MxCpp.App.getCurrentMxCAD(),r=yield n.insertBlock(t,e);if(!r.isValid())return;let s=new p.McDbBlockReference;s.blockTableRecordId=r;const u=(M=r.getMcDbBlockTableRecord())==null?void 0:M.getAllEntityId();if(!u)return;u.length===1&&u[0].isKindOf("McDbBlockReference")&&(s.blockTableRecordId=u[0].getMcDbEntity().blockTableRecordId);let h=s.getBoundingBox(),o=s.blockTableRecordId.getMcDbBlockTableRecord();o.origin=h.minPt.clone().addvec(h.maxPt.sub(h.minPt).mult(.5));let m=new p.MxCADUiPrPoint;m.setMessage("指定插入基点"),m.setUserDraw((A,T)=>{s.position=A,T.drawMcDbEntity(s)});let y=yield m.go();if(!y)return;s.position=y;let x=n.drawEntity(s);if(x.isValid){let A=new p.McGeLongArray;A.copyFormAryId([x]),p.MxCpp.App.MxCADAssist.MxExplode(A.imp)}else{console.log("insert error");return}})}function uU(){MxPluginContext.addCommand("Mx_ReactChangeColor",aU),MxPluginContext.addCommand("Mx_Cut_MxWebToFile",lU)}var bA={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(II,function(){var n,r,s;function u(o,m){if(!n)n=m;else if(!r)r=m;else{var y="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+n+")(sharedChunk); ("+r+")(sharedChunk); self.onerror = null;",x={};n(x),s=m(x),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(s.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}u(["exports"],function(o){var m="2.8.2",y=x;function x(l,i,c,d){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(d-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=d,this.p2x=c,this.p2y=d}x.prototype.sampleCurveX=function(l){return((this.ax*l+this.bx)*l+this.cx)*l},x.prototype.sampleCurveY=function(l){return((this.ay*l+this.by)*l+this.cy)*l},x.prototype.sampleCurveDerivativeX=function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},x.prototype.solveCurveX=function(l,i){var c,d,g,_,E;for(i===void 0&&(i=1e-6),g=l,E=0;E<8;E++){if(_=this.sampleCurveX(g)-l,Math.abs(_)<i)return g;var S=this.sampleCurveDerivativeX(g);if(Math.abs(S)<1e-6)break;g-=_/S}if((g=l)<(c=0))return c;if(g>(d=1))return d;for(;c<d;){if(_=this.sampleCurveX(g),Math.abs(_-l)<i)return g;l>_?c=g:d=g,g=.5*(d-c)+c}return g},x.prototype.solve=function(l,i){return this.sampleCurveY(this.solveCurveX(l,i))};var M=A;function A(l,i){this.x=l,this.y=i}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,i){return this.clone()._rotateAround(l,i)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var i=l.x-this.x,c=l.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,i){return Math.atan2(this.x*i-this.y*l,this.x*l+this.y*i)},_matMult:function(l){var i=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=i,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var i=Math.cos(l),c=Math.sin(l),d=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=d,this},_rotateAround:function(l,i){var c=Math.cos(l),d=Math.sin(l),g=i.y+d*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-d*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(l){return l instanceof A?l:Array.isArray(l)?new A(l[0],l[1]):l};var T=typeof self!="undefined"?self:{};const P=Math.PI/180,D=180/Math.PI;function k(l){return l*P}function z(l){return l*D}const O=[[0,0],[1,0],[1,1],[0,1]];function U(l){if(l<=0)return 0;if(l>=1)return 1;const i=l*l,c=i*l;return 4*(l<.5?c:3*(l-i)+c-.75)}function H(l,i,c,d){const g=new y(l,i,c,d);return function(_){return g.solve(_)}}const V=H(.25,.1,.25,1);function W(l,i,c){return Math.min(c,Math.max(i,l))}function K(l,i,c){return(c=W((c-l)/(i-l),0,1))*c*(3-2*c)}function Z(l,i,c){const d=c-i,g=((l-i)%d+d)%d+i;return g===i?c:g}function tt(l,i,c){if(!l.length)return c(null,[]);let d=l.length;const g=new Array(l.length);let _=null;l.forEach((E,S)=>{i(E,(L,B)=>{L&&(_=L),g[S]=B,--d==0&&c(_,g)})})}function at(l){const i=[];for(const c in l)i.push(l[c]);return i}function st(l,...i){for(const c of i)for(const d in c)l[d]=c[d];return l}let nt=1;function ct(){return nt++}function xt(){return function l(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()}function vt(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function Zt(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)}function ce(l,i){l.forEach(c=>{i[c]&&(i[c]=i[c].bind(i))})}function le(l,i){return l.indexOf(i,l.length-i.length)!==-1}function fe(l,i,c){const d={};for(const g in l)d[g]=i.call(c||this,l[g],g,l);return d}function de(l,i,c){const d={};for(const g in l)i.call(c||this,l[g],g,l)&&(d[g]=l[g]);return d}function Le(l){return Array.isArray(l)?l.map(Le):typeof l=="object"&&l?fe(l,Le):l}const Lt={};function bt(l){Lt[l]||(typeof console!="undefined"&&console.warn(l),Lt[l]=!0)}function qt(l,i,c){return(c.y-l.y)*(i.x-l.x)>(i.y-l.y)*(c.x-l.x)}function Wt(l){let i=0;for(let c,d,g=0,_=l.length,E=_-1;g<_;E=g++)c=l[g],d=l[E],i+=(d.x-c.x)*(c.y+d.y);return i}function Nt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function se(l){const i={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,_)=>{const E=g||_;return i[d]=!E||E.toLowerCase(),""}),i["max-age"]){const c=parseInt(i["max-age"],10);isNaN(c)?delete i["max-age"]:i["max-age"]=c}return i}let _t,wt,Ct,Mt,jt=null;function ee(l){if(jt==null){const i=l.navigator?l.navigator.userAgent:null;jt=!!l.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return jt}function pe(l){try{const i=T[l];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch(i){return!1}}const Te={now:()=>Ct!==void 0?Ct:T.performance.now(),setNow(l){Ct=l},restoreNow(){Ct=void 0},frame(l){const i=T.requestAnimationFrame(l);return{cancel:()=>T.cancelAnimationFrame(i)}},getImageData(l,i=0){const{width:c,height:d}=l;Mt||(Mt=T.document.createElement("canvas"));const g=Mt.getContext("2d");if(!g)throw new Error("failed to create canvas 2d context");return(c>Mt.width||d>Mt.height)&&(Mt.width=c,Mt.height=d),g.clearRect(-i,-i,c+2*i,d+2*i),g.drawImage(l,0,0,c,d),g.getImageData(-i,-i,c+2*i,d+2*i)},resolveURL:l=>(_t||(_t=T.document.createElement("a")),_t.href=l,_t.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(wt==null&&(wt=T.matchMedia("(prefers-reduced-motion: reduce)")),wt.matches)}};let We;const yt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(We==null){const l=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{We={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):l}catch(i){We=l}}return We},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},St={supported:!1,testSupport:function(l){!En&&be&&(mn?an(l):Ee=l)}};let Ee,be,En=!1,mn=!1;function an(l){const i=l.createTexture();l.bindTexture(l.TEXTURE_2D,i);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,be),l.isContextLost())return;St.supported=!0}catch(c){}l.deleteTexture(i),En=!0}T.document&&(be=T.document.createElement("img"),be.onload=function(){Ee&&an(Ee),Ee=null,mn=!0},be.onerror=function(){En=!0,Ee=null},be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const yn="01",Tn="NO_ACCESS_TOKEN";function pn(l){return l.indexOf("mapbox:")===0}function qe(l){return yt.API_URL_REGEX.test(l)}const hn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Je(l){const i=l.match(hn);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Jt(l){const i=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${i}`}function je(l){if(!l)return null;const i=l.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(i[1]).split("").map(c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(c){return null}}class rn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const c=je(yt.ACCESS_TOKEN);let d="";return d=c&&c.u?T.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,(g,_)=>String.fromCharCode(+("0x"+_)))):yt.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${d}`:`mapbox.eventData:${d}`}fetchEventData(){const i=pe("localStorage"),c=this.getStorageKey(),d=this.getStorageKey("uuid");if(i)try{const g=T.localStorage.getItem(c);g&&(this.eventData=JSON.parse(g));const _=T.localStorage.getItem(d);_&&(this.anonId=_)}catch(g){bt("Unable to read from LocalStorage")}}saveEventData(){const i=pe("localStorage"),c=this.getStorageKey(),d=this.getStorageKey("uuid");if(i)try{T.localStorage.setItem(d,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(c,JSON.stringify(this.eventData))}catch(g){bt("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,c,d,g){if(!yt.EVENTS_URL)return;const _=Je(yt.EVENTS_URL);_.params.push(`access_token=${g||yt.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:m,skuId:yn,userId:this.anonId},S=c?st(E,c):E,L={url:Jt(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=Yt(L,B=>{this.pendingRequest=null,d(B),this.saveEventData(),this.processRequests(g)})}queueRequest(i,c){this.queue.push(i),this.processRequests(c)}}const In=new class extends rn{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,i){yt.EVENTS_URL&&yt.ACCESS_TOKEN&&Array.isArray(l)&&l.some(c=>pn(c)||qe(c))&&this.queueRequest(Date.now(),i)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=je(yt.ACCESS_TOKEN),c=i?i.u:yt.ACCESS_TOKEN;let d=c!==this.eventData.tokenU;Zt(this.anonId)||(this.anonId=xt(),d=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),E=new Date(g),S=(g-this.eventData.lastSuccess)/864e5;d=d||S>=1||S<-1||_.getDate()!==E.getDate()}else d=!0;d?this.postEvent(g,{"enabled.telemetry":!1},_=>{_||(this.eventData.lastSuccess=g,this.eventData.tokenU=c)},l):this.processRequests()}},xn=In.postTurnstileEvent.bind(In),On=new class extends rn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,i,c,d){this.skuToken=i,this.errorCb=d,yt.EVENTS_URL&&(c||yt.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},c):this.errorCb(new Error(Tn)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Zt(this.anonId)||(this.anonId=xt()),this.postEvent(c,{skuToken:this.skuToken},d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},l))}},qn=On.postMapLoadEvent.bind(On),Jn=new class extends rn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,i,c,d){if(!yt.API_URL||!yt.SESSION_PATH)return;const g=Je(yt.API_URL+yt.SESSION_PATH);g.params.push(`sku=${i||""}`),g.params.push(`access_token=${d||yt.ACCESS_TOKEN||""}`);const _={url:Jt(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ne(_,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(d)})}getSessionAPI(l,i,c,d){this.skuToken=i,this.errorCb=d,yt.SESSION_PATH&&yt.API_URL&&(c||yt.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},c):this.errorCb(new Error(Tn)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||this.getSession(c,this.skuToken,d=>{d?this.errorCb(d):i&&(this.success[i]=!0)},l)}},Ji=Jn.getSessionAPI.bind(Jn),jn=new Set,Bi="mapbox-tiles";let oi,or,Ai=500,Qr=50;function Oi(){T.caches&&!oi&&(oi=T.caches.open(Bi))}function $r(l){const i=l.indexOf("?");return i<0?l:l.slice(0,i)}let Ir=1/0;const Pt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Pt);class et extends Error{constructor(i,c,d){c===401&&qe(d)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=c,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const lt=Nt()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,At=function(l,i){if(!(/^file:/.test(c=l.url)||/^file:/.test(lt())&&!/^\w+:/.test(c))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(d,g){const _=new T.AbortController,E=new T.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:lt(),signal:_.signal});let S=!1,L=!1;const B=(N=E.url).indexOf("sku=")>0&&qe(N);var N;d.type==="json"&&E.headers.set("Accept","application/json");const j=(Q,ot,dt)=>{if(L)return;if(Q&&Q.message!=="SecurityError"&&bt(Q),ot&&dt)return Y(ot);const mt=Date.now();T.fetch(E).then(Tt=>{if(Tt.ok){const Ot=B?Tt.clone():null;return Y(Tt,Ot,mt)}return g(new et(Tt.statusText,Tt.status,d.url))}).catch(Tt=>{Tt.code!==20&&g(new Error(Tt.message))})},Y=(Q,ot,dt)=>{(d.type==="arrayBuffer"?Q.arrayBuffer():d.type==="json"?Q.json():Q.text()).then(mt=>{L||(ot&&dt&&function(Tt,Ot,Xt){if(Oi(),!oi)return;const Qt={status:Ot.status,statusText:Ot.statusText,headers:new T.Headers};Ot.headers.forEach((me,ye)=>Qt.headers.set(ye,me));const $t=se(Ot.headers.get("Cache-Control")||"");if($t["no-store"])return;$t["max-age"]&&Qt.headers.set("Expires",new Date(Xt+1e3*$t["max-age"]).toUTCString());const te=Qt.headers.get("Expires");te&&(new Date(te).getTime()-Xt<42e4||function(me,ye){if(or===void 0)try{new Response(new ReadableStream),or=!0}catch(Ae){or=!1}or?ye(me.body):me.blob().then(ye)}(Ot,me=>{const ye=new T.Response(me,Qt);Oi(),oi&&oi.then(Ae=>Ae.put($r(Tt.url),ye)).catch(Ae=>bt(Ae.message))}))}(E,ot,dt),S=!0,g(null,mt,Q.headers.get("Cache-Control"),Q.headers.get("Expires")))}).catch(mt=>{L||g(new Error(mt.message))})};return B?function(Q,ot){if(Oi(),!oi)return ot(null);const dt=$r(Q.url);oi.then(mt=>{mt.match(dt).then(Tt=>{const Ot=function(Xt){if(!Xt)return!1;const Qt=new Date(Xt.headers.get("Expires")||0),$t=se(Xt.headers.get("Cache-Control")||"");return Qt>Date.now()&&!$t["no-cache"]}(Tt);mt.delete(dt),Ot&&mt.put(dt,Tt.clone()),ot(null,Tt,Ot)}).catch(ot)}).catch(ot)}(E,j):j(null,null),{cancel:()=>{L=!0,S||_.abort()}}}(l,i);if(Nt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",l,i,void 0,!0)}var c;return function(d,g){const _=new T.XMLHttpRequest;_.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const E in d.headers)_.setRequestHeader(E,d.headers[E]);return d.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=d.credentials==="include",_.onerror=()=>{g(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let E=_.response;if(d.type==="json")try{E=JSON.parse(_.response)}catch(S){return g(S)}g(null,E,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else g(new et(_.statusText,_.status,d.url))},_.send(d.body),{cancel:()=>_.abort()}}(l,i)},zt=function(l,i){return At(st(l,{type:"arrayBuffer"}),i)},Yt=function(l,i){return At(st(l,{method:"POST"}),i)},ne=function(l,i){return At(st(l,{method:"GET"}),i)};function ie(l){const i=T.document.createElement("a");return i.href=l,i.protocol===T.document.location.protocol&&i.host===T.document.location.host}const Kt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ae,we;ae=[],we=0;const He=function(l,i){if(St.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),we>=yt.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:l,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return ae.push(_),_}we++;let c=!1;const d=()=>{if(!c)for(c=!0,we--;ae.length&&we<yt.MAX_PARALLEL_IMAGE_REQUESTS;){const _=ae.shift(),{requestParameters:E,callback:S,cancelled:L}=_;L||(_.cancel=He(E,S).cancel)}},g=zt(l,(_,E,S,L)=>{d(),_?i(_):E&&(T.createImageBitmap?function(B,N){const j=new T.Blob([new Uint8Array(B)],{type:"image/png"});T.createImageBitmap(j).then(Y=>{N(null,Y)}).catch(Y=>{N(new Error(`Could not load image because of ${Y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(E,(B,N)=>i(B,N,S,L)):function(B,N){const j=new T.Image,Y=T.URL;j.onload=()=>{N(null,j),Y.revokeObjectURL(j.src),j.onload=null,T.requestAnimationFrame(()=>{j.src=Kt})},j.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Q=new T.Blob([new Uint8Array(B)],{type:"image/png"});j.src=B.byteLength?Y.createObjectURL(Q):Kt}(E,(B,N)=>i(B,N,S,L)))});return{cancel:()=>{g.cancel(),d()}}};function De(l,i,c){c[l]&&c[l].indexOf(i)!==-1||(c[l]=c[l]||[],c[l].push(i))}function Mn(l,i,c){if(c&&c[l]){const d=c[l].indexOf(i);d!==-1&&c[l].splice(d,1)}}class rt{constructor(i,c={}){st(this,c),this.type=i}}class ht extends rt{constructor(i,c={}){super("error",st({error:i},c))}}class Vt{on(i,c){return this._listeners=this._listeners||{},De(i,c,this._listeners),this}off(i,c){return Mn(i,c,this._listeners),Mn(i,c,this._oneTimeListeners),this}once(i,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},De(i,c,this._oneTimeListeners),this):new Promise(d=>this.once(i,d))}fire(i,c){typeof i=="string"&&(i=new rt(i,c||{}));const d=i.type;if(this.listens(d)){i.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const S of g)S.call(this,i);const _=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const S of _)Mn(d,S,this._oneTimeListeners),S.call(this,i);const E=this._eventedParent;E&&(st(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(i))}else i instanceof ht&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,c){return this._eventedParent=i,this._eventedParentData=c,this}}var Dt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Se(l,...i){for(const c of i)for(const d in c)l[d]=c[d];return l}function Me(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Oe(l){if(Array.isArray(l))return l.map(Oe);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const i={};for(const c in l)i[c]=Oe(l[c]);return i}return Me(l)}class ln extends Error{constructor(i,c){super(c),this.message=c,this.key=i}}class kn{constructor(i,c=[]){this.parent=i,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(i){return new kn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Bn={kind:"null"},Pe={kind:"number"},fn={kind:"string"},tn={kind:"boolean"},vn={kind:"color"},Sn={kind:"object"},Dn={kind:"value"},xi={kind:"collator"},kr={kind:"formatted"},hi={kind:"resolvedImage"};function fi(l,i){return{kind:"array",itemType:l,N:i}}function di(l){if(l.kind==="array"){const i=di(l.itemType);return typeof l.N=="number"?`array<${i}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${i}>`}return l.kind}const Va=[Bn,Pe,fn,tn,vn,kr,Sn,fi(Dn),hi];function Xo(l,i){if(i.kind==="error")return null;if(l.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Xo(l.itemType,i.itemType))&&(typeof l.N!="number"||l.N===i.N))return null}else{if(l.kind===i.kind)return null;if(l.kind==="value"){for(const c of Va)if(!Xo(c,i))return null}}return`Expected ${di(l)} but found ${di(i)} instead.`}function Nu(l,i){return i.some(c=>c.kind===l.kind)}function Ga(l,i){return i.some(c=>c==="null"?l===null:c==="array"?Array.isArray(l):c==="object"?l&&!Array.isArray(l)&&typeof l=="object":c===typeof l)}function Uu(l){var i={exports:{}};return l(i,i.exports),i.exports}var dp=Uu(function(l,i){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(S){return(S=Math.round(S))<0?0:S>255?255:S}function g(S){return d(S[S.length-1]==="%"?parseFloat(S)/100*255:parseInt(S))}function _(S){return(L=S[S.length-1]==="%"?parseFloat(S)/100:parseFloat(S))<0?0:L>1?1:L;var L}function E(S,L,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?S+(L-S)*B*6:2*B<1?L:3*B<2?S+(L-S)*(2/3-B)*6:S}try{i.parseCSSColor=function(S){var L,B=S.replace(/ /g,"").toLowerCase();if(B in c)return c[B].slice();if(B[0]==="#")return B.length===4?(L=parseInt(B.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:B.length===7&&(L=parseInt(B.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var N=B.indexOf("("),j=B.indexOf(")");if(N!==-1&&j+1===B.length){var Y=B.substr(0,N),Q=B.substr(N+1,j-(N+1)).split(","),ot=1;switch(Y){case"rgba":if(Q.length!==4)return null;ot=_(Q.pop());case"rgb":return Q.length!==3?null:[g(Q[0]),g(Q[1]),g(Q[2]),ot];case"hsla":if(Q.length!==4)return null;ot=_(Q.pop());case"hsl":if(Q.length!==3)return null;var dt=(parseFloat(Q[0])%360+360)%360/360,mt=_(Q[1]),Tt=_(Q[2]),Ot=Tt<=.5?Tt*(mt+1):Tt+mt-Tt*mt,Xt=2*Tt-Ot;return[d(255*E(Xt,Ot,dt+1/3)),d(255*E(Xt,Ot,dt)),d(255*E(Xt,Ot,dt-1/3)),ot];default:return null}}return null}}catch(S){}});class Qn{constructor(i,c,d,g=1){this.r=i,this.g=c,this.b=d,this.a=g}static parse(i){if(!i)return;if(i instanceof Qn)return i;if(typeof i!="string")return;const c=dp.parseCSSColor(i);return c?new Qn(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[i,c,d,g]=this.toArray();return`rgba(${Math.round(i)},${Math.round(c)},${Math.round(d)},${g})`}toArray(){const{r:i,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*i/g,255*c/g,255*d/g,g]}}Qn.black=new Qn(0,0,0,1),Qn.white=new Qn(1,1,1,1),Qn.transparent=new Qn(0,0,0,0),Qn.red=new Qn(1,0,0,1),Qn.blue=new Qn(0,0,1,1);class Oa{constructor(i,c,d){this.sensitivity=i?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,c){return this.collator.compare(i,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pp{constructor(i,c,d,g,_){this.text=i.normalize?i.normalize():i,this.image=c,this.scale=d,this.fontStack=g,this.textColor=_}}class ji{constructor(i){this.sections=i}static fromString(i){return new ji([new pp(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof ji?i:ji.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const c of this.sections){if(c.image){i.push(["image",c.image.name]);continue}i.push(c.text);const d={};c.fontStack&&(d["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(d["font-scale"]=c.scale),c.textColor&&(d["text-color"]=["rgba"].concat(c.textColor.toArray())),i.push(d)}return i}}class Br{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Br({name:i,available:!1}):null}serialize(){return["image",this.name]}}function bo(l,i,c,d){return typeof l=="number"&&l>=0&&l<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[l,i,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[l,i,c,d]:[l,i,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Vu(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof Qn||l instanceof Oa||l instanceof ji||l instanceof Br)return!0;if(Array.isArray(l)){for(const i of l)if(!Vu(i))return!1;return!0}if(typeof l=="object"){for(const i in l)if(!Vu(l[i]))return!1;return!0}return!1}function Fi(l){if(l===null)return Bn;if(typeof l=="string")return fn;if(typeof l=="boolean")return tn;if(typeof l=="number")return Pe;if(l instanceof Qn)return vn;if(l instanceof Oa)return xi;if(l instanceof ji)return kr;if(l instanceof Br)return hi;if(Array.isArray(l)){const i=l.length;let c;for(const d of l){const g=Fi(d);if(c){if(c===g)continue;c=Dn;break}c=g}return fi(c||Dn,i)}return Sn}function Ko(l){const i=typeof l;return l===null?"":i==="string"||i==="number"||i==="boolean"?String(l):l instanceof Qn||l instanceof ji||l instanceof Br?l.toString():JSON.stringify(l)}class Zo{constructor(i,c){this.type=i,this.value=c}static parse(i,c){if(i.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Vu(i[1]))return c.error("invalid value");const d=i[1];let g=Fi(d);const _=c.expectedType;return g.kind!=="array"||g.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(g=_),new Zo(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qn?["rgba"].concat(this.value.toArray()):this.value instanceof ji?this.value.serialize():this.value}}class sr{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const fp={string:fn,number:Pe,boolean:tn,object:Sn};class Mo{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");let d,g=1;const _=i[0];if(_==="array"){let S,L;if(i.length>2){const B=i[1];if(typeof B!="string"||!(B in fp)||B==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);S=fp[B],g++}else S=Dn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return c.error('The length argument to "array" must be a positive integer literal',2);L=i[2],g++}d=fi(S,L)}else d=fp[_];const E=[];for(;g<i.length;g++){const S=c.parse(i[g],g,Dn);if(!S)return null;E.push(S)}return new Mo(d,E)}evaluate(i){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(i);if(!Xo(this.type,Fi(d)))return d;if(c===this.args.length-1)throw new sr(`Expected value to be of type ${di(this.type)}, but found ${di(Fi(d))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,c=[i.kind];if(i.kind==="array"){const d=i.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){c.push(d.kind);const g=i.N;(typeof g=="number"||this.args.length>1)&&c.push(g)}}return c.concat(this.args.map(d=>d.serialize()))}}class ja{constructor(i){this.type=kr,this.sections=i}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let _=!1;for(let E=1;E<=i.length-1;++E){const S=i[E];if(_&&typeof S=="object"&&!Array.isArray(S)){_=!1;let L=null;if(S["font-scale"]&&(L=c.parse(S["font-scale"],1,Pe),!L))return null;let B=null;if(S["text-font"]&&(B=c.parse(S["text-font"],1,fi(fn)),!B))return null;let N=null;if(S["text-color"]&&(N=c.parse(S["text-color"],1,vn),!N))return null;const j=g[g.length-1];j.scale=L,j.font=B,j.textColor=N}else{const L=c.parse(i[E],1,Dn);if(!L)return null;const B=L.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,g.push({content:L,scale:null,font:null,textColor:null})}}return new ja(g)}evaluate(i){return new ji(this.sections.map(c=>{const d=c.content.evaluate(i);return Fi(d)===hi?new pp("",d,null,null,null):new pp(Ko(d),null,c.scale?c.scale.evaluate(i):null,c.font?c.font.evaluate(i).join(","):null,c.textColor?c.textColor.evaluate(i):null)}))}eachChild(i){for(const c of this.sections)i(c.content),c.scale&&i(c.scale),c.font&&i(c.font),c.textColor&&i(c.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const c of this.sections){i.push(c.content.serialize());const d={};c.scale&&(d["font-scale"]=c.scale.serialize()),c.font&&(d["text-font"]=c.font.serialize()),c.textColor&&(d["text-color"]=c.textColor.serialize()),i.push(d)}return i}}class Ha{constructor(i){this.type=hi,this.input=i}static parse(i,c){if(i.length!==2)return c.error("Expected two arguments.");const d=c.parse(i[1],1,fn);return d?new Ha(d):c.error("No image name provided.")}evaluate(i){const c=this.input.evaluate(i),d=Br.fromString(c);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(c)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const C1={"to-boolean":tn,"to-color":vn,"to-number":Pe,"to-string":fn};class wo{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const d=i[0];if((d==="to-boolean"||d==="to-string")&&i.length!==2)return c.error("Expected one argument.");const g=C1[d],_=[];for(let E=1;E<i.length;E++){const S=c.parse(i[E],E,Dn);if(!S)return null;_.push(S)}return new wo(g,_)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let c,d;for(const g of this.args){if(c=g.evaluate(i),d=null,c instanceof Qn)return c;if(typeof c=="string"){const _=i.parseColor(c);if(_)return _}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:bo(c[0],c[1],c[2],c[3]),!d))return new Qn(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new sr(d||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const d of this.args){if(c=d.evaluate(i),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new sr(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?ji.fromString(Ko(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?Br.fromString(Ko(this.args[0].evaluate(i))):Ko(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ja([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ha(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(c=>{i.push(c.serialize())}),i}}const D1=["Unknown","Point","LineString","Polygon"];class Ng{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?D1[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:d,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*c-i[0])+this.featureDistanceData.bearing[1]*(g*c-i[1])}return 0}parseColor(i){let c=this._parseColorCache[i];return c||(c=this._parseColorCache[i]=Qn.parse(i)),c}}class Fr{constructor(i,c,d,g){this.name=i,this.type=c,this._evaluate=d,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,c){const d=i[0],g=Fr.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(g)?g[0]:g.type,E=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,S=E.filter(([B])=>!Array.isArray(B)||B.length===i.length-1);let L=null;for(const[B,N]of S){L=new _s(c.registry,c.path,null,c.scope);const j=[];let Y=!1;for(let Q=1;Q<i.length;Q++){const ot=i[Q],dt=Array.isArray(B)?B[Q-1]:B.type,mt=L.parse(ot,1+j.length,dt);if(!mt){Y=!0;break}j.push(mt)}if(!Y)if(Array.isArray(B)&&B.length!==j.length)L.error(`Expected ${B.length} arguments, but found ${j.length} instead.`);else{for(let Q=0;Q<j.length;Q++){const ot=Array.isArray(B)?B[Q]:B.type,dt=j[Q];L.concat(Q+1).checkSubtype(ot,dt.type)}if(L.errors.length===0)return new Fr(d,_,N,j)}}if(S.length===1)c.errors.push(...L.errors);else{const B=(S.length?S:E).map(([j])=>{return Y=j,Array.isArray(Y)?`(${Y.map(di).join(", ")})`:`(${di(Y.type)}...)`;var Y}).join(" | "),N=[];for(let j=1;j<i.length;j++){const Y=c.parse(i[j],1+N.length);if(!Y)return null;N.push(di(Y.type))}c.error(`Expected arguments of type ${B}, but found (${N.join(", ")}) instead.`)}return null}static register(i,c){Fr.definitions=c;for(const d in c)i[d]=Fr}}class Gu{constructor(i,c,d){this.type=xi,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=c}static parse(i,c){if(i.length!==2)return c.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,tn);if(!g)return null;const _=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,tn);if(!_)return null;let E=null;return d.locale&&(E=c.parse(d.locale,1,fn),!E)?null:new Gu(g,_,E)}evaluate(i){return new Oa(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const vs=8192;function mp(l,i){l[0]=Math.min(l[0],i[0]),l[1]=Math.min(l[1],i[1]),l[2]=Math.max(l[2],i[0]),l[3]=Math.max(l[3],i[1])}function Ou(l,i){return!(l[0]<=i[0]||l[2]>=i[2]||l[1]<=i[1]||l[3]>=i[3])}function Ug(l,i){const c=(180+l[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(c*g*vs),Math.round(d*g*vs)]}function ju(l,i,c){const d=l[0]-i[0],g=l[1]-i[1],_=l[0]-c[0],E=l[1]-c[1];return d*E-_*g==0&&d*_<=0&&g*E<=0}function gp(l,i){let c=!1;for(let E=0,S=i.length;E<S;E++){const L=i[E];for(let B=0,N=L.length;B<N-1;B++){if(ju(l,L[B],L[B+1]))return!1;(g=L[B])[1]>(d=l)[1]!=(_=L[B+1])[1]>d[1]&&d[0]<(_[0]-g[0])*(d[1]-g[1])/(_[1]-g[1])+g[0]&&(c=!c)}}var d,g,_;return c}function R1(l,i){for(let c=0;c<i.length;c++)if(gp(l,i[c]))return!0;return!1}function Vg(l,i,c,d){const g=d[0]-c[0],_=d[1]-c[1],E=(l[0]-c[0])*_-g*(l[1]-c[1]),S=(i[0]-c[0])*_-g*(i[1]-c[1]);return E>0&&S<0||E<0&&S>0}function L1(l,i,c){for(const B of c)for(let N=0;N<B.length-1;++N)if((S=[(E=B[N+1])[0]-(_=B[N])[0],E[1]-_[1]])[0]*(L=[(g=i)[0]-(d=l)[0],g[1]-d[1]])[1]-S[1]*L[0]!=0&&Vg(d,g,_,E)&&Vg(_,E,d,g))return!0;var d,g,_,E,S,L;return!1}function Gg(l,i){for(let c=0;c<l.length;++c)if(!gp(l[c],i))return!1;for(let c=0;c<l.length-1;++c)if(L1(l[c],l[c+1],i))return!1;return!0}function I1(l,i){for(let c=0;c<i.length;c++)if(Gg(l,i[c]))return!0;return!1}function Hu(l,i,c){const d=[];for(let g=0;g<l.length;g++){const _=[];for(let E=0;E<l[g].length;E++){const S=Ug(l[g][E],c);mp(i,S),_.push(S)}d.push(_)}return d}function Wl(l,i,c){const d=[];for(let g=0;g<l.length;g++){const _=Hu(l[g],i,c);d.push(_)}return d}function Og(l,i,c,d){if(l[0]<c[0]||l[0]>c[2]){const g=.5*d;let _=l[0]-c[0]>g?-d:c[0]-l[0]>g?d:0;_===0&&(_=l[0]-c[2]>g?-d:c[2]-l[0]>g?d:0),l[0]+=_}mp(i,l)}function jg(l,i,c,d){const g=Math.pow(2,d.z)*vs,_=[d.x*vs,d.y*vs],E=[];if(!l)return E;for(const S of l)for(const L of S){const B=[L.x+_[0],L.y+_[1]];Og(B,i,c,g),E.push(B)}return E}function Hg(l,i,c,d){const g=Math.pow(2,d.z)*vs,_=[d.x*vs,d.y*vs],E=[];if(!l)return E;for(const L of l){const B=[];for(const N of L){const j=[N.x+_[0],N.y+_[1]];mp(i,j),B.push(j)}E.push(B)}if(i[2]-i[0]<=g/2){(S=i)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const L of E)for(const B of L)Og(B,i,c,g)}var S;return E}class ea{constructor(i,c){this.type=tn,this.geojson=i,this.geometries=c}static parse(i,c){if(i.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Vu(i[1])){const d=i[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const _=d.features[g].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ea(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ea(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new ea(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=c.canonicalID();if(!E)return!1;if(d.type==="Polygon"){const S=Hu(d.coordinates,_,E),L=jg(c.geometry(),g,_,E);if(!Ou(g,_))return!1;for(const B of L)if(!gp(B,S))return!1}if(d.type==="MultiPolygon"){const S=Wl(d.coordinates,_,E),L=jg(c.geometry(),g,_,E);if(!Ou(g,_))return!1;for(const B of L)if(!R1(B,S))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=c.canonicalID();if(!E)return!1;if(d.type==="Polygon"){const S=Hu(d.coordinates,_,E),L=Hg(c.geometry(),g,_,E);if(!Ou(g,_))return!1;for(const B of L)if(!Gg(B,S))return!1}if(d.type==="MultiPolygon"){const S=Wl(d.coordinates,_,E),L=Hg(c.geometry(),g,_,E);if(!Ou(g,_))return!1;for(const B of L)if(!I1(B,S))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ar(l){if(l instanceof Fr&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof ea)return!1;let i=!0;return l.eachChild(c=>{i&&!Ar(c)&&(i=!1)}),i}function ql(l){if(l instanceof Fr&&l.name==="feature-state")return!1;let i=!0;return l.eachChild(c=>{i&&!ql(c)&&(i=!1)}),i}function Yl(l,i){if(l instanceof Fr&&i.indexOf(l.name)>=0)return!1;let c=!0;return l.eachChild(d=>{c&&!Yl(d,i)&&(c=!1)}),c}class na{constructor(i,c){this.type=c.type,this.name=i,this.boundExpression=c}static parse(i,c){if(i.length!==2||typeof i[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=i[1];return c.scope.has(d)?new na(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class _s{constructor(i,c=[],d,g=new kn,_=[]){this.registry=i,this.path=c,this.key=c.map(E=>`[${E}]`).join(""),this.scope=g,this.errors=_,this.expectedType=d}parse(i,c,d,g,_={}){return c?this.concat(c,d,g)._parse(i,_):this._parse(i,_)}_parse(i,c){function d(g,_,E){return E==="assert"?new Mo(_,[g]):E==="coerce"?new wo(_,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[g];if(_){let E=_.parse(i,this);if(!E)return null;if(this.expectedType){const S=this.expectedType,L=E.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||L.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(S,L))return null}else E=d(E,S,c.typeAnnotation||"coerce");else E=d(E,S,c.typeAnnotation||"assert")}if(!(E instanceof Zo)&&E.type.kind!=="resolvedImage"&&Wu(E)){const S=new Ng;try{E=new Zo(E.type,E.evaluate(S))}catch(L){return this.error(L.message),null}}return E}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,c,d){const g=typeof i=="number"?this.path.concat(i):this.path,_=d?this.scope.concat(d):this.scope;return new _s(this.registry,g,c||null,_,this.errors)}error(i,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new ln(d,i))}checkSubtype(i,c){const d=Xo(i,c);return d&&this.error(d),d}}function Wu(l){if(l instanceof na)return Wu(l.boundExpression);if(l instanceof Fr&&l.name==="error"||l instanceof Gu||l instanceof ea)return!1;const i=l instanceof wo||l instanceof Mo;let c=!0;return l.eachChild(d=>{c=i?c&&Wu(d):c&&d instanceof Zo}),!!c&&Ar(l)&&Yl(l,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Xl(l,i){const c=l.length-1;let d,g,_=0,E=c,S=0;for(;_<=E;)if(S=Math.floor((_+E)/2),d=l[S],g=l[S+1],d<=i){if(S===c||i<g)return S;_=S+1}else{if(!(d>i))throw new sr("Input is not a number.");E=S-1}return 0}class Kl{constructor(i,c,d){this.type=i,this.input=c,this.labels=[],this.outputs=[];for(const[g,_]of d)this.labels.push(g),this.outputs.push(_)}static parse(i,c){if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(i[1],1,Pe);if(!d)return null;const g=[];let _=null;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);for(let E=1;E<i.length;E+=2){const S=E===1?-1/0:i[E],L=i[E+1],B=E,N=E+1;if(typeof S!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(g.length&&g[g.length-1][0]>=S)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const j=c.parse(L,N,_);if(!j)return null;_=_||j.type,g.push([S,j])}return new Kl(_,d,g)}evaluate(i){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return d[0].evaluate(i);const _=c.length;return g>=c[_-1]?d[_-1].evaluate(i):d[Xl(c,g)].evaluate(i)}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&i.push(this.labels[c]),i.push(this.outputs[c].serialize());return i}}function bn(l,i,c){return l*(1-c)+i*c}var qu=Object.freeze({__proto__:null,number:bn,color:function(l,i,c){return new Qn(bn(l.r,i.r,c),bn(l.g,i.g,c),bn(l.b,i.b,c),bn(l.a,i.a,c))},array:function(l,i,c){return l.map((d,g)=>bn(d,i[g],c))}});const Wg=.95047,qg=1.08883,yp=4/29,xp=6/29,vp=3*xp*xp,Yg=Math.PI/180,Xg=180/Math.PI;function Yu(l){return l>.008856451679035631?Math.pow(l,1/3):l/vp+yp}function bs(l){return l>xp?l*l*l:vp*(l-yp)}function Wa(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function _p(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function Xu(l){const i=_p(l.r),c=_p(l.g),d=_p(l.b),g=Yu((.4124564*i+.3575761*c+.1804375*d)/Wg),_=Yu((.2126729*i+.7151522*c+.072175*d)/1);return{l:116*_-16,a:500*(g-_),b:200*(_-Yu((.0193339*i+.119192*c+.9503041*d)/qg)),alpha:l.a}}function bp(l){let i=(l.l+16)/116,c=isNaN(l.a)?i:i+l.a/500,d=isNaN(l.b)?i:i-l.b/200;return i=1*bs(i),c=Wg*bs(c),d=qg*bs(d),new Qn(Wa(3.2404542*c-1.5371385*i-.4985314*d),Wa(-.969266*c+1.8760108*i+.041556*d),Wa(.0556434*c-.2040259*i+1.0572252*d),l.alpha)}function k1(l,i,c){const d=i-l;return l+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const Zl={forward:Xu,reverse:bp,interpolate:function(l,i,c){return{l:bn(l.l,i.l,c),a:bn(l.a,i.a,c),b:bn(l.b,i.b,c),alpha:bn(l.alpha,i.alpha,c)}}},Jl={forward:function(l){const{l:i,a:c,b:d}=Xu(l),g=Math.atan2(d,c)*Xg;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:i,alpha:l.a}},reverse:function(l){const i=l.h*Yg,c=l.c;return bp({l:l.l,a:Math.cos(i)*c,b:Math.sin(i)*c,alpha:l.alpha})},interpolate:function(l,i,c){return{h:k1(l.h,i.h,c),c:bn(l.c,i.c,c),l:bn(l.l,i.l,c),alpha:bn(l.alpha,i.alpha,c)}}};var Mp=Object.freeze({__proto__:null,lab:Zl,hcl:Jl});class zr{constructor(i,c,d,g,_){this.type=i,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[E,S]of _)this.labels.push(E),this.outputs.push(S)}static interpolationFactor(i,c,d,g){let _=0;if(i.name==="exponential")_=Ku(c,i.base,d,g);else if(i.name==="linear")_=Ku(c,1,d,g);else if(i.name==="cubic-bezier"){const E=i.controlPoints;_=new y(E[0],E[1],E[2],E[3]).solve(Ku(c,1,d,g))}return _}static parse(i,c){let[d,g,_,...E]=i;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const B=g[1];if(typeof B!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:B}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const B=g.slice(1);if(B.length!==4||B.some(N=>typeof N!="number"||N<0||N>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:B}}}if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(_=c.parse(_,2,Pe),!_)return null;const S=[];let L=null;d==="interpolate-hcl"||d==="interpolate-lab"?L=vn:c.expectedType&&c.expectedType.kind!=="value"&&(L=c.expectedType);for(let B=0;B<E.length;B+=2){const N=E[B],j=E[B+1],Y=B+3,Q=B+4;if(typeof N!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(S.length&&S[S.length-1][0]>=N)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const ot=c.parse(j,Q,L);if(!ot)return null;L=L||ot.type,S.push([N,ot])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new zr(L,d,g,_,S):c.error(`Type ${di(L)} is not interpolatable.`)}evaluate(i){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return d[0].evaluate(i);const _=c.length;if(g>=c[_-1])return d[_-1].evaluate(i);const E=Xl(c,g),S=zr.interpolationFactor(this.interpolation,g,c[E],c[E+1]),L=d[E].evaluate(i),B=d[E+1].evaluate(i);return this.operator==="interpolate"?qu[this.type.kind.toLowerCase()](L,B,S):this.operator==="interpolate-hcl"?Jl.reverse(Jl.interpolate(Jl.forward(L),Jl.forward(B),S)):Zl.reverse(Zl.interpolate(Zl.forward(L),Zl.forward(B),S))}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const c=[this.operator,i,this.input.serialize()];for(let d=0;d<this.labels.length;d++)c.push(this.labels[d],this.outputs[d].serialize());return c}}function Ku(l,i,c,d){const g=d-c,_=l-c;return g===0?0:i===1?_/g:(Math.pow(i,_)-1)/(Math.pow(i,g)-1)}class Ql{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const _=[];for(const S of i.slice(1)){const L=c.parse(S,1+_.length,d,void 0,{typeAnnotation:"omit"});if(!L)return null;d=d||L.type,_.push(L)}const E=g&&_.some(S=>Xo(g,S.type));return new Ql(E?Dn:d,_)}evaluate(i){let c,d=null,g=0;for(const _ of this.args){if(g++,d=_.evaluate(i),d&&d instanceof Br&&!d.available&&(c||(c=d),d=null,g===this.args.length))return c;if(d!==null)break}return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(c=>{i.push(c.serialize())}),i}}class $l{constructor(i,c){this.type=c.type,this.bindings=[].concat(i),this.result=c}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const c of this.bindings)i(c[1]);i(this.result)}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let _=1;_<i.length-1;_+=2){const E=i[_];if(typeof E!="string")return c.error(`Expected string, but found ${typeof E} instead.`,_);if(/[^a-zA-Z0-9_]/.test(E))return c.error("Variable names must contain only alphanumeric characters or '_'.",_);const S=c.parse(i[_+1],_+1);if(!S)return null;d.push([E,S])}const g=c.parse(i[i.length-1],i.length-1,c.expectedType,d);return g?new $l(d,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[c,d]of this.bindings)i.push(c,d.serialize());return i.push(this.result.serialize()),i}}class wp{constructor(i,c,d){this.type=i,this.index=c,this.input=d}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,Pe),g=c.parse(i[2],2,fi(c.expectedType||Dn));return d&&g?new wp(g.type.itemType,d,g):null}evaluate(i){const c=this.index.evaluate(i),d=this.input.evaluate(i);if(c<0)throw new sr(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new sr(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new sr(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Zu{constructor(i,c){this.type=tn,this.needle=i,this.haystack=c}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,Dn),g=c.parse(i[2],2,Dn);return d&&g?Nu(d.type,[tn,fn,Pe,Bn,Dn])?new Zu(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(d.type)} instead`):null}evaluate(i){const c=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(d==null)return!1;if(!Ga(c,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${di(Fi(c))} instead.`);if(!Ga(d,["string","array"]))throw new sr(`Expected second argument to be of type array or string, but found ${di(Fi(d))} instead.`);return d.indexOf(c)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ju{constructor(i,c,d){this.type=Pe,this.needle=i,this.haystack=c,this.fromIndex=d}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,Dn),g=c.parse(i[2],2,Dn);if(!d||!g)return null;if(!Nu(d.type,[tn,fn,Pe,Bn,Dn]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${di(d.type)} instead`);if(i.length===4){const _=c.parse(i[3],3,Pe);return _?new Ju(d,g,_):null}return new Ju(d,g)}evaluate(i){const c=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!Ga(c,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${di(Fi(c))} instead.`);if(!Ga(d,["string","array"]))throw new sr(`Expected second argument to be of type array or string, but found ${di(Fi(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qu{constructor(i,c,d,g,_,E){this.inputType=i,this.type=c,this.input=d,this.cases=g,this.outputs=_,this.otherwise=E}static parse(i,c){if(i.length<5)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const _={},E=[];for(let B=2;B<i.length-1;B+=2){let N=i[B];const j=i[B+1];Array.isArray(N)||(N=[N]);const Y=c.concat(B);if(N.length===0)return Y.error("Expected at least one branch label.");for(const ot of N){if(typeof ot!="number"&&typeof ot!="string")return Y.error("Branch labels must be numbers or strings.");if(typeof ot=="number"&&Math.abs(ot)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ot=="number"&&Math.floor(ot)!==ot)return Y.error("Numeric branch labels must be integer values.");if(d){if(Y.checkSubtype(d,Fi(ot)))return null}else d=Fi(ot);if(_[String(ot)]!==void 0)return Y.error("Branch labels must be unique.");_[String(ot)]=E.length}const Q=c.parse(j,B,g);if(!Q)return null;g=g||Q.type,E.push(Q)}const S=c.parse(i[1],1,Dn);if(!S)return null;const L=c.parse(i[i.length-1],i.length-1,g);return L?S.type.kind!=="value"&&c.concat(1).checkSubtype(d,S.type)?null:new Qu(d,g,S,_,E,L):null}evaluate(i){const c=this.input.evaluate(i);return(Fi(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),d=[],g={};for(const E of c){const S=g[this.cases[E]];S===void 0?(g[this.cases[E]]=d.length,d.push([this.cases[E],[E]])):d[S][1].push(E)}const _=E=>this.inputType.kind==="number"?Number(E):E;for(const[E,S]of d)i.push(S.length===1?_(S[0]):S.map(_)),i.push(this.outputs[E].serialize());return i.push(this.otherwise.serialize()),i}}class $u{constructor(i,c,d){this.type=i,this.branches=c,this.otherwise=d}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let E=1;E<i.length-1;E+=2){const S=c.parse(i[E],E,tn);if(!S)return null;const L=c.parse(i[E+1],E+1,d);if(!L)return null;g.push([S,L]),d=d||L.type}const _=c.parse(i[i.length-1],i.length-1,d);return _?new $u(d,g,_):null}evaluate(i){for(const[c,d]of this.branches)if(c.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[c,d]of this.branches)i(c),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(c=>{i.push(c.serialize())}),i}}class th{constructor(i,c,d,g){this.type=i,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=c.parse(i[1],1,Dn),g=c.parse(i[2],2,Pe);if(!d||!g)return null;if(!Nu(d.type,[fi(Dn),fn,Dn]))return c.error(`Expected first argument to be of type array or string, but found ${di(d.type)} instead`);if(i.length===4){const _=c.parse(i[3],3,Pe);return _?new th(d.type,d,g,_):null}return new th(d.type,d,g)}evaluate(i){const c=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!Ga(c,["string","array"]))throw new sr(`Expected first argument to be of type array or string, but found ${di(Fi(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return c.slice(d,g)}return c.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Kg(l,i){return l==="=="||l==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Zg(l,i,c,d){return d.compare(i,c)===0}function qa(l,i,c){const d=l!=="=="&&l!=="!=";return class NE{constructor(_,E,S){this.type=tn,this.lhs=_,this.rhs=E,this.collator=S,this.hasUntypedArgument=_.type.kind==="value"||E.type.kind==="value"}static parse(_,E){if(_.length!==3&&_.length!==4)return E.error("Expected two or three arguments.");const S=_[0];let L=E.parse(_[1],1,Dn);if(!L)return null;if(!Kg(S,L.type))return E.concat(1).error(`"${S}" comparisons are not supported for type '${di(L.type)}'.`);let B=E.parse(_[2],2,Dn);if(!B)return null;if(!Kg(S,B.type))return E.concat(2).error(`"${S}" comparisons are not supported for type '${di(B.type)}'.`);if(L.type.kind!==B.type.kind&&L.type.kind!=="value"&&B.type.kind!=="value")return E.error(`Cannot compare types '${di(L.type)}' and '${di(B.type)}'.`);d&&(L.type.kind==="value"&&B.type.kind!=="value"?L=new Mo(B.type,[L]):L.type.kind!=="value"&&B.type.kind==="value"&&(B=new Mo(L.type,[B])));let N=null;if(_.length===4){if(L.type.kind!=="string"&&B.type.kind!=="string"&&L.type.kind!=="value"&&B.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(N=E.parse(_[3],3,xi),!N)return null}return new NE(L,B,N)}evaluate(_){const E=this.lhs.evaluate(_),S=this.rhs.evaluate(_);if(d&&this.hasUntypedArgument){const L=Fi(E),B=Fi(S);if(L.kind!==B.kind||L.kind!=="string"&&L.kind!=="number")throw new sr(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${L.kind}, ${B.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const L=Fi(E),B=Fi(S);if(L.kind!=="string"||B.kind!=="string")return i(_,E,S)}return this.collator?c(_,E,S,this.collator.evaluate(_)):i(_,E,S)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[l];return this.eachChild(E=>{_.push(E.serialize())}),_}}}const B1=qa("==",function(l,i,c){return i===c},Zg),F1=qa("!=",function(l,i,c){return i!==c},function(l,i,c,d){return!Zg(0,i,c,d)}),Jg=qa("<",function(l,i,c){return i<c},function(l,i,c,d){return d.compare(i,c)<0}),z1=qa(">",function(l,i,c){return i>c},function(l,i,c,d){return d.compare(i,c)>0}),N1=qa("<=",function(l,i,c){return i<=c},function(l,i,c,d){return d.compare(i,c)<=0}),U1=qa(">=",function(l,i,c){return i>=c},function(l,i,c,d){return d.compare(i,c)>=0});class Ap{constructor(i,c,d,g,_){this.type=fn,this.number=i,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(i,c){if(i.length!==3)return c.error("Expected two arguments.");const d=c.parse(i[1],1,Pe);if(!d)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let _=null;if(g.locale&&(_=c.parse(g.locale,1,fn),!_))return null;let E=null;if(g.currency&&(E=c.parse(g.currency,1,fn),!E))return null;let S=null;if(g["min-fraction-digits"]&&(S=c.parse(g["min-fraction-digits"],1,Pe),!S))return null;let L=null;return g["max-fraction-digits"]&&(L=c.parse(g["max-fraction-digits"],1,Pe),!L)?null:new Ap(d,_,E,S,L)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class eh{constructor(i){this.type=Pe,this.input=i}static parse(i,c){if(i.length!==2)return c.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=c.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${di(d.type)} instead.`):new eh(d):null}evaluate(i){const c=this.input.evaluate(i);if(typeof c=="string"||Array.isArray(c))return c.length;throw new sr(`Expected value to be of type string or array, but found ${di(Fi(c))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(c=>{i.push(c.serialize())}),i}}const ia={"==":B1,"!=":F1,">":z1,"<":Jg,">=":U1,"<=":N1,array:Mo,at:wp,boolean:Mo,case:$u,coalesce:Ql,collator:Gu,format:ja,image:Ha,in:Zu,"index-of":Ju,interpolate:zr,"interpolate-hcl":zr,"interpolate-lab":zr,length:eh,let:$l,literal:Zo,match:Qu,number:Mo,"number-format":Ap,object:Mo,slice:th,step:Kl,string:Mo,"to-boolean":wo,"to-color":wo,"to-number":wo,"to-string":wo,var:na,within:ea};function Ep(l,[i,c,d,g]){i=i.evaluate(l),c=c.evaluate(l),d=d.evaluate(l);const _=g?g.evaluate(l):1,E=bo(i,c,d,_);if(E)throw new sr(E);return new Qn(i/255*_,c/255*_,d/255*_,_)}function Qg(l,i){return l in i}function Tp(l,i){const c=i[l];return c===void 0?null:c}function Ms(l){return{type:l}}function Pp(l){return{result:"success",value:l}}function ra(l){return{result:"error",value:l}}function Ya(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function $g(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Sp(l){return!!l.expression&&l.expression.interpolated}function ri(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function oa(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function ty(l){return l}function Cp(l,i){const c=i.type==="color",d=l.stops&&typeof l.stops[0][0]=="object",g=d||!(d||l.property!==void 0),_=l.type||(Sp(i)?"exponential":"interval");if(c&&((l=Se({},l)).stops&&(l.stops=l.stops.map(B=>[B[0],Qn.parse(B[1])])),l.default=Qn.parse(l.default?l.default:i.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!Mp[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let E,S,L;if(_==="exponential")E=Dp;else if(_==="interval")E=G1;else if(_==="categorical"){E=V1,S=Object.create(null);for(const B of l.stops)S[B[0]]=B[1];L=typeof l.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);E=ey}if(d){const B={},N=[];for(let Q=0;Q<l.stops.length;Q++){const ot=l.stops[Q],dt=ot[0].zoom;B[dt]===void 0&&(B[dt]={zoom:dt,type:l.type,property:l.property,default:l.default,stops:[]},N.push(dt)),B[dt].stops.push([ot[0].value,ot[1]])}const j=[];for(const Q of N)j.push([B[Q].zoom,Cp(B[Q],i)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:zr.interpolationFactor.bind(void 0,Y),zoomStops:j.map(Q=>Q[0]),evaluate:({zoom:Q},ot)=>Dp({stops:j,base:l.base},i,Q).evaluate(Q,ot)}}if(g){const B=_==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:B,interpolationFactor:zr.interpolationFactor.bind(void 0,B),zoomStops:l.stops.map(N=>N[0]),evaluate:({zoom:N})=>E(l,i,N,S,L)}}return{kind:"source",evaluate(B,N){const j=N&&N.properties?N.properties[l.property]:void 0;return j===void 0?tc(l.default,i.default):E(l,i,j,S,L)}}}function tc(l,i,c){return l!==void 0?l:i!==void 0?i:c!==void 0?c:void 0}function V1(l,i,c,d,g){return tc(typeof c===g?d[c]:void 0,l.default,i.default)}function G1(l,i,c){if(ri(c)!=="number")return tc(l.default,i.default);const d=l.stops.length;if(d===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[d-1][0])return l.stops[d-1][1];const g=Xl(l.stops.map(_=>_[0]),c);return l.stops[g][1]}function Dp(l,i,c){const d=l.base!==void 0?l.base:1;if(ri(c)!=="number")return tc(l.default,i.default);const g=l.stops.length;if(g===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[g-1][0])return l.stops[g-1][1];const _=Xl(l.stops.map(N=>N[0]),c),E=function(N,j,Y,Q){const ot=Q-Y,dt=N-Y;return ot===0?0:j===1?dt/ot:(Math.pow(j,dt)-1)/(Math.pow(j,ot)-1)}(c,d,l.stops[_][0],l.stops[_+1][0]),S=l.stops[_][1],L=l.stops[_+1][1];let B=qu[i.type]||ty;if(l.colorSpace&&l.colorSpace!=="rgb"){const N=Mp[l.colorSpace];B=(j,Y)=>N.reverse(N.interpolate(N.forward(j),N.forward(Y),E))}return typeof S.evaluate=="function"?{evaluate(...N){const j=S.evaluate.apply(void 0,N),Y=L.evaluate.apply(void 0,N);if(j!==void 0&&Y!==void 0)return B(j,Y,E)}}:B(S,L,E)}function ey(l,i,c){return i.type==="color"?c=Qn.parse(c):i.type==="formatted"?c=ji.fromString(c.toString()):i.type==="resolvedImage"?c=Br.fromString(c.toString()):ri(c)===i.type||i.type==="enum"&&i.values[c]||(c=void 0),tc(c,l.default,i.default)}Fr.register(ia,{error:[{kind:"error"},[fn],(l,[i])=>{throw new sr(i.evaluate(l))}],typeof:[fn,[Dn],(l,[i])=>di(Fi(i.evaluate(l)))],"to-rgba":[fi(Pe,4),[vn],(l,[i])=>i.evaluate(l).toArray()],rgb:[vn,[Pe,Pe,Pe],Ep],rgba:[vn,[Pe,Pe,Pe,Pe],Ep],has:{type:tn,overloads:[[[fn],(l,[i])=>Qg(i.evaluate(l),l.properties())],[[fn,Sn],(l,[i,c])=>Qg(i.evaluate(l),c.evaluate(l))]]},get:{type:Dn,overloads:[[[fn],(l,[i])=>Tp(i.evaluate(l),l.properties())],[[fn,Sn],(l,[i,c])=>Tp(i.evaluate(l),c.evaluate(l))]]},"feature-state":[Dn,[fn],(l,[i])=>Tp(i.evaluate(l),l.featureState||{})],properties:[Sn,[],l=>l.properties()],"geometry-type":[fn,[],l=>l.geometryType()],id:[Dn,[],l=>l.id()],zoom:[Pe,[],l=>l.globals.zoom],pitch:[Pe,[],l=>l.globals.pitch||0],"distance-from-center":[Pe,[],l=>l.distanceFromCenter()],"heatmap-density":[Pe,[],l=>l.globals.heatmapDensity||0],"line-progress":[Pe,[],l=>l.globals.lineProgress||0],"sky-radial-progress":[Pe,[],l=>l.globals.skyRadialProgress||0],accumulated:[Dn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Pe,Ms(Pe),(l,i)=>{let c=0;for(const d of i)c+=d.evaluate(l);return c}],"*":[Pe,Ms(Pe),(l,i)=>{let c=1;for(const d of i)c*=d.evaluate(l);return c}],"-":{type:Pe,overloads:[[[Pe,Pe],(l,[i,c])=>i.evaluate(l)-c.evaluate(l)],[[Pe],(l,[i])=>-i.evaluate(l)]]},"/":[Pe,[Pe,Pe],(l,[i,c])=>i.evaluate(l)/c.evaluate(l)],"%":[Pe,[Pe,Pe],(l,[i,c])=>i.evaluate(l)%c.evaluate(l)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(l,[i,c])=>Math.pow(i.evaluate(l),c.evaluate(l))],sqrt:[Pe,[Pe],(l,[i])=>Math.sqrt(i.evaluate(l))],log10:[Pe,[Pe],(l,[i])=>Math.log(i.evaluate(l))/Math.LN10],ln:[Pe,[Pe],(l,[i])=>Math.log(i.evaluate(l))],log2:[Pe,[Pe],(l,[i])=>Math.log(i.evaluate(l))/Math.LN2],sin:[Pe,[Pe],(l,[i])=>Math.sin(i.evaluate(l))],cos:[Pe,[Pe],(l,[i])=>Math.cos(i.evaluate(l))],tan:[Pe,[Pe],(l,[i])=>Math.tan(i.evaluate(l))],asin:[Pe,[Pe],(l,[i])=>Math.asin(i.evaluate(l))],acos:[Pe,[Pe],(l,[i])=>Math.acos(i.evaluate(l))],atan:[Pe,[Pe],(l,[i])=>Math.atan(i.evaluate(l))],min:[Pe,Ms(Pe),(l,i)=>Math.min(...i.map(c=>c.evaluate(l)))],max:[Pe,Ms(Pe),(l,i)=>Math.max(...i.map(c=>c.evaluate(l)))],abs:[Pe,[Pe],(l,[i])=>Math.abs(i.evaluate(l))],round:[Pe,[Pe],(l,[i])=>{const c=i.evaluate(l);return c<0?-Math.round(-c):Math.round(c)}],floor:[Pe,[Pe],(l,[i])=>Math.floor(i.evaluate(l))],ceil:[Pe,[Pe],(l,[i])=>Math.ceil(i.evaluate(l))],"filter-==":[tn,[fn,Dn],(l,[i,c])=>l.properties()[i.value]===c.value],"filter-id-==":[tn,[Dn],(l,[i])=>l.id()===i.value],"filter-type-==":[tn,[fn],(l,[i])=>l.geometryType()===i.value],"filter-<":[tn,[fn,Dn],(l,[i,c])=>{const d=l.properties()[i.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[tn,[Dn],(l,[i])=>{const c=l.id(),d=i.value;return typeof c==typeof d&&c<d}],"filter->":[tn,[fn,Dn],(l,[i,c])=>{const d=l.properties()[i.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[tn,[Dn],(l,[i])=>{const c=l.id(),d=i.value;return typeof c==typeof d&&c>d}],"filter-<=":[tn,[fn,Dn],(l,[i,c])=>{const d=l.properties()[i.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[tn,[Dn],(l,[i])=>{const c=l.id(),d=i.value;return typeof c==typeof d&&c<=d}],"filter->=":[tn,[fn,Dn],(l,[i,c])=>{const d=l.properties()[i.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[tn,[Dn],(l,[i])=>{const c=l.id(),d=i.value;return typeof c==typeof d&&c>=d}],"filter-has":[tn,[Dn],(l,[i])=>i.value in l.properties()],"filter-has-id":[tn,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[tn,[fi(fn)],(l,[i])=>i.value.indexOf(l.geometryType())>=0],"filter-id-in":[tn,[fi(Dn)],(l,[i])=>i.value.indexOf(l.id())>=0],"filter-in-small":[tn,[fn,fi(Dn)],(l,[i,c])=>c.value.indexOf(l.properties()[i.value])>=0],"filter-in-large":[tn,[fn,fi(Dn)],(l,[i,c])=>function(d,g,_,E){for(;_<=E;){const S=_+E>>1;if(g[S]===d)return!0;g[S]>d?E=S-1:_=S+1}return!1}(l.properties()[i.value],c.value,0,c.value.length-1)],all:{type:tn,overloads:[[[tn,tn],(l,[i,c])=>i.evaluate(l)&&c.evaluate(l)],[Ms(tn),(l,i)=>{for(const c of i)if(!c.evaluate(l))return!1;return!0}]]},any:{type:tn,overloads:[[[tn,tn],(l,[i,c])=>i.evaluate(l)||c.evaluate(l)],[Ms(tn),(l,i)=>{for(const c of i)if(c.evaluate(l))return!0;return!1}]]},"!":[tn,[tn],(l,[i])=>!i.evaluate(l)],"is-supported-script":[tn,[fn],(l,[i])=>{const c=l.globals&&l.globals.isSupportedScript;return!c||c(i.evaluate(l))}],upcase:[fn,[fn],(l,[i])=>i.evaluate(l).toUpperCase()],downcase:[fn,[fn],(l,[i])=>i.evaluate(l).toLowerCase()],concat:[fn,Ms(Dn),(l,i)=>i.map(c=>Ko(c.evaluate(l))).join("")],"resolved-locale":[fn,[xi],(l,[i])=>i.evaluate(l).resolvedLocale()]});class nh{constructor(i,c){this.expression=i,this._warningHistory={},this._evaluator=new Ng,this._defaultValue=c?function(d){return d.type==="color"&&oa(d.default)?new Qn(0,0,0,0):d.type==="color"?Qn.parse(d.default)||null:d.default===void 0?null:d.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(i,c,d,g,_,E,S,L){return this._evaluator.globals=i,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(i,c,d,g,_,E,S,L){this._evaluator.globals=i,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=L||null;try{const B=this.expression.evaluate(this._evaluator);if(B==null||typeof B=="number"&&B!=B)return this._defaultValue;if(this._enumValues&&!(B in this._enumValues))throw new sr(`Expected value to be one of ${Object.keys(this._enumValues).map(N=>JSON.stringify(N)).join(", ")}, but found ${JSON.stringify(B)} instead.`);return B}catch(B){return this._warningHistory[B.message]||(this._warningHistory[B.message]=!0,typeof console!="undefined"&&console.warn(B.message)),this._defaultValue}}}function Xa(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in ia}function ec(l,i){const c=new _s(ia,[],i?function(g){const _={color:vn,string:fn,number:Pe,enum:fn,boolean:tn,formatted:kr,resolvedImage:hi};return g.type==="array"?fi(_[g.value]||Dn,g.length):_[g.type]}(i):void 0),d=c.parse(l,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Pp(new nh(d,i)):ra(c.errors)}class Rp{constructor(i,c){this.kind=i,this._styleExpression=c,this.isStateDependent=i!=="constant"&&!ql(c.expression)}evaluateWithoutErrorHandling(i,c,d,g,_,E){return this._styleExpression.evaluateWithoutErrorHandling(i,c,d,g,_,E)}evaluate(i,c,d,g,_,E){return this._styleExpression.evaluate(i,c,d,g,_,E)}}class Lp{constructor(i,c,d,g){this.kind=i,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=i!=="camera"&&!ql(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,c,d,g,_,E){return this._styleExpression.evaluateWithoutErrorHandling(i,c,d,g,_,E)}evaluate(i,c,d,g,_,E){return this._styleExpression.evaluate(i,c,d,g,_,E)}interpolationFactor(i,c,d){return this.interpolationType?zr.interpolationFactor(this.interpolationType,i,c,d):0}}function ny(l,i){if((l=ec(l,i)).result==="error")return l;const c=l.value.expression,d=Ar(c);if(!d&&!Ya(i))return ra([new ln("","data expressions not supported")]);const g=Yl(c,["zoom","pitch","distance-from-center"]);if(!g&&!$g(i))return ra([new ln("","zoom expressions not supported")]);const _=rh(c);return _||g?_ instanceof ln?ra([_]):_ instanceof zr&&!Sp(i)?ra([new ln("",'"interpolate" expressions cannot be used with this property')]):Pp(_?new Lp(d?"camera":"composite",l.value,_.labels,_ instanceof zr?_.interpolation:void 0):new Rp(d?"constant":"source",l.value)):ra([new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ih{constructor(i,c){this._parameters=i,this._specification=c,Se(this,Cp(this._parameters,this._specification))}static deserialize(i){return new ih(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function rh(l){let i=null;if(l instanceof $l)i=rh(l.result);else if(l instanceof Ql){for(const c of l.args)if(i=rh(c),i)break}else(l instanceof Kl||l instanceof zr)&&l.input instanceof Fr&&l.input.name==="zoom"&&(i=l);return i instanceof ln||l.eachChild(c=>{const d=rh(c);d instanceof ln?i=d:!i&&d?i=new ln("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new ln("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class Ye{constructor(i,c,d,g){this.message=(i?`${i}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function to(l){const i=l.key,c=l.value,d=l.valueSpec||{},g=l.objectElementValidators||{},_=l.style,E=l.styleSpec;let S=[];const L=ri(c);if(L!=="object")return[new Ye(i,c,`object expected, ${L} found`)];for(const B in c){const N=B.split(".")[0],j=d[N]||d["*"];let Y;g[N]?Y=g[N]:d[N]?Y=Qi:g["*"]?Y=g["*"]:d["*"]&&(Y=Qi),Y?S=S.concat(Y({key:(i&&`${i}.`)+B,value:c[B],valueSpec:j,style:_,styleSpec:E,object:c,objectKey:B},c)):S.push(new Ye(i,c[B],`unknown property "${B}"`))}for(const B in d)g[B]||d[B].required&&d[B].default===void 0&&c[B]===void 0&&S.push(new Ye(i,c,`missing required property "${B}"`));return S}function nc(l){const i=l.value,c=l.valueSpec,d=l.style,g=l.styleSpec,_=l.key,E=l.arrayElementValidator||Qi;if(ri(i)!=="array")return[new Ye(_,i,`array expected, ${ri(i)} found`)];if(c.length&&i.length!==c.length)return[new Ye(_,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new Ye(_,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let S={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};g.$version<7&&(S.function=c.function),ri(c.value)==="object"&&(S=c.value);let L=[];for(let B=0;B<i.length;B++)L=L.concat(E({array:i,arrayIndex:B,value:i[B],valueSpec:S,style:d,styleSpec:g,key:`${_}[${B}]`}));return L}function iy(l){const i=l.key,c=l.value,d=l.valueSpec;let g=ri(c);if(g==="number"&&c!=c&&(g="NaN"),g!=="number")return[new Ye(i,c,`number expected, ${g} found`)];if("minimum"in d){let _=d.minimum;if(ri(d.minimum)==="array"&&(_=d.minimum[l.arrayIndex]),c<_)return[new Ye(i,c,`${c} is less than the minimum value ${_}`)]}if("maximum"in d){let _=d.maximum;if(ri(d.maximum)==="array"&&(_=d.maximum[l.arrayIndex]),c>_)return[new Ye(i,c,`${c} is greater than the maximum value ${_}`)]}return[]}function ry(l){const i=l.valueSpec,c=Me(l.value.type);let d,g,_,E={};const S=c!=="categorical"&&l.value.property===void 0,L=!S,B=ri(l.value.stops)==="array"&&ri(l.value.stops[0])==="array"&&ri(l.value.stops[0][0])==="object",N=to({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(Q){if(c==="identity")return[new Ye(Q.key,Q.value,'identity function may not have a "stops" property')];let ot=[];const dt=Q.value;return ot=ot.concat(nc({key:Q.key,value:dt,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:j})),ri(dt)==="array"&&dt.length===0&&ot.push(new Ye(Q.key,dt,"array must have at least one stop")),ot},default:function(Q){return Qi({key:Q.key,value:Q.value,valueSpec:i,style:Q.style,styleSpec:Q.styleSpec})}}});return c==="identity"&&S&&N.push(new Ye(l.key,l.value,'missing required property "property"')),c==="identity"||l.value.stops||N.push(new Ye(l.key,l.value,'missing required property "stops"')),c==="exponential"&&l.valueSpec.expression&&!Sp(l.valueSpec)&&N.push(new Ye(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(L&&!Ya(l.valueSpec)?N.push(new Ye(l.key,l.value,"property functions not supported")):S&&!$g(l.valueSpec)&&N.push(new Ye(l.key,l.value,"zoom functions not supported"))),c!=="categorical"&&!B||l.value.property!==void 0||N.push(new Ye(l.key,l.value,'"property" property is required')),N;function j(Q){let ot=[];const dt=Q.value,mt=Q.key;if(ri(dt)!=="array")return[new Ye(mt,dt,`array expected, ${ri(dt)} found`)];if(dt.length!==2)return[new Ye(mt,dt,`array length 2 expected, length ${dt.length} found`)];if(B){if(ri(dt[0])!=="object")return[new Ye(mt,dt,`object expected, ${ri(dt[0])} found`)];if(dt[0].zoom===void 0)return[new Ye(mt,dt,"object stop key must have zoom")];if(dt[0].value===void 0)return[new Ye(mt,dt,"object stop key must have value")];const Tt=Me(dt[0].zoom);if(typeof Tt!="number")return[new Ye(mt,dt[0].zoom,"stop zoom values must be numbers")];if(_&&_>Tt)return[new Ye(mt,dt[0].zoom,"stop zoom values must appear in ascending order")];Tt!==_&&(_=Tt,g=void 0,E={}),ot=ot.concat(to({key:`${mt}[0]`,value:dt[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:iy,value:Y}}))}else ot=ot.concat(Y({key:`${mt}[0]`,value:dt[0],valueSpec:{},style:Q.style,styleSpec:Q.styleSpec},dt));return Xa(Oe(dt[1]))?ot.concat([new Ye(`${mt}[1]`,dt[1],"expressions are not allowed in function stops.")]):ot.concat(Qi({key:`${mt}[1]`,value:dt[1],valueSpec:i,style:Q.style,styleSpec:Q.styleSpec}))}function Y(Q,ot){const dt=ri(Q.value),mt=Me(Q.value),Tt=Q.value!==null?Q.value:ot;if(d){if(dt!==d)return[new Ye(Q.key,Tt,`${dt} stop domain type must match previous stop domain type ${d}`)]}else d=dt;if(dt!=="number"&&dt!=="string"&&dt!=="boolean"&&typeof mt!="number"&&typeof mt!="string"&&typeof mt!="boolean")return[new Ye(Q.key,Tt,"stop domain value must be a number, string, or boolean")];if(dt!=="number"&&c!=="categorical"){let Ot=`number expected, ${dt} found`;return Ya(i)&&c===void 0&&(Ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(Q.key,Tt,Ot)]}return c!=="categorical"||dt!=="number"||typeof mt=="number"&&isFinite(mt)&&Math.floor(mt)===mt?c!=="categorical"&&dt==="number"&&typeof mt=="number"&&typeof g=="number"&&g!==void 0&&mt<g?[new Ye(Q.key,Tt,"stop domain values must appear in ascending order")]:(g=mt,c==="categorical"&&mt in E?[new Ye(Q.key,Tt,"stop domain values must be unique")]:(E[mt]=!0,[])):[new Ye(Q.key,Tt,`integer expected, found ${String(mt)}`)]}}function Ka(l){const i=(l.expressionContext==="property"?ny:ec)(Oe(l.value),l.valueSpec);if(i.result==="error")return i.value.map(d=>new Ye(`${l.key}${d.key}`,l.value,d.message));const c=i.value.expression||i.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!c.outputDefined())return[new Ye(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ql(c))return[new Ye(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return Jo(c,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!Yl(c,["zoom","feature-state"]))return[new Ye(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Ar(c))return[new Ye(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jo(l,i){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const g of i.valueSpec.expression.parameters)c.delete(g);if(c.size===0)return[];const d=[];return l instanceof Fr&&c.has(l.name)?[new Ye(i.key,i.value,`["${l.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(l.eachChild(g=>{d.push(...Jo(g,i))}),d)}function ic(l){const i=l.key,c=l.value,d=l.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(Me(c))===-1&&g.push(new Ye(i,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(Me(c))===-1&&g.push(new Ye(i,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function ws(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const i of l.slice(1))if(!ws(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function As(l,i="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ws(l)||(l=rc(l));const c=l;let d=!0;try{d=function(B){if(!Es(B))return B;let N=Oe(B);return oy(N),N=Ip(N),N}(c)}catch(B){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}const g=Dt[`filter_${i}`],_=ec(d,g);let E=null;if(_.result==="error")throw new Error(_.value.map(B=>`${B.key}: ${B.message}`).join(", "));E=(B,N,j)=>_.value.evaluate(B,N,{},j);let S=null,L=null;if(d!==c){const B=ec(c,g);if(B.result==="error")throw new Error(B.value.map(N=>`${N.key}: ${N.message}`).join(", "));S=(N,j,Y,Q,ot)=>B.value.evaluate(N,j,{},Y,void 0,void 0,Q,ot),L=!Ar(B.value.expression)}return E=E,{filter:E,dynamicFilter:S||void 0,needGeometry:oh(d),needFeature:!!L}}function Ip(l){if(!Array.isArray(l))return l;const i=function(c){if(sy.has(c[0])){for(let d=1;d<c.length;d++)if(Es(c[d]))return!0}return c}(l);return i===!0?i:i.map(c=>Ip(c))}function oy(l){let i=!1;const c=[];if(l[0]==="case"){for(let d=1;d<l.length-1;d+=2)i=i||Es(l[d]),c.push(l[d+1]);c.push(l[l.length-1])}else if(l[0]==="match"){i=i||Es(l[1]);for(let d=2;d<l.length-1;d+=2)c.push(l[d+1]);c.push(l[l.length-1])}else if(l[0]==="step"){i=i||Es(l[1]);for(let d=1;d<l.length-1;d+=2)c.push(l[d+1])}i&&(l.length=0,l.push("any",...c));for(let d=1;d<l.length;d++)oy(l[d])}function Es(l){if(!Array.isArray(l))return!1;if((i=l[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let c=1;c<l.length;c++)if(Es(l[c]))return!0;return!1}const sy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kp(l,i){return l<i?-1:l>i?1:0}function oh(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let i=1;i<l.length;i++)if(oh(l[i]))return!0;return!1}function rc(l){if(!l)return!0;const i=l[0];return l.length<=1?i!=="any":i==="=="?oc(l[1],l[2],"=="):i==="!="?sc(oc(l[1],l[2],"==")):i==="<"||i===">"||i==="<="||i===">="?oc(l[1],l[2],i):i==="any"?(c=l.slice(1),["any"].concat(c.map(rc))):i==="all"?["all"].concat(l.slice(1).map(rc)):i==="none"?["all"].concat(l.slice(1).map(rc).map(sc)):i==="in"?Bp(l[1],l.slice(2)):i==="!in"?sc(Bp(l[1],l.slice(2))):i==="has"?Fp(l[1]):i==="!has"?sc(Fp(l[1])):i!=="within"||l;var c}function oc(l,i,c){switch(l){case"$type":return[`filter-type-${c}`,i];case"$id":return[`filter-id-${c}`,i];default:return[`filter-${c}`,l,i]}}function Bp(l,i){if(i.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(c=>typeof c!=typeof i[0])?["filter-in-large",l,["literal",i.sort(kp)]]:["filter-in-small",l,["literal",i]]}}function Fp(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function sc(l){return["!",l]}function Ts(l){return ws(Oe(l.value))?Ka(Se({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):zp(l)}function zp(l){const i=l.value,c=l.key;if(ri(i)!=="array")return[new Ye(c,i,`array expected, ${ri(i)} found`)];const d=l.styleSpec;let g,_=[];if(i.length<1)return[new Ye(c,i,"filter array must have at least 1 element")];switch(_=_.concat(ic({key:`${c}[0]`,value:i[0],valueSpec:d.filter_operator,style:l.style,styleSpec:l.styleSpec})),Me(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Me(i[1])==="$type"&&_.push(new Ye(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&_.push(new Ye(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=ri(i[1]),g!=="string"&&_.push(new Ye(`${c}[1]`,i[1],`string expected, ${g} found`)));for(let E=2;E<i.length;E++)g=ri(i[E]),Me(i[1])==="$type"?_=_.concat(ic({key:`${c}[${E}]`,value:i[E],valueSpec:d.geometry_type,style:l.style,styleSpec:l.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&_.push(new Ye(`${c}[${E}]`,i[E],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let E=1;E<i.length;E++)_=_.concat(zp({key:`${c}[${E}]`,value:i[E],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":g=ri(i[1]),i.length!==2?_.push(new Ye(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&_.push(new Ye(`${c}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=ri(i[1]),i.length!==2?_.push(new Ye(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&_.push(new Ye(`${c}[1]`,i[1],`object expected, ${g} found`))}return _}function Np(l,i){const c=l.key,d=l.style,g=l.styleSpec,_=l.value,E=l.objectKey,S=g[`${i}_${l.layerType}`];if(!S)return[];const L=E.match(/^(.*)-transition$/);if(i==="paint"&&L&&S[L[1]]&&S[L[1]].transition)return Qi({key:c,value:_,valueSpec:g.transition,style:d,styleSpec:g});const B=l.valueSpec||S[E];if(!B)return[new Ye(c,_,`unknown property "${E}"`)];let N;if(ri(_)==="string"&&Ya(B)&&!B.tokens&&(N=/^{([^}]+)}$/.exec(_)))return[new Ye(c,_,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(N[1])} }\`.`)];const j=[];return l.layerType==="symbol"&&(E==="text-field"&&d&&!d.glyphs&&j.push(new Ye(c,_,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&oa(Oe(_))&&Me(_.type)==="identity"&&j.push(new Ye(c,_,'"text-font" does not support identity functions'))),j.concat(Qi({key:l.key,value:_,valueSpec:B,style:d,styleSpec:g,expressionContext:"property",propertyType:i,propertyKey:E}))}function sh(l){return Np(l,"paint")}function Up(l){return Np(l,"layout")}function ay(l){let i=[];const c=l.value,d=l.key,g=l.style,_=l.styleSpec;c.type||c.ref||i.push(new Ye(d,c,'either "type" or "ref" is required'));let E=Me(c.type);const S=Me(c.ref);if(c.id){const L=Me(c.id);for(let B=0;B<l.arrayIndex;B++){const N=g.layers[B];Me(N.id)===L&&i.push(new Ye(d,c.id,`duplicate layer id "${c.id}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let L;["type","source","source-layer","filter","layout"].forEach(B=>{B in c&&i.push(new Ye(d,c[B],`"${B}" is prohibited for ref layers`))}),g.layers.forEach(B=>{Me(B.id)===S&&(L=B)}),L?L.ref?i.push(new Ye(d,c.ref,"ref cannot reference another ref layer")):E=Me(L.type):typeof S=="string"&&i.push(new Ye(d,c.ref,`ref layer "${S}" not found`))}else if(E!=="background"&&E!=="sky")if(c.source){const L=g.sources&&g.sources[c.source],B=L&&Me(L.type);L?B==="vector"&&E==="raster"?i.push(new Ye(d,c.source,`layer "${c.id}" requires a raster source`)):B==="raster"&&E!=="raster"?i.push(new Ye(d,c.source,`layer "${c.id}" requires a vector source`)):B!=="vector"||c["source-layer"]?B==="raster-dem"&&E!=="hillshade"?i.push(new Ye(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="line"||!c.paint||!c.paint["line-gradient"]||B==="geojson"&&L.lineMetrics||i.push(new Ye(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Ye(d,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new Ye(d,c.source,`source "${c.source}" not found`))}else i.push(new Ye(d,c,'missing required property "source"'));return i=i.concat(to({key:d,value:c,valueSpec:_.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Qi({key:`${d}.type`,value:c.type,valueSpec:_.layer.type,style:l.style,styleSpec:l.styleSpec,object:c,objectKey:"type"}),filter:L=>Ts(Se({layerType:E},L)),layout:L=>to({layer:c,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":B=>Up(Se({layerType:E},B))}}),paint:L=>to({layer:c,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":B=>sh(Se({layerType:E},B))}})}})),i}function Qo(l){const i=l.value,c=l.key,d=ri(i);return d!=="string"?[new Ye(c,i,`string expected, ${d} found`)]:[]}const ly={promoteId:function({key:l,value:i}){if(ri(i)==="string")return Qo({key:l,value:i});{const c=[];for(const d in i)c.push(...Qo({key:`${l}.${d}`,value:i[d]}));return c}}};function cy(l){const i=l.value,c=l.key,d=l.styleSpec,g=l.style;if(!i.type)return[new Ye(c,i,'"type" is required')];const _=Me(i.type);let E;switch(_){case"vector":case"raster":case"raster-dem":return E=to({key:c,value:i,valueSpec:d[`source_${_.replace("-","_")}`],style:l.style,styleSpec:d,objectElementValidators:ly}),E;case"geojson":if(E=to({key:c,value:i,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:ly}),i.cluster)for(const S in i.clusterProperties){const[L,B]=i.clusterProperties[S],N=typeof L=="string"?[L,["accumulated"],["get",S]]:L;E.push(...Ka({key:`${c}.${S}.map`,value:B,expressionContext:"cluster-map"})),E.push(...Ka({key:`${c}.${S}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return E;case"video":return to({key:c,value:i,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return to({key:c,value:i,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new Ye(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ic({key:`${c}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function uy(l){const i=l.value,c=l.styleSpec,d=c.light,g=l.style;let _=[];const E=ri(i);if(i===void 0)return _;if(E!=="object")return _=_.concat([new Ye("light",i,`object expected, ${E} found`)]),_;for(const S in i){const L=S.match(/^(.*)-transition$/);_=_.concat(L&&d[L[1]]&&d[L[1]].transition?Qi({key:S,value:i[S],valueSpec:c.transition,style:g,styleSpec:c}):d[S]?Qi({key:S,value:i[S],valueSpec:d[S],style:g,styleSpec:c}):[new Ye(S,i[S],`unknown property "${S}"`)])}return _}function hy(l){const i=l.value,c=l.key,d=l.style,g=l.styleSpec,_=g.terrain;let E=[];const S=ri(i);if(i===void 0)return E;if(S!=="object")return E=E.concat([new Ye("terrain",i,`object expected, ${S} found`)]),E;for(const L in i){const B=L.match(/^(.*)-transition$/);E=E.concat(B&&_[B[1]]&&_[B[1]].transition?Qi({key:L,value:i[L],valueSpec:g.transition,style:d,styleSpec:g}):_[L]?Qi({key:L,value:i[L],valueSpec:_[L],style:d,styleSpec:g}):[new Ye(L,i[L],`unknown property "${L}"`)])}if(i.source){const L=d.sources&&d.sources[i.source],B=L&&Me(L.type);L?B!=="raster-dem"&&E.push(new Ye(c,i.source,`terrain cannot be used with a source of type ${String(B)}, it only be used with a "raster-dem" source type`)):E.push(new Ye(c,i.source,`source "${i.source}" not found`))}else E.push(new Ye(c,i,'terrain is missing required property "source"'));return E}function dy(l){const i=l.value,c=l.style,d=l.styleSpec,g=d.fog;let _=[];const E=ri(i);if(i===void 0)return _;if(E!=="object")return _=_.concat([new Ye("fog",i,`object expected, ${E} found`)]),_;for(const S in i){const L=S.match(/^(.*)-transition$/);_=_.concat(L&&g[L[1]]&&g[L[1]].transition?Qi({key:S,value:i[S],valueSpec:d.transition,style:c,styleSpec:d}):g[S]?Qi({key:S,value:i[S],valueSpec:g[S],style:c,styleSpec:d}):[new Ye(S,i[S],`unknown property "${S}"`)])}return _}const ac={"*":()=>[],array:nc,boolean:function(l){const i=l.value,c=l.key,d=ri(i);return d!=="boolean"?[new Ye(c,i,`boolean expected, ${d} found`)]:[]},number:iy,color:function(l){const i=l.key,c=l.value,d=ri(c);return d!=="string"?[new Ye(i,c,`color expected, ${d} found`)]:dp.parseCSSColor(c)===null?[new Ye(i,c,`color expected, "${c}" found`)]:[]},enum:ic,filter:Ts,function:ry,layer:ay,object:to,source:cy,light:uy,terrain:hy,fog:dy,string:Qo,formatted:function(l){return Qo(l).length===0?[]:Ka(l)},resolvedImage:function(l){return Qo(l).length===0?[]:Ka(l)},projection:function(l){const i=l.value,c=l.styleSpec,d=c.projection,g=l.style;let _=[];const E=ri(i);if(E==="object")for(const S in i)_=_.concat(Qi({key:S,value:i[S],valueSpec:d[S],style:g,styleSpec:c}));else E!=="string"&&(_=_.concat([new Ye("projection",i,`object or string expected, ${E} found`)]));return _}};function Qi(l){const i=l.value,c=l.valueSpec,d=l.styleSpec;return c.expression&&oa(Me(i))?ry(l):c.expression&&Xa(Oe(i))?Ka(l):c.type&&ac[c.type]?ac[c.type](l):to(Se({},l,{valueSpec:c.type?d[c.type]:c}))}function Nr(l){const i=l.value,c=l.key,d=Qo(l);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new Ye(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new Ye(c,i,'"glyphs" url must include a "{range}" token'))),d}function lc(l,i=Dt){return $o(Qi({key:"",value:l,valueSpec:i.$root,styleSpec:i,style:l,objectElementValidators:{glyphs:Nr,"*":()=>[]}}))}const O1=l=>$o(sh(l)),j1=l=>$o(Up(l));function $o(l){return l.slice().sort((i,c)=>i.line&&c.line?i.line-c.line:0)}function py(l,i){let c=!1;if(i&&i.length)for(const d of i)l.fire(new ht(new Error(d.message))),c=!0;return c}var Ps=Io;function Io(l,i,c){var d=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;var g=new Int32Array(this.arrayBuffer);l=g[0],this.d=(i=g[1])+2*(c=g[2]);for(var _=0;_<this.d*this.d;_++){var E=g[3+_],S=g[3+_+1];d.push(E===S?null:g.subarray(E,S))}var L=g[3+d.length+1];this.keys=g.subarray(g[3+d.length],L),this.bboxes=g.subarray(L),this.insert=this._insertReadonly}else{this.d=i+2*c;for(var B=0;B<this.d*this.d;B++)d.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=l,this.padding=c,this.scale=i/l,this.uid=0;var N=c/i*l;this.min=-N,this.max=l+N}Io.prototype.insert=function(l,i,c,d,g){this._forEachCell(i,c,d,g,this._insertCell,this.uid++),this.keys.push(l),this.bboxes.push(i),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g)},Io.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Io.prototype._insertCell=function(l,i,c,d,g,_){this.cells[g].push(_)},Io.prototype.query=function(l,i,c,d,g){var _=this.min,E=this.max;if(l<=_&&i<=_&&E<=c&&E<=d&&!g)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(l,i,c,d,this._queryCell,S,{},g),S},Io.prototype._queryCell=function(l,i,c,d,g,_,E,S){var L=this.cells[g];if(L!==null)for(var B=this.keys,N=this.bboxes,j=0;j<L.length;j++){var Y=L[j];if(E[Y]===void 0){var Q=4*Y;(S?S(N[Q+0],N[Q+1],N[Q+2],N[Q+3]):l<=N[Q+2]&&i<=N[Q+3]&&c>=N[Q+0]&&d>=N[Q+1])?(E[Y]=!0,_.push(B[Y])):E[Y]=!1}}},Io.prototype._forEachCell=function(l,i,c,d,g,_,E,S){for(var L=this._convertToCellCoord(l),B=this._convertToCellCoord(i),N=this._convertToCellCoord(c),j=this._convertToCellCoord(d),Y=L;Y<=N;Y++)for(var Q=B;Q<=j;Q++){var ot=this.d*Q+Y;if((!S||S(this._convertFromCellCoord(Y),this._convertFromCellCoord(Q),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(Q+1)))&&g.call(this,l,i,c,d,ot,_,E,S))return}},Io.prototype._convertFromCellCoord=function(l){return(l-this.padding)/this.scale},Io.prototype._convertToCellCoord=function(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))},Io.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var l=this.cells,i=3+this.cells.length+1+1,c=0,d=0;d<this.cells.length;d++)c+=this.cells[d].length;var g=new Int32Array(i+c+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var _=i,E=0;E<l.length;E++){var S=l[E];g[3+E]=_,g.set(S,_),_+=S.length}return g[3+l.length]=_,g.set(this.keys,_),g[3+l.length+1]=_+=this.keys.length,g.set(this.bboxes,_),_+=this.bboxes.length,g.buffer};const Za={};function Ke(l,i,c={}){Object.defineProperty(l,"_classRegistryKey",{value:i,writeable:!1}),Za[i]={klass:l,omit:c.omit||[]}}Ke(Object,"Object"),Ps.serialize=function(l,i){const c=l.toArrayBuffer();return i&&i.push(c),{buffer:c}},Ps.deserialize=function(l){return new Ps(l.buffer)},Object.defineProperty(Ps,"name",{value:"Grid"}),Ke(Ps,"Grid"),Ke(Qn,"Color"),Ke(Error,"Error"),Ke(et,"AJAXError"),Ke(Br,"ResolvedImage"),Ke(ih,"StylePropertyFunction"),Ke(nh,"StyleExpression",{omit:["_evaluator"]}),Ke(Lp,"ZoomDependentExpression"),Ke(Rp,"ZoomConstantExpression"),Ke(Fr,"CompoundExpression",{omit:["_evaluate"]});for(const l in ia)Za[ia[l]._classRegistryKey]||Ke(ia[l],`Expression${l}`);function fy(l){return l&&typeof ArrayBuffer!="undefined"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function ah(l){return T.ImageBitmap&&l instanceof T.ImageBitmap}function cc(l,i){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(fy(l)||ah(l))return i&&i.push(l),l;if(ArrayBuffer.isView(l)){const c=l;return i&&i.push(c.buffer),c}if(l instanceof T.ImageData)return i&&i.push(l.data.buffer),l;if(Array.isArray(l)){const c=[];for(const d of l)c.push(cc(d,i));return c}if(typeof l=="object"){const c=l.constructor,d=c._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const g=c.serialize?c.serialize(l,i):{};if(!c.serialize){for(const _ in l)l.hasOwnProperty(_)&&(Za[d].omit.indexOf(_)>=0||(g[_]=cc(l[_],i)));l instanceof Error&&(g.message=l.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof l)}function Ja(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||fy(l)||ah(l)||ArrayBuffer.isView(l)||l instanceof T.ImageData)return l;if(Array.isArray(l))return l.map(Ja);if(typeof l=="object"){const i=l.$name||"Object",{klass:c}=Za[i];if(!c)throw new Error(`can't deserialize unregistered class ${i}`);if(c.deserialize)return c.deserialize(l);const d=Object.create(c.prototype);for(const g of Object.keys(l))g!=="$name"&&(d[g]=Ja(l[g]));return d}throw new Error("can't deserialize object of type "+typeof l)}class Vp{constructor(){this.first=!0}update(i,c){const d=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=d,!0))}}const my=l=>l>=1536&&l<=1791,lh=l=>l>=1872&&l<=1919,uc=l=>l>=2208&&l<=2303,Gp=l=>l>=11904&&l<=12031,gy=l=>l>=12032&&l<=12255,Op=l=>l>=12272&&l<=12287,ch=l=>l>=12288&&l<=12351,hc=l=>l>=12352&&l<=12447,uh=l=>l>=12448&&l<=12543,yy=l=>l>=12544&&l<=12591,xy=l=>l>=12704&&l<=12735,vy=l=>l>=12736&&l<=12783,jp=l=>l>=12784&&l<=12799,_y=l=>l>=12800&&l<=13055,by=l=>l>=13056&&l<=13311,My=l=>l>=13312&&l<=19903,Hp=l=>l>=19968&&l<=40959,wy=l=>l>=40960&&l<=42127,Ay=l=>l>=42128&&l<=42191,Ey=l=>l>=44032&&l<=55215,dc=l=>l>=63744&&l<=64255,Wp=l=>l>=64336&&l<=65023,Ty=l=>l>=65040&&l<=65055,Qa=l=>l>=65072&&l<=65103,Py=l=>l>=65104&&l<=65135,hh=l=>l>=65136&&l<=65279,qp=l=>l>=65280&&l<=65519;function dh(l){for(const i of l)if(ph(i.charCodeAt(0)))return!0;return!1}function Sy(l){for(const i of l)if(!Cy(i.charCodeAt(0)))return!1;return!0}function Cy(l){return!(my(l)||lh(l)||uc(l)||Wp(l)||hh(l))}function ph(l){return!(l!==746&&l!==747&&(l<4352||!(xy(l)||yy(l)||Qa(l)&&!(l>=65097&&l<=65103)||dc(l)||by(l)||Gp(l)||vy(l)||!(!ch(l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||My(l)||Hp(l)||_y(l)||(i=>i>=12592&&i<=12687)(l)||(i=>i>=43360&&i<=43391)(l)||(i=>i>=55216&&i<=55295)(l)||(i=>i>=4352&&i<=4607)(l)||Ey(l)||hc(l)||Op(l)||(i=>i>=12688&&i<=12703)(l)||gy(l)||jp(l)||uh(l)&&l!==12540||!(!qp(l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Py(l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||(i=>i>=5120&&i<=5759)(l)||(i=>i>=6320&&i<=6399)(l)||Ty(l)||(i=>i>=19904&&i<=19967)(l)||wy(l)||Ay(l))))}function fh(l){return!(ph(l)||function(i){return!!((c=>c>=128&&c<=255)(i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||(c=>c>=8192&&c<=8303)(i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||(c=>c>=8448&&c<=8527)(i)||(c=>c>=8528&&c<=8591)(i)||(c=>c>=8960&&c<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||(c=>c>=9216&&c<=9279)(i)&&i!==9251||(c=>c>=9280&&c<=9311)(i)||(c=>c>=9312&&c<=9471)(i)||(c=>c>=9632&&c<=9727)(i)||(c=>c>=9728&&c<=9983)(i)&&!(i>=9754&&i<=9759)||(c=>c>=11008&&c<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||ch(i)||uh(i)||(c=>c>=57344&&c<=63743)(i)||Qa(i)||Py(i)||qp(i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(l))}function mh(l){return l>=1424&&l<=2303||Wp(l)||hh(l)}function H1(l,i){return!(!i&&mh(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||(c=>c>=6016&&c<=6143)(l))}function W1(l){for(const i of l)if(mh(i.charCodeAt(0)))return!0;return!1}const Yp="deferred",pc="loading",Xp="loaded";let Kp=null,Er="unavailable",Ur=null;const fc=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Er="error"),Kp&&Kp(l)};function sa(){Zp.fire(new rt("pluginStateChange",{pluginStatus:Er,pluginURL:Ur}))}const Zp=new Vt,gh=function(){return Er},$a=function(){if(Er!==Yp||!Ur)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Er=pc,sa(),Ur&&zt({url:Ur},l=>{l?fc(l):(Er=Xp,sa())})},eo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Er===Xp||eo.applyArabicShaping!=null,isLoading:()=>Er===pc,setState(l){Er=l.pluginStatus,Ur=l.pluginURL},isParsed:()=>eo.applyArabicShaping!=null&&eo.processBidirectionalText!=null&&eo.processStyledBidirectionalText!=null,getPluginURL:()=>Ur};class mi{constructor(i,c){this.zoom=i,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition,this.pitch=c.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vp,this.transition={},this.pitch=0)}isSupportedScript(i){return function(c,d){for(const g of c)if(!H1(g.charCodeAt(0),d))return!1;return!0}(i,eo.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,c=i-Math.floor(i),d=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class mc{constructor(i,c){this.property=i,this.value=c,this.expression=function(d,g){if(oa(d))return new ih(d,g);if(Xa(d)){const _=ny(d,g);if(_.result==="error")throw new Error(_.value.map(E=>`${E.key}: ${E.message}`).join(", "));return _.value}{let _=d;return typeof d=="string"&&g.type==="color"&&(_=Qn.parse(d)),{kind:"constant",evaluate:()=>_}}}(c===void 0?i.specification.default:c,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,c,d){return this.property.possiblyEvaluate(this,i,c,d)}}class tl{constructor(i){this.property=i,this.value=new mc(i,void 0)}transitioned(i,c){return new a(this.property,this.value,c,st({},i.transition,this.transition),i.now)}untransitioned(){return new a(this.property,this.value,null,{},0)}}class v{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Le(this._values[i].value.value)}setValue(i,c){this._values.hasOwnProperty(i)||(this._values[i]=new tl(this._values[i].property)),this._values[i].value=new mc(this._values[i].property,c===null?void 0:Le(c))}getTransition(i){return Le(this._values[i].transition)}setTransition(i,c){this._values.hasOwnProperty(i)||(this._values[i]=new tl(this._values[i].property)),this._values[i].transition=Le(c)||void 0}serialize(){const i={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(i[c]=d);const g=this.getTransition(c);g!==void 0&&(i[`${c}-transition`]=g)}return i}transitioned(i,c){const d=new f(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(i,c._values[g]);return d}untransitioned(){const i=new f(this._properties);for(const c of Object.keys(this._values))i._values[c]=this._values[c].untransitioned();return i}}class a{constructor(i,c,d,g,_){const E=g.delay||0,S=g.duration||0;_=_||0,this.property=i,this.value=c,this.begin=_+E,this.end=this.begin+S,i.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(i,c,d){const g=i.now||0,_=this.value.possiblyEvaluate(i,c,d),E=this.prior;if(E){if(g>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(g<this.begin)return E.possiblyEvaluate(i,c,d);{const S=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(i,c,d),_,U(S))}}return _}}class f{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,c,d){const g=new R(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(i,c,d);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class w{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Le(this._values[i].value)}setValue(i,c){this._values[i]=new mc(this._values[i].property,c===null?void 0:Le(c))}serialize(){const i={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(i[c]=d)}return i}possiblyEvaluate(i,c,d){const g=new R(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].possiblyEvaluate(i,c,d);return g}}class C{constructor(i,c,d){this.property=i,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,c,d,g){return this.property.evaluate(this.value,this.parameters,i,c,d,g)}}class R{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class I{constructor(i){this.specification=i}possiblyEvaluate(i,c){return i.expression.evaluate(c)}interpolate(i,c,d){const g=qu[this.specification.type];return g?g(i,c,d):i}}class F{constructor(i,c){this.specification=i,this.overrides=c}possiblyEvaluate(i,c,d,g){return new C(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(c,null,{},d,g)}:i.expression,c)}interpolate(i,c,d){if(i.value.kind!=="constant"||c.value.kind!=="constant")return i;if(i.value.value===void 0||c.value.value===void 0)return new C(this,{kind:"constant",value:void 0},i.parameters);const g=qu[this.specification.type];return g?new C(this,{kind:"constant",value:g(i.value.value,c.value.value,d)},i.parameters):i}evaluate(i,c,d,g,_,E){return i.kind==="constant"?i.value:i.evaluate(c,d,g,_,E)}}class q extends F{possiblyEvaluate(i,c,d,g){if(i.value===void 0)return new C(this,{kind:"constant",value:void 0},c);if(i.expression.kind==="constant"){const _=i.expression.evaluate(c,null,{},d,g),E=i.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,S=this._calculate(E,E,E,c);return new C(this,{kind:"constant",value:S},c)}if(i.expression.kind==="camera"){const _=this._calculate(i.expression.evaluate({zoom:c.zoom-1}),i.expression.evaluate({zoom:c.zoom}),i.expression.evaluate({zoom:c.zoom+1}),c);return new C(this,{kind:"constant",value:_},c)}return new C(this,i.expression,c)}evaluate(i,c,d,g,_,E){if(i.kind==="source"){const S=i.evaluate(c,d,g,_,E);return this._calculate(S,S,S,c)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(c.zoom)-1},d,g),i.evaluate({zoom:Math.floor(c.zoom)},d,g),i.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):i.value}_calculate(i,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c,other:d}:{from:d,to:c,other:i}}interpolate(i){return i}}class X{constructor(i){this.specification=i}possiblyEvaluate(i,c,d,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const _=i.expression.evaluate(c,null,{},d,g);return this._calculate(_,_,_,c)}return this._calculate(i.expression.evaluate(new mi(Math.floor(c.zoom-1),c)),i.expression.evaluate(new mi(Math.floor(c.zoom),c)),i.expression.evaluate(new mi(Math.floor(c.zoom+1),c)),c)}}_calculate(i,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:d,to:c}}interpolate(i){return i}}class J{constructor(i){this.specification=i}possiblyEvaluate(i,c,d,g){return!!i.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class it{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in i){const d=i[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new mc(d,void 0),_=this.defaultTransitionablePropertyValues[c]=new tl(d);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}function pt(l,i){return 256*(l=W(Math.floor(l),0,255))+W(Math.floor(i),0,255)}Ke(F,"DataDrivenProperty"),Ke(I,"DataConstantProperty"),Ke(q,"CrossFadedDataDrivenProperty"),Ke(X,"CrossFadedProperty"),Ke(J,"ColorRampProperty");const gt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ft{constructor(i,c){this._structArray=i,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ut{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,c){return i._trim(),c&&(i.isTransferred=!0,c.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const c=Object.create(this.prototype);return c.arrayBuffer=i.arrayBuffer,c.length=i.length,c.capacity=i.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ft(l,i=1){let c=0,d=0;return{members:l.map(g=>{const _=gt[g.type].BYTES_PER_ELEMENT,E=c=Et(c,Math.max(i,_)),S=g.components||1;return d=Math.max(d,_),c+=_*S,{name:g.name,type:g.type,components:S,offset:E}}),size:Et(c,Math.max(d,i)),alignment:i}}function Et(l,i){return Math.ceil(l/i)*i}class It extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.int16[g+0]=c,this.int16[g+1]=d,i}}It.prototype.bytesPerElement=4,Ke(It,"StructArrayLayout2i4");class Bt extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const _=3*i;return this.int16[_+0]=c,this.int16[_+1]=d,this.int16[_+2]=g,i}}Bt.prototype.bytesPerElement=6,Ke(Bt,"StructArrayLayout3i6");class Ut extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,c,d,g)}emplace(i,c,d,g,_){const E=4*i;return this.int16[E+0]=c,this.int16[E+1]=d,this.int16[E+2]=g,this.int16[E+3]=_,i}}Ut.prototype.bytesPerElement=8,Ke(Ut,"StructArrayLayout4i8");class Rt extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S){const L=this.length;return this.resize(L+1),this.emplace(L,i,c,d,g,_,E,S)}emplace(i,c,d,g,_,E,S,L){const B=6*i,N=12*i,j=3*i;return this.int16[B+0]=c,this.int16[B+1]=d,this.uint8[N+4]=g,this.uint8[N+5]=_,this.uint8[N+6]=E,this.uint8[N+7]=S,this.float32[j+2]=L,i}}Rt.prototype.bytesPerElement=12,Ke(Rt,"StructArrayLayout2i4ub1f12");class Ht extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,c,d,g)}emplace(i,c,d,g,_){const E=4*i;return this.float32[E+0]=c,this.float32[E+1]=d,this.float32[E+2]=g,this.float32[E+3]=_,i}}Ht.prototype.bytesPerElement=16,Ke(Ht,"StructArrayLayout4f16");class re extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S,L,B,N){const j=this.length;return this.resize(j+1),this.emplace(j,i,c,d,g,_,E,S,L,B,N)}emplace(i,c,d,g,_,E,S,L,B,N,j){const Y=10*i;return this.uint16[Y+0]=c,this.uint16[Y+1]=d,this.uint16[Y+2]=g,this.uint16[Y+3]=_,this.uint16[Y+4]=E,this.uint16[Y+5]=S,this.uint16[Y+6]=L,this.uint16[Y+7]=B,this.uint16[Y+8]=N,this.uint16[Y+9]=j,i}}re.prototype.bytesPerElement=20,Ke(re,"StructArrayLayout10ui20");class he extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S,L){const B=this.length;return this.resize(B+1),this.emplace(B,i,c,d,g,_,E,S,L)}emplace(i,c,d,g,_,E,S,L,B){const N=8*i;return this.uint16[N+0]=c,this.uint16[N+1]=d,this.uint16[N+2]=g,this.uint16[N+3]=_,this.uint16[N+4]=E,this.uint16[N+5]=S,this.uint16[N+6]=L,this.uint16[N+7]=B,i}}he.prototype.bytesPerElement=16,Ke(he,"StructArrayLayout8ui16");class xe extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E){const S=this.length;return this.resize(S+1),this.emplace(S,i,c,d,g,_,E)}emplace(i,c,d,g,_,E,S){const L=6*i;return this.int16[L+0]=c,this.int16[L+1]=d,this.int16[L+2]=g,this.int16[L+3]=_,this.int16[L+4]=E,this.int16[L+5]=S,i}}xe.prototype.bytesPerElement=12,Ke(xe,"StructArrayLayout6i12");class ge extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt)}emplace(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt){const Ot=16*i;return this.int16[Ot+0]=c,this.int16[Ot+1]=d,this.int16[Ot+2]=g,this.int16[Ot+3]=_,this.uint16[Ot+4]=E,this.uint16[Ot+5]=S,this.uint16[Ot+6]=L,this.uint16[Ot+7]=B,this.int16[Ot+8]=N,this.int16[Ot+9]=j,this.int16[Ot+10]=Y,this.int16[Ot+11]=Q,this.int16[Ot+12]=ot,this.int16[Ot+13]=dt,this.int16[Ot+14]=mt,this.int16[Ot+15]=Tt,i}}ge.prototype.bytesPerElement=32,Ke(ge,"StructArrayLayout4i4ui4i4i32");class ze extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const _=3*i;return this.float32[_+0]=c,this.float32[_+1]=d,this.float32[_+2]=g,i}}ze.prototype.bytesPerElement=12,Ke(ze,"StructArrayLayout3f12");class oe extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint32[1*i+0]=c,i}}oe.prototype.bytesPerElement=4,Ke(oe,"StructArrayLayout1ul4");class Ne extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S,L,B,N,j,Y,Q){const ot=this.length;return this.resize(ot+1),this.emplace(ot,i,c,d,g,_,E,S,L,B,N,j,Y,Q)}emplace(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot){const dt=20*i,mt=10*i;return this.int16[dt+0]=c,this.int16[dt+1]=d,this.int16[dt+2]=g,this.int16[dt+3]=_,this.int16[dt+4]=E,this.float32[mt+3]=S,this.float32[mt+4]=L,this.float32[mt+5]=B,this.float32[mt+6]=N,this.int16[dt+14]=j,this.uint32[mt+8]=Y,this.uint16[dt+18]=Q,this.uint16[dt+19]=ot,i}}Ne.prototype.bytesPerElement=40,Ke(Ne,"StructArrayLayout5i4f1i1ul2ui40");class Ie extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S){const L=this.length;return this.resize(L+1),this.emplace(L,i,c,d,g,_,E,S)}emplace(i,c,d,g,_,E,S,L){const B=8*i;return this.int16[B+0]=c,this.int16[B+1]=d,this.int16[B+2]=g,this.int16[B+4]=_,this.int16[B+5]=E,this.int16[B+6]=S,this.int16[B+7]=L,i}}Ie.prototype.bytesPerElement=16,Ke(Ie,"StructArrayLayout3i2i2i16");class en extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_){const E=this.length;return this.resize(E+1),this.emplace(E,i,c,d,g,_)}emplace(i,c,d,g,_,E){const S=4*i,L=8*i;return this.float32[S+0]=c,this.float32[S+1]=d,this.float32[S+2]=g,this.int16[L+6]=_,this.int16[L+7]=E,i}}en.prototype.bytesPerElement=16,Ke(en,"StructArrayLayout2f1f2i16");class ve extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,c,d,g)}emplace(i,c,d,g,_){const E=12*i,S=3*i;return this.uint8[E+0]=c,this.uint8[E+1]=d,this.float32[S+1]=g,this.float32[S+2]=_,i}}ve.prototype.bytesPerElement=12,Ke(ve,"StructArrayLayout2ub2f12");class Ze extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,d)}emplace(i,c,d,g){const _=3*i;return this.uint16[_+0]=c,this.uint16[_+1]=d,this.uint16[_+2]=g,i}}Ze.prototype.bytesPerElement=6,Ke(Ze,"StructArrayLayout3ui6");class _n extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt,Ot,Xt,Qt,$t){const te=this.length;return this.resize(te+1),this.emplace(te,i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt,Ot,Xt,Qt,$t)}emplace(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt,Ot,Xt,Qt,$t,te){const me=30*i,ye=15*i,Ae=60*i;return this.int16[me+0]=c,this.int16[me+1]=d,this.int16[me+2]=g,this.float32[ye+2]=_,this.float32[ye+3]=E,this.uint16[me+8]=S,this.uint16[me+9]=L,this.uint32[ye+5]=B,this.uint32[ye+6]=N,this.uint32[ye+7]=j,this.uint16[me+16]=Y,this.uint16[me+17]=Q,this.uint16[me+18]=ot,this.float32[ye+10]=dt,this.float32[ye+11]=mt,this.uint8[Ae+48]=Tt,this.uint8[Ae+49]=Ot,this.uint8[Ae+50]=Xt,this.uint32[ye+13]=Qt,this.int16[me+28]=$t,this.uint8[Ae+58]=te,i}}_n.prototype.bytesPerElement=60,Ke(_n,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Qe extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt,Ot,Xt,Qt,$t,te,me,ye,Ae,Ce,ue,_e,Re,Ve){const Be=this.length;return this.resize(Be+1),this.emplace(Be,i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt,Ot,Xt,Qt,$t,te,me,ye,Ae,Ce,ue,_e,Re,Ve)}emplace(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt,Tt,Ot,Xt,Qt,$t,te,me,ye,Ae,Ce,ue,_e,Re,Ve,Be){const Ue=38*i,Cn=19*i;return this.int16[Ue+0]=c,this.int16[Ue+1]=d,this.int16[Ue+2]=g,this.float32[Cn+2]=_,this.float32[Cn+3]=E,this.int16[Ue+8]=S,this.int16[Ue+9]=L,this.int16[Ue+10]=B,this.int16[Ue+11]=N,this.int16[Ue+12]=j,this.int16[Ue+13]=Y,this.uint16[Ue+14]=Q,this.uint16[Ue+15]=ot,this.uint16[Ue+16]=dt,this.uint16[Ue+17]=mt,this.uint16[Ue+18]=Tt,this.uint16[Ue+19]=Ot,this.uint16[Ue+20]=Xt,this.uint16[Ue+21]=Qt,this.uint16[Ue+22]=$t,this.uint16[Ue+23]=te,this.uint16[Ue+24]=me,this.uint16[Ue+25]=ye,this.uint16[Ue+26]=Ae,this.uint16[Ue+27]=Ce,this.uint16[Ue+28]=ue,this.uint32[Cn+15]=_e,this.float32[Cn+16]=Re,this.float32[Cn+17]=Ve,this.float32[Cn+18]=Be,i}}Qe.prototype.bytesPerElement=76,Ke(Qe,"StructArrayLayout3i2f6i15ui1ul3f76");class $e extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.float32[1*i+0]=c,i}}$e.prototype.bytesPerElement=4,Ke($e,"StructArrayLayout1f4");class An extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S){const L=this.length;return this.resize(L+1),this.emplace(L,i,c,d,g,_,E,S)}emplace(i,c,d,g,_,E,S,L){const B=7*i;return this.float32[B+0]=c,this.float32[B+1]=d,this.float32[B+2]=g,this.float32[B+3]=_,this.float32[B+4]=E,this.float32[B+5]=S,this.float32[B+6]=L,i}}An.prototype.bytesPerElement=28,Ke(An,"StructArrayLayout7f28");class Un extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_){const E=this.length;return this.resize(E+1),this.emplace(E,i,c,d,g,_)}emplace(i,c,d,g,_,E){const S=5*i;return this.float32[S+0]=c,this.float32[S+1]=d,this.float32[S+2]=g,this.float32[S+3]=_,this.float32[S+4]=E,i}}Un.prototype.bytesPerElement=20,Ke(Un,"StructArrayLayout5f20");class gn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,d,g){const _=this.length;return this.resize(_+1),this.emplace(_,i,c,d,g)}emplace(i,c,d,g,_){const E=6*i;return this.uint32[3*i+0]=c,this.uint16[E+2]=d,this.uint16[E+3]=g,this.uint16[E+4]=_,i}}gn.prototype.bytesPerElement=12,Ke(gn,"StructArrayLayout1ul3ui12");class Pn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.uint16[g+0]=c,this.uint16[g+1]=d,i}}Pn.prototype.bytesPerElement=4,Ke(Pn,"StructArrayLayout2ui4");class Zn extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint16[1*i+0]=c,i}}Zn.prototype.bytesPerElement=2,Ke(Zn,"StructArrayLayout1ui2");class Ei extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,c)}emplace(i,c,d){const g=2*i;return this.float32[g+0]=c,this.float32[g+1]=d,i}}Ei.prototype.bytesPerElement=8,Ke(Ei,"StructArrayLayout2f8");class cr extends ut{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,d,g,_,E,S){const L=this.length;return this.resize(L+1),this.emplace(L,i,c,d,g,_,E,S)}emplace(i,c,d,g,_,E,S,L){const B=8*i,N=4*i;return this.int16[B+0]=c,this.int16[B+1]=d,this.int16[B+2]=g,this.int16[B+3]=_,this.int16[B+4]=E,this.int16[B+5]=S,this.float32[N+3]=L,i}}cr.prototype.bytesPerElement=16,Ke(cr,"StructArrayLayout6i1f16");class ur extends ft{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ur.prototype.size=12;class Vr extends xe{get(i){return new ur(this,i)}}Ke(Vr,"FillExtrusionExtArray");class Ao extends ft{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ao.prototype.size=40;class ts extends Ne{get(i){return new Ao(this,i)}}Ke(ts,"CollisionBoxArray");class Ss extends ft{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Ss.prototype.size=60;class es extends _n{get(i){return new Ss(this,i)}}Ke(es,"PlacedSymbolArray");class Pi extends ft{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Pi.prototype.size=76;class Di extends Qe{get(i){return new Pi(this,i)}}Ke(Di,"SymbolInstanceArray");class ti extends $e{getoffsetX(i){return this.float32[1*i+0]}}Ke(ti,"GlyphOffsetArray");class zi extends Bt{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Ke(zi,"SymbolLineVertexArray");class Gr extends ft{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Gr.prototype.size=12;class Ti extends gn{get(i){return new Gr(this,i)}}Ke(Ti,"FeatureIndexArray");class no extends ft{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}no.prototype.size=4;class gc extends Pn{get(i){return new no(this,i)}}Ke(gc,"FillExtrusionCentroidArray");class Or extends ft{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}Or.prototype.size=16;class aa extends cr{get(i){return new Or(this,i)}}Ke(aa,"CircleGlobeExtArray");const Dy=Ft([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Jp=Ft([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var el=Uu(function(l){l.exports=function(i,c){var d,g,_,E,S,L,B,N;for(g=i.length-(d=3&i.length),_=c,S=3432918353,L=461845907,N=0;N<g;)B=255&i.charCodeAt(N)|(255&i.charCodeAt(++N))<<8|(255&i.charCodeAt(++N))<<16|(255&i.charCodeAt(++N))<<24,++N,_=27492+(65535&(E=5*(65535&(_=(_^=B=(65535&(B=(B=(65535&B)*S+(((B>>>16)*S&65535)<<16)&4294967295)<<15|B>>>17))*L+(((B>>>16)*L&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(E>>>16)&65535)<<16);switch(B=0,d){case 3:B^=(255&i.charCodeAt(N+2))<<16;case 2:B^=(255&i.charCodeAt(N+1))<<8;case 1:_^=B=(65535&(B=(B=(65535&(B^=255&i.charCodeAt(N)))*S+(((B>>>16)*S&65535)<<16)&4294967295)<<15|B>>>17))*L+(((B>>>16)*L&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}}),q1=Uu(function(l){l.exports=function(i,c){for(var d,g=i.length,_=c^g,E=0;g>=4;)d=1540483477*(65535&(d=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24))+((1540483477*(d>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++E;switch(g){case 3:_^=(255&i.charCodeAt(E+2))<<16;case 2:_^=(255&i.charCodeAt(E+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(E)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}}),Cs=el,Qp=q1;Cs.murmur3=el,Cs.murmur2=Qp;class Ry{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,c,d,g){this.ids.push(DA(i)),this.positions.push(c,d,g)}getPositions(i){const c=DA(i);let d=0,g=this.ids.length-1;for(;d<g;){const E=d+g>>1;this.ids[E]>=c?g=E:d=E+1}const _=[];for(;this.ids[d]===c;)_.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return _}static serialize(i,c){const d=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Y1(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(i){const c=new Ry;return c.ids=i.ids,c.positions=i.positions,c.indexed=!0,c}}function DA(l){const i=+l;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:Cs(String(l))}function Y1(l,i,c,d){for(;c<d;){const g=l[c+d>>1];let _=c-1,E=d+1;for(;;){do _++;while(l[_]<g);do E--;while(l[E]>g);if(_>=E)break;Ly(l,_,E),Ly(i,3*_,3*E),Ly(i,3*_+1,3*E+1),Ly(i,3*_+2,3*E+2)}E-c<d-E?(Y1(l,i,c,E),c=E+1):(Y1(l,i,E+1,d),d=E)}}function Ly(l,i,c){const d=l[i];l[i]=l[c],l[c]=d}Ke(Ry,"FeaturePositionMap");class la{constructor(i,c){this.gl=i.gl,this.location=c}}class Iy extends la{constructor(i,c){super(i,c),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class RA extends la{constructor(i,c){super(i,c),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class LA extends la{constructor(i,c){super(i,c),this.current=Qn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const JV=new Float32Array(16),QV=new Float32Array(9),$V=new Float32Array(4);function X1(l){return[pt(255*l.r,255*l.g),pt(255*l.b,255*l.a)]}class $p{constructor(i,c,d){this.value=i,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(i,c,d){i.set(d.constantOr(this.value))}getBinding(i,c,d){return this.type==="color"?new LA(i,c):new Iy(i,c)}}class yh{constructor(i,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,c){this.pixelRatioFrom=c.pixelRatio||1,this.pixelRatioTo=i.pixelRatio||1,this.patternFrom=c.tl.concat(c.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,c,d,g){const _=g==="u_pattern_to"||g==="u_dash_to"?this.patternTo:g==="u_pattern_from"||g==="u_dash_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&i.set(_)}getBinding(i,c,d){return d==="u_pattern_from"||d==="u_pattern_to"||d==="u_dash_from"||d==="u_dash_to"?new RA(i,c):new Iy(i,c)}}class ca{constructor(i,c,d,g){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(_=>({name:`a_${_}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,c,d,g,_,E){const S=this.paintVertexArray.length,L=this.expression.evaluate(new mi(0),c,{},_,g,E);this.paintVertexArray.resize(i),this._setPaintValue(S,i,L)}updatePaintArray(i,c,d,g,_){const E=this.expression.evaluate({zoom:0},d,g,void 0,_);this._setPaintValue(i,c,E)}_setPaintValue(i,c,d){if(this.type==="color"){const g=X1(d);for(let _=i;_<c;_++)this.paintVertexArray.emplace(_,g[0],g[1])}else{for(let g=i;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ns{constructor(i,c,d,g,_,E){this.expression=i,this.uniformNames=c.map(S=>`u_${S}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=c.map(S=>({name:`a_${S}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(i,c,d,g,_,E){const S=this.expression.evaluate(new mi(this.zoom),c,{},_,g,E),L=this.expression.evaluate(new mi(this.zoom+1),c,{},_,g,E),B=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(B,i,S,L)}updatePaintArray(i,c,d,g,_){const E=this.expression.evaluate({zoom:this.zoom},d,g,void 0,_),S=this.expression.evaluate({zoom:this.zoom+1},d,g,void 0,_);this._setPaintValue(i,c,E,S)}_setPaintValue(i,c,d,g){if(this.type==="color"){const _=X1(d),E=X1(g);for(let S=i;S<c;S++)this.paintVertexArray.emplace(S,_[0],_[1],E[0],E[1])}else{for(let _=i;_<c;_++)this.paintVertexArray.emplace(_,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=W(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,c,d){return new Iy(i,c)}}class nl{constructor(i,c,d,g,_,E,S){this.expression=i,this.type=d,this.useIntegerZoom=g,this.zoom=_,this.layerId=S,this.paintVertexAttributes=(d==="array"?Jp:Dy).members;for(let L=0;L<c.length;++L);this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E}populatePaintArray(i,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(i,c,d,g,_,E){this._setPaintValues(i,c,d.patterns&&d.patterns[this.layerId],E)}_setPaintValues(i,c,d,g){if(!g||!d)return;const{min:_,mid:E,max:S}=d,L=g[_],B=g[E],N=g[S];if(L&&B&&N)for(let j=i;j<c;j++)this._setPaintValue(this.zoomInPaintVertexArray,j,B,L),this._setPaintValue(this.zoomOutPaintVertexArray,j,B,N)}_setPaintValue(i,c,d,g){i.emplace(c,d.tl[0],d.tl[1],d.br[0],d.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],d.pixelRatio,g.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class il{constructor(i,c,d=()=>!0){this.binders={},this._buffers=[];const g=[];for(const _ in i.paint._values){if(!d(_))continue;const E=i.paint.get(_);if(!(E instanceof C&&Ya(E.property.specification)))continue;const S=e8(_,i.type),L=E.value,B=E.property.specification.type,N=E.property.useIntegerZoom,j=E.property.specification["property-type"],Y=j==="cross-faded"||j==="cross-faded-data-driven",Q=String(_)==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant";if(L.kind!=="constant"||Q)if(L.kind==="source"||Q||Y){const ot=IA(_,B,"source");this.binders[_]=Y?new nl(L,S,B,N,c,ot,i.id):new ca(L,S,B,ot),g.push(`/a_${_}`)}else{const ot=IA(_,B,"composite");this.binders[_]=new ns(L,S,B,N,c,ot),g.push(`/z_${_}`)}else this.binders[_]=Y?new yh(L.value,S):new $p(L.value,S,B),g.push(`/u_${_}`)}this.cacheKey=g.sort().join("")}getMaxValue(i){const c=this.binders[i];return c instanceof ca||c instanceof ns?c.maxValue:0}populatePaintArrays(i,c,d,g,_,E){for(const S in this.binders){const L=this.binders[S];(L instanceof ca||L instanceof ns||L instanceof nl)&&L.populatePaintArray(i,c,d,g,_,E)}}setConstantPatternPositions(i,c){for(const d in this.binders){const g=this.binders[d];g instanceof yh&&g.setConstantPatternPositions(i,c)}}updatePaintArrays(i,c,d,g,_,E){let S=!1;for(const L in i){const B=c.getPositions(L);for(const N of B){const j=d.feature(N.index);for(const Y in this.binders){const Q=this.binders[Y];if((Q instanceof ca||Q instanceof ns||Q instanceof nl)&&Q.expression.isStateDependent===!0){const ot=g.paint.get(Y);Q.expression=ot.value,Q.updatePaintArray(N.start,N.end,j,i[L],_,E),S=!0}}}}return S}defines(){const i=[];for(const c in this.binders){const d=this.binders[c];(d instanceof $p||d instanceof yh)&&i.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof ca||d instanceof ns||d instanceof nl)for(let g=0;g<d.paintVertexAttributes.length;g++)i.push(d.paintVertexAttributes[g].name)}return i}getBinderUniforms(){const i=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof $p||d instanceof yh||d instanceof ns)for(const g of d.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,c){const d=[];for(const g in this.binders){const _=this.binders[g];if(_ instanceof $p||_ instanceof yh||_ instanceof ns){for(const E of _.uniformNames)if(c[E]){const S=_.getBinding(i,c[E],E);d.push({name:E,property:g,binding:S})}}}return d}setUniforms(i,c,d,g){for(const{name:_,property:E,binding:S}of c)this.binders[E].setUniform(S,g,d.get(E),_)}updatePaintBuffers(i){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(i&&d instanceof nl){const g=i.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof ca||d instanceof ns)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(i){for(const c in this.binders){const d=this.binders[c];(d instanceof ca||d instanceof ns||d instanceof nl)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const c=this.binders[i];(c instanceof ca||c instanceof ns||c instanceof nl)&&c.destroy()}}}class yc{constructor(i,c,d=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new il(g,c,d);this.needsUpload=!1,this._featureMap=new Ry,this._bufferOffset=0}populatePaintArrays(i,c,d,g,_,E,S){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(i,c,g,_,E,S);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,c,d,g,_){for(const E of d)this.needsUpload=this.programConfigurations[E.id].updatePaintArrays(i,this._featureMap,c,E,g,_)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const t8={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function e8(l,i){return t8[l]||[l.replace(`${i}-`,"").replace(/-/g,"_")]}const n8={"line-pattern":{source:re,composite:re},"fill-pattern":{source:re,composite:re},"fill-extrusion-pattern":{source:re,composite:re},"line-dasharray":{source:he,composite:he}},i8={color:{source:Ei,composite:Ht},number:{source:$e,composite:Ei}};function IA(l,i,c){const d=n8[l];return d&&d[c]||i8[i][c]}Ke($p,"ConstantBinder"),Ke(yh,"CrossFadedConstantBinder"),Ke(ca,"SourceExpressionBinder"),Ke(nl,"CrossFadedCompositeBinder"),Ke(ns,"CompositeExpressionBinder"),Ke(il,"ProgramConfiguration",{omit:["_buffers"]}),Ke(yc,"ProgramConfigurationSet");const ky="-transition";class is extends Vt{constructor(i,c){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,i.type!=="custom"&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&i.type!=="sky"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),c.layout&&(this._unevaluatedLayout=new w(c.layout)),c.paint)){this._transitionablePaint=new v(c.paint);for(const d in i.paint)this.setPaintProperty(d,i.paint[d],{validate:!1});for(const d in i.layout)this.setLayoutProperty(d,i.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new R(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,c,d={}){c!=null&&this._validate(j1,`layers.${this.id}.layout.${i}`,i,c,d)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,c):this.visibility=c)}getPaintProperty(i){return le(i,ky)?this._transitionablePaint.getTransition(i.slice(0,-ky.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,c,d={}){if(c!=null&&this._validate(O1,`layers.${this.id}.paint.${i}`,i,c,d))return!1;if(le(i,ky))return this._transitionablePaint.setTransition(i.slice(0,-ky.length),c||void 0),!1;{const g=this._transitionablePaint._values[i],_=g.property.specification["property-type"]==="cross-faded-data-driven",E=g.value.isDataDriven(),S=g.value;this._transitionablePaint.setValue(i,c),this._handleSpecialPaintPropertyUpdate(i);const L=this._transitionablePaint._values[i].value;return L.isDataDriven()||E||_||this._handleOverridablePaintPropertyUpdate(i,S,L)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,c,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,c){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,c)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),de(i,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(i,c,d,g,_={}){return(!_||_.validate!==!1)&&py(this,i.call(lc,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:Dt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const c=this.paint.get(i);if(c instanceof C&&Ya(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=As(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const r8=Ft([{name:"a_pos",components:2,type:"Int16"}],4),o8=Ft([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Ri{constructor(i=[]){this.segments=i}prepareSegment(i,c,d,g){let _=this.segments[this.segments.length-1];return i>Ri.MAX_VERTEX_ARRAY_LENGTH&&bt(`Max vertices per segment is ${Ri.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!_||_.vertexLength+i>Ri.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==g)&&(_={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(_.sortKey=g),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const i of this.segments)for(const c in i.vaos)i.vaos[c].destroy()}static simpleSegment(i,c,d,g){return new Ri([{vertexOffset:i,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}Ri.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke(Ri,"SegmentVector");var Fn=8192;class rl{constructor(i,c){i&&(c?this.setSouthWest(i).setNorthEast(c):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof si?new si(i.lng,i.lat):si.convert(i),this}setSouthWest(i){return this._sw=i instanceof si?new si(i.lng,i.lat):si.convert(i),this}extend(i){const c=this._sw,d=this._ne;let g,_;if(i instanceof si)g=i,_=i;else{if(!(i instanceof rl))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(rl.convert(i)):this.extend(si.convert(i)):this;if(g=i._sw,_=i._ne,!g||!_)return this}return c||d?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),d.lng=Math.max(_.lng,d.lng),d.lat=Math.max(_.lat,d.lat)):(this._sw=new si(g.lng,g.lat),this._ne=new si(_.lng,_.lat)),this}getCenter(){return new si((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new si(this.getWest(),this.getNorth())}getSouthEast(){return new si(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:c,lat:d}=si.convert(i);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(i){return!i||i instanceof rl?i:new rl(i)}}const K1=63710088e-1;class si{constructor(i,c){if(isNaN(i)||isNaN(c))throw new Error(`Invalid LngLat object: (${i}, ${c})`);if(this.lng=+i,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new si(Z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const c=Math.PI/180,d=this.lat*c,g=i.lat*c,_=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((i.lng-this.lng)*c);return K1*Math.acos(Math.min(_,1))}toBounds(i=0){const c=360*i/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new rl(new si(this.lng-d,this.lat-c),new si(this.lng+d,this.lat+c))}static convert(i){if(i instanceof si)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new si(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new si(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const kA=2*Math.PI*K1;function Z1(l){return kA*Math.cos(l*Math.PI/180)}function tf(l){return(180+l)/360}function xh(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function vh(l,i){return l/Z1(i)}function ko(l){return 360*l-180}function hr(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function BA(l,i){return l*Z1(hr(i))}const Ds=85.051129;class By{constructor(i,c,d=0){this.x=+i,this.y=+c,this.z=+d}static fromLngLat(i,c=0){const d=si.convert(i);return new By(tf(d.lng),xh(d.lat),vh(c,d.lat))}toLngLat(){return new si(ko(this.x),hr(this.y))}toAltitude(){return BA(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/kA*(i=hr(this.y),1/Math.cos(i*Math.PI/180));var i}}function J1(l,i,c,d,g,_,E,S,L){const B=(i+d)/2,N=(c+g)/2,j=new M(B,N);S(j),function(Y,Q,ot,dt,mt,Tt){const Ot=ot-mt,Xt=dt-Tt;return Math.abs((dt-Q)*Ot-(ot-Y)*Xt)/Math.hypot(Ot,Xt)}(j.x,j.y,_.x,_.y,E.x,E.y)>=L?(J1(l,i,c,B,N,_,j,S,L),J1(l,B,N,d,g,j,E,S,L)):l.push(E)}function s8(l,i,c){let d=l[0],g=d.x,_=d.y;i(d);const E=[d];for(let S=1;S<l.length;S++){const L=l[S],{x:B,y:N}=L;i(L),J1(E,g,_,B,N,d,L,i,c),g=B,_=N,d=L}return E}const Q1=Math.pow(2,14)-1,FA=-Q1-1;function a8(l,i){const c=Math.round(l.x*i),d=Math.round(l.y*i);return l.x=W(c,FA,Q1),l.y=W(d,FA,Q1),(c<l.x||c>l.x+1||d<l.y||d>l.y+1)&&bt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function ua(l,i,c){const d=l.loadGeometry(),g=l.extent,_=Fn/g;if(i&&c&&c.projection.isReprojectedInTileSpace){const E=1<<i.z,{scale:S,x:L,y:B,projection:N}=c,j=Y=>{const Q=ko((i.x+Y.x/g)/E),ot=hr((i.y+Y.y/g)/E),dt=N.project(Q,ot);Y.x=(dt.x*S-L)*g,Y.y=(dt.y*S-B)*g};for(let Y=0;Y<d.length;Y++)if(l.type!==1)d[Y]=s8(d[Y],j,1);else{const Q=[];for(const ot of d[Y])ot.x<0||ot.x>=g||ot.y<0||ot.y>=g||(j(ot),Q.push(ot));d[Y]=Q}}for(const E of d)for(const S of E)a8(S,_);return d}function xc(l,i){return{type:l.type,id:l.id,properties:l.properties,geometry:i?ua(l):[]}}function Fy(l,i,c,d,g){l.emplaceBack(2*i+(d+1)/2,2*c+(g+1)/2)}function zy(l,i,c,d){l.emplaceBack(i.x,i.y,i.z,c[0]*16384,c[1]*16384,c[2]*16384,d)}class $1{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new It,this.indexArray=new Ze,this.segments=new Ri,this.programConfigurations=new yc(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d,g){const _=this.layers[0],E=[];let S=null;_.type==="circle"&&(S=_.layout.get("circle-sort-key"));for(const{feature:B,id:N,index:j,sourceLayerIndex:Y}of i){const Q=this.layers[0]._featureFilter.needGeometry,ot=xc(B,Q);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),ot,d))continue;const dt=S?S.evaluate(ot,{},d):void 0,mt={id:N,properties:B.properties,type:B.type,sourceLayerIndex:Y,index:j,geometry:Q?ot.geometry:ua(B,d,g),patterns:{},sortKey:dt};E.push(mt)}S&&E.sort((B,N)=>B.sortKey-N.sortKey);let L=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new aa,L=g.projection);for(const B of E){const{geometry:N,index:j,sourceLayerIndex:Y}=B,Q=i[j].feature;this.addFeature(B,N,j,c.availableImages,d,L),c.featureIndex.insert(Q,N,j,Y,this.index)}}update(i,c,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,r8.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,o8.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,c,d,g,_,E){for(const S of c)for(const L of S){const B=L.x,N=L.y;if(B<0||B>=Fn||N<0||N>=Fn)continue;if(E){const Q=E.projectTilePoint(B,N,_),ot=E.upVector(_,B,N),dt=hr((N/Fn+_.y)/(1<<_.z)),mt=E.pixelsPerMeter(dt,1)/vh(1,dt),Tt=this.globeExtVertexArray;zy(Tt,Q,ot,mt),zy(Tt,Q,ot,mt),zy(Tt,Q,ot,mt),zy(Tt,Q,ot,mt)}const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),Y=j.vertexLength;Fy(this.layoutVertexArray,B,N,-1,-1),Fy(this.layoutVertexArray,B,N,1,-1),Fy(this.layoutVertexArray,B,N,1,1),Fy(this.layoutVertexArray,B,N,-1,1),this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+3,Y+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},g,_)}}function zA(l,i){for(let c=0;c<l.length;c++)if(_h(i,l[c]))return!0;for(let c=0;c<i.length;c++)if(_h(l,i[c]))return!0;return!!tv(l,i)}function l8(l,i,c){return!!_h(l,i)||!!ev(i,l,c)}function NA(l,i){if(l.length===1)return VA(i,l[0]);for(let c=0;c<i.length;c++){const d=i[c];for(let g=0;g<d.length;g++)if(_h(l,d[g]))return!0}for(let c=0;c<l.length;c++)if(VA(i,l[c]))return!0;for(let c=0;c<i.length;c++)if(tv(l,i[c]))return!0;return!1}function c8(l,i,c){if(l.length>1){if(tv(l,i))return!0;for(let d=0;d<i.length;d++)if(ev(i[d],l,c))return!0}for(let d=0;d<l.length;d++)if(ev(l[d],i,c))return!0;return!1}function tv(l,i){if(l.length===0||i.length===0)return!1;for(let c=0;c<l.length-1;c++){const d=l[c],g=l[c+1];for(let _=0;_<i.length-1;_++)if(u8(d,g,i[_],i[_+1]))return!0}return!1}function u8(l,i,c,d){return qt(l,c,d)!==qt(i,c,d)&&qt(l,i,c)!==qt(l,i,d)}function ev(l,i,c){const d=c*c;if(i.length===1)return l.distSqr(i[0])<d;for(let g=1;g<i.length;g++)if(UA(l,i[g-1],i[g])<d)return!0;return!1}function UA(l,i,c){const d=i.distSqr(c);if(d===0)return l.distSqr(i);const g=((l.x-i.x)*(c.x-i.x)+(l.y-i.y)*(c.y-i.y))/d;return l.distSqr(g<0?i:g>1?c:c.sub(i)._mult(g)._add(i))}function VA(l,i){let c,d,g,_=!1;for(let E=0;E<l.length;E++){c=l[E];for(let S=0,L=c.length-1;S<c.length;L=S++)d=c[S],g=c[L],d.y>i.y!=g.y>i.y&&i.x<(g.x-d.x)*(i.y-d.y)/(g.y-d.y)+d.x&&(_=!_)}return _}function _h(l,i){let c=!1;for(let d=0,g=l.length-1;d<l.length;g=d++){const _=l[d],E=l[g];_.y>i.y!=E.y>i.y&&i.x<(E.x-_.x)*(i.y-_.y)/(E.y-_.y)+_.x&&(c=!c)}return c}function GA(l,i,c,d,g){for(const E of l)if(i<=E.x&&c<=E.y&&d>=E.x&&g>=E.y)return!0;const _=[new M(i,c),new M(i,g),new M(d,g),new M(d,c)];if(l.length>2){for(const E of _)if(_h(l,E))return!0}for(let E=0;E<l.length-1;E++)if(h8(l[E],l[E+1],_))return!0;return!1}function h8(l,i,c){const d=c[0],g=c[2];if(l.x<d.x&&i.x<d.x||l.x>g.x&&i.x>g.x||l.y<d.y&&i.y<d.y||l.y>g.y&&i.y>g.y)return!1;const _=qt(l,i,c[0]);return _!==qt(l,i,c[1])||_!==qt(l,i,c[2])||_!==qt(l,i,c[3])}function bh(l,i,c){const d=i.paint.get(l).value;return d.kind==="constant"?d.value:c.programConfigurations.get(i.id).getMaxValue(l)}function Ny(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function OA(l,i,c,d,g){if(!i[0]&&!i[1])return l;const _=M.convert(i)._mult(g);c==="viewport"&&_._rotate(-d);const E=[];for(let S=0;S<l.length;S++)E.push(l[S].sub(_));return E}function jA(l,i,c,d){const g=M.convert(l)._mult(d);return i==="viewport"&&g._rotate(-c),g}Ke($1,"CircleBucket",{omit:["layers"]});const d8=new it({"circle-sort-key":new F(Dt.layout_circle["circle-sort-key"])});var p8={paint:new it({"circle-radius":new F(Dt.paint_circle["circle-radius"]),"circle-color":new F(Dt.paint_circle["circle-color"]),"circle-blur":new F(Dt.paint_circle["circle-blur"]),"circle-opacity":new F(Dt.paint_circle["circle-opacity"]),"circle-translate":new I(Dt.paint_circle["circle-translate"]),"circle-translate-anchor":new I(Dt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new I(Dt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new I(Dt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new F(Dt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new F(Dt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new F(Dt.paint_circle["circle-stroke-opacity"])}),layout:d8},nv=1e-6,io=typeof Float32Array!="undefined"?Float32Array:Array;function HA(){var l=new io(9);return io!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function Rs(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function iv(l,i,c){var d=i[0],g=i[1],_=i[2],E=i[3],S=i[4],L=i[5],B=i[6],N=i[7],j=i[8],Y=i[9],Q=i[10],ot=i[11],dt=i[12],mt=i[13],Tt=i[14],Ot=i[15],Xt=c[0],Qt=c[1],$t=c[2],te=c[3];return l[0]=Xt*d+Qt*S+$t*j+te*dt,l[1]=Xt*g+Qt*L+$t*Y+te*mt,l[2]=Xt*_+Qt*B+$t*Q+te*Tt,l[3]=Xt*E+Qt*N+$t*ot+te*Ot,l[4]=(Xt=c[4])*d+(Qt=c[5])*S+($t=c[6])*j+(te=c[7])*dt,l[5]=Xt*g+Qt*L+$t*Y+te*mt,l[6]=Xt*_+Qt*B+$t*Q+te*Tt,l[7]=Xt*E+Qt*N+$t*ot+te*Ot,l[8]=(Xt=c[8])*d+(Qt=c[9])*S+($t=c[10])*j+(te=c[11])*dt,l[9]=Xt*g+Qt*L+$t*Y+te*mt,l[10]=Xt*_+Qt*B+$t*Q+te*Tt,l[11]=Xt*E+Qt*N+$t*ot+te*Ot,l[12]=(Xt=c[12])*d+(Qt=c[13])*S+($t=c[14])*j+(te=c[15])*dt,l[13]=Xt*g+Qt*L+$t*Y+te*mt,l[14]=Xt*_+Qt*B+$t*Q+te*Tt,l[15]=Xt*E+Qt*N+$t*ot+te*Ot,l}function vc(l,i,c){var d,g,_,E,S,L,B,N,j,Y,Q,ot,dt=c[0],mt=c[1],Tt=c[2];return i===l?(l[12]=i[0]*dt+i[4]*mt+i[8]*Tt+i[12],l[13]=i[1]*dt+i[5]*mt+i[9]*Tt+i[13],l[14]=i[2]*dt+i[6]*mt+i[10]*Tt+i[14],l[15]=i[3]*dt+i[7]*mt+i[11]*Tt+i[15]):(g=i[1],_=i[2],E=i[3],S=i[4],L=i[5],B=i[6],N=i[7],j=i[8],Y=i[9],Q=i[10],ot=i[11],l[0]=d=i[0],l[1]=g,l[2]=_,l[3]=E,l[4]=S,l[5]=L,l[6]=B,l[7]=N,l[8]=j,l[9]=Y,l[10]=Q,l[11]=ot,l[12]=d*dt+S*mt+j*Tt+i[12],l[13]=g*dt+L*mt+Y*Tt+i[13],l[14]=_*dt+B*mt+Q*Tt+i[14],l[15]=E*dt+N*mt+ot*Tt+i[15]),l}function ol(l,i,c){var d=c[0],g=c[1],_=c[2];return l[0]=i[0]*d,l[1]=i[1]*d,l[2]=i[2]*d,l[3]=i[3]*d,l[4]=i[4]*g,l[5]=i[5]*g,l[6]=i[6]*g,l[7]=i[7]*g,l[8]=i[8]*_,l[9]=i[9]*_,l[10]=i[10]*_,l[11]=i[11]*_,l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15],l}function rv(l,i,c){var d=Math.sin(c),g=Math.cos(c),_=i[4],E=i[5],S=i[6],L=i[7],B=i[8],N=i[9],j=i[10],Y=i[11];return i!==l&&(l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[3],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[4]=_*g+B*d,l[5]=E*g+N*d,l[6]=S*g+j*d,l[7]=L*g+Y*d,l[8]=B*g-_*d,l[9]=N*g-E*d,l[10]=j*g-S*d,l[11]=Y*g-L*d,l}function ov(l,i,c){var d=Math.sin(c),g=Math.cos(c),_=i[0],E=i[1],S=i[2],L=i[3],B=i[8],N=i[9],j=i[10],Y=i[11];return i!==l&&(l[4]=i[4],l[5]=i[5],l[6]=i[6],l[7]=i[7],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=_*g-B*d,l[1]=E*g-N*d,l[2]=S*g-j*d,l[3]=L*g-Y*d,l[8]=_*d+B*g,l[9]=E*d+N*g,l[10]=S*d+j*g,l[11]=L*d+Y*g,l}Math.hypot||(Math.hypot=function(){for(var l=0,i=arguments.length;i--;)l+=arguments[i]*arguments[i];return Math.sqrt(l)});var f8=iv;function sv(){var l=new io(3);return io!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function WA(l){var i=new io(3);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i}function qA(l){return Math.hypot(l[0],l[1],l[2])}function ef(l,i,c){var d=new io(3);return d[0]=l,d[1]=i,d[2]=c,d}function YA(l,i,c){return l[0]=i[0]+c[0],l[1]=i[1]+c[1],l[2]=i[2]+c[2],l}function XA(l,i,c){return l[0]=i[0]-c[0],l[1]=i[1]-c[1],l[2]=i[2]-c[2],l}function KA(l,i,c){return l[0]=i[0]*c[0],l[1]=i[1]*c[1],l[2]=i[2]*c[2],l}function av(l,i,c){return l[0]=Math.min(i[0],c[0]),l[1]=Math.min(i[1],c[1]),l[2]=Math.min(i[2],c[2]),l}function lv(l,i,c){return l[0]=Math.max(i[0],c[0]),l[1]=Math.max(i[1],c[1]),l[2]=Math.max(i[2],c[2]),l}function nf(l,i,c){return l[0]=i[0]*c,l[1]=i[1]*c,l[2]=i[2]*c,l}function cv(l,i,c,d){return l[0]=i[0]+c[0]*d,l[1]=i[1]+c[1]*d,l[2]=i[2]+c[2]*d,l}function rf(l,i){var c=i[0],d=i[1],g=i[2],_=c*c+d*d+g*g;return _>0&&(_=1/Math.sqrt(_)),l[0]=i[0]*_,l[1]=i[1]*_,l[2]=i[2]*_,l}function of(l,i){return l[0]*i[0]+l[1]*i[1]+l[2]*i[2]}function ZA(l,i,c){var d=i[0],g=i[1],_=i[2],E=c[0],S=c[1],L=c[2];return l[0]=g*L-_*S,l[1]=_*E-d*L,l[2]=d*S-g*E,l}function _c(l,i,c){var d=i[0],g=i[1],_=i[2],E=c[3]*d+c[7]*g+c[11]*_+c[15];return l[0]=(c[0]*d+c[4]*g+c[8]*_+c[12])/(E=E||1),l[1]=(c[1]*d+c[5]*g+c[9]*_+c[13])/E,l[2]=(c[2]*d+c[6]*g+c[10]*_+c[14])/E,l}function JA(l,i,c){var d=c[0],g=c[1],_=c[2],E=i[0],S=i[1],L=i[2],B=g*L-_*S,N=_*E-d*L,j=d*S-g*E,Y=g*j-_*N,Q=_*B-d*j,ot=d*N-g*B,dt=2*c[3];return N*=dt,j*=dt,Q*=2,ot*=2,l[0]=E+(B*=dt)+(Y*=2),l[1]=S+N+Q,l[2]=L+j+ot,l}var sf,Mh=XA,m8=KA,g8=qA;function wh(l,i,c){var d=i[0],g=i[1],_=i[2],E=i[3];return l[0]=c[0]*d+c[4]*g+c[8]*_+c[12]*E,l[1]=c[1]*d+c[5]*g+c[9]*_+c[13]*E,l[2]=c[2]*d+c[6]*g+c[10]*_+c[14]*E,l[3]=c[3]*d+c[7]*g+c[11]*_+c[15]*E,l}function QA(){var l=new io(4);return io!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function $A(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function t2(l,i,c){c*=.5;var d=i[0],g=i[1],_=i[2],E=i[3],S=Math.sin(c),L=Math.cos(c);return l[0]=d*L+E*S,l[1]=g*L+_*S,l[2]=_*L-g*S,l[3]=E*L-d*S,l}sv(),sf=new io(4),io!=Float32Array&&(sf[0]=0,sf[1]=0,sf[2]=0,sf[3]=0),sv(),ef(1,0,0),ef(0,1,0),QA(),QA(),HA();class uv{constructor(i,c){this.points=i,this.planes=c}static fromInvProjectionMatrix(i,c,d,g){const _=Math.pow(2,d),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const B=wh([],L,i),N=1/B[3]/c*_;return function(j,Y,Q){return j[0]=Y[0]*Q[0],j[1]=Y[1]*Q[1],j[2]=Y[2]*Q[2],j[3]=Y[3]*Q[3],j}(B,B,[N,N,g?1/B[3]:N,N])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const B=rf([],ZA([],Mh([],E[L[0]],E[L[1]]),Mh([],E[L[2]],E[L[1]]))),N=-of(B,E[L[1]]);return B.concat(N)});return new uv(E,S)}}class Eo{constructor(i,c){this.min=i,this.max=c,this.center=nf([],YA([],this.min,this.max),.5)}quadrant(i){const c=[i%2==0,i<2],d=WA(this.min),g=WA(this.max);for(let _=0;_<c.length;_++)d[_]=c[_]?this.min[_]:this.center[_],g[_]=c[_]?this.center[_]:this.max[_];return g[2]=this.max[2],new Eo(d,g)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,c=this.max;return[[i[0],i[1],i[2]],[c[0],i[1],i[2]],[c[0],c[1],i[2]],[i[0],c[1],i[2]],[i[0],i[1],c[2]],[c[0],i[1],c[2]],[c[0],c[1],c[2]],[i[0],c[1],c[2]]]}intersects(i){const c=this.getCorners();let d=!0;for(let g=0;g<i.planes.length;g++){const _=i.planes[g];let E=0;for(let S=0;S<c.length;S++)E+=of(_,c[S])+_[3]>=0;if(E===0)return 0;E!==c.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let _=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<i.points.length;S++){const L=i.points[S][g]-this.min[g];_=Math.min(_,L),E=Math.max(E,L)}if(E<0||_>this.max[g]-this.min[g])return 0}return 1}}function e2(l,i,c,d,g,_,E,S,L){if(_&&l.queryGeometry.isAboveHorizon)return!1;_&&(L*=l.pixelToTileUnitsFactor);for(const B of i)for(const N of B){const j=N.add(S),Y=g&&c.elevation?c.elevation.exaggeration()*g.getElevationAt(j.x,j.y,!0):0,Q=_?j:y8(j,Y,d),ot=_?l.tilespaceRays.map(mt=>v8(mt,Y)):l.queryGeometry.screenGeometry,dt=wh([],[N.x,N.y,Y,1],d);if(!E&&_?L*=dt[3]/c.cameraToCenterDistance:E&&!_&&(L*=c.cameraToCenterDistance/dt[3]),l8(ot,Q,L))return!0}return!1}function y8(l,i,c){const d=wh([],[l.x,l.y,i,1],c);return new M(d[0]/d[3],d[1]/d[3])}const n2=ef(0,0,0),x8=ef(0,0,1);function v8(l,i){const c=sv();return n2[2]=i,l.intersectsPlane(n2,x8,c),new M(c[0],c[1])}class i2 extends $1{}function r2(l,{width:i,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*c*d)throw new RangeError("mismatched image size")}else g=new Uint8Array(i*c*d);return l.width=i,l.height=c,l.data=g,l}function o2(l,i,c){const{width:d,height:g}=i;d===l.width&&g===l.height||(hv(l,i,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,d),height:Math.min(l.height,g)},c),l.width=d,l.height=g,l.data=i.data)}function hv(l,i,c,d,g,_){if(g.width===0||g.height===0)return i;if(g.width>l.width||g.height>l.height||c.x>l.width-g.width||c.y>l.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||d.x>i.width-g.width||d.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const E=l.data,S=i.data;for(let L=0;L<g.height;L++){const B=((c.y+L)*l.width+c.x)*_,N=((d.y+L)*i.width+d.x)*_;for(let j=0;j<g.width*_;j++)S[N+j]=E[B+j]}return i}Ke(i2,"HeatmapBucket",{omit:["layers"]});class ha{constructor(i,c){r2(this,i,1,c)}resize(i){o2(this,new ha(i),1)}clone(){return new ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,d,g,_){hv(i,c,d,g,_,1)}}class ro{constructor(i,c){r2(this,i,4,c)}resize(i){o2(this,new ro(i),4)}replace(i,c){c?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,d,g,_){hv(i,c,d,g,_,4)}}Ke(ha,"AlphaImage"),Ke(ro,"RGBAImage");var _8={paint:new it({"heatmap-radius":new F(Dt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new F(Dt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new I(Dt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new J(Dt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new I(Dt.paint_heatmap["heatmap-opacity"])})};function dv(l){const i={},c=l.resolution||256,d=l.clips?l.clips.length:1,g=l.image||new ro({width:c,height:d}),_=(E,S,L)=>{i[l.evaluationKey]=L;const B=l.expression.evaluate(i);g.data[E+S+0]=Math.floor(255*B.r/B.a),g.data[E+S+1]=Math.floor(255*B.g/B.a),g.data[E+S+2]=Math.floor(255*B.b/B.a),g.data[E+S+3]=Math.floor(255*B.a)};if(l.clips)for(let E=0,S=0;E<d;++E,S+=4*c)for(let L=0,B=0;L<c;L++,B+=4){const N=L/(c-1),{start:j,end:Y}=l.clips[E];_(S,B,j*(1-N)+Y*N)}else for(let E=0,S=0;E<c;E++,S+=4)_(0,S,E/(c-1));return g}var b8={paint:new it({"hillshade-illumination-direction":new I(Dt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new I(Dt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new I(Dt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new I(Dt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new I(Dt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new I(Dt.paint_hillshade["hillshade-accent-color"])})};const M8=Ft([{name:"a_pos",components:2,type:"Int16"}],4),{members:w8}=M8;var Uy=Vy,A8=Vy;function Vy(l,i,c){c=c||2;var d,g,_,E,S,L,B,N=i&&i.length,j=N?i[0]*c:l.length,Y=s2(l,0,j,c,!0),Q=[];if(!Y||Y.next===Y.prev)return Q;if(N&&(Y=function(dt,mt,Tt,Ot){var Xt,Qt,$t,te=[];for(Xt=0,Qt=mt.length;Xt<Qt;Xt++)($t=s2(dt,mt[Xt]*Ot,Xt<Qt-1?mt[Xt+1]*Ot:dt.length,Ot,!1))===$t.next&&($t.steiner=!0),te.push(L8($t));for(te.sort(C8),Xt=0;Xt<te.length;Xt++)Tt=sl(Tt=D8(te[Xt],Tt),Tt.next);return Tt}(l,i,Y,c)),l.length>80*c){d=_=l[0],g=E=l[1];for(var ot=c;ot<j;ot+=c)(S=l[ot])<d&&(d=S),(L=l[ot+1])<g&&(g=L),S>_&&(_=S),L>E&&(E=L);B=(B=Math.max(_-d,E-g))!==0?1/B:0}return af(Y,Q,c,d,g,B),Q}function s2(l,i,c,d,g){var _,E;if(g===mv(l,i,c,d)>0)for(_=i;_<c;_+=d)E=c2(_,l[_],l[_+1],E);else for(_=c-d;_>=i;_-=d)E=c2(_,l[_],l[_+1],E);return E&&Gy(E,E.next)&&(cf(E),E=E.next),E}function sl(l,i){if(!l)return l;i||(i=l);var c,d=l;do if(c=!1,d.steiner||!Gy(d,d.next)&&Ni(d.prev,d,d.next)!==0)d=d.next;else{if(cf(d),(d=i=d.prev)===d.next)break;c=!0}while(c||d!==i);return i}function af(l,i,c,d,g,_,E){if(l){!E&&_&&function(N,j,Y,Q){var ot=N;do ot.z===null&&(ot.z=pv(ot.x,ot.y,j,Y,Q)),ot.prevZ=ot.prev,ot.nextZ=ot.next,ot=ot.next;while(ot!==N);ot.prevZ.nextZ=null,ot.prevZ=null,function(dt){var mt,Tt,Ot,Xt,Qt,$t,te,me,ye=1;do{for(Tt=dt,dt=null,Qt=null,$t=0;Tt;){for($t++,Ot=Tt,te=0,mt=0;mt<ye&&(te++,Ot=Ot.nextZ);mt++);for(me=ye;te>0||me>0&&Ot;)te!==0&&(me===0||!Ot||Tt.z<=Ot.z)?(Xt=Tt,Tt=Tt.nextZ,te--):(Xt=Ot,Ot=Ot.nextZ,me--),Qt?Qt.nextZ=Xt:dt=Xt,Xt.prevZ=Qt,Qt=Xt;Tt=Ot}Qt.nextZ=null,ye*=2}while($t>1)}(ot)}(l,d,g,_);for(var S,L,B=l;l.prev!==l.next;)if(S=l.prev,L=l.next,_?T8(l,d,g,_):E8(l))i.push(S.i/c),i.push(l.i/c),i.push(L.i/c),cf(l),l=L.next,B=L.next;else if((l=L)===B){E?E===1?af(l=P8(sl(l),i,c),i,c,d,g,_,2):E===2&&S8(l,i,c,d,g,_):af(sl(l),i,c,d,g,_,1);break}}}function E8(l){var i=l.prev,c=l,d=l.next;if(Ni(i,c,d)>=0)return!1;for(var g=l.next.next;g!==l.prev;){if(Ah(i.x,i.y,c.x,c.y,d.x,d.y,g.x,g.y)&&Ni(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function T8(l,i,c,d){var g=l.prev,_=l,E=l.next;if(Ni(g,_,E)>=0)return!1;for(var S=g.x>_.x?g.x>E.x?g.x:E.x:_.x>E.x?_.x:E.x,L=g.y>_.y?g.y>E.y?g.y:E.y:_.y>E.y?_.y:E.y,B=pv(g.x<_.x?g.x<E.x?g.x:E.x:_.x<E.x?_.x:E.x,g.y<_.y?g.y<E.y?g.y:E.y:_.y<E.y?_.y:E.y,i,c,d),N=pv(S,L,i,c,d),j=l.prevZ,Y=l.nextZ;j&&j.z>=B&&Y&&Y.z<=N;){if(j!==l.prev&&j!==l.next&&Ah(g.x,g.y,_.x,_.y,E.x,E.y,j.x,j.y)&&Ni(j.prev,j,j.next)>=0||(j=j.prevZ,Y!==l.prev&&Y!==l.next&&Ah(g.x,g.y,_.x,_.y,E.x,E.y,Y.x,Y.y)&&Ni(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;j&&j.z>=B;){if(j!==l.prev&&j!==l.next&&Ah(g.x,g.y,_.x,_.y,E.x,E.y,j.x,j.y)&&Ni(j.prev,j,j.next)>=0)return!1;j=j.prevZ}for(;Y&&Y.z<=N;){if(Y!==l.prev&&Y!==l.next&&Ah(g.x,g.y,_.x,_.y,E.x,E.y,Y.x,Y.y)&&Ni(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function P8(l,i,c){var d=l;do{var g=d.prev,_=d.next.next;!Gy(g,_)&&a2(g,d,d.next,_)&&lf(g,_)&&lf(_,g)&&(i.push(g.i/c),i.push(d.i/c),i.push(_.i/c),cf(d),cf(d.next),d=l=_),d=d.next}while(d!==l);return sl(d)}function S8(l,i,c,d,g,_){var E=l;do{for(var S=E.next.next;S!==E.prev;){if(E.i!==S.i&&I8(E,S)){var L=l2(E,S);return E=sl(E,E.next),L=sl(L,L.next),af(E,i,c,d,g,_),void af(L,i,c,d,g,_)}S=S.next}E=E.next}while(E!==l)}function C8(l,i){return l.x-i.x}function D8(l,i){var c=function(_,E){var S,L=E,B=_.x,N=_.y,j=-1/0;do{if(N<=L.y&&N>=L.next.y&&L.next.y!==L.y){var Y=L.x+(N-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(Y<=B&&Y>j){if(j=Y,Y===B){if(N===L.y)return L;if(N===L.next.y)return L.next}S=L.x<L.next.x?L:L.next}}L=L.next}while(L!==E);if(!S)return null;if(B===j)return S;var Q,ot=S,dt=S.x,mt=S.y,Tt=1/0;L=S;do B>=L.x&&L.x>=dt&&B!==L.x&&Ah(N<mt?B:j,N,dt,mt,N<mt?j:B,N,L.x,L.y)&&(Q=Math.abs(N-L.y)/(B-L.x),lf(L,_)&&(Q<Tt||Q===Tt&&(L.x>S.x||L.x===S.x&&R8(S,L)))&&(S=L,Tt=Q)),L=L.next;while(L!==ot);return S}(l,i);if(!c)return i;var d=l2(c,l),g=sl(c,c.next);return sl(d,d.next),i===c?g:i}function R8(l,i){return Ni(l.prev,l,i.prev)<0&&Ni(i.next,l,l.next)<0}function pv(l,i,c,d,g){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=32767*(l-c)*g)|l<<8))|l<<4))|l<<2))|l<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-d)*g)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function L8(l){var i=l,c=l;do(i.x<c.x||i.x===c.x&&i.y<c.y)&&(c=i),i=i.next;while(i!==l);return c}function Ah(l,i,c,d,g,_,E,S){return(g-E)*(i-S)-(l-E)*(_-S)>=0&&(l-E)*(d-S)-(c-E)*(i-S)>=0&&(c-E)*(_-S)-(g-E)*(d-S)>=0}function I8(l,i){return l.next.i!==i.i&&l.prev.i!==i.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&a2(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(l,i)&&(lf(l,i)&&lf(i,l)&&function(c,d){var g=c,_=!1,E=(c.x+d.x)/2,S=(c.y+d.y)/2;do g.y>S!=g.next.y>S&&g.next.y!==g.y&&E<(g.next.x-g.x)*(S-g.y)/(g.next.y-g.y)+g.x&&(_=!_),g=g.next;while(g!==c);return _}(l,i)&&(Ni(l.prev,l,i.prev)||Ni(l,i.prev,i))||Gy(l,i)&&Ni(l.prev,l,l.next)>0&&Ni(i.prev,i,i.next)>0)}function Ni(l,i,c){return(i.y-l.y)*(c.x-i.x)-(i.x-l.x)*(c.y-i.y)}function Gy(l,i){return l.x===i.x&&l.y===i.y}function a2(l,i,c,d){var g=jy(Ni(l,i,c)),_=jy(Ni(l,i,d)),E=jy(Ni(c,d,l)),S=jy(Ni(c,d,i));return g!==_&&E!==S||!(g!==0||!Oy(l,c,i))||!(_!==0||!Oy(l,d,i))||!(E!==0||!Oy(c,l,d))||!(S!==0||!Oy(c,i,d))}function Oy(l,i,c){return i.x<=Math.max(l.x,c.x)&&i.x>=Math.min(l.x,c.x)&&i.y<=Math.max(l.y,c.y)&&i.y>=Math.min(l.y,c.y)}function jy(l){return l>0?1:l<0?-1:0}function lf(l,i){return Ni(l.prev,l,l.next)<0?Ni(l,i,l.next)>=0&&Ni(l,l.prev,i)>=0:Ni(l,i,l.prev)<0||Ni(l,l.next,i)<0}function l2(l,i){var c=new fv(l.i,l.x,l.y),d=new fv(i.i,i.x,i.y),g=l.next,_=i.prev;return l.next=i,i.prev=l,c.next=g,g.prev=c,d.next=c,c.prev=d,_.next=d,d.prev=_,d}function c2(l,i,c,d){var g=new fv(l,i,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function cf(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function fv(l,i,c){this.i=l,this.x=i,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function mv(l,i,c,d){for(var g=0,_=i,E=c-d;_<c;_+=d)g+=(l[E]-l[_])*(l[_+1]+l[E+1]),E=_;return g}function k8(l,i,c,d,g){u2(l,i,c||0,d||l.length-1,g||B8)}function u2(l,i,c,d,g){for(;d>c;){if(d-c>600){var _=d-c+1,E=i-c+1,S=Math.log(_),L=.5*Math.exp(2*S/3),B=.5*Math.sqrt(S*L*(_-L)/_)*(E-_/2<0?-1:1);u2(l,i,Math.max(c,Math.floor(i-E*L/_+B)),Math.min(d,Math.floor(i+(_-E)*L/_+B)),g)}var N=l[i],j=c,Y=d;for(uf(l,c,i),g(l[d],N)>0&&uf(l,c,d);j<Y;){for(uf(l,j,Y),j++,Y--;g(l[j],N)<0;)j++;for(;g(l[Y],N)>0;)Y--}g(l[c],N)===0?uf(l,c,Y):uf(l,++Y,d),Y<=i&&(c=Y+1),i<=Y&&(d=Y-1)}}function uf(l,i,c){var d=l[i];l[i]=l[c],l[c]=d}function B8(l,i){return l<i?-1:l>i?1:0}function gv(l,i){const c=l.length;if(c<=1)return[l];const d=[];let g,_;for(let E=0;E<c;E++){const S=Wt(l[E]);S!==0&&(l[E].area=Math.abs(S),_===void 0&&(_=S<0),_===S<0?(g&&d.push(g),g=[l[E]]):g.push(l[E]))}if(g&&d.push(g),i>1)for(let E=0;E<d.length;E++)d[E].length<=i||(k8(d[E],i,1,d[E].length-1,F8),d[E]=d[E].slice(0,i));return d}function F8(l,i){return i.area-l.area}function yv(l,i,c){const d=c.patternDependencies;let g=!1;for(const _ of i){const E=_.paint.get(`${l}-pattern`);E.isConstant()||(g=!0);const S=E.constantOr(null);S&&(g=!0,d[S.to]=!0,d[S.from]=!0)}return g}function xv(l,i,c,d,g){const _=g.patternDependencies;for(const E of i){const S=E.paint.get(`${l}-pattern`).value;if(S.kind!=="constant"){let L=S.evaluate({zoom:d-1},c,{},g.availableImages),B=S.evaluate({zoom:d},c,{},g.availableImages),N=S.evaluate({zoom:d+1},c,{},g.availableImages);L=L&&L.name?L.name:L,B=B&&B.name?B.name:B,N=N&&N.name?N.name:N,_[L]=!0,_[B]=!0,_[N]=!0,c.patterns[E.id]={min:L,mid:B,max:N}}}return c}Vy.deviation=function(l,i,c,d){var g=i&&i.length,_=Math.abs(mv(l,0,g?i[0]*c:l.length,c));if(g)for(var E=0,S=i.length;E<S;E++)_-=Math.abs(mv(l,i[E]*c,E<S-1?i[E+1]*c:l.length,c));var L=0;for(E=0;E<d.length;E+=3){var B=d[E]*c,N=d[E+1]*c,j=d[E+2]*c;L+=Math.abs((l[B]-l[j])*(l[N+1]-l[B+1])-(l[B]-l[N])*(l[j+1]-l[B+1]))}return _===0&&L===0?0:Math.abs((L-_)/_)},Vy.flatten=function(l){for(var i=l[0][0].length,c={vertices:[],holes:[],dimensions:i},d=0,g=0;g<l.length;g++){for(var _=0;_<l[g].length;_++)for(var E=0;E<i;E++)c.vertices.push(l[g][_][E]);g>0&&c.holes.push(d+=l[g-1].length)}return c},Uy.default=A8;class Hy{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new It,this.indexArray=new Ze,this.indexArray2=new Pn,this.programConfigurations=new yc(i.layers,i.zoom),this.segments=new Ri,this.segments2=new Ri,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=i.projection}populate(i,c,d,g){this.hasPattern=yv("fill",this.layers,c);const _=this.layers[0].layout.get("fill-sort-key"),E=[];for(const{feature:S,id:L,index:B,sourceLayerIndex:N}of i){const j=this.layers[0]._featureFilter.needGeometry,Y=xc(S,j);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),Y,d))continue;const Q=_?_.evaluate(Y,{},d,c.availableImages):void 0,ot={id:L,properties:S.properties,type:S.type,sourceLayerIndex:N,index:B,geometry:j?Y.geometry:ua(S,d,g),patterns:{},sortKey:Q};E.push(ot)}_&&E.sort((S,L)=>S.sortKey-L.sortKey);for(const S of E){const{geometry:L,index:B,sourceLayerIndex:N}=S;if(this.hasPattern){const j=xv("fill",this.layers,S,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(S,L,B,d,{},c.availableImages);c.featureIndex.insert(i[B].feature,L,B,N,this.index)}}update(i,c,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d,g)}addFeatures(i,c,d,g,_){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,c,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,w8),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,c,d,g,_,E=[]){for(const S of gv(c,500)){let L=0;for(const ot of S)L+=ot.length;const B=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),N=B.vertexLength,j=[],Y=[];for(const ot of S){if(ot.length===0)continue;ot!==S[0]&&Y.push(j.length/2);const dt=this.segments2.prepareSegment(ot.length,this.layoutVertexArray,this.indexArray2),mt=dt.vertexLength;this.layoutVertexArray.emplaceBack(ot[0].x,ot[0].y),this.indexArray2.emplaceBack(mt+ot.length-1,mt),j.push(ot[0].x),j.push(ot[0].y);for(let Tt=1;Tt<ot.length;Tt++)this.layoutVertexArray.emplaceBack(ot[Tt].x,ot[Tt].y),this.indexArray2.emplaceBack(mt+Tt-1,mt+Tt),j.push(ot[Tt].x),j.push(ot[Tt].y);dt.vertexLength+=ot.length,dt.primitiveLength+=ot.length}const Q=Uy(j,Y);for(let ot=0;ot<Q.length;ot+=3)this.indexArray.emplaceBack(N+Q[ot],N+Q[ot+1],N+Q[ot+2]);B.vertexLength+=L,B.primitiveLength+=Q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,_,E,g)}}Ke(Hy,"FillBucket",{omit:["layers","patternFeatures"]});const z8=new it({"fill-sort-key":new F(Dt.layout_fill["fill-sort-key"])});var N8={paint:new it({"fill-antialias":new I(Dt.paint_fill["fill-antialias"]),"fill-opacity":new F(Dt.paint_fill["fill-opacity"]),"fill-color":new F(Dt.paint_fill["fill-color"]),"fill-outline-color":new F(Dt.paint_fill["fill-outline-color"]),"fill-translate":new I(Dt.paint_fill["fill-translate"]),"fill-translate-anchor":new I(Dt.paint_fill["fill-translate-anchor"]),"fill-pattern":new q(Dt.paint_fill["fill-pattern"])}),layout:z8};const U8=Ft([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),V8=Ft([{name:"a_centroid_pos",components:2,type:"Uint16"}]),G8=Ft([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:O8}=U8;var h2=Eh;function Eh(l,i,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=l,this._geometry=-1,this._keys=d,this._values=g,l.readFields(j8,this,i)}function j8(l,i,c){l==1?i.id=c.readVarint():l==2?function(d,g){for(var _=d.readVarint()+d.pos;d.pos<_;){var E=g._keys[d.readVarint()],S=g._values[d.readVarint()];g.properties[E]=S}}(c,i):l==3?i.type=c.readVarint():l==4&&(i._geometry=c.pos)}function H8(l){for(var i,c,d=0,g=0,_=l.length,E=_-1;g<_;E=g++)d+=((c=l[E]).x-(i=l[g]).x)*(i.y+c.y);return d}Eh.types=["Unknown","Point","LineString","Polygon"],Eh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var i,c=l.readVarint()+l.pos,d=1,g=0,_=0,E=0,S=[];l.pos<c;){if(g<=0){var L=l.readVarint();d=7&L,g=L>>3}if(g--,d===1||d===2)_+=l.readSVarint(),E+=l.readSVarint(),d===1&&(i&&S.push(i),i=[]),i.push(new M(_,E));else{if(d!==7)throw new Error("unknown command "+d);i&&i.push(i[0].clone())}}return i&&S.push(i),S},Eh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var i=l.readVarint()+l.pos,c=1,d=0,g=0,_=0,E=1/0,S=-1/0,L=1/0,B=-1/0;l.pos<i;){if(d<=0){var N=l.readVarint();c=7&N,d=N>>3}if(d--,c===1||c===2)(g+=l.readSVarint())<E&&(E=g),g>S&&(S=g),(_+=l.readSVarint())<L&&(L=_),_>B&&(B=_);else if(c!==7)throw new Error("unknown command "+c)}return[E,L,S,B]},Eh.prototype.toGeoJSON=function(l,i,c){var d,g,_=this.extent*Math.pow(2,c),E=this.extent*l,S=this.extent*i,L=this.loadGeometry(),B=Eh.types[this.type];function N(Q){for(var ot=0;ot<Q.length;ot++){var dt=Q[ot];Q[ot]=[360*(dt.x+E)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(dt.y+S)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(d=0;d<L.length;d++)j[d]=L[d][0];N(L=j);break;case 2:for(d=0;d<L.length;d++)N(L[d]);break;case 3:for(L=function(Q){var ot=Q.length;if(ot<=1)return[Q];for(var dt,mt,Tt=[],Ot=0;Ot<ot;Ot++){var Xt=H8(Q[Ot]);Xt!==0&&(mt===void 0&&(mt=Xt<0),mt===Xt<0?(dt&&Tt.push(dt),dt=[Q[Ot]]):dt.push(Q[Ot]))}return dt&&Tt.push(dt),Tt}(L),d=0;d<L.length;d++)for(g=0;g<L[d].length;g++)N(L[d][g])}L.length===1?L=L[0]:B="Multi"+B;var Y={type:"Feature",geometry:{type:B,coordinates:L},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var d2=p2;function p2(l,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(W8,this,i),this.length=this._features.length}function W8(l,i,c){l===15?i.version=c.readVarint():l===1?i.name=c.readString():l===5?i.extent=c.readVarint():l===2?i._features.push(c.pos):l===3?i._keys.push(c.readString()):l===4&&i._values.push(function(d){for(var g=null,_=d.readVarint()+d.pos;d.pos<_;){var E=d.readVarint()>>3;g=E===1?d.readString():E===2?d.readFloat():E===3?d.readDouble():E===4?d.readVarint64():E===5?d.readVarint():E===6?d.readSVarint():E===7?d.readBoolean():null}return g}(c))}function q8(l,i,c){if(l===3){var d=new d2(c,c.readVarint()+c.pos);d.length&&(i[d.name]=d)}}p2.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var i=this._pbf.readVarint()+this._pbf.pos;return new h2(this._pbf,i,this.extent,this._keys,this._values)};var bc={VectorTile:function(l,i){this.layers=l.readFields(q8,{},i)},VectorTileFeature:h2,VectorTileLayer:d2};function Wy(l,i,c,d){const g=[],_=d===0?(E,S,L,B,N,j)=>{E.push(new M(j,L+(j-S)/(B-S)*(N-L)))}:(E,S,L,B,N,j)=>{E.push(new M(S+(j-L)/(N-L)*(B-S),j))};for(const E of l){const S=[];for(const L of E){if(L.length<=2)continue;const B=[];for(let Y=0;Y<L.length-1;Y++){const Q=L[Y].x,ot=L[Y].y,dt=L[Y+1].x,mt=L[Y+1].y,Tt=d===0?Q:ot,Ot=d===0?dt:mt;Tt<i?Ot>i&&_(B,Q,ot,dt,mt,i):Tt>c?Ot<c&&_(B,Q,ot,dt,mt,c):B.push(L[Y]),Ot<i&&Tt>=i&&_(B,Q,ot,dt,mt,i),Ot>c&&Tt<=c&&_(B,Q,ot,dt,mt,c)}let N=L[L.length-1];const j=d===0?N.x:N.y;j>=i&&j<=c&&B.push(N),B.length&&(N=B[B.length-1],B[0].x===N.x&&B[0].y===N.y||B.push(B[0]),S.push(B))}S.length&&g.push(S)}return g}const Y8=bc.VectorTileFeature.types,X8=Math.pow(2,13);function hf(l,i,c,d,g,_,E,S){l.emplaceBack((i<<1)+E,(c<<1)+_,(Math.floor(d*X8)<<1)+g,Math.round(S))}function df(l,i,c){l.emplaceBack(i.x,i.y,i.z,c[0]*16384,c[1]*16384,c[2]*16384)}class f2{constructor(){this.acc=new M(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new M(i.x,i.y),this.max=new M(i.x,i.y))}append(i,c){this.currentPolyCount.edges++,this.acc._add(i);const d=this.min,g=this.max;i.x<d.x?d.x=i.x:i.x>g.x&&(g.x=i.x),i.y<d.y?d.y=i.y:i.y>g.y&&(g.y=i.y),((i.x===0||i.x===Fn)&&i.x===c.x)!=((i.y===0||i.y===Fn)&&i.y===c.y)&&this.processBorderOverlap(i,c),c.x<0!=i.x<0&&this.addBorderIntersection(0,bn(c.y,i.y,(0-c.x)/(i.x-c.x))),c.x>Fn!=i.x>Fn&&this.addBorderIntersection(1,bn(c.y,i.y,(Fn-c.x)/(i.x-c.x))),c.y<0!=i.y<0&&this.addBorderIntersection(2,bn(c.x,i.x,(0-c.y)/(i.y-c.y))),c.y>Fn!=i.y>Fn&&this.addBorderIntersection(3,bn(c.x,i.x,(Fn-c.y)/(i.y-c.y)))}addBorderIntersection(i,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[i];c<d[0]&&(d[0]=c),c>d[1]&&(d[1]=c)}processBorderOverlap(i,c){if(i.x===c.x){if(i.y===c.y)return;const d=i.x===0?0:1;this.addBorderIntersection(d,c.y),this.addBorderIntersection(d,i.y)}else{const d=i.y===0?2:3;this.addBorderIntersection(d,c.x),this.addBorderIntersection(d,i.x)}}centroid(){const i=this.polyCount.reduce((c,d)=>c+d.edges,0);return i!==0?this.acc.div(i)._round():new M(0,0)}span(){return new M(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,c)=>i+ +(c[0]!==Number.MAX_VALUE),0)}}class pf{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Ut,this.centroidVertexArray=new gc,this.indexArray=new Ze,this.programConfigurations=new yc(i.layers,i.zoom),this.segments=new Ri,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.enableTerrain=i.enableTerrain}populate(i,c,d,g){this.features=[],this.hasPattern=yv("fill-extrusion",this.layers,c),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(_){const E=Math.exp(Math.PI*(1-_.y/(1<<_.z)*2));return 80150034*E/(E*E+1)/Fn/(1<<_.z)}(d);for(const{feature:_,id:E,index:S,sourceLayerIndex:L}of i){const B=this.layers[0]._featureFilter.needGeometry,N=xc(_,B);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),N,d))continue;const j={id:E,sourceLayerIndex:L,index:S,geometry:B?N.geometry:ua(_,d,g),properties:_.properties,type:_.type,patterns:{}},Y=this.layoutVertexArray.length;this.hasPattern?this.features.push(xv("fill-extrusion",this.layers,j,this.zoom,c)):this.addFeature(j,j.geometry,S,d,{},c.availableImages,g),c.featureIndex.insert(_,j.geometry,S,L,this.index,Y)}this.sortBorders()}addFeatures(i,c,d,g,_){for(const E of this.features){const{geometry:S}=E;this.addFeature(E,S,E.index,c,d,g,_)}this.sortBorders()}update(i,c,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,O8),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,G8.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,V8.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,d,g,_,E,S){const L=[new M(0,0),new M(Fn,Fn)],B=S.projection,N=B.name==="globe",j=this.enableTerrain&&!N?new f2:null;N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vr);const Y=gv(c,500);for(let dt=Y.length-1;dt>=0;dt--){const mt=Y[dt];(mt.length===0||(Q=mt[0]).every(Tt=>Tt.x<=0)||Q.every(Tt=>Tt.x>=Fn)||Q.every(Tt=>Tt.y<=0)||Q.every(Tt=>Tt.y>=Fn))&&Y.splice(dt,1)}var Q;let ot;if(N){const mt=1<<g.z,Tt=ko(g.x/mt),Ot=ko((g.x+1)/mt),Xt=hr(g.y/mt),Qt=hr((g.y+1)/mt);ot=function($t,te,me,ye,Ae=0,Ce){const ue=[];if(!$t.length||!me||!ye)return ue;const _e=(Rn,Vn)=>{for(const nn of Rn)ue.push({polygon:nn,bounds:Vn})},Re=Math.ceil(Math.log2(me)),Ve=Math.ceil(Math.log2(ye)),Be=Re-Ve,Ue=[];for(let Rn=0;Rn<Math.abs(Be);Rn++)Ue.push(Be>0?0:1);for(let Rn=0;Rn<Math.min(Re,Ve);Rn++)Ue.push(0),Ue.push(1);let Cn=$t;if(Cn=Wy(Cn,te[0].y-Ae,te[1].y+Ae,1),Cn=Wy(Cn,te[0].x-Ae,te[1].x+Ae,0),!Cn.length)return ue;const Hn=[];for(Ue.length?Hn.push({polygons:Cn,bounds:te,depth:0}):_e(Cn,te);Hn.length;){const Rn=Hn.pop(),Vn=Rn.depth,nn=Ue[Vn],Xe=Rn.bounds[0],Wn=Rn.bounds[1],ei=nn===0?Xe.x:Xe.y,Hi=nn===0?Wn.x:Wn.y,gi=Ce?Ce(nn,ei,Hi):.5*(ei+Hi),Wi=Wy(Rn.polygons,ei-Ae,gi+Ae,nn),ni=Wy(Rn.polygons,gi-Ae,Hi+Ae,nn);if(Wi.length){const Yn=[Xe,new M(nn===0?gi:Wn.x,nn===1?gi:Wn.y)];Ue.length>Vn+1?Hn.push({polygons:Wi,bounds:Yn,depth:Vn+1}):_e(Wi,Yn)}if(ni.length){const Yn=[new M(nn===0?gi:Xe.x,nn===1?gi:Xe.y),Wn];Ue.length>Vn+1?Hn.push({polygons:ni,bounds:Yn,depth:Vn+1}):_e(ni,Yn)}}return ue}(Y,L,Math.ceil((Ot-Tt)/11.25),Math.ceil((Xt-Qt)/11.25),1,($t,te,me)=>{if($t===0)return .5*(te+me);{const ye=hr((g.y+te/Fn)/mt);return(xh(.5*(hr((g.y+me/Fn)/mt)+ye))*mt-g.y)*Fn}})}else{ot=[];for(const dt of Y)ot.push({polygon:dt,bounds:L})}for(const dt of ot){const mt=dt.polygon;let Tt=0,Ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let me=0;me<mt.length;me++){const ye=mt[me];if(ye.length===0)continue;Tt+=ye.length;let Ae=0;j&&j.startRing(ye[0]);for(let Ce=0;Ce<ye.length;Ce++){const ue=ye[Ce];if(Ce>=1){const _e=ye[Ce-1];if(!K8(ue,_e,dt.bounds)){j&&j.append(ue,_e),Ot.vertexLength+4>Ri.MAX_VERTEX_ARRAY_LENGTH&&(Ot=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=ue.sub(_e)._perp(),Ve=Re.x/(Math.abs(Re.x)+Math.abs(Re.y)),Be=Re.y>0?1:0,Ue=_e.dist(ue);Ae+Ue>32768&&(Ae=0),hf(this.layoutVertexArray,ue.x,ue.y,Ve,Be,0,0,Ae),hf(this.layoutVertexArray,ue.x,ue.y,Ve,Be,0,1,Ae),Ae+=Ue,hf(this.layoutVertexArray,_e.x,_e.y,Ve,Be,0,0,Ae),hf(this.layoutVertexArray,_e.x,_e.y,Ve,Be,0,1,Ae);const Cn=Ot.vertexLength;if(this.indexArray.emplaceBack(Cn,Cn+2,Cn+1),this.indexArray.emplaceBack(Cn+1,Cn+2,Cn+3),Ot.vertexLength+=4,Ot.primitiveLength+=2,N){const Hn=this.layoutVertexExtArray,Rn=B.projectTilePoint(ue.x,ue.y,g),Vn=B.projectTilePoint(_e.x,_e.y,g),nn=B.upVector(g,ue.x,ue.y),Xe=B.upVector(g,_e.x,_e.y);df(Hn,Rn,nn),df(Hn,Rn,nn),df(Hn,Vn,Xe),df(Hn,Vn,Xe)}}}}}if(Ot.vertexLength+Tt>Ri.MAX_VERTEX_ARRAY_LENGTH&&(Ot=this.segments.prepareSegment(Tt,this.layoutVertexArray,this.indexArray)),Y8[i.type]!=="Polygon")continue;const Xt=[],Qt=[],$t=Ot.vertexLength;for(let me=0;me<mt.length;me++){const ye=mt[me];if(ye.length!==0){ye!==mt[0]&&Qt.push(Xt.length/2);for(let Ae=0;Ae<ye.length;Ae++){const Ce=ye[Ae];hf(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),Xt.push(Ce.x),Xt.push(Ce.y),j&&j.currentPolyCount.top++,N&&df(this.layoutVertexExtArray,B.projectTilePoint(Ce.x,Ce.y,g),B.upVector(g,Ce.x,Ce.y))}}}const te=Uy(Xt,Qt);for(let me=0;me<te.length;me+=3)this.indexArray.emplaceBack($t+te[me],$t+te[me+2],$t+te[me+1]);Ot.primitiveLength+=te.length/3,Ot.vertexLength+=Tt}if(j&&j.polyCount.length>0){if(j.borders){j.vertexArrayOffset=this.centroidVertexArray.length;const dt=j.borders,mt=this.featuresOnBorder.push(j)-1;for(let Tt=0;Tt<4;Tt++)dt[Tt][0]!==Number.MAX_VALUE&&this.borders[Tt].push(mt)}this.encodeCentroid(j.borders?void 0:j.centroid(),j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,_,E,g)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((c,d)=>this.featuresOnBorder[c].borders[i][0]-this.featuresOnBorder[d].borders[i][0])}encodeCentroid(i,c,d=!0){let g,_;if(i)if(i.y!==0){const S=c.span()._mult(this.tileToMeter);g=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(S.x/10)),_=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(S.y/10))}else g=Math.ceil(7*(i.x+450)),_=0;else g=0,_=+d;let E=d?this.centroidVertexArray.length:c.vertexArrayOffset;for(const S of c.polyCount){d&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*S.edges+S.top);for(let L=0;L<2*S.edges;L++)this.centroidVertexArray.emplace(E++,0,_),this.centroidVertexArray.emplace(E++,g,_);for(let L=0;L<S.top;L++)this.centroidVertexArray.emplace(E++,g,_)}}}function K8(l,i,c){return l.x===i.x&&(l.x<c[0].x||l.x>c[1].x)||l.y===i.y&&(l.y<c[0].y||l.y>c[1].y)}Ke(pf,"FillExtrusionBucket",{omit:["layers","features"]}),Ke(f2,"PartMetadata");var Z8={paint:new it({"fill-extrusion-opacity":new I(Dt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new F(Dt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new I(Dt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new I(Dt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new q(Dt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new F(Dt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new F(Dt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new I(Dt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ff(l,i){return l.x*i.x+l.y*i.y}function m2(l,i){if(l.length===1){let c=0;const d=i[c++];let g;for(;!g||d.equals(g);)if(g=i[c++],!g)return 1/0;for(;c<i.length;c++){const _=i[c],E=l[0],S=g.sub(d),L=_.sub(d),B=E.sub(d),N=ff(S,S),j=ff(S,L),Y=ff(L,L),Q=ff(B,S),ot=ff(B,L),dt=N*Y-j*j,mt=(Y*Q-j*ot)/dt,Tt=(N*ot-j*Q)/dt,Ot=d.z*(1-mt-Tt)+g.z*mt+_.z*Tt;if(isFinite(Ot))return Ot}return 1/0}{let c=1/0;for(const d of i)c=Math.min(c,d.z);return c}}function g2(l){const i=new M(l[0],l[1]);return i.z=l[2],i}function J8(l,i,c,d,g,_,E,S){const L=E*g.getElevationAt(l,i,!0,!0),B=_[0]!==0,N=B?_[1]===0?E*(_[0]/7-450):E*function(j,Y,Q){const ot=Math.floor(Y[0]/8),dt=Math.floor(Y[1]/8),mt=10*(Y[0]-8*ot),Tt=10*(Y[1]-8*dt),Ot=j.getElevationAt(ot,dt,!0,!0),Xt=j.getMeterToDEM(Q),Qt=Math.floor(.5*(mt*Xt-1)),$t=Math.floor(.5*(Tt*Xt-1)),te=j.tileCoordToPixel(ot,dt),me=2*Qt+1,ye=2*$t+1,Ae=function(Be,Ue,Cn,Hn,Rn){return[Be.getElevationAtPixel(Ue,Cn,!0),Be.getElevationAtPixel(Ue+Rn,Cn,!0),Be.getElevationAtPixel(Ue,Cn+Rn,!0),Be.getElevationAtPixel(Ue+Hn,Cn+Rn,!0)]}(j,te.x-Qt,te.y-$t,me,ye),Ce=Math.abs(Ae[0]-Ae[1]),ue=Math.abs(Ae[2]-Ae[3]),_e=Math.abs(Ae[0]-Ae[2])+Math.abs(Ae[1]-Ae[3]),Re=Math.min(.25,.5*Xt*(Ce+ue)/me),Ve=Math.min(.25,.5*Xt*_e/ye);return Ot+Math.max(Re*mt,Ve*Tt)}(g,_,S):L;return{base:L+(c===0)?-1:c,top:B?Math.max(N+d,L+c+2):L+d}}const Q8=Ft([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$8}=Q8,tG=Ft([{name:"a_packed",components:3,type:"Float32"}]),{members:eG}=tG,nG=bc.VectorTileFeature.types,iG=Math.cos(Math.PI/180*37.5);class qy{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Rt,this.layoutVertexArray2=new ze,this.indexArray=new Ze,this.programConfigurations=new yc(i.layers,i.zoom),this.segments=new Ri,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,d,g){this.hasPattern=yv("line",this.layers,c);const _=this.layers[0].layout.get("line-sort-key"),E=[];for(const{feature:N,id:j,index:Y,sourceLayerIndex:Q}of i){const ot=this.layers[0]._featureFilter.needGeometry,dt=xc(N,ot);if(!this.layers[0]._featureFilter.filter(new mi(this.zoom),dt,d))continue;const mt=_?_.evaluate(dt,{},d):void 0,Tt={id:j,properties:N.properties,type:N.type,sourceLayerIndex:Q,index:Y,geometry:ot?dt.geometry:ua(N,d,g),patterns:{},sortKey:mt};E.push(Tt)}_&&E.sort((N,j)=>N.sortKey-j.sortKey);const{lineAtlas:S,featureIndex:L}=c,B=this.addConstantDashes(S);for(const N of E){const{geometry:j,index:Y,sourceLayerIndex:Q}=N;if(B&&this.addFeatureDashes(N,S),this.hasPattern){const ot=xv("line",this.layers,N,this.zoom,c);this.patternFeatures.push(ot)}else this.addFeature(N,j,Y,d,S.positions,c.availableImages);L.insert(i[Y].feature,j,Y,Q,this.index)}}addConstantDashes(i){let c=!1;for(const d of this.layers){const g=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if(g.kind!=="constant"||_.kind!=="constant")c=!0;else{const E=_.value,S=g.value;if(!S)continue;i.addDash(S.from,E),i.addDash(S.to,E),S.other&&i.addDash(S.other,E)}}return c}addFeatureDashes(i,c){const d=this.zoom;for(const g of this.layers){const _=g.paint.get("line-dasharray").value,E=g.layout.get("line-cap").value;if(_.kind==="constant"&&E.kind==="constant")continue;let S,L,B,N,j,Y;if(_.kind==="constant"){const mt=_.value;if(!mt)continue;S=mt.other||mt.to,L=mt.to,B=mt.from}else S=_.evaluate({zoom:d-1},i),L=_.evaluate({zoom:d},i),B=_.evaluate({zoom:d+1},i);E.kind==="constant"?N=j=Y=E.value:(N=E.evaluate({zoom:d-1},i),j=E.evaluate({zoom:d},i),Y=E.evaluate({zoom:d+1},i)),c.addDash(S,N),c.addDash(L,j),c.addDash(B,Y);const Q=c.getKey(S,N),ot=c.getKey(L,j),dt=c.getKey(B,Y);i.patterns[g.id]={min:Q,mid:ot,max:dt}}}update(i,c,d,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,d,g)}addFeatures(i,c,d,g,_){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,c,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,eG)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,$8),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,c,d,g,_,E){const S=this.layers[0].layout,L=S.get("line-join").evaluate(i,{}),B=S.get("line-cap").evaluate(i,{}),N=S.get("line-miter-limit"),j=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const Y of c)this.addLine(Y,i,L,B,N,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,_,E,g)}addLine(i,c,d,g,_,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Tt=0;Tt<i.length-1;Tt++)this.totalDistance+=i[Tt].dist(i[Tt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=nG[c.type]==="Polygon";let L=i.length;for(;L>=2&&i[L-1].equals(i[L-2]);)L--;let B=0;for(;B<L-1&&i[B].equals(i[B+1]);)B++;if(L<(S?3:2))return;d==="bevel"&&(_=1.05);const N=this.overscaling<=16?122880/(512*this.overscaling):0,j=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let Y,Q,ot,dt,mt;this.e1=this.e2=-1,S&&(Y=i[L-2],mt=i[B].sub(Y)._unit()._perp());for(let Tt=B;Tt<L;Tt++){if(ot=Tt===L-1?S?i[B+1]:void 0:i[Tt+1],ot&&i[Tt].equals(ot))continue;mt&&(dt=mt),Y&&(Q=Y),Y=i[Tt],mt=ot?ot.sub(Y)._unit()._perp():dt,dt=dt||mt;let Ot=dt.add(mt);Ot.x===0&&Ot.y===0||Ot._unit();const Xt=dt.x*mt.x+dt.y*mt.y,Qt=Ot.x*mt.x+Ot.y*mt.y,$t=Qt!==0?1/Qt:1/0,te=2*Math.sqrt(2-2*Qt),me=Qt<iG&&Q&&ot,ye=dt.x*mt.y-dt.y*mt.x>0;if(me&&Tt>B){const ue=Y.dist(Q);if(ue>2*N){const _e=Y.sub(Y.sub(Q)._mult(N/ue)._round());this.updateDistance(Q,_e),this.addCurrentVertex(_e,dt,0,0,j),Q=_e}}const Ae=Q&&ot;let Ce=Ae?d:S?"butt":g;if(Ae&&Ce==="round"&&($t<E?Ce="miter":$t<=2&&(Ce="fakeround")),Ce==="miter"&&$t>_&&(Ce="bevel"),Ce==="bevel"&&($t>2&&(Ce="flipbevel"),$t<_&&(Ce="miter")),Q&&this.updateDistance(Q,Y),Ce==="miter")Ot._mult($t),this.addCurrentVertex(Y,Ot,0,0,j);else if(Ce==="flipbevel"){if($t>100)Ot=mt.mult(-1);else{const ue=$t*dt.add(mt).mag()/dt.sub(mt).mag();Ot._perp()._mult(ue*(ye?-1:1))}this.addCurrentVertex(Y,Ot,0,0,j),this.addCurrentVertex(Y,Ot.mult(-1),0,0,j)}else if(Ce==="bevel"||Ce==="fakeround"){const ue=-Math.sqrt($t*$t-1),_e=ye?ue:0,Re=ye?0:ue;if(Q&&this.addCurrentVertex(Y,dt,_e,Re,j),Ce==="fakeround"){const Ve=Math.round(180*te/Math.PI/20);for(let Be=1;Be<Ve;Be++){let Ue=Be/Ve;if(Ue!==.5){const Hn=Ue-.5;Ue+=Ue*Hn*(Ue-1)*((1.0904+Xt*(Xt*(3.55645-1.43519*Xt)-3.2452))*Hn*Hn+(.848013+Xt*(.215638*Xt-1.06021)))}const Cn=mt.sub(dt)._mult(Ue)._add(dt)._unit()._mult(ye?-1:1);this.addHalfVertex(Y,Cn.x,Cn.y,!1,ye,0,j)}}ot&&this.addCurrentVertex(Y,mt,-_e,-Re,j)}else if(Ce==="butt")this.addCurrentVertex(Y,Ot,0,0,j);else if(Ce==="square"){const ue=Q?1:-1;Q||this.addCurrentVertex(Y,Ot,ue,ue,j),this.addCurrentVertex(Y,Ot,0,0,j),Q&&this.addCurrentVertex(Y,Ot,ue,ue,j)}else Ce==="round"&&(Q&&(this.addCurrentVertex(Y,dt,0,0,j),this.addCurrentVertex(Y,dt,1,1,j,!0)),ot&&(this.addCurrentVertex(Y,mt,-1,-1,j,!0),this.addCurrentVertex(Y,mt,0,0,j)));if(me&&Tt<L-1){const ue=Y.dist(ot);if(ue>2*N){const _e=Y.add(ot.sub(Y)._mult(N/ue)._round());this.updateDistance(Y,_e),this.addCurrentVertex(_e,mt,0,0,j),Y=_e}}}}addCurrentVertex(i,c,d,g,_,E=!1){const S=c.y*g-c.x,L=-c.y-c.x*g;this.addHalfVertex(i,c.x+c.y*d,c.y-c.x*d,E,!1,d,_),this.addHalfVertex(i,S,L,E,!0,-g,_)}addHalfVertex({x:i,y:c},d,g,_,E,S,L){this.layoutVertexArray.emplaceBack((i<<1)+(_?1:0),(c<<1)+(E?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const B=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),L.primitiveLength++),E?this.e2=B:this.e1=B}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,c){this.distance+=i.dist(c),this.updateScaledDistance()}}Ke(qy,"LineBucket",{omit:["layers","patternFeatures"]});const rG=new it({"line-cap":new F(Dt.layout_line["line-cap"]),"line-join":new F(Dt.layout_line["line-join"]),"line-miter-limit":new I(Dt.layout_line["line-miter-limit"]),"line-round-limit":new I(Dt.layout_line["line-round-limit"]),"line-sort-key":new F(Dt.layout_line["line-sort-key"])});var y2={paint:new it({"line-opacity":new F(Dt.paint_line["line-opacity"]),"line-color":new F(Dt.paint_line["line-color"]),"line-translate":new I(Dt.paint_line["line-translate"]),"line-translate-anchor":new I(Dt.paint_line["line-translate-anchor"]),"line-width":new F(Dt.paint_line["line-width"]),"line-gap-width":new F(Dt.paint_line["line-gap-width"]),"line-offset":new F(Dt.paint_line["line-offset"]),"line-blur":new F(Dt.paint_line["line-blur"]),"line-dasharray":new q(Dt.paint_line["line-dasharray"]),"line-pattern":new q(Dt.paint_line["line-pattern"]),"line-gradient":new J(Dt.paint_line["line-gradient"])}),layout:rG};const x2=new class extends F{possiblyEvaluate(l,i){return i=new mi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(l,i)}evaluate(l,i,c,d){return i=st({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(l,i,c,d)}}(y2.paint.properties["line-width"].specification);function v2(l,i){return i>0?i+2*l:l}x2.useIntegerZoom=!0;const oG=Ft([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),sG=Ft([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ft([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aG=Ft([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),lG=Ft([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const _2=Ft([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cG=Ft([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ft([{name:"triangle",components:3,type:"Uint16"}]),Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ft([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ft([{type:"Float32",name:"offsetX"}]),Ft([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var dr=24;const Ls=128;function vv(l,i){const{expression:c}=i;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new mi(l+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let _=0;for(;_<d.length&&d[_]<=l;)_++;_=Math.max(0,_-1);let E=_;for(;E<d.length&&d[E]<l+1;)E++;E=Math.min(d.length-1,E);const S=d[_],L=d[E];return c.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:L,interpolationType:g}:{kind:"camera",minZoom:S,maxZoom:L,minSize:c.evaluate(new mi(S)),maxSize:c.evaluate(new mi(L)),interpolationType:g}}}function Yy(l,{uSize:i,uSizeT:c},{lowerSize:d,upperSize:g}){return l.kind==="source"?d/Ls:l.kind==="composite"?bn(d/Ls,g/Ls,c):i}function Th(l,i){let c=0,d=0;if(l.kind==="constant")d=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:g,minZoom:_,maxZoom:E}=l,S=g?W(zr.interpolationFactor(g,i,_,E),0,1):0;l.kind==="camera"?d=bn(l.minSize,l.maxSize,S):c=S}return{uSizeT:c,uSize:d}}var uG=Object.freeze({__proto__:null,getSizeData:vv,evaluateSizeForFeature:Yy,evaluateSizeForZoom:Th,SIZE_PACK_FACTOR:Ls});function hG(l,i,c){return l.sections.forEach(d=>{d.text=function(g,_,E){const S=_.layout.get("text-transform").evaluate(E,{});return S==="uppercase"?g=g.toLocaleUpperCase():S==="lowercase"&&(g=g.toLocaleLowerCase()),eo.applyArabicShaping&&(g=eo.applyArabicShaping(g)),g}(d.text,i,c)}),l}const mf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function dG(l){return l==="︶"||l==="﹈"||l==="︸"||l==="﹄"||l==="﹂"||l==="︾"||l==="︼"||l==="︺"||l==="︘"||l==="﹀"||l==="︐"||l==="︓"||l==="︔"||l==="｀"||l==="￣"||l==="︑"||l==="︒"}function pG(l){return l==="︵"||l==="﹇"||l==="︷"||l==="﹃"||l==="﹁"||l==="︽"||l==="︻"||l==="︹"||l==="︗"||l==="︿"}var b2=function(l,i,c,d,g){var _,E,S=8*g-d-1,L=(1<<S)-1,B=L>>1,N=-7,j=c?g-1:0,Y=c?-1:1,Q=l[i+j];for(j+=Y,_=Q&(1<<-N)-1,Q>>=-N,N+=S;N>0;_=256*_+l[i+j],j+=Y,N-=8);for(E=_&(1<<-N)-1,_>>=-N,N+=d;N>0;E=256*E+l[i+j],j+=Y,N-=8);if(_===0)_=1-B;else{if(_===L)return E?NaN:1/0*(Q?-1:1);E+=Math.pow(2,d),_-=B}return(Q?-1:1)*E*Math.pow(2,_-d)},M2=function(l,i,c,d,g,_){var E,S,L,B=8*_-g-1,N=(1<<B)-1,j=N>>1,Y=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Q=d?0:_-1,ot=d?1:-1,dt=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(S=isNaN(i)?1:0,E=N):(E=Math.floor(Math.log(i)/Math.LN2),i*(L=Math.pow(2,-E))<1&&(E--,L*=2),(i+=E+j>=1?Y/L:Y*Math.pow(2,1-j))*L>=2&&(E++,L/=2),E+j>=N?(S=0,E=N):E+j>=1?(S=(i*L-1)*Math.pow(2,g),E+=j):(S=i*Math.pow(2,j-1)*Math.pow(2,g),E=0));g>=8;l[c+Q]=255&S,Q+=ot,S/=256,g-=8);for(E=E<<g|S,B+=g;B>0;l[c+Q]=255&E,Q+=ot,E/=256,B-=8);l[c+Q-ot]|=128*dt},gf=pi;function pi(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}pi.Varint=0,pi.Fixed64=1,pi.Bytes=2,pi.Fixed32=5;var _v=4294967296,w2=1/_v,A2=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function da(l){return l.type===pi.Bytes?l.readVarint()+l.pos:l.pos+1}function Ph(l,i,c){return c?4294967296*i+(l>>>0):4294967296*(i>>>0)+(l>>>0)}function E2(l,i,c){var d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=l;g--)c.buf[g+d]=c.buf[g]}function fG(l,i){for(var c=0;c<l.length;c++)i.writeVarint(l[c])}function mG(l,i){for(var c=0;c<l.length;c++)i.writeSVarint(l[c])}function gG(l,i){for(var c=0;c<l.length;c++)i.writeFloat(l[c])}function yG(l,i){for(var c=0;c<l.length;c++)i.writeDouble(l[c])}function xG(l,i){for(var c=0;c<l.length;c++)i.writeBoolean(l[c])}function vG(l,i){for(var c=0;c<l.length;c++)i.writeFixed32(l[c])}function _G(l,i){for(var c=0;c<l.length;c++)i.writeSFixed32(l[c])}function bG(l,i){for(var c=0;c<l.length;c++)i.writeFixed64(l[c])}function MG(l,i){for(var c=0;c<l.length;c++)i.writeSFixed64(l[c])}function Xy(l,i){return(l[i]|l[i+1]<<8|l[i+2]<<16)+16777216*l[i+3]}function Sh(l,i,c){l[c]=i,l[c+1]=i>>>8,l[c+2]=i>>>16,l[c+3]=i>>>24}function T2(l,i){return(l[i]|l[i+1]<<8|l[i+2]<<16)+(l[i+3]<<24)}function wG(l,i,c){i.glyphs=[],l===1&&c.readMessage(AG,i)}function AG(l,i,c){if(l===3){const{id:d,bitmap:g,width:_,height:E,left:S,top:L,advance:B}=c.readMessage(EG,{});i.glyphs.push({id:d,bitmap:new ha({width:_+6,height:E+6},g),metrics:{width:_,height:E,left:S,top:L,advance:B}})}else l===4?i.ascender=c.readSVarint():l===5&&(i.descender=c.readSVarint())}function EG(l,i,c){l===1?i.id=c.readVarint():l===2?i.bitmap=c.readBytes():l===3?i.width=c.readVarint():l===4?i.height=c.readVarint():l===5?i.left=c.readSVarint():l===6?i.top=c.readSVarint():l===7&&(i.advance=c.readVarint())}function bv(l){let i=0,c=0;for(const E of l)i+=E.w*E.h,c=Math.max(c,E.w);l.sort((E,S)=>S.h-E.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),c),h:1/0}];let g=0,_=0;for(const E of l)for(let S=d.length-1;S>=0;S--){const L=d[S];if(!(E.w>L.w||E.h>L.h)){if(E.x=L.x,E.y=L.y,_=Math.max(_,E.y+E.h),g=Math.max(g,E.x+E.w),E.w===L.w&&E.h===L.h){const B=d.pop();S<d.length&&(d[S]=B)}else E.h===L.h?(L.x+=E.w,L.w-=E.w):E.w===L.w?(L.y+=E.h,L.h-=E.h):(d.push({x:L.x+E.w,y:L.y,w:L.w-E.w,h:E.h}),L.y+=E.h,L.h-=E.h);break}}return{w:g,h:_,fill:i/(g*_)||0}}pi.prototype={destroy:function(){this.buf=null},readFields:function(l,i,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,_=this.pos;this.type=7&d,l(g,i,this),this.pos===_&&this.skip(d)}return i},readMessage:function(l,i){return this.readFields(l,i,this.readVarint()+this.pos)},readFixed32:function(){var l=Xy(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=T2(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=Xy(this.buf,this.pos)+Xy(this.buf,this.pos+4)*_v;return this.pos+=8,l},readSFixed64:function(){var l=Xy(this.buf,this.pos)+T2(this.buf,this.pos+4)*_v;return this.pos+=8,l},readFloat:function(){var l=b2(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=b2(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var i,c,d=this.buf;return i=127&(c=d[this.pos++]),c<128?i:(i|=(127&(c=d[this.pos++]))<<7,c<128?i:(i|=(127&(c=d[this.pos++]))<<14,c<128?i:(i|=(127&(c=d[this.pos++]))<<21,c<128?i:function(g,_,E){var S,L,B=E.buf;if(S=(112&(L=B[E.pos++]))>>4,L<128||(S|=(127&(L=B[E.pos++]))<<3,L<128)||(S|=(127&(L=B[E.pos++]))<<10,L<128)||(S|=(127&(L=B[E.pos++]))<<17,L<128)||(S|=(127&(L=B[E.pos++]))<<24,L<128)||(S|=(1&(L=B[E.pos++]))<<31,L<128))return Ph(g,S,_);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(c=d[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,i=this.pos;return this.pos=l,l-i>=12&&A2?function(c,d,g){return A2.decode(c.subarray(d,g))}(this.buf,i,l):function(c,d,g){for(var _="",E=d;E<g;){var S,L,B,N=c[E],j=null,Y=N>239?4:N>223?3:N>191?2:1;if(E+Y>g)break;Y===1?N<128&&(j=N):Y===2?(192&(S=c[E+1]))==128&&(j=(31&N)<<6|63&S)<=127&&(j=null):Y===3?(L=c[E+2],(192&(S=c[E+1]))==128&&(192&L)==128&&((j=(15&N)<<12|(63&S)<<6|63&L)<=2047||j>=55296&&j<=57343)&&(j=null)):Y===4&&(L=c[E+2],B=c[E+3],(192&(S=c[E+1]))==128&&(192&L)==128&&(192&B)==128&&((j=(15&N)<<18|(63&S)<<12|(63&L)<<6|63&B)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,Y=1):j>65535&&(j-=65536,_+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),_+=String.fromCharCode(j),E+=Y}return _}(this.buf,i,l)},readBytes:function(){var l=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,l);return this.pos=l,i},readPackedVarint:function(l,i){if(this.type!==pi.Bytes)return l.push(this.readVarint(i));var c=da(this);for(l=l||[];this.pos<c;)l.push(this.readVarint(i));return l},readPackedSVarint:function(l){if(this.type!==pi.Bytes)return l.push(this.readSVarint());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==pi.Bytes)return l.push(this.readBoolean());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==pi.Bytes)return l.push(this.readFloat());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==pi.Bytes)return l.push(this.readDouble());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==pi.Bytes)return l.push(this.readFixed32());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==pi.Bytes)return l.push(this.readSFixed32());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==pi.Bytes)return l.push(this.readFixed64());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==pi.Bytes)return l.push(this.readSFixed64());var i=da(this);for(l=l||[];this.pos<i;)l.push(this.readSFixed64());return l},skip:function(l){var i=7&l;if(i===pi.Varint)for(;this.buf[this.pos++]>127;);else if(i===pi.Bytes)this.pos=this.readVarint()+this.pos;else if(i===pi.Fixed32)this.pos+=4;else{if(i!==pi.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(l,i){this.writeVarint(l<<3|i)},realloc:function(l){for(var i=this.length||16;i<this.pos+l;)i*=2;if(i!==this.length){var c=new Uint8Array(i);c.set(this.buf),this.buf=c,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Sh(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Sh(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Sh(this.buf,-1&l,this.pos),Sh(this.buf,Math.floor(l*w2),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Sh(this.buf,-1&l,this.pos),Sh(this.buf,Math.floor(l*w2),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(i,c){var d,g;if(i>=0?(d=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(d=~(-i%4294967296))?d=d+1|0:(d=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(_,E,S){S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,S.buf[S.pos]=127&(_>>>=7)}(d,0,c),function(_,E){var S=(7&_)<<4;E.buf[E.pos++]|=S|((_>>>=3)?128:0),_&&(E.buf[E.pos++]=127&_|((_>>>=7)?128:0),_&&(E.buf[E.pos++]=127&_|((_>>>=7)?128:0),_&&(E.buf[E.pos++]=127&_|((_>>>=7)?128:0),_&&(E.buf[E.pos++]=127&_|((_>>>=7)?128:0),_&&(E.buf[E.pos++]=127&_)))))}(g,c)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var i=this.pos;this.pos=function(d,g,_){for(var E,S,L=0;L<g.length;L++){if((E=g.charCodeAt(L))>55295&&E<57344){if(!S){E>56319||L+1===g.length?(d[_++]=239,d[_++]=191,d[_++]=189):S=E;continue}if(E<56320){d[_++]=239,d[_++]=191,d[_++]=189,S=E;continue}E=S-55296<<10|E-56320|65536,S=null}else S&&(d[_++]=239,d[_++]=191,d[_++]=189,S=null);E<128?d[_++]=E:(E<2048?d[_++]=E>>6|192:(E<65536?d[_++]=E>>12|224:(d[_++]=E>>18|240,d[_++]=E>>12&63|128),d[_++]=E>>6&63|128),d[_++]=63&E|128)}return _}(this.buf,l,this.pos);var c=this.pos-i;c>=128&&E2(i,c,this),this.pos=i-1,this.writeVarint(c),this.pos+=c},writeFloat:function(l){this.realloc(4),M2(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),M2(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var i=l.length;this.writeVarint(i),this.realloc(i);for(var c=0;c<i;c++)this.buf[this.pos++]=l[c]},writeRawMessage:function(l,i){this.pos++;var c=this.pos;l(i,this);var d=this.pos-c;d>=128&&E2(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(l,i,c){this.writeTag(l,pi.Bytes),this.writeRawMessage(i,c)},writePackedVarint:function(l,i){i.length&&this.writeMessage(l,fG,i)},writePackedSVarint:function(l,i){i.length&&this.writeMessage(l,mG,i)},writePackedBoolean:function(l,i){i.length&&this.writeMessage(l,xG,i)},writePackedFloat:function(l,i){i.length&&this.writeMessage(l,gG,i)},writePackedDouble:function(l,i){i.length&&this.writeMessage(l,yG,i)},writePackedFixed32:function(l,i){i.length&&this.writeMessage(l,vG,i)},writePackedSFixed32:function(l,i){i.length&&this.writeMessage(l,_G,i)},writePackedFixed64:function(l,i){i.length&&this.writeMessage(l,bG,i)},writePackedSFixed64:function(l,i){i.length&&this.writeMessage(l,MG,i)},writeBytesField:function(l,i){this.writeTag(l,pi.Bytes),this.writeBytes(i)},writeFixed32Field:function(l,i){this.writeTag(l,pi.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(l,i){this.writeTag(l,pi.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(l,i){this.writeTag(l,pi.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(l,i){this.writeTag(l,pi.Fixed64),this.writeSFixed64(i)},writeVarintField:function(l,i){this.writeTag(l,pi.Varint),this.writeVarint(i)},writeSVarintField:function(l,i){this.writeTag(l,pi.Varint),this.writeSVarint(i)},writeStringField:function(l,i){this.writeTag(l,pi.Bytes),this.writeString(i)},writeFloatField:function(l,i){this.writeTag(l,pi.Fixed32),this.writeFloat(i)},writeDoubleField:function(l,i){this.writeTag(l,pi.Fixed64),this.writeDouble(i)},writeBooleanField:function(l,i){this.writeVarintField(l,!!i)}};class Mv{constructor(i,{pixelRatio:c,version:d,stretchX:g,stretchY:_,content:E}){this.paddedRect=i,this.pixelRatio=c,this.stretchX=g,this.stretchY=_,this.content=E,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class P2{constructor(i,c){const d={},g={};this.haveRenderCallbacks=[];const _=[];this.addImages(i,d,_),this.addImages(c,g,_);const{w:E,h:S}=bv(_),L=new ro({width:E||1,height:S||1});for(const B in i){const N=i[B],j=d[B].paddedRect;ro.copy(N.data,L,{x:0,y:0},{x:j.x+1,y:j.y+1},N.data)}for(const B in c){const N=c[B],j=g[B].paddedRect,Y=j.x+1,Q=j.y+1,ot=N.data.width,dt=N.data.height;ro.copy(N.data,L,{x:0,y:0},{x:Y,y:Q},N.data),ro.copy(N.data,L,{x:0,y:dt-1},{x:Y,y:Q-1},{width:ot,height:1}),ro.copy(N.data,L,{x:0,y:0},{x:Y,y:Q+dt},{width:ot,height:1}),ro.copy(N.data,L,{x:ot-1,y:0},{x:Y-1,y:Q},{width:1,height:dt}),ro.copy(N.data,L,{x:0,y:0},{x:Y+ot,y:Q},{width:1,height:dt})}this.image=L,this.iconPositions=d,this.patternPositions=g}addImages(i,c,d){for(const g in i){const _=i[g],E={x:0,y:0,w:_.data.width+2,h:_.data.height+2};d.push(E),c[g]=new Mv(E,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(d=>i.hasImage(d)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in i.updatedImages)this.patchUpdatedImage(this.iconPositions[d],i.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d),c)}patchUpdatedImage(i,c,d){if(!i||!c||i.version===c.version)return;i.version=c.version;const[g,_]=i.tl;d.update(c.data,void 0,{x:g,y:_})}}Ke(Mv,"ImagePosition"),Ke(P2,"ImageAtlas");const To={horizontal:1,vertical:2,horizontalOnly:3};class yf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,c){const d=new yf;return d.scale=i||1,d.fontStack=c,d}static forImage(i){const c=new yf;return c.imageName=i,c}}class Ch{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,c){const d=new Ch;for(let g=0;g<i.sections.length;g++){const _=i.sections[g];_.image?d.addImageSection(_):d.addTextSection(_,c)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(c,d){let g="";for(let _=0;_<c.length;_++){const E=c.charCodeAt(_+1)||null,S=c.charCodeAt(_-1)||null;g+=!d&&(E&&fh(E)&&!mf[c[_+1]]||S&&fh(S)&&!mf[c[_-1]])||!mf[c[_]]?c[_]:mf[c[_]]}return g}(this.text,i)}trim(){let i=0;for(let d=0;d<this.text.length&&Ky[this.text.charCodeAt(d)];d++)i++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&Ky[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(i,c),this.sectionIndex=this.sectionIndex.slice(i,c)}substring(i,c){const d=new Ch;return d.text=this.text.substring(i,c),d.sectionIndex=this.sectionIndex.slice(i,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,c)=>Math.max(i,this.sections[c].scale),0)}addTextSection(i,c){this.text+=i.text,this.sections.push(yf.forText(i.scale,i.fontStack||c));const d=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(d)}addImageSection(i){const c=i.image?i.image.name:"";if(c.length===0)return void bt("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(yf.forImage(c)),this.sectionIndex.push(this.sections.length-1)):bt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wv(l,i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt){const mt=Ch.fromFeature(l,g);let Tt;j===To.vertical&&mt.verticalizePunctuation(Y);const{processBidirectionalText:Ot,processStyledBidirectionalText:Xt}=eo;if(Ot&&mt.sections.length===1){Tt=[];const te=Ot(mt.toString(),Av(mt,B,_,i,d,Q,ot));for(const me of te){const ye=new Ch;ye.text=me,ye.sections=mt.sections;for(let Ae=0;Ae<me.length;Ae++)ye.sectionIndex.push(0);Tt.push(ye)}}else if(Xt){Tt=[];const te=Xt(mt.text,mt.sectionIndex,Av(mt,B,_,i,d,Q,ot));for(const me of te){const ye=new Ch;ye.text=me[0],ye.sectionIndex=me[1],ye.sections=mt.sections,Tt.push(ye)}}else Tt=function(te,me){const ye=[],Ae=te.text;let Ce=0;for(const ue of me)ye.push(te.substring(Ce,ue)),Ce=ue;return Ce<Ae.length&&ye.push(te.substring(Ce,Ae.length)),ye}(mt,Av(mt,B,_,i,d,Q,ot));const Qt=[],$t={positionedLines:Qt,text:mt.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:j,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(te,me,ye,Ae,Ce,ue,_e,Re,Ve,Be,Ue,Cn){let Hn=0,Rn=0,Vn=0;const nn=Re==="right"?1:Re==="left"?0:.5;let Xe=!1;for(const ni of Ce){const Yn=ni.getSections();for(const ai of Yn){if(ai.imageName)continue;const Si=me[ai.fontStack];if(Si&&(Xe=Si.ascender!==void 0&&Si.descender!==void 0,!Xe))break}if(!Xe)break}let Wn=0;for(const ni of Ce){ni.trim();const Yn=ni.getMaxScale(),ai=(Yn-1)*dr,Si={positionedGlyphs:[],lineOffset:0};te.positionedLines[Wn]=Si;const Li=Si.positionedGlyphs;let qi=0;if(!ni.length()){Rn+=ue,++Wn;continue}let nr=0,ao=0;for(let li=0;li<ni.length();li++){const Pr=ni.getSection(li),lo=ni.getSectionIndex(li),ar=ni.getCharCode(li);let ir=Pr.scale,_i=null,yi=null,Hr=null,Sr=dr,Ui=0;const Cr=!(Ve===To.horizontal||!Ue&&!ph(ar)||Ue&&(Ky[ar]||(ei=ar,my(ei)||lh(ei)||uc(ei)||Wp(ei)||hh(ei))));if(Pr.imageName){const vr=Ae[Pr.imageName];if(!vr)continue;Hr=Pr.imageName,te.iconsInText=te.iconsInText||!0,yi=vr.paddedRect;const rr=vr.displaySize;ir=ir*dr/Cn,_i={width:rr[0],height:rr[1],left:1,top:-3,advance:Cr?rr[1]:rr[0],localGlyph:!1},Ui=Xe?-_i.height*ir:Yn*dr-17-rr[1]*ir,Sr=_i.advance;const Fo=(Cr?rr[0]:rr[1])*ir-dr*Yn;Fo>0&&Fo>qi&&(qi=Fo)}else{const vr=ye[Pr.fontStack];if(!vr)continue;vr[ar]&&(yi=vr[ar]);const rr=me[Pr.fontStack];if(!rr)continue;const Fo=rr.glyphs[ar];if(!Fo)continue;if(_i=Fo.metrics,Sr=ar!==8203?dr:0,Xe){const pl=rr.ascender!==void 0?Math.abs(rr.ascender):0,Pf=rr.descender!==void 0?Math.abs(rr.descender):0,Sf=(pl+Pf)*ir;nr<Sf&&(nr=Sf,ao=(pl-Pf)/2*ir),Ui=-pl*ir}else Ui=(Yn-ir)*dr-17}Cr?(te.verticalizable=!0,Li.push({glyph:ar,imageName:Hr,x:Hn,y:Rn+Ui,vertical:Cr,scale:ir,localGlyph:_i.localGlyph,fontStack:Pr.fontStack,sectionIndex:lo,metrics:_i,rect:yi}),Hn+=Sr*ir+Be):(Li.push({glyph:ar,imageName:Hr,x:Hn,y:Rn+Ui,vertical:Cr,scale:ir,localGlyph:_i.localGlyph,fontStack:Pr.fontStack,sectionIndex:lo,metrics:_i,rect:yi}),Hn+=_i.advance*ir+Be)}Li.length!==0&&(Vn=Math.max(Hn-Be,Vn),Xe?L2(Li,nn,qi,ao,ue*Yn/2):L2(Li,nn,qi,0,ue/2)),Hn=0;const jr=ue*Yn+qi;Si.lineOffset=Math.max(qi,ai),Rn+=jr,++Wn}var ei;const Hi=Rn,{horizontalAlign:gi,verticalAlign:Wi}=Ev(_e);(function(ni,Yn,ai,Si,Li,qi){const nr=(Yn-ai)*Li,ao=-qi*Si;for(const jr of ni)for(const li of jr.positionedGlyphs)li.x+=nr,li.y+=ao})(te.positionedLines,nn,gi,Wi,Vn,Hi),te.top+=-Wi*Hi,te.bottom=te.top+Hi,te.left+=-gi*Vn,te.right=te.left+Vn,te.hasBaseline=Xe}($t,i,c,d,Tt,E,S,L,j,B,Y,dt),!function(te){for(const me of te)if(me.positionedGlyphs.length!==0)return!1;return!0}(Qt)&&$t}const Ky={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TG={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function S2(l,i,c,d,g,_){if(i.imageName){const E=d[i.imageName];return E?E.displaySize[0]*i.scale*dr/_+g:0}{const E=c[i.fontStack],S=E&&E.glyphs[l];return S?S.metrics.advance*i.scale+g:0}}function C2(l,i,c,d){const g=Math.pow(l-i,2);return d?l<i?g/2:2*g:g+Math.abs(c)*c}function PG(l,i,c){let d=0;return l===10&&(d-=1e4),c&&(d+=150),l!==40&&l!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function D2(l,i,c,d,g,_){let E=null,S=C2(i,c,g,_);for(const L of d){const B=C2(i-L.x,c,g,_)+L.badness;B<=S&&(E=L,S=B)}return{index:l,x:i,priorBreak:E,badness:S}}function R2(l){return l?R2(l.priorBreak).concat(l.index):[]}function Av(l,i,c,d,g,_,E){if(_!=="point")return[];if(!l)return[];const S=[],L=function(Y,Q,ot,dt,mt,Tt){let Ot=0;for(let Xt=0;Xt<Y.length();Xt++){const Qt=Y.getSection(Xt);Ot+=S2(Y.getCharCode(Xt),Qt,dt,mt,Q,Tt)}return Ot/Math.max(1,Math.ceil(Ot/ot))}(l,i,c,d,g,E),B=l.text.indexOf("​")>=0;let N=0;for(let Y=0;Y<l.length();Y++){const Q=l.getSection(Y),ot=l.getCharCode(Y);if(Ky[ot]||(N+=S2(ot,Q,d,g,i,E)),Y<l.length()-1){const dt=!((j=ot)<11904||!(xy(j)||yy(j)||Qa(j)||dc(j)||by(j)||Gp(j)||vy(j)||ch(j)||My(j)||Hp(j)||_y(j)||qp(j)||hc(j)||Op(j)||gy(j)||jp(j)||uh(j)||Ty(j)||Ay(j)||wy(j)));(TG[ot]||dt||Q.imageName)&&S.push(D2(Y+1,N,L,S,PG(ot,l.getCharCode(Y+1),dt&&B),!1))}}var j;return R2(D2(l.length(),N,L,S,0,!0))}function Ev(l){let i=.5,c=.5;switch(l){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:i,verticalAlign:c}}function L2(l,i,c,d,g){if(!(i||c||d||g))return;const _=l.length-1,E=l[_],S=(E.x+E.metrics.advance*E.scale)*i;for(let L=0;L<=_;L++)l[L].x-=S,l[L].y+=c+d+g}function SG(l,i,c){const{horizontalAlign:d,verticalAlign:g}=Ev(c),_=i[0]-l.displaySize[0]*d,E=i[1]-l.displaySize[1]*g;return{image:l,top:E,bottom:E+l.displaySize[1],left:_,right:_+l.displaySize[0]}}function I2(l,i,c,d,g,_){const E=l.image;let S;if(E.content){const mt=E.content,Tt=E.pixelRatio||1;S=[mt[0]/Tt,mt[1]/Tt,E.displaySize[0]-mt[2]/Tt,E.displaySize[1]-mt[3]/Tt]}const L=i.left*_,B=i.right*_;let N,j,Y,Q;c==="width"||c==="both"?(Q=g[0]+L-d[3],j=g[0]+B+d[1]):(Q=g[0]+(L+B-E.displaySize[0])/2,j=Q+E.displaySize[0]);const ot=i.top*_,dt=i.bottom*_;return c==="height"||c==="both"?(N=g[1]+ot-d[0],Y=g[1]+dt+d[2]):(N=g[1]+(ot+dt-E.displaySize[1])/2,Y=N+E.displaySize[1]),{image:E,top:N,right:j,bottom:Y,left:Q,collisionPadding:S}}class pa extends M{constructor(i,c,d,g,_){super(i,c),this.angle=g,this.z=d,_!==void 0&&(this.segment=_)}clone(){return new pa(this.x,this.y,this.z,this.angle,this.segment)}}function k2(l,i,c,d,g){if(i.segment===void 0)return!0;let _=i,E=i.segment+1,S=0;for(;S>-c/2;){if(E--,E<0)return!1;S-=l[E].dist(_),_=l[E]}S+=l[E].dist(l[E+1]),E++;const L=[];let B=0;for(;S<c/2;){const N=l[E],j=l[E+1];if(!j)return!1;let Y=l[E-1].angleTo(N)-N.angleTo(j);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:S,angleDelta:Y}),B+=Y;S-L[0].distance>d;)B-=L.shift().angleDelta;if(B>g)return!1;E++,S+=N.dist(j)}return!0}function B2(l){let i=0;for(let c=0;c<l.length-1;c++)i+=l[c].dist(l[c+1]);return i}function F2(l,i,c){return l?.6*i*c:0}function z2(l,i){return Math.max(l?l.right-l.left:0,i?i.right-i.left:0)}function CG(l,i,c,d,g,_){const E=F2(c,g,_),S=z2(c,d)*_;let L=0;const B=B2(l)/2;for(let N=0;N<l.length-1;N++){const j=l[N],Y=l[N+1],Q=j.dist(Y);if(L+Q>B){const ot=(B-L)/Q,dt=bn(j.x,Y.x,ot),mt=bn(j.y,Y.y,ot),Tt=new pa(dt,mt,0,Y.angleTo(j),N);return!E||k2(l,Tt,S,E,i)?Tt:void 0}L+=Q}}function DG(l,i,c,d,g,_,E,S,L){const B=F2(d,_,E),N=z2(d,g),j=N*E,Y=l[0].x===0||l[0].x===L||l[0].y===0||l[0].y===L;return i-j<i/4&&(i=j+i/4),N2(l,Y?i/2*S%i:(N/2+2*_)*E*S%i,i,B,c,j,Y,!1,L)}function N2(l,i,c,d,g,_,E,S,L){const B=_/2,N=B2(l);let j=0,Y=i-c,Q=[];for(let ot=0;ot<l.length-1;ot++){const dt=l[ot],mt=l[ot+1],Tt=dt.dist(mt),Ot=mt.angleTo(dt);for(;Y+c<j+Tt;){Y+=c;const Xt=(Y-j)/Tt,Qt=bn(dt.x,mt.x,Xt),$t=bn(dt.y,mt.y,Xt);if(Qt>=0&&Qt<L&&$t>=0&&$t<L&&Y-B>=0&&Y+B<=N){const te=new pa(Qt,$t,0,Ot,ot);te._round(),d&&!k2(l,te,_,d,g)||Q.push(te)}}j+=Tt}return S||Q.length||E||(Q=N2(l,j/2,c,d,g,_,E,!0,L)),Q}function U2(l,i,c,d,g){const _=[];for(let E=0;E<l.length;E++){const S=l[E];let L;for(let B=0;B<S.length-1;B++){let N=S[B],j=S[B+1];N.x<i&&j.x<i||(N.x<i?N=new M(i,N.y+(i-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x<i&&(j=new M(i,N.y+(i-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y<c&&j.y<c||(N.y<c?N=new M(N.x+(c-N.y)/(j.y-N.y)*(j.x-N.x),c)._round():j.y<c&&(j=new M(N.x+(c-N.y)/(j.y-N.y)*(j.x-N.x),c)._round()),N.x>=d&&j.x>=d||(N.x>=d?N=new M(d,N.y+(d-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x>=d&&(j=new M(d,N.y+(d-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y>=g&&j.y>=g||(N.y>=g?N=new M(N.x+(g-N.y)/(j.y-N.y)*(j.x-N.x),g)._round():j.y>=g&&(j=new M(N.x+(g-N.y)/(j.y-N.y)*(j.x-N.x),g)._round()),L&&N.equals(L[L.length-1])||(L=[N],_.push(L)),L.push(j)))))}}return _}Ke(pa,"Anchor");const xf=1e20;function V2(l,i,c,d,g,_,E,S,L){for(let B=i;B<i+d;B++)G2(l,c*_+B,_,g,E,S,L);for(let B=c;B<c+g;B++)G2(l,B*_+i,1,d,E,S,L)}function G2(l,i,c,d,g,_,E){_[0]=0,E[0]=-xf,E[1]=xf,g[0]=l[i];for(let S=1,L=0,B=0;S<d;S++){g[S]=l[i+S*c];const N=S*S;do{const j=_[L];B=(g[S]-g[j]+N-j*j)/(S-j)/2}while(B<=E[L]&&--L>-1);L++,_[L]=S,E[L]=B,E[L+1]=xf}for(let S=0,L=0;S<d;S++){for(;E[L+1]<S;)L++;const B=_[L],N=S-B;l[i+S*c]=g[B]+N*N}}const Tv={none:0,ideographs:1,all:2};class Dh{constructor(i,c,d){this.requestManager=i,this.localGlyphMode=c,this.localFontFamily=d,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,c){const d=[];for(const g in i)for(const _ of i[g])d.push({stack:g,id:_});tt(d,({stack:g,id:_},E)=>{let S=this.entries[g];S||(S=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let L=S.glyphs[_];if(L!==void 0)return void E(null,{stack:g,id:_,glyph:L});if(L=this._tinySDF(S,g,_),L)return S.glyphs[_]=L,void E(null,{stack:g,id:_,glyph:L});const B=Math.floor(_/256);if(256*B>65535)return void E(new Error("glyphs > 65535 not supported"));if(S.ranges[B])return void E(null,{stack:g,id:_,glyph:L});let N=S.requests[B];N||(N=S.requests[B]=[],Dh.loadGlyphRange(g,B,this.url,this.requestManager,(j,Y)=>{if(Y){S.ascender=Y.ascender,S.descender=Y.descender;for(const Q in Y.glyphs)this._doesCharSupportLocalGlyph(+Q)||(S.glyphs[+Q]=Y.glyphs[+Q]);S.ranges[B]=!0}for(const Q of N)Q(j,Y);delete S.requests[B]})),N.push((j,Y)=>{j?E(j):Y&&E(null,{stack:g,id:_,glyph:Y.glyphs[_]||null})})},(g,_)=>{if(g)c(g);else if(_){const E={};for(const{stack:S,id:L,glyph:B}of _)E[S]===void 0&&(E[S]={}),E[S].glyphs===void 0&&(E[S].glyphs={}),E[S].glyphs[L]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics},E[S].ascender=this.entries[S].ascender,E[S].descender=this.entries[S].descender;c(null,E)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Tv.none&&(this.localGlyphMode===Tv.all?!!this.localFontFamily:!!this.localFontFamily&&(Hp(i)||Ey(i)||hc(i)||uh(i)||ch(i)))}_tinySDF(i,c,d){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let _=i.tinySDF;if(!_){let dt="400";/bold/i.test(c)?dt="900":/medium/i.test(c)?dt="500":/light/i.test(c)&&(dt="200"),_=i.tinySDF=new Dh.TinySDF({fontFamily:g,fontWeight:dt,fontSize:48,buffer:6,radius:16}),_.fontWeight=dt}if(this.localGlyphs[_.fontWeight][d])return this.localGlyphs[_.fontWeight][d];const E=String.fromCharCode(d),{data:S,width:L,height:B,glyphWidth:N,glyphHeight:j,glyphLeft:Y,glyphTop:Q,glyphAdvance:ot}=_.draw(E);return this.localGlyphs[_.fontWeight][d]={id:d,bitmap:new ha({width:L,height:B},S),metrics:{width:N/2,height:j/2,left:Y/2,top:Q/2-27,advance:ot/2,localGlyph:!0}}}}function O2(l,i,c,d){const g=[],_=l.image,E=_.pixelRatio,S=_.paddedRect.w-2,L=_.paddedRect.h-2,B=l.right-l.left,N=l.bottom-l.top,j=_.stretchX||[[0,S]],Y=_.stretchY||[[0,L]],Q=(ue,_e)=>ue+_e[1]-_e[0],ot=j.reduce(Q,0),dt=Y.reduce(Q,0),mt=S-ot,Tt=L-dt;let Ot=0,Xt=ot,Qt=0,$t=dt,te=0,me=mt,ye=0,Ae=Tt;if(_.content&&d){const ue=_.content;Ot=Zy(j,0,ue[0]),Qt=Zy(Y,0,ue[1]),Xt=Zy(j,ue[0],ue[2]),$t=Zy(Y,ue[1],ue[3]),te=ue[0]-Ot,ye=ue[1]-Qt,me=ue[2]-ue[0]-Xt,Ae=ue[3]-ue[1]-$t}const Ce=(ue,_e,Re,Ve)=>{const Be=Jy(ue.stretch-Ot,Xt,B,l.left),Ue=Qy(ue.fixed-te,me,ue.stretch,ot),Cn=Jy(_e.stretch-Qt,$t,N,l.top),Hn=Qy(_e.fixed-ye,Ae,_e.stretch,dt),Rn=Jy(Re.stretch-Ot,Xt,B,l.left),Vn=Qy(Re.fixed-te,me,Re.stretch,ot),nn=Jy(Ve.stretch-Qt,$t,N,l.top),Xe=Qy(Ve.fixed-ye,Ae,Ve.stretch,dt),Wn=new M(Be,Cn),ei=new M(Rn,Cn),Hi=new M(Rn,nn),gi=new M(Be,nn),Wi=new M(Ue/E,Hn/E),ni=new M(Vn/E,Xe/E),Yn=i*Math.PI/180;if(Yn){const Li=Math.sin(Yn),qi=Math.cos(Yn),nr=[qi,-Li,Li,qi];Wn._matMult(nr),ei._matMult(nr),gi._matMult(nr),Hi._matMult(nr)}const ai=ue.stretch+ue.fixed,Si=_e.stretch+_e.fixed;return{tl:Wn,tr:ei,bl:gi,br:Hi,tex:{x:_.paddedRect.x+1+ai,y:_.paddedRect.y+1+Si,w:Re.stretch+Re.fixed-ai,h:Ve.stretch+Ve.fixed-Si},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wi,pixelOffsetBR:ni,minFontScaleX:me/E/B,minFontScaleY:Ae/E/N,isSDF:c}};if(d&&(_.stretchX||_.stretchY)){const ue=j2(j,mt,ot),_e=j2(Y,Tt,dt);for(let Re=0;Re<ue.length-1;Re++){const Ve=ue[Re],Be=ue[Re+1];for(let Ue=0;Ue<_e.length-1;Ue++)g.push(Ce(Ve,_e[Ue],Be,_e[Ue+1]))}}else g.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:L+1}));return g}function Zy(l,i,c){let d=0;for(const g of l)d+=Math.max(i,Math.min(c,g[1]))-Math.max(i,Math.min(c,g[0]));return d}function j2(l,i,c){const d=[{fixed:-1,stretch:0}];for(const[g,_]of l){const E=d[d.length-1];d.push({fixed:g-E.stretch,stretch:E.stretch}),d.push({fixed:g-E.stretch,stretch:E.stretch+(_-g)})}return d.push({fixed:i+1,stretch:c}),d}function Jy(l,i,c,d){return l/i*c+d}function Qy(l,i,c,d){return l-i*c/d}function RG(l,i,c,d){const g=i+l.positionedLines[d].lineOffset;return d===0?c+g/2:c+(g+(i+l.positionedLines[d-1].lineOffset))/2}Dh.loadGlyphRange=function(l,i,c,d,g){const _=256*i,E=_+255,S=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",`${_}-${E}`),Pt.Glyphs);zt(S,(L,B)=>{if(L)g(L);else if(B){const N={},j=function(Y){return new gf(Y).readFields(wG,{})}(B);for(const Y of j.glyphs)N[Y.id]=Y;g(null,{glyphs:N,ascender:j.ascender,descender:j.descender})}})},Dh.TinySDF=class{constructor({fontSize:l=24,buffer:i=3,radius:c=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:_="normal",fontStyle:E="normal"}){this.buffer=i,this.cutoff=d,this.radius=c;const S=this.size=l+4*i,L=this._createCanvas(S),B=this.ctx=L.getContext("2d",{willReadFrequently:!0});B.font=`${E} ${_} ${l}px ${g}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(l){const i=document.createElement("canvas");return i.width=i.height=l,i}draw(l){const{width:i,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:_}=this.ctx.measureText(l),E=Math.floor(c),S=Math.min(this.size-this.buffer,Math.ceil(_-g)),L=Math.min(this.size-this.buffer,Math.ceil(c)+Math.ceil(d)),B=S+2*this.buffer,N=L+2*this.buffer,j=B*N,Y=new Uint8ClampedArray(j),Q={data:Y,width:B,height:N,glyphWidth:S,glyphHeight:L,glyphTop:E,glyphLeft:0,glyphAdvance:i};if(S===0||L===0)return Q;const{ctx:ot,buffer:dt,gridInner:mt,gridOuter:Tt}=this;ot.clearRect(dt,dt,S,L),ot.fillText(l,dt,dt+E+1);const Ot=ot.getImageData(dt,dt,S,L);Tt.fill(xf,0,j),mt.fill(0,0,j);for(let Xt=0;Xt<L;Xt++)for(let Qt=0;Qt<S;Qt++){const $t=Ot.data[4*(Xt*S+Qt)+3]/255;if($t===0)continue;const te=(Xt+dt)*B+Qt+dt;if($t===1)Tt[te]=0,mt[te]=xf;else{const me=.5-$t;Tt[te]=me>0?me*me:0,mt[te]=me<0?me*me:0}}V2(Tt,0,0,B,N,B,this.f,this.v,this.z),V2(mt,dt,dt,S,L,B,this.f,this.v,this.z);for(let Xt=0;Xt<j;Xt++){const Qt=Math.sqrt(Tt[Xt])-Math.sqrt(mt[Xt]);Y[Xt]=Math.round(255-255*(Qt/this.radius+this.cutoff))}return Q}};class LG{constructor(i=[],c=IG){if(this.data=i,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:c,compare:d}=this,g=c[i];for(;i>0;){const _=i-1>>1,E=c[_];if(d(g,E)>=0)break;c[i]=E,i=_}c[i]=g}_down(i){const{data:c,compare:d}=this,g=this.length>>1,_=c[i];for(;i<g;){let E=1+(i<<1),S=c[E];const L=E+1;if(L<this.length&&d(c[L],S)<0&&(E=L,S=c[L]),d(S,_)>=0)break;c[i]=S,i=E}c[i]=_}}function IG(l,i){return l<i?-1:l>i?1:0}function kG(l,i=1,c=!1){let d=1/0,g=1/0,_=-1/0,E=-1/0;const S=l[0];for(let Q=0;Q<S.length;Q++){const ot=S[Q];(!Q||ot.x<d)&&(d=ot.x),(!Q||ot.y<g)&&(g=ot.y),(!Q||ot.x>_)&&(_=ot.x),(!Q||ot.y>E)&&(E=ot.y)}const L=Math.min(_-d,E-g);let B=L/2;const N=new LG([],BG);if(L===0)return new M(d,g);for(let Q=d;Q<_;Q+=L)for(let ot=g;ot<E;ot+=L)N.push(new Rh(Q+B,ot+B,B,l));let j=function(Q){let ot=0,dt=0,mt=0;const Tt=Q[0];for(let Ot=0,Xt=Tt.length,Qt=Xt-1;Ot<Xt;Qt=Ot++){const $t=Tt[Ot],te=Tt[Qt],me=$t.x*te.y-te.x*$t.y;dt+=($t.x+te.x)*me,mt+=($t.y+te.y)*me,ot+=3*me}return new Rh(dt/ot,mt/ot,0,Q)}(l),Y=N.length;for(;N.length;){const Q=N.pop();(Q.d>j.d||!j.d)&&(j=Q,c&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,Y)),Q.max-j.d<=i||(B=Q.h/2,N.push(new Rh(Q.p.x-B,Q.p.y-B,B,l)),N.push(new Rh(Q.p.x+B,Q.p.y-B,B,l)),N.push(new Rh(Q.p.x-B,Q.p.y+B,B,l)),N.push(new Rh(Q.p.x+B,Q.p.y+B,B,l)),Y+=4)}return c&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${j.d}`)),j.p}function BG(l,i){return i.max-l.max}function Rh(l,i,c,d){this.p=new M(l,i),this.h=c,this.d=function(g,_){let E=!1,S=1/0;for(let L=0;L<_.length;L++){const B=_[L];for(let N=0,j=B.length,Y=j-1;N<j;Y=N++){const Q=B[N],ot=B[Y];Q.y>g.y!=ot.y>g.y&&g.x<(ot.x-Q.x)*(g.y-Q.y)/(ot.y-Q.y)+Q.x&&(E=!E),S=Math.min(S,UA(g,Q,ot))}}return(E?1:-1)*Math.sqrt(S)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const Pv=Number.POSITIVE_INFINITY,FG=Math.sqrt(2);function H2(l,i){return i[1]!==Pv?function(c,d,g){let _=0,E=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":E=g-7;break;case"bottom-right":case"bottom-left":case"bottom":E=7-g}switch(c){case"top-right":case"bottom-right":case"right":_=-d;break;case"top-left":case"bottom-left":case"left":_=d}return[_,E]}(l,i[0],i[1]):function(c,d){let g=0,_=0;d<0&&(d=0);const E=d/FG;switch(c){case"top-right":case"top-left":_=E-7;break;case"bottom-right":case"bottom-left":_=7-E;break;case"bottom":_=7-d;break;case"top":_=d-7}switch(c){case"top-right":case"bottom-right":g=-E;break;case"top-left":case"bottom-left":g=E;break;case"left":g=d;break;case"right":g=-d}return[g,_]}(l,i[0])}function zG(l,i,c,d,g,_,E,S,L,B){l.createArrays(),l.tilePixelRatio=Fn/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const N=l.layers[0].layout,j=l.layers[0]._unevaluatedLayout._values,Y={};if(l.textSizeData.kind==="composite"){const{minZoom:dt,maxZoom:mt}=l.textSizeData;Y.compositeTextSizes=[j["text-size"].possiblyEvaluate(new mi(dt),S),j["text-size"].possiblyEvaluate(new mi(mt),S)]}if(l.iconSizeData.kind==="composite"){const{minZoom:dt,maxZoom:mt}=l.iconSizeData;Y.compositeIconSizes=[j["icon-size"].possiblyEvaluate(new mi(dt),S),j["icon-size"].possiblyEvaluate(new mi(mt),S)]}Y.layoutTextSize=j["text-size"].possiblyEvaluate(new mi(L+1),S),Y.layoutIconSize=j["icon-size"].possiblyEvaluate(new mi(L+1),S),Y.textMaxSize=j["text-size"].possiblyEvaluate(new mi(18),S);const Q=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",ot=N.get("text-size");for(const dt of l.features){const mt=N.get("text-font").evaluate(dt,{},S).join(","),Tt=ot.evaluate(dt,{},S),Ot=Y.layoutTextSize.evaluate(dt,{},S),Xt=(Y.layoutIconSize.evaluate(dt,{},S),{horizontal:{},vertical:void 0}),Qt=dt.text;let $t,te=[0,0];if(Qt){const Ae=Qt.toString(),Ce=N.get("text-letter-spacing").evaluate(dt,{},S)*dr,ue=N.get("text-line-height").evaluate(dt,{},S)*dr,_e=Sy(Ae)?Ce:0,Re=N.get("text-anchor").evaluate(dt,{},S),Ve=N.get("text-variable-anchor");if(!Ve){const Vn=N.get("text-radial-offset").evaluate(dt,{},S);te=Vn?H2(Re,[Vn*dr,Pv]):N.get("text-offset").evaluate(dt,{},S).map(nn=>nn*dr)}let Be=Q?"center":N.get("text-justify").evaluate(dt,{},S);const Ue=N.get("symbol-placement"),Cn=Ue==="point",Hn=Ue==="point"?N.get("text-max-width").evaluate(dt,{},S)*dr:0,Rn=Vn=>{l.allowVerticalPlacement&&dh(Ae)&&(Xt.vertical=wv(Qt,i,c,g,mt,Hn,ue,Re,Vn,_e,te,To.vertical,!0,Ue,Ot,Tt))};if(!Q&&Ve){const Vn=Be==="auto"?Ve.map(Xe=>Sv(Xe)):[Be];let nn=!1;for(let Xe=0;Xe<Vn.length;Xe++){const Wn=Vn[Xe];if(!Xt.horizontal[Wn])if(nn)Xt.horizontal[Wn]=Xt.horizontal[0];else{const ei=wv(Qt,i,c,g,mt,Hn,ue,"center",Wn,_e,te,To.horizontal,!1,Ue,Ot,Tt);ei&&(Xt.horizontal[Wn]=ei,nn=ei.positionedLines.length===1)}}Rn("left")}else{if(Be==="auto"&&(Be=Sv(Re)),Cn||N.get("text-writing-mode").indexOf("horizontal")>=0||!dh(Ae)){const Vn=wv(Qt,i,c,g,mt,Hn,ue,Re,Be,_e,te,To.horizontal,!1,Ue,Ot,Tt);Vn&&(Xt.horizontal[Be]=Vn)}Rn(Ue==="point"?"left":Be)}}let me=!1;if(dt.icon&&dt.icon.name){const Ae=d[dt.icon.name];Ae&&($t=SG(g[dt.icon.name],N.get("icon-offset").evaluate(dt,{},S),N.get("icon-anchor").evaluate(dt,{},S)),me=Ae.sdf,l.sdfIcons===void 0?l.sdfIcons=Ae.sdf:l.sdfIcons!==Ae.sdf&&bt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==l.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0))}const ye=q2(Xt.horizontal)||Xt.vertical;l.iconsInText||(l.iconsInText=!!ye&&ye.iconsInText),(ye||$t)&&NG(l,dt,Xt,$t,d,Y,Ot,0,te,me,E,S,B)}_&&l.generateCollisionDebugBuffers(L,l.collisionBoxArray)}function Sv(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function NG(l,i,c,d,g,_,E,S,L,B,N,j,Y){let Q=_.textMaxSize.evaluate(i,{},j);Q===void 0&&(Q=E);const ot=l.layers[0].layout,dt=ot.get("icon-offset").evaluate(i,{},j),mt=q2(c.horizontal)||c.vertical,Tt=E/24,Ot=l.tilePixelRatio*Q/24,Xt=(ue=l.overscaling,l.zoom>18&&ue>2&&(ue>>=1),Math.max(Fn/(512*ue),1)*ot.get("symbol-spacing")),Qt=ot.get("text-padding")*l.tilePixelRatio,$t=ot.get("icon-padding")*l.tilePixelRatio,te=k(ot.get("text-max-angle")),me=ot.get("text-rotation-alignment")==="map"&&ot.get("symbol-placement")!=="point",ye=ot.get("icon-rotation-alignment")==="map"&&ot.get("symbol-placement")!=="point",Ae=ot.get("symbol-placement"),Ce=Xt/2;var ue;const _e=ot.get("icon-text-fit");let Re;d&&_e!=="none"&&(l.allowVerticalPlacement&&c.vertical&&(Re=I2(d,c.vertical,_e,ot.get("icon-text-fit-padding"),dt,Tt)),mt&&(d=I2(d,mt,_e,ot.get("icon-text-fit-padding"),dt,Tt)));const Ve=(Be,Ue,Cn)=>{if(Ue.x<0||Ue.x>=Fn||Ue.y<0||Ue.y>=Fn)return;const{x:Hn,y:Rn,z:Vn}=Y.projectTilePoint(Ue.x,Ue.y,Cn),nn=new pa(Hn,Rn,Vn,0,void 0);(function(Xe,Wn,ei,Hi,gi,Wi,ni,Yn,ai,Si,Li,qi,nr,ao,jr,li,Pr,lo,ar,ir,_i,yi,Hr,Sr,Ui){const Cr=Xe.addToLineVertexArray(Wn,Hi);let vr,rr,Fo,pl,Pf,Sf,SE,CE=0,DE=0,RE=0,LE=0,Wv=-1,qv=-1;const Fs={};let IE=Cs(""),Yv=0,Xv=0;if(ai._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Yv,Xv]=ai.layout.get("text-offset").evaluate(_i,{},Ui).map(co=>co*dr):(Yv=ai.layout.get("text-radial-offset").evaluate(_i,{},Ui)*dr,Xv=Pv),Xe.allowVerticalPlacement&&gi.vertical){const co=gi.vertical;if(jr)Sf=Cv(co),Yn&&(SE=Cv(Yn));else{const uo=ai.layout.get("text-rotate").evaluate(_i,{},Ui)+90;Fo=$y(Si,ei,Wn,Li,qi,nr,co,ao,uo,li),Yn&&(pl=$y(Si,ei,Wn,Li,qi,nr,Yn,lo,uo))}}if(Wi){const co=ai.layout.get("icon-rotate").evaluate(_i,{},Ui),uo=ai.layout.get("icon-text-fit")!=="none",Cf=O2(Wi,co,Hr,uo),Zv=Yn?O2(Yn,co,Hr,uo):void 0;rr=$y(Si,ei,Wn,Li,qi,nr,Wi,lo,co),CE=4*Cf.length;const kE=Xe.iconSizeData;let Ac=null;kE.kind==="source"?(Ac=[Ls*ai.layout.get("icon-size").evaluate(_i,{},Ui)],Ac[0]>al&&bt(`${Xe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):kE.kind==="composite"&&(Ac=[Ls*yi.compositeIconSizes[0].evaluate(_i,{},Ui),Ls*yi.compositeIconSizes[1].evaluate(_i,{},Ui)],(Ac[0]>al||Ac[1]>al)&&bt(`${Xe.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Cf,Ac,ir,ar,_i,!1,ei,Wn,Cr.lineStartIndex,Cr.lineLength,-1,Sr,Ui),Wv=Xe.icon.placedSymbolArray.length-1,Zv&&(DE=4*Zv.length,Xe.addSymbols(Xe.icon,Zv,Ac,ir,ar,_i,To.vertical,ei,Wn,Cr.lineStartIndex,Cr.lineLength,-1,Sr,Ui),qv=Xe.icon.placedSymbolArray.length-1)}for(const co in gi.horizontal){const uo=gi.horizontal[co];vr||(IE=Cs(uo.text),jr?Pf=Cv(uo):vr=$y(Si,ei,Wn,Li,qi,nr,uo,ao,ai.layout.get("text-rotate").evaluate(_i,{},Ui),li));const Cf=uo.positionedLines.length===1;if(RE+=W2(Xe,ei,Wn,uo,ni,ai,jr,_i,li,Cr,gi.vertical?To.horizontal:To.horizontalOnly,Cf?Object.keys(gi.horizontal):[co],Fs,Wv,yi,Sr,Ui),Cf)break}gi.vertical&&(LE+=W2(Xe,ei,Wn,gi.vertical,ni,ai,jr,_i,li,Cr,To.vertical,["vertical"],Fs,qv,yi,Sr,Ui));let fl=-1;const Kv=(co,uo)=>co?Math.max(co,uo):uo;fl=Kv(Pf,fl),fl=Kv(Sf,fl),fl=Kv(SE,fl);const xO=fl>-1?1:0;Xe.glyphOffsetArray.length>=ll.MAX_GLYPHS&&bt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_i.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,_i.sortKey),Xe.symbolInstances.emplaceBack(ei.x,ei.y,ei.z,Wn.x,Wn.y,Fs.right>=0?Fs.right:-1,Fs.center>=0?Fs.center:-1,Fs.left>=0?Fs.left:-1,Fs.vertical>=0?Fs.vertical:-1,Wv,qv,IE,vr!==void 0?vr:Xe.collisionBoxArray.length,vr!==void 0?vr+1:Xe.collisionBoxArray.length,Fo!==void 0?Fo:Xe.collisionBoxArray.length,Fo!==void 0?Fo+1:Xe.collisionBoxArray.length,rr!==void 0?rr:Xe.collisionBoxArray.length,rr!==void 0?rr+1:Xe.collisionBoxArray.length,pl||Xe.collisionBoxArray.length,pl?pl+1:Xe.collisionBoxArray.length,Li,RE,LE,CE,DE,xO,0,Yv,Xv,fl)})(l,Ue,nn,Be,c,d,g,Re,l.layers[0],l.collisionBoxArray,i.index,i.sourceLayerIndex,l.index,Qt,me,L,0,$t,ye,dt,i,_,B,N,j)};if(Ae==="line")for(const Be of U2(i.geometry,0,0,Fn,Fn)){const Ue=DG(Be,Xt,te,c.vertical||mt,d,24,Ot,l.overscaling,Fn);for(const Cn of Ue){const Hn=mt;Hn&&UG(l,Hn.text,Ce,Cn)||Ve(Be,Cn,j)}}else if(Ae==="line-center"){for(const Be of i.geometry)if(Be.length>1){const Ue=CG(Be,te,c.vertical||mt,d,24,Ot);Ue&&Ve(Be,Ue,j)}}else if(i.type==="Polygon")for(const Be of gv(i.geometry,0)){const Ue=kG(Be,16);Ve(Be[0],new pa(Ue.x,Ue.y,0,0,void 0),j)}else if(i.type==="LineString")for(const Be of i.geometry)Ve(Be,new pa(Be[0].x,Be[0].y,0,0,void 0),j);else if(i.type==="Point")for(const Be of i.geometry)for(const Ue of Be)Ve([Ue],new pa(Ue.x,Ue.y,0,0,void 0),j)}const al=32640;function W2(l,i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt,mt){const Tt=function(Qt,$t,te,me,ye,Ae,Ce,ue){const _e=[];if($t.positionedLines.length===0)return _e;const Re=me.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,Ve=function(Rn){const Vn=Rn[0],nn=Rn[1],Xe=Vn*nn;return Xe>0?[Vn,-nn]:Xe<0?[-Vn,nn]:Vn===0?[nn,Vn]:[nn,-Vn]}(te);let Be=Math.abs($t.top-$t.bottom);for(const Rn of $t.positionedLines)Be-=Rn.lineOffset;const Ue=$t.positionedLines.length,Cn=Be/Ue;let Hn=$t.top-te[1];for(let Rn=0;Rn<Ue;++Rn){const Vn=$t.positionedLines[Rn];Hn=RG($t,Cn,Hn,Rn);for(const nn of Vn.positionedGlyphs){if(!nn.rect)continue;const Xe=nn.rect||{};let Wn=4,ei=!0,Hi=1,gi=0;if(nn.imageName){const yi=Ce[nn.imageName];if(!yi)continue;if(yi.sdf){bt("SDF images are not supported in formatted text and will be ignored.");continue}ei=!1,Hi=yi.pixelRatio,Wn=1/Hi}const Wi=(ye||ue)&&nn.vertical,ni=nn.metrics.advance*nn.scale/2,Yn=nn.metrics,ai=nn.rect;if(ai===null)continue;ue&&$t.verticalizable&&(gi=nn.imageName?ni-nn.metrics.width*nn.scale/2:0);const Si=ye?[nn.x+ni,nn.y]:[0,0];let Li=[0,0],qi=[0,0],nr=!1;ye||(Wi?(qi=[nn.x+ni+Ve[0],nn.y+Ve[1]-gi],nr=!0):Li=[nn.x+ni+te[0],nn.y+te[1]-gi]);const ao=ai.w*nn.scale/(Hi*(nn.localGlyph?2:1)),jr=ai.h*nn.scale/(Hi*(nn.localGlyph?2:1));let li,Pr,lo,ar;if(Wi){const yi=nn.y-Hn,Hr=new M(-ni,ni-yi),Sr=-Math.PI/2,Ui=new M(...qi);li=new M(-ni+Li[0],Li[1]),li._rotateAround(Sr,Hr)._add(Ui),li.x+=-yi+ni,li.y-=(Yn.left-Wn)*nn.scale;const Cr=nn.imageName?Yn.advance*nn.scale:dr*nn.scale,vr=String.fromCharCode(nn.glyph);dG(vr)?li.x+=(1-Wn)*nn.scale:pG(vr)?li.x+=Cr-Yn.height*nn.scale+(-Wn-1)*nn.scale:li.x+=nn.imageName||Yn.width+2*Wn===ai.w&&Yn.height+2*Wn===ai.h?(Cr-jr)/2:(Cr-(Yn.height+2*Wn)*nn.scale)/2,Pr=new M(li.x,li.y-ao),lo=new M(li.x+jr,li.y),ar=new M(li.x+jr,li.y-ao)}else{const yi=(Yn.left-Wn)*nn.scale-ni+Li[0],Hr=(-Yn.top-Wn)*nn.scale+Li[1],Sr=yi+ao,Ui=Hr+jr;li=new M(yi,Hr),Pr=new M(Sr,Hr),lo=new M(yi,Ui),ar=new M(Sr,Ui)}if(Re){let yi;yi=ye?new M(0,0):nr?new M(Ve[0],Ve[1]):new M(te[0],te[1]),li._rotateAround(Re,yi),Pr._rotateAround(Re,yi),lo._rotateAround(Re,yi),ar._rotateAround(Re,yi)}const ir=new M(0,0),_i=new M(0,0);_e.push({tl:li,tr:Pr,bl:lo,br:ar,tex:Xe,writingMode:$t.writingMode,glyphOffset:Si,sectionIndex:nn.sectionIndex,isSDF:ei,pixelOffsetTL:ir,pixelOffsetBR:_i,minFontScaleX:0,minFontScaleY:0})}}return _e}(0,d,L,_,E,S,g,l.allowVerticalPlacement),Ot=l.textSizeData;let Xt=null;Ot.kind==="source"?(Xt=[Ls*_.layout.get("text-size").evaluate(S,{},mt)],Xt[0]>al&&bt(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Ot.kind==="composite"&&(Xt=[Ls*ot.compositeTextSizes[0].evaluate(S,{},mt),Ls*ot.compositeTextSizes[1].evaluate(S,{},mt)],(Xt[0]>al||Xt[1]>al)&&bt(`${l.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),l.addSymbols(l.text,Tt,Xt,L,E,S,N,i,c,B.lineStartIndex,B.lineLength,Q,dt,mt);for(const Qt of j)Y[Qt]=l.text.placedSymbolArray.length-1;return 4*Tt.length}function q2(l){for(const i in l)return l[i];return null}function $y(l,i,c,d,g,_,E,S,L,B){let N=E.top,j=E.bottom,Y=E.left,Q=E.right;const ot=E.collisionPadding;if(ot&&(Y-=ot[0],N-=ot[1],Q+=ot[2],j+=ot[3]),L){const dt=new M(Y,N),mt=new M(Q,N),Tt=new M(Y,j),Ot=new M(Q,j),Xt=k(L);let Qt=new M(0,0);B&&(Qt=new M(B[0],B[1])),dt._rotateAround(Xt,Qt),mt._rotateAround(Xt,Qt),Tt._rotateAround(Xt,Qt),Ot._rotateAround(Xt,Qt),Y=Math.min(dt.x,mt.x,Tt.x,Ot.x),Q=Math.max(dt.x,mt.x,Tt.x,Ot.x),N=Math.min(dt.y,mt.y,Tt.y,Ot.y),j=Math.max(dt.y,mt.y,Tt.y,Ot.y)}return l.emplaceBack(i.x,i.y,i.z,c.x,c.y,Y,N,Q,j,S,d,g,_),l.length-1}function Cv(l){l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const i=l.bottom-l.top;return i>0?Math.max(10,i):null}function UG(l,i,c,d){const g=l.compareText;if(i in g){const _=g[i];for(let E=_.length-1;E>=0;E--)if(d.dist(_[E])<c)return!0}else g[i]=[];return g[i].push(d),!1}const VG=bc.VectorTileFeature.types,GG=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function t0(l,i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot,dt){const mt=N?Math.min(al,Math.round(N[0])):0,Tt=N?Math.min(al,Math.round(N[1])):0;l.emplaceBack(i,c,Math.round(32*E),Math.round(32*S),L,B,(mt<<1)+(j?1:0),Tt,16*Y,16*Q,256*ot,256*dt,d,g,_,0)}function Dv(l,i,c){l.emplaceBack(i.x,i.y,c),l.emplaceBack(i.x,i.y,c),l.emplaceBack(i.x,i.y,c),l.emplaceBack(i.x,i.y,c)}function OG(l){for(const i of l.sections)if(W1(i.text))return!0;return!1}class Rv{constructor(i){this.layoutVertexArray=new ge,this.indexArray=new Ze,this.programConfigurations=i,this.segments=new Ri,this.dynamicLayoutVertexArray=new ze,this.opacityVertexArray=new oe,this.placedSymbolArray=new es}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,oG.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,sG.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,GG,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ke(Rv,"SymbolBuffers");class Lv{constructor(i,c,d){this.layoutVertexArray=new i,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Ri,this.collisionVertexArray=new ve,this.collisionVertexArrayExt=new ze}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,aG.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,lG.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ke(Lv,"CollisionBuffers");class ll{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(E=>E.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rs([]),this.placementViewportMatrix=Rs([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vv(this.zoom,c["text-size"]),this.iconSizeData=vv(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),_=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(E=>To[E]),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Rv(new yc(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Rv(new yc(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new ti,this.lineVertexArray=new zi,this.symbolInstances=new Di}calculateGlyphDependencies(i,c,d,g,_){for(let E=0;E<i.length;E++)if(c[i.charCodeAt(E)]=!0,g&&_){const S=mf[i.charAt(E)];S&&(c[S.charCodeAt(0)]=!0)}}populate(i,c,d,g){const _=this.layers[0],E=_.layout,S=E.get("text-font"),L=E.get("text-field"),B=E.get("icon-image"),N=(L.value.kind!=="constant"||L.value.value instanceof ji&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),j=B.value.kind!=="constant"||!!B.value.value||Object.keys(B.parameters).length>0,Y=E.get("symbol-sort-key");if(this.features=[],!N&&!j)return;const Q=c.iconDependencies,ot=c.glyphDependencies,dt=c.availableImages,mt=new mi(this.zoom);for(const{feature:Tt,id:Ot,index:Xt,sourceLayerIndex:Qt}of i){const $t=_._featureFilter.needGeometry,te=xc(Tt,$t);if(!_._featureFilter.filter(mt,te,d))continue;let me,ye;if($t||(te.geometry=ua(Tt,d,g)),N){const Ce=_.getValueAndResolveTokens("text-field",te,d,dt),ue=ji.factory(Ce);OG(ue)&&(this.hasRTLText=!0),(!this.hasRTLText||gh()==="unavailable"||this.hasRTLText&&eo.isParsed())&&(me=hG(ue,_,te))}if(j){const Ce=_.getValueAndResolveTokens("icon-image",te,d,dt);ye=Ce instanceof Br?Ce:Br.fromString(Ce)}if(!me&&!ye)continue;const Ae=this.sortFeaturesByKey?Y.evaluate(te,{},d):void 0;if(this.features.push({id:Ot,text:me,icon:ye,index:Xt,sourceLayerIndex:Qt,geometry:te.geometry,properties:Tt.properties,type:VG[Tt.type],sortKey:Ae}),ye&&(Q[ye.name]=!0),me){const Ce=S.evaluate(te,{},d).join(","),ue=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(To.vertical)>=0;for(const _e of me.sections)if(_e.image)Q[_e.image.name]=!0;else{const Re=dh(me.toString()),Ve=_e.fontStack||Ce,Be=ot[Ve]=ot[Ve]||{};this.calculateGlyphDependencies(_e.text,Be,ue,this.allowVerticalPlacement,Re)}}}E.get("symbol-placement")==="line"&&(this.features=function(Tt){const Ot={},Xt={},Qt=[];let $t=0;function te(Ce){Qt.push(Tt[Ce]),$t++}function me(Ce,ue,_e){const Re=Xt[Ce];return delete Xt[Ce],Xt[ue]=Re,Qt[Re].geometry[0].pop(),Qt[Re].geometry[0]=Qt[Re].geometry[0].concat(_e[0]),Re}function ye(Ce,ue,_e){const Re=Ot[ue];return delete Ot[ue],Ot[Ce]=Re,Qt[Re].geometry[0].shift(),Qt[Re].geometry[0]=_e[0].concat(Qt[Re].geometry[0]),Re}function Ae(Ce,ue,_e){const Re=_e?ue[0][ue[0].length-1]:ue[0][0];return`${Ce}:${Re.x}:${Re.y}`}for(let Ce=0;Ce<Tt.length;Ce++){const ue=Tt[Ce],_e=ue.geometry,Re=ue.text?ue.text.toString():null;if(!Re){te(Ce);continue}const Ve=Ae(Re,_e),Be=Ae(Re,_e,!0);if(Ve in Xt&&Be in Ot&&Xt[Ve]!==Ot[Be]){const Ue=ye(Ve,Be,_e),Cn=me(Ve,Be,Qt[Ue].geometry);delete Ot[Ve],delete Xt[Be],Xt[Ae(Re,Qt[Cn].geometry,!0)]=Cn,Qt[Ue].geometry=null}else Ve in Xt?me(Ve,Be,_e):Be in Ot?ye(Ve,Be,_e):(te(Ce),Ot[Ve]=$t-1,Xt[Be]=$t-1)}return Qt.filter(Ce=>Ce.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Tt,Ot)=>Tt.sortKey-Ot.sortKey)}update(i,c,d,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,c,this.layers,d,g),this.icon.programConfigurations.updatePaintArrays(i,c,this.layers,d,g))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,c){const d=this.lineVertexArray.length,g=i.segment;if(g!==void 0){let _=i.dist(c[g+1]),E=i.dist(c[g]);const S={};for(let L=g+1;L<c.length;L++)S[L]={x:c[L].x,y:c[L].y,tileUnitDistanceFromAnchor:_},L<c.length-1&&(_+=c[L+1].dist(c[L]));for(let L=g||0;L>=0;L--)S[L]={x:c[L].x,y:c[L].y,tileUnitDistanceFromAnchor:E},L>0&&(E+=c[L-1].dist(c[L]));for(let L=0;L<c.length;L++){const B=S[L];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,c,d,g,_,E,S,L,B,N,j,Y,Q,ot){const dt=i.indexArray,mt=i.layoutVertexArray,Tt=i.segments.prepareSegment(4*c.length,mt,dt,this.canOverlap?E.sortKey:void 0),Ot=this.glyphOffsetArray.length,Xt=Tt.vertexLength,Qt=this.allowVerticalPlacement&&S===To.vertical?Math.PI/2:0,$t=E.text&&E.text.sections;for(let te=0;te<c.length;te++){const{tl:me,tr:ye,bl:Ae,br:Ce,tex:ue,pixelOffsetTL:_e,pixelOffsetBR:Re,minFontScaleX:Ve,minFontScaleY:Be,glyphOffset:Ue,isSDF:Cn,sectionIndex:Hn}=c[te],Rn=Tt.vertexLength,Vn=Ue[1];t0(mt,L.x,L.y,L.z,B.x,B.y,me.x,Vn+me.y,ue.x,ue.y,d,Cn,_e.x,_e.y,Ve,Be),t0(mt,L.x,L.y,L.z,B.x,B.y,ye.x,Vn+ye.y,ue.x+ue.w,ue.y,d,Cn,Re.x,_e.y,Ve,Be),t0(mt,L.x,L.y,L.z,B.x,B.y,Ae.x,Vn+Ae.y,ue.x,ue.y+ue.h,d,Cn,_e.x,Re.y,Ve,Be),t0(mt,L.x,L.y,L.z,B.x,B.y,Ce.x,Vn+Ce.y,ue.x+ue.w,ue.y+ue.h,d,Cn,Re.x,Re.y,Ve,Be),Dv(i.dynamicLayoutVertexArray,L,Qt),dt.emplaceBack(Rn,Rn+1,Rn+2),dt.emplaceBack(Rn+1,Rn+2,Rn+3),Tt.vertexLength+=4,Tt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ue[0]),te!==c.length-1&&Hn===c[te+1].sectionIndex||i.programConfigurations.populatePaintArrays(mt.length,E,E.index,{},Q,ot,$t&&$t[Hn])}i.placedSymbolArray.emplaceBack(L.x,L.y,L.z,B.x,B.y,Ot,this.glyphOffsetArray.length-Ot,Xt,N,j,B.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],S,0,!1,0,Y,0)}_commitLayoutVertex(i,c,d,g,_,E,S){i.emplaceBack(c,d,g,_,E,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(i,c,d,g,_,E,S){const L=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),B=L.vertexLength,N=S.tileAnchorX,j=S.tileAnchorY;for(let Q=0;Q<4;Q++)d.collisionVertexArray.emplaceBack(0,0,0,0);d.collisionVertexArrayExt.emplaceBack(c,-i.padding,-i.padding),d.collisionVertexArrayExt.emplaceBack(c,i.padding,-i.padding),d.collisionVertexArrayExt.emplaceBack(c,i.padding,i.padding),d.collisionVertexArrayExt.emplaceBack(c,-i.padding,i.padding),this._commitLayoutVertex(d.layoutVertexArray,g,_,E,N,j,new M(i.x1,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,_,E,N,j,new M(i.x2,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,g,_,E,N,j,new M(i.x2,i.y2)),this._commitLayoutVertex(d.layoutVertexArray,g,_,E,N,j,new M(i.x1,i.y2)),L.vertexLength+=4;const Y=d.indexArray;Y.emplaceBack(B,B+1),Y.emplaceBack(B+1,B+2),Y.emplaceBack(B+2,B+3),Y.emplaceBack(B+3,B),L.primitiveLength+=4}_addTextDebugCollisionBoxes(i,c,d,g,_,E){for(let S=g;S<_;S++){const L=d.get(S),B=this.getSymbolInstanceTextSize(i,E,c,S);this._addCollisionDebugVertices(L,B,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,E)}}_addIconDebugCollisionBoxes(i,c,d,g,_,E){for(let S=g;S<_;S++){const L=d.get(S),B=this.getSymbolInstanceIconSize(i,c,S);this._addCollisionDebugVertices(L,B,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,E)}}generateCollisionDebugBuffers(i,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lv(Ie,_2.members,Pn),this.iconCollisionBox=new Lv(Ie,_2.members,Pn);const d=Th(this.iconSizeData,i),g=Th(this.textSizeData,i);for(let _=0;_<this.symbolInstances.length;_++){const E=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(g,i,c,E.textBoxStartIndex,E.textBoxEndIndex,E),this._addTextDebugCollisionBoxes(g,i,c,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E),this._addIconDebugCollisionBoxes(d,i,c,E.iconBoxStartIndex,E.iconBoxEndIndex,E),this._addIconDebugCollisionBoxes(d,i,c,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E)}}getSymbolInstanceTextSize(i,c,d,g){const _=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:g),E=Yy(this.textSizeData,i,_)/dr;return this.tilePixelRatio*E}getSymbolInstanceIconSize(i,c,d){const g=this.icon.placedSymbolArray.get(d),_=Yy(this.iconSizeData,i,g);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(i,c,d){i.emplaceBack(c,-d,-d),i.emplaceBack(c,d,-d),i.emplaceBack(c,d,d),i.emplaceBack(c,-d,d)}_updateTextDebugCollisionBoxes(i,c,d,g,_,E){for(let S=g;S<_;S++){const L=d.get(S),B=this.getSymbolInstanceTextSize(i,E,c,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,B,L.padding)}}_updateIconDebugCollisionBoxes(i,c,d,g,_){for(let E=g;E<_;E++){const S=d.get(E),L=this.getSymbolInstanceIconSize(i,c,E);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,L,S.padding)}}updateCollisionDebugBuffers(i,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Th(this.iconSizeData,i),g=Th(this.textSizeData,i);for(let _=0;_<this.symbolInstances.length;_++){const E=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(g,i,c,E.textBoxStartIndex,E.textBoxEndIndex,E),this._updateTextDebugCollisionBoxes(g,i,c,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E),this._updateIconDebugCollisionBoxes(d,i,c,E.iconBoxStartIndex,E.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(d,i,c,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,c,d,g,_,E,S,L,B){const N={};for(let j=c;j<d;j++){const Y=i.get(j);N.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},N.textFeatureIndex=Y.featureIndex;break}for(let j=g;j<_;j++){const Y=i.get(j);N.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},N.verticalTextFeatureIndex=Y.featureIndex;break}for(let j=E;j<S;j++){const Y=i.get(j);N.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},N.iconFeatureIndex=Y.featureIndex;break}for(let j=L;j<B;j++){const Y=i.get(j);N.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},N.verticalIconFeatureIndex=Y.featureIndex;break}return N}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,c){const d=i.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let _=d.vertexStartIndex;_<g;_+=4)i.indexArray.emplaceBack(_,_+1,_+2),i.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(i),d=Math.cos(i),g=[],_=[],E=[];for(let S=0;S<this.symbolInstances.length;++S){E.push(S);const L=this.symbolInstances.get(S);g.push(0|Math.round(c*L.tileAnchorX+d*L.tileAnchorY)),_.push(L.featureIndex)}return E.sort((S,L)=>g[S]-g[L]||_[L]-_[S]),E}addToSortKeyRanges(i,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,_,E)=>{g>=0&&E.indexOf(g)===_&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ke(ll,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ll.MAX_GLYPHS=65535,ll.addDynamicAttributes=Dv;const jG=new it({"symbol-placement":new I(Dt.layout_symbol["symbol-placement"]),"symbol-spacing":new I(Dt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new I(Dt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new F(Dt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new I(Dt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new I(Dt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new I(Dt.layout_symbol["icon-ignore-placement"]),"icon-optional":new I(Dt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new I(Dt.layout_symbol["icon-rotation-alignment"]),"icon-size":new F(Dt.layout_symbol["icon-size"]),"icon-text-fit":new I(Dt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new I(Dt.layout_symbol["icon-text-fit-padding"]),"icon-image":new F(Dt.layout_symbol["icon-image"]),"icon-rotate":new F(Dt.layout_symbol["icon-rotate"]),"icon-padding":new I(Dt.layout_symbol["icon-padding"]),"icon-keep-upright":new I(Dt.layout_symbol["icon-keep-upright"]),"icon-offset":new F(Dt.layout_symbol["icon-offset"]),"icon-anchor":new F(Dt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new I(Dt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new I(Dt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new I(Dt.layout_symbol["text-rotation-alignment"]),"text-field":new F(Dt.layout_symbol["text-field"]),"text-font":new F(Dt.layout_symbol["text-font"]),"text-size":new F(Dt.layout_symbol["text-size"]),"text-max-width":new F(Dt.layout_symbol["text-max-width"]),"text-line-height":new F(Dt.layout_symbol["text-line-height"]),"text-letter-spacing":new F(Dt.layout_symbol["text-letter-spacing"]),"text-justify":new F(Dt.layout_symbol["text-justify"]),"text-radial-offset":new F(Dt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new I(Dt.layout_symbol["text-variable-anchor"]),"text-anchor":new F(Dt.layout_symbol["text-anchor"]),"text-max-angle":new I(Dt.layout_symbol["text-max-angle"]),"text-writing-mode":new I(Dt.layout_symbol["text-writing-mode"]),"text-rotate":new F(Dt.layout_symbol["text-rotate"]),"text-padding":new I(Dt.layout_symbol["text-padding"]),"text-keep-upright":new I(Dt.layout_symbol["text-keep-upright"]),"text-transform":new F(Dt.layout_symbol["text-transform"]),"text-offset":new F(Dt.layout_symbol["text-offset"]),"text-allow-overlap":new I(Dt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new I(Dt.layout_symbol["text-ignore-placement"]),"text-optional":new I(Dt.layout_symbol["text-optional"])});var Iv={paint:new it({"icon-opacity":new F(Dt.paint_symbol["icon-opacity"]),"icon-color":new F(Dt.paint_symbol["icon-color"]),"icon-halo-color":new F(Dt.paint_symbol["icon-halo-color"]),"icon-halo-width":new F(Dt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new F(Dt.paint_symbol["icon-halo-blur"]),"icon-translate":new I(Dt.paint_symbol["icon-translate"]),"icon-translate-anchor":new I(Dt.paint_symbol["icon-translate-anchor"]),"text-opacity":new F(Dt.paint_symbol["text-opacity"]),"text-color":new F(Dt.paint_symbol["text-color"],{runtimeType:vn,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new F(Dt.paint_symbol["text-halo-color"]),"text-halo-width":new F(Dt.paint_symbol["text-halo-width"]),"text-halo-blur":new F(Dt.paint_symbol["text-halo-blur"]),"text-translate":new I(Dt.paint_symbol["text-translate"]),"text-translate-anchor":new I(Dt.paint_symbol["text-translate-anchor"])}),layout:jG};class Y2{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Bn,this.defaultValue=i}evaluate(i){if(i.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(i.formattedSection))return c.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke(Y2,"FormatSectionOverride",{omit:["defaultValue"]});class e0 extends is{constructor(i){super(i,Iv)}recalculate(i,c){super.recalculate(i,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const _ of d)g.indexOf(_)<0&&g.push(_);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,c,d,g){const _=this.layout.get(i).evaluate(c,{},d,g),E=this._unevaluatedLayout._values[i];return E.isDataDriven()||Xa(E.value)||!_?_:function(S,L){return L.replace(/{([^{}]+)}/g,(B,N)=>N in S?String(S[N]):"")}(c.properties,_)}createBucket(i){return new ll(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Iv.paint.overridableProperties){if(!e0.hasPaintOverride(this.layout,i))continue;const c=this.paint.get(i),d=new Y2(c),g=new nh(d,c.property.specification);let _=null;_=c.value.kind==="constant"||c.value.kind==="source"?new Rp("source",g):new Lp("composite",g,c.value.zoomStops,c.value._interpolationType),this.paint._values[i]=new C(c.property,_,c.parameters)}}_handleOverridablePaintPropertyUpdate(i,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&e0.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,c){const d=i.get("text-field"),g=Iv.paint.properties[c];let _=!1;const E=S=>{for(const L of S)if(g.overrides&&g.overrides.hasOverride(L))return void(_=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ji)E(d.value.value.sections);else if(d.value.kind==="source"){const S=B=>{_||(B instanceof Zo&&Fi(B.value)===kr?E(B.value.sections):B instanceof ja?E(B.sections):B.eachChild(S))},L=d.value;L._styleExpression&&S(L._styleExpression.expression)}return _}getProgramConfiguration(i){return new il(this,i)}}var HG={paint:new it({"background-color":new I(Dt.paint_background["background-color"]),"background-pattern":new X(Dt.paint_background["background-pattern"]),"background-opacity":new I(Dt.paint_background["background-opacity"])})},WG={paint:new it({"raster-opacity":new I(Dt.paint_raster["raster-opacity"]),"raster-hue-rotate":new I(Dt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new I(Dt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new I(Dt.paint_raster["raster-brightness-max"]),"raster-saturation":new I(Dt.paint_raster["raster-saturation"]),"raster-contrast":new I(Dt.paint_raster["raster-contrast"]),"raster-resampling":new I(Dt.paint_raster["raster-resampling"]),"raster-fade-duration":new I(Dt.paint_raster["raster-fade-duration"])})};class qG extends is{constructor(i){super(i,{}),this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var YG={paint:new it({"sky-type":new I(Dt.paint_sky["sky-type"]),"sky-atmosphere-sun":new I(Dt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new I(Dt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new I(Dt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new I(Dt.paint_sky["sky-gradient-radius"]),"sky-gradient":new J(Dt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new I(Dt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new I(Dt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new I(Dt.paint_sky["sky-opacity"])})};function kv(l,i,c){const d=[0,0,1],g=$A([]);return function(_,E,S){S*=.5;var L=E[0],B=E[1],N=E[2],j=E[3],Y=Math.sin(S),Q=Math.cos(S);_[0]=L*Q-N*Y,_[1]=B*Q+j*Y,_[2]=N*Q+L*Y,_[3]=j*Q-B*Y}(g,g,c?-k(l)+Math.PI:k(l)),t2(g,g,-k(i)),JA(d,d,g),rf(d,d)}const XG={circle:class extends is{constructor(l){super(l,p8)}createBucket(l){return new $1(l)}queryRadius(l){const i=l;return bh("circle-radius",this,i)+bh("circle-stroke-width",this,i)+Ny(this.paint.get("circle-translate"))}queryIntersectsFeature(l,i,c,d,g,_,E,S){const L=jA(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),B=this.paint.get("circle-radius").evaluate(i,c)+this.paint.get("circle-stroke-width").evaluate(i,c);return e2(l,d,_,E,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,B)}getProgramIds(){return["circle"]}getProgramConfiguration(l){return new il(this,l)}},heatmap:class extends is{createBucket(l){return new i2(l)}constructor(l){super(l,_8),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return bh("heatmap-radius",this,l)}queryIntersectsFeature(l,i,c,d,g,_,E,S){const L=this.paint.get("heatmap-radius").evaluate(i,c);return e2(l,d,_,E,S,!0,!0,new M(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(l){return new il(this,l)}},hillshade:class extends is{constructor(l){super(l,b8)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends is{constructor(l){super(l,N8)}getProgramIds(){const l=this.paint.get("fill-pattern"),i=l&&l.constantOr(1),c=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getProgramConfiguration(l){return new il(this,l)}recalculate(l,i){super.recalculate(l,i);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Hy(l)}queryRadius(){return Ny(this.paint.get("fill-translate"))}queryIntersectsFeature(l,i,c,d,g,_){return!l.queryGeometry.isAboveHorizon&&NA(OA(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}},"fill-extrusion":class extends is{constructor(l){super(l,Z8)}createBucket(l){return new pf(l)}queryRadius(){return Ny(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(l){return new il(this,l)}queryIntersectsFeature(l,i,c,d,g,_,E,S,L){const B=jA(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),N=this.paint.get("fill-extrusion-height").evaluate(i,c),j=this.paint.get("fill-extrusion-base").evaluate(i,c),Y=[0,0],Q=S&&_.elevation,ot=_.elevation?_.elevation.exaggeration():1,dt=l.tile.getBucket(this);if(Q&&dt instanceof pf){const Ot=dt.centroidVertexArray,Xt=L+1;if(Xt<Ot.length){const Qt=Ot.get(Xt);Y[0]=Qt.a_centroid_pos0,Y[1]=Qt.a_centroid_pos1}}if(Y[0]===0&&Y[1]===1)return!1;const mt=function(Ot,Xt,Qt,$t,te,me,ye,Ae,Ce){return me?function(ue,_e,Re,Ve,Be,Ue,Cn,Hn,Rn){const Vn=[],nn=[],Xe=[0,0,0,1];for(const Wn of ue){const ei=[],Hi=[];for(const gi of Wn){const Wi=gi.x+Ve.x,ni=gi.y+Ve.y,Yn=J8(Wi,ni,_e,Re,Ue,Cn,Hn,Rn);Xe[0]=Wi,Xe[1]=ni,Xe[2]=Yn.base,Xe[3]=1,wh(Xe,Xe,Be),Xe[3]=Math.max(Xe[3],1e-5);const ai=g2([Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]]);Xe[0]=Wi,Xe[1]=ni,Xe[2]=Yn.top,Xe[3]=1,wh(Xe,Xe,Be),Xe[3]=Math.max(Xe[3],1e-5);const Si=g2([Xe[0]/Xe[3],Xe[1]/Xe[3],Xe[2]/Xe[3]]);ei.push(ai),Hi.push(Si)}Vn.push(ei),nn.push(Hi)}return[Vn,nn]}(Ot,Xt,Qt,$t,te,me,ye,Ae,Ce):function(ue,_e,Re,Ve,Be){const Ue=[],Cn=[],Hn=Be[8]*_e,Rn=Be[9]*_e,Vn=Be[10]*_e,nn=Be[11]*_e,Xe=Be[8]*Re,Wn=Be[9]*Re,ei=Be[10]*Re,Hi=Be[11]*Re;for(const gi of ue){const Wi=[],ni=[];for(const Yn of gi){const ai=Yn.x+Ve.x,Si=Yn.y+Ve.y,Li=Be[0]*ai+Be[4]*Si+Be[12],qi=Be[1]*ai+Be[5]*Si+Be[13],nr=Be[2]*ai+Be[6]*Si+Be[14],ao=Be[3]*ai+Be[7]*Si+Be[15],jr=Li+Hn,li=qi+Rn,Pr=nr+Vn,lo=Math.max(ao+nn,1e-5),ar=Li+Xe,ir=qi+Wn,_i=nr+ei,yi=Math.max(ao+Hi,1e-5),Hr=new M(jr/lo,li/lo);Hr.z=Pr/lo,Wi.push(Hr);const Sr=new M(ar/yi,ir/yi);Sr.z=_i/yi,ni.push(Sr)}Ue.push(Wi),Cn.push(ni)}return[Ue,Cn]}(Ot,Xt,Qt,$t,te)}(d,j,N,B,E,Q?S:null,Y,ot,_.center.lat),Tt=l.queryGeometry;return function(Ot,Xt,Qt){let $t=1/0;NA(Qt,Xt)&&($t=m2(Qt,Xt[0]));for(let te=0;te<Xt.length;te++){const me=Xt[te],ye=Ot[te];for(let Ae=0;Ae<me.length-1;Ae++){const Ce=me[Ae],ue=[Ce,me[Ae+1],ye[Ae+1],ye[Ae],Ce];zA(Qt,ue)&&($t=Math.min($t,m2(Qt,ue)))}}return $t!==1/0&&$t}(mt[0],mt[1],Tt.isPointQuery()?Tt.screenBounds:Tt.screenGeometry)}},line:class extends is{constructor(l){super(l,y2),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Kl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,i){super.recalculate(l,i),this.paint._values["line-floorwidth"]=x2.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new qy(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(l){return new il(this,l)}queryRadius(l){const i=l,c=v2(bh("line-width",this,i),bh("line-gap-width",this,i)),d=bh("line-offset",this,i);return c/2+Math.abs(d)+Ny(this.paint.get("line-translate"))}queryIntersectsFeature(l,i,c,d,g,_){if(l.queryGeometry.isAboveHorizon)return!1;const E=OA(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),S=l.pixelToTileUnitsFactor/2*v2(this.paint.get("line-width").evaluate(i,c),this.paint.get("line-gap-width").evaluate(i,c)),L=this.paint.get("line-offset").evaluate(i,c);return L&&(d=function(B,N){const j=[],Y=new M(0,0);for(let Q=0;Q<B.length;Q++){const ot=B[Q],dt=[];for(let mt=0;mt<ot.length;mt++){const Tt=ot[mt-1],Ot=ot[mt],Xt=ot[mt+1],Qt=mt===0?Y:Ot.sub(Tt)._unit()._perp(),$t=mt===ot.length-1?Y:Xt.sub(Ot)._unit()._perp(),te=Qt._add($t)._unit();te._mult(1/(te.x*$t.x+te.y*$t.y)),dt.push(te._mult(N)._add(Ot))}j.push(dt)}return j}(d,L*l.pixelToTileUnitsFactor)),function(B,N,j){for(let Y=0;Y<N.length;Y++){const Q=N[Y];if(B.length>=3){for(let ot=0;ot<Q.length;ot++)if(_h(B,Q[ot]))return!0}if(c8(B,Q,j))return!0}return!1}(E,d,S)}isTileClipped(){return!0}},symbol:e0,background:class extends is{constructor(l){super(l,HG)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends is{constructor(l){super(l,WG)}getProgramIds(){return["raster"]}},sky:class extends is{constructor(l){super(l,YG),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(l,i){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),g=!d,_=l.style.light,E=_.properties.get("position");return g&&_.properties.get("anchor")==="viewport"&&bt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?kv(E.azimuthal,90-E.polar,i):kv(d[0],90-d[1],i)}const c=this.paint.get("sky-gradient-center");return kv(c[0],90-c[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}}};class vf{constructor(i,c,d,g){this.context=i,this.format=d,this.texture=i.gl.createTexture(),this.update(c,g)}update(i,c,d){const{width:g,height:_}=i,{context:E}=this,{gl:S}=E,{HTMLImageElement:L,HTMLCanvasElement:B,HTMLVideoElement:N,ImageData:j,ImageBitmap:Y}=T;if(S.bindTexture(S.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!c||c.premultiply!==!1)),d||this.size&&this.size[0]===g&&this.size[1]===_){const{x:Q,y:ot}=d||{x:0,y:0};i instanceof L||i instanceof B||i instanceof N||i instanceof j||Y&&i instanceof Y?S.texSubImage2D(S.TEXTURE_2D,0,Q,ot,S.RGBA,S.UNSIGNED_BYTE,i):S.texSubImage2D(S.TEXTURE_2D,0,Q,ot,g,_,S.RGBA,S.UNSIGNED_BYTE,i.data)}else this.size=[g,_],i instanceof L||i instanceof B||i instanceof N||i instanceof j||Y&&i instanceof Y?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,i):S.texImage2D(S.TEXTURE_2D,0,this.format,g,_,0,this.format,S.UNSIGNED_BYTE,i.data);this.useMipmap=!!(c&&c.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&S.generateMipmap(S.TEXTURE_2D)}bind(i,c){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?i===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_NEAREST:i),this.filter=i),c!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,c),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Bv{constructor(i,c){this.width=i,this.height=c,this.nextRow=0,this.image=new ha({width:i,height:c}),this.positions={},this.uploaded=!1}getDash(i,c){const d=this.getKey(i,c);return this.positions[d]}trim(){const i=this.width,c=this.height=vt(this.nextRow);this.image.resize({width:i,height:c})}getKey(i,c){return i.join(",")+c}getDashRanges(i,c,d){const g=[];let _=i.length%2==1?-i[i.length-1]*d:0,E=i[0]*d,S=!0;g.push({left:_,right:E,isDash:S,zeroLength:i[0]===0});let L=i[0];for(let B=1;B<i.length;B++){S=!S;const N=i[B];_=L*d,L+=N,E=L*d,g.push({left:_,right:E,isDash:S,zeroLength:N===0})}return g}addRoundDash(i,c,d){const g=c/2;for(let _=-d;_<=d;_++){const E=this.width*(this.nextRow+d+_);let S=0,L=i[S];for(let B=0;B<this.width;B++){B/L.right>1&&(L=i[++S]);const N=Math.abs(B-L.left),j=Math.abs(B-L.right),Y=Math.min(N,j);let Q;const ot=_/d*(g+1);if(L.isDash){const dt=g-Math.abs(ot);Q=Math.sqrt(Y*Y+dt*dt)}else Q=g-Math.sqrt(Y*Y+ot*ot);this.image.data[E+B]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(i,c){for(let L=i.length-1;L>=0;--L){const B=i[L],N=i[L+1];B.zeroLength?i.splice(L,1):N&&N.isDash===B.isDash&&(N.left=B.left,i.splice(L,1))}const d=i[0],g=i[i.length-1];d.isDash===g.isDash&&(d.left=g.left-this.width,g.right=d.right+this.width);const _=this.width*this.nextRow;let E=0,S=i[E];for(let L=0;L<this.width;L++){L/S.right>1&&(S=i[++E]);const B=Math.abs(L-S.left),N=Math.abs(L-S.right),j=Math.min(B,N);this.image.data[_+L]=Math.max(0,Math.min(255,(S.isDash?j:-j)+c+128))}}addDash(i,c){const d=this.getKey(i,c);if(this.positions[d])return this.positions[d];const g=c==="round",_=g?7:0,E=2*_+1;if(this.nextRow+E>this.height)return bt("LineAtlas out of space"),null;i.length===0&&i.push(1);let S=0;for(let N=0;N<i.length;N++)i[N]<0&&(bt("Negative value is found in line dasharray, replacing values with 0"),i[N]=0),S+=i[N];if(S!==0){const N=this.width/S,j=this.getDashRanges(i,this.width,N);g?this.addRoundDash(j,N,_):this.addRegularDash(j,c==="square"?.5*N:0)}const L=this.nextRow+_;this.nextRow+=E;const B={tl:[L,_],br:[S,0]};return this.positions[d]=B,B}}Ke(Bv,"LineAtlas");class KG{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const ZG=T.performance;function X2(l){const i=l?l.url.toString():void 0;return ZG.getEntriesByName(i)}class JG{constructor(){this.tasks={},this.taskQueue=[],ce(["process"],this),this.invoker=new KG(this.process),this.nextId=0}add(i,c){const d=this.nextId++,g=function({type:_,isSymbolTile:E,zoom:S}){return S=S||0,_==="message"?0:_!=="maybePrepare"||E?_!=="parseTile"||E?_==="parseTile"&&E?300-S:_==="maybePrepare"&&E?400-S:500:200-S:100-S}(c);if(g===0){Nt();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[d]={fn:i,metadata:c,priority:g,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){Nt();try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const c=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let i=null,c=1/0;for(let g=0;g<this.taskQueue.length;g++){const _=this.tasks[this.taskQueue[g]];_.priority<c&&(c=_.priority,i=g)}if(i===null)return null;const d=this.taskQueue[i];return this.taskQueue.splice(i,1),d}remove(){this.invoker.remove()}}const QG=Ft([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),$G=Ft([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:K2}=QG,Z2=Ft([{name:"a_pos_3",components:3,type:"Int16"}]);var _f=Ft([{name:"a_pos",type:"Int16",components:2}]);const Lh=Fn/Math.PI/2,oo=-Lh,so=Lh,tO=[new Eo([oo,oo,oo],[so,so,so]),new Eo([oo,oo,oo],[0,0,so]),new Eo([0,oo,oo],[so,0,so]),new Eo([oo,0,oo],[0,so,so]),new Eo([0,0,oo],[so,so,so])];class eO{constructor(i,c,d){this.a=Mh([],i,d),this.b=Mh([],c,d),this.center=d;const g=rf([],this.a),_=rf([],this.b);this.angle=Math.acos(of(g,_))}}function Fv(l,i){if(l.angle===0)return null;let c;return c=l.a[i]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[i]/l.a[i]/Math.sin(l.angle)-1/Math.tan(l.angle)),c<0||c>1?null:function(d,g,_,E){const S=Math.sin(_);return d*(Math.sin((1-E)*_)/S)+g*(Math.sin(E*_)/S)}(l.a[i],l.b[i],l.angle,W(c,0,1))+l.center[i]}function bf(l){if(l.z<=1)return tO[l.z+2*l.y+l.x];const[i,c]=zv(l),d=[fa(i[0],i[1]),fa(i[0],c[1]),fa(c[0],i[1]),fa(c[0],c[1])],g=[so,so,so],_=[oo,oo,oo];for(const E of d)g[0]=Math.min(g[0],E[0]),g[1]=Math.min(g[1],E[1]),g[2]=Math.min(g[2],E[2]),_[0]=Math.max(_[0],E[0]),_[1]=Math.max(_[1],E[1]),_[2]=Math.max(_[2],E[2]);return new Eo(g,_)}function nO(l,i,c){const d=i/l.worldSize,g=(_e,Re)=>{nf(_e,_e,d),nf(Re,Re,d)},_=Number.MAX_VALUE,E=[-_,-_,-_],S=[_,_,_],L=eE(l);if(c.z<=1){const _e=bf(c).getCorners();for(let Re=0;Re<_e.length;Re++)_c(_e[Re],_e[Re],L),av(S,S,_e[Re]),lv(E,E,_e[Re]);return g(S,E),new Eo(S,E)}const[B,N]=zv(c),j=new rl;j.setSouthWest([B[1],N[0]]),j.setNorthEast([N[1],B[0]]);const Y=[fa(j.getSouth(),j.getWest()),fa(j.getSouth(),j.getEast()),fa(j.getNorth(),j.getEast()),fa(j.getNorth(),j.getWest())];for(let _e=0;_e<Y.length;_e++)_c(Y[_e],Y[_e],L),av(S,S,Y[_e]),lv(E,E,Y[_e]);if(j.contains(l.center))return E[2]=0,g(S,E),new Eo(S,E);const Q=[L[12],L[13],L[14]],ot=l.center.lng,dt=W(l.center.lat,-85.051129,Ds),mt=[tf(ot),xh(dt)],Tt=j.getCenter().lng,Ot=W(j.getCenter().lat,-85.051129,Ds),Xt=[tf(Tt),xh(Ot)];let Qt=new Array(3),$t=0;const te=mt[0]-Xt[0],me=mt[1]-Xt[1];if(Math.abs(te)>Math.abs(me))$t=te>=0?1:3,Qt=Q;else{$t=me>=0?0:2;const _e=[L[4],L[5],L[6]];let Re;Re=me>=0?-Math.sin(k(j.getSouth()))*Lh:-Math.sin(k(j.getNorth()))*Lh,Qt=cv(Qt,Q,_e,Re)}const ye=Y[$t],Ae=Y[($t+1)%4],Ce=new eO(ye,Ae,Qt),ue=[Fv(Ce,0)||ye[0],Fv(Ce,1)||ye[1],Fv(Ce,2)||ye[2]];return S[2]=Math.min(ye[2],Ae[2]),av(S,S,ue),lv(E,E,ue),g(S,E),new Eo(S,E)}function zv(l){const i=1<<l.z,c=l.x/i,d=(l.x+1)/i,g=(l.y+1)/i;return[[hr(l.y/i),ko(c)],[hr(g),ko(d)]]}function J2(l,i,c,d=Lh){return c=k(c),[l*Math.sin(c)*d,-i*d,l*Math.cos(c)*d]}function fa(l,i,c){return J2(Math.cos(k(l)),Math.sin(k(l)),i,c)}function Q2(l,i,c){const d=Math.pow(2,c.z),g=(l/Fn+c.x)/d;return fa(hr((i/Fn+c.y)/d),ko(g))}function Nv(l){return 16383/Math.max(...Mh([],l.max,l.min))}function $2(l){const i=Rs(new Float64Array(16)),c=Nv(l);var d,g;return ol(i,i,[c,c,c]),vc(i,i,((d=[])[0]=-(g=l.min)[0],d[1]=-g[1],d[2]=-g[2],d)),i}function tE(l,i,c,d,g){const _=function(L){const B=Fn/(2*Math.PI);return L/(2*Math.PI)/B}(c),E=[l,i,-c/(2*Math.PI)],S=Rs(new Float64Array(16));return vc(S,S,E),ol(S,S,[_,_,_]),rv(S,S,k(-g)),ov(S,S,k(-d)),S}function eE(l){const{x:i,y:c}=l.point,{lng:d,lat:g}=l._center;return tE(i,c,l.worldSize,d,g)}const nE=k(85),iO=Math.cos(nE),rO=Math.sin(nE);function iE(l,i,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[l*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}class n0{constructor(i,c,d){this.z=i,this.x=c,this.y=d,this.key=Mf(0,i,i,c,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,c){const d=function(_,E,S){var L=iE(256*_,256*(E=Math.pow(2,S)-E-1),S),B=iE(256*(_+1),256*(E+1),S);return L[0]+","+L[1]+","+B[0]+","+B[1]}(this.x,this.y,this.z),g=function(_,E,S){let L,B="";for(let N=_;N>0;N--)L=1<<N-1,B+=(E&L?1:0)+(S&L?2:0);return B}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class rE{constructor(i,c){this.wrap=i,this.canonical=c,this.key=Mf(i,c.z,c.z,c.x,c.y)}}class Tr{constructor(i,c,d,g,_){this.overscaledZ=i,this.wrap=c,this.canonical=new n0(d,+g,+_),this.key=c===0&&i===d?this.canonical.key:Mf(c,i,d,g,_)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const c=this.canonical.z-i;return i>this.canonical.z?new Tr(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tr(i,this.wrap,i,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(i,c=!0){if(this.overscaledZ===i&&c)return this.key;if(i>this.canonical.z)return Mf(this.wrap*+c,i,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-i;return Mf(this.wrap*+c,i,i,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const c=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>c&&i.canonical.y===this.canonical.y>>c}children(i){if(this.overscaledZ>=i)return[new Tr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new Tr(c,this.wrap,c,d,g),new Tr(c,this.wrap,c,d+1,g),new Tr(c,this.wrap,c,d,g+1),new Tr(c,this.wrap,c,d+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Tr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Tr(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new rE(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mf(l,i,c,d,g){const _=1<<Math.min(c,22);let E=_*(g%_)+d%_;return l&&c<22&&(E+=_*_*((l<0?-2*l-1:2*l)%(1<<2*(22-c)))),16*(32*E+c)+(i-c)}function Mc(l,i){if(!i.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:i};const c=Math.pow(2,-l.z),d=l.x*c,g=(l.x+1)*c,_=l.y*c,E=(l.y+1)*c,S=ko(d),L=ko(g),B=hr(_),N=hr(E),j=i.project(S,B),Y=i.project(L,B),Q=i.project(L,N),ot=i.project(S,N);let dt=Math.min(j.x,Y.x,Q.x,ot.x),mt=Math.min(j.y,Y.y,Q.y,ot.y),Tt=Math.max(j.x,Y.x,Q.x,ot.x),Ot=Math.max(j.y,Y.y,Q.y,ot.y);const Xt=c/16;function Qt(te,me,ye,Ae,Ce,ue){const _e=(ye+Ce)/2,Re=(Ae+ue)/2,Ve=i.project(ko(_e),hr(Re)),Be=Math.max(0,dt-Ve.x,mt-Ve.y,Ve.x-Tt,Ve.y-Ot);dt=Math.min(dt,Ve.x),Tt=Math.max(Tt,Ve.x),mt=Math.min(mt,Ve.y),Ot=Math.max(Ot,Ve.y),Be>Xt&&(Qt(te,Ve,ye,Ae,_e,Re),Qt(Ve,me,_e,Re,Ce,ue))}Qt(j,Y,d,_,g,_),Qt(Y,Q,g,_,g,E),Qt(Q,ot,g,E,d,E),Qt(ot,j,d,E,d,_),dt-=Xt,mt-=Xt,Tt+=Xt,Ot+=Xt;const $t=1/Math.max(Tt-dt,Ot-mt);return{scale:$t,x:dt*$t,y:mt*$t,x2:Tt*$t,y2:Ot*$t,projection:i}}Ke(n0,"CanonicalTileID"),Ke(Tr,"OverscaledTileID",{omit:["projMatrix"]});class oE{constructor(i){this._stringToNumber={},this._numberToString=[];for(let c=0;c<i.length;c++){const d=i[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const oO=["tile","layer","source","sourceLayer","state"];class sE{constructor(i,c,d,g,_){this.type="Feature",this._vectorTileFeature=i,this._z=c,this._x=d,this._y=g,this.properties=i.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(i.id=this.id);for(const c of oO)this[c]!==void 0&&(i[c]=this[c]);return i}}const Bo=32,Is=33,cl=new Uint16Array(8184);for(let l=0;l<2046;l++){let i=l+2,c=0,d=0,g=0,_=0,E=0,S=0;for(1&i?g=_=E=Bo:c=d=S=Bo;(i>>=1)>1;){const B=c+g>>1,N=d+_>>1;1&i?(g=c,_=d,c=E,d=S):(c=g,d=_,g=E,_=S),E=B,S=N}const L=4*l;cl[L+0]=c,cl[L+1]=d,cl[L+2]=g,cl[L+3]=_}const ks=new Uint16Array(2178),ul=new Uint8Array(1089),i0=new Uint16Array(1089);function aE(l){return l===0?-.03125:l===32?.03125:0}var lE=Ft([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const cE={type:2,extent:Fn,loadGeometry:()=>[[new M(0,0),new M(8193,0),new M(8193,8193),new M(0,8193),new M(0,0)]]};class Uv{constructor(i,c,d,g,_){this.tileID=i,this.uid=ct(),this.uses=0,this.tileSize=c,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection)}registerFadeDuration(i){const c=i+this.timeAdded;c<Te.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Mc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,c,d){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(g,_){const E={};if(!_)return E;for(const S of g){const L=S.layerIds.map(B=>_.getLayer(B)).filter(Boolean);if(L.length!==0){S.layers=L,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(B=>L.filter(N=>N.id===B)[0]));for(const B of L)E[B.id]=S}}return E}(i.buckets,c.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const _=this.buckets[g];if(_ instanceof ll){if(this.hasSymbolBuckets=!0,!d)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const _=this.buckets[g];if(_ instanceof ll&&_.hasRTLText){this.hasRTLText=!0,eo.isLoading()||eo.isLoaded()||gh()!=="deferred"||$a();break}}this.queryPadding=0;for(const g in this.buckets){const _=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(g).queryRadius(_))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new ts}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(i)}const c=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vf(i,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vf(i,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vf(i,this.lineAtlas.image,c.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,c,d,g,_,E,S,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:g,pixelPosMatrix:S,transform:E,params:_,tileTransform:this.tileTransform},i,c,d):{}}querySourceFeatures(i,c){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),_=c?c.sourceLayer:"",E=g._geojsonTileLayer||g[_];if(!E)return;const S=As(c&&c.filter),{z:L,x:B,y:N}=this.tileID.canonical,j={z:L,x:B,y:N};for(let Y=0;Y<E.length;Y++){const Q=E.feature(Y);if(S.needGeometry){const mt=xc(Q,!0);if(!S.filter(new mi(this.tileID.overscaledZ),mt,this.tileID.canonical))continue}else if(!S.filter(new mi(this.tileID.overscaledZ),Q))continue;const ot=d.getId(Q,_),dt=new sE(Q,L,B,N,ot);dt.tile=j,i.push(dt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const d=se(i.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(c)if(this.expirationTime<c)g=!0;else{const _=this.expirationTime-c;_?this.expirationTime=d+Math.max(_,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0||!c)return;const d=this.latestFeatureIndex.loadVTLayers(),g=c.style.listImages();for(const _ in this.buckets){if(!c.style.hasLayer(_))continue;const E=this.buckets[_],S=E.layers[0].sourceLayer||"_geojsonTileLayer",L=d[S],B=i[S];if(!L||!B||Object.keys(B).length===0)continue;if(E.update(B,L,g,this.imageAtlas&&this.imageAtlas.patternPositions||{}),E instanceof qy||E instanceof Hy){const j=c.style._getSourceCache(E.layers[0].source);c._terrain&&c._terrain.enabled&&j&&E.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(j.id,this.tileID)}const N=c&&c.style&&c.style.getLayer(_);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Te.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=Te.now()+i}setTexture(i,c){const d=c.context,g=d.gl;this.texture=c.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new vf(d,i,g.RGBA,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),d.extTextureFilterAnisotropic&&g.texParameterf(g.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax))}setDependencies(i,c){const d={};for(const g of c)d[g]=!0;this.dependencies[i]=d}hasDependency(i,c){for(const d of i){const g=this.dependencies[d];if(g){for(const _ of c)if(g[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const d=ua(cE,this.tileID.canonical,this.tileTransform)[0],g=new It,_=new Zn;for(let E=0;E<d.length;E++){const{x:S,y:L}=d[E];g.emplaceBack(S,L),_.emplaceBack(E)}_.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(_),this._tileDebugBuffer=i.createVertexBuffer(g,_f.members),this._tileDebugSegments=Ri.simpleSegment(0,0,g.length,_.length)}_makeTileBoundsBuffers(i,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const d=ua(cE,this.tileID.canonical,this.tileTransform)[0];let g,_;if(this.isRaster){const E=function(S,L){const B=Mc(S,L),N=Math.pow(2,S.z);for(let mt=0;mt<Is;mt++)for(let Tt=0;Tt<Is;Tt++){const Ot=ko((S.x+(Tt+aE(Tt))/Bo)/N),Xt=hr((S.y+(mt+aE(mt))/Bo)/N),Qt=L.project(Ot,Xt),$t=mt*Is+Tt;ks[2*$t+0]=Math.round((Qt.x*B.scale-B.x)*Fn),ks[2*$t+1]=Math.round((Qt.y*B.scale-B.y)*Fn)}ul.fill(0),i0.fill(0);for(let mt=2045;mt>=0;mt--){const Tt=4*mt,Ot=cl[Tt+0],Xt=cl[Tt+1],Qt=cl[Tt+2],$t=cl[Tt+3],te=Ot+Qt>>1,me=Xt+$t>>1,ye=te+me-Xt,Ae=me+Ot-te,Ce=Xt*Is+Ot,ue=$t*Is+Qt,_e=me*Is+te,Re=Math.hypot((ks[2*Ce+0]+ks[2*ue+0])/2-ks[2*_e+0],(ks[2*Ce+1]+ks[2*ue+1])/2-ks[2*_e+1])>=16;if(ul[_e]=ul[_e]||(Re?1:0),mt<1022){const Ve=(Xt+Ae>>1)*Is+(Ot+ye>>1),Be=($t+Ae>>1)*Is+(Qt+ye>>1);ul[_e]=ul[_e]||ul[Ve]||ul[Be]}}const j=new Ut,Y=new Ze;let Q=0;function ot(mt,Tt){const Ot=Tt*Is+mt;return i0[Ot]===0&&(j.emplaceBack(ks[2*Ot+0],ks[2*Ot+1],mt*Fn/Bo,Tt*Fn/Bo),i0[Ot]=++Q),i0[Ot]-1}function dt(mt,Tt,Ot,Xt,Qt,$t){const te=mt+Ot>>1,me=Tt+Xt>>1;if(Math.abs(mt-Qt)+Math.abs(Tt-$t)>1&&ul[me*Is+te])dt(Qt,$t,mt,Tt,te,me),dt(Ot,Xt,Qt,$t,te,me);else{const ye=ot(mt,Tt),Ae=ot(Ot,Xt),Ce=ot(Qt,$t);Y.emplaceBack(ye,Ae,Ce)}}return dt(0,0,Bo,Bo,Bo,0),dt(Bo,Bo,0,0,0,Bo),{vertices:j,indices:Y}}(this.tileID.canonical,c);g=E.vertices,_=E.indices}else{g=new Ut,_=new Ze;for(const{x:S,y:L}of d)g.emplaceBack(S,L,0,0);const E=Uy(g.int16,void 0,4);for(let S=0;S<E.length;S+=3)_.emplaceBack(E[S],E[S+1],E[S+2])}this._tileBoundsBuffer=i.createVertexBuffer(g,lE.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(_),this._tileBoundsSegments=Ri.simpleSegment(0,0,g.length,_.length)}_makeGlobeTileDebugBuffers(i,c){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!c||c.name!=="globe")return;const d=this.tileID.canonical,g=$2(bf(d));this._makeGlobeTileDebugBorderBuffer(i,d,g),this._makeGlobeTileDebugTextBuffer(i,d,g)}_makeGlobeTileDebugBorderBuffer(i,c,d){const g=new It,_=new Zn,E=new Bt,S=(B,N,j,Y,Q)=>{const ot=(j-B)/(Q-1),dt=(Y-N)/(Q-1),mt=g.length;for(let Tt=0;Tt<Q;Tt++){const Ot=B+Tt*ot,Xt=N+Tt*dt;g.emplaceBack(Ot,Xt);const Qt=Q2(Ot,Xt,c),$t=_c(Qt,Qt,d);E.emplaceBack($t[0],$t[1],$t[2]),_.emplaceBack(mt+Tt)}},L=Fn;S(0,0,L,0,16),S(L,0,L,L,16),S(L,L,0,L,16),S(0,L,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(_),this._tileDebugBuffer=i.createVertexBuffer(g,_f.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(E,Z2.members),this._tileDebugSegments=Ri.simpleSegment(0,0,g.length,_.length)}_makeGlobeTileDebugTextBuffer(i,c,d){const g=new It,_=new Ze,E=new Bt,S=25;_.reserve(32),g.reserve(S),E.reserve(S);const L=(B,N)=>S*B+N;for(let B=0;B<S;B++){const N=2048*B;for(let j=0;j<S;j++){const Y=2048*j;g.emplaceBack(Y,N);const Q=Q2(Y,N,c),ot=_c(Q,Q,d);E.emplaceBack(ot[0],ot[1],ot[2])}}for(let B=0;B<4;B++)for(let N=0;N<4;N++){const j=L(B,N),Y=L(B,N+1),Q=L(B+1,N),ot=L(B+1,N+1);_.emplaceBack(j,Y,Q),_.emplaceBack(Q,Y,ot)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(_),this._tileDebugTextBuffer=i.createVertexBuffer(g,_f.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(E,Z2.members),this._tileDebugTextSegments=Ri.simpleSegment(0,0,S,32)}}class sO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,d){const g=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][g]=this.stateChanges[i][g]||{},st(this.stateChanges[i][g],d),this.deletedStates[i]===null){this.deletedStates[i]={};for(const _ in this.state[i])_!==g&&(this.deletedStates[i][_]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][g]===null){this.deletedStates[i][g]={};for(const _ in this.state[i][g])d[_]||(this.deletedStates[i][g][_]=null)}else for(const _ in d)this.deletedStates[i]&&this.deletedStates[i][g]&&this.deletedStates[i][g][_]===null&&delete this.deletedStates[i][g][_]}removeFeatureState(i,c,d){if(this.deletedStates[i]===null)return;const g=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},d&&c!==void 0)this.deletedStates[i][g]!==null&&(this.deletedStates[i][g]=this.deletedStates[i][g]||{},this.deletedStates[i][g][d]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][g])for(d in this.deletedStates[i][g]={},this.stateChanges[i][g])this.deletedStates[i][g][d]=null;else this.deletedStates[i][g]=null;else this.deletedStates[i]=null}getState(i,c){const d=String(c),g=st({},(this.state[i]||{})[d],(this.stateChanges[i]||{})[d]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const _=this.deletedStates[i][c];if(_===null)return{};for(const E in _)delete g[E]}return g}initializeTileState(i,c){i.setFeatureState(this.state,c)}coalesceChanges(i,c){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const _={};for(const E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),st(this.state[g][E],this.stateChanges[g][E]),_[E]=this.state[g][E];d[g]=_}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const _={};if(this.deletedStates[g]===null)for(const E in this.state[g])_[E]={},this.state[g][E]={};else for(const E in this.deletedStates[g]){if(this.deletedStates[g][E]===null)this.state[g][E]={};else for(const S of Object.keys(this.deletedStates[g][E]))delete this.state[g][E][S];_[E]=this.state[g][E]}d[g]=d[g]||{},st(d[g],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in i)i[g].setFeatureState(d,c)}}class uE{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,c){const d=this.toIdx(i,c);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(i,c){return this.leaves[this.toIdx(i,c)]}toIdx(i,c){return c*this.size+i}}function hE(l,i,c,d){let g=0,_=Number.MAX_VALUE;for(let E=0;E<3;E++)if(Math.abs(d[E])<1e-15){if(c[E]<l[E]||c[E]>i[E])return null}else{const S=1/d[E];let L=(l[E]-c[E])*S,B=(i[E]-c[E])*S;if(L>B){const N=L;L=B,B=N}if(L>g&&(g=L),B<_&&(_=B),g>_)return null}return g}function dE(l,i,c,d,g,_,E,S,L,B,N){const j=d-l,Y=g-i,Q=_-c,ot=E-l,dt=S-i,mt=L-c,Tt=N[1]*mt-N[2]*dt,Ot=N[2]*ot-N[0]*mt,Xt=N[0]*dt-N[1]*ot,Qt=j*Tt+Y*Ot+Q*Xt;if(Math.abs(Qt)<1e-15)return null;const $t=1/Qt,te=B[0]-l,me=B[1]-i,ye=B[2]-c,Ae=(te*Tt+me*Ot+ye*Xt)*$t;if(Ae<0||Ae>1)return null;const Ce=me*Q-ye*Y,ue=ye*j-te*Q,_e=te*Y-me*j,Re=(N[0]*Ce+N[1]*ue+N[2]*_e)*$t;return Re<0||Ae+Re>1?null:(ot*Ce+dt*ue+mt*_e)*$t}function pE(l,i,c){return(l-i)/(c-i)}function fE(l,i,c,d,g,_,E,S,L){const B=1<<c,N=_-d,j=E-g,Y=(l+1)/B*N+d,Q=(i+0)/B*j+g,ot=(i+1)/B*j+g;S[0]=(l+0)/B*N+d,S[1]=Q,L[0]=Y,L[1]=ot}class mE{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(_){const E=Math.ceil(Math.log2(_.dim/8)),S=[];let L=Math.ceil(Math.pow(2,E));const B=1/L,N=(Q,ot,dt,mt,Tt)=>{const Ot=mt?1:0,Xt=(Q+1)*dt-Ot,Qt=ot*dt,$t=(ot+1)*dt-Ot;Tt[0]=Q*dt,Tt[1]=Qt,Tt[2]=Xt,Tt[3]=$t};let j=new uE(L);const Y=[];for(let Q=0;Q<L*L;Q++){N(Q%L,Math.floor(Q/L),B,!1,Y);const ot=hl(Y[0],Y[1],_),dt=hl(Y[2],Y[1],_),mt=hl(Y[2],Y[3],_),Tt=hl(Y[0],Y[3],_);j.minimums.push(Math.min(ot,dt,mt,Tt)),j.maximums.push(Math.max(ot,dt,mt,Tt)),j.leaves.push(1)}for(S.push(j),L/=2;L>=1;L/=2){const Q=S[S.length-1];j=new uE(L);for(let ot=0;ot<L*L;ot++){N(ot%L,Math.floor(ot/L),2,!0,Y);const dt=Q.getElevation(Y[0],Y[1]),mt=Q.getElevation(Y[2],Y[1]),Tt=Q.getElevation(Y[2],Y[3]),Ot=Q.getElevation(Y[0],Y[3]),Xt=Q.isLeaf(Y[0],Y[1]),Qt=Q.isLeaf(Y[2],Y[1]),$t=Q.isLeaf(Y[2],Y[3]),te=Q.isLeaf(Y[0],Y[3]),me=Math.min(dt.min,mt.min,Tt.min,Ot.min),ye=Math.max(dt.max,mt.max,Tt.max,Ot.max),Ae=Xt&&Qt&&$t&&te;j.maximums.push(ye),j.minimums.push(me),j.leaves.push(ye-me<=5&&Ae?1:0)}S.push(j)}return S}(this.dem),d=c.length-1,g=c[d];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(c,0,0,d,0)}raycastRoot(i,c,d,g,_,E,S=1){return hE([i,c,-100],[d,g,this.maximums[0]*S],_,E)}raycast(i,c,d,g,_,E,S=1){if(!this.nodeCount)return null;const L=this.raycastRoot(i,c,d,g,_,E,S);if(L==null)return null;const B=[],N=[],j=[],Y=[],Q=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;Q.length>0;){const{idx:ot,t:dt,nodex:mt,nodey:Tt,depth:Ot}=Q.pop();if(this.leaves[ot]){fE(mt,Tt,Ot,i,c,d,g,j,Y);const Qt=1<<Ot,$t=(mt+0)/Qt,te=(mt+1)/Qt,me=(Tt+0)/Qt,ye=(Tt+1)/Qt,Ae=hl($t,me,this.dem)*S,Ce=hl(te,me,this.dem)*S,ue=hl(te,ye,this.dem)*S,_e=hl($t,ye,this.dem)*S,Re=dE(j[0],j[1],Ae,Y[0],j[1],Ce,Y[0],Y[1],ue,_,E),Ve=dE(Y[0],Y[1],ue,j[0],Y[1],_e,j[0],j[1],Ae,_,E),Be=Math.min(Re!==null?Re:Number.MAX_VALUE,Ve!==null?Ve:Number.MAX_VALUE);if(Be!==Number.MAX_VALUE)return Be;{const Ue=cv([],_,E,dt);if(gE(Ae,Ce,_e,ue,pE(Ue[0],j[0],Y[0]),pE(Ue[1],j[1],Y[1]))>=Ue[2])return dt}continue}let Xt=0;for(let Qt=0;Qt<this._siblingOffset.length;Qt++){fE((mt<<1)+this._siblingOffset[Qt][0],(Tt<<1)+this._siblingOffset[Qt][1],Ot+1,i,c,d,g,j,Y),j[2]=-100,Y[2]=this.maximums[this.childOffsets[ot]+Qt]*S;const $t=hE(j,Y,_,E);if($t!=null){const te=$t;B[Qt]=te;let me=!1;for(let ye=0;ye<Xt&&!me;ye++)te>=B[N[ye]]&&(N.splice(ye,0,Qt),me=!0);me||(N[Xt]=Qt),Xt++}}for(let Qt=0;Qt<Xt;Qt++){const $t=N[Qt];Q.push({idx:this.childOffsets[ot]+$t,t:B[$t],nodex:(mt<<1)+this._siblingOffset[$t][0],nodey:(Tt<<1)+this._siblingOffset[$t][1],depth:Ot+1})}}return null}_addNode(i,c,d){return this.minimums.push(i),this.maximums.push(c),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(i,c,d,g,_){if(i[g].isLeaf(c,d)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const E=g-1,S=i[E];let L=0,B=0;for(let N=0;N<this._siblingOffset.length;N++){const j=2*c+this._siblingOffset[N][0],Y=2*d+this._siblingOffset[N][1],Q=S.getElevation(j,Y),ot=S.isLeaf(j,Y),dt=this._addNode(Q.min,Q.max,ot);ot&&(L|=1<<N),B||(B=dt)}for(let N=0;N<this._siblingOffset.length;N++)L&1<<N||this._construct(i,2*c+this._siblingOffset[N][0],2*d+this._siblingOffset[N][1],E,B+N)}}function gE(l,i,c,d,g,_){return bn(bn(l,c,_),bn(i,d,_),g)}function hl(l,i,c){const d=c.dim,g=W(l*d-.5,0,d-1),_=W(i*d-.5,0,d-1),E=Math.floor(g),S=Math.floor(_),L=Math.min(E+1,d-1),B=Math.min(S+1,d-1);return gE(c.get(E,S),c.get(L,S),c.get(E,B),c.get(L,B),g-E,_-S)}const yE={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class r0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,c,d,g=!1,_=!1){if(this.uid=i,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return bt(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const E=this.dim=c.height-2,S=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.encoding=d||"mapbox",this.borderReady=g,!g){for(let L=0;L<E;L++)S[this._idx(-1,L)]=S[this._idx(0,L)],S[this._idx(E,L)]=S[this._idx(E-1,L)],S[this._idx(L,-1)]=S[this._idx(L,0)],S[this._idx(L,E)]=S[this._idx(L,E-1)];S[this._idx(-1,-1)]=S[this._idx(0,0)],S[this._idx(E,-1)]=S[this._idx(E-1,0)],S[this._idx(-1,E)]=S[this._idx(0,E-1)],S[this._idx(E,E)]=S[this._idx(E-1,E-1)],_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new mE(this)}get(i,c,d=!1){d&&(i=W(i,-1,this.dim),c=W(c,-1,this.dim));const g=4*this._idx(i,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[g],this.pixels[g+1],this.pixels[g+2])}static getUnpackVector(i){return yE[i]}get unpackVector(){return yE[this.encoding]}_idx(i,c){if(i<-1||i>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(i+1)}_unpackMapbox(i,c,d){return(256*i*256+256*c+d)/10-1e4}_unpackTerrarium(i,c,d){return 256*i+c+d/256-32768}static pack(i,c){const d=[0,0,0,0],g=r0.getUnpackVector(c);let _=Math.floor((i+g[3])/g[2]);return d[2]=_%256,_=Math.floor(_/256),d[1]=_%256,_=Math.floor(_/256),d[0]=_,d}getPixels(){return new ro({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,c,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,_=c*this.dim+this.dim,E=d*this.dim,S=d*this.dim+this.dim;switch(c){case-1:g=_-1;break;case 1:_=g+1}switch(d){case-1:E=S-1;break;case 1:S=E+1}const L=-c*this.dim,B=-d*this.dim;for(let N=E;N<S;N++)for(let j=g;j<_;j++){const Y=4*this._idx(j,N),Q=4*this._idx(j+L,N+B);this.pixels[Y+0]=i.pixels[Q+0],this.pixels[Y+1]=i.pixels[Q+1],this.pixels[Y+2]=i.pixels[Q+2],this.pixels[Y+3]=i.pixels[Q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ke(r0,"DEMData"),Ke(mE,"DemMinMaxQuadTree",{omit:["dem"]});class aO{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,d){const g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const _={value:c,timeout:void 0};if(d!==void 0&&(_.timeout=setTimeout(()=>{this.remove(i,_)},d)),this.data[g].push(_),this.order.push(g),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const d=i.wrapped().key,g=c===void 0?0:this.data[d].indexOf(c),_=this.data[d][g];return this.data[d].splice(g,1),_.timeout&&clearTimeout(_.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(_.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const d in this.data)for(const g of this.data[d])i(g.value)||c.push(g);for(const d of c)this.remove(d.value.tileID,d)}}class Ih{constructor(i,c,d){this.func=i,this.mask=c,this.range=d}}Ih.ReadOnly=!1,Ih.ReadWrite=!0,Ih.disabled=new Ih(519,Ih.ReadOnly,[0,1]);const Vv=7680;class Gv{constructor(i,c,d,g,_,E){this.test=i,this.ref=c,this.mask=d,this.fail=g,this.depthFail=_,this.pass=E}}Gv.disabled=new Gv({func:519,mask:0},0,0,Vv,Vv,Vv);class Bs{constructor(i,c,d){this.blendFunction=i,this.blendColor=c,this.mask=d}}Bs.Replace=[1,0],Bs.disabled=new Bs(Bs.Replace,Qn.transparent,[!1,!1,!1,!1]),Bs.unblended=new Bs(Bs.Replace,Qn.transparent,[!0,!0,!0,!0]),Bs.alphaBlended=new Bs([1,771],Qn.transparent,[!0,!0,!0,!0]);const Ov=1029,jv=2305;class rs{constructor(i,c,d){this.enable=i,this.mode=c,this.frontFace=d}}rs.disabled=new rs(!1,Ov,jv),rs.backCCW=new rs(!0,Ov,jv),rs.backCW=new rs(!0,Ov,2304),rs.frontCW=new rs(!0,1028,2304),rs.frontCCW=new rs(!0,1028,jv);class wc extends Vt{constructor(i,c,d){super(),this.id=i,this._onlySymbols=d,c.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new aO(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new sO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const c=this._tiles[i];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,c){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,c)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const c in this._tiles){const d=this._tiles[c];this._source.prepareTile(d)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,d.tileID),d.upload(i),d.prepare(this.map.style.imageManager)}else for(const c in this._tiles){const d=this._tiles[c];d.upload(i),d.prepare(this.map.style.imageManager)}}getIds(){return at(this._tiles).map(i=>i.tileID).sort(xE).map(i=>i.key)}getRenderableIds(i){const c=[];for(const d in this._tiles)this._isIdRenderable(+d,i)&&c.push(this._tiles[d]);return i?c.sort((d,g)=>{const _=d.tileID,E=g.tileID,S=new M(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),L=new M(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-E.overscaledZ||L.y-S.y||L.x-S.x}).map(d=>d.tileID.key):c.map(d=>d.tileID).sort(xE).map(d=>d.key)}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,c){const d=this._tiles[i];d&&(d.state!=="loading"&&(d.state=c),this._loadTile(d,this._tileLoaded.bind(this,d,i,c)))}_tileLoaded(i,c,d,g){if(g)if(i.state="errored",g.status!==404)this._source.fire(new ht(g,{tile:i}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=Te.now(),d==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new rt("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const c=this.getRenderableIds();for(let g=0;g<c.length;g++){const _=c[g];if(i.neighboringTiles&&i.neighboringTiles[_]){const E=this.getTileByID(_);d(i,E),d(E,i)}}function d(g,_){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let E=_.tileID.canonical.x-g.tileID.canonical.x;const S=_.tileID.canonical.y-g.tileID.canonical.y,L=Math.pow(2,g.tileID.canonical.z),B=_.tileID.key;E===0&&S===0||Math.abs(S)>1||(Math.abs(E)>1&&(Math.abs(E+L)===1?E+=L:Math.abs(E-L)===1&&(E-=L)),_.dem&&g.dem&&(g.dem.backfillBorder(_.dem,E,S),g.neighboringTiles&&g.neighboringTiles[B]&&(g.neighboringTiles[B].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,d,g){for(const _ in this._tiles){let E=this._tiles[_];if(g[_]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>d)continue;let S=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const B=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[B.key],E&&E.hasData()&&(S=B)}let L=S;for(;L.overscaledZ>c;)if(L=L.scaledTo(L.overscaledZ-1),i[L.key]){g[S.key]=S;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const d=this._loadedParentTiles[i.key];return d&&d.tileID.overscaledZ>=c?d:null}for(let d=i.overscaledZ-1;d>=c;d--){const g=i.scaledTo(d),_=this._getLoadedTile(g);if(_)return _}}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,c){c=c||this._source.tileSize;const d=Math.ceil(i.width/c)+1,g=Math.ceil(i.height/c)+1,_=Math.floor(d*g*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(S)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const d={};for(const g in this._tiles){const _=this._tiles[g];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+c),d[_.tileID.key]=_}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(i,c,d){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;let g;this.updateCacheSize(i,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new Tr(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(g=i.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(g=g.filter(S=>this._source.hasTile(S)))):g=[];const _=this._updateRetainedTiles(g);if(vE(this._source.type)&&g.length!==0){const S={},L={},B=Object.keys(_);for(const j of B){const Y=_[j],Q=this._tiles[j];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=Te.now())continue;const ot=this.findLoadedParent(Y,Math.max(Y.overscaledZ-wc.maxOverzooming,this._source.minzoom));ot&&(this._addTile(ot.tileID),S[ot.tileID.key]=ot.tileID),L[j]=Y}const N=g[g.length-1].overscaledZ;for(const j in this._tiles){const Y=this._tiles[j];if(_[j]||!Y.hasData())continue;let Q=Y.tileID;for(;Q.overscaledZ>N;){Q=Q.scaledTo(Q.overscaledZ-1);const ot=this._tiles[Q.key];if(ot&&ot.hasData()&&L[Q.key]){_[j]=Y.tileID;break}}}for(const j in S)_[j]||(this._coveredTiles[j]=!0,_[j]=S[j])}for(const S in _)this._tiles[S].clearFadeHold();const E=function(S,L){const B=[];for(const N in S)N in L||B.push(N);return B}(this._tiles,_);for(const S of E){const L=this._tiles[S];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const c={};if(i.length===0)return c;const d={},g=i.reduce((B,N)=>Math.min(B,N.overscaledZ),1/0),_=i[0].overscaledZ,E=Math.max(_-wc.maxOverzooming,this._source.minzoom),S=Math.max(_+wc.maxUnderzooming,this._source.minzoom),L={};for(const B of i){const N=this._addTile(B);c[B.key]=B,N.hasData()||g<this._source.maxzoom&&(L[B.key]=B)}this._retainLoadedChildren(L,g,S,c);for(const B of i){let N=this._tiles[B.key];if(N.hasData())continue;if(B.canonical.z>=this._source.maxzoom){const Y=B.children(this._source.maxzoom)[0],Q=this.getTile(Y);if(Q&&Q.hasData()){c[Y.key]=Y;continue}}else{const Y=B.children(this._source.maxzoom);if(c[Y[0].key]&&c[Y[1].key]&&c[Y[2].key]&&c[Y[3].key])continue}let j=N.wasRequested();for(let Y=B.overscaledZ-1;Y>=E;--Y){const Q=B.scaledTo(Y);if(d[Q.key]||(d[Q.key]=!0,N=this.getTile(Q),!N&&j&&(N=this._addTile(Q)),N&&(c[Q.key]=Q,j=N.wasRequested(),N.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let d,g=this._tiles[i].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}c.push(g.key);const _=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(_),d)break;g=_}for(const _ of c)this._loadedParentTiles[_]=d}}_addTile(i){let c=this._tiles[i.key];if(c)return this._source.prepareTile&&this._source.prepareTile(c),c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const d=!!c;if(!d){const g=this.map?this.map.painter:null;c=new Uv(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,g,this._isRaster),this._source.prepareTile&&this._source.prepareTile(c)||this._loadTile(c,this._tileLoaded.bind(this,c,i.key,c.state))}return c?(c.uses++,this._tiles[i.key]=c,d||this._source.fire(new rt("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const d=c.getExpiryTimeout();d&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},d))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,c,d){const g=[],_=this.transform;if(!_)return g;for(const E in this._tiles){const S=this._tiles[E];if(d&&S.clearQueryDebugViz(),S.holdingForFade())continue;const L=i.containsTile(S,_,c);L&&g.push(L)}return g}getVisibleCoordinates(i){const c=this.getRenderableIds(i).map(d=>this._tiles[d].tileID);for(const d of c)d.projMatrix=this.transform.calculateProjMatrix(d.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(vE(this._source.type))for(const i in this._tiles){const c=this._tiles[i];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=Te.now())return!0}return!1}setFeatureState(i,c,d){this._state.updateState(i=i||"_geojsonTileLayer",c,d)}removeFeatureState(i,c,d){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,d)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,d){const g=this._tiles[i];g&&g.setDependencies(c,d)}reloadTilesForDependencies(i,c){for(const d in this._tiles)this._tiles[d].hasDependency(i,c)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(i,c))}_preloadTiles(i,c){const d=new Map,g=Array.isArray(i)?i:[i],_=this.map.painter.terrain,E=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const S of g){const L=S.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const B of L)d.set(B.key,B);this.usedForTerrain&&S.updateElevation(!1)}tt(Array.from(d.values()),(S,L)=>{const B=new Uv(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(B,N=>{this._source.type==="raster-dem"&&B.dem&&this._backfillDEM(B),L(N,B)})},c)}}function xE(l,i){const c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*i.wrap)-+(i.wrap<0);return l.overscaledZ-i.overscaledZ||d-c||i.canonical.y-l.canonical.y||i.canonical.x-l.canonical.x}function vE(l){return l==="raster"||l==="image"||l==="video"}wc.maxOverzooming=10,wc.maxUnderzooming=3;class o0{constructor(i,c,d){this._demTile=i,this._dem=this._demTile.dem,this._scale=c,this._offset=d}static create(i,c,d){const g=d||i.findDEMTileFor(c);if(!g||!g.dem)return;const _=g.dem,E=g.tileID,S=1<<c.canonical.z-E.canonical.z;return new o0(g,g.tileSize/Fn/S,[(c.canonical.x/S-E.canonical.x)*_.dim,(c.canonical.y/S-E.canonical.y)*_.dim])}tileCoordToPixel(i,c){const d=c*this._scale+this._offset[1],g=Math.floor(i*this._scale+this._offset[0]),_=Math.floor(d);return new M(g,_)}getElevationAt(i,c,d,g){const _=i*this._scale+this._offset[0],E=c*this._scale+this._offset[1],S=Math.floor(_),L=Math.floor(E),B=this._dem;return g=!!g,d?bn(bn(B.get(S,L,g),B.get(S,L+1,g),E-L),bn(B.get(S+1,L,g),B.get(S+1,L+1,g),E-L),_-S):B.get(S,L,g)}getElevationAtPixel(i,c,d){return this._dem.get(i,c,!!d)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*vh(1,i)*this._dem.stride}}class _E{constructor(i,c){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ps(Fn,16,0),this.featureIndexArray=new Ti,this.promoteId=c}insert(i,c,d,g,_,E=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,_,E);const L=this.grid;for(let B=0;B<c.length;B++){const N=c[B],j=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<N.length;Y++){const Q=N[Y];j[0]=Math.min(j[0],Q.x),j[1]=Math.min(j[1],Q.y),j[2]=Math.max(j[2],Q.x),j[3]=Math.max(j[3],Q.y)}j[0]<Fn&&j[1]<Fn&&j[2]>=0&&j[3]>=0&&L.insert(S,j[0],j[1],j[2],j[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bc.VectorTile(new gf(this.rawTileData)).layers,this.sourceLayerCoder=new oE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,c,d,g){this.loadVTLayers();const _=i.params||{},E=As(_.filter),S=i.tileResult,L=i.transform,B=S.bufferedTilespaceBounds,N=this.grid.query(B.min.x,B.min.y,B.max.x,B.max.y,(ot,dt,mt,Tt)=>GA(S.bufferedTilespaceGeometry,ot,dt,mt,Tt));N.sort(lO);let j=null;L.elevation&&N.length>0&&(j=o0.create(L.elevation,this.tileID));const Y={};let Q;for(let ot=0;ot<N.length;ot++){const dt=N[ot];if(dt===Q)continue;Q=dt;const mt=this.featureIndexArray.get(dt);let Tt=null;this.loadMatchingFeature(Y,mt,E,_.layers,_.availableImages,c,d,g,(Ot,Xt,Qt,$t=0)=>(Tt||(Tt=ua(Ot,this.tileID.canonical,i.tileTransform)),Xt.queryIntersectsFeature(S,Ot,Qt,Tt,this.z,i.transform,i.pixelPosMatrix,j,$t)))}return Y}loadMatchingFeature(i,c,d,g,_,E,S,L,B){const{featureIndex:N,bucketIndex:j,sourceLayerIndex:Y,layoutVertexArrayOffset:Q}=c,ot=this.bucketLayerIDs[j];if(g&&!function(Ot,Xt){for(let Qt=0;Qt<Ot.length;Qt++)if(Xt.indexOf(Ot[Qt])>=0)return!0;return!1}(g,ot))return;const dt=this.sourceLayerCoder.decode(Y),mt=this.vtLayers[dt].feature(N);if(d.needGeometry){const Ot=xc(mt,!0);if(!d.filter(new mi(this.tileID.overscaledZ),Ot,this.tileID.canonical))return}else if(!d.filter(new mi(this.tileID.overscaledZ),mt))return;const Tt=this.getId(mt,dt);for(let Ot=0;Ot<ot.length;Ot++){const Xt=ot[Ot];if(g&&g.indexOf(Xt)<0)continue;const Qt=E[Xt];if(!Qt)continue;let $t={};Tt!==void 0&&L&&($t=L.getState(Qt.sourceLayer||"_geojsonTileLayer",Tt));const te=st({},S[Xt]);te.paint=bE(te.paint,Qt.paint,mt,$t,_),te.layout=bE(te.layout,Qt.layout,mt,$t,_);const me=!B||B(mt,Qt,$t,Q);if(!me)continue;const ye=new sE(mt,this.z,this.x,this.y,Tt);ye.layer=te;let Ae=i[Xt];Ae===void 0&&(Ae=i[Xt]=[]),Ae.push({featureIndex:N,feature:ye,intersectionZ:me})}}lookupSymbolFeatures(i,c,d,g,_,E,S,L){const B={};this.loadVTLayers();const N=As(_);for(const j of i)this.loadMatchingFeature(B,{bucketIndex:d,sourceLayerIndex:g,featureIndex:j,layoutVertexArrayOffset:0},N,E,S,L,c);return B}loadFeature(i){const{featureIndex:c,sourceLayerIndex:d}=i;this.loadVTLayers();const g=this.sourceLayerCoder.decode(d),_=this.vtFeatures[g];if(_[c])return _[c];const E=this.vtLayers[g].feature(c);return _[c]=E,E}hasLayer(i){for(const c of this.bucketLayerIDs)for(const d of c)if(i===d)return!0;return!1}getId(i,c){let d=i.id;return this.promoteId&&(d=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function bE(l,i,c,d,g){return fe(l,(_,E)=>{const S=i instanceof R?i.get(E):null;return S&&S.evaluate?S.evaluate(c,d,g):S})}function lO(l,i){return i-l}Ke(_E,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ME{constructor(i){const c={},d=[];for(const S in i){const L=i[S],B=c[S]={};for(const N in L.glyphs){const j=L.glyphs[+N];if(!j||j.bitmap.width===0||j.bitmap.height===0)continue;const Y=j.metrics.localGlyph?2:1,Q={x:0,y:0,w:j.bitmap.width+2*Y,h:j.bitmap.height+2*Y};d.push(Q),B[N]=Q}}const{w:g,h:_}=bv(d),E=new ha({width:g||1,height:_||1});for(const S in i){const L=i[S];for(const B in L.glyphs){const N=L.glyphs[+B];if(!N||N.bitmap.width===0||N.bitmap.height===0)continue;const j=c[S][B],Y=N.metrics.localGlyph?2:1;ha.copy(N.bitmap,E,{x:0,y:0},{x:j.x+Y,y:j.y+Y},N.bitmap)}}this.image=E,this.positions=c}}Ke(ME,"GlyphAtlas");class cO{constructor(i){this.tileID=new Tr(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=Mc(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,c,d,g,_){this.status="parsing",this.data=i,this.collisionBoxArray=new ts;const E=new oE(Object.keys(i.layers).sort()),S=new _E(this.tileID,this.promoteId);S.bucketLayerIDs=[];const L={},B=new Bv(256,256),N={featureIndex:S,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:B,availableImages:d},j=c.familiesBySource[this.source];for(const $t in j){const te=i.layers[$t];if(!te)continue;let me=!1,ye=!1;for(const ue of j[$t])ue[0].type==="symbol"?me=!0:ye=!0;if(this.isSymbolTile===!0&&!me||this.isSymbolTile===!1&&!ye)continue;te.version===1&&bt(`Vector tile source "${this.source}" layer "${$t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ae=E.encode($t),Ce=[];for(let ue=0;ue<te.length;ue++){const _e=te.feature(ue),Re=S.getId(_e,$t);Ce.push({feature:_e,id:Re,index:ue,sourceLayerIndex:Ae})}for(const ue of j[$t]){const _e=ue[0];this.isSymbolTile!==void 0&&_e.type==="symbol"!==this.isSymbolTile||_e.minzoom&&this.zoom<Math.floor(_e.minzoom)||_e.maxzoom&&this.zoom>=_e.maxzoom||_e.visibility!=="none"&&(Hv(ue,this.zoom,d),(L[_e.id]=_e.createBucket({index:S.bucketLayerIDs.length,layers:ue,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ae,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:d})).populate(Ce,N,this.tileID.canonical,this.tileTransform),S.bucketLayerIDs.push(ue.map(Re=>Re.id)))}}let Y,Q,ot,dt;B.trim();const mt={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Tt=fe(N.glyphDependencies,$t=>Object.keys($t).map(Number));Object.keys(Tt).length?g.send("getGlyphs",{uid:this.uid,stacks:Tt},($t,te)=>{Y||(Y=$t,Q=te,Qt.call(this))},void 0,!1,mt):Q={};const Ot=Object.keys(N.iconDependencies);Ot.length?g.send("getImages",{icons:Ot,source:this.source,tileID:this.tileID,type:"icons"},($t,te)=>{Y||(Y=$t,ot=te,Qt.call(this))},void 0,!1,mt):ot={};const Xt=Object.keys(N.patternDependencies);function Qt(){if(Y)return _(Y);if(Q&&ot&&dt){const $t=new ME(Q),te=new P2(ot,dt);for(const me in L){const ye=L[me];ye instanceof ll?(Hv(ye.layers,this.zoom,d),zG(ye,Q,$t.positions,ot,te.iconPositions,this.showCollisionBoxes,d,this.tileID.canonical,this.tileZoom,this.projection)):ye.hasPattern&&(ye instanceof qy||ye instanceof Hy||ye instanceof pf)&&(Hv(ye.layers,this.zoom,d),ye.addFeatures(N,this.tileID.canonical,te.patternPositions,d,this.tileTransform))}this.status="done",_(null,{buckets:at(L).filter(me=>!me.isEmpty()),featureIndex:S,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$t.image,lineAtlas:B,imageAtlas:te,glyphMap:this.returnDependencies?Q:null,iconMap:this.returnDependencies?ot:null,glyphPositions:this.returnDependencies?$t.positions:null})}}Xt.length?g.send("getImages",{icons:Xt,source:this.source,tileID:this.tileID,type:"patterns"},($t,te)=>{Y||(Y=$t,dt=te,Qt.call(this))},void 0,!1,mt):dt={},Qt.call(this)}}function Hv(l,i,c){const d=new mi(i);for(const g of l)g.recalculate(d,c)}class wE{constructor(i){this.entries={},this.scheduler=i}request(i,c,d,g){const _=this.entries[i]=this.entries[i]||{callbacks:[]};if(_.result){const[E,S]=_.result;return this.scheduler?this.scheduler.add(()=>{g(E,S)},c):g(E,S),()=>{}}return _.callbacks.push(g),_.cancel||(_.cancel=d((E,S)=>{_.result=[E,S];for(const L of _.callbacks)this.scheduler?this.scheduler.add(()=>{L(E,S)},c):L(E,S);setTimeout(()=>delete this.entries[i],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(E=>E!==g),_.callbacks.length||(_.cancel(),delete this.entries[i]))}}}function AE(l,i,c){const d=JSON.stringify(l.request);return l.data&&(this.deduped.entries[d]={result:[null,l.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},g=>{const _=zt(l.request,(E,S,L,B)=>{E?g(E):S&&g(null,{vectorTile:c?void 0:new bc.VectorTile(new gf(S)),rawData:S,cacheControl:L,expires:B})});return()=>{_.cancel(),g()}},i)}const uO=Rs(new Float32Array(16));class dl{constructor(i){this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,c){return{x:0,y:0,z:0}}unproject(i,c){return new si(0,0)}projectTilePoint(i,c,d){return{x:i,y:c,z:0}}locationPoint(i,c){return i._coordinatePoint(i.locationCoordinate(c),!1)}pixelsPerMeter(i,c){return vh(1,i)*c}farthestPixelDistance(i){return function(c,d){const g=c.fovAboveCenter,_=c.elevation?c.elevation.getMinElevationBelowMSL()*d:0,E=(c._camera.position[2]*c.worldSize-_)/Math.cos(c._pitch),S=Math.sin(g)*E/Math.sin(Math.max(Math.PI/2-c._pitch-g,.01)),L=Math.sin(c._pitch)*S+E;return Math.min(1.01*L,E*(1/c._horizonShift))}(i,i.pixelsPerMeter)}pointCoordinate(i,c,d,g){const _=i.horizonLineFromTop(!1),E=new M(c,Math.max(_,d));return i.rayIntersectionCoordinate(i.pointRayIntersection(E,g))}createInversionMatrix(i,c){return uO}createTileMatrix(i,c,d){let g,_,E;const S=d.canonical,L=Rs(new Float64Array(16));if(this.isReprojectedInTileSpace){const B=Mc(S,this);g=1,_=B.x+d.wrap*B.scale,E=B.y,ol(L,L,[g/B.scale,g/B.scale,i.pixelsPerMeter/c])}else g=c/i.zoomScale(S.z),_=(S.x+Math.pow(2,S.z)*d.wrap)*g,E=S.y*g;return vc(L,L,[_,E,0]),ol(L,L,[g/Fn,g/Fn,1]),L}upVector(i,c,d){return[0,0,1]}upVectorScale(i,c,d){return{metersToTile:1,metersToLabelSpace:1}}}class hO extends dl{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,c){return{x:tf(i),y:xh(c),z:0}}unproject(i,c){const d=ko(i),g=hr(c);return new si(d,g)}}class dO extends dl{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[c,d]=this.parallels=i.parallels||[29.5,45.5],g=Math.sin(k(c));this.n=(g+Math.sin(k(d)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(i,c){const{n:d,c:g,r0:_}=this,E=k(i-this.center[0]),S=k(c),L=Math.sqrt(g-2*d*Math.sin(S))/d;return{x:L*Math.sin(E*d),y:L*Math.cos(E*d)-_,z:0}}unproject(i,c){const{n:d,c:g,r0:_}=this,E=_+c;let S=Math.atan2(i,Math.abs(E))*Math.sign(E);E*d<0&&(S-=Math.PI*Math.sign(i)*Math.sign(E));const L=k(this.center[0])*d;S=Z(S,-Math.PI-L,Math.PI-L);const B=z(S/d)+this.center[0],N=Math.asin(W((g-(i*i+E*E)*d*d)/(2*d),-1,1)),j=W(z(N),-85.051129,Ds);return new si(B,j)}}const wf=1.340264,Af=-.081106,Ef=893e-6,Tf=.003796,s0=Math.sqrt(3)/2;class pO extends dl{project(i,c){c=c/180*Math.PI,i=i/180*Math.PI;const d=Math.asin(s0*Math.sin(c)),g=d*d,_=g*g*g;return{x:.5*(i*Math.cos(d)/(s0*(wf+3*Af*g+_*(7*Ef+9*Tf*g)))/Math.PI+.5),y:1-.5*(d*(wf+Af*g+_*(Ef+Tf*g))/Math.PI+1),z:0}}unproject(i,c){i=(2*i-.5)*Math.PI;let d=c=(2*(1-c)-1)*Math.PI,g=d*d,_=g*g*g;for(let N,j,Y,Q=0;Q<12&&(j=d*(wf+Af*g+_*(Ef+Tf*g))-c,Y=wf+3*Af*g+_*(7*Ef+9*Tf*g),N=j/Y,d=W(d-N,-Math.PI/3,Math.PI/3),g=d*d,_=g*g*g,!(Math.abs(N)<1e-12));++Q);const E=s0*i*(wf+3*Af*g+_*(7*Ef+9*Tf*g))/Math.cos(d),S=Math.asin(Math.sin(d)/s0),L=W(180*E/Math.PI,-180,180),B=W(180*S/Math.PI,-85.051129,Ds);return new si(L,B)}}class fO extends dl{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,c){return{x:.5+i/360,y:.5-c/360,z:0}}unproject(i,c){const d=360*(i-.5),g=W(360*(.5-c),-85.051129,Ds);return new si(d,g)}}const kh=Math.PI/2;function a0(l){return Math.tan((kh+l)/2)}class mO extends dl{constructor(i){super(i),this.center=i.center||[0,30];const[c,d]=this.parallels=i.parallels||[30,30],g=k(c),_=k(d),E=Math.cos(g);this.n=g===_?Math.sin(g):Math.log(E/Math.cos(_))/Math.log(a0(_)/a0(g)),this.f=E*Math.pow(a0(g),this.n)/this.n}project(i,c){c=k(c),i=k(i-this.center[0]);const d=1e-6,{n:g,f:_}=this;_>0?c<-kh+d&&(c=-kh+d):c>kh-d&&(c=kh-d);const E=_/Math.pow(a0(c),g),S=E*Math.sin(g*i),L=_-E*Math.cos(g*i);return{x:.5*(S/Math.PI+.5),y:1-.5*(L/Math.PI+.5),z:0}}unproject(i,c){i=(2*i-.5)*Math.PI,c=(2*(1-c)-.5)*Math.PI;const{n:d,f:g}=this,_=g-c,E=Math.sign(_),S=Math.sign(d)*Math.sqrt(i*i+_*_);let L=Math.atan2(i,Math.abs(_))*E;_*d<0&&(L-=Math.PI*Math.sign(i)*E);const B=W(z(L/d)+this.center[0],-180,180),N=W(z(2*Math.atan(Math.pow(g/S,1/d))-kh),-85.051129,Ds);return new si(B,N)}}const EE=k(Ds);class gO extends dl{project(i,c){const d=(c=k(c))*c,g=d*d;return{x:.5*((i=k(i))*(.8707-.131979*d+g*(g*(.003971*d-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+d*(.015085+g*(.028874*d-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(i,c){i=(2*i-.5)*Math.PI;let d=c=(2*(1-c)-1)*Math.PI,g=25,_=0,E=d*d;do{E=d*d;const B=E*E;_=(d*(1.007226+E*(.015085+B*(.028874*E-.044475-.005916*B)))-c)/(1.007226+E*(.045255+B*(.259866*E-.311325-.005916*11*B))),d=W(d-_,-EE,EE)}while(Math.abs(_)>1e-6&&--g>0);E=d*d;const S=W(z(i/(.8707+E*(E*(E*E*E*(.003971-.001529*E)-.013791)-.131979))),-180,180),L=z(d);return new si(S,L)}}const TE=k(Ds);class yO extends dl{project(i,c){c=k(c),i=k(i);const d=Math.cos(c),g=2/Math.PI,_=Math.acos(d*Math.cos(i/2)),E=Math.sin(_)/_,S=.5*(i*g+2*d*Math.sin(i/2)/E)||0,L=.5*(c+Math.sin(c)/E)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(i,c){let d=i=(2*i-.5)*Math.PI,g=c=(2*(1-c)-1)*Math.PI,_=25;const E=1e-6;let S=0,L=0;do{const B=Math.cos(g),N=Math.sin(g),j=2*N*B,Y=N*N,Q=B*B,ot=Math.cos(d/2),dt=Math.sin(d/2),mt=2*ot*dt,Tt=dt*dt,Ot=1-Q*ot*ot,Xt=Ot?1/Ot:0,Qt=Ot?Math.acos(B*ot)*Math.sqrt(1/Ot):0,$t=.5*(2*Qt*B*dt+2*d/Math.PI)-i,te=.5*(Qt*N+g)-c,me=.5*Xt*(Q*Tt+Qt*B*ot*Y)+1/Math.PI,ye=Xt*(mt*j/4-Qt*N*dt),Ae=.125*Xt*(j*dt-Qt*N*Q*mt),Ce=.5*Xt*(Y*ot+Qt*Tt*B)+.5,ue=ye*Ae-Ce*me;S=(te*ye-$t*Ce)/ue,L=($t*Ae-te*me)/ue,d=W(d-S,-Math.PI,Math.PI),g=W(g-L,-TE,TE)}while((Math.abs(S)>E||Math.abs(L)>E)&&--_>0);return new si(z(d),z(g))}}class PE extends dl{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(k(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,c){const{scale:d,cosPhi:g}=this;return{x:k(i)*g*d+.5,y:-Math.sin(k(c))/g*d+.5,z:0}}unproject(i,c){const{scale:d,cosPhi:g}=this,_=-(c-.5)/d,E=W(z((i-.5)/d)/g,-180,180),S=Math.asin(W(_*g,-1,1)),L=W(z(S),-85.051129,Ds);return new si(E,L)}}o.ARRAY_TYPE=io,o.AUTH_ERR_MSG=Tn,o.Aabb=Eo,o.Actor=class{constructor(l,i,c){this.target=l,this.parent=i,this.mapId=c,this.callbacks={},this.cancelCallbacks={},ce(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Nt()?l:T,this.scheduler=new JG}send(l,i,c,d,g=!1,_){const E=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=_,this.callbacks[E]=c);const S=ee(this.globalScope)?void 0:[];return this.target.postMessage({id:E,type:l,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:cc(i,S)},S),{cancel:()=>{c&&delete this.callbacks[E],this.target.postMessage({id:E,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(l){const i=l.data,c=i.id;if(c&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d.cancel()}else if(i.mustQueue||Nt()){const d=this.callbacks[c];this.cancelCallbacks[c]=this.scheduler.add(()=>this.processTask(c,i),d&&d.metadata||{type:"message"})}else this.processTask(c,i)}processTask(l,i){if(i.type==="<response>"){const c=this.callbacks[l];delete this.callbacks[l],c&&(i.error?c(Ja(i.error)):c(null,Ja(i.data)))}else{const c=ee(this.globalScope)?void 0:[],d=i.hasCallback?(_,E)=>{delete this.cancelCallbacks[l],this.target.postMessage({id:l,type:"<response>",sourceMapId:this.mapId,error:_?cc(_):null,data:cc(E,c)},c)}:_=>{},g=Ja(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,g,d);else if(this.parent.getWorkerSource){const _=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,_[0],g.source)[_[1]](g,d)}else d(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=n0,o.Color=Qn,o.ColorMode=Bs,o.CullFaceMode=rs,o.DEMData=r0,o.DataConstantProperty=I,o.DedupedRequest=wE,o.DepthMode=Ih,o.EXTENT=Fn,o.Elevation=class{isDataAvailableAtPoint(l){const i=this._source();if(!i||l.y<0||l.y>1)return!1;const c=i.getSource().maxzoom,d=1<<c,g=Math.floor(l.x),_=Math.floor((l.x-g)*d),E=Math.floor(l.y*d),S=this.findDEMTileFor(new Tr(c,g,c,_,E));return!(!S||!S.dem)}getAtPointOrZero(l,i=0){return this.getAtPoint(l,i)||0}getAtPoint(l,i,c=!0){i==null&&(i=null);const d=this._source();if(!d||l.y<0||l.y>1)return i;const g=d.getSource().maxzoom,_=1<<g,E=Math.floor(l.x),S=l.x-E,L=new Tr(g,E,g,Math.floor(S*_),Math.floor(l.y*_)),B=this.findDEMTileFor(L);if(!B||!B.dem)return i;const N=B.dem,j=1<<B.tileID.canonical.z,Y=(S*j-B.tileID.canonical.x)*N.dim,Q=(l.y*j-B.tileID.canonical.y)*N.dim,ot=Math.floor(Y),dt=Math.floor(Q);return(c?this.exaggeration():1)*bn(bn(N.get(ot,dt),N.get(ot,dt+1),Q-dt),bn(N.get(ot+1,dt),N.get(ot+1,dt+1),Q-dt),Y-ot)}getAtTileOffset(l,i,c){const d=1<<l.canonical.z;return this.getAtPointOrZero(new By(l.wrap+(l.canonical.x+i/Fn)/d,(l.canonical.y+c/Fn)/d))}getAtTileOffsetFunc(l,i,c,d){return g=>{const _=this.getAtTileOffset(l,g.x,g.y),E=d.upVector(l.canonical,g.x,g.y);return nf(E,E,_*d.upVectorScale(l.canonical,i,c).metersToTile),E}}getForTilePoints(l,i,c,d){const g=o0.create(this,l,d);return!!g&&(i.forEach(_=>{_[2]=this.exaggeration()*g.getElevationAt(_[0],_[1],c)}),!0)}getMinMaxForTile(l){const i=this.findDEMTileFor(l);if(!i||!i.dem)return null;const c=i.dem.tree,d=i.tileID,g=1<<l.canonical.z-d.canonical.z;let _=l.canonical.x/g-d.canonical.x,E=l.canonical.y/g-d.canonical.y,S=0;for(let L=0;L<l.canonical.z-d.canonical.z&&!c.leaves[S];L++){_*=2,E*=2;const B=2*Math.floor(E)+Math.floor(_);S=c.childOffsets[S]+B,_%=1,E%=1}return{min:this.exaggeration()*c.minimums[S],max:this.exaggeration()*c.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,i,c){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=ht,o.EvaluationParameters=mi,o.Event=rt,o.Evented=Vt,o.FillExtrusionBucket=pf,o.Frustum=uv,o.GLOBE_RADIUS=Lh,o.GlobeSharedBuffers=class{constructor(l){this._createGrid(l),this._createPoles(l),this._createAtmosphere(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(l){const i=new It,c=new Ze,d=65;for(let g=0;g<d;g++)for(let _=0;_<d;_++)i.emplaceBack(_,g);for(let g=0;g<64;g++)for(let _=0;_<64;_++){const E=g*d+_;c.emplaceBack(E+1,E,E+d),c.emplaceBack(E+d,E+d+1,E+1)}this._gridBuffer=l.createVertexBuffer(i,_f.members),this._gridIndexBuffer=l.createIndexBuffer(c,!0),this._gridSegments=Ri.simpleSegment(0,0,4225,8192)}_createPoles(l){const i=new Ze;for(let g=0;g<=64;g++)i.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=l.createIndexBuffer(i,!0);const c=new An,d=new An;this._poleSegments=[];for(let g=0,_=0;g<5;g++){const E=1<<g,S=512*E/Math.PI/2,L=360/E;c.emplaceBack(0,-S,0,0,0,.5,0),d.emplaceBack(0,-S,0,0,0,.5,1);for(let B=0;B<=64;B++){const N=B/64,j=bn(0,L,N),[Y,Q,ot]=J2(iO,rO,j,S);c.emplaceBack(Y,Q,ot,0,0,N,0),d.emplaceBack(Y,Q,ot,0,0,N,1)}this._poleSegments.push(Ri.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(c,K2,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(d,K2,!1)}_createAtmosphere(l){const i=new Un;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const c=new Ze;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.atmosphereVertexBuffer=l.createVertexBuffer(i,$G.members),this.atmosphereIndexBuffer=l.createIndexBuffer(c),this.atmosphereSegments=Ri.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(l){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}getWirefameBuffers(l){if(!this._wireframeSegments){const i=new Pn,c=64,d=c+1;for(let g=0;g<c;g++)for(let _=0;_<c;_++){const E=g*d+_;i.emplaceBack(E,E+1),i.emplaceBack(E,E+d),i.emplaceBack(E,E+d+1)}this._wireframeIndexBuffer=l.createIndexBuffer(i),this._wireframeSegments=Ri.simpleSegment(0,0,c*c,i.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},o.GlyphManager=Dh,o.ImagePosition=Mv,o.LineAtlas=Bv,o.LngLat=si,o.LngLatBounds=rl,o.LocalGlyphMode=Tv,o.MAX_MERCATOR_LATITUDE=Ds,o.MercatorCoordinate=By,o.ONE_EM=dr,o.OverscaledTileID=Tr,o.Properties=it,o.RGBAImage=ro,o.Ray=class{constructor(l,i){this.pos=l,this.dir=i}intersectsPlane(l,i,c){const d=of(i,this.dir);if(Math.abs(d)<1e-6)return!1;const g=((l[0]-this.pos[0])*i[0]+(l[1]-this.pos[1])*i[1]+(l[2]-this.pos[2])*i[2])/d;return c[0]=this.pos[0]+this.dir[0]*g,c[1]=this.pos[1]+this.dir[1]*g,c[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(l,i,c){if(function(Y,Q){var ot=Y[0],dt=Y[1],mt=Y[2],Tt=Q[0],Ot=Q[1],Xt=Q[2];return Math.abs(ot-Tt)<=nv*Math.max(1,Math.abs(ot),Math.abs(Tt))&&Math.abs(dt-Ot)<=nv*Math.max(1,Math.abs(dt),Math.abs(Ot))&&Math.abs(mt-Xt)<=nv*Math.max(1,Math.abs(mt),Math.abs(Xt))}(this.pos,l)||i===0)return c[0]=c[1]=c[2]=0,!1;const[d,g,_]=this.dir,E=this.pos[0]-l[0],S=this.pos[1]-l[1],L=this.pos[2]-l[2],B=d*d+g*g+_*_,N=2*(E*d+S*g+L*_),j=N*N-4*B*(E*E+S*S+L*L-i*i);if(j<0){const Y=Math.max(-N/2,0),Q=E+d*Y,ot=S+g*Y,dt=L+_*Y,mt=Math.hypot(Q,ot,dt);return c[0]=Q*i/mt,c[1]=ot*i/mt,c[2]=dt*i/mt,!1}{const Y=(-N-Math.sqrt(j))/(2*B);if(Y<0){const Q=Math.hypot(E,S,L);return c[0]=E*i/Q,c[1]=S*i/Q,c[2]=L*i/Q,!1}return c[0]=E+d*Y,c[1]=S+g*Y,c[2]=L+_*Y,!0}}},o.RequestManager=class{constructor(l,i,c){this._transformRequestFn=l,this._customAccessToken=i,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const l=function(){let i="";for(let c=0;c<10;c++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yn,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=l.token,this._skuTokenExpiresAt=l.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(l,i){return this._transformRequestFn&&this._transformRequestFn(l,i)||{url:l}}normalizeStyleURL(l,i){if(!pn(l))return l;const c=Je(l);return c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeGlyphsURL(l,i){if(!pn(l))return l;const c=Je(l);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||i)}normalizeSourceURL(l,i){if(!pn(l))return l;const c=Je(l);return c.path=`/v4/${c.authority}.json`,c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||i)}normalizeSpriteURL(l,i,c,d){const g=Je(l);return pn(l)?(g.path=`/styles/v1${g.path}/sprite${i}${c}`,this._makeAPIURL(g,this._customAccessToken||d)):(g.path+=`${i}${c}`,Jt(g))}normalizeTileURL(l,i,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),l&&!pn(l))return l;const d=Je(l);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||c&&d.authority!=="raster"&&c===512?"@2x":""}${St.supported?".webp":"$1"}`),d.authority==="raster"?d.path=`/${yt.RASTER_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${yt.TILE_URL_VERSION}${d.path}`);const g=this._customAccessToken||function(_){for(const E of _){const S=E.match(/^access_token=(.*)$/);if(S)return S[1]}return null}(d.params)||yt.ACCESS_TOKEN;return yt.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,g)}canonicalizeTileURL(l,i){const c=Je(l);if(!c.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!c.path.match(/\.[\w]+$/))return l;let d="mapbox://";c.path.match(/^\/raster\/v1\//)?d+=`raster/${c.path.replace(`/${yt.RASTER_URL_PREFIX}/`,"")}`:d+=`tiles/${c.path.replace(`/${yt.TILE_URL_VERSION}/`,"")}`;let g=c.params;return i&&(g=g.filter(_=>!_.match(/^access_token=/))),g.length&&(d+=`?${g.join("&")}`),d}canonicalizeTileset(l,i){const c=!!i&&pn(i),d=[];for(const g of l.tiles||[])qe(g)?d.push(this.canonicalizeTileURL(g,c)):d.push(g);return d}_makeAPIURL(l,i){const c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=Je(yt.API_URL);if(l.protocol=d.protocol,l.authority=d.authority,l.protocol==="http"){const g=l.params.indexOf("secure");g>=0&&l.params.splice(g,1)}if(d.path!=="/"&&(l.path=`${d.path}${l.path}`),!yt.REQUIRE_ACCESS_TOKEN)return Jt(l);if(i=i||yt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(i[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return l.params=l.params.filter(g=>g.indexOf("access_token")===-1),l.params.push(`access_token=${i||""}`),Jt(l)}},o.ResourceType=Pt,o.SegmentVector=Ri,o.SourceCache=wc,o.StencilMode=Gv,o.StructArrayLayout1ui2=Zn,o.StructArrayLayout2f1f2i16=en,o.StructArrayLayout2i4=It,o.StructArrayLayout2ui4=Pn,o.StructArrayLayout3f12=ze,o.StructArrayLayout3ui6=Ze,o.StructArrayLayout4i8=Ut,o.Texture=vf,o.Tile=Uv,o.Transitionable=v,o.Uniform1f=Iy,o.Uniform1i=class extends la{constructor(l,i){super(l,i),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},o.Uniform2f=class extends la{constructor(l,i){super(l,i),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},o.Uniform3f=class extends la{constructor(l,i){super(l,i),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},o.Uniform4f=RA,o.UniformColor=LA,o.UniformMatrix2f=class extends la{constructor(l,i){super(l,i),this.current=$V}set(l){for(let i=0;i<4;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},o.UniformMatrix3f=class extends la{constructor(l,i){super(l,i),this.current=QV}set(l){for(let i=0;i<9;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},o.UniformMatrix4f=class extends la{constructor(l,i){super(l,i),this.current=JV}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let i=1;i<16;i++)if(l[i]!==this.current[i]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},o.UnwrappedTileID=rE,o.ValidationError=Ye,o.VectorTileWorkerSource=class extends Vt{constructor(l,i,c,d,g){super(),this.actor=l,this.layerIndex=i,this.availableImages=c,this.loadVectorData=g||AE,this.loading={},this.loaded={},this.deduped=new wE(l.scheduler),this.isSpriteLoaded=d,this.scheduler=l.scheduler}loadTile(l,i){const c=l.uid,d=l&&l.request,g=d&&d.collectResourceTiming,_=this.loading[c]=new cO(l);_.abort=this.loadVectorData(l,(E,S)=>{const L=!this.loading[c];if(delete this.loading[c],L||E||!S)return _.status="done",L||(this.loaded[c]=_),i(E);const B=S.rawData,N={};S.expires&&(N.expires=S.expires),S.cacheControl&&(N.cacheControl=S.cacheControl),_.vectorTile=S.vectorTile||new bc.VectorTile(new gf(B));const j=()=>{_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,(Y,Q)=>{if(Y||!Q)return i(Y);const ot={};if(g){const dt=X2(d);dt.length>0&&(ot.resourceTiming=JSON.parse(JSON.stringify(dt)))}i(null,st({rawTileData:B.slice(0)},Q,N,ot))})};this.isSpriteLoaded?j():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(j,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom}):j()}),this.loaded=this.loaded||{},this.loaded[c]=_})}reloadTile(l,i){const c=this.loaded,d=l.uid,g=this;if(c&&c[d]){const _=c[d];_.showCollisionBoxes=l.showCollisionBoxes,_.enableTerrain=!!l.enableTerrain,_.projection=l.projection,_.tileTransform=Mc(l.tileID.canonical,l.projection);const E=(S,L)=>{const B=_.reloadCallback;B&&(delete _.reloadCallback,_.parse(_.vectorTile,g.layerIndex,this.availableImages,g.actor,B)),i(S,L)};_.status==="parsing"?_.reloadCallback=E:_.status==="done"&&(_.vectorTile?_.parse(_.vectorTile,this.layerIndex,this.availableImages,this.actor,E):E())}}abortTile(l,i){const c=l.uid,d=this.loading[c];d&&(d.abort&&d.abort(),delete this.loading[c]),i()}removeTile(l,i){const c=this.loaded,d=l.uid;c&&c[d]&&delete c[d],i()}},o.WritingMode=To,o.ZoomHistory=Vp,o.add=YA,o.addDynamicAttributes=Dv,o.adjoint=function(l,i){var c=i[0],d=i[1],g=i[2],_=i[3],E=i[4],S=i[5],L=i[6],B=i[7],N=i[8];return l[0]=E*N-S*B,l[1]=g*B-d*N,l[2]=d*S-g*E,l[3]=S*L-_*N,l[4]=c*N-g*L,l[5]=g*_-c*S,l[6]=_*B-E*L,l[7]=d*L-c*B,l[8]=c*E-d*_,l},o.asyncAll=tt,o.bezier=H,o.bindAll=ce,o.boundsAttributes=lE,o.bufferConvexPolygon=function(l,i){const c=[];for(let d=0;d<l.length;d++){const g=Z(d-1,-1,l.length-1),_=Z(d+1,-1,l.length-1),E=l[d],S=l[_],L=l[g].sub(E).unit(),B=S.sub(E).unit(),N=B.angleWithSep(L.x,L.y),j=L.add(B).unit().mult(-1*i/Math.sin(N/2));c.push(E.add(j))}return c},o.cacheEntryPossiblyAdded=function(l){Ir++,Ir>Qr&&(l.getActor().send("enforceCacheSizeLimit",Ai),Ir=0)},o.calculateGlobeLabelMatrix=function(l,i){const{lng:c,lat:d}=l._center,g=tE(0,0,l.worldSize/l._projectionScaler,c,d);return iv(g,g,function(_){const E=Rs(new Float64Array(16)),S=1/Nv(_);return vc(E,E,_.min),ol(E,E,[S,S,S]),E}(bf(i)))},o.calculateGlobeMatrix=eE,o.calculateGlobeMercatorMatrix=function(l){const i=l.worldSize,c=l.point,d=vh(1,l.center.lat)*i,g=l.pixelsPerMeter,_=i/(d/l.pixelsPerMeter),E=Rs(new Float64Array(16));return vc(E,E,[c.x,c.y,0]),ol(E,E,[_,_,g]),Float32Array.from(E)},o.circumferenceAtLatitude=Z1,o.clamp=W,o.clearTileCache=function(l){const i=T.caches.delete(Bi);l&&i.catch(l).then(()=>l())},o.clipLine=U2,o.clone=function(l){var i=new io(16);return i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3],i[4]=l[4],i[5]=l[5],i[6]=l[6],i[7]=l[7],i[8]=l[8],i[9]=l[9],i[10]=l[10],i[11]=l[11],i[12]=l[12],i[13]=l[13],i[14]=l[14],i[15]=l[15],i},o.clone$1=Le,o.collisionCircleLayout=cG,o.config=yt,o.conjugate=function(l,i){return l[0]=-i[0],l[1]=-i[1],l[2]=-i[2],l[3]=i[3],l},o.create=function(){var l=new io(16);return io!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},o.create$1=HA,o.createExpression=ec,o.createLayout=Ft,o.createStyleLayer=function(l){return l.type==="custom"?new qG(l):new XG[l.type](l)},o.cross=ZA,o.degToRad=k,o.div=function(l,i,c){return l[0]=i[0]/c[0],l[1]=i[1]/c[1],l[2]=i[2]/c[2],l},o.dot=of,o.earthRadius=K1,o.ease=V,o.easeCubicInOut=U,o.emitValidationErrors=py,o.endsWith=le,o.enforceCacheSizeLimit=function(l){Oi(),oi&&oi.then(i=>{i.keys().then(c=>{for(let d=0;d<c.length-l;d++)i.delete(c[d])})})},o.evaluateSizeForFeature=Yy,o.evaluateSizeForZoom=Th,o.evaluateVariableOffset=H2,o.evented=Zp,o.exactEquals=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]&&l[3]===i[3]},o.exactEquals$1=function(l,i){return l[0]===i[0]&&l[1]===i[1]&&l[2]===i[2]},o.exported=Te,o.exported$1=St,o.extend=st,o.extend$1=Se,o.filterObject=de,o.fromMat4=function(l,i){return l[0]=i[0],l[1]=i[1],l[2]=i[2],l[3]=i[4],l[4]=i[5],l[5]=i[6],l[6]=i[8],l[7]=i[9],l[8]=i[10],l},o.fromQuat=function(l,i){var c=i[0],d=i[1],g=i[2],_=i[3],E=c+c,S=d+d,L=g+g,B=c*E,N=d*E,j=d*S,Y=g*E,Q=g*S,ot=g*L,dt=_*E,mt=_*S,Tt=_*L;return l[0]=1-j-ot,l[1]=N+Tt,l[2]=Y-mt,l[3]=0,l[4]=N-Tt,l[5]=1-B-ot,l[6]=Q+dt,l[7]=0,l[8]=Y+mt,l[9]=Q-dt,l[10]=1-B-j,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},o.fromRotation=function(l,i){var c=Math.sin(i),d=Math.cos(i);return l[0]=d,l[1]=c,l[2]=0,l[3]=-c,l[4]=d,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},o.fromScaling=function(l,i){return l[0]=i[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=i[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=i[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},o.furthestTileCorner=function(l){const i=Math.round((l+45+360)%360/90)%4;return O[i]},o.getAABBPointSquareDist=function(l,i,c){let d=0;for(let g=0;g<2;++g){const _=c?c[g]:0;l[g]>_&&(d+=(l[g]-_)*(l[g]-_)),i[g]<_&&(d+=(_-i[g])*(_-i[g]))}return d},o.getAnchorAlignment=Ev,o.getAnchorJustification=Sv,o.getBounds=function(l){let i=1/0,c=1/0,d=-1/0,g=-1/0;for(const _ of l)i=Math.min(i,_.x),c=Math.min(c,_.y),d=Math.max(d,_.x),g=Math.max(g,_.y);return{min:new M(i,c),max:new M(d,g)}},o.getColumn=function(l,i){return[l[4*i],l[4*i+1],l[4*i+2],l[4*i+3]]},o.getGridMatrix=function(l,i){const[c,d]=i,g=.015625;return[0,(d[1]-c[1])*g,1<<l.z,(d[0]-c[0])*g,0,l.y,c[0],c[1],g]},o.getImage=He,o.getJSON=function(l,i){return At(st(l,{type:"json"}),i)},o.getMapSessionAPI=Ji,o.getPerformanceMeasurement=X2,o.getProjection=function(l){const i=l.parallels,c=!!i&&Math.abs(i[0]+i[1])<.01;switch(l.name){case"mercator":return new hO(l);case"equirectangular":return new fO(l);case"naturalEarth":return new gO(l);case"equalEarth":return new pO(l);case"winkelTripel":return new yO(l);case"albers":return c?new PE(l):new dO(l);case"lambertConformalConic":return c?new PE(l):new mO(l)}throw new Error(`Invalid projection name: ${l.name}`)},o.getRTLTextPluginStatus=gh,o.getReferrer=lt,o.getTilePoint=function(l,{x:i,y:c},d=0){return new M(((i-d)*l.scale-l.x)*Fn,(c*l.scale-l.y)*Fn)},o.getTileVec3=function(l,i,c=0){return ef(((i.x-c)*l.scale-l.x)*Fn,(i.y*l.scale-l.y)*Fn,BA(i.z,i.y))},o.getVideo=function(l,i){const c=T.document.createElement("video");c.muted=!0,c.onloadstart=function(){i(null,c)};for(let d=0;d<l.length;d++){const g=T.document.createElement("source");ie(l[d])||(c.crossOrigin="Anonymous"),g.src=l[d],c.appendChild(g)}return{cancel:()=>{}}},o.globeECEFOrigin=function(l,i){const c=[0,0,0];return _c(c,c,$2(bf(i.canonical))),_c(c,c,l),c},o.globePixelsToTileUnits=function(l,i){return Fn/(512*Math.pow(2,l))*Nv(bf(i))},o.globePoleMatrixForTile=function(l,i,c){const d=Rs(new Float64Array(16)),g=1<<l,_=360*(i/g-.5),E=c.point,S=c.worldSize/(c.tileSize*g);return vc(d,d,[E.x,E.y,-c.worldSize/Math.PI/2]),ol(d,d,[S,S,S]),rv(d,d,k(-c._center.lat)),ov(d,d,k(-c._center.lng+_)),Float32Array.from(d)},o.globeTileLatLngCorners=zv,o.globeToMercatorTransition=function(l){return K(5,6,l)},o.identity=Rs,o.identity$1=$A,o.invert=function(l,i){var c=i[0],d=i[1],g=i[2],_=i[3],E=i[4],S=i[5],L=i[6],B=i[7],N=i[8],j=i[9],Y=i[10],Q=i[11],ot=i[12],dt=i[13],mt=i[14],Tt=i[15],Ot=c*S-d*E,Xt=c*L-g*E,Qt=c*B-_*E,$t=d*L-g*S,te=d*B-_*S,me=g*B-_*L,ye=N*dt-j*ot,Ae=N*mt-Y*ot,Ce=N*Tt-Q*ot,ue=j*mt-Y*dt,_e=j*Tt-Q*dt,Re=Y*Tt-Q*mt,Ve=Ot*Re-Xt*_e+Qt*ue+$t*Ce-te*Ae+me*ye;return Ve?(l[0]=(S*Re-L*_e+B*ue)*(Ve=1/Ve),l[1]=(g*_e-d*Re-_*ue)*Ve,l[2]=(dt*me-mt*te+Tt*$t)*Ve,l[3]=(Y*te-j*me-Q*$t)*Ve,l[4]=(L*Ce-E*Re-B*Ae)*Ve,l[5]=(c*Re-g*Ce+_*Ae)*Ve,l[6]=(mt*Qt-ot*me-Tt*Xt)*Ve,l[7]=(N*me-Y*Qt+Q*Xt)*Ve,l[8]=(E*_e-S*Ce+B*ye)*Ve,l[9]=(d*Ce-c*_e-_*ye)*Ve,l[10]=(ot*te-dt*Qt+Tt*Ot)*Ve,l[11]=(j*Qt-N*te-Q*Ot)*Ve,l[12]=(S*Ae-E*ue-L*ye)*Ve,l[13]=(c*ue-d*Ae+g*ye)*Ve,l[14]=(dt*Xt-ot*$t-mt*Ot)*Ve,l[15]=(N*$t-j*Xt+Y*Ot)*Ve,l):null},o.isMapAuthenticated=function(l){return jn.has(l)},o.isMapboxURL=pn,o.isSafariWithAntialiasingBug=function(l){const i=l.navigator?l.navigator.userAgent:null;return!!ee(l)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=hr,o.len=g8,o.length=qA,o.length$1=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},o.loadVectorTile=AE,o.makeRequest=At,o.mercatorXfromLng=tf,o.mercatorYfromLat=xh,o.mercatorZfromAltitude=vh,o.mul=f8,o.mul$1=m8,o.multiply=function(l,i,c){var d=i[0],g=i[1],_=i[2],E=i[3],S=i[4],L=i[5],B=i[6],N=i[7],j=i[8],Y=c[0],Q=c[1],ot=c[2],dt=c[3],mt=c[4],Tt=c[5],Ot=c[6],Xt=c[7],Qt=c[8];return l[0]=Y*d+Q*E+ot*B,l[1]=Y*g+Q*S+ot*N,l[2]=Y*_+Q*L+ot*j,l[3]=dt*d+mt*E+Tt*B,l[4]=dt*g+mt*S+Tt*N,l[5]=dt*_+mt*L+Tt*j,l[6]=Ot*d+Xt*E+Qt*B,l[7]=Ot*g+Xt*S+Qt*N,l[8]=Ot*_+Xt*L+Qt*j,l},o.multiply$1=iv,o.multiply$2=KA,o.nextPowerOfTwo=vt,o.normalize=rf,o.normalize$1=function(l,i){var c=i[0],d=i[1],g=i[2],_=i[3],E=c*c+d*d+g*g+_*_;return E>0&&(E=1/Math.sqrt(E)),l[0]=c*E,l[1]=d*E,l[2]=g*E,l[3]=_*E,l},o.number=bn,o.ortho=function(l,i,c,d,g,_,E){var S=1/(i-c),L=1/(d-g),B=1/(_-E);return l[0]=-2*S,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*L,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*B,l[11]=0,l[12]=(i+c)*S,l[13]=(g+d)*L,l[14]=(E+_)*B,l[15]=1,l},o.pbf=gf,o.perspective=function(l,i,c,d,g){var _,E=1/Math.tan(i/2);return l[0]=E/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=E,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,g!=null&&g!==1/0?(l[10]=(g+d)*(_=1/(d-g)),l[14]=2*g*d*_):(l[10]=-1,l[14]=-2*d),l},o.pick=function(l,i){const c={};for(let d=0;d<i.length;d++){const g=i[d];g in l&&(c[g]=l[g])}return c},o.plugin=eo,o.pointGeometry=M,o.polygonIntersectsBox=GA,o.polygonIntersectsPolygon=zA,o.polygonizeBounds=function(l,i,c=0,d=!0){const g=new M(c,c),_=l.sub(g),E=i.add(g),S=[_,new M(E.x,_.y),E,new M(_.x,E.y)];return d&&S.push(_),S},o.posAttributes=_f,o.postMapLoadEvent=qn,o.postTurnstileEvent=xn,o.potpack=bv,o.prevPowerOfTwo=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},o.radToDeg=z,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(l){return l({pluginStatus:Er,pluginURL:Ur}),Zp.on("pluginStateChange",l),l},o.removeAuthState=function(l){jn.delete(l)},o.renderColorRamp=dv,o.rotateX=rv,o.rotateX$1=t2,o.rotateY=ov,o.rotateZ=function(l,i,c){var d=Math.sin(c),g=Math.cos(c),_=i[0],E=i[1],S=i[2],L=i[3],B=i[4],N=i[5],j=i[6],Y=i[7];return i!==l&&(l[8]=i[8],l[9]=i[9],l[10]=i[10],l[11]=i[11],l[12]=i[12],l[13]=i[13],l[14]=i[14],l[15]=i[15]),l[0]=_*g+B*d,l[1]=E*g+N*d,l[2]=S*g+j*d,l[3]=L*g+Y*d,l[4]=B*g-_*d,l[5]=N*g-E*d,l[6]=j*g-S*d,l[7]=Y*g-L*d,l},o.rotateZ$1=function(l,i,c){c*=.5;var d=i[0],g=i[1],_=i[2],E=i[3],S=Math.sin(c),L=Math.cos(c);return l[0]=d*L+g*S,l[1]=g*L-d*S,l[2]=_*L+E*S,l[3]=E*L-_*S,l},o.scale=ol,o.scale$1=function(l,i,c){return l[0]=i[0]*c,l[1]=i[1]*c,l[2]=i[2]*c,l[3]=i[3]*c,l},o.scale$2=nf,o.scaleAndAdd=cv,o.setCacheLimits=function(l,i){Ai=l,Qr=i},o.setColumn=function(l,i,c){l[4*i+0]=c[0],l[4*i+1]=c[1],l[4*i+2]=c[2],l[4*i+3]=c[3]},o.setRTLTextPlugin=function(l,i,c=!1){if(Er===Yp||Er===pc||Er===Xp)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ur=Te.resolveURL(l),Er=Yp,Kp=i,sa(),c||$a()},o.smoothstep=K,o.spec=Dt,o.storeAuthState=function(l,i){i?jn.add(l):jn.delete(l)},o.sub=Mh,o.subtract=XA,o.symbolSize=uG,o.tileAABB=function(l,i,c,d,g,_,E,S,L){if(L.name==="globe")return nO(l,i,new n0(c,d,g));const B=Mc({z:c,x:d,y:g},L);return new Eo([(_+B.x/B.scale)*i,i*(B.y/B.scale),E],[(_+B.x2/B.scale)*i,i*(B.y2/B.scale),S])},o.tileTransform=Mc,o.transformMat3=function(l,i,c){var d=i[0],g=i[1],_=i[2];return l[0]=d*c[0]+g*c[3]+_*c[6],l[1]=d*c[1]+g*c[4]+_*c[7],l[2]=d*c[2]+g*c[5]+_*c[8],l},o.transformMat4=_c,o.transformMat4$1=wh,o.transformQuat=JA,o.translate=vc,o.transpose=function(l,i){if(l===i){var c=i[1],d=i[2],g=i[5];l[1]=i[3],l[2]=i[6],l[3]=c,l[5]=i[7],l[6]=d,l[7]=g}else l[0]=i[0],l[1]=i[3],l[2]=i[6],l[3]=i[1],l[4]=i[4],l[5]=i[7],l[6]=i[2],l[7]=i[5],l[8]=i[8];return l},o.triggerPluginCompletionEvent=fc,o.uniqueId=ct,o.validateCustomStyleLayer=function(l){const i=[],c=l.id;return c===void 0&&i.push({message:`layers.${c}: missing required property "id"`}),l.render===void 0&&i.push({message:`layers.${c}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&i.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),i},o.validateFilter=l=>$o(Ts(l)),o.validateFog=l=>$o(dy(l)),o.validateLayer=l=>$o(ay(l)),o.validateLight=l=>$o(uy(l)),o.validateSource=l=>$o(cy(l)),o.validateStyle=lc,o.validateTerrain=l=>$o(hy(l)),o.values=at,o.vectorTile=bc,o.version=m,o.warnOnce=bt,o.window=T,o.wrap=Z}),u(["./shared"],function(o){function m(Pt){if(typeof Pt=="number"||typeof Pt=="boolean"||typeof Pt=="string"||Pt==null)return JSON.stringify(Pt);if(Array.isArray(Pt)){let lt="[";for(const At of Pt)lt+=`${m(At)},`;return`${lt}]`}let et="{";for(const lt of Object.keys(Pt).sort())et+=`${lt}:${m(Pt[lt])},`;return`${et}}`}function y(Pt){let et="";for(const lt of o.refProperties)et+=`/${m(Pt[lt])}`;return et}class x{constructor(et){this.keyCache={},et&&this.replace(et)}replace(et){this._layerConfigs={},this._layers={},this.update(et,[])}update(et,lt){for(const zt of et)this._layerConfigs[zt.id]=zt,(this._layers[zt.id]=o.createStyleLayer(zt)).compileFilter(),this.keyCache[zt.id]&&delete this.keyCache[zt.id];for(const zt of lt)delete this.keyCache[zt],delete this._layerConfigs[zt],delete this._layers[zt];this.familiesBySource={};const At=function(zt,Yt){const ne={};for(let Kt=0;Kt<zt.length;Kt++){const ae=Yt&&Yt[zt[Kt].id]||y(zt[Kt]);Yt&&(Yt[zt[Kt].id]=ae);let we=ne[ae];we||(we=ne[ae]=[]),we.push(zt[Kt])}const ie=[];for(const Kt in ne)ie.push(ne[Kt]);return ie}(o.values(this._layerConfigs),this.keyCache);for(const zt of At){const Yt=zt.map(He=>this._layers[He.id]),ne=Yt[0];if(ne.visibility==="none")continue;const ie=ne.source||"";let Kt=this.familiesBySource[ie];Kt||(Kt=this.familiesBySource[ie]={});const ae=ne.sourceLayer||"_geojsonTileLayer";let we=Kt[ae];we||(we=Kt[ae]=[]),we.push(Yt)}}}class M{loadTile(et,lt){const{uid:At,encoding:zt,rawImageData:Yt,padding:ne,buildQuadTree:ie}=et,Kt=o.window.ImageBitmap&&Yt instanceof o.window.ImageBitmap?this.getImageData(Yt,ne):Yt;lt(null,new o.DEMData(At,Kt,zt,ne<1,ie))}getImageData(et,lt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(et.width,et.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=et.width,this.offscreenCanvas.height=et.height,this.offscreenCanvasContext.drawImage(et,0,0,et.width,et.height);const At=this.offscreenCanvasContext.getImageData(-lt,-lt,et.width+2*lt,et.height+2*lt);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),At}}var A=function Pt(et,lt){var At,zt=et&&et.type;if(zt==="FeatureCollection")for(At=0;At<et.features.length;At++)Pt(et.features[At],lt);else if(zt==="GeometryCollection")for(At=0;At<et.geometries.length;At++)Pt(et.geometries[At],lt);else if(zt==="Feature")Pt(et.geometry,lt);else if(zt==="Polygon")T(et.coordinates,lt);else if(zt==="MultiPolygon")for(At=0;At<et.coordinates.length;At++)T(et.coordinates[At],lt);return et};function T(Pt,et){if(Pt.length!==0){P(Pt[0],et);for(var lt=1;lt<Pt.length;lt++)P(Pt[lt],!et)}}function P(Pt,et){for(var lt=0,At=0,zt=0,Yt=Pt.length,ne=Yt-1;zt<Yt;ne=zt++){var ie=(Pt[zt][0]-Pt[ne][0])*(Pt[ne][1]+Pt[zt][1]),Kt=lt+ie;At+=Math.abs(lt)>=Math.abs(ie)?lt-Kt+ie:ie-Kt+lt,lt=Kt}lt+At>=0!=!!et&&Pt.reverse()}const D=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class k{constructor(et){this._feature=et,this.extent=o.EXTENT,this.type=et.type,this.properties=et.tags,"id"in et&&!isNaN(et.id)&&(this.id=parseInt(et.id,10))}loadGeometry(){if(this._feature.type===1){const et=[];for(const lt of this._feature.geometry)et.push([new o.pointGeometry(lt[0],lt[1])]);return et}{const et=[];for(const lt of this._feature.geometry){const At=[];for(const zt of lt)At.push(new o.pointGeometry(zt[0],zt[1]));et.push(At)}return et}}toGeoJSON(et,lt,At){return D.call(this,et,lt,At)}}class z{constructor(et){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=et.length,this._features=et}feature(et){return new k(this._features[et])}}var O=o.vectorTile.VectorTileFeature,U=H;function H(Pt,et){this.options=et||{},this.features=Pt,this.length=Pt.length}function V(Pt,et){this.id=typeof Pt.id=="number"?Pt.id:void 0,this.type=Pt.type,this.rawGeometry=Pt.type===1?[Pt.geometry]:Pt.geometry,this.properties=Pt.tags,this.extent=et||4096}H.prototype.feature=function(Pt){return new V(this.features[Pt],this.options.extent)},V.prototype.loadGeometry=function(){var Pt=this.rawGeometry;this.geometry=[];for(var et=0;et<Pt.length;et++){for(var lt=Pt[et],At=[],zt=0;zt<lt.length;zt++)At.push(new o.pointGeometry(lt[zt][0],lt[zt][1]));this.geometry.push(At)}return this.geometry},V.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pt=this.geometry,et=1/0,lt=-1/0,At=1/0,zt=-1/0,Yt=0;Yt<Pt.length;Yt++)for(var ne=Pt[Yt],ie=0;ie<ne.length;ie++){var Kt=ne[ie];et=Math.min(et,Kt.x),lt=Math.max(lt,Kt.x),At=Math.min(At,Kt.y),zt=Math.max(zt,Kt.y)}return[et,At,lt,zt]},V.prototype.toGeoJSON=O.prototype.toGeoJSON;var W=Z,K=U;function Z(Pt){var et=new o.pbf;return function(lt,At){for(var zt in lt.layers)At.writeMessage(3,tt,lt.layers[zt])}(Pt,et),et.finish()}function tt(Pt,et){var lt;et.writeVarintField(15,Pt.version||1),et.writeStringField(1,Pt.name||""),et.writeVarintField(5,Pt.extent||4096);var At={keys:[],values:[],keycache:{},valuecache:{}};for(lt=0;lt<Pt.length;lt++)At.feature=Pt.feature(lt),et.writeMessage(2,at,At);var zt=At.keys;for(lt=0;lt<zt.length;lt++)et.writeStringField(3,zt[lt]);var Yt=At.values;for(lt=0;lt<Yt.length;lt++)et.writeMessage(4,vt,Yt[lt])}function at(Pt,et){var lt=Pt.feature;lt.id!==void 0&&et.writeVarintField(1,lt.id),et.writeMessage(2,st,Pt),et.writeVarintField(3,lt.type),et.writeMessage(4,xt,lt)}function st(Pt,et){var lt=Pt.feature,At=Pt.keys,zt=Pt.values,Yt=Pt.keycache,ne=Pt.valuecache;for(var ie in lt.properties){var Kt=lt.properties[ie],ae=Yt[ie];if(Kt!==null){ae===void 0&&(At.push(ie),Yt[ie]=ae=At.length-1),et.writeVarint(ae);var we=typeof Kt;we!=="string"&&we!=="boolean"&&we!=="number"&&(Kt=JSON.stringify(Kt));var He=we+":"+Kt,De=ne[He];De===void 0&&(zt.push(Kt),ne[He]=De=zt.length-1),et.writeVarint(De)}}}function nt(Pt,et){return(et<<3)+(7&Pt)}function ct(Pt){return Pt<<1^Pt>>31}function xt(Pt,et){for(var lt=Pt.loadGeometry(),At=Pt.type,zt=0,Yt=0,ne=lt.length,ie=0;ie<ne;ie++){var Kt=lt[ie],ae=1;At===1&&(ae=Kt.length),et.writeVarint(nt(1,ae));for(var we=At===3?Kt.length-1:Kt.length,He=0;He<we;He++){He===1&&At!==1&&et.writeVarint(nt(2,we-1));var De=Kt[He].x-zt,Mn=Kt[He].y-Yt;et.writeVarint(ct(De)),et.writeVarint(ct(Mn)),zt+=De,Yt+=Mn}At===3&&et.writeVarint(nt(7,1))}}function vt(Pt,et){var lt=typeof Pt;lt==="string"?et.writeStringField(1,Pt):lt==="boolean"?et.writeBooleanField(7,Pt):lt==="number"&&(Pt%1!=0?et.writeDoubleField(3,Pt):Pt<0?et.writeSVarintField(6,Pt):et.writeVarintField(5,Pt))}function Zt(Pt,et,lt,At,zt,Yt){if(zt-At<=lt)return;const ne=At+zt>>1;ce(Pt,et,ne,At,zt,Yt%2),Zt(Pt,et,lt,At,ne-1,Yt+1),Zt(Pt,et,lt,ne+1,zt,Yt+1)}function ce(Pt,et,lt,At,zt,Yt){for(;zt>At;){if(zt-At>600){const ae=zt-At+1,we=lt-At+1,He=Math.log(ae),De=.5*Math.exp(2*He/3),Mn=.5*Math.sqrt(He*De*(ae-De)/ae)*(we-ae/2<0?-1:1);ce(Pt,et,lt,Math.max(At,Math.floor(lt-we*De/ae+Mn)),Math.min(zt,Math.floor(lt+(ae-we)*De/ae+Mn)),Yt)}const ne=et[2*lt+Yt];let ie=At,Kt=zt;for(le(Pt,et,At,lt),et[2*zt+Yt]>ne&&le(Pt,et,At,zt);ie<Kt;){for(le(Pt,et,ie,Kt),ie++,Kt--;et[2*ie+Yt]<ne;)ie++;for(;et[2*Kt+Yt]>ne;)Kt--}et[2*At+Yt]===ne?le(Pt,et,At,Kt):(Kt++,le(Pt,et,Kt,zt)),Kt<=lt&&(At=Kt+1),lt<=Kt&&(zt=Kt-1)}}function le(Pt,et,lt,At){fe(Pt,lt,At),fe(et,2*lt,2*At),fe(et,2*lt+1,2*At+1)}function fe(Pt,et,lt){const At=Pt[et];Pt[et]=Pt[lt],Pt[lt]=At}function de(Pt,et,lt,At){const zt=Pt-lt,Yt=et-At;return zt*zt+Yt*Yt}W.fromVectorTileJs=Z,W.fromGeojsonVt=function(Pt,et){et=et||{};var lt={};for(var At in Pt)lt[At]=new U(Pt[At].features,et),lt[At].name=At,lt[At].version=et.version,lt[At].extent=et.extent;return Z({layers:lt})},W.GeoJSONWrapper=K;const Le=Pt=>Pt[0],Lt=Pt=>Pt[1];class bt{constructor(et,lt=Le,At=Lt,zt=64,Yt=Float64Array){this.nodeSize=zt,this.points=et;const ne=et.length<65536?Uint16Array:Uint32Array,ie=this.ids=new ne(et.length),Kt=this.coords=new Yt(2*et.length);for(let ae=0;ae<et.length;ae++)ie[ae]=ae,Kt[2*ae]=lt(et[ae]),Kt[2*ae+1]=At(et[ae]);Zt(ie,Kt,zt,0,ie.length-1,0)}range(et,lt,At,zt){return function(Yt,ne,ie,Kt,ae,we,He){const De=[0,Yt.length-1,0],Mn=[];let rt,ht;for(;De.length;){const Vt=De.pop(),Dt=De.pop(),Se=De.pop();if(Dt-Se<=He){for(let ln=Se;ln<=Dt;ln++)rt=ne[2*ln],ht=ne[2*ln+1],rt>=ie&&rt<=ae&&ht>=Kt&&ht<=we&&Mn.push(Yt[ln]);continue}const Me=Math.floor((Se+Dt)/2);rt=ne[2*Me],ht=ne[2*Me+1],rt>=ie&&rt<=ae&&ht>=Kt&&ht<=we&&Mn.push(Yt[Me]);const Oe=(Vt+1)%2;(Vt===0?ie<=rt:Kt<=ht)&&(De.push(Se),De.push(Me-1),De.push(Oe)),(Vt===0?ae>=rt:we>=ht)&&(De.push(Me+1),De.push(Dt),De.push(Oe))}return Mn}(this.ids,this.coords,et,lt,At,zt,this.nodeSize)}within(et,lt,At){return function(zt,Yt,ne,ie,Kt,ae){const we=[0,zt.length-1,0],He=[],De=Kt*Kt;for(;we.length;){const Mn=we.pop(),rt=we.pop(),ht=we.pop();if(rt-ht<=ae){for(let Oe=ht;Oe<=rt;Oe++)de(Yt[2*Oe],Yt[2*Oe+1],ne,ie)<=De&&He.push(zt[Oe]);continue}const Vt=Math.floor((ht+rt)/2),Dt=Yt[2*Vt],Se=Yt[2*Vt+1];de(Dt,Se,ne,ie)<=De&&He.push(zt[Vt]);const Me=(Mn+1)%2;(Mn===0?ne-Kt<=Dt:ie-Kt<=Se)&&(we.push(ht),we.push(Vt-1),we.push(Me)),(Mn===0?ne+Kt>=Dt:ie+Kt>=Se)&&(we.push(Vt+1),we.push(rt),we.push(Me))}return He}(this.ids,this.coords,et,lt,At,this.nodeSize)}}const qt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Pt=>Pt},Wt=Math.fround||(Nt=new Float32Array(1),Pt=>(Nt[0]=+Pt,Nt[0]));var Nt;class se{constructor(et){this.options=Te(Object.create(qt),et),this.trees=new Array(this.options.maxZoom+1)}load(et){const{log:lt,minZoom:At,maxZoom:zt,nodeSize:Yt}=this.options;lt&&console.time("total time");const ne=`prepare ${et.length} points`;lt&&console.time(ne),this.points=et;let ie=[];for(let Kt=0;Kt<et.length;Kt++)et[Kt].geometry&&ie.push(wt(et[Kt],Kt));this.trees[zt+1]=new bt(ie,We,yt,Yt,Float32Array),lt&&console.timeEnd(ne);for(let Kt=zt;Kt>=At;Kt--){const ae=+Date.now();ie=this._cluster(ie,Kt),this.trees[Kt]=new bt(ie,We,yt,Yt,Float32Array),lt&&console.log("z%d: %d clusters in %dms",Kt,ie.length,+Date.now()-ae)}return lt&&console.timeEnd("total time"),this}getClusters(et,lt){let At=((et[0]+180)%360+360)%360-180;const zt=Math.max(-90,Math.min(90,et[1]));let Yt=et[2]===180?180:((et[2]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,et[3]));if(et[2]-et[0]>=360)At=-180,Yt=180;else if(At>Yt){const we=this.getClusters([At,zt,180,ne],lt),He=this.getClusters([-180,zt,Yt,ne],lt);return we.concat(He)}const ie=this.trees[this._limitZoom(lt)],Kt=ie.range(jt(At),ee(ne),jt(Yt),ee(zt)),ae=[];for(const we of Kt){const He=ie.points[we];ae.push(He.numPoints?Ct(He):this.points[He.index])}return ae}getChildren(et){const lt=this._getOriginId(et),At=this._getOriginZoom(et),zt="No cluster with the specified id.",Yt=this.trees[At];if(!Yt)throw new Error(zt);const ne=Yt.points[lt];if(!ne)throw new Error(zt);const ie=this.options.radius/(this.options.extent*Math.pow(2,At-1)),Kt=Yt.within(ne.x,ne.y,ie),ae=[];for(const we of Kt){const He=Yt.points[we];He.parentId===et&&ae.push(He.numPoints?Ct(He):this.points[He.index])}if(ae.length===0)throw new Error(zt);return ae}getLeaves(et,lt,At){const zt=[];return this._appendLeaves(zt,et,lt=lt||10,At=At||0,0),zt}getTile(et,lt,At){const zt=this.trees[this._limitZoom(et)],Yt=Math.pow(2,et),{extent:ne,radius:ie}=this.options,Kt=ie/ne,ae=(At-Kt)/Yt,we=(At+1+Kt)/Yt,He={features:[]};return this._addTileFeatures(zt.range((lt-Kt)/Yt,ae,(lt+1+Kt)/Yt,we),zt.points,lt,At,Yt,He),lt===0&&this._addTileFeatures(zt.range(1-Kt/Yt,ae,1,we),zt.points,Yt,At,Yt,He),lt===Yt-1&&this._addTileFeatures(zt.range(0,ae,Kt/Yt,we),zt.points,-1,At,Yt,He),He.features.length?He:null}getClusterExpansionZoom(et){let lt=this._getOriginZoom(et)-1;for(;lt<=this.options.maxZoom;){const At=this.getChildren(et);if(lt++,At.length!==1)break;et=At[0].properties.cluster_id}return lt}_appendLeaves(et,lt,At,zt,Yt){const ne=this.getChildren(lt);for(const ie of ne){const Kt=ie.properties;if(Kt&&Kt.cluster?Yt+Kt.point_count<=zt?Yt+=Kt.point_count:Yt=this._appendLeaves(et,Kt.cluster_id,At,zt,Yt):Yt<zt?Yt++:et.push(ie),et.length===At)break}return Yt}_addTileFeatures(et,lt,At,zt,Yt,ne){for(const ie of et){const Kt=lt[ie],ae=Kt.numPoints;let we,He,De;if(ae)we=Mt(Kt),He=Kt.x,De=Kt.y;else{const ht=this.points[Kt.index];we=ht.properties,He=jt(ht.geometry.coordinates[0]),De=ee(ht.geometry.coordinates[1])}const Mn={type:1,geometry:[[Math.round(this.options.extent*(He*Yt-At)),Math.round(this.options.extent*(De*Yt-zt))]],tags:we};let rt;ae?rt=Kt.id:this.options.generateId?rt=Kt.index:this.points[Kt.index].id&&(rt=this.points[Kt.index].id),rt!==void 0&&(Mn.id=rt),ne.features.push(Mn)}}_limitZoom(et){return Math.max(this.options.minZoom,Math.min(+et,this.options.maxZoom+1))}_cluster(et,lt){const At=[],{radius:zt,extent:Yt,reduce:ne,minPoints:ie}=this.options,Kt=zt/(Yt*Math.pow(2,lt));for(let ae=0;ae<et.length;ae++){const we=et[ae];if(we.zoom<=lt)continue;we.zoom=lt;const He=this.trees[lt+1],De=He.within(we.x,we.y,Kt),Mn=we.numPoints||1;let rt=Mn;for(const ht of De){const Vt=He.points[ht];Vt.zoom>lt&&(rt+=Vt.numPoints||1)}if(rt>Mn&&rt>=ie){let ht=we.x*Mn,Vt=we.y*Mn,Dt=ne&&Mn>1?this._map(we,!0):null;const Se=(ae<<5)+(lt+1)+this.points.length;for(const Me of De){const Oe=He.points[Me];if(Oe.zoom<=lt)continue;Oe.zoom=lt;const ln=Oe.numPoints||1;ht+=Oe.x*ln,Vt+=Oe.y*ln,Oe.parentId=Se,ne&&(Dt||(Dt=this._map(we,!0)),ne(Dt,this._map(Oe)))}we.parentId=Se,At.push(_t(ht/rt,Vt/rt,Se,rt,Dt))}else if(At.push(we),rt>1)for(const ht of De){const Vt=He.points[ht];Vt.zoom<=lt||(Vt.zoom=lt,At.push(Vt))}}return At}_getOriginId(et){return et-this.points.length>>5}_getOriginZoom(et){return(et-this.points.length)%32}_map(et,lt){if(et.numPoints)return lt?Te({},et.properties):et.properties;const At=this.points[et.index].properties,zt=this.options.map(At);return lt&&zt===At?Te({},zt):zt}}function _t(Pt,et,lt,At,zt){return{x:Wt(Pt),y:Wt(et),zoom:1/0,id:lt,parentId:-1,numPoints:At,properties:zt}}function wt(Pt,et){const[lt,At]=Pt.geometry.coordinates;return{x:Wt(jt(lt)),y:Wt(ee(At)),zoom:1/0,index:et,parentId:-1}}function Ct(Pt){return{type:"Feature",id:Pt.id,properties:Mt(Pt),geometry:{type:"Point",coordinates:[(et=Pt.x,360*(et-.5)),pe(Pt.y)]}};var et}function Mt(Pt){const et=Pt.numPoints,lt=et>=1e4?`${Math.round(et/1e3)}k`:et>=1e3?Math.round(et/100)/10+"k":et;return Te(Te({},Pt.properties),{cluster:!0,cluster_id:Pt.id,point_count:et,point_count_abbreviated:lt})}function jt(Pt){return Pt/360+.5}function ee(Pt){const et=Math.sin(Pt*Math.PI/180),lt=.5-.25*Math.log((1+et)/(1-et))/Math.PI;return lt<0?0:lt>1?1:lt}function pe(Pt){const et=(180-360*Pt)*Math.PI/180;return 360*Math.atan(Math.exp(et))/Math.PI-90}function Te(Pt,et){for(const lt in et)Pt[lt]=et[lt];return Pt}function We(Pt){return Pt.x}function yt(Pt){return Pt.y}function St(Pt,et,lt,At){for(var zt,Yt=At,ne=lt-et>>1,ie=lt-et,Kt=Pt[et],ae=Pt[et+1],we=Pt[lt],He=Pt[lt+1],De=et+3;De<lt;De+=3){var Mn=Ee(Pt[De],Pt[De+1],Kt,ae,we,He);if(Mn>Yt)zt=De,Yt=Mn;else if(Mn===Yt){var rt=Math.abs(De-ne);rt<ie&&(zt=De,ie=rt)}}Yt>At&&(zt-et>3&&St(Pt,et,zt,At),Pt[zt+2]=Yt,lt-zt>3&&St(Pt,zt,lt,At))}function Ee(Pt,et,lt,At,zt,Yt){var ne=zt-lt,ie=Yt-At;if(ne!==0||ie!==0){var Kt=((Pt-lt)*ne+(et-At)*ie)/(ne*ne+ie*ie);Kt>1?(lt=zt,At=Yt):Kt>0&&(lt+=ne*Kt,At+=ie*Kt)}return(ne=Pt-lt)*ne+(ie=et-At)*ie}function be(Pt,et,lt,At){var zt={id:Pt===void 0?null:Pt,type:et,geometry:lt,tags:At,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Yt){var ne=Yt.geometry,ie=Yt.type;if(ie==="Point"||ie==="MultiPoint"||ie==="LineString")En(Yt,ne);else if(ie==="Polygon"||ie==="MultiLineString")for(var Kt=0;Kt<ne.length;Kt++)En(Yt,ne[Kt]);else if(ie==="MultiPolygon")for(Kt=0;Kt<ne.length;Kt++)for(var ae=0;ae<ne[Kt].length;ae++)En(Yt,ne[Kt][ae])}(zt),zt}function En(Pt,et){for(var lt=0;lt<et.length;lt+=3)Pt.minX=Math.min(Pt.minX,et[lt]),Pt.minY=Math.min(Pt.minY,et[lt+1]),Pt.maxX=Math.max(Pt.maxX,et[lt]),Pt.maxY=Math.max(Pt.maxY,et[lt+1])}function mn(Pt,et,lt,At){if(et.geometry){var zt=et.geometry.coordinates,Yt=et.geometry.type,ne=Math.pow(lt.tolerance/((1<<lt.maxZoom)*lt.extent),2),ie=[],Kt=et.id;if(lt.promoteId?Kt=et.properties[lt.promoteId]:lt.generateId&&(Kt=At||0),Yt==="Point")an(zt,ie);else if(Yt==="MultiPoint")for(var ae=0;ae<zt.length;ae++)an(zt[ae],ie);else if(Yt==="LineString")yn(zt,ie,ne,!1);else if(Yt==="MultiLineString"){if(lt.lineMetrics){for(ae=0;ae<zt.length;ae++)yn(zt[ae],ie=[],ne,!1),Pt.push(be(Kt,"LineString",ie,et.properties));return}Tn(zt,ie,ne,!1)}else if(Yt==="Polygon")Tn(zt,ie,ne,!0);else{if(Yt!=="MultiPolygon"){if(Yt==="GeometryCollection"){for(ae=0;ae<et.geometry.geometries.length;ae++)mn(Pt,{id:Kt,geometry:et.geometry.geometries[ae],properties:et.properties},lt,At);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ae=0;ae<zt.length;ae++){var we=[];Tn(zt[ae],we,ne,!0),ie.push(we)}}Pt.push(be(Kt,Yt,ie,et.properties))}}function an(Pt,et){et.push(pn(Pt[0])),et.push(qe(Pt[1])),et.push(0)}function yn(Pt,et,lt,At){for(var zt,Yt,ne=0,ie=0;ie<Pt.length;ie++){var Kt=pn(Pt[ie][0]),ae=qe(Pt[ie][1]);et.push(Kt),et.push(ae),et.push(0),ie>0&&(ne+=At?(zt*ae-Kt*Yt)/2:Math.sqrt(Math.pow(Kt-zt,2)+Math.pow(ae-Yt,2))),zt=Kt,Yt=ae}var we=et.length-3;et[2]=1,St(et,0,we,lt),et[we+2]=1,et.size=Math.abs(ne),et.start=0,et.end=et.size}function Tn(Pt,et,lt,At){for(var zt=0;zt<Pt.length;zt++){var Yt=[];yn(Pt[zt],Yt,lt,At),et.push(Yt)}}function pn(Pt){return Pt/360+.5}function qe(Pt){var et=Math.sin(Pt*Math.PI/180),lt=.5-.25*Math.log((1+et)/(1-et))/Math.PI;return lt<0?0:lt>1?1:lt}function hn(Pt,et,lt,At,zt,Yt,ne,ie){if(At/=et,Yt>=(lt/=et)&&ne<At)return Pt;if(ne<lt||Yt>=At)return null;for(var Kt=[],ae=0;ae<Pt.length;ae++){var we=Pt[ae],He=we.geometry,De=we.type,Mn=zt===0?we.minX:we.minY,rt=zt===0?we.maxX:we.maxY;if(Mn>=lt&&rt<At)Kt.push(we);else if(!(rt<lt||Mn>=At)){var ht=[];if(De==="Point"||De==="MultiPoint")Je(He,ht,lt,At,zt);else if(De==="LineString")Jt(He,ht,lt,At,zt,!1,ie.lineMetrics);else if(De==="MultiLineString")rn(He,ht,lt,At,zt,!1);else if(De==="Polygon")rn(He,ht,lt,At,zt,!0);else if(De==="MultiPolygon")for(var Vt=0;Vt<He.length;Vt++){var Dt=[];rn(He[Vt],Dt,lt,At,zt,!0),Dt.length&&ht.push(Dt)}if(ht.length){if(ie.lineMetrics&&De==="LineString"){for(Vt=0;Vt<ht.length;Vt++)Kt.push(be(we.id,De,ht[Vt],we.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(ht.length===1?(De="LineString",ht=ht[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=ht.length===3?"Point":"MultiPoint"),Kt.push(be(we.id,De,ht,we.tags))}}}return Kt.length?Kt:null}function Je(Pt,et,lt,At,zt){for(var Yt=0;Yt<Pt.length;Yt+=3){var ne=Pt[Yt+zt];ne>=lt&&ne<=At&&(et.push(Pt[Yt]),et.push(Pt[Yt+1]),et.push(Pt[Yt+2]))}}function Jt(Pt,et,lt,At,zt,Yt,ne){for(var ie,Kt,ae=je(Pt),we=zt===0?xn:On,He=Pt.start,De=0;De<Pt.length-3;De+=3){var Mn=Pt[De],rt=Pt[De+1],ht=Pt[De+2],Vt=Pt[De+3],Dt=Pt[De+4],Se=zt===0?Mn:rt,Me=zt===0?Vt:Dt,Oe=!1;ne&&(ie=Math.sqrt(Math.pow(Mn-Vt,2)+Math.pow(rt-Dt,2))),Se<lt?Me>lt&&(Kt=we(ae,Mn,rt,Vt,Dt,lt),ne&&(ae.start=He+ie*Kt)):Se>At?Me<At&&(Kt=we(ae,Mn,rt,Vt,Dt,At),ne&&(ae.start=He+ie*Kt)):In(ae,Mn,rt,ht),Me<lt&&Se>=lt&&(Kt=we(ae,Mn,rt,Vt,Dt,lt),Oe=!0),Me>At&&Se<=At&&(Kt=we(ae,Mn,rt,Vt,Dt,At),Oe=!0),!Yt&&Oe&&(ne&&(ae.end=He+ie*Kt),et.push(ae),ae=je(Pt)),ne&&(He+=ie)}var ln=Pt.length-3;Mn=Pt[ln],rt=Pt[ln+1],ht=Pt[ln+2],(Se=zt===0?Mn:rt)>=lt&&Se<=At&&In(ae,Mn,rt,ht),ln=ae.length-3,Yt&&ln>=3&&(ae[ln]!==ae[0]||ae[ln+1]!==ae[1])&&In(ae,ae[0],ae[1],ae[2]),ae.length&&et.push(ae)}function je(Pt){var et=[];return et.size=Pt.size,et.start=Pt.start,et.end=Pt.end,et}function rn(Pt,et,lt,At,zt,Yt){for(var ne=0;ne<Pt.length;ne++)Jt(Pt[ne],et,lt,At,zt,Yt,!1)}function In(Pt,et,lt,At){Pt.push(et),Pt.push(lt),Pt.push(At)}function xn(Pt,et,lt,At,zt,Yt){var ne=(Yt-et)/(At-et);return Pt.push(Yt),Pt.push(lt+(zt-lt)*ne),Pt.push(1),ne}function On(Pt,et,lt,At,zt,Yt){var ne=(Yt-lt)/(zt-lt);return Pt.push(et+(At-et)*ne),Pt.push(Yt),Pt.push(1),ne}function qn(Pt,et){for(var lt=[],At=0;At<Pt.length;At++){var zt,Yt=Pt[At],ne=Yt.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")zt=Jn(Yt.geometry,et);else if(ne==="MultiLineString"||ne==="Polygon"){zt=[];for(var ie=0;ie<Yt.geometry.length;ie++)zt.push(Jn(Yt.geometry[ie],et))}else if(ne==="MultiPolygon")for(zt=[],ie=0;ie<Yt.geometry.length;ie++){for(var Kt=[],ae=0;ae<Yt.geometry[ie].length;ae++)Kt.push(Jn(Yt.geometry[ie][ae],et));zt.push(Kt)}lt.push(be(Yt.id,ne,zt,Yt.tags))}return lt}function Jn(Pt,et){var lt=[];lt.size=Pt.size,Pt.start!==void 0&&(lt.start=Pt.start,lt.end=Pt.end);for(var At=0;At<Pt.length;At+=3)lt.push(Pt[At]+et,Pt[At+1],Pt[At+2]);return lt}function Ji(Pt,et){if(Pt.transformed)return Pt;var lt,At,zt,Yt=1<<Pt.z,ne=Pt.x,ie=Pt.y;for(lt=0;lt<Pt.features.length;lt++){var Kt=Pt.features[lt],ae=Kt.geometry,we=Kt.type;if(Kt.geometry=[],we===1)for(At=0;At<ae.length;At+=2)Kt.geometry.push(jn(ae[At],ae[At+1],et,Yt,ne,ie));else for(At=0;At<ae.length;At++){var He=[];for(zt=0;zt<ae[At].length;zt+=2)He.push(jn(ae[At][zt],ae[At][zt+1],et,Yt,ne,ie));Kt.geometry.push(He)}}return Pt.transformed=!0,Pt}function jn(Pt,et,lt,At,zt,Yt){return[Math.round(lt*(Pt*At-zt)),Math.round(lt*(et*At-Yt))]}function Bi(Pt,et,lt,At,zt){for(var Yt=et===zt.maxZoom?0:zt.tolerance/((1<<et)*zt.extent),ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:lt,y:At,z:et,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ie=0;ie<Pt.length;ie++){ne.numFeatures++,oi(ne,Pt[ie],Yt,zt);var Kt=Pt[ie].minX,ae=Pt[ie].minY,we=Pt[ie].maxX,He=Pt[ie].maxY;Kt<ne.minX&&(ne.minX=Kt),ae<ne.minY&&(ne.minY=ae),we>ne.maxX&&(ne.maxX=we),He>ne.maxY&&(ne.maxY=He)}return ne}function oi(Pt,et,lt,At){var zt=et.geometry,Yt=et.type,ne=[];if(Yt==="Point"||Yt==="MultiPoint")for(var ie=0;ie<zt.length;ie+=3)ne.push(zt[ie]),ne.push(zt[ie+1]),Pt.numPoints++,Pt.numSimplified++;else if(Yt==="LineString")or(ne,zt,Pt,lt,!1,!1);else if(Yt==="MultiLineString"||Yt==="Polygon")for(ie=0;ie<zt.length;ie++)or(ne,zt[ie],Pt,lt,Yt==="Polygon",ie===0);else if(Yt==="MultiPolygon")for(var Kt=0;Kt<zt.length;Kt++){var ae=zt[Kt];for(ie=0;ie<ae.length;ie++)or(ne,ae[ie],Pt,lt,!0,ie===0)}if(ne.length){var we=et.tags||null;if(Yt==="LineString"&&At.lineMetrics){for(var He in we={},et.tags)we[He]=et.tags[He];we.mapbox_clip_start=zt.start/zt.size,we.mapbox_clip_end=zt.end/zt.size}var De={geometry:ne,type:Yt==="Polygon"||Yt==="MultiPolygon"?3:Yt==="LineString"||Yt==="MultiLineString"?2:1,tags:we};et.id!==null&&(De.id=et.id),Pt.features.push(De)}}function or(Pt,et,lt,At,zt,Yt){var ne=At*At;if(At>0&&et.size<(zt?ne:At))lt.numPoints+=et.length/3;else{for(var ie=[],Kt=0;Kt<et.length;Kt+=3)(At===0||et[Kt+2]>ne)&&(lt.numSimplified++,ie.push(et[Kt]),ie.push(et[Kt+1])),lt.numPoints++;zt&&function(ae,we){for(var He=0,De=0,Mn=ae.length,rt=Mn-2;De<Mn;rt=De,De+=2)He+=(ae[De]-ae[rt])*(ae[De+1]+ae[rt+1]);if(He>0===we)for(De=0,Mn=ae.length;De<Mn/2;De+=2){var ht=ae[De],Vt=ae[De+1];ae[De]=ae[Mn-2-De],ae[De+1]=ae[Mn-1-De],ae[Mn-2-De]=ht,ae[Mn-1-De]=Vt}}(ie,Yt),Pt.push(ie)}}function Ai(Pt,et){var lt=(et=this.options=function(zt,Yt){for(var ne in Yt)zt[ne]=Yt[ne];return zt}(Object.create(this.options),et)).debug;if(lt&&console.time("preprocess data"),et.maxZoom<0||et.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(et.promoteId&&et.generateId)throw new Error("promoteId and generateId cannot be used together.");var At=function(zt,Yt){var ne=[];if(zt.type==="FeatureCollection")for(var ie=0;ie<zt.features.length;ie++)mn(ne,zt.features[ie],Yt,ie);else mn(ne,zt.type==="Feature"?zt:{geometry:zt},Yt);return ne}(Pt,et);this.tiles={},this.tileCoords=[],lt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",et.indexMaxZoom,et.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(At=function(zt,Yt){var ne=Yt.buffer/Yt.extent,ie=zt,Kt=hn(zt,1,-1-ne,ne,0,-1,2,Yt),ae=hn(zt,1,1-ne,2+ne,0,-1,2,Yt);return(Kt||ae)&&(ie=hn(zt,1,-ne,1+ne,0,-1,2,Yt)||[],Kt&&(ie=qn(Kt,1).concat(ie)),ae&&(ie=ie.concat(qn(ae,-1)))),ie}(At,et)).length&&this.splitTile(At,0,0,0),lt&&(At.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qr(Pt,et,lt){return 32*((1<<Pt)*lt+et)+Pt}function Oi(Pt,et){const lt=Pt.tileID.canonical;if(!this._geoJSONIndex)return et(null,null);const At=this._geoJSONIndex.getTile(lt.z,lt.x,lt.y);if(!At)return et(null,null);const zt=new z(At.features);let Yt=W(zt);Yt.byteOffset===0&&Yt.byteLength===Yt.buffer.byteLength||(Yt=new Uint8Array(Yt)),et(null,{vectorTile:zt,rawData:Yt.buffer})}Ai.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ai.prototype.splitTile=function(Pt,et,lt,At,zt,Yt,ne){for(var ie=[Pt,et,lt,At],Kt=this.options,ae=Kt.debug;ie.length;){At=ie.pop(),lt=ie.pop(),et=ie.pop(),Pt=ie.pop();var we=1<<et,He=Qr(et,lt,At),De=this.tiles[He];if(!De&&(ae>1&&console.time("creation"),De=this.tiles[He]=Bi(Pt,et,lt,At,Kt),this.tileCoords.push({z:et,x:lt,y:At}),ae)){ae>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",et,lt,At,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));var Mn="z"+et;this.stats[Mn]=(this.stats[Mn]||0)+1,this.total++}if(De.source=Pt,zt){if(et===Kt.maxZoom||et===zt)continue;var rt=1<<zt-et;if(lt!==Math.floor(Yt/rt)||At!==Math.floor(ne/rt))continue}else if(et===Kt.indexMaxZoom||De.numPoints<=Kt.indexMaxPoints)continue;if(De.source=null,Pt.length!==0){ae>1&&console.time("clipping");var ht,Vt,Dt,Se,Me,Oe,ln=.5*Kt.buffer/Kt.extent,kn=.5-ln,Bn=.5+ln,Pe=1+ln;ht=Vt=Dt=Se=null,Me=hn(Pt,we,lt-ln,lt+Bn,0,De.minX,De.maxX,Kt),Oe=hn(Pt,we,lt+kn,lt+Pe,0,De.minX,De.maxX,Kt),Pt=null,Me&&(ht=hn(Me,we,At-ln,At+Bn,1,De.minY,De.maxY,Kt),Vt=hn(Me,we,At+kn,At+Pe,1,De.minY,De.maxY,Kt),Me=null),Oe&&(Dt=hn(Oe,we,At-ln,At+Bn,1,De.minY,De.maxY,Kt),Se=hn(Oe,we,At+kn,At+Pe,1,De.minY,De.maxY,Kt),Oe=null),ae>1&&console.timeEnd("clipping"),ie.push(ht||[],et+1,2*lt,2*At),ie.push(Vt||[],et+1,2*lt,2*At+1),ie.push(Dt||[],et+1,2*lt+1,2*At),ie.push(Se||[],et+1,2*lt+1,2*At+1)}}},Ai.prototype.getTile=function(Pt,et,lt){var At=this.options,zt=At.extent,Yt=At.debug;if(Pt<0||Pt>24)return null;var ne=1<<Pt,ie=Qr(Pt,et=(et%ne+ne)%ne,lt);if(this.tiles[ie])return Ji(this.tiles[ie],zt);Yt>1&&console.log("drilling down to z%d-%d-%d",Pt,et,lt);for(var Kt,ae=Pt,we=et,He=lt;!Kt&&ae>0;)ae--,we=Math.floor(we/2),He=Math.floor(He/2),Kt=this.tiles[Qr(ae,we,He)];return Kt&&Kt.source?(Yt>1&&console.log("found parent tile z%d-%d-%d",ae,we,He),Yt>1&&console.time("drilling down"),this.splitTile(Kt.source,ae,we,He,Pt,et,lt),Yt>1&&console.timeEnd("drilling down"),this.tiles[ie]?Ji(this.tiles[ie],zt):null):null};class $r extends o.VectorTileWorkerSource{constructor(et,lt,At,zt,Yt){super(et,lt,At,zt,Oi),Yt&&(this.loadGeoJSON=Yt)}loadData(et,lt){const At=et&&et.request,zt=At&&At.collectResourceTiming;this.loadGeoJSON(et,(Yt,ne)=>{if(Yt||!ne)return lt(Yt);if(typeof ne!="object")return lt(new Error(`Input data given to '${et.source}' is not a valid GeoJSON object.`));{A(ne,!0);try{if(et.filter){const Kt=o.createExpression(et.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Kt.result==="error")throw new Error(Kt.value.map(we=>`${we.key}: ${we.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(we=>Kt.value.evaluate({zoom:0},we))}}this._geoJSONIndex=et.cluster?new se(function({superclusterOptions:Kt,clusterProperties:ae}){if(!ae||!Kt)return Kt;const we={},He={},De={accumulated:null,zoom:0},Mn={properties:null},rt=Object.keys(ae);for(const ht of rt){const[Vt,Dt]=ae[ht],Se=o.createExpression(Dt),Me=o.createExpression(typeof Vt=="string"?[Vt,["accumulated"],["get",ht]]:Vt);we[ht]=Se.value,He[ht]=Me.value}return Kt.map=ht=>{Mn.properties=ht;const Vt={};for(const Dt of rt)Vt[Dt]=we[Dt].evaluate(De,Mn);return Vt},Kt.reduce=(ht,Vt)=>{Mn.properties=Vt;for(const Dt of rt)De.accumulated=ht[Dt],ht[Dt]=He[Dt].evaluate(De,Mn)},Kt}(et)).load(ne.features):function(Kt,ae){return new Ai(Kt,ae)}(ne,et.geojsonVtOptions)}catch(Kt){return lt(Kt)}this.loaded={};const ie={};if(zt){const Kt=o.getPerformanceMeasurement(At);Kt&&(ie.resourceTiming={},ie.resourceTiming[et.source]=JSON.parse(JSON.stringify(Kt)))}lt(null,ie)}})}reloadTile(et,lt){const At=this.loaded;return At&&At[et.uid]?super.reloadTile(et,lt):this.loadTile(et,lt)}loadGeoJSON(et,lt){if(et.request)o.getJSON(et.request,lt);else{if(typeof et.data!="string")return lt(new Error(`Input data given to '${et.source}' is not a valid GeoJSON object.`));try{return lt(null,JSON.parse(et.data))}catch(At){return lt(new Error(`Input data given to '${et.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(et,lt){try{lt(null,this._geoJSONIndex.getClusterExpansionZoom(et.clusterId))}catch(At){lt(At)}}getClusterChildren(et,lt){try{lt(null,this._geoJSONIndex.getChildren(et.clusterId))}catch(At){lt(At)}}getClusterLeaves(et,lt){try{lt(null,this._geoJSONIndex.getLeaves(et.clusterId,et.limit,et.offset))}catch(At){lt(At)}}}class Ir{constructor(et){this.self=et,this.actor=new o.Actor(et,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:$r},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(lt,At)=>{if(this.workerSourceTypes[lt])throw new Error(`Worker source with name "${lt}" already registered.`);this.workerSourceTypes[lt]=At},this.self.registerRTLTextPlugin=lt=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=lt.applyArabicShaping,o.plugin.processBidirectionalText=lt.processBidirectionalText,o.plugin.processStyledBidirectionalText=lt.processStyledBidirectionalText}}clearCaches(et,lt,At){delete this.layerIndexes[et],delete this.availableImages[et],delete this.workerSources[et],delete this.demWorkerSources[et],At()}checkIfReady(et,lt,At){At()}setReferrer(et,lt){this.referrer=lt}spriteLoaded(et,lt){this.isSpriteLoaded[et]=lt;for(const At in this.workerSources[et]){const zt=this.workerSources[et][At];for(const Yt in zt)zt[Yt]instanceof o.VectorTileWorkerSource&&(zt[Yt].isSpriteLoaded=lt,zt[Yt].fire(new o.Event("isSpriteLoaded")))}}setImages(et,lt,At){this.availableImages[et]=lt;for(const zt in this.workerSources[et]){const Yt=this.workerSources[et][zt];for(const ne in Yt)Yt[ne].availableImages=lt}At()}enableTerrain(et,lt,At){this.terrain=lt,At()}setProjection(et,lt){this.projections[et]=o.getProjection(lt)}setLayers(et,lt,At){this.getLayerIndex(et).replace(lt),At()}updateLayers(et,lt,At){this.getLayerIndex(et).update(lt.layers,lt.removedIds),At()}loadTile(et,lt,At){const zt=this.enableTerrain?o.extend({enableTerrain:this.terrain},lt):lt;zt.projection=this.projections[et]||this.defaultProjection,this.getWorkerSource(et,lt.type,lt.source).loadTile(zt,At)}loadDEMTile(et,lt,At){const zt=this.enableTerrain?o.extend({buildQuadTree:this.terrain},lt):lt;this.getDEMWorkerSource(et,lt.source).loadTile(zt,At)}reloadTile(et,lt,At){const zt=this.enableTerrain?o.extend({enableTerrain:this.terrain},lt):lt;zt.projection=this.projections[et]||this.defaultProjection,this.getWorkerSource(et,lt.type,lt.source).reloadTile(zt,At)}abortTile(et,lt,At){this.getWorkerSource(et,lt.type,lt.source).abortTile(lt,At)}removeTile(et,lt,At){this.getWorkerSource(et,lt.type,lt.source).removeTile(lt,At)}removeSource(et,lt,At){if(!this.workerSources[et]||!this.workerSources[et][lt.type]||!this.workerSources[et][lt.type][lt.source])return;const zt=this.workerSources[et][lt.type][lt.source];delete this.workerSources[et][lt.type][lt.source],zt.removeSource!==void 0?zt.removeSource(lt,At):At()}loadWorkerSource(et,lt,At){try{this.self.importScripts(lt.url),At()}catch(zt){At(zt.toString())}}syncRTLPluginState(et,lt,At){try{o.plugin.setState(lt);const zt=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&zt!=null){this.self.importScripts(zt);const Yt=o.plugin.isParsed();At(Yt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${zt}`),Yt)}}catch(zt){At(zt.toString())}}getAvailableImages(et){let lt=this.availableImages[et];return lt||(lt=[]),lt}getLayerIndex(et){let lt=this.layerIndexes[et];return lt||(lt=this.layerIndexes[et]=new x),lt}getWorkerSource(et,lt,At){return this.workerSources[et]||(this.workerSources[et]={}),this.workerSources[et][lt]||(this.workerSources[et][lt]={}),this.workerSources[et][lt][At]||(this.workerSources[et][lt][At]=new this.workerSourceTypes[lt]({send:(zt,Yt,ne,ie,Kt,ae)=>{this.actor.send(zt,Yt,ne,et,Kt,ae)},scheduler:this.actor.scheduler},this.getLayerIndex(et),this.getAvailableImages(et),this.isSpriteLoaded[et])),this.workerSources[et][lt][At]}getDEMWorkerSource(et,lt){return this.demWorkerSources[et]||(this.demWorkerSources[et]={}),this.demWorkerSources[et][lt]||(this.demWorkerSources[et][lt]=new M),this.demWorkerSources[et][lt]}enforceCacheSizeLimit(et,lt){o.enforceCacheSizeLimit(lt)}getWorkerPerformanceMetrics(et,lt,At){At(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ir(self)),Ir}),u(["./shared"],function(o){var m=y;function y(v){return!function(a){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,C,R=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(R);try{C=new Worker(I),w=!0}catch(F){w=!1}return C&&C.terminate(),URL.revokeObjectURL(I),w}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var w=document.createElement("canvas");w.width=w.height=1;var C=w.getContext("2d");if(!C)return!1;var R=C.getImageData(0,0,1,1);return R&&R.width===w.width}()?(x[f=a&&a.failIfMajorPerformanceCaveat]===void 0&&(x[f]=function(w){var C,R=function(I){var F=document.createElement("canvas"),q=Object.create(y.webGLContextAttributes);return q.failIfMajorPerformanceCaveat=I,F.getContext("webgl",q)||F.getContext("experimental-webgl",q)}(w);if(!R)return!1;try{C=R.createShader(R.VERTEX_SHADER)}catch(I){return!1}return!(!C||R.isContextLost())&&(R.shaderSource(C,"void main() {}"),R.compileShader(C),R.getShaderParameter(C,R.COMPILE_STATUS)===!0)}(f)),x[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var f}(v)}var x={};function M(v,a){if(Array.isArray(v)){if(!Array.isArray(a)||v.length!==a.length)return!1;for(let f=0;f<v.length;f++)if(!M(v[f],a[f]))return!1;return!0}if(typeof v=="object"&&v!==null&&a!==null){if(typeof a!="object"||Object.keys(v).length!==Object.keys(a).length)return!1;for(const f in v)if(!M(v[f],a[f]))return!1;return!0}return v===a}function A(v,a,f){const w=o.window.document.createElement(v);return a!==void 0&&(w.className=a),f&&f.appendChild(w),w}function T(v,a,f){const w=o.window.document.createElementNS("http://www.w3.org/2000/svg",v);for(const C of Object.keys(a))w.setAttributeNS(null,C,a[C]);return f&&f.appendChild(w),w}y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const P=o.window.document&&o.window.document.documentElement.style,D=P&&P.userSelect!==void 0?"userSelect":"WebkitUserSelect";let k;function z(){P&&D&&(k=P[D],P[D]="none")}function O(){P&&D&&(P[D]=k)}function U(v){v.preventDefault(),v.stopPropagation(),o.window.removeEventListener("click",U,!0)}function H(){o.window.addEventListener("click",U,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",U,!0)},0)}function V(v,a){const f=v.getBoundingClientRect();return Z(v,f,a)}function W(v,a){const f=v.getBoundingClientRect(),w=[];for(let C=0;C<a.length;C++)w.push(Z(v,f,a[C]));return w}function K(v){return o.window.InstallTrigger!==void 0&&v.button===2&&v.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button}function Z(v,a,f){const w=v.offsetWidth===a.width?1:v.offsetWidth/a.width;return new o.pointGeometry((f.clientX-a.left)*w,(f.clientY-a.top)*w)}function tt(v,a){var f=a[0],w=a[1],C=a[2],R=a[3],I=f*R-C*w;return I?(v[0]=R*(I=1/I),v[1]=-w*I,v[2]=-C*I,v[3]=f*I,v):null}function at(v){const{userImage:a}=v;return!!(a&&a.render&&a.render())&&(v.data.replace(new Uint8Array(a.data.buffer)),!0)}class st extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:f,callback:w}of this.requestors)this._notify(f,w);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,f){this._validate(a,f)&&(this.images[a]=f)}_validate(a,f){let w=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),w=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),w=!1),this._validateContent(f.content,f)||(this.fire(new o.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),w=!1),w}_validateStretch(a,f){if(!a)return!0;let w=0;for(const C of a){if(C[0]<w||C[1]<C[0]||f<C[1])return!1;w=C[1]}return!0}_validateContent(a,f){return!(a&&(a.length!==4||a[0]<0||f.data.width<a[0]||a[1]<0||f.data.height<a[1]||a[2]<0||f.data.width<a[2]||a[3]<0||f.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,f){f.version=this.images[a].version+1,this.images[a]=f,this.updatedImages[a]=!0}removeImage(a){const f=this.images[a];delete this.images[a],delete this.patterns[a],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,f){let w=!0;if(!this.isLoaded())for(const C of a)this.images[C]||(w=!1);this.isLoaded()||w?this._notify(a,f):this.requestors.push({ids:a,callback:f})}_notify(a,f){const w={};for(const C of a){this.images[C]||this.fire(new o.Event("styleimagemissing",{id:C}));const R=this.images[C];R?w[C]={data:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:!!(R.userImage&&R.userImage.render)}:o.warnOnce(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}f(null,w)}getPixelSize(){const{width:a,height:f}=this.atlasImage;return{width:a,height:f}}getPattern(a){const f=this.patterns[a],w=this.getImage(a);if(!w)return null;if(f&&f.position.version===w.version)return f.position;if(f)f.position.version=w.version;else{const C={w:w.data.width+2,h:w.data.height+2,x:0,y:0},R=new o.ImagePosition(C,w);this.patterns[a]={bin:C,position:R}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const f=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(a,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const R in this.patterns)a.push(this.patterns[R].bin);const{w:f,h:w}=o.potpack(a),C=this.atlasImage;C.resize({width:f||1,height:w||1});for(const R in this.patterns){const{bin:I}=this.patterns[R],F=I.x+1,q=I.y+1,X=this.images[R].data,J=X.width,it=X.height;o.RGBAImage.copy(X,C,{x:0,y:0},{x:F,y:q},{width:J,height:it}),o.RGBAImage.copy(X,C,{x:0,y:it-1},{x:F,y:q-1},{width:J,height:1}),o.RGBAImage.copy(X,C,{x:0,y:0},{x:F,y:q+it},{width:J,height:1}),o.RGBAImage.copy(X,C,{x:J-1,y:0},{x:F-1,y:q},{width:1,height:it}),o.RGBAImage.copy(X,C,{x:0,y:0},{x:F+J,y:q},{width:1,height:it})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const f of a){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const w=this.images[f];at(w)&&this.updateImage(f,w)}}}const nt=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(v,a){return function([f,w,C]){const R=o.degToRad(w+90),I=o.degToRad(C);return{x:f*Math.cos(R)*Math.sin(I),y:f*Math.sin(R)*Math.sin(I),z:f*Math.cos(I),azimuthal:w,polar:C}}(v.expression.evaluate(a))}interpolate(v,a,f){return{x:o.number(v.x,a.x,f),y:o.number(v.y,a.y,f),z:o.number(v.z,a.z,f),azimuthal:o.number(v.azimuthal,a.azimuthal,f),polar:o.number(v.polar,a.polar,f)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ct="-transition";class xt extends o.Evented{constructor(a){super(),this._transitionable=new o.Transitionable(nt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,f={}){if(!this._validate(o.validateLight,a,f))for(const w in a){const C=a[w];o.endsWith(w,ct)?this._transitionable.setTransition(w.slice(0,-ct.length),C):this._transitionable.setValue(w,C)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,w){return(!w||w.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const vt=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Zt="-transition";class ce extends o.Evented{constructor(a,f){super(),this._transitionable=new o.Transitionable(vt),this.set(a),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=f}get(){return this._transitionable.serialize()}set(a){for(const f in a){const w=a[f];o.endsWith(f,Zt)?this._transitionable.setTransition(f.slice(0,-Zt.length),w):this._transitionable.setValue(f,w)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}}function le(v,a,f,w){const C=o.smoothstep(45,65,f),[R,I]=fe(v,w),F=o.length(a);let q=1-Math.min(1,Math.exp((F-R)/(I-R)*-6));return q*=q*q,q=Math.min(1,1.00747*q),q*C*v.alpha}function fe(v,a){const f=.5/Math.tan(.5*a);return[v.range[0]+f,v.range[1]+f]}const de=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"])}),Le="-transition";class Lt extends o.Evented{constructor(a,f){super(),this._transitionable=new o.Transitionable(de),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,f={}){if(!this._validate(o.validateFog,a,f))for(const w in a){const C=a[w];o.endsWith(w,Le)?this._transitionable.setTransition(w.slice(0,-Le.length),C):this._transitionable.setValue(w,C)}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return o.smoothstep(45,65,a)*f.a}getOpacityAtLatLng(a,f){return this._transform.projection.supportsFog?function(w,C,R){const I=o.MercatorCoordinate.fromLngLat(C),F=R.elevation?R.elevation.getAtPointOrZero(I):0,q=[I.x,I.y,F];return o.transformMat4(q,q,R.mercatorFogMatrix),le(w,q,R.pitch,R._fov)}(this.state,a,f):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?fe(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,f,w){return(!w||w.validate!==!1)&&o.emitValidationErrors(this,a.call(o.validateStyle,o.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class bt{constructor(a,f){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const w=this.workerPool.acquire(this.id);for(let C=0;C<w.length;C++){const R=new bt.Actor(w[C],f,this.id);R.name=`Worker ${C}`,this.actors.push(R)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,f,w){o.asyncAll(this.actors,(C,R)=>{C.send(a,f,R)},w=w||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qt(v,a,f){return a*(o.EXTENT/(v.tileSize*Math.pow(2,f-v.tileID.overscaledZ)))}bt.Actor=o.Actor;class Wt{constructor(a,f,w,C){this.screenBounds=a,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=w,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(R=>C.pointCoordinate3D(R)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(a,f){let w,C;if(a instanceof o.pointGeometry||typeof a[0]=="number"){const R=o.pointGeometry.convert(a);w=[o.pointGeometry.convert(a)],C=f.isPointAboveHorizon(R)}else{const R=o.pointGeometry.convert(a[0]),I=o.pointGeometry.convert(a[1]);w=[R,I],C=o.polygonizeBounds(R,I).every(F=>f.isPointAboveHorizon(F))}return new Wt(w,f.getCameraPoint(),C,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(a){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const f=this.screenBounds[0],w=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],C=o.polygonizeBounds(f,w,0,!1);return this.cameraPoint.y>w.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<w.x?C.splice(3,0,this.cameraPoint):this.cameraPoint.x>=w.x?C[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(C[3]=this.cameraPoint)),o.bufferConvexPolygon(C,a)}containsTile(a,f,w){const C=a.queryPadding+1,R=a.tileID.wrap,I=w?this._bufferedCameraMercator(C,f).map(ft=>o.getTilePoint(a.tileTransform,ft,R)):this._bufferedScreenMercator(C,f).map(ft=>o.getTilePoint(a.tileTransform,ft,R)),F=this.screenGeometryMercator.map(ft=>o.getTileVec3(a.tileTransform,ft,R)),q=F.map(ft=>new o.pointGeometry(ft[0],ft[1])),X=f.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),J=o.getTileVec3(a.tileTransform,X,R),it=F.map(ft=>{const ut=o.sub(ft,ft,J);return o.normalize(ut,ut),new o.Ray(J,ut)}),pt=qt(a,1,f.zoom);if(o.polygonIntersectsBox(I,0,0,o.EXTENT,o.EXTENT))return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:it,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(gt=o.getBounds(I),gt.min.x=o.clamp(gt.min.x,0,o.EXTENT),gt.min.y=o.clamp(gt.min.y,0,o.EXTENT),gt.max.x=o.clamp(gt.max.x,0,o.EXTENT),gt.max.y=o.clamp(gt.max.y,0,o.EXTENT),gt),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:pt};var gt}_bufferedScreenMercator(a,f){const w=Nt(a);if(this._screenRaycastCache[w])return this._screenRaycastCache[w];{const C=this.bufferedScreenGeometry(a).map(R=>f.pointCoordinate3D(R));return this._screenRaycastCache[w]=C,C}}_bufferedCameraMercator(a,f){const w=Nt(a);if(this._cameraRaycastCache[w])return this._cameraRaycastCache[w];{const C=this.bufferedCameraGeometry(a).map(R=>f.pointCoordinate3D(R));return this._cameraRaycastCache[w]=C,C}}}function Nt(v){return 100*v|0}function se(v,a,f){const w=function(C,R){if(C)return f(C);if(R){const I=o.pick(o.extend(R,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);R.vector_layers&&(I.vectorLayers=R.vector_layers,I.vectorLayerIds=I.vectorLayers.map(F=>F.id)),I.tiles=a.canonicalizeTileset(I,v.url),f(null,I)}};return v.url?o.getJSON(a.transformRequest(a.normalizeSourceURL(v.url),o.ResourceType.Source),w):o.exported.frame(()=>w(null,v))}class _t{constructor(a,f,w){this.bounds=o.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=f||0,this.maxzoom=w||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const f=Math.pow(2,a.z),w=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*f),C=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*f),R=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*f),I=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*f);return a.x>=w&&a.x<R&&a.y>=C&&a.y<I}}class wt{constructor(a,f,w){this.context=a;const C=a.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!w,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ct={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mt{constructor(a,f,w,C){this.length=f.length,this.attributes=w,this.itemSize=f.bytesPerElement,this.dynamicDraw=C,this.context=a;const R=a.gl;this.buffer=R.createBuffer(),a.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,f){for(let w=0;w<this.attributes.length;w++){const C=f.attributes[this.attributes[w].name];C!==void 0&&a.enableVertexAttribArray(C)}}setVertexAttribPointers(a,f,w){for(let C=0;C<this.attributes.length;C++){const R=this.attributes[C],I=f.attributes[R.name];I!==void 0&&a.vertexAttribPointer(I,R.components,a[Ct[R.type]],!1,this.itemSize,R.offset+this.itemSize*(w||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class jt{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ee extends jt{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class pe extends jt{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Te extends jt{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class We extends jt{getDefault(){return[!0,!0,!0,!0]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class yt extends jt{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class St extends jt{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Ee extends jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const f=this.current;(a.func!==f.func||a.ref!==f.ref||a.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class be extends jt{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class En extends jt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=a,this.dirty=!1}}class mn extends jt{getDefault(){return[0,1]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class an extends jt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=a,this.dirty=!1}}class yn extends jt{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Tn extends jt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.BLEND):f.disable(f.BLEND),this.current=a,this.dirty=!1}}class pn extends jt{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class qe extends jt{getDefault(){return o.Color.transparent}set(a){const f=this.current;(a.r!==f.r||a.g!==f.g||a.b!==f.b||a.a!==f.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class hn extends jt{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Je extends jt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;a?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=a,this.dirty=!1}}class Jt extends jt{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class je extends jt{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class rn extends jt{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class In extends jt{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class xn extends jt{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const f=this.current;(a[0]!==f[0]||a[1]!==f[1]||a[2]!==f[2]||a[3]!==f[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class On extends jt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class qn extends jt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Jn extends jt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Ji extends jt{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class jn extends jt{getDefault(){return null}set(a){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Bi extends jt{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class oi extends jt{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class or extends jt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Ai extends jt{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Qr extends jt{constructor(a,f){super(a),this.context=a,this.parent=f}getDefault(){return null}}class Oi extends Qr{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class $r extends Qr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ir extends $r{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Pt{constructor(a,f,w,C){this.context=a,this.width=f,this.height=w;const R=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Oi(a,R),C&&(this.depthAttachment=new $r(a,R))}destroy(){const a=this.context.gl,f=this.colorAttachment.get();if(f&&a.deleteTexture(f),this.depthAttachment){const w=this.depthAttachment.get();w&&a.deleteRenderbuffer(w)}a.deleteFramebuffer(this.framebuffer)}}class et{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ee(this),this.clearDepth=new pe(this),this.clearStencil=new Te(this),this.colorMask=new We(this),this.depthMask=new yt(this),this.stencilMask=new St(this),this.stencilFunc=new Ee(this),this.stencilOp=new be(this),this.stencilTest=new En(this),this.depthRange=new mn(this),this.depthTest=new an(this),this.depthFunc=new yn(this),this.blend=new Tn(this),this.blendFunc=new pn(this),this.blendColor=new qe(this),this.blendEquation=new hn(this),this.cullFace=new Je(this),this.cullFaceSide=new Jt(this),this.frontFace=new je(this),this.program=new rn(this),this.activeTexture=new In(this),this.viewport=new xn(this),this.bindFramebuffer=new On(this),this.bindRenderbuffer=new qn(this),this.bindTexture=new Jn(this),this.bindVertexBuffer=new Ji(this),this.bindElementBuffer=new jn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Bi(this),this.pixelStoreUnpack=new oi(this),this.pixelStoreUnpackPremultiplyAlpha=new or(this),this.pixelStoreUnpackFlipY=new Ai(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,f){return new wt(this,a,f)}createVertexBuffer(a,f,w){return new Mt(this,a,f,w)}createRenderbuffer(a,f,w){const C=this.gl,R=C.createRenderbuffer();return this.bindRenderbuffer.set(R),C.renderbufferStorage(C.RENDERBUFFER,a,f,w),this.bindRenderbuffer.set(null),R}createFramebuffer(a,f,w){return new Pt(this,a,f,w)}clear({color:a,depth:f,stencil:w}){const C=this.gl;let R=0;a&&(R|=C.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(R|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),w!==void 0&&(R|=C.STENCIL_BUFFER_BIT,this.clearStencil.set(w),this.stencilMask.set(255)),C.clear(R)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){M(a.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class lt extends o.Evented{constructor(a,f,w,C){super(),this.id=a,this.dispatcher=w,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},f),o.extend(this,o.pick(f,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=se(this._options,this.map._requestManager,(a,f)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):f&&(o.extend(this,f),f.bounds&&(this.tileBounds=new _t(f.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(f.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,f){const w=o.exported.devicePixelRatio>=2,C=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),w,this.tileSize);a.request=o.getImage(this.map._requestManager.transformRequest(C,o.ResourceType.Tile),(R,I,F,q)=>(delete a.request,a.aborted?(a.state="unloaded",f(null)):R?(a.state="errored",f(R)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:F,expires:q}),a.setTexture(I,this.map.painter),a.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void f(null)):f(null)))}static loadTileData(a,f,w){a.setTexture(f,w)}static unloadTileData(a,f){a.texture&&f.saveTileTexture(a.texture)}abortTile(a,f){a.request&&(a.request.cancel(),delete a.request),f()}unloadTile(a,f){a.texture&&this.map.painter.saveTileTexture(a.texture),f()}hasTransition(){return!1}}let At;function zt(v,a,f,w,C,R,I,F){const q=[v,f,C,a,w,R,1,1,1],X=[I,F,1],J=o.adjoint([],q),[it,pt,gt]=o.transformMat3(X,X,o.transpose(J,J));return o.multiply(q,[it,0,0,0,pt,0,0,0,gt],q)}class Yt extends o.Evented{constructor(a,f,w,C){super(),this.id=a,this.dispatcher=w,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=f}load(a){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(f,w)=>{if(this._loaded=!0,f)this.fire(new o.ErrorEvent(f));else if(w){const{HTMLImageElement:C}=o.window;this.image=w instanceof C?o.exported.getImageData(w):w,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const f=a.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(w){let C=1/0,R=1/0,I=-1/0,F=-1/0;for(const it of w)C=Math.min(C,it.x),R=Math.min(R,it.y),I=Math.max(I,it.x),F=Math.max(F,it.y);const q=Math.max(I-C,F-R),X=Math.max(0,Math.floor(-Math.log(q)/Math.LN2)),J=Math.pow(2,X);return new o.CanonicalTileID(X,Math.floor((C+I)/2*J),Math.floor((R+F)/2*J))}(f),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const q in this.tiles){const X=this.tiles[q];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray)return;const f=o.tileTransform(this.tileID,this.map.transform.projection),[w,C,R,I]=this.coordinates.map(q=>{const X=f.projection.project(q[0],q[1]);return o.getTilePoint(f,X)._round()});this.perspectiveTransform=function(q,X,J,it,pt,gt,ft,ut,Ft,Et){const It=zt(0,0,q,0,0,X,q,X),Bt=zt(J,it,pt,gt,ft,ut,Ft,Et);return o.multiply(Bt,o.adjoint(It,It),Bt),[Bt[6]/Bt[8]*q/o.EXTENT,Bt[7]/Bt[8]*X/o.EXTENT]}(this.width,this.height,w.x,w.y,C.x,C.y,I.x,I.y,R.x,R.y);const F=this._boundsArray=new o.StructArrayLayout4i8;F.emplaceBack(w.x,w.y,0,0),F.emplaceBack(C.x,C.y,o.EXTENT,0),F.emplaceBack(I.x,I.y,0,o.EXTENT),F.emplaceBack(R.x,R.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(F,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,f=a.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(a,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._prepareData(a)}loadTile(a,f){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},f(null)):(a.state="errored",f(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ne={vector:class extends o.Evented{constructor(v,a,f,w){if(super(),this.id=v,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(a,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=se(this._options,this.map._requestManager,(v,a)=>{this._tileJSONRequest=null,this._loaded=!0,v?this.fire(new o.ErrorEvent(v)):a&&(o.extend(this,a),a.bounds&&(this.tileBounds=new _t(a.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(a.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}onAdd(v){this.map=v,this.load()}setSourceProperty(v){this._tileJSONRequest&&this._tileJSONRequest.cancel(),v();const a=this.map.style._getSourceCaches(this.id);for(const f of a)f.clearTiles();this.load()}setTiles(v){return this.setSourceProperty(()=>{this._options.tiles=v}),this}setUrl(v){return this.setSourceProperty(()=>{this.url=v,this._options.url=v}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(v,a){const f=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(f,o.ResourceType.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:v.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,v.actor&&v.state!=="expired")v.state==="loading"?v.reloadCallback=a:v.request=v.actor.send("reloadTile",w,C.bind(this));else if(v.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)v.request=v.actor.send("loadTile",w,C.bind(this),void 0,!0);else{const R=o.loadVectorTile.call({deduped:this._deduped},w,(I,F)=>{I||!F?C.call(this,I):(w.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},v.actor&&v.actor.send("loadTile",w,C.bind(this),void 0,!0))},!0);v.request={cancel:R}}function C(R,I){return delete v.request,v.aborted?a(null):R&&R.status!==404?a(R):(I&&I.resourceTiming&&(v.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&v.setExpiryData(I),v.loadVectorData(I,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(v.reloadCallback&&(this.loadTile(v,v.reloadCallback),v.reloadCallback=null)))}}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.actor&&v.actor.send("abortTile",{uid:v.uid,type:this.type,source:this.id})}unloadTile(v){v.unloadVectorData(),v.actor&&v.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:lt,"raster-dem":class extends lt{constructor(v,a,f,w){super(v,a,f,w),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(v,a){const f=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function w(C,R){C&&(v.state="errored",a(C)),R&&(v.dem=R,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",a(null))}v.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),function(C,R,I,F){if(delete v.request,v.aborted)v.state="unloaded",a(null);else if(C)v.state="errored",a(C);else if(R){this.map._refreshExpiredTiles&&v.setExpiryData({cacheControl:I,expires:F});const q=o.window.ImageBitmap&&R instanceof o.window.ImageBitmap&&(At==null&&(At=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),At),X=1-(R.width-o.prevPowerOfTwo(R.width))/2;X<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const J=q?R:o.exported.getImageData(R,X),it={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:J,encoding:this.encoding,padding:X};v.actor&&v.state!=="expired"||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",it,w.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(v){const a=v.canonical,f=Math.pow(2,a.z),w=(a.x-1+f)%f,C=a.x===0?v.wrap-1:v.wrap,R=(a.x+1+f)%f,I=a.x+1===f?v.wrap+1:v.wrap,F={};return F[new o.OverscaledTileID(v.overscaledZ,C,a.z,w,a.y).key]={backfilled:!1},F[new o.OverscaledTileID(v.overscaledZ,I,a.z,R,a.y).key]={backfilled:!1},a.y>0&&(F[new o.OverscaledTileID(v.overscaledZ,C,a.z,w,a.y-1).key]={backfilled:!1},F[new o.OverscaledTileID(v.overscaledZ,v.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},F[new o.OverscaledTileID(v.overscaledZ,I,a.z,R,a.y-1).key]={backfilled:!1}),a.y+1<f&&(F[new o.OverscaledTileID(v.overscaledZ,C,a.z,w,a.y+1).key]={backfilled:!1},F[new o.OverscaledTileID(v.overscaledZ,v.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},F[new o.OverscaledTileID(v.overscaledZ,I,a.z,R,a.y+1).key]={backfilled:!1}),F}unloadTile(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded"}},geojson:class extends o.Evented{constructor(v,a,f,w){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(w),this._data=a.data,this._options=o.extend({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const C=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(a.buffer!==void 0?a.buffer:128)*C,tolerance:(a.tolerance!==void 0?a.tolerance:.375)*C,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:a.clusterMaxZoom!==void 0?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:o.EXTENT,radius:(a.clusterRadius!==void 0?a.clusterRadius:50)*C,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}getClusterExpansionZoom(v,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},a),this}getClusterChildren(v,a){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},a),this}getClusterLeaves(v,a,f,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:a,offset:f},w),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const v=o.extend({},this.workerOptions),a=this._data;typeof a=="string"?(v.request=this.map._requestManager.transformRequest(o.exported.resolveURL(a),o.ResourceType.Source),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,v,(f,w)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.ErrorEvent(f));else{const C={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(C.resourceTiming=w.resourceTiming[this.id]),this.fire(new o.Event("data",C)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(v,a){const f=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(f,{type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(w,C)=>(delete v.request,v.unloadVectorData(),v.aborted?a(null):w?a(w):(v.loadVectorData(C,this.map.painter,f==="reloadTile"),a(null))),void 0,f==="loadTile")}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Yt{constructor(v,a,f,w){super(v,a,f,w),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const a of v.urls)this.urls.push(this.map._requestManager.transformRequest(a,o.ResourceType.Source).url);o.getVideo(this.urls,(a,f)=>{this._loaded=!0,a?this.fire(new o.ErrorEvent(a)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const a=this.video.seekable;v<a.start(0)||v>a.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const v=this.map.painter.context,a=v.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(v,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Yt,canvas:class extends Yt{constructor(v,a,f,w){super(v,a,f,w),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some(C=>!Array.isArray(C)||C.length!==2||C.some(R=>typeof R!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${v}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context;this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends o.Evented{constructor(v,a,f,w){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=a,this.setEventedParent(w),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _t(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this._map=v,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:a,y:f,z:w}=v.canonical;return this._implementation.hasTile({x:a,y:f,z:w})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,a){const{x:f,y:w,z:C}=v.tileID.canonical,R=new o.window.AbortController,I=this._implementation.loadTile({x:f,y:w,z:C},{signal:R.signal});if(!I)return this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",a(null);I.cancel=()=>R.abort(),v.request=I.then(function(F){return delete v.request,v.aborted?(v.state="unloaded",a(null)):F?function(q){return q instanceof o.window.ImageData||q instanceof o.window.ImageBitmap||q instanceof o.window.HTMLCanvasElement}(F)?(this.loadTileData(v,F),v.state="loaded",void a(null)):(v.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",a(null))}.bind(this)).catch(F=>{F.code!==20&&(v.state="errored",a(F))})}loadTileData(v,a){lt.loadTileData(v,a,this._map.painter)}unloadTileData(v){lt.unloadTileData(v,this._map.painter)}prepareTile(v){if(!this._implementation.prepareTile)return null;const{x:a,y:f,z:w}=v.tileID.canonical,C=this._implementation.prepareTile({x:a,y:f,z:w});return C?(this.loadTileData(v,C),v.state="loaded",C):null}unloadTile(v,a){if(this.unloadTileData(v),this._implementation.unloadTile){const{x:f,y:w,z:C}=v.tileID.canonical;this._implementation.unloadTile({x:f,y:w,z:C})}a()}abortTile(v,a){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ie=function(v,a,f,w){const C=new ne[a.type](v,a,f,w);if(C.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${C.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],C),C};function Kt(v,a){const f=o.identity([]);return o.scale(f,f,[.5*v.width,.5*-v.height,1]),o.translate(f,f,[1,-1,0]),o.multiply$1(f,f,v.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(f)}function ae(v,a,f,w,C,R,I,F=!1){const q=v.tilesIn(w,I,F);q.sort(He);const X=[];for(const it of q)X.push({wrappedTileID:it.tile.tileID.wrapped().key,queryResults:it.tile.queryRenderedFeatures(a,f,v._state,it,C,R,Kt(v.transform,it.tile.tileID),F)});const J=function(it){const pt={},gt={};for(const ft of it){const ut=ft.queryResults,Ft=ft.wrappedTileID,Et=gt[Ft]=gt[Ft]||{};for(const It in ut){const Bt=ut[It],Ut=Et[It]=Et[It]||{},Rt=pt[It]=pt[It]||[];for(const Ht of Bt)Ut[Ht.featureIndex]||(Ut[Ht.featureIndex]=!0,Rt.push(Ht))}}return pt}(X);for(const it in J)J[it].forEach(pt=>{const gt=pt.feature,ft=gt.layer;ft&&ft.type!=="background"&&ft.type!=="sky"&&(gt.source=ft.source,ft["source-layer"]&&(gt.sourceLayer=ft["source-layer"]),gt.state=gt.id!==void 0?v.getFeatureState(ft["source-layer"],gt.id):{})});return J}function we(v,a){const f=v.getRenderableIds().map(R=>v.getTileByID(R)),w=[],C={};for(let R=0;R<f.length;R++){const I=f[R],F=I.tileID.canonical.key;C[F]||(C[F]=!0,I.querySourceFeatures(w,a))}return w}function He(v,a){const f=v.tileID,w=a.tileID;return f.overscaledZ-w.overscaledZ||f.canonical.y-w.canonical.y||f.wrap-w.wrap||f.canonical.x-w.canonical.x}function De(){return tl.workerClass!=null?new tl.workerClass:new o.window.Worker(tl.workerUrl)}const Mn="mapboxgl_preloaded_worker_pool";class rt{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<rt.workerCount;)this.workers.push(new De);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mn]}numActive(){return Object.keys(this.active).length}}let ht;function Vt(){return ht||(ht=new rt),ht}function Dt(v,a){const f={};for(const w in v)w!=="ref"&&(f[w]=v[w]);return o.refProperties.forEach(w=>{w in a&&(f[w]=a[w])}),f}function Se(v){v=v.slice();const a=Object.create(null);for(let f=0;f<v.length;f++)a[v[f].id]=v[f];for(let f=0;f<v.length;f++)"ref"in v[f]&&(v[f]=Dt(v[f],a[v[f].ref]));return v}rt.workerCount=2;const Me={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Oe(v,a,f){f.push({command:Me.addSource,args:[v,a[v]]})}function ln(v,a,f){a.push({command:Me.removeSource,args:[v]}),f[v]=!0}function kn(v,a,f,w){ln(v,f,w),Oe(v,a,f)}function Bn(v,a,f){let w;for(w in v[f])if(v[f].hasOwnProperty(w)&&w!=="data"&&!M(v[f][w],a[f][w]))return!1;for(w in a[f])if(a[f].hasOwnProperty(w)&&w!=="data"&&!M(v[f][w],a[f][w]))return!1;return!0}function Pe(v,a,f,w,C,R){let I;for(I in a=a||{},v=v||{})v.hasOwnProperty(I)&&(M(v[I],a[I])||f.push({command:R,args:[w,I,a[I],C]}));for(I in a)a.hasOwnProperty(I)&&!v.hasOwnProperty(I)&&(M(v[I],a[I])||f.push({command:R,args:[w,I,a[I],C]}))}function fn(v){return v.id}function tn(v,a){return v[a.id]=a,v}class vn{constructor(a,f){this.reset(a,f)}reset(a,f){this.points=a||[],this._distances=[0];for(let w=1;w<this.points.length;w++)this._distances[w]=this._distances[w-1]+this.points[w].dist(this.points[w-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=o.clamp(a,0,1);let f=1,w=this._distances[f];const C=a*this.paddedLength+this.padding;for(;w<C&&f<this._distances.length;)w=this._distances[++f];const R=f-1,I=this._distances[R],F=w-I,q=F>0?(C-I)/F:0;return this.points[R].mult(1-q).add(this.points[f].mult(q))}}class Sn{constructor(a,f,w){const C=this.boxCells=[],R=this.circleCells=[];this.xCellCount=Math.ceil(a/w),this.yCellCount=Math.ceil(f/w);for(let I=0;I<this.xCellCount*this.yCellCount;I++)C.push([]),R.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=f,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,f,w,C,R){this._forEachCell(f,w,C,R,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(f),this.bboxes.push(w),this.bboxes.push(C),this.bboxes.push(R)}insertCircle(a,f,w,C){this._forEachCell(f-C,w-C,f+C,w+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(f),this.circles.push(w),this.circles.push(C)}_insertBoxCell(a,f,w,C,R,I){this.boxCells[R].push(I)}_insertCircleCell(a,f,w,C,R,I){this.circleCells[R].push(I)}_query(a,f,w,C,R,I){if(w<0||a>this.width||C<0||f>this.height)return!R&&[];const F=[];if(a<=0&&f<=0&&this.width<=w&&this.height<=C){if(R)return!0;for(let q=0;q<this.boxKeys.length;q++)F.push({key:this.boxKeys[q],x1:this.bboxes[4*q],y1:this.bboxes[4*q+1],x2:this.bboxes[4*q+2],y2:this.bboxes[4*q+3]});for(let q=0;q<this.circleKeys.length;q++){const X=this.circles[3*q],J=this.circles[3*q+1],it=this.circles[3*q+2];F.push({key:this.circleKeys[q],x1:X-it,y1:J-it,x2:X+it,y2:J+it})}return I?F.filter(I):F}return this._forEachCell(a,f,w,C,this._queryCell,F,{hitTest:R,seenUids:{box:{},circle:{}}},I),R?F.length>0:F}_queryCircle(a,f,w,C,R){const I=a-w,F=a+w,q=f-w,X=f+w;if(F<0||I>this.width||X<0||q>this.height)return!C&&[];const J=[];return this._forEachCell(I,q,F,X,this._queryCellCircle,J,{hitTest:C,circle:{x:a,y:f,radius:w},seenUids:{box:{},circle:{}}},R),C?J.length>0:J}query(a,f,w,C,R){return this._query(a,f,w,C,!1,R)}hitTest(a,f,w,C,R){return this._query(a,f,w,C,!0,R)}hitTestCircle(a,f,w,C){return this._queryCircle(a,f,w,!0,C)}_queryCell(a,f,w,C,R,I,F,q){const X=F.seenUids,J=this.boxCells[R];if(J!==null){const pt=this.bboxes;for(const gt of J)if(!X.box[gt]){X.box[gt]=!0;const ft=4*gt;if(a<=pt[ft+2]&&f<=pt[ft+3]&&w>=pt[ft+0]&&C>=pt[ft+1]&&(!q||q(this.boxKeys[gt]))){if(F.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[gt],x1:pt[ft],y1:pt[ft+1],x2:pt[ft+2],y2:pt[ft+3]})}}}const it=this.circleCells[R];if(it!==null){const pt=this.circles;for(const gt of it)if(!X.circle[gt]){X.circle[gt]=!0;const ft=3*gt;if(this._circleAndRectCollide(pt[ft],pt[ft+1],pt[ft+2],a,f,w,C)&&(!q||q(this.circleKeys[gt]))){if(F.hitTest)return I.push(!0),!0;{const ut=pt[ft],Ft=pt[ft+1],Et=pt[ft+2];I.push({key:this.circleKeys[gt],x1:ut-Et,y1:Ft-Et,x2:ut+Et,y2:Ft+Et})}}}}}_queryCellCircle(a,f,w,C,R,I,F,q){const X=F.circle,J=F.seenUids,it=this.boxCells[R];if(it!==null){const gt=this.bboxes;for(const ft of it)if(!J.box[ft]){J.box[ft]=!0;const ut=4*ft;if(this._circleAndRectCollide(X.x,X.y,X.radius,gt[ut+0],gt[ut+1],gt[ut+2],gt[ut+3])&&(!q||q(this.boxKeys[ft])))return I.push(!0),!0}}const pt=this.circleCells[R];if(pt!==null){const gt=this.circles;for(const ft of pt)if(!J.circle[ft]){J.circle[ft]=!0;const ut=3*ft;if(this._circlesCollide(gt[ut],gt[ut+1],gt[ut+2],X.x,X.y,X.radius)&&(!q||q(this.circleKeys[ft])))return I.push(!0),!0}}}_forEachCell(a,f,w,C,R,I,F,q){const X=this._convertToXCellCoord(a),J=this._convertToYCellCoord(f),it=this._convertToXCellCoord(w),pt=this._convertToYCellCoord(C);for(let gt=X;gt<=it;gt++)for(let ft=J;ft<=pt;ft++)if(R.call(this,a,f,w,C,this.xCellCount*ft+gt,I,F,q))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,f,w,C,R,I){const F=C-a,q=R-f,X=w+I;return X*X>F*F+q*q}_circleAndRectCollide(a,f,w,C,R,I,F){const q=(I-C)/2,X=Math.abs(a-(C+q));if(X>q+w)return!1;const J=(F-R)/2,it=Math.abs(f-(R+J));if(it>J+w)return!1;if(X<=q||it<=J)return!0;const pt=X-q,gt=it-J;return pt*pt+gt*gt<=w*w}}const Dn=Math.tan(85*Math.PI/180);function xi(v,a,f,w,C,R){const I=o.create();if(f){if(C.projection.name==="globe")o.multiply$1(I,I,o.calculateGlobeLabelMatrix(C,a));else{const F=tt([],R);I[0]=F[0],I[1]=F[1],I[4]=F[2],I[5]=F[3]}w||o.rotateZ(I,I,C.angle)}else o.multiply$1(I,C.labelPlaneMatrix,v);return I}function kr(v,a,f,w,C,R){if(f){if(C.projection.name==="globe"){const I=xi(v,a,f,w,C,R);return o.invert(I,I),o.multiply$1(I,v,I),I}{const I=o.clone(v),F=o.identity([]);return F[0]=R[0],F[1]=R[1],F[4]=R[2],F[5]=R[3],o.multiply$1(I,I,F),w||o.rotateZ(I,I,-C.angle),I}}return C.glCoordMatrix}function hi(v,a,f=0){const w=[v.x,v.y,f,1];f?o.transformMat4$1(w,w,a):Br(w,w,a);const C=w[3];return{point:new o.pointGeometry(w[0]/C,w[1]/C),signedDistanceFromCamera:C}}function fi(v,a){const f=[v[0],v[1],v[2],1];o.transformMat4$1(f,f,a);const w=f[3];return{point:new o.pointGeometry(f[0]/w,f[1]/w),signedDistanceFromCamera:w}}function di(v,a){return Math.min(.5+v/a*.5,1.5)}function Va(v,a){const f=v[0]/v[3],w=v[1]/v[3];return f>=-a[0]&&f<=a[0]&&w>=-a[1]&&w<=a[1]}function Xo(v,a,f,w,C,R,I,F,q,X){const J=f.transform,it=w?v.textSizeData:v.iconSizeData,pt=o.evaluateSizeForZoom(it,f.transform.zoom),gt=[256/f.width*2+1,256/f.height*2+1],ft=w?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;ft.clear();const ut=v.lineVertexArray,Ft=w?v.text.placedSymbolArray:v.icon.placedSymbolArray,Et=f.transform.width/f.transform.height;let It=!1;for(let Bt=0;Bt<Ft.length;Bt++){const Ut=Ft.get(Bt);if(Ut.writingMode!==o.WritingMode.vertical||It||Bt!==0&&Ft.get(Bt-1).writingMode===o.WritingMode.horizontal||(It=!0),(Ut.hidden||Ut.writingMode===o.WritingMode.vertical)&&!It){ji(Ut.numGlyphs,ft);continue}It=!1;const Rt=new o.pointGeometry(Ut.tileAnchorX,Ut.tileAnchorY),Ht=q?q(Rt):[0,0,0],re=J.projection.projectTilePoint(Rt.x,Rt.y,X.canonical),he=[re.x+Ht[0],re.y+Ht[1],re.z+Ht[2]],xe=[...he,1];if(o.transformMat4$1(xe,xe,a),!Va(xe,gt)){ji(Ut.numGlyphs,ft);continue}const ge=di(f.transform.cameraToCenterDistance,xe[3]),ze=o.evaluateSizeForFeature(it,pt,Ut),oe=I?ze/ge:ze*ge,Ne=hi(new o.pointGeometry(he[0],he[1]),C,he[2]);if(Ne.signedDistanceFromCamera<=0){ji(Ut.numGlyphs,ft);continue}let Ie={};const en=I?null:q,ve=Uu(Ut,oe,!1,F,a,C,R,v.glyphOffsetArray,ut,ft,Ne.point,Rt,Ie,Et,en,J.projection,X);It=ve.useVertical,en&&ve.needsFlipping&&(Ie={}),(ve.notEnoughRoom||It||ve.needsFlipping&&Uu(Ut,oe,!0,F,a,C,R,v.glyphOffsetArray,ut,ft,Ne.point,Rt,Ie,Et,en,J.projection,X).notEnoughRoom)&&ji(Ut.numGlyphs,ft)}w?v.text.dynamicLayoutVertexBuffer.updateData(ft):v.icon.dynamicLayoutVertexBuffer.updateData(ft)}function Nu(v,a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft){const ut=F.glyphStartIndex+F.numGlyphs,Ft=F.lineStartIndex,Et=F.lineStartIndex+F.lineLength,It=a.getoffsetX(F.glyphStartIndex),Bt=a.getoffsetX(ut-1),Ut=Oa(v*It,f,w,C,R,I,F.segment,Ft,Et,q,X,J,it,pt,!0,gt,ft);if(!Ut)return null;const Rt=Oa(v*Bt,f,w,C,R,I,F.segment,Ft,Et,q,X,J,it,pt,!0,gt,ft);return Rt?{first:Ut,last:Rt}:null}function Ga(v,a,f,w){return v.writingMode===o.WritingMode.horizontal&&Math.abs(f.y-a.y)>Math.abs(f.x-a.x)*w?{useVertical:!0}:v.writingMode===o.WritingMode.vertical?a.y<f.y?{needsFlipping:!0}:null:v.flipState!==0&&function(C,R,I){const F=(R.x-C.x)*I;return F===0||Math.abs((R.y-C.y)/F)>Dn}(a,f,w)?v.flipState===1?{needsFlipping:!0}:null:a.x>f.x?{needsFlipping:!0}:null}function Uu(v,a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft,ut,Ft){const Et=a/24,It=v.lineOffsetX*Et,Bt=v.lineOffsetY*Et;let Ut;if(v.numGlyphs>1){const Rt=v.glyphStartIndex+v.numGlyphs,Ht=v.lineStartIndex,re=v.lineStartIndex+v.lineLength,he=Nu(Et,F,It,Bt,f,J,it,v,q,R,pt,ft,!1,ut,Ft);if(!he)return{notEnoughRoom:!0};const xe=hi(he.first.point,I).point,ge=hi(he.last.point,I).point;if(w&&!f){const ze=Ga(v,xe,ge,gt);if(v.flipState=ze&&ze.needsFlipping?1:2,ze)return ze}Ut=[he.first];for(let ze=v.glyphStartIndex+1;ze<Rt-1;ze++)Ut.push(Oa(Et*F.getoffsetX(ze),It,Bt,f,J,it,v.segment,Ht,re,q,R,pt,ft,!1,!1,ut,Ft));Ut.push(he.last)}else{if(w&&!f){const Ht=hi(it,C).point,re=v.lineStartIndex+v.segment+1,he=new o.pointGeometry(q.getx(re),q.gety(re)),xe=hi(he,C),ge=Ga(v,Ht,xe.signedDistanceFromCamera>0?xe.point:Qn(it,he,Ht,1,C,void 0,ut,Ft.canonical),gt);if(v.flipState=ge&&ge.needsFlipping?1:2,ge)return ge}const Rt=Oa(Et*F.getoffsetX(v.glyphStartIndex),It,Bt,f,J,it,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,q,R,pt,ft,!1,!1,ut,Ft);if(!Rt)return{notEnoughRoom:!0};Ut=[Rt]}for(const Rt of Ut)o.addDynamicAttributes(X,Rt.point,Rt.angle);return{}}function dp(v,a,f,w,C){const R=w.projectTilePoint(v.x,v.y,a);if(!C)return hi(R,f,R.z);const I=C(v);return hi(new o.pointGeometry(R.x+I[0],R.y+I[1]),f,R.z+I[2])}function Qn(v,a,f,w,C,R,I,F){const q=dp(v.add(v.sub(a)._unit()),F,C,I,R).point,X=f.sub(q);return f.add(X._mult(w/X.mag()))}function Oa(v,a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft,ut,Ft){const Et=w?v-a:v+a;let It=Et>0?1:-1,Bt=0;w&&(It*=-1,Bt=Math.PI),It<0&&(Bt+=Math.PI);let Ut=It>0?F+I:F+I+1,Rt=C,Ht=C,re=0,he=0;const xe=Math.abs(Et),ge=[],ze=[];let oe=R;const Ne=()=>{const Qe=Ut-It;return re===0?R:new o.pointGeometry(X.getx(Qe),X.gety(Qe))},Ie=()=>Qn(Ne(),oe,Ht,xe-re+1,J,pt,ut,Ft.canonical);for(;re+he<=xe;){if(Ut+=It,Ut<F||Ut>=q)return null;if(Ht=Rt,ge.push(Rt),gt&&ze.push(oe||Ne()),Rt=it[Ut],Rt===void 0){oe=new o.pointGeometry(X.getx(Ut),X.gety(Ut));const Qe=dp(oe,Ft.canonical,J,ut,pt);Rt=Qe.signedDistanceFromCamera>0?it[Ut]=Qe.point:Ie()}else oe=null;re+=he,he=Ht.dist(Rt)}ft&&pt&&(oe=oe||new o.pointGeometry(X.getx(Ut),X.gety(Ut)),it[Ut]=Rt=it[Ut]===void 0?Rt:Ie(),he=Ht.dist(Rt));const en=(xe-re)/he,ve=Rt.sub(Ht),Ze=ve.mult(en)._add(Ht);f&&Ze._add(ve._unit()._perp()._mult(f*It));const _n=Bt+Math.atan2(Rt.y-Ht.y,Rt.x-Ht.x);return ge.push(Ze),gt&&(oe=oe||new o.pointGeometry(X.getx(Ut),X.gety(Ut)),ze.push(function(Qe,$e,An){const Un=1-An;return new o.pointGeometry(Qe.x*Un+$e.x*An,Qe.y*Un+$e.y*An)}(ze.length>0?ze[ze.length-1]:oe,oe,en))),{point:Ze,angle:_n,path:ge,tilePath:ze}}const pp=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ji(v,a){for(let f=0;f<v;f++){const w=a.length;a.resize(w+4),a.float32.set(pp,3*w)}}function Br(v,a,f){const w=a[0],C=a[1];return v[0]=f[0]*w+f[4]*C+f[12],v[1]=f[1]*w+f[5]*C+f[13],v[3]=f[3]*w+f[7]*C+f[15],v}const bo=100;class Vu{constructor(a,f,w=new Sn(a.width+200,a.height+200,25),C=new Sn(a.width+200,a.height+200,25)){this.transform=a,this.grid=w,this.ignoredGrid=C,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+bo,this.screenBottomBoundary=a.height+bo,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=f}placeCollisionBox(a,f,w,C,R,I,F){let q=f.projectedAnchorX,X=f.projectedAnchorY,J=f.projectedAnchorZ;const it=f.elevation,pt=f.tileID;if(it&&pt){const Ut=this.transform.projection.upVector(pt.canonical,f.tileAnchorX,f.tileAnchorY),Rt=this.transform.projection.upVectorScale(pt.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;q+=Ut[0]*it*Rt,X+=Ut[1]*it*Rt,J+=Ut[2]*it*Rt}const gt=this.projectAndGetPerspectiveRatio(I,[q,X,J],f.tileID,this.transform.projection.name==="globe"||!!it||this.transform.pitch>0),ft=R*gt.perspectiveRatio,ut=(f.x1*a+w.x-f.padding)*ft+gt.point.x,Ft=(f.y1*a+w.y-f.padding)*ft+gt.point.y,Et=(f.x2*a+w.x+f.padding)*ft+gt.point.x,It=(f.y2*a+w.y+f.padding)*ft+gt.point.y,Bt=gt.perspectiveRatio<=.55||gt.occluded;return!this.isInsideGrid(ut,Ft,Et,It)||!C&&this.grid.hitTest(ut,Ft,Et,It,F)||Bt?{box:[],offscreen:!1,occluded:gt.occluded}:{box:[ut,Ft,Et,It],offscreen:this.isOffscreen(ut,Ft,Et,It),occluded:!1}}placeCollisionCircles(a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft){const ut=[],Ft=this.transform.elevation,Et=Ft?Ft.getAtTileOffsetFunc(ft,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Ie=>[0,0,0],It=new o.pointGeometry(f.tileAnchorX,f.tileAnchorY),Bt=this.transform.projection.projectTilePoint(f.tileAnchorX,f.tileAnchorY,ft.canonical),Ut=Et(It),Rt=[Bt.x+Ut[0],Bt.y+Ut[1],Bt.z+Ut[2]],Ht=this.projectAndGetPerspectiveRatio(I,[Rt[0],Rt[1],Rt[2]],ft,this.transform.projection.name==="globe"||!!Ft||this.transform.pitch>0),{perspectiveRatio:re}=Ht,he=(J?R/re:R*re)/o.ONE_EM,xe=hi(new o.pointGeometry(Rt[0],Rt[1]),F,Rt[2]).point,ge=Ht.signedDistanceFromCamera>0?Nu(he,C,f.lineOffsetX*he,f.lineOffsetY*he,!1,xe,It,f,w,F,{},Ft&&!J?Et:null,J&&!!Ft,this.transform.projection,ft):null;let ze=!1,oe=!1,Ne=!0;if(ge&&!Ht.occluded){const Ie=.5*pt*re+gt,en=new o.pointGeometry(-100,-100),ve=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ze=new vn,_n=ge.first,Qe=ge.last;let $e=[];for(let gn=_n.path.length-1;gn>=1;gn--)$e.push(_n.path[gn]);for(let gn=1;gn<Qe.path.length;gn++)$e.push(Qe.path[gn]);const An=2.5*Ie;if(q){const gn=$e.map(Ft?(Pn,Zn)=>{const Ei=Et(Zn<_n.path.length-1?_n.tilePath[_n.path.length-1-Zn]:Qe.tilePath[Zn-_n.path.length+2]);return hi(Pn,q,Ei[2])}:Pn=>hi(Pn,q));$e=gn.some(Pn=>Pn.signedDistanceFromCamera<=0)?[]:gn.map(Pn=>Pn.point)}let Un=[];if($e.length>0){const gn=$e[0].clone(),Pn=$e[0].clone();for(let Zn=1;Zn<$e.length;Zn++)gn.x=Math.min(gn.x,$e[Zn].x),gn.y=Math.min(gn.y,$e[Zn].y),Pn.x=Math.max(Pn.x,$e[Zn].x),Pn.y=Math.max(Pn.y,$e[Zn].y);Un=gn.x>=en.x&&Pn.x<=ve.x&&gn.y>=en.y&&Pn.y<=ve.y?[$e]:Pn.x<en.x||gn.x>ve.x||Pn.y<en.y||gn.y>ve.y?[]:o.clipLine([$e],en.x,en.y,ve.x,ve.y)}for(const gn of Un){Ze.reset(gn,.25*Ie);let Pn=0;Pn=Ze.length<=.5*Ie?1:Math.ceil(Ze.paddedLength/An)+1;for(let Zn=0;Zn<Pn;Zn++){const Ei=Zn/Math.max(Pn-1,1),cr=Ze.lerp(Ei),ur=cr.x+bo,Vr=cr.y+bo;ut.push(ur,Vr,Ie,0);const Ao=ur-Ie,ts=Vr-Ie,Ss=ur+Ie,es=Vr+Ie;if(Ne=Ne&&this.isOffscreen(Ao,ts,Ss,es),oe=oe||this.isInsideGrid(Ao,ts,Ss,es),!a&&this.grid.hitTestCircle(ur,Vr,Ie,it)&&(ze=!0,!X))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!X&&ze||!oe?[]:ut,offscreen:Ne,collisionDetected:ze,occluded:Ht.occluded}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let w=1/0,C=1/0,R=-1/0,I=-1/0;for(const J of a){const it=new o.pointGeometry(J.x+bo,J.y+bo);w=Math.min(w,it.x),C=Math.min(C,it.y),R=Math.max(R,it.x),I=Math.max(I,it.y),f.push(it)}const F=this.grid.query(w,C,R,I).concat(this.ignoredGrid.query(w,C,R,I)),q={},X={};for(const J of F){const it=J.key;if(q[it.bucketInstanceId]===void 0&&(q[it.bucketInstanceId]={}),q[it.bucketInstanceId][it.featureIndex])continue;const pt=[new o.pointGeometry(J.x1,J.y1),new o.pointGeometry(J.x2,J.y1),new o.pointGeometry(J.x2,J.y2),new o.pointGeometry(J.x1,J.y2)];o.polygonIntersectsPolygon(f,pt)&&(q[it.bucketInstanceId][it.featureIndex]=!0,X[it.bucketInstanceId]===void 0&&(X[it.bucketInstanceId]=[]),X[it.bucketInstanceId].push(it.featureIndex))}return X}insertCollisionBox(a,f,w,C,R){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:C,collisionGroupID:R},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,f,w,C,R){const I=f?this.ignoredGrid:this.grid,F={bucketInstanceId:w,featureIndex:C,collisionGroupID:R};for(let q=0;q<a.length;q+=4)I.insertCircle(F,a[q],a[q+1],a[q+2])}projectAndGetPerspectiveRatio(a,f,w,C){const R=[f[0],f[1],f[2],1];let I=!1;return f[2]||this.transform.pitch>0?(o.transformMat4$1(R,R,a),this.fogState&&w&&(I=function(F,q,X,J,it,pt){const gt=pt.calculateFogTileMatrix(it),ft=[q,X,J];return o.transformMat4(ft,ft,gt),le(F,ft,pt.pitch,pt._fov)}(this.fogState,f[0],f[1],f[2],w.toUnwrapped(),this.transform)>.9)):Br(R,R,a),{point:new o.pointGeometry((R[0]/R[3]+1)/2*this.transform.width+bo,(-R[1]/R[3]+1)/2*this.transform.height+bo),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/R[3]*.5,1.5),signedDistanceFromCamera:R[3],occluded:C&&R[2]>R[3]||I}}isOffscreen(a,f,w,C){return w<bo||a>=this.screenRightBoundary||C<bo||f>this.screenBottomBoundary}isInsideGrid(a,f,w,C){return w>=0&&a<this.gridRightBoundary&&C>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const a=o.identity([]);return o.translate(a,a,[-100,-100,0]),a}}class Fi{constructor(a,f,w,C){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?f:-f))):C&&w?1:0,this.placed=w}isHidden(){return this.opacity===0&&!this.placed}}class Ko{constructor(a,f,w,C,R,I=!1){this.text=new Fi(a?a.text:null,f,w,R),this.icon=new Fi(a?a.icon:null,f,C,R),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zo{constructor(a,f,w,C=!1){this.text=a,this.icon=f,this.skipFade=w,this.clipped=C}}class sr{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class fp{constructor(a,f,w,C,R){this.bucketInstanceId=a,this.featureIndex=f,this.sourceLayerIndex=w,this.bucketIndex=C,this.tileID=R}}class Mo{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const f=++this.maxGroupID;this.collisionGroups[a]={ID:f,predicate:w=>w.collisionGroupID===f}}return this.collisionGroups[a]}}function ja(v,a,f,w,C){const{horizontalAlign:R,verticalAlign:I}=o.getAnchorAlignment(v),F=-(R-.5)*a,q=-(I-.5)*f,X=o.evaluateVariableOffset(v,w);return new o.pointGeometry(F+X[0]*C,q+X[1]*C)}function Ha(v,a,f,w,C){const R=new o.pointGeometry(v,a);return f&&R._rotate(w?C:-C),R}class C1{constructor(a,f,w,C,R){this.transform=a.clone(),this.collisionIndex=new Vu(this.transform,R),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Mo(w),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,f,w,C){const R=w.getBucket(f),I=w.latestFeatureIndex;if(!R||!I||f.id!==R.layerIds[0])return;const F=R.layers[0].layout,q=w.collisionBoxArray,X=Math.pow(2,this.transform.zoom-w.tileID.overscaledZ),J=w.tileSize/o.EXTENT,it=w.tileID.toUnwrapped(),pt=this.transform.calculateProjMatrix(it),gt=F.get("text-pitch-alignment")==="map",ft=F.get("text-rotation-alignment")==="map";f.compileFilter();const ut=f.dynamicFilter(),Ft=f.dynamicFilterNeedsFeature(),Et=this.transform.calculatePixelsToTileUnitsMatrix(w),It=xi(pt,w.tileID.canonical,gt,ft,this.transform,Et);let Bt=null;if(gt){const Ht=kr(pt,w.tileID.canonical,gt,ft,this.transform,Et);Bt=o.multiply$1([],this.transform.labelPlaneMatrix,Ht)}let Ut=null;ut&&w.latestFeatureIndex&&(Ut={unwrappedTileID:it,dynamicFilter:ut,dynamicFilterNeedsFeature:Ft,featureIndex:w.latestFeatureIndex}),this.retainedQueryData[R.bucketInstanceId]=new fp(R.bucketInstanceId,I,R.sourceLayerIndex,R.index,w.tileID);const Rt={bucket:R,layout:F,posMatrix:pt,textLabelPlaneMatrix:It,labelToScreenMatrix:Bt,clippingData:Ut,scale:X,textPixelRatio:J,holdingForFade:w.holdingForFade(),collisionBoxArray:q,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(R.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(R.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(R.sourceID)};if(C)for(const Ht of R.sortKeyRanges){const{sortKey:re,symbolInstanceStart:he,symbolInstanceEnd:xe}=Ht;a.push({sortKey:re,symbolInstanceStart:he,symbolInstanceEnd:xe,parameters:Rt})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:R.symbolInstances.length,parameters:Rt})}attemptAnchorPlacement(a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft,ut,Ft,Et,It){const Bt=[pt.textOffset0,pt.textOffset1],Ut=ja(a,w,C,Bt,R),Rt=this.collisionIndex.placeCollisionBox(R,f,Ha(Ut.x,Ut.y,I,F,this.transform.angle),it,q,X,J.predicate);if((!Ft||this.collisionIndex.placeCollisionBox(ft.getSymbolInstanceIconSize(It,this.transform.zoom,gt),Ft,Ha(Ut.x,Ut.y,I,F,this.transform.angle),it,q,X,J.predicate).box.length!==0)&&Rt.box.length>0){let Ht;return this.prevPlacement&&this.prevPlacement.variableOffsets[pt.crossTileID]&&this.prevPlacement.placements[pt.crossTileID]&&this.prevPlacement.placements[pt.crossTileID].text&&(Ht=this.prevPlacement.variableOffsets[pt.crossTileID].anchor),this.variableOffsets[pt.crossTileID]={textOffset:Bt,width:w,height:C,anchor:a,textScale:R,prevAnchor:Ht},this.markUsedJustification(ft,a,pt,ut),ft.allowVerticalPlacement&&(this.markUsedOrientation(ft,ut,pt),this.placedOrientations[pt.crossTileID]=ut),{shift:Ut,placedGlyphBoxes:Rt}}}placeLayerBucketPart(a,f,w,C){const{bucket:R,layout:I,posMatrix:F,textLabelPlaneMatrix:q,labelToScreenMatrix:X,clippingData:J,textPixelRatio:it,holdingForFade:pt,collisionBoxArray:gt,partiallyEvaluatedTextSize:ft,partiallyEvaluatedIconSize:ut,collisionGroup:Ft}=a.parameters,Et=I.get("text-optional"),It=I.get("icon-optional"),Bt=I.get("text-allow-overlap"),Ut=I.get("icon-allow-overlap"),Rt=I.get("text-rotation-alignment")==="map",Ht=I.get("text-pitch-alignment")==="map",re=I.get("icon-text-fit")!=="none",he=I.get("symbol-z-order")==="viewport-y";let xe=Bt&&(Ut||!R.hasIconData()||It),ge=Ut&&(Bt||!R.hasTextData()||Et);!R.collisionArrays&&gt&&R.deserializeCollisionBoxes(gt),w&&C&&R.updateCollisionDebugBuffers(this.transform.zoom,gt);const ze=(oe,Ne,Ie)=>{if(J){const Pi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Di=null;if(J.dynamicFilterNeedsFeature){const ti=this.retainedQueryData[R.bucketInstanceId];Di=J.featureIndex.loadFeature({featureIndex:oe.featureIndex,bucketIndex:ti.bucketIndex,sourceLayerIndex:ti.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,J.dynamicFilter)(Pi,Di,this.retainedQueryData[R.bucketInstanceId].tileID.canonical,new o.pointGeometry(oe.tileAnchorX,oe.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[oe.crossTileID]=new Zo(!1,!1,!1,!0),void(f[oe.crossTileID]=!0)}if(f[oe.crossTileID])return;if(pt)return void(this.placements[oe.crossTileID]=new Zo(!1,!1,!1));let en=!1,ve=!1,Ze=!0,_n=!1,Qe=!1,$e=null,An={box:null,offscreen:null,occluded:null},Un={box:null,offscreen:null,occluded:null},gn=null,Pn=null,Zn=null,Ei=0,cr=0,ur=0;Ie.textFeatureIndex?Ei=Ie.textFeatureIndex:oe.useRuntimeCollisionCircles&&(Ei=oe.featureIndex),Ie.verticalTextFeatureIndex&&(cr=Ie.verticalTextFeatureIndex);const Vr=Pi=>{Pi.tileID=this.retainedQueryData[R.bucketInstanceId].tileID,(this.transform.elevation||Pi.elevation)&&(Pi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[R.bucketInstanceId].tileID,Pi.tileAnchorX,Pi.tileAnchorY):0)},Ao=Ie.textBox;if(Ao){Vr(Ao);const Pi=ti=>{let zi=o.WritingMode.horizontal;if(R.allowVerticalPlacement&&!ti&&this.prevPlacement){const Gr=this.prevPlacement.placedOrientations[oe.crossTileID];Gr&&(this.placedOrientations[oe.crossTileID]=Gr,zi=Gr,this.markUsedOrientation(R,zi,oe))}return zi},Di=(ti,zi)=>{if(R.allowVerticalPlacement&&oe.numVerticalGlyphVertices>0&&Ie.verticalTextBox){for(const Gr of R.writingModes)if(Gr===o.WritingMode.vertical?(An=zi(),Un=An):An=ti(),An&&An.box&&An.box.length)break}else An=ti()};if(I.get("text-variable-anchor")){let ti=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]){const Ti=this.prevPlacement.variableOffsets[oe.crossTileID];ti.indexOf(Ti.anchor)>0&&(ti=ti.filter(no=>no!==Ti.anchor),ti.unshift(Ti.anchor))}const zi=(Ti,no,gc)=>{const Or=R.getSymbolInstanceTextSize(ft,oe,this.transform.zoom,Ne),aa=(Ti.x2-Ti.x1)*Or+2*Ti.padding,Dy=(Ti.y2-Ti.y1)*Or+2*Ti.padding,Jp=re&&!Ut?no:null;Jp&&Vr(Jp);let el={box:[],offscreen:!1,occluded:!1};const q1=Bt?2*ti.length:ti.length;for(let Cs=0;Cs<q1;++Cs){const Qp=this.attemptAnchorPlacement(ti[Cs%ti.length],Ti,aa,Dy,Or,Rt,Ht,it,F,Ft,Cs>=ti.length,oe,Ne,R,gc,Jp,ft,ut);if(Qp&&(el=Qp.placedGlyphBoxes,el&&el.box&&el.box.length)){en=!0,$e=Qp.shift;break}}return el};Di(()=>zi(Ao,Ie.iconBox,o.WritingMode.horizontal),()=>{const Ti=Ie.verticalTextBox;return Ti&&Vr(Ti),R.allowVerticalPlacement&&!(An&&An.box&&An.box.length)&&oe.numVerticalGlyphVertices>0&&Ti?zi(Ti,Ie.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),An&&(en=An.box,Ze=An.offscreen,_n=An.occluded);const Gr=Pi(An&&An.box);if(!en&&this.prevPlacement){const Ti=this.prevPlacement.variableOffsets[oe.crossTileID];Ti&&(this.variableOffsets[oe.crossTileID]=Ti,this.markUsedJustification(R,Ti.anchor,oe,Gr))}}else{const ti=(zi,Gr)=>{const Ti=R.getSymbolInstanceTextSize(ft,oe,this.transform.zoom,Ne),no=this.collisionIndex.placeCollisionBox(Ti,zi,new o.pointGeometry(0,0),Bt,it,F,Ft.predicate);return no&&no.box&&no.box.length&&(this.markUsedOrientation(R,Gr,oe),this.placedOrientations[oe.crossTileID]=Gr),no};Di(()=>ti(Ao,o.WritingMode.horizontal),()=>{const zi=Ie.verticalTextBox;return R.allowVerticalPlacement&&oe.numVerticalGlyphVertices>0&&zi?(Vr(zi),ti(zi,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Pi(An&&An.box&&An.box.length)}}if(gn=An,en=gn&&gn.box&&gn.box.length>0,Ze=gn&&gn.offscreen,_n=gn&&gn.occluded,oe.useRuntimeCollisionCircles){const Pi=R.text.placedSymbolArray.get(oe.centerJustifiedTextSymbolIndex>=0?oe.centerJustifiedTextSymbolIndex:oe.verticalPlacedTextSymbolIndex),Di=o.evaluateSizeForFeature(R.textSizeData,ft,Pi),ti=I.get("text-padding");Pn=this.collisionIndex.placeCollisionCircles(Bt,Pi,R.lineVertexArray,R.glyphOffsetArray,Di,F,q,X,w,Ht,Ft.predicate,oe.collisionCircleDiameter*Di/o.ONE_EM,ti,this.retainedQueryData[R.bucketInstanceId].tileID),en=Bt||Pn.circles.length>0&&!Pn.collisionDetected,Ze=Ze&&Pn.offscreen,_n=Pn.occluded}if(Ie.iconFeatureIndex&&(ur=Ie.iconFeatureIndex),Ie.iconBox){const Pi=Di=>{Vr(Di);const ti=re&&$e?Ha($e.x,$e.y,Rt,Ht,this.transform.angle):new o.pointGeometry(0,0),zi=R.getSymbolInstanceIconSize(ut,this.transform.zoom,Ne);return this.collisionIndex.placeCollisionBox(zi,Di,ti,Ut,it,F,Ft.predicate)};Un&&Un.box&&Un.box.length&&Ie.verticalIconBox?(Zn=Pi(Ie.verticalIconBox),ve=Zn.box.length>0):(Zn=Pi(Ie.iconBox),ve=Zn.box.length>0),Ze=Ze&&Zn.offscreen,Qe=Zn.occluded}const ts=Et||oe.numHorizontalGlyphVertices===0&&oe.numVerticalGlyphVertices===0,Ss=It||oe.numIconVertices===0;if(ts||Ss?Ss?ts||(ve=ve&&en):en=ve&&en:ve=en=ve&&en,en&&gn&&gn.box&&this.collisionIndex.insertCollisionBox(gn.box,I.get("text-ignore-placement"),R.bucketInstanceId,Un&&Un.box&&cr?cr:Ei,Ft.ID),ve&&Zn&&this.collisionIndex.insertCollisionBox(Zn.box,I.get("icon-ignore-placement"),R.bucketInstanceId,ur,Ft.ID),Pn&&(en&&this.collisionIndex.insertCollisionCircles(Pn.circles,I.get("text-ignore-placement"),R.bucketInstanceId,Ei,Ft.ID),w)){const Pi=R.bucketInstanceId;let Di=this.collisionCircleArrays[Pi];Di===void 0&&(Di=this.collisionCircleArrays[Pi]=new sr);for(let ti=0;ti<Pn.circles.length;ti+=4)Di.circles.push(Pn.circles[ti+0]),Di.circles.push(Pn.circles[ti+1]),Di.circles.push(Pn.circles[ti+2]),Di.circles.push(Pn.collisionDetected?1:0)}const es=this.transform.projection.name!=="globe";xe=xe&&(es||!_n),ge=ge&&(es||!Qe),this.placements[oe.crossTileID]=new Zo(en||xe,ve||ge,Ze||R.justReloaded),f[oe.crossTileID]=!0};if(he){const oe=R.getSortedSymbolIndexes(this.transform.angle);for(let Ne=oe.length-1;Ne>=0;--Ne){const Ie=oe[Ne];ze(R.symbolInstances.get(Ie),Ie,R.collisionArrays[Ie])}}else for(let oe=a.symbolInstanceStart;oe<a.symbolInstanceEnd;oe++)ze(R.symbolInstances.get(oe),oe,R.collisionArrays[oe]);if(w&&R.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[R.bucketInstanceId];o.invert(oe.invProjMatrix,F),oe.viewportMatrix=this.collisionIndex.getViewportMatrix()}R.justReloaded=!1}markUsedJustification(a,f,w,C){let R;R=C===o.WritingMode.vertical?w.verticalPlacedTextSymbolIndex:{left:w.leftJustifiedTextSymbolIndex,center:w.centerJustifiedTextSymbolIndex,right:w.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(f)];const I=[w.leftJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.rightJustifiedTextSymbolIndex,w.verticalPlacedTextSymbolIndex];for(const F of I)F>=0&&(a.text.placedSymbolArray.get(F).crossTileID=R>=0&&F!==R?0:w.crossTileID)}markUsedOrientation(a,f,w){const C=f===o.WritingMode.horizontal||f===o.WritingMode.horizontalOnly?f:0,R=f===o.WritingMode.vertical?f:0,I=[w.leftJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.rightJustifiedTextSymbolIndex];for(const F of I)a.text.placedSymbolArray.get(F).placedOrientation=C;w.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(w.verticalPlacedTextSymbolIndex).placedOrientation=R)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let w=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const C=f?f.symbolFadeChange(a):1,R=f?f.opacities:{},I=f?f.variableOffsets:{},F=f?f.placedOrientations:{};for(const q in this.placements){const X=this.placements[q],J=R[q];J?(this.opacities[q]=new Ko(J,C,X.text,X.icon,null,X.clipped),w=w||X.text!==J.text.placed||X.icon!==J.icon.placed):(this.opacities[q]=new Ko(null,C,X.text,X.icon,X.skipFade,X.clipped),w=w||X.text||X.icon)}for(const q in R){const X=R[q];if(!this.opacities[q]){const J=new Ko(X,C,!1,!1);J.isHidden()||(this.opacities[q]=J,w=w||X.text.placed||X.icon.placed)}}for(const q in I)this.variableOffsets[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.variableOffsets[q]=I[q]);for(const q in F)this.placedOrientations[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.placedOrientations[q]=F[q]);w?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:a)}updateLayerOpacities(a,f){const w={};for(const C of f){const R=C.getBucket(a);R&&C.latestFeatureIndex&&a.id===R.layerIds[0]&&this.updateBucketOpacities(R,w,C.collisionBoxArray)}}updateBucketOpacities(a,f,w){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const C=a.layers[0].layout,R=!!a.layers[0].dynamicFilter(),I=new Ko(null,0,!1,!1,!0),F=C.get("text-allow-overlap"),q=C.get("icon-allow-overlap"),X=C.get("text-variable-anchor"),J=C.get("text-rotation-alignment")==="map",it=C.get("text-pitch-alignment")==="map",pt=C.get("icon-text-fit")!=="none",gt=new Ko(null,0,F&&(q||!a.hasIconData()||C.get("icon-optional")),q&&(F||!a.hasTextData()||C.get("text-optional")),!0);!a.collisionArrays&&w&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(w);const ft=(Ft,Et,It)=>{for(let Bt=0;Bt<Et/4;Bt++)Ft.opacityVertexArray.emplaceBack(It)};let ut=0;for(let Ft=0;Ft<a.symbolInstances.length;Ft++){const Et=a.symbolInstances.get(Ft),{numHorizontalGlyphVertices:It,numVerticalGlyphVertices:Bt,crossTileID:Ut}=Et;let Rt=this.opacities[Ut];f[Ut]?Rt=I:Rt||(Rt=gt,this.opacities[Ut]=Rt),f[Ut]=!0;const Ht=It>0||Bt>0,re=Et.numIconVertices>0,he=this.placedOrientations[Et.crossTileID],xe=he===o.WritingMode.vertical,ge=he===o.WritingMode.horizontal||he===o.WritingMode.horizontalOnly;if(!Ht&&!re||Rt.isHidden()||ut++,Ht){const ze=Ug(Rt.text);ft(a.text,It,xe?ju:ze),ft(a.text,Bt,ge?ju:ze);const oe=Rt.text.isHidden();[Et.rightJustifiedTextSymbolIndex,Et.centerJustifiedTextSymbolIndex,Et.leftJustifiedTextSymbolIndex].forEach(en=>{en>=0&&(a.text.placedSymbolArray.get(en).hidden=oe||xe?1:0)}),Et.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(Et.verticalPlacedTextSymbolIndex).hidden=oe||ge?1:0);const Ne=this.variableOffsets[Et.crossTileID];Ne&&this.markUsedJustification(a,Ne.anchor,Et,he);const Ie=this.placedOrientations[Et.crossTileID];Ie&&(this.markUsedJustification(a,"left",Et,Ie),this.markUsedOrientation(a,Ie,Et))}if(re){const ze=Ug(Rt.icon);Et.placedIconSymbolIndex>=0&&(ft(a.icon,Et.numIconVertices,xe?ju:ze),a.icon.placedSymbolArray.get(Et.placedIconSymbolIndex).hidden=Rt.icon.isHidden()),Et.verticalPlacedIconSymbolIndex>=0&&(ft(a.icon,Et.numVerticalIconVertices,ge?ju:ze),a.icon.placedSymbolArray.get(Et.verticalPlacedIconSymbolIndex).hidden=Rt.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const ze=a.collisionArrays[Ft];if(ze){let oe=new o.pointGeometry(0,0),Ne=!0;if(ze.textBox||ze.verticalTextBox){if(X){const en=this.variableOffsets[Ut];en?(oe=ja(en.anchor,en.width,en.height,en.textOffset,en.textScale),J&&oe._rotate(it?this.transform.angle:-this.transform.angle)):Ne=!1}R&&(Ne=!Rt.clipped),ze.textBox&&wo(a.textCollisionBox.collisionVertexArray,Rt.text.placed,!Ne||xe,oe.x,oe.y),ze.verticalTextBox&&wo(a.textCollisionBox.collisionVertexArray,Rt.text.placed,!Ne||ge,oe.x,oe.y)}const Ie=Ne&&!!(!ge&&ze.verticalIconBox);ze.iconBox&&wo(a.iconCollisionBox.collisionVertexArray,Rt.icon.placed,Ie,pt?oe.x:0,pt?oe.y:0),ze.verticalIconBox&&wo(a.iconCollisionBox.collisionVertexArray,Rt.icon.placed,!Ie,pt?oe.x:0,pt?oe.y:0)}}}if(a.fullyClipped=ut===0,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const Ft=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Ft.invProjMatrix,a.placementViewportMatrix=Ft.viewportMatrix,a.collisionCircleArray=Ft.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,f){const w=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*w>a}setStale(){this.stale=!0}}function wo(v,a,f,w,C){v.emplaceBack(a?1:0,f?1:0,w||0,C||0),v.emplaceBack(a?1:0,f?1:0,w||0,C||0),v.emplaceBack(a?1:0,f?1:0,w||0,C||0),v.emplaceBack(a?1:0,f?1:0,w||0,C||0)}const D1=Math.pow(2,25),Ng=Math.pow(2,24),Fr=Math.pow(2,17),Gu=Math.pow(2,16),vs=Math.pow(2,9),mp=Math.pow(2,8),Ou=Math.pow(2,1);function Ug(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const a=v.placed?1:0,f=Math.floor(127*v.opacity);return f*D1+a*Ng+f*Fr+a*Gu+f*vs+a*mp+f*Ou+a}const ju=0;class gp{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&a.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,f,w,C,R){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(f.getBucketParts(I,C,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,R())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((F,q)=>F.sortKey-q.sortKey));this._currentPartIndex<I.length;){const F=I[this._currentPartIndex];if(f.placeLayerBucketPart(F,this._seenCrossTileIDs,w,F.symbolInstanceStart===0),this._currentPartIndex++,R())return!0}return!1}}class R1{constructor(a,f,w,C,R,I,F,q){this.placement=new C1(a,R,I,F,q),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=w,this._showCollisionBoxes=C,this._done=!1}isDone(){return this._done}continuePlacement(a,f,w){const C=o.exported.now(),R=()=>{const I=o.exported.now()-C;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=f[a[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=F)&&(!I.maxzoom||I.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new gp(I)),this._inProgressLayer.continuePlacement(w[I.source],this.placement,this._showCollisionBoxes,I,R))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Vg=512/o.EXTENT/2;class L1{constructor(a,f,w){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=w;for(let C=0;C<f.length;C++){const R=f.get(C),I=R.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:R.crossTileID,coord:this.getScaledCoordinates(R,a)})}}getScaledCoordinates(a,f){const w=Vg/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*o.EXTENT+a.tileAnchorX)*w),y:Math.floor((f.canonical.y*o.EXTENT+a.tileAnchorY)*w)}}findMatches(a,f,w){const C=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let R=0;R<a.length;R++){const I=a.get(R);if(I.crossTileID)continue;const F=this.indexedSymbolInstances[I.key];if(!F)continue;const q=this.getScaledCoordinates(I,f);for(const X of F)if(Math.abs(X.coord.x-q.x)<=C&&Math.abs(X.coord.y-q.y)<=C&&!w[X.crossTileID]){w[X.crossTileID]=!0,I.crossTileID=X.crossTileID;break}}}}class Gg{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class I1{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const f=Math.round((a-this.lng)/360);if(f!==0)for(const w in this.indexes){const C=this.indexes[w],R={};for(const I in C){const F=C[I];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+f),R[F.tileID.key]=F}this.indexes[w]=R}this.lng=a}addBucket(a,f,w){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let R=0;R<f.symbolInstances.length;R++)f.symbolInstances.get(R).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const C=this.usedCrossTileIDs[a.overscaledZ];for(const R in this.indexes){const I=this.indexes[R];if(Number(R)>a.overscaledZ)for(const F in I){const q=I[F];q.tileID.isChildOf(a)&&q.findMatches(f.symbolInstances,a,C)}else{const F=I[a.scaledTo(Number(R)).key];F&&F.findMatches(f.symbolInstances,a,C)}}for(let R=0;R<f.symbolInstances.length;R++){const I=f.symbolInstances.get(R);I.crossTileID||(I.crossTileID=w.generate(),C[I.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new L1(a,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(a,f){for(const w in f.indexedSymbolInstances)for(const C of f.indexedSymbolInstances[w])delete this.usedCrossTileIDs[a][C.crossTileID]}removeStaleBuckets(a){let f=!1;for(const w in this.indexes){const C=this.indexes[w];for(const R in C)a[C[R].bucketInstanceId]||(this.removeBucketCrossTileIDs(w,C[R]),delete C[R],f=!0)}return f}}class Hu{constructor(){this.layerIndexes={},this.crossTileIDs=new Gg,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,f,w,C){let R=this.layerIndexes[a.id];R===void 0&&(R=this.layerIndexes[a.id]=new I1);let I=!1;const F={};C.name!=="globe"&&R.handleWrapJump(w);for(const q of f){const X=q.getBucket(a);X&&a.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),R.addBucket(q.tileID,X,this.crossTileIDs)&&(I=!0),F[X.bucketInstanceId]=!0)}return R.removeStaleBuckets(F)&&(I=!0),I}pruneUnusedLayers(a){const f={};a.forEach(w=>{f[w]=!0});for(const w in this.layerIndexes)f[w]||delete this.layerIndexes[w]}}const Wl=(v,a)=>o.emitValidationErrors(v,a&&a.filter(f=>f.identifier!=="source.canvas")),Og=o.pick(Me,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),jg=o.pick(Me,["setCenter","setZoom","setBearing","setPitch"]),Hg={version:8,layers:[],sources:{}},ea={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ar extends o.Evented{constructor(a,f={}){super(),this.map=a,this.dispatcher=new bt(Vt(),this),this.imageManager=new st,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(a._requestManager,f.localFontFamily?o.LocalGlyphMode.all:f.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,f.localFontFamily||f.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new Hu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const w=this;this._rtlTextPluginCallback=Ar.registerForPluginStateChange(C=>{w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},(R,I)=>{if(o.triggerPluginCompletionEvent(R),I&&I.every(F=>F))for(const F in w._sourceCaches){const q=w._sourceCaches[F],X=q.getSource().type;X!=="vector"&&X!=="geojson"||q.reload()}})}),this.on("data",C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const R=this.getSource(C.sourceId);if(R&&R.vectorLayerIds)for(const I in this._layers){const F=this._layers[I];F.source===R.id&&this._validateLayer(F)}})}loadURL(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const w=typeof f.validate=="boolean"?f.validate:!o.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,f.accessToken);const C=this.map._requestManager.transformRequest(a,o.ResourceType.Style);this._request=o.getJSON(C,(R,I)=>{this._request=null,R?this.fire(new o.ErrorEvent(R)):I&&this._load(I,w)})}loadJSON(a,f={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(a,f.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Hg,!1)}_updateLayerCount(a,f){const w=f?1:-1;a.is3D()&&(this._num3DLayers+=w),a.type==="circle"&&(this._numCircleLayers+=w),a.type==="symbol"&&(this._numSymbolLayers+=w)}_load(a,f){if(f&&Wl(this,o.validateStyle(a)))return;this._loaded=!0,this.stylesheet=a,this._updateMapProjection();for(const C in a.sources)this.addSource(C,a.sources[C],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const w=Se(this.stylesheet.layers);this._order=w.map(C=>C.id),this._layers={},this._serializedLayers={};for(let C of w)C=o.createStyleLayer(C),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(a){this._spriteRequest=function(f,w,C){let R,I,F;const q=o.exported.devicePixelRatio>1?"@2x":"";let X=o.getJSON(w.transformRequest(w.normalizeSpriteURL(f,q,".json"),o.ResourceType.SpriteJSON),(pt,gt)=>{X=null,F||(F=pt,R=gt,it())}),J=o.getImage(w.transformRequest(w.normalizeSpriteURL(f,q,".png"),o.ResourceType.SpriteImage),(pt,gt)=>{J=null,F||(F=pt,I=gt,it())});function it(){if(F)C(F);else if(R&&I){const pt=o.exported.getImageData(I),gt={};for(const ft in R){const{width:ut,height:Ft,x:Et,y:It,sdf:Bt,pixelRatio:Ut,stretchX:Rt,stretchY:Ht,content:re}=R[ft],he=new o.RGBAImage({width:ut,height:Ft});o.RGBAImage.copy(pt,he,{x:Et,y:It},{x:0,y:0},{width:ut,height:Ft}),gt[ft]={data:he,pixelRatio:Ut,sdf:Bt,stretchX:Rt,stretchY:Ht,content:re}}C(null,gt)}}return{cancel(){X&&(X.cancel(),X=null),J&&(J.cancel(),J=null)}}}(a,this.map._requestManager,(f,w)=>{if(this._spriteRequest=null,f)this.fire(new o.ErrorEvent(f));else if(w)for(const C in w)this.imageManager.addImage(C,w[C]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(a){const f=this.getSource(a.source);if(!f)return;const w=a.sourceLayer;w&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(w)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${w}" does not exist on source "${f.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const f=[];for(const w of a){const C=this._layers[w];C.type!=="custom"&&f.push(C.serialize())}return f}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&ea[a.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const f=this._changed;if(this._changed){const C=Object.keys(this._updatedLayers),R=Object.keys(this._removedLayers);(C.length||R.length)&&this._updateWorkerLayers(C,R);for(const I in this._updatedSources){const F=this._updatedSources[I];F==="reload"?this._reloadSource(I):F==="clear"&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const w={};for(const C in this._sourceCaches){const R=this._sourceCaches[C];w[C]=R.used,R.used=!1}for(const C of this._order){const R=this._layers[C];if(R.recalculate(a,this._availableImages),!R.isHidden(a.zoom)){const F=this._getLayerSourceCache(R);F&&(F.used=!0)}const I=this.map.painter;if(I){const F=R.getProgramIds();if(!F)continue;const q=R.getProgramConfiguration(a.zoom);for(const X of F)I.useProgram(X,q)}}for(const C in w){const R=this._sourceCaches[C];w[C]!==R.used&&R.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),f&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),Wl(this,o.validateStyle(a)))return!1;(a=o.clone$1(a)).layers=Se(a.layers);const f=function(C,R){if(!C)return[{command:Me.setStyle,args:[R]}];let I=[];try{if(!M(C.version,R.version))return[{command:Me.setStyle,args:[R]}];M(C.center,R.center)||I.push({command:Me.setCenter,args:[R.center]}),M(C.zoom,R.zoom)||I.push({command:Me.setZoom,args:[R.zoom]}),M(C.bearing,R.bearing)||I.push({command:Me.setBearing,args:[R.bearing]}),M(C.pitch,R.pitch)||I.push({command:Me.setPitch,args:[R.pitch]}),M(C.sprite,R.sprite)||I.push({command:Me.setSprite,args:[R.sprite]}),M(C.glyphs,R.glyphs)||I.push({command:Me.setGlyphs,args:[R.glyphs]}),M(C.transition,R.transition)||I.push({command:Me.setTransition,args:[R.transition]}),M(C.light,R.light)||I.push({command:Me.setLight,args:[R.light]}),M(C.fog,R.fog)||I.push({command:Me.setFog,args:[R.fog]}),M(C.projection,R.projection)||I.push({command:Me.setProjection,args:[R.projection]});const F={},q=[];(function(it,pt,gt,ft){let ut;for(ut in pt=pt||{},it=it||{})it.hasOwnProperty(ut)&&(pt.hasOwnProperty(ut)||ln(ut,gt,ft));for(ut in pt)pt.hasOwnProperty(ut)&&(it.hasOwnProperty(ut)?M(it[ut],pt[ut])||(it[ut].type==="geojson"&&pt[ut].type==="geojson"&&Bn(it,pt,ut)?gt.push({command:Me.setGeoJSONSourceData,args:[ut,pt[ut].data]}):kn(ut,pt,gt,ft)):Oe(ut,pt,gt))})(C.sources,R.sources,q,F);const X=[];C.layers&&C.layers.forEach(it=>{it.source&&F[it.source]?I.push({command:Me.removeLayer,args:[it.id]}):X.push(it)});let J=C.terrain;J&&F[J.source]&&(I.push({command:Me.setTerrain,args:[void 0]}),J=void 0),I=I.concat(q),M(J,R.terrain)||I.push({command:Me.setTerrain,args:[R.terrain]}),function(it,pt,gt){pt=pt||[];const ft=(it=it||[]).map(fn),ut=pt.map(fn),Ft=it.reduce(tn,{}),Et=pt.reduce(tn,{}),It=ft.slice(),Bt=Object.create(null);let Ut,Rt,Ht,re,he,xe,ge;for(Ut=0,Rt=0;Ut<ft.length;Ut++)Ht=ft[Ut],Et.hasOwnProperty(Ht)?Rt++:(gt.push({command:Me.removeLayer,args:[Ht]}),It.splice(It.indexOf(Ht,Rt),1));for(Ut=0,Rt=0;Ut<ut.length;Ut++)Ht=ut[ut.length-1-Ut],It[It.length-1-Ut]!==Ht&&(Ft.hasOwnProperty(Ht)?(gt.push({command:Me.removeLayer,args:[Ht]}),It.splice(It.lastIndexOf(Ht,It.length-Rt),1)):Rt++,xe=It[It.length-Ut],gt.push({command:Me.addLayer,args:[Et[Ht],xe]}),It.splice(It.length-Ut,0,Ht),Bt[Ht]=!0);for(Ut=0;Ut<ut.length;Ut++)if(Ht=ut[Ut],re=Ft[Ht],he=Et[Ht],!Bt[Ht]&&!M(re,he))if(M(re.source,he.source)&&M(re["source-layer"],he["source-layer"])&&M(re.type,he.type)){for(ge in Pe(re.layout,he.layout,gt,Ht,null,Me.setLayoutProperty),Pe(re.paint,he.paint,gt,Ht,null,Me.setPaintProperty),M(re.filter,he.filter)||gt.push({command:Me.setFilter,args:[Ht,he.filter]}),M(re.minzoom,he.minzoom)&&M(re.maxzoom,he.maxzoom)||gt.push({command:Me.setLayerZoomRange,args:[Ht,he.minzoom,he.maxzoom]}),re)re.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&(ge.indexOf("paint.")===0?Pe(re[ge],he[ge],gt,Ht,ge.slice(6),Me.setPaintProperty):M(re[ge],he[ge])||gt.push({command:Me.setLayerProperty,args:[Ht,ge,he[ge]]}));for(ge in he)he.hasOwnProperty(ge)&&!re.hasOwnProperty(ge)&&ge!=="layout"&&ge!=="paint"&&ge!=="filter"&&ge!=="metadata"&&ge!=="minzoom"&&ge!=="maxzoom"&&(ge.indexOf("paint.")===0?Pe(re[ge],he[ge],gt,Ht,ge.slice(6),Me.setPaintProperty):M(re[ge],he[ge])||gt.push({command:Me.setLayerProperty,args:[Ht,ge,he[ge]]}))}else gt.push({command:Me.removeLayer,args:[Ht]}),xe=It[It.lastIndexOf(Ht)+1],gt.push({command:Me.addLayer,args:[he,xe]})}(X,R.layers,I)}catch(F){console.warn("Unable to compute style diff:",F),I=[{command:Me.setStyle,args:[R]}]}return I}(this.serialize(),a).filter(C=>!(C.command in jg));if(f.length===0)return!1;const w=f.filter(C=>!(C.command in Og));if(w.length>0)throw new Error(`Unimplemented: ${w.map(C=>C.command).join(", ")}.`);return f.forEach(C=>{C.command!=="setTransition"&&this[C.command].apply(this,C.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,f){return this.getImage(a)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,f),this._afterImageUpdated(a),this)}updateImage(a,f){this.imageManager.updateImage(a,f)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,f,w={}){if(this._checkLoaded(),this.getSource(a)!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.validateSource,`sources.${a}`,f,null,w))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const C=ie(a,f,this.dispatcher,this);C.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:C.serialize(),sourceId:a}));const R=I=>{const F=(I?"symbol:":"other:")+a,q=this._sourceCaches[F]=new o.SourceCache(F,C,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=q,q.style=this,q.onAdd(this.map)};R(!1),f.type!=="vector"&&f.type!=="geojson"||R(!0),C.onAdd&&C.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const f=this.getSource(a);if(!f)throw new Error("There is no source with this ID");for(const C in this._layers)if(this._layers[C].source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${C}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new o.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const w=this._getSourceCaches(a);for(const C of w)delete this._sourceCaches[C.id],delete this._updatedSources[C.id],C.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:C.getSource().id})),C.setEventedParent(null),C.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,f){this._checkLoaded(),this.getSource(a).setData(f),this._changed=!0}getSource(a){const f=this._getSourceCache(a);return f&&f.getSource()}addLayer(a,f,w={}){this._checkLoaded();const C=a.id;if(this.getLayer(C))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${C}" already exists on this map`)));let R;if(a.type==="custom"){if(Wl(this,o.validateCustomStyleLayer(a)))return;R=o.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(C,a.source),a=o.clone$1(a),a=o.extend(a,{source:C})),this._validate(o.validateLayer,`layers.${C}`,a,{arrayIndex:-1},w))return;R=o.createStyleLayer(a),this._validateLayer(R),R.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[R.id]=R.serialize(),this._updateLayerCount(R,!0)}const I=f?this._order.indexOf(f):this._order.length;if(f&&I===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`)));this._order.splice(I,0,C),this._layerOrderChanged=!0,this._layers[C]=R;const F=this._getLayerSourceCache(R);if(this._removedLayers[C]&&R.source&&F&&R.type!=="custom"){const q=this._removedLayers[C];delete this._removedLayers[C],q.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",F.pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,f){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===f)return;const w=this._order.indexOf(a);this._order.splice(w,1);const C=f?this._order.indexOf(f):this._order.length;f&&C===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" does not exist on this map.`))):(this._order.splice(C,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const f=this._layers[a];if(!f)return void this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));f.setEventedParent(null),this._updateLayerCount(f,!1);const w=this._order.indexOf(a);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=f,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],f.onRemove&&f.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const f in this._layers)if(this._layers[f].type===a)return!0;return!1}setLayerZoomRange(a,f,w){this._checkLoaded();const C=this.getLayer(a);C?C.minzoom===f&&C.maxzoom===w||(f!=null&&(C.minzoom=f),w!=null&&(C.maxzoom=w),this._updateLayer(C)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,f,w={}){this._checkLoaded();const C=this.getLayer(a);if(C){if(!M(C.filter,f))return f==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(o.validateFilter,`layers.${C.id}.filter`,f,{layerType:C.type},w)||(C.filter=o.clone$1(f),this._updateLayer(C)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const f=this.getLayer(a);return f&&o.clone$1(f.filter)}setLayoutProperty(a,f,w,C={}){this._checkLoaded();const R=this.getLayer(a);R?M(R.getLayoutProperty(f),w)||(R.setLayoutProperty(f,w,C),this._updateLayer(R)):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,f){const w=this.getLayer(a);if(w)return w.getLayoutProperty(f);this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,f,w,C={}){this._checkLoaded();const R=this.getLayer(a);R?M(R.getPaintProperty(f),w)||(R.setPaintProperty(f,w,C)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,f){const w=this.getLayer(a);return w&&w.getPaintProperty(f)}setFeatureState(a,f){this._checkLoaded();const w=a.source,C=a.sourceLayer,R=this.getSource(w);if(!R)return void this.fire(new o.ErrorEvent(new Error(`The source '${w}' does not exist in the map's style.`)));const I=R.type;if(I==="geojson"&&C)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(I==="vector"&&!C)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const F=this._getSourceCaches(w);for(const q of F)q.setFeatureState(C,a.id,f)}removeFeatureState(a,f){this._checkLoaded();const w=a.source,C=this.getSource(w);if(!C)return void this.fire(new o.ErrorEvent(new Error(`The source '${w}' does not exist in the map's style.`)));const R=C.type,I=R==="vector"?a.sourceLayer:void 0;if(R==="vector"&&!I)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof a.id!="string"&&typeof a.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const F=this._getSourceCaches(w);for(const q of F)q.removeFeatureState(I,a.id,f)}getFeatureState(a){this._checkLoaded();const f=a.source,w=a.sourceLayer,C=this.getSource(f);if(C){if(C.type!=="vector"||w)return a.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(f)[0].getFeatureState(w,a.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const f in this._sourceCaches){const w=this._sourceCaches[f].getSource();a[w.id]||(a[w.id]=w.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0;const f=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&f&&f.getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",f.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const f=I=>this._layers[I].type==="fill-extrusion",w={},C=[];for(let I=this._order.length-1;I>=0;I--){const F=this._order[I];if(f(F)){w[F]=I;for(const q of a){const X=q[F];if(X)for(const J of X)C.push(J)}}}C.sort((I,F)=>F.intersectionZ-I.intersectionZ);const R=[];for(let I=this._order.length-1;I>=0;I--){const F=this._order[I];if(f(F))for(let q=C.length-1;q>=0;q--){const X=C[q].feature;if(w[X.layer.id]<I)break;R.push(X),C.pop()}else for(const q of a){const X=q[F];if(X)for(const J of X)R.push(J.feature)}}return R}queryRenderedFeatures(a,f,w){f&&f.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",f.filter,null,f);const C={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const q of f.layers){const X=this._layers[q];if(!X)return this.fire(new o.ErrorEvent(new Error(`The layer '${q}' does not exist in the map's style and cannot be queried for features.`))),[];C[X.source]=!0}}const R=[];f.availableImages=this._availableImages;const I=f&&f.layers?f.layers.some(q=>{const X=this.getLayer(q);return X&&X.is3D()}):this.has3DLayers(),F=Wt.createFromScreenPoints(a,w);for(const q in this._sourceCaches){const X=this._sourceCaches[q].getSource().id;f.layers&&!C[X]||R.push(ae(this._sourceCaches[q],this._layers,this._serializedLayers,F,f,w,I,!!this.map._showQueryGeometry))}return this.placement&&R.push(function(q,X,J,it,pt,gt,ft){const ut={},Ft=gt.queryRenderedSymbols(it),Et=[];for(const It of Object.keys(Ft).map(Number))Et.push(ft[It]);Et.sort(He);for(const It of Et){const Bt=It.featureIndex.lookupSymbolFeatures(Ft[It.bucketInstanceId],X,It.bucketIndex,It.sourceLayerIndex,pt.filter,pt.layers,pt.availableImages,q);for(const Ut in Bt){const Rt=ut[Ut]=ut[Ut]||[],Ht=Bt[Ut];Ht.sort((re,he)=>{const xe=It.featureSortOrder;if(xe){const ge=xe.indexOf(re.featureIndex);return xe.indexOf(he.featureIndex)-ge}return he.featureIndex-re.featureIndex});for(const re of Ht)Rt.push(re)}}for(const It in ut)ut[It].forEach(Bt=>{const Ut=Bt.feature,Rt=J(q[It]).getFeatureState(Ut.layer["source-layer"],Ut.id);Ut.source=Ut.layer.source,Ut.layer["source-layer"]&&(Ut.sourceLayer=Ut.layer["source-layer"]),Ut.state=Rt});return ut}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),F.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(R)}querySourceFeatures(a,f){f&&f.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",f.filter,null,f);const w=this._getSourceCaches(a);let C=[];for(const R of w)C=C.concat(we(R,f));return C}addSourceType(a,f,w){return Ar.getSourceType(a)?w(new Error(`A source type called "${a}" already exists.`)):(Ar.setSourceType(a,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:f.workerSourceURL},w):w(null,null))}getLight(){return this.light.getLight()}setLight(a,f={}){this._checkLoaded();const w=this.light.getLight();let C=!1;for(const I in a)if(!M(a[I],w[I])){C=!0;break}if(!C)return;const R={now:o.exported.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,f),this.light.updateTransitions(R)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,f=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(f===1){if(typeof a.source=="object"){const w="terrain-dem-src";this.addSource(w,a.source),a=o.clone$1(a),a=o.extend(a,{source:w})}if(this._validate(o.validateTerrain,"terrain",a))return}if(!this.terrain||this.terrain&&f!==this.terrain.drapeRenderMode)this._createTerrain(a,f);else{const w=this.terrain,C=w.get();for(const R in a)if(!M(a[R],C[R])){w.set(a),this.stylesheet.terrain=a;const I={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};w.updateTransitions(I);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const f=this.fog=new Lt(a,this.map.transform);this.stylesheet.fog=a;const w={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};f.updateTransitions(w)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog,w=f.get();for(const C in a)if(!M(a[C],w[C])){f.set(a),this.stylesheet.fog=a;const R={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};f.updateTransitions(R);break}}else this._createFog(a);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(w=>this.isLayerDraped(this._layers[w])),f=this._order.filter(w=>!this.isLayerDraped(this._layers[w]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...f)}_createTerrain(a,f){const w=this.terrain=new ce(a,f);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const C={now:o.exported.now(),transition:o.extend({duration:0},this.stylesheet.transition)};w.updateTransitions(C)}_force3DLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const f=this._layers[a];f.type==="symbol"&&this._updateLayer(f)}}_validate(a,f,w,C,R={}){return(!R||R.validate!==!1)&&Wl(this,a.call(o.validateStyle,o.extend({key:f,style:this.serialize(),value:w,styleSpec:o.spec},C)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const f=this._getSourceCaches(a);for(const w of f)w.clearTiles()}_reloadSource(a){const f=this._getSourceCaches(a);for(const w of f)w.resume(),w.reload()}_updateSources(a){for(const f in this._sourceCaches)this._sourceCaches[f].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const f=this._sourceCaches[a];f.resume(),f.reload()}}_updatePlacement(a,f,w,C,R=!1){let I=!1,F=!1;const q={};for(const X of this._order){const J=this._layers[X];if(J.type!=="symbol")continue;if(!q[J.source]){const pt=this._getLayerSourceCache(J);if(!pt)continue;q[J.source]=pt.getRenderableIds(!0).map(gt=>pt.getTileByID(gt)).sort((gt,ft)=>ft.tileID.overscaledZ-gt.tileID.overscaledZ||(gt.tileID.isLessThan(ft.tileID)?-1:1))}const it=this.crossTileSymbolIndex.addLayer(J,q[J.source],a.center.lng,a.projection);I=I||it}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),R=R||this._layerOrderChanged||w===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),a.zoom))&&(this.pauseablePlacement=new R1(a,this._order,R,f,w,C,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),F=!0),I&&this.pauseablePlacement.placement.setStale()),F||I)for(const X of this._order){const J=this._layers[X];J.type==="symbol"&&this.placement.updateLayerOpacities(J,q[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,f,w){this.imageManager.getImages(f.icons,w),this._updateTilesForChangedImages();const C=R=>{R&&R.setDependencies(f.tileID.key,f.type,f.icons)};C(this._otherSourceCaches[f.source]),C(this._symbolSourceCaches[f.source])}getGlyphs(a,f,w){this.glyphManager.getGlyphs(f.stacks,w)}getResource(a,f,w){return o.makeRequest(f,w)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return a.type==="symbol"?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const f=[];return this._otherSourceCaches[a]&&f.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&f.push(this._symbolSourceCaches[a]),f}_isSourceCacheLoaded(a){const f=this._getSourceCaches(a);return f.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):f.every(w=>w.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ar.getSourceType=function(v){return ne[v]},Ar.setSourceType=function(v,a){ne[v]=a},Ar.registerForPluginStateChange=o.registerForPluginStateChange;var ql=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,Yl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let na={},_s={};na=bn("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),_s=bn(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const Wu=bn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Xl=ql;var Kl={background:bn(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:bn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:bn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:bn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:bn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:bn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:bn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:bn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:bn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:bn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:bn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:bn(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:bn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:bn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:bn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:bn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:bn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:bn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:bn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:bn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:bn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:bn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:bn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yl),skyboxGradient:bn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Yl),skyboxCapture:bn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bn(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:bn(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function bn(v,a,f){const w=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,C=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,R=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I=v.match(C),F=a.match(C),q=ql.match(C);let X=F?F.concat(I):I;f||(na.staticUniforms&&(X=na.staticUniforms.concat(X)),_s.staticUniforms&&(X=_s.staticUniforms.concat(X))),X&&(X=X.concat(q));const J={};return{fragmentSource:v=v.replace(w,(it,pt,gt,ft,ut)=>(J[ut]=!0,pt==="define"?`
#ifndef HAS_UNIFORM_u_${ut}
varying ${gt} ${ft} ${ut};
#else
uniform ${gt} ${ft} u_${ut};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ut}
    ${gt} ${ft} ${ut} = u_${ut};
#endif
`)),vertexSource:a=a.replace(w,(it,pt,gt,ft,ut)=>{const Ft=ft==="float"?"vec2":"vec4",Et=ut.match(/color/)?"color":Ft;return J[ut]?pt==="define"?`
#ifndef HAS_UNIFORM_u_${ut}
uniform lowp float u_${ut}_t;
attribute ${gt} ${Ft} a_${ut};
varying ${gt} ${ft} ${ut};
#else
uniform ${gt} ${ft} u_${ut};
#endif
`:Et==="vec4"?`
#ifndef HAS_UNIFORM_u_${ut}
    ${ut} = a_${ut};
#else
    ${gt} ${ft} ${ut} = u_${ut};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ut}
    ${ut} = unpack_mix_${Et}(a_${ut}, u_${ut}_t);
#else
    ${gt} ${ft} ${ut} = u_${ut};
#endif
`:pt==="define"?`
#ifndef HAS_UNIFORM_u_${ut}
uniform lowp float u_${ut}_t;
attribute ${gt} ${Ft} a_${ut};
#else
uniform ${gt} ${ft} u_${ut};
#endif
`:Et==="vec4"?`
#ifndef HAS_UNIFORM_u_${ut}
    ${gt} ${ft} ${ut} = a_${ut};
#else
    ${gt} ${ft} ${ut} = u_${ut};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ut}
    ${gt} ${ft} ${ut} = unpack_mix_${Et}(a_${ut}, u_${ut}_t);
#else
    ${gt} ${ft} ${ut} = u_${ut};
#endif
`}),staticAttributes:R,staticUniforms:X}}class qu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,f,w,C,R,I,F,q){this.context=a;let X=this.boundPaintVertexBuffers.length!==C.length;for(let J=0;!X&&J<C.length;J++)this.boundPaintVertexBuffers[J]!==C[J]&&(X=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===w&&!X&&this.boundIndexBuffer===R&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===F&&this.boundDynamicVertexBuffer2===q?(a.bindVertexArrayOES.set(this.vao),F&&F.bind(),R&&R.dynamicDraw&&R.bind(),q&&q.bind()):this.freshBind(f,w,C,R,I,F,q)}freshBind(a,f,w,C,R,I,F){let q;const X=a.numAttributes,J=this.context,it=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),q=0,this.boundProgram=a,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=w,this.boundIndexBuffer=C,this.boundVertexOffset=R,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=F;else{q=J.currentNumAttributes||0;for(let pt=X;pt<q;pt++)it.disableVertexAttribArray(pt)}f.enableAttributes(it,a);for(const pt of w)pt.enableAttributes(it,a);I&&I.enableAttributes(it,a),F&&F.enableAttributes(it,a),f.bind(),f.setVertexAttribPointers(it,a,R);for(const pt of w)pt.bind(),pt.setVertexAttribPointers(it,a,R);I&&(I.bind(),I.setVertexAttribPointers(it,a,R)),C&&C.bind(),F&&(F.bind(),F.setVertexAttribPointers(it,a,R)),J.currentNumAttributes=X}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Wg(v,a){const f=Math.pow(2,a.canonical.z),w=a.canonical.y;return[new o.MercatorCoordinate(0,w/f).toLngLat().lat,new o.MercatorCoordinate(0,(w+1)/f).toLngLat().lat]}function qg(v,a,f,w,C,R,I){const F=v.context,q=F.gl,X=f.fbo;if(!X)return;v.prepareDrawTile();const J=v.useProgram("hillshade");F.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,X.colorAttachment.get());const it=((ut,Ft,Et,It)=>{const Bt=Et.paint.get("hillshade-shadow-color"),Ut=Et.paint.get("hillshade-highlight-color"),Rt=Et.paint.get("hillshade-accent-color");let Ht=Et.paint.get("hillshade-illumination-direction")*(Math.PI/180);Et.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ht-=ut.transform.angle);const re=!ut.options.moving;return{u_matrix:It||ut.transform.calculateProjMatrix(Ft.tileID.toUnwrapped(),re),u_image:0,u_latrange:Wg(0,Ft.tileID),u_light:[Et.paint.get("hillshade-exaggeration"),Ht],u_shadow:Bt,u_highlight:Ut,u_accent:Rt}})(v,f,w,v.terrain?a.projMatrix:null);v.prepareDrawProgram(F,J,a.toUnwrapped());const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:gt,tileBoundsSegments:ft}=v.getTileBoundsBuffers(f);J.draw(F,q.TRIANGLES,C,R,I,o.CullFaceMode.disabled,it,w.id,pt,gt,ft)}function yp(v,a,f){if(!a.needsDEMTextureUpload)return;const w=v.context,C=w.gl;w.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||v.getTileTexture(f.stride);const R=f.getPixels();a.demTexture?a.demTexture.update(R,{premultiply:!1}):a.demTexture=new o.Texture(w,R,C.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function xp(v,a,f,w,C,R){const I=v.context,F=I.gl;if(!a.dem)return;const q=a.dem;if(I.activeTexture.set(F.TEXTURE1),yp(v,a,q),!a.demTexture)return;a.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);const X=q.dim;I.activeTexture.set(F.TEXTURE0);let J=a.fbo;if(!J){const ft=new o.Texture(I,{width:X,height:X,data:null},F.RGBA);ft.bind(F.LINEAR,F.CLAMP_TO_EDGE),J=a.fbo=I.createFramebuffer(X,X,!0),J.colorAttachment.set(ft.texture)}I.bindFramebuffer.set(J.framebuffer),I.viewport.set([0,0,X,X]);const{tileBoundsBuffer:it,tileBoundsIndexBuffer:pt,tileBoundsSegments:gt}=v.getMercatorTileBoundsBuffers();v.useProgram("hillshadePrepare").draw(I,F.TRIANGLES,w,C,R,o.CullFaceMode.disabled,((ft,ut)=>{const Ft=ut.stride,Et=o.create();return o.ortho(Et,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Et,Et,[0,-o.EXTENT,0]),{u_matrix:Et,u_image:1,u_dimension:[Ft,Ft],u_zoom:ft.overscaledZ,u_unpack:ut.unpackVector}})(a.tileID,q),f.id,it,pt,gt),a.needsHillshadePrepare=!1}const vp=(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_image0:new o.Uniform1i(v,a.u_image0),u_skirt_height:new o.Uniform1f(v,a.u_skirt_height)}),Yg=(v,a)=>({u_matrix:v,u_image0:0,u_skirt_height:a}),Xg=(v,a,f,w,C,R)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:a,u_merc_matrix:f,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_grid_matrix:R?Float32Array.from(R):new Float32Array(9)});function Yu(v,a){return v!=null&&a!=null&&!(!v.hasData()||!a.hasData())&&v.demTexture!=null&&a.demTexture!=null&&v.tileID.key!==a.tileID.key}const bs=new class{constructor(){this.operations={}}newMorphing(v,a,f,w,C){if(v in this.operations){const R=this.operations[v];R.to.tileID.key!==f.tileID.key&&(R.queued=f)}else this.operations[v]={startTime:w,phase:0,duration:C,from:a,to:f,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const a=this.operations[v];return{from:a.from,to:a.to,phase:a.phase}}update(v){for(const a in this.operations){const f=this.operations[a];for(f.phase=(v-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,v)){delete this.operations[a];break}}}_nextOp(v,a){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=a,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Wa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function _p(v,a){const f=1<<v.z;return!a&&(v.x===0||v.x===f-1)||v.y===0||v.y===f-1}const Xu=v=>({u_matrix:v});function bp(v,a,f,w,C){if(C>0){const R=o.exported.now(),I=(R-v.timeAdded)/C,F=a?(R-a.timeAdded)/C:-1,q=f.getSource(),X=w.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),J=!a||Math.abs(a.tileID.overscaledZ-X)>Math.abs(v.tileID.overscaledZ-X),it=J&&v.refreshedUponExpiration?1:o.clamp(J?I:1-F,0,1);return v.refreshedUponExpiration&&I>=1&&(v.refreshedUponExpiration=!1),a?{opacity:1,mix:1-it}:{opacity:it,mix:0}}return{opacity:1,mix:0}}const k1=2*o.mercatorZfromAltitude(1,0)*o.GLOBE_RADIUS*Math.PI;class Zl extends o.SourceCache{constructor(a){const f={type:"raster-dem",maxzoom:a.transform.maxZoom},w=new bt(Vt(),null),C=ie("mock-dem",f,w,a.style);super("mock-dem",C,!1),C.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,f){a.state="loaded",f(null)}}class Jl extends o.SourceCache{constructor(a){const f=ie("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new bt(Vt(),null),a.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,f,w){if(a.freezeTileCoverage)return;this.transform=a;const C=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((R,I)=>{if(R[I.key]="",!this._tiles[I.key]){const F=new o.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);F.state="loaded",this._tiles[I.key]=F}return R},{});for(const R in this._tiles)R in C||(this.freeFBO(R),this._tiles[R].unloadVectorData(),delete this._tiles[R])}freeFBO(a){const f=this.proxyCachedFBO[a];if(f!==void 0){const w=Object.values(f);this.renderCachePool.push(...w),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Mp extends o.OverscaledTileID{constructor(a,f,w){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=f,this.projMatrix=w}}class zr extends o.Elevation{constructor(a,f){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[w,C,R]=function(q){const X=new o.StructArrayLayout4i8,J=new o.StructArrayLayout3ui6,it=131;X.reserve(17161),J.reserve(33800);const pt=o.EXTENT/128,gt=o.EXTENT+pt/2,ft=gt+pt;for(let Ft=-pt;Ft<ft;Ft+=pt)for(let Et=-pt;Et<ft;Et+=pt){const It=Et<0||Et>gt||Ft<0||Ft>gt?24575:0,Bt=o.clamp(Math.round(Et),0,o.EXTENT),Ut=o.clamp(Math.round(Ft),0,o.EXTENT);X.emplaceBack(Bt+It,Ut,Bt,Ut)}const ut=(Ft,Et)=>{const It=Et*it+Ft;J.emplaceBack(It+1,It,It+it),J.emplaceBack(It+it,It+it+1,It+1)};for(let Ft=1;Ft<129;Ft++)for(let Et=1;Et<129;Et++)ut(Et,Ft);return[0,129].forEach(Ft=>{for(let Et=0;Et<130;Et++)ut(Et,Ft),ut(Ft,Et)}),[X,J,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(w,o.boundsAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(C),this.gridSegments=o.SegmentVector.simpleSegment(0,0,w.length,C.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,w.length,R),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Jl(f.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);const F=I.gl;this._overlapStencilMode=new o.StencilMode({func:F.GEQUAL,mask:255},0,255,F.KEEP,F.KEEP,F.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zl(f.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency()}update(a,f,w){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const C=a.terrain.properties;this.sourceCache=a.terrain.drapeRenderMode===0?this._mockSourceCache:a._getSourceCache(C.get("source")),this._exaggeration=C.get("exaggeration");const R=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(f,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),f.updateElevation(!w),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||a.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&a.dataType==="source"?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):a.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,w=this.painter.transform;this._initializing&&(this._initializing=w._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(w.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const C=this.proxyCoords=f.getIds().map(q=>{const X=f.getTileByID(q).tileID;return X.projMatrix=w.calculateProjMatrix(X.toUnwrapped()),X});(function(q,X){const J=X.transform.pointCoordinate(X.transform.getCameraPoint()),it=new o.pointGeometry(J.x,J.y);q.sort((pt,gt)=>{if(gt.overscaledZ-pt.overscaledZ)return gt.overscaledZ-pt.overscaledZ;const ft=new o.pointGeometry(pt.canonical.x+(1<<pt.canonical.z)*pt.wrap,pt.canonical.y),ut=new o.pointGeometry(gt.canonical.x+(1<<gt.canonical.z)*gt.wrap,gt.canonical.y),Ft=it.mult(1<<pt.canonical.z);return Ft.x-=.5,Ft.y-=.5,Ft.distSqr(ft)-Ft.distSqr(ut)})})(C,this.painter),this._previousZoom=w.zoom;const R=this.proxyToSource||{};this.proxyToSource={},C.forEach(q=>{this.proxyToSource[q.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const q in I){const X=I[q];if(!X.used||(X!==this.sourceCache&&this.resetTileLookupCache(X.id),this._setupProxiedCoordsForOrtho(X,a[q],R),X.usedForTerrain))continue;const J=a[q];X.getSource().reparseOverscaled&&this._assignTerrainTiles(J)}this.proxiedCoords[f.id]=C.map(q=>new Mp(q,q.key,this.orthoMatrix)),this._assignTerrainTiles(C),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(R),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const F={};this._visibleDemTiles=[];for(const q of this.proxyCoords){const X=this.terrainTileForTile[q.key];if(!X)continue;const J=X.tileID.key;J in F||(this._visibleDemTiles.push(X),F[J]=J)}}_assignTerrainTiles(a){this._initializing||a.forEach(f=>{if(this.terrainTileForTile[f.key])return;const w=this._findTileCoveringTileID(f,this.sourceCache);w&&(this.terrainTileForTile[f.key]=w)})}_prepareDEMTextures(){const a=this.painter.context,f=a.gl;for(const w in this.terrainTileForTile){const C=this.terrainTileForTile[w],R=C.dem;!R||C.demTexture&&!C.needsDEMTextureUpload||(a.activeTexture.set(f.TEXTURE1),yp(this.painter,C,R))}}_prepareDemTileUniforms(a,f,w,C){if(!f||f.demTexture==null)return!1;const R=a.tileID.canonical,I=Math.pow(2,f.tileID.canonical.z-R.z),F=C||"";return w[`u_dem_tl${F}`]=[R.x*I%1,R.y*I%1],w[`u_dem_scale${F}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,f=a.gl;if(!this._emptyDepthBufferTexture){const w=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(a,w,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const f=this._visibleDemTiles.reduce((w,C)=>{if(!C.dem)return w;const R=C.dem.tree.minimums[0];return R>0&&a++,w+R},0);return a?f/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,f=a.gl;a.activeTexture.set(f.TEXTURE2);const w=this._getLoadedAreaMinimum(),C=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(w,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let R=this._emptyDEMTexture;return R?R.update(C,{premultiply:!1}):R=this._emptyDEMTexture=new o.Texture(a,C,f.RGBA,{premultiply:!1}),R}setupElevationDraw(a,f,w){const C=this.painter.context,R=C.gl,I=(F=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(F),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var F;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();const q=this.painter.transform,X=q.projection,J=a.tileID.canonical;I.u_tile_tl_up=X.upVector(J,0,0),I.u_tile_tr_up=X.upVector(J,o.EXTENT,0),I.u_tile_br_up=X.upVector(J,o.EXTENT,o.EXTENT),I.u_tile_bl_up=X.upVector(J,0,o.EXTENT),I.u_tile_up_scale=w&&w.useDenormalizedUpVectorScale?k1:X.upVectorScale(J,q.center.lat,q.worldSize).metersToTile;let it=null,pt=null,gt=1;if(w&&w.morphing&&this._useVertexMorphing){const ft=w.morphing.srcDemTile,ut=w.morphing.dstDemTile;gt=w.morphing.phase,ft&&ut&&(this._prepareDemTileUniforms(a,ft,I,"_prev")&&(pt=ft),this._prepareDemTileUniforms(a,ut,I)&&(it=ut))}if(pt&&it?(C.activeTexture.set(R.TEXTURE2),it.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE,R.NEAREST),C.activeTexture.set(R.TEXTURE4),pt.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE,R.NEAREST),I.u_dem_lerp=gt):(it=this.terrainTileForTile[a.tileID.key],C.activeTexture.set(R.TEXTURE2),(this._prepareDemTileUniforms(a,it,I)?it.demTexture:this.emptyDEMTexture).bind(R.NEAREST,R.CLAMP_TO_EDGE)),C.activeTexture.set(R.TEXTURE3),w&&w.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),w&&w.useMeterToDem&&it){const ft=(1<<it.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=ft}w&&w.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=w.labelPlaneMatrixInv),f.setTerrainUniformValues(C,I)}renderToBackBuffer(a){const f=this.painter,w=this.painter.context;a.length!==0&&(w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height]),this.renderingToTexture=!1,function(C,R,I,F,q){if(C.transform.projection.name==="globe")(function(X,J,it,pt,gt){const ft=X.context,ut=ft.gl;let Ft,Et;const It=X.options.showTerrainWireframe?2:0,Bt=(ge,ze)=>{if(Et===ge)return;const oe=[Wa[ge],"PROJECTION_GLOBE_VIEW"];ze&&oe.push(Wa[It]),Ft=X.useProgram("globeRaster",null,oe),Et=ge},Ut=X.colorModeForRenderPass(),Rt=new o.DepthMode(ut.LEQUAL,o.DepthMode.ReadWrite,X.depthRangeFor3D);bs.update(gt);const Ht=X.transform,re=o.calculateGlobeMercatorMatrix(Ht),he=[o.mercatorXfromLng(Ht.center.lng),o.mercatorYfromLat(Ht.center.lat)],xe=X.globeSharedBuffers;if((It?[!1,!0]:[!1]).forEach(ge=>{Et=-1;const ze=ge?ut.LINES:ut.TRIANGLES;for(const oe of pt){const Ne=it.getTile(oe),Ie=o.StencilMode.disabled,en=J.prevTerrainTileForTile[oe.key],ve=J.terrainTileForTile[oe.key];Yu(en,ve)&&bs.newMorphing(oe.key,en,ve,gt,250),ft.activeTexture.set(ut.TEXTURE0),Ne.texture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE);const Ze=bs.getMorphValuesForProxy(oe.key),_n=Ze?1:0,Qe={useDenormalizedUpVectorScale:!0};Ze&&o.extend$1(Qe,{morphing:{srcDemTile:Ze.from,dstDemTile:Ze.to,phase:o.easeCubicInOut(Ze.phase)}});const $e=Float32Array.from(Ht.globeMatrix),An=o.globeTileLatLngCorners(oe.canonical),Un=o.getGridMatrix(oe.canonical,An),gn=Xg(Ht.projMatrix,$e,re,o.globeToMercatorTransition(Ht.zoom),he,Un);if(Bt(_n,ge),J.setupElevationDraw(Ne,Ft,Qe),X.prepareDrawProgram(ft,Ft,oe.toUnwrapped()),xe){const[Pn,Zn,Ei]=ge?xe.getWirefameBuffers(X.context):xe.getGridBuffers();Ft.draw(ft,ze,Rt,Ie,Ut,o.CullFaceMode.backCCW,gn,"globe_raster",Pn,Zn,Ei)}}}),xe){Ft=X.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const ge of pt){const{x:ze,y:oe,z:Ne}=ge.canonical,Ie=oe===0,en=oe===(1<<Ne)-1,[ve,Ze,_n,Qe]=xe.getPoleBuffers(Ne);if(Qe&&(Ie||en)){const $e=it.getTile(ge);ft.activeTexture.set(ut.TEXTURE0),$e.texture.bind(ut.LINEAR,ut.CLAMP_TO_EDGE);let An=o.globePoleMatrixForTile(Ne,ze,Ht);const Un=(gn,Pn)=>gn.draw(ft,ut.TRIANGLES,Rt,o.StencilMode.disabled,Ut,o.CullFaceMode.disabled,Xg(Ht.projMatrix,An,An,0,he),"globe_pole_raster",Pn,_n,Qe);J.setupElevationDraw($e,Ft,{}),X.prepareDrawProgram(ft,Ft,ge.toUnwrapped()),Ie&&Un(Ft,ve),en&&(An=o.scale(o.create(),An,[1,-1,1]),Un(Ft,Ze))}}}})(C,R,I,F,q);else{const X=C.context,J=X.gl;let it,pt;const gt=C.options.showTerrainWireframe?2:0,ft=(Bt,Ut)=>{if(pt===Bt)return;const Rt=[Wa[Bt]];Ut&&Rt.push(Wa[gt]),it=C.useProgram("terrainRaster",null,Rt),pt=Bt},ut=C.colorModeForRenderPass(),Ft=new o.DepthMode(J.LEQUAL,o.DepthMode.ReadWrite,C.depthRangeFor3D);bs.update(q);const Et=C.transform,It=6*Math.pow(1.5,22-Et.zoom)*R.exaggeration();(gt?[!1,!0]:[!1]).forEach(Bt=>{pt=-1;const Ut=Bt?J.LINES:J.TRIANGLES,[Rt,Ht]=Bt?R.getWirefameBuffer():[R.gridIndexBuffer,R.gridSegments];for(const re of F){const he=I.getTile(re),xe=o.StencilMode.disabled,ge=R.prevTerrainTileForTile[re.key],ze=R.terrainTileForTile[re.key];Yu(ge,ze)&&bs.newMorphing(re.key,ge,ze,q,250),X.activeTexture.set(J.TEXTURE0),he.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST);const oe=bs.getMorphValuesForProxy(re.key),Ne=oe?1:0;let Ie;oe&&(Ie={morphing:{srcDemTile:oe.from,dstDemTile:oe.to,phase:o.easeCubicInOut(oe.phase)}});const en=Yg(re.projMatrix,_p(re.canonical,Et.renderWorldCopies)?It/10:It);ft(Ne,Bt),R.setupElevationDraw(he,it,Ie),C.prepareDrawProgram(X,it,re.toUnwrapped()),it.draw(X,Ut,Ft,xe,ut,o.CullFaceMode.backCCW,en,"terrain_raster",R.gridBuffer,Rt,Ht)}})}}(f,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,a.splice(0,a.length))}renderBatch(a){if(this._drapedRenderBatches.length===0)return a+1;this.renderingToTexture=!0;const f=this.painter,w=this.painter.context,C=this.proxySourceCache,R=this.proxiedCoords[C.id],I=this._drapedRenderBatches.shift(),F=[],q=f.style.order;let X=0;for(const J of R){const it=C.getTileByID(J.proxyTileKey),pt=C.proxyCachedFBO[J.key]?C.proxyCachedFBO[J.key][a]:void 0,gt=pt!==void 0?C.renderCache[pt]:this.pool[X++],ft=pt!==void 0;if(it.texture=gt.tex,ft&&!gt.dirty){F.push(it.tileID);continue}let ut;w.bindFramebuffer.set(gt.fb.framebuffer),this.renderedToTile=!1,gt.dirty&&(w.clear({color:o.Color.transparent,stencil:0}),gt.dirty=!1);for(let Ft=I.start;Ft<=I.end;++Ft){const Et=f.style._layers[q[Ft]];if(Et.isHidden(f.transform.zoom))continue;const It=f.style._getLayerSourceCache(Et),Bt=It?this.proxyToSource[J.key][It.id]:[J];if(!Bt)continue;const Ut=Bt;w.viewport.set([0,0,gt.fb.width,gt.fb.height]),ut!==(It?It.id:null)&&(this._setupStencil(gt,Bt,Et,It),ut=It?It.id:null),f.renderLayer(f,It,Et,Ut)}this.renderedToTile?(gt.dirty=!0,F.push(it.tileID)):ft||--X,X===5&&(X=0,this.renderToBackBuffer(F))}return this.renderToBackBuffer(F),this.renderingToTexture=!1,w.bindFramebuffer.set(null),w.viewport.set([0,0,f.width,f.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const f=a.order.length;if(f===0)return{efficiency:100};let w,C=0,R=0,I=!1;for(let F=0;F<f;++F){const q=a._layers[a.order[F]];this._style.isLayerDraped(q)?(I&&++C,++R):I||(I=!0,w=q.id)}return R===0?{efficiency:100}:{efficiency:100*(1-C/R),firstUndrapedLayer:w}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{a=Math.min(a,f.dem.tree.minimums[0])}),a===0?a:(a-30)*this._exaggeration}raycast(a,f,w){if(!this._visibleDemTiles)return null;const C=this._visibleDemTiles.filter(R=>R.dem).map(R=>{const I=R.tileID,F=Math.pow(2,I.overscaledZ),{x:q,y:X}=I.canonical,J=q/F,it=(q+1)/F,pt=X/F,gt=(X+1)/F;return{minx:J,miny:pt,maxx:it,maxy:gt,t:R.dem.tree.raycastRoot(J,pt,it,gt,a,f,w),tile:R}});C.sort((R,I)=>(R.t!==null?R.t:Number.MAX_VALUE)-(I.t!==null?I.t:Number.MAX_VALUE));for(const R of C){if(R.t==null)return null;const I=R.tile.dem.tree.raycast(R.minx,R.miny,R.maxx,R.maxy,a,f,w);if(I!=null)return I}return null}_createFBO(){const a=this.painter.context,f=a.gl,w=this.drapeBufferSize;a.activeTexture.set(f.TEXTURE0);const C=new o.Texture(a,{width:w[0],height:w[1],data:null},f.RGBA);C.bind(f.LINEAR,f.CLAMP_TO_EDGE);const R=a.createFramebuffer(w[0],w[1],!1);return R.colorAttachment.set(C.texture),R.depthAttachment=new Ir(a,R.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,w[0],w[1]),this._stencilRef=0,R.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):R.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&f.texParameterf(f.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:R,tex:C,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const f=this._style._layers[a],w=f.isHidden(this.painter.transform.zoom),C=f.getCrossfadeParameters(),R=!!C&&C.t!==1,I=f.hasTransition();return f.type!=="custom"&&!w&&(R||I)})}_clearRasterFadeFromRenderCache(){let a=!1;for(const f in this._style._sourceCaches)if(this._style._sourceCaches[f]._source instanceof lt){a=!0;break}if(a)for(let f=0;f<this._style.order.length;++f){const w=this._style._layers[this._style.order[f]],C=w.isHidden(this.painter.transform.zoom),R=this._style._getLayerSourceCache(w);if(w.type!=="raster"||C||!R)continue;const I=w.paint.get("raster-fade-duration");for(const F of this.proxyCoords){const q=this.proxyToSource[F.key][R.id];if(q)for(const X of q){const J=bp(R.getTile(X),R.findLoadedParent(X,0),R,this.painter.transform,I);(J.opacity!==1||J.mix!==0)&&this._clearRenderCacheForTile(R.id,X)}}}}_setupDrapedRenderBatches(){const a=this._style.order,f=a.length;if(f===0)return;const w=[];let C,R=0,I=this._style._layers[a[R]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++R<f;)I=this._style._layers[a[R]];for(;R<f;++R){const F=this._style._layers[a[R]];F.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(F)?C===void 0&&(C=R):C!==void 0&&(w.push({start:C,end:R-1}),C=void 0))}C!==void 0&&w.push({start:C,end:R-1}),this._drapedRenderBatches=w}_setupRenderCache(a){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const I=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let F=0;F<I.length;++F){const q=Object.values(I[F]);f.renderCachePool.push(...q)}}return}this._clearRasterFadeFromRenderCache();const w=this.proxyCoords,C=this._tilesDirty;for(let I=w.length-1;I>=0;I--){const F=w[I];if(f.getTileByID(F.key),f.proxyCachedFBO[F.key]!==void 0){const q=a[F.key],X=this.proxyToSource[F.key];let J=0;for(const it in X){const pt=X[it],gt=q[it];if(!gt||gt.length!==pt.length||pt.some((ft,ut)=>ft!==gt[ut]||C[it]&&C[it].hasOwnProperty(ft.key))){J=-1;break}++J}for(const it in f.proxyCachedFBO[F.key])f.renderCache[f.proxyCachedFBO[F.key][it]].dirty=J<0||J!==Object.values(q).length}}const R=[...this._drapedRenderBatches];R.sort((I,F)=>F.end-F.start-(I.end-I.start));for(const I of R)for(const F of w){if(f.proxyCachedFBO[F.key])continue;let q=f.renderCachePool.pop();q===void 0&&f.renderCache.length<50&&(q=f.renderCache.length,f.renderCache.push(this._createFBO())),q!==void 0&&(f.proxyCachedFBO[F.key]={},f.proxyCachedFBO[F.key][I.start]=q,f.renderCache[q].dirty=!0)}this._tilesDirty={}}_setupStencil(a,f,w,C){if(!C||!this._sourceTilesOverlap[C.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const R=this.painter.context,I=R.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let F;if(w.isTileClipped())F=f.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);F=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+F>255&&(R.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=F,this._overlapStencilMode.ref=this._stencilRef,w.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(a.key)||0),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(a,f){const w=this.painter,C=this.painter.context,R=C.gl;w._tileClippingMaskIDs.clear(),C.setColorMode(o.ColorMode.disabled),C.setDepthMode(o.DepthMode.disabled);const I=w.useProgram("clippingMask");for(const F of a){const q=--f;w._tileClippingMaskIDs.set(F.key,q),I.draw(C,R.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:R.ALWAYS,mask:0},q,255,R.KEEP,R.KEEP,R.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Xu(F.projMatrix),"$clipping",w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}}pointCoordinate(a){const f=this.painter.transform;if(a.x<0||a.x>f.width||a.y<0||a.y>f.height)return null;const w=[a.x,a.y,1,1];o.transformMat4$1(w,w,f.pixelMatrixInverse),o.scale$1(w,w,1/w[3]),w[0]/=f.worldSize,w[1]/=f.worldSize;const C=f._camera.position,R=o.mercatorZfromAltitude(1,f.center.lat),I=[C[0],C[1],C[2]/R,0],F=o.subtract([],w.slice(0,3),I);o.normalize(F,F);const q=this.raycast(I,F,this._exaggeration);return q!==null&&q?(o.scaleAndAdd(I,I,F,q),I[3]=I[2],I[2]*=R,I):null}drawDepth(){const a=this.painter,f=a.context,w=this.proxySourceCache,C=Math.ceil(a.width),R=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===C&&this._depthFBO.height===R||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=f.gl,F=f.createFramebuffer(C,R,!0);f.activeTexture.set(I.TEXTURE0);const q=new o.Texture(f,{width:C,height:R,data:null},I.RGBA);q.bind(I.NEAREST,I.CLAMP_TO_EDGE),F.colorAttachment.set(q.texture);const X=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,C,R);F.depthAttachment.set(X),this._depthFBO=F,this._depthTexture=q}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,C,R]),function(I,F,q,X){if(I.transform.projection.name==="globe")return;const J=I.context,it=J.gl;J.clear({depth:1});const pt=I.useProgram("terrainDepth"),gt=new o.DepthMode(it.LESS,o.DepthMode.ReadWrite,I.depthRangeFor3D);for(const ft of X){const ut=q.getTile(ft),Ft=Yg(ft.projMatrix,0);F.setupElevationDraw(ut,pt),pt.draw(J,it.TRIANGLES,gt,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,Ft,"terrain_depth",F.gridBuffer,F.gridIndexBuffer,F.gridNoSkirtSegments)}}(a,this,w,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,f,w){if(a.getSource()instanceof Yt)return this._setupProxiedCoordsForImageSource(a,f,w);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const C=this.proxiedCoords[a.id]=[],R=this.proxyCoords;for(let F=0;F<R.length;F++){const q=R[F],X=this._findTileCoveringTileID(q,a);if(X){const J=this._createProxiedId(q,X,w[q.key]&&w[q.key][a.id]);C.push(J),this.proxyToSource[q.key][a.id]=[J]}}let I=!1;for(let F=0;F<f.length;F++){const q=a.getTile(f[F]);if(!q||!q.hasData())continue;const X=this._findTileCoveringTileID(q.tileID,this.proxySourceCache);if(X&&X.tileID.canonical.z!==q.tileID.canonical.z){const J=this.proxyToSource[X.tileID.key][a.id],it=this._createProxiedId(X.tileID,q,w[X.tileID.key]&&w[X.tileID.key][a.id]);J?J.splice(J.length-1,0,it):this.proxyToSource[X.tileID.key][a.id]=[it],C.push(it),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,f,w){if(!a.getSource().loaded())return;const C=this.proxiedCoords[a.id]=[],R=this.proxyCoords,I=a.getSource(),F=new o.pointGeometry(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),q=I.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((J,it)=>(J.min.x=Math.min(J.min.x,it.x-F.x),J.min.y=Math.min(J.min.y,it.y-F.y),J.max.x=Math.max(J.max.x,it.x-F.x),J.max.y=Math.max(J.max.y,it.y-F.y),J),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),X=(J,it)=>{const pt=J.wrap+J.canonical.x/(1<<J.canonical.z),gt=J.canonical.y/(1<<J.canonical.z),ft=o.EXTENT/(1<<J.canonical.z),ut=it.wrap+it.canonical.x/(1<<it.canonical.z),Ft=it.canonical.y/(1<<it.canonical.z);return pt+ft<ut+q.min.x||pt>ut+q.max.x||gt+ft<Ft+q.min.y||gt>Ft+q.max.y};for(let J=0;J<R.length;J++){const it=R[J];for(let pt=0;pt<f.length;pt++){const gt=a.getTile(f[pt]);if(!gt||!gt.hasData()||X(it,gt.tileID))continue;const ft=this._createProxiedId(it,gt,w[it.key]&&w[it.key][a.id]),ut=this.proxyToSource[it.key][a.id];ut?ut.push(ft):this.proxyToSource[it.key][a.id]=[ft],C.push(ft)}}}_createProxiedId(a,f,w){let C=this.orthoMatrix;if(w){const R=w.find(I=>I.key===f.tileID.key);if(R)return R}if(f.tileID.key!==a.key){const R=a.canonical.z-f.tileID.canonical.z;let I,F,q;C=o.create();const X=f.tileID.wrap-a.wrap<<a.overscaledZ;R>0?(I=o.EXTENT>>R,F=I*((f.tileID.canonical.x<<R)-a.canonical.x+X),q=I*((f.tileID.canonical.y<<R)-a.canonical.y)):(I=o.EXTENT<<-R,F=o.EXTENT*(f.tileID.canonical.x-(a.canonical.x+X<<-R)),q=o.EXTENT*(f.tileID.canonical.y-(a.canonical.y<<-R))),o.ortho(C,0,I,0,I,0,1),o.translate(C,C,[F,q,0])}return new Mp(f.tileID,a.key,C)}_findTileCoveringTileID(a,f){let w=f.getTile(a);if(w&&w.hasData())return w;const C=this._findCoveringTileCache[f.id],R=C[a.key];if(w=R?f.getTileByID(R):null,w&&w.hasData()||R===null)return w;let I=w?w.tileID:a,F=I.overscaledZ;const q=f.getSource().minzoom,X=[];if(!R){const it=f.getSource().maxzoom;if(a.canonical.z>=it){const pt=a.canonical.z-it;f.getSource().reparseOverscaled?(F=Math.max(a.canonical.z+2,f.transform.tileZoom),I=new o.OverscaledTileID(F,a.wrap,it,a.canonical.x>>pt,a.canonical.y>>pt)):pt!==0&&(F=it,I=new o.OverscaledTileID(F,a.wrap,it,a.canonical.x>>pt,a.canonical.y>>pt))}I.key!==a.key&&(X.push(I.key),w=f.getTile(I))}const J=it=>{X.forEach(pt=>{C[pt]=it}),X.length=0};for(F-=1;F>=q&&(!w||!w.hasData());F--){w&&J(w.tileID.key);const it=I.calculateScaledKey(F);if(w=f.getTileByID(it),w&&w.hasData())break;const pt=C[it];if(pt===null)break;pt===void 0?X.push(it):w=f.getTileByID(pt)}return J(w?w.tileID.key:null),w&&w.hasData()?w:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,f){let w=this._tilesDirty[a];w||(w=this._tilesDirty[a]={}),w[f.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(f){let w=0;const C=new o.StructArrayLayout2ui4,R=131;for(let I=1;I<129;I++){for(let F=1;F<129;F++)w=I*R+F,C.emplaceBack(w,w+1),C.emplaceBack(w,w+R),C.emplaceBack(w+1,w+R),I===128&&C.emplaceBack(w+R,w+R+1);C.emplaceBack(w+1,w+1+R)}return C}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Ku(v){const a=[];for(let f=0;f<v.length;f++){if(v[f]===null)continue;const w=v[f].split(" ");a.push(w.pop())}return a}class Ql{static cacheKey(a,f,w){let C=`${a}${w?w.cacheKey:""}`;for(const R of f)C+=`/${R}`;return C}constructor(a,f,w,C,R,I){const F=a.gl;this.program=F.createProgram();const q=Ku(w.staticAttributes),X=C?C.getBinderAttributes():[],J=q.concat(X),it=w.staticUniforms?Ku(w.staticUniforms):[],pt=C?C.getBinderUniforms():[],gt=it.concat(pt),ft=[];for(const Rt of gt)ft.indexOf(Rt)<0&&ft.push(Rt);let ut=C?C.defines():[];ut=ut.concat(I.map(Rt=>`#define ${Rt}`));const Ft=ut.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Xl,Wu.fragmentSource,_s.fragmentSource,w.fragmentSource).join(`
`),Et=ut.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Xl,Wu.vertexSource,_s.vertexSource,na.vertexSource,w.vertexSource).join(`
`),It=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);F.shaderSource(It,Ft),F.compileShader(It),F.attachShader(this.program,It);const Bt=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);F.shaderSource(Bt,Et),F.compileShader(Bt),F.attachShader(this.program,Bt),this.attributes={};const Ut={};this.numAttributes=J.length;for(let Rt=0;Rt<this.numAttributes;Rt++)J[Rt]&&(F.bindAttribLocation(this.program,Rt,J[Rt]),this.attributes[J[Rt]]=Rt);F.linkProgram(this.program),F.deleteShader(Bt),F.deleteShader(It);for(let Rt=0;Rt<ft.length;Rt++){const Ht=ft[Rt];if(Ht&&!Ut[Ht]){const re=F.getUniformLocation(this.program,Ht);re&&(Ut[Ht]=re)}}this.fixedUniforms=R(a,Ut),this.binderUniforms=C?C.getUniforms(a,Ut):[],I.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Rt,Ht)=>({u_dem:new o.Uniform1i(Rt,Ht.u_dem),u_dem_prev:new o.Uniform1i(Rt,Ht.u_dem_prev),u_dem_unpack:new o.Uniform4f(Rt,Ht.u_dem_unpack),u_dem_tl:new o.Uniform2f(Rt,Ht.u_dem_tl),u_dem_scale:new o.Uniform1f(Rt,Ht.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(Rt,Ht.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(Rt,Ht.u_dem_scale_prev),u_dem_size:new o.Uniform1f(Rt,Ht.u_dem_size),u_dem_lerp:new o.Uniform1f(Rt,Ht.u_dem_lerp),u_exaggeration:new o.Uniform1f(Rt,Ht.u_exaggeration),u_depth:new o.Uniform1i(Rt,Ht.u_depth),u_depth_size_inv:new o.Uniform2f(Rt,Ht.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(Rt,Ht.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(Rt,Ht.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(Rt,Ht.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(Rt,Ht.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(Rt,Ht.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(Rt,Ht.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(Rt,Ht.u_tile_up_scale)}))(a,Ut)),I.indexOf("FOG")!==-1&&(this.fogUniforms=((Rt,Ht)=>({u_fog_matrix:new o.UniformMatrix4f(Rt,Ht.u_fog_matrix),u_fog_range:new o.Uniform2f(Rt,Ht.u_fog_range),u_fog_color:new o.Uniform4f(Rt,Ht.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(Rt,Ht.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(Rt,Ht.u_fog_temporal_offset)}))(a,Ut))}setTerrainUniformValues(a,f){if(!this.terrainUniforms)return;const w=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const C in f)w[C].set(f[C])}}setFogUniformValues(a,f){if(!this.fogUniforms)return;const w=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const C in f)w[C].location&&w[C].set(f[C])}}draw(a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft,ut,Ft){const Et=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(w),a.setStencilMode(C),a.setColorMode(R),a.setCullFace(I);for(const Bt of Object.keys(this.fixedUniforms))this.fixedUniforms[Bt].set(F[Bt]);ft&&ft.setUniforms(a,this.binderUniforms,pt,{zoom:gt});const It={[Et.LINES]:2,[Et.TRIANGLES]:3,[Et.LINE_STRIP]:1}[f];for(const Bt of it.get()){const Ut=Bt.vaos||(Bt.vaos={});(Ut[q]||(Ut[q]=new qu)).bind(a,this,X,ft?ft.getPaintVertexBuffers():[],J,Bt.vertexOffset,ut,Ft),Et.drawElements(f,Bt.primitiveLength*It,Et.UNSIGNED_SHORT,Bt.primitiveOffset*It*2)}}}function $l(v,a,f){const w=1/qt(f,1,a.transform.tileZoom),C=Math.pow(2,f.tileID.overscaledZ),R=f.tileSize*Math.pow(2,a.transform.tileZoom)/C,I=R*(f.tileID.canonical.x+f.tileID.wrap*C),F=R*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[w,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[I>>16,F>>16],u_pixel_coord_lower:[65535&I,65535&F]}}const wp=o.create(),Zu=(v,a,f,w,C,R,I,F,q)=>{const X=a.style.light,J=X.properties.get("position"),it=[J.x,J.y,J.z],pt=o.create$1();X.properties.get("anchor")==="viewport"&&(o.fromRotation(pt,-a.transform.angle),o.transformMat3(it,it,pt));const gt=X.properties.get("color"),ft=a.transform,ut={u_matrix:v,u_lightpos:it,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[gt.r,gt.g,gt.b],u_vertical_gradient:+f,u_opacity:w,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:wp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return ft.projection.name==="globe"&&(ut.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ut.u_zoom_transition=I,ut.u_inv_rot_matrix=q,ut.u_merc_center=F,ut.u_up_dir=ft.projection.upVector(new o.CanonicalTileID(0,0,0),F[0]*o.EXTENT,F[1]*o.EXTENT),ut.u_height_lift=R),ut},Ju=(v,a,f,w,C,R,I,F,q,X,J)=>{const it=Zu(v,a,f,w,C,F,q,X,J),pt={u_height_factor:-Math.pow(2,C.overscaledZ)/I.tileSize/8};return o.extend(it,$l(R,a,I),pt)},Qu=v=>({u_matrix:v}),$u=(v,a,f,w)=>o.extend(Qu(v),$l(f,a,w)),th=(v,a)=>({u_matrix:v,u_world:a}),Kg=(v,a,f,w,C)=>o.extend($u(v,a,f,w),{u_world:C}),Zg=o.create(),qa=(v,a,f,w,C,R)=>{const I=v.transform,F=I.projection.name==="globe";let q;if(R.paint.get("circle-pitch-alignment")==="map")if(F){const J=o.globePixelsToTileUnits(I.zoom,a.canonical);q=Float32Array.from([J,0,0,J])}else q=I.calculatePixelsToTileUnitsMatrix(f);else q=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const X={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:v.translatePosMatrix(a.projMatrix,f,R.paint.get("circle-translate"),R.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:q,u_inv_rot_matrix:Zg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return F&&(X.u_inv_rot_matrix=w,X.u_merc_center=C,X.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],X.u_zoom_transition=o.globeToMercatorTransition(I.zoom),X.u_up_dir=I.projection.upVector(a.canonical,C[0],C[1])),X},B1=v=>{const a=[];return v.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),v.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a},F1=(v,a,f)=>{const w=o.EXTENT/f.tileSize;return{u_matrix:v,u_camera_to_center_distance:a.cameraToCenterDistance,u_extrude_scale:[a.pixelsToGLUnits[0]/w,a.pixelsToGLUnits[1]/w]}},Jg=(v,a,f=1)=>({u_matrix:v,u_color:a,u_overlay:0,u_overlay_scale:f}),z1=o.create(),N1=(v,a,f,w,C,R,I)=>{const F=v.transform,q=F.projection.name==="globe",X=q?o.globePixelsToTileUnits(F.zoom,a.canonical):qt(f,1,R),J={u_matrix:a.projMatrix,u_extrude_scale:X,u_intensity:I,u_inv_rot_matrix:z1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return q&&(J.u_inv_rot_matrix=w,J.u_merc_center=C,J.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],J.u_zoom_transition=o.globeToMercatorTransition(F.zoom),J.u_up_dir=F.projection.upVector(a.canonical,C[0],C[1])),J},U1=(v,a,f,w,C,R,I)=>{const F=v.transform,q=F.calculatePixelsToTileUnitsMatrix(a),X={u_matrix:ia(v,a,f,C),u_pixels_to_tile_units:q,u_device_pixel_ratio:I,u_units_to_pixels:[1/F.pixelsToGLUnits[0],1/F.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:R,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Ep(f)){const J=eh(a,v.transform);X.u_texsize=a.lineAtlasTexture.size,X.u_scale=[J,w.fromScale,w.toScale],X.u_mix=w.t}return X},Ap=(v,a,f,w,C,R)=>{const I=v.transform,F=eh(a,I);return{u_matrix:ia(v,a,f,C),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:R,u_image:0,u_scale:[F,w.fromScale,w.toScale],u_fade:w.t,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function eh(v,a){return 1/qt(v,1,a.tileZoom)}function ia(v,a,f,w){return v.translatePosMatrix(w||a.tileID.projMatrix,a,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}function Ep(v){const a=v.paint.get("line-dasharray").value;return a.value||a.kind!=="constant"}const Qg=(v,a,f,w,C,R)=>{return{u_matrix:v,u_tl_parent:a,u_scale_parent:f,u_fade_t:w.mix,u_opacity:w.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(F=C.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(I=C.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Tp(C.paint.get("raster-hue-rotate")),u_perspective_transform:R};var I,F};function Tp(v){v*=Math.PI/180;const a=Math.sin(v),f=Math.cos(v);return[(2*f+1)/3,(-Math.sqrt(3)*a-f+1)/3,(Math.sqrt(3)*a-f+1)/3]}const Ms=o.create(),Pp=(v,a,f,w,C,R,I,F,q,X,J,it,pt,gt)=>{const ft=C.transform,ut={u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ft.cameraToCenterDistance,u_rotate_symbol:+f,u_aspect_ratio:ft.width/ft.height,u_fade_change:C.options.fadeDuration?C.symbolFadeChange:1,u_matrix:R,u_label_plane_matrix:I,u_coord_matrix:F,u_is_text:+q,u_pitch_with_map:+w,u_texsize:X,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ms,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ms};return ft.projection.name==="globe"&&(ut.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],ut.u_zoom_transition=it,ut.u_inv_rot_matrix=gt,ut.u_merc_center=pt,ut.u_camera_forward=ft._camera.forward(),ut.u_ecef_origin=o.globeECEFOrigin(ft.globeMatrix,J.toUnwrapped()),ut.u_tile_matrix=Float32Array.from(ft.globeMatrix)),ut},ra=(v,a,f,w,C,R,I,F,q,X,J,it,pt,gt,ft)=>{const{cameraToCenterDistance:ut,_pitch:Ft}=C.transform;return o.extend(Pp(v,a,f,w,C,R,I,F,q,X,it,pt,gt,ft),{u_gamma_scale:w?ut*Math.cos(C.terrain?0:Ft):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+J})},Ya=(v,a,f,w,C,R,I,F,q,X,J,it,pt,gt)=>o.extend(ra(v,a,f,w,C,R,I,F,!0,q,!0,J,it,pt,gt),{u_texsize_icon:X,u_texture_icon:1}),$g=(v,a,f)=>({u_matrix:v,u_opacity:a,u_color:f}),Sp=(v,a,f,w,C,R)=>o.extend(function(I,F,q,X){const J=q.imageManager.getPattern(I.from.toString()),it=q.imageManager.getPattern(I.to.toString()),{width:pt,height:gt}=q.imageManager.getPixelSize(),ft=Math.pow(2,X.tileID.overscaledZ),ut=X.tileSize*Math.pow(2,q.transform.tileZoom)/ft,Ft=ut*(X.tileID.canonical.x+X.tileID.wrap*ft),Et=ut*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:J.tl,u_pattern_br_a:J.br,u_pattern_tl_b:it.tl,u_pattern_br_b:it.br,u_texsize:[pt,gt],u_mix:F.t,u_pattern_size_a:J.displaySize,u_pattern_size_b:it.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/qt(X,1,q.transform.tileZoom),u_pixel_coord_upper:[Ft>>16,Et>>16],u_pixel_coord_lower:[65535&Ft,65535&Et]}}(w,R,f,C),{u_matrix:v,u_opacity:a}),ri={fillExtrusion:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_lightpos:new o.Uniform3f(v,a.u_lightpos),u_lightintensity:new o.Uniform1f(v,a.u_lightintensity),u_lightcolor:new o.Uniform3f(v,a.u_lightcolor),u_vertical_gradient:new o.Uniform1f(v,a.u_vertical_gradient),u_opacity:new o.Uniform1f(v,a.u_opacity),u_tile_id:new o.Uniform3f(v,a.u_tile_id),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(v,a.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_up_dir:new o.Uniform3f(v,a.u_up_dir),u_height_lift:new o.Uniform1f(v,a.u_height_lift)}),fillExtrusionPattern:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_lightpos:new o.Uniform3f(v,a.u_lightpos),u_lightintensity:new o.Uniform1f(v,a.u_lightintensity),u_lightcolor:new o.Uniform3f(v,a.u_lightcolor),u_vertical_gradient:new o.Uniform1f(v,a.u_vertical_gradient),u_height_factor:new o.Uniform1f(v,a.u_height_factor),u_tile_id:new o.Uniform3f(v,a.u_tile_id),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(v,a.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_up_dir:new o.Uniform3f(v,a.u_up_dir),u_height_lift:new o.Uniform1f(v,a.u_height_lift),u_image:new o.Uniform1i(v,a.u_image),u_texsize:new o.Uniform2f(v,a.u_texsize),u_pixel_coord_upper:new o.Uniform2f(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,a.u_pixel_coord_lower),u_scale:new o.Uniform3f(v,a.u_scale),u_fade:new o.Uniform1f(v,a.u_fade),u_opacity:new o.Uniform1f(v,a.u_opacity)}),fill:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix)}),fillPattern:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_image:new o.Uniform1i(v,a.u_image),u_texsize:new o.Uniform2f(v,a.u_texsize),u_pixel_coord_upper:new o.Uniform2f(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,a.u_pixel_coord_lower),u_scale:new o.Uniform3f(v,a.u_scale),u_fade:new o.Uniform1f(v,a.u_fade)}),fillOutline:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_world:new o.Uniform2f(v,a.u_world)}),fillOutlinePattern:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_world:new o.Uniform2f(v,a.u_world),u_image:new o.Uniform1i(v,a.u_image),u_texsize:new o.Uniform2f(v,a.u_texsize),u_pixel_coord_upper:new o.Uniform2f(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,a.u_pixel_coord_lower),u_scale:new o.Uniform3f(v,a.u_scale),u_fade:new o.Uniform1f(v,a.u_fade)}),circle:(v,a)=>({u_camera_to_center_distance:new o.Uniform1f(v,a.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(v,a.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(v,a.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(v,a.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_tile_id:new o.Uniform3f(v,a.u_tile_id),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_up_dir:new o.Uniform3f(v,a.u_up_dir)}),collisionBox:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_camera_to_center_distance:new o.Uniform1f(v,a.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(v,a.u_extrude_scale)}),collisionCircle:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_inv_matrix:new o.UniformMatrix4f(v,a.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(v,a.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(v,a.u_viewport_size)}),debug:(v,a)=>({u_color:new o.UniformColor(v,a.u_color),u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_overlay:new o.Uniform1i(v,a.u_overlay),u_overlay_scale:new o.Uniform1f(v,a.u_overlay_scale)}),clippingMask:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix)}),heatmap:(v,a)=>({u_extrude_scale:new o.Uniform1f(v,a.u_extrude_scale),u_intensity:new o.Uniform1f(v,a.u_intensity),u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(v,a.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_tile_id:new o.Uniform3f(v,a.u_tile_id),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_up_dir:new o.Uniform3f(v,a.u_up_dir)}),heatmapTexture:(v,a)=>({u_image:new o.Uniform1i(v,a.u_image),u_color_ramp:new o.Uniform1i(v,a.u_color_ramp),u_opacity:new o.Uniform1f(v,a.u_opacity)}),hillshade:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_image:new o.Uniform1i(v,a.u_image),u_latrange:new o.Uniform2f(v,a.u_latrange),u_light:new o.Uniform2f(v,a.u_light),u_shadow:new o.UniformColor(v,a.u_shadow),u_highlight:new o.UniformColor(v,a.u_highlight),u_accent:new o.UniformColor(v,a.u_accent)}),hillshadePrepare:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_image:new o.Uniform1i(v,a.u_image),u_dimension:new o.Uniform2f(v,a.u_dimension),u_zoom:new o.Uniform1f(v,a.u_zoom),u_unpack:new o.Uniform4f(v,a.u_unpack)}),line:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(v,a.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(v,a.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(v,a.u_units_to_pixels),u_dash_image:new o.Uniform1i(v,a.u_dash_image),u_gradient_image:new o.Uniform1i(v,a.u_gradient_image),u_image_height:new o.Uniform1f(v,a.u_image_height),u_texsize:new o.Uniform2f(v,a.u_texsize),u_scale:new o.Uniform3f(v,a.u_scale),u_mix:new o.Uniform1f(v,a.u_mix),u_alpha_discard_threshold:new o.Uniform1f(v,a.u_alpha_discard_threshold)}),linePattern:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_texsize:new o.Uniform2f(v,a.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(v,a.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(v,a.u_device_pixel_ratio),u_image:new o.Uniform1i(v,a.u_image),u_units_to_pixels:new o.Uniform2f(v,a.u_units_to_pixels),u_scale:new o.Uniform3f(v,a.u_scale),u_fade:new o.Uniform1f(v,a.u_fade),u_alpha_discard_threshold:new o.Uniform1f(v,a.u_alpha_discard_threshold)}),raster:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_tl_parent:new o.Uniform2f(v,a.u_tl_parent),u_scale_parent:new o.Uniform1f(v,a.u_scale_parent),u_fade_t:new o.Uniform1f(v,a.u_fade_t),u_opacity:new o.Uniform1f(v,a.u_opacity),u_image0:new o.Uniform1i(v,a.u_image0),u_image1:new o.Uniform1i(v,a.u_image1),u_brightness_low:new o.Uniform1f(v,a.u_brightness_low),u_brightness_high:new o.Uniform1f(v,a.u_brightness_high),u_saturation_factor:new o.Uniform1f(v,a.u_saturation_factor),u_contrast_factor:new o.Uniform1f(v,a.u_contrast_factor),u_spin_weights:new o.Uniform3f(v,a.u_spin_weights),u_perspective_transform:new o.Uniform2f(v,a.u_perspective_transform)}),symbolIcon:(v,a)=>({u_is_size_zoom_constant:new o.Uniform1i(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(v,a.u_is_size_feature_constant),u_size_t:new o.Uniform1f(v,a.u_size_t),u_size:new o.Uniform1f(v,a.u_size),u_camera_to_center_distance:new o.Uniform1f(v,a.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(v,a.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(v,a.u_aspect_ratio),u_fade_change:new o.Uniform1f(v,a.u_fade_change),u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(v,a.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(v,a.u_coord_matrix),u_is_text:new o.Uniform1i(v,a.u_is_text),u_pitch_with_map:new o.Uniform1i(v,a.u_pitch_with_map),u_texsize:new o.Uniform2f(v,a.u_texsize),u_tile_id:new o.Uniform3f(v,a.u_tile_id),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(v,a.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_camera_forward:new o.Uniform3f(v,a.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(v,a.u_tile_matrix),u_ecef_origin:new o.Uniform3f(v,a.u_ecef_origin),u_texture:new o.Uniform1i(v,a.u_texture)}),symbolSDF:(v,a)=>({u_is_size_zoom_constant:new o.Uniform1i(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(v,a.u_is_size_feature_constant),u_size_t:new o.Uniform1f(v,a.u_size_t),u_size:new o.Uniform1f(v,a.u_size),u_camera_to_center_distance:new o.Uniform1f(v,a.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(v,a.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(v,a.u_aspect_ratio),u_fade_change:new o.Uniform1f(v,a.u_fade_change),u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(v,a.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(v,a.u_coord_matrix),u_is_text:new o.Uniform1i(v,a.u_is_text),u_pitch_with_map:new o.Uniform1i(v,a.u_pitch_with_map),u_texsize:new o.Uniform2f(v,a.u_texsize),u_texture:new o.Uniform1i(v,a.u_texture),u_gamma_scale:new o.Uniform1f(v,a.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(v,a.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(v,a.u_tile_id),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(v,a.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_camera_forward:new o.Uniform3f(v,a.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(v,a.u_tile_matrix),u_ecef_origin:new o.Uniform3f(v,a.u_ecef_origin),u_is_halo:new o.Uniform1i(v,a.u_is_halo)}),symbolTextAndIcon:(v,a)=>({u_is_size_zoom_constant:new o.Uniform1i(v,a.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(v,a.u_is_size_feature_constant),u_size_t:new o.Uniform1f(v,a.u_size_t),u_size:new o.Uniform1f(v,a.u_size),u_camera_to_center_distance:new o.Uniform1f(v,a.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(v,a.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(v,a.u_aspect_ratio),u_fade_change:new o.Uniform1f(v,a.u_fade_change),u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(v,a.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(v,a.u_coord_matrix),u_is_text:new o.Uniform1i(v,a.u_is_text),u_pitch_with_map:new o.Uniform1i(v,a.u_pitch_with_map),u_texsize:new o.Uniform2f(v,a.u_texsize),u_texsize_icon:new o.Uniform2f(v,a.u_texsize_icon),u_texture:new o.Uniform1i(v,a.u_texture),u_texture_icon:new o.Uniform1i(v,a.u_texture_icon),u_gamma_scale:new o.Uniform1f(v,a.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(v,a.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(v,a.u_is_halo)}),background:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_opacity:new o.Uniform1f(v,a.u_opacity),u_color:new o.UniformColor(v,a.u_color)}),backgroundPattern:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_opacity:new o.Uniform1f(v,a.u_opacity),u_image:new o.Uniform1i(v,a.u_image),u_pattern_tl_a:new o.Uniform2f(v,a.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(v,a.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(v,a.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(v,a.u_pattern_br_b),u_texsize:new o.Uniform2f(v,a.u_texsize),u_mix:new o.Uniform1f(v,a.u_mix),u_pattern_size_a:new o.Uniform2f(v,a.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(v,a.u_pattern_size_b),u_scale_a:new o.Uniform1f(v,a.u_scale_a),u_scale_b:new o.Uniform1f(v,a.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(v,a.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(v,a.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(v,a.u_tile_units_to_pixels)}),terrainRaster:vp,terrainDepth:vp,skybox:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_sun_direction:new o.Uniform3f(v,a.u_sun_direction),u_cubemap:new o.Uniform1i(v,a.u_cubemap),u_opacity:new o.Uniform1f(v,a.u_opacity),u_temporal_offset:new o.Uniform1f(v,a.u_temporal_offset)}),skyboxGradient:(v,a)=>({u_matrix:new o.UniformMatrix4f(v,a.u_matrix),u_color_ramp:new o.Uniform1i(v,a.u_color_ramp),u_center_direction:new o.Uniform3f(v,a.u_center_direction),u_radius:new o.Uniform1f(v,a.u_radius),u_opacity:new o.Uniform1f(v,a.u_opacity),u_temporal_offset:new o.Uniform1f(v,a.u_temporal_offset)}),skyboxCapture:(v,a)=>({u_matrix_3f:new o.UniformMatrix3f(v,a.u_matrix_3f),u_sun_direction:new o.Uniform3f(v,a.u_sun_direction),u_sun_intensity:new o.Uniform1f(v,a.u_sun_intensity),u_color_tint_r:new o.Uniform4f(v,a.u_color_tint_r),u_color_tint_m:new o.Uniform4f(v,a.u_color_tint_m),u_luminance:new o.Uniform1f(v,a.u_luminance)}),globeRaster:(v,a)=>({u_proj_matrix:new o.UniformMatrix4f(v,a.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(v,a.u_globe_matrix),u_merc_matrix:new o.UniformMatrix4f(v,a.u_merc_matrix),u_zoom_transition:new o.Uniform1f(v,a.u_zoom_transition),u_merc_center:new o.Uniform2f(v,a.u_merc_center),u_image0:new o.Uniform1i(v,a.u_image0),u_grid_matrix:new o.UniformMatrix3f(v,a.u_grid_matrix)}),globeAtmosphere:(v,a)=>({u_frustum_tl:new o.Uniform3f(v,a.u_frustum_tl),u_frustum_tr:new o.Uniform3f(v,a.u_frustum_tr),u_frustum_br:new o.Uniform3f(v,a.u_frustum_br),u_frustum_bl:new o.Uniform3f(v,a.u_frustum_bl),u_globe_pos:new o.Uniform3f(v,a.u_globe_pos),u_globe_radius:new o.Uniform1f(v,a.u_globe_radius),u_opacity:new o.Uniform1f(v,a.u_opacity),u_fadeout_range:new o.Uniform1f(v,a.u_fadeout_range),u_start_color:new o.Uniform3f(v,a.u_start_color),u_end_color:new o.Uniform3f(v,a.u_end_color)})};let oa;function ty(v,a,f,w,C,R,I){const F=v.context,q=F.gl,X=v.useProgram("collisionBox"),J=[];let it=0,pt=0;for(let Bt=0;Bt<w.length;Bt++){const Ut=w[Bt],Rt=a.getTile(Ut),Ht=Rt.getBucket(f);if(!Ht)continue;let re=Ut.projMatrix;C[0]===0&&C[1]===0||(re=v.translatePosMatrix(Ut.projMatrix,Rt,C,R));const he=I?Ht.textCollisionBox:Ht.iconCollisionBox,xe=Ht.collisionCircleArray;if(xe.length>0){const ge=o.create(),ze=re;o.mul(ge,Ht.placementInvProjMatrix,v.transform.glCoordMatrix),o.mul(ge,ge,Ht.placementViewportMatrix),J.push({circleArray:xe,circleOffset:pt,transform:ze,invTransform:ge}),it+=xe.length/4,pt=it}he&&(v.terrain&&v.terrain.setupElevationDraw(Rt,X),X.draw(F,q.LINES,o.DepthMode.disabled,o.StencilMode.disabled,v.colorModeForRenderPass(),o.CullFaceMode.disabled,F1(re,v.transform,Rt),f.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,null,v.transform.zoom,null,he.collisionVertexBuffer,he.collisionVertexBufferExt))}if(!I||!J.length)return;const gt=v.useProgram("collisionCircle"),ft=new o.StructArrayLayout2f1f2i16;ft.resize(4*it),ft._trim();let ut=0;for(const Bt of J)for(let Ut=0;Ut<Bt.circleArray.length/4;Ut++){const Rt=4*Ut,Ht=Bt.circleArray[Rt+0],re=Bt.circleArray[Rt+1],he=Bt.circleArray[Rt+2],xe=Bt.circleArray[Rt+3];ft.emplace(ut++,Ht,re,he,xe,0),ft.emplace(ut++,Ht,re,he,xe,1),ft.emplace(ut++,Ht,re,he,xe,2),ft.emplace(ut++,Ht,re,he,xe,3)}(!oa||oa.length<2*it)&&(oa=function(Bt){const Ut=2*Bt,Rt=new o.StructArrayLayout3ui6;Rt.resize(Ut),Rt._trim();for(let Ht=0;Ht<Ut;Ht++){const re=6*Ht;Rt.uint16[re+0]=4*Ht+0,Rt.uint16[re+1]=4*Ht+1,Rt.uint16[re+2]=4*Ht+2,Rt.uint16[re+3]=4*Ht+2,Rt.uint16[re+4]=4*Ht+3,Rt.uint16[re+5]=4*Ht+0}return Rt}(it));const Ft=F.createIndexBuffer(oa,!0),Et=F.createVertexBuffer(ft,o.collisionCircleLayout.members,!0);for(const Bt of J){const Ut={u_matrix:Bt.transform,u_inv_matrix:Bt.invTransform,u_camera_to_center_distance:(It=v.transform).cameraToCenterDistance,u_viewport_size:[It.width,It.height]};gt.draw(F,q.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,v.colorModeForRenderPass(),o.CullFaceMode.disabled,Ut,f.id,Et,Ft,o.SegmentVector.simpleSegment(0,2*Bt.circleOffset,Bt.circleArray.length,Bt.circleArray.length/2),null,v.transform.zoom,null,null,null)}var It;Et.destroy(),Ft.destroy()}const Cp=o.create();function tc(v,a,f,w,C,R){const{horizontalAlign:I,verticalAlign:F}=o.getAnchorAlignment(v),q=-(I-.5)*a,X=-(F-.5)*f,J=o.evaluateVariableOffset(v,w);return new o.pointGeometry((q/C+J[0])*R,(X/C+J[1])*R)}function V1(v,a,f,w,C,R,I,F,q,X,J,it){const pt=v.text.placedSymbolArray,gt=v.text.dynamicLayoutVertexArray,ft=v.icon.dynamicLayoutVertexArray,ut={},Ft=F.projMatrix,Et=R.elevation,It=it.upVectorScale(F.canonical,R.center.lat,R.worldSize);gt.clear();for(let Bt=0;Bt<pt.length;Bt++){const Ut=pt.get(Bt),Rt=v.allowVerticalPlacement&&!Ut.placedOrientation,Ht=Ut.hidden||!Ut.crossTileID||Rt?null:w[Ut.crossTileID];if(Ht){const re=new o.pointGeometry(Ut.tileAnchorX,Ut.tileAnchorY),he=it.upVector(F.canonical,re.x,re.y),xe=Et?Et.getAtTileOffset(F,re.x,re.y):0,ge=fi([Ut.projectedAnchorX+xe*he[0]*It.metersToTile,Ut.projectedAnchorY+xe*he[1]*It.metersToTile,Ut.projectedAnchorZ+xe*he[2]*It.metersToTile],f?Ft:I),ze=di(R.cameraToCenterDistance,ge.signedDistanceFromCamera);let oe=C.evaluateSizeForFeature(v.textSizeData,X,Ut)*ze/o.ONE_EM;f&&(oe*=v.tilePixelRatio/q);const{width:Ne,height:Ie,anchor:en,textOffset:ve,textScale:Ze}=Ht,_n=tc(en,Ne,Ie,ve,Ze,oe),Qe=f?hi(re.add(_n),I,xe*It.metersToLabelSpace).point:ge.point.add(a?_n.rotate(-R.angle):_n),$e=v.allowVerticalPlacement&&Ut.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let An=0;An<Ut.numGlyphs;An++)o.addDynamicAttributes(gt,Qe,$e);J&&Ut.associatedIconIndex>=0&&(ut[Ut.associatedIconIndex]={shiftedAnchor:Qe,angle:$e})}else ji(Ut.numGlyphs,gt)}if(J){ft.clear();const Bt=v.icon.placedSymbolArray;for(let Ut=0;Ut<Bt.length;Ut++){const Rt=Bt.get(Ut);if(Rt.hidden)ji(Rt.numGlyphs,ft);else{const Ht=ut[Ut];if(Ht)for(let re=0;re<Rt.numGlyphs;re++)o.addDynamicAttributes(ft,Ht.shiftedAnchor,Ht.angle);else ji(Rt.numGlyphs,ft)}}v.icon.dynamicLayoutVertexBuffer.updateData(ft)}v.text.dynamicLayoutVertexBuffer.updateData(gt)}function G1(v,a,f){return f.iconsInText&&a?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Dp(v,a,f,w,C,R,I,F,q,X,J,it){const pt=v.context,gt=pt.gl,ft=v.transform,ut=F==="map",Ft=q==="map",Et=ut&&f.layout.get("symbol-placement")!=="point",It=ut&&!Ft&&!Et,Bt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ut=!1;const Rt=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),Ht=[o.mercatorXfromLng(ft.center.lng),o.mercatorYfromLat(ft.center.lat)],re=f.layout.get("text-variable-anchor"),he=ft.projection.name==="globe",xe=he?o.globeToMercatorTransition(ft.zoom):0,ge=[],ze=[];v.terrain&&Ft&&ze.push("PITCH_WITH_MAP_TERRAIN"),he&&ze.push("PROJECTION_GLOBE_VIEW");for(const oe of w){const Ne=a.getTile(oe),Ie=Ne.getBucket(f);if(!Ie||Ie.projection!==ft.projection.name)continue;const en=C?Ie.text:Ie.icon;if(!en||Ie.fullyClipped||!en.segments.get().length)continue;const ve=en.programConfigurations.get(f.id),Ze=C||Ie.sdfIcons,_n=C?Ie.textSizeData:Ie.iconSizeData,Qe=Ft||ft.pitch!==0,$e=o.evaluateSizeForZoom(_n,ft.zoom);let An,Un,gn,Pn,Zn=[0,0],Ei=null;if(C){if(Un=Ne.glyphAtlasTexture,gn=gt.LINEAR,An=Ne.glyphAtlasTexture.size,Ie.iconsInText){Zn=Ne.imageAtlasTexture.size,Ei=Ne.imageAtlasTexture;const Or=_n.kind==="composite"||_n.kind==="camera";Pn=Qe||v.options.rotating||v.options.zooming||Or?gt.LINEAR:gt.NEAREST}}else{const Or=f.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;Un=Ne.imageAtlasTexture,gn=Ze||v.options.rotating||v.options.zooming||Or||Qe?gt.LINEAR:gt.NEAREST,An=Ne.imageAtlasTexture.size}const cr=v.transform.calculatePixelsToTileUnitsMatrix(Ne),ur=xi(oe.projMatrix,Ne.tileID.canonical,Ft,ut,v.transform,cr),Vr=v.terrain&&Ft&&Et?o.invert(o.create(),ur):Cp,Ao=kr(oe.projMatrix,Ne.tileID.canonical,Ft,ut,v.transform,cr),ts=re&&Ie.hasTextData(),Ss=f.layout.get("icon-text-fit")!=="none"&&ts&&Ie.hasIconData();if(Et){const Or=ft.elevation,aa=Or?Or.getAtTileOffsetFunc(oe,ft.center.lat,ft.worldSize,ft.projection):Dy=>[0,0,0];Xo(Ie,oe.projMatrix,v,C,ur,Ao,Ft,X,aa,oe)}const es=Et||C&&re||Ss,Pi=v.translatePosMatrix(oe.projMatrix,Ne,R,I),Di=es?Cp:ur,ti=v.translatePosMatrix(Ao,Ne,R,I,!0),zi=ft.projection.createInversionMatrix(ft,oe.canonical),Gr=es?ze.concat(["PROJECTED_POS_ON_VIEWPORT"]):ze,Ti=Ze&&f.paint.get(C?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let no;no=Ze?Ie.iconsInText?Ya(_n.kind,$e,It,Ft,v,Pi,Di,ti,An,Zn,oe,xe,Ht,zi):ra(_n.kind,$e,It,Ft,v,Pi,Di,ti,C,An,!0,oe,xe,Ht,zi):Pp(_n.kind,$e,It,Ft,v,Pi,Di,ti,C,An,oe,xe,Ht,zi);const gc={program:v.useProgram(G1(Ze,C,Ie),ve,Gr),buffers:en,uniformValues:no,atlasTexture:Un,atlasTextureIcon:Ei,atlasInterpolation:gn,atlasInterpolationIcon:Pn,isSDF:Ze,hasHalo:Ti,tile:Ne,labelPlaneMatrixInv:Vr};if(Bt&&Ie.canOverlap){Ut=!0;const Or=en.segments.get();for(const aa of Or)ge.push({segments:new o.SegmentVector([aa]),sortKey:aa.sortKey,state:gc})}else ge.push({segments:en.segments,sortKey:0,state:gc})}Ut&&ge.sort((oe,Ne)=>oe.sortKey-Ne.sortKey);for(const oe of ge){const Ne=oe.state;if(v.terrain&&v.terrain.setupElevationDraw(Ne.tile,Ne.program,{useDepthForOcclusion:!he,labelPlaneMatrixInv:Ne.labelPlaneMatrixInv}),pt.activeTexture.set(gt.TEXTURE0),Ne.atlasTexture.bind(Ne.atlasInterpolation,gt.CLAMP_TO_EDGE),Ne.atlasTextureIcon&&(pt.activeTexture.set(gt.TEXTURE1),Ne.atlasTextureIcon&&Ne.atlasTextureIcon.bind(Ne.atlasInterpolationIcon,gt.CLAMP_TO_EDGE)),Ne.isSDF){const Ie=Ne.uniformValues;Ne.hasHalo&&(Ie.u_is_halo=1,ey(Ne.buffers,oe.segments,f,v,Ne.program,Rt,J,it,Ie)),Ie.u_is_halo=0}ey(Ne.buffers,oe.segments,f,v,Ne.program,Rt,J,it,Ne.uniformValues)}}function ey(v,a,f,w,C,R,I,F,q){const X=w.context;C.draw(X,X.gl.TRIANGLES,R,I,F,o.CullFaceMode.disabled,q,f.id,v.layoutVertexBuffer,v.indexBuffer,a,f.paint,w.transform.zoom,v.programConfigurations.get(f.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function nh(v,a,f,w,C,R,I){const F=v.context.gl,q=f.paint.get("fill-pattern"),X=q&&q.constantOr(1),J=f.getCrossfadeParameters();let it,pt,gt,ft,ut;I?(pt=X&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",it=F.LINES):(pt=X?"fillPattern":"fill",it=F.TRIANGLES);for(const Ft of w){const Et=a.getTile(Ft);if(X&&!Et.patternsLoaded())continue;const It=Et.getBucket(f);if(!It)continue;v.prepareDrawTile();const Bt=It.programConfigurations.get(f.id),Ut=v.useProgram(pt,Bt);X&&(v.context.activeTexture.set(F.TEXTURE0),Et.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Bt.updatePaintBuffers(J));const Rt=q.constantOr(null);if(Rt&&Et.imageAtlas){const re=Et.imageAtlas,he=re.patternPositions[Rt.to.toString()],xe=re.patternPositions[Rt.from.toString()];he&&xe&&Bt.setConstantPatternPositions(he,xe)}const Ht=v.translatePosMatrix(Ft.projMatrix,Et,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(I){ft=It.indexBuffer2,ut=It.segments2;const re=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];gt=pt==="fillOutlinePattern"&&X?Kg(Ht,v,J,Et,re):th(Ht,re)}else ft=It.indexBuffer,ut=It.segments,gt=X?$u(Ht,v,J,Et):Qu(Ht);v.prepareDrawProgram(v.context,Ut,Ft.toUnwrapped()),Ut.draw(v.context,it,C,v.stencilModeForClipping(Ft),R,o.CullFaceMode.disabled,gt,f.id,It.layoutVertexBuffer,ft,ut,f.paint,v.transform.zoom,Bt)}}function Xa(v,a,f,w,C,R,I){const F=v.context,q=F.gl,X=v.transform,J=f.paint.get("fill-extrusion-pattern"),it=J.constantOr(1),pt=f.getCrossfadeParameters(),gt=f.paint.get("fill-extrusion-opacity"),ft=function(Bt){if(Bt.projection.name!=="globe")return 0;const Ut=Math.PI/32,Rt=Math.tan(Ut),Ht=o.earthRadius;return Ht*Math.sqrt(1+2*Rt*Rt)-Ht}(X),ut=X.projection.name==="globe",Ft=ut?o.globeToMercatorTransition(X.zoom):0,Et=[o.mercatorXfromLng(X.center.lng),o.mercatorYfromLat(X.center.lat)],It=[];ut&&It.push("PROJECTION_GLOBE_VIEW");for(const Bt of w){const Ut=a.getTile(Bt),Rt=Ut.getBucket(f);if(!Rt||Rt.projection!==X.projection.name)continue;const Ht=Rt.programConfigurations.get(f.id),re=v.useProgram(it?"fillExtrusionPattern":"fillExtrusion",Ht,It);if(v.terrain){const Ne=v.terrain;if(v.style.terrainSetForDrapingOnly())Ne.setupElevationDraw(Ut,re,{useMeterToDem:!0});else{if(!Rt.enableTerrain)continue;if(Ne.setupElevationDraw(Ut,re,{useMeterToDem:!0}),ec(F,a,Bt,Rt,f,Ne),!Rt.centroidVertexBuffer){const Ie=re.attributes.a_centroid_pos;Ie!==void 0&&q.vertexAttrib2f(Ie,0,0)}}}it&&(v.context.activeTexture.set(q.TEXTURE0),Ut.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Ht.updatePaintBuffers(pt));const he=J.constantOr(null);if(he&&Ut.imageAtlas){const Ne=Ut.imageAtlas,Ie=Ne.patternPositions[he.to.toString()],en=Ne.patternPositions[he.from.toString()];Ie&&en&&Ht.setConstantPatternPositions(Ie,en)}const xe=v.translatePosMatrix(Bt.projMatrix,Ut,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),ge=X.projection.createInversionMatrix(X,Bt.canonical),ze=f.paint.get("fill-extrusion-vertical-gradient"),oe=it?Ju(xe,v,ze,gt,Bt,pt,Ut,ft,Ft,Et,ge):Zu(xe,v,ze,gt,Bt,ft,Ft,Et,ge);v.prepareDrawProgram(F,re,Bt.toUnwrapped()),re.draw(F,F.gl.TRIANGLES,C,R,I,o.CullFaceMode.backCCW,oe,f.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,f.paint,v.transform.zoom,Ht,v.terrain?Rt.centroidVertexBuffer:null,ut?Rt.layoutVertexExtBuffer:null)}}function ec(v,a,f,w,C,R){const I=[Et=>{let It=Et.canonical.x-1,Bt=Et.wrap;return It<0&&(It=(1<<Et.canonical.z)-1,Bt--),new o.OverscaledTileID(Et.overscaledZ,Bt,Et.canonical.z,It,Et.canonical.y)},Et=>{let It=Et.canonical.x+1,Bt=Et.wrap;return It===1<<Et.canonical.z&&(It=0,Bt++),new o.OverscaledTileID(Et.overscaledZ,Bt,Et.canonical.z,It,Et.canonical.y)},Et=>new o.OverscaledTileID(Et.overscaledZ,Et.wrap,Et.canonical.z,Et.canonical.x,(Et.canonical.y===0?1<<Et.canonical.z:Et.canonical.y)-1),Et=>new o.OverscaledTileID(Et.overscaledZ,Et.wrap,Et.canonical.z,Et.canonical.x,Et.canonical.y===(1<<Et.canonical.z)-1?0:Et.canonical.y+1)],F=Et=>{const It=a.getSource().minzoom,Bt=Rt=>{const Ht=a.getTileByID(Rt);if(Ht&&Ht.hasData())return Ht.getBucket(C)},Ut=[0,-1,1];for(const Rt of Ut){if(Et.overscaledZ+Rt<It)continue;const Ht=Bt(Et.calculateScaledKey(Et.overscaledZ+Rt));if(Ht)return Ht}},q=[0,0,0],X=(Et,It)=>(q[0]=Math.min(Et.min.y,It.min.y),q[1]=Math.max(Et.max.y,It.max.y),q[2]=o.EXTENT-It.min.x>Et.max.x?It.min.x-o.EXTENT:Et.max.x,q),J=(Et,It)=>(q[0]=Math.min(Et.min.x,It.min.x),q[1]=Math.max(Et.max.x,It.max.x),q[2]=o.EXTENT-It.min.y>Et.max.y?It.min.y-o.EXTENT:Et.max.y,q),it=[(Et,It)=>X(Et,It),(Et,It)=>X(It,Et),(Et,It)=>J(Et,It),(Et,It)=>J(It,Et)],pt=new o.pointGeometry(0,0);let gt,ft,ut;const Ft=(Et,It,Bt,Ut,Rt)=>{const Ht=[[Ut?Bt:Et,Ut?Et:Bt,0],[Ut?Bt:It,Ut?It:Bt,0]],re=Rt<0?o.EXTENT+Rt:Rt,he=[Ut?re:(Et+It)/2,Ut?(Et+It)/2:re,0];return Bt===0&&Rt<0||Bt!==0&&Rt>0?R.getForTilePoints(ut,[he],!0,ft):Ht.push(he),R.getForTilePoints(f,Ht,!0,gt),Math.max(Ht[0][2],Ht[1][2],he[2])/R.exaggeration()};for(let Et=0;Et<4;Et++){const It=(Et<2?1:5)-Et,Bt=w.borders[Et];if(Bt.length===0)continue;const Ut=ut=I[Et](f),Rt=F(Ut);if(!(Rt&&Rt instanceof o.FillExtrusionBucket&&Rt.enableTerrain)||w.borderDoneWithNeighborZ[Et]===Rt.canonical.z&&Rt.borderDoneWithNeighborZ[It]===w.canonical.z||(ft=R.findDEMTileFor(Ut),!ft||!ft.dem))continue;if(!gt){const xe=R.findDEMTileFor(f);if(!xe||!xe.dem)return;gt=xe}const Ht=Rt.borders[It];let re=0;const he=Rt.borderDoneWithNeighborZ[It]!==w.canonical.z;if(w.canonical.z===Rt.canonical.z){for(let xe=0;xe<Bt.length;xe++){const ge=w.featuresOnBorder[Bt[xe]],ze=ge.borders[Et];let oe;for(;re<Ht.length&&(oe=Rt.featuresOnBorder[Ht[re]],!(oe.borders[It][1]>ze[0]+3));)he&&Rt.encodeCentroid(void 0,oe,!1),re++;if(oe&&re<Ht.length){const Ne=re;let Ie=0;for(;!(oe.borders[It][0]>ze[1]-3)&&(Ie++,++re!==Ht.length);)oe=Rt.featuresOnBorder[Ht[re]];if(oe=Rt.featuresOnBorder[Ht[Ne]],ge.intersectsCount()>1||oe.intersectsCount()>1||Ie!==1){Ie!==1&&(re=Ne),w.encodeCentroid(void 0,ge,!1),he&&Rt.encodeCentroid(void 0,oe,!1);continue}const en=it[Et](ge,oe),ve=Et%2?o.EXTENT-1:0;pt.x=Ft(en[0],Math.min(o.EXTENT-1,en[1]),ve,Et<2,en[2]),pt.y=0,w.encodeCentroid(pt,ge,!1),he&&Rt.encodeCentroid(pt,oe,!1)}else w.encodeCentroid(void 0,ge,!1)}w.borderDoneWithNeighborZ[Et]=Rt.canonical.z,w.needsCentroidUpdate=!0,he&&(Rt.borderDoneWithNeighborZ[It]=w.canonical.z,Rt.needsCentroidUpdate=!0)}else{for(const xe of Bt)w.encodeCentroid(void 0,w.featuresOnBorder[xe],!1);if(he){for(const xe of Ht)Rt.encodeCentroid(void 0,Rt.featuresOnBorder[xe],!1);Rt.borderDoneWithNeighborZ[It]=w.canonical.z,Rt.needsCentroidUpdate=!0}w.borderDoneWithNeighborZ[Et]=Rt.canonical.z,w.needsCentroidUpdate=!0}}(w.needsCentroidUpdate||!w.centroidVertexBuffer&&w.centroidVertexArray.length!==0)&&w.uploadCentroid(v)}const Rp=new o.Color(1,0,0,1),Lp=new o.Color(0,1,0,1),ny=new o.Color(0,0,1,1),ih=new o.Color(1,0,1,1),rh=new o.Color(0,1,1,1);function Ye(v,a,f,w){nc(v,0,a+f/2,v.transform.width,f,w)}function to(v,a,f,w){nc(v,a-f/2,0,f,v.transform.height,w)}function nc(v,a,f,w,C,R){const I=v.context,F=I.gl;F.enable(F.SCISSOR_TEST),F.scissor(a*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio,w*o.exported.devicePixelRatio,C*o.exported.devicePixelRatio),I.clear({color:R}),F.disable(F.SCISSOR_TEST)}function iy(v,a,f){const w=v.context,C=w.gl,R=v.transform.projection.name==="globe",I=f.projMatrix,F=v.useProgram("debug",null,R?["PROJECTION_GLOBE_VIEW"]:null),q=a.getTileByID(f.key);v.terrain&&v.terrain.setupElevationDraw(q,F);const X=o.DepthMode.disabled,J=o.StencilMode.disabled,it=v.colorModeForRenderPass(),pt="$debug";w.activeTexture.set(C.TEXTURE0),v.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R?q._makeGlobeTileDebugBuffers(v.context,v.transform.projection):q._makeDebugTileBoundsBuffers(v.context,v.transform.projection);const gt=q._tileDebugBuffer||v.debugBuffer,ft=q._tileDebugIndexBuffer||v.debugIndexBuffer,ut=q._tileDebugSegments||v.debugSegments;F.draw(w,C.LINE_STRIP,X,J,it,o.CullFaceMode.disabled,Jg(I,o.Color.red),pt,gt,ft,ut,null,null,null,q._globeTileDebugBorderBuffer);const Ft=q.latestRawTileData,Et=Math.floor((Ft&&Ft.byteLength||0)/1024),It=a.getTile(f).tileSize,Bt=512/Math.min(It,512)*(f.overscaledZ/v.transform.zoom)*.5;let Ut=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ut+=` => ${f.overscaledZ}`),function(he,xe){he.initDebugOverlayCanvas();const ge=he.debugOverlayCanvas,ze=he.context.gl,oe=he.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,ge.width,ge.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(xe,5,5),oe.strokeText(xe,5,5),he.debugOverlayTexture.update(ge),he.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(v,`${Ut} ${Et}kb`);const Rt=q._tileDebugTextBuffer||v.debugBuffer,Ht=q._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,re=q._tileDebugTextSegments||v.debugSegments;F.draw(w,C.TRIANGLES,X,J,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Jg(I,o.Color.transparent,Bt),pt,Rt,Ht,re,null,null,null,q._globeTileDebugTextBuffer)}const ry=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ka}=ry;function Jo(v,a,f,w){v.emplaceBack(a,f,w)}class ic{constructor(a){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Jo(this.vertexArray,-1,-1,1),Jo(this.vertexArray,1,-1,1),Jo(this.vertexArray,-1,1,1),Jo(this.vertexArray,1,1,1),Jo(this.vertexArray,-1,-1,-1),Jo(this.vertexArray,1,-1,-1),Jo(this.vertexArray,-1,1,-1),Jo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Ka),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function ws(v,a,f,w,C,R){const I=v.gl,F=a.paint.get("sky-atmosphere-color"),q=a.paint.get("sky-atmosphere-halo-color"),X=a.paint.get("sky-atmosphere-sun-intensity"),J=((it,pt,gt,ft,ut)=>({u_matrix_3f:it,u_sun_direction:pt,u_sun_intensity:gt,u_color_tint_r:[ft.r,ft.g,ft.b,ft.a],u_color_tint_m:[ut.r,ut.g,ut.b,ut.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),w),C,X,F,q);I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+R,a.skyboxTexture,0),f.draw(v,I.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,J,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}function As(v,a){return o.transformMat4(v,v,a)}const Ip={symbol:function(v,a,f,w,C){if(v.renderPass!=="translucent")return;const R=o.StencilMode.disabled,I=v.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(F,q,X,J,it,pt,gt){const ft=q.transform,ut=it==="map",Ft=pt==="map";for(const Et of F){const It=J.getTile(Et),Bt=It.getBucket(X);if(!Bt||Bt.projection!==ft.projection.name||!Bt.text||!Bt.text.segments.get().length)continue;const Ut=o.evaluateSizeForZoom(Bt.textSizeData,ft.zoom),Rt=q.transform.calculatePixelsToTileUnitsMatrix(It),Ht=xi(Et.projMatrix,It.tileID.canonical,Ft,ut,q.transform,Rt),re=X.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Ut){const he=Math.pow(2,ft.zoom-It.tileID.overscaledZ);V1(Bt,ut,Ft,gt,o.symbolSize,ft,Ht,Et,he,Ut,re,ft.projection)}}}(w,v,f,a,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),C),f.paint.get("icon-opacity").constantOr(1)!==0&&Dp(v,a,f,w,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),R,I),f.paint.get("text-opacity").constantOr(1)!==0&&Dp(v,a,f,w,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),R,I),a.map.showCollisionBoxes&&(ty(v,a,f,w,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),ty(v,a,f,w,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(v,a,f,w){if(v.renderPass!=="translucent")return;const C=f.paint.get("circle-opacity"),R=f.paint.get("circle-stroke-width"),I=f.paint.get("circle-stroke-opacity"),F=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(C.constantOr(1)===0&&(R.constantOr(1)===0||I.constantOr(1)===0))return;const q=v.context,X=q.gl,J=v.transform,it=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),pt=o.StencilMode.disabled,gt=v.colorModeForRenderPass(),ft=J.projection.name==="globe",ut=[o.mercatorXfromLng(J.center.lng),o.mercatorYfromLat(J.center.lat)],Ft=[];for(let It=0;It<w.length;It++){const Bt=w[It],Ut=a.getTile(Bt),Rt=Ut.getBucket(f);if(!Rt)continue;const Ht=Rt.programConfigurations.get(f.id),re=B1(f);ft&&re.push("PROJECTION_GLOBE_VIEW");const he=v.useProgram("circle",Ht,re),xe=Rt.layoutVertexBuffer,ge=Rt.globeExtVertexBuffer,ze=Rt.indexBuffer,oe=J.projection.createInversionMatrix(J,Bt.canonical),Ne={programConfiguration:Ht,program:he,layoutVertexBuffer:xe,globeExtVertexBuffer:ge,indexBuffer:ze,uniformValues:qa(v,Bt,Ut,oe,ut,f),tile:Ut};if(F){const Ie=Rt.segments.get();for(const en of Ie)Ft.push({segments:new o.SegmentVector([en]),sortKey:en.sortKey,state:Ne})}else Ft.push({segments:Rt.segments,sortKey:0,state:Ne})}F&&Ft.sort((It,Bt)=>It.sortKey-Bt.sortKey);const Et={useDepthForOcclusion:!ft};for(const It of Ft){const{programConfiguration:Bt,program:Ut,layoutVertexBuffer:Rt,globeExtVertexBuffer:Ht,indexBuffer:re,uniformValues:he,tile:xe}=It.state,ge=It.segments;v.terrain&&v.terrain.setupElevationDraw(xe,Ut,Et),v.prepareDrawProgram(q,Ut,xe.tileID.toUnwrapped()),Ut.draw(q,X.TRIANGLES,it,pt,gt,o.CullFaceMode.disabled,he,f.id,Rt,re,ge,f.paint,J.zoom,Bt,ft?Ht:null)}},heatmap:function(v,a,f,w){if(f.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const C=v.context,R=C.gl,I=o.StencilMode.disabled,F=new o.ColorMode([R.ONE,R.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(pt,gt,ft){const ut=pt.gl;pt.activeTexture.set(ut.TEXTURE1),pt.viewport.set([0,0,gt.width/4,gt.height/4]);let Ft=ft.heatmapFbo;if(Ft)ut.bindTexture(ut.TEXTURE_2D,Ft.colorAttachment.get()),pt.bindFramebuffer.set(Ft.framebuffer);else{const Et=ut.createTexture();ut.bindTexture(ut.TEXTURE_2D,Et),ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_WRAP_S,ut.CLAMP_TO_EDGE),ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_WRAP_T,ut.CLAMP_TO_EDGE),ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_MIN_FILTER,ut.LINEAR),ut.texParameteri(ut.TEXTURE_2D,ut.TEXTURE_MAG_FILTER,ut.LINEAR),Ft=ft.heatmapFbo=pt.createFramebuffer(gt.width/4,gt.height/4,!1),function(It,Bt,Ut,Rt){const Ht=It.gl;Ht.texImage2D(Ht.TEXTURE_2D,0,Ht.RGBA,Bt.width/4,Bt.height/4,0,Ht.RGBA,It.extRenderToTextureHalfFloat?It.extTextureHalfFloat.HALF_FLOAT_OES:Ht.UNSIGNED_BYTE,null),Rt.colorAttachment.set(Ut)}(pt,gt,Et,Ft)}})(C,v,f),C.clear({color:o.Color.transparent});const q=v.transform,X=q.projection.name==="globe",J=X?["PROJECTION_GLOBE_VIEW"]:null,it=[o.mercatorXfromLng(q.center.lng),o.mercatorYfromLat(q.center.lat)];for(let pt=0;pt<w.length;pt++){const gt=w[pt];if(a.hasRenderableParent(gt))continue;const ft=a.getTile(gt),ut=ft.getBucket(f);if(!ut)continue;const Ft=ut.programConfigurations.get(f.id),Et=v.useProgram("heatmap",Ft,J),{zoom:It}=v.transform;v.terrain&&v.terrain.setupElevationDraw(ft,Et),v.prepareDrawProgram(C,Et,gt.toUnwrapped());const Bt=q.projection.createInversionMatrix(q,gt.canonical);Et.draw(C,R.TRIANGLES,o.DepthMode.disabled,I,F,o.CullFaceMode.disabled,N1(v,gt,ft,Bt,it,It,f.paint.get("heatmap-intensity")),f.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,f.paint,v.transform.zoom,Ft,X?ut.globeExtVertexBuffer:null)}C.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(C,R){const I=C.context,F=I.gl,q=R.heatmapFbo;if(!q)return;I.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,q.colorAttachment.get()),I.activeTexture.set(F.TEXTURE1);let X=R.colorRampTexture;X||(X=R.colorRampTexture=new o.Texture(I,R.colorRamp,F.RGBA)),X.bind(F.LINEAR,F.CLAMP_TO_EDGE),C.useProgram("heatmapTexture").draw(I,F.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,C.colorModeForRenderPass(),o.CullFaceMode.disabled,((J,it,pt,gt)=>({u_image:0,u_color_ramp:1,u_opacity:it.paint.get("heatmap-opacity")}))(0,R),R.id,C.viewportBuffer,C.quadTriangleIndexBuffer,C.viewportSegments,R.paint,C.transform.zoom)}(v,f))},line:function(v,a,f,w){if(v.renderPass!=="translucent")return;const C=f.paint.get("line-opacity"),R=f.paint.get("line-width");if(C.constantOr(1)===0||R.constantOr(1)===0)return;const I=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),F=v.colorModeForRenderPass(),q=v.terrain&&v.terrain.renderingToTexture?1:o.exported.devicePixelRatio,X=f.paint.get("line-dasharray"),J=X.constantOr(1),it=f.layout.get("line-cap"),pt=f.paint.get("line-pattern"),gt=pt.constantOr(1),ft=f.paint.get("line-gradient"),ut=f.getCrossfadeParameters(),Ft=gt?"linePattern":"line",Et=v.context,It=Et.gl,Bt=(Rt=>{const Ht=[];Ep(Rt)&&Ht.push("RENDER_LINE_DASH"),Rt.paint.get("line-gradient")&&Ht.push("RENDER_LINE_GRADIENT");const re=Rt.paint.get("line-pattern").constantOr(1),he=Rt.paint.get("line-opacity").constantOr(1)!==1;return!re&&he&&Ht.push("RENDER_LINE_ALPHA_DISCARD"),Ht})(f);let Ut=Bt.includes("RENDER_LINE_ALPHA_DISCARD");v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(Ut=!1);for(const Rt of w){const Ht=a.getTile(Rt);if(gt&&!Ht.patternsLoaded())continue;const re=Ht.getBucket(f);if(!re)continue;v.prepareDrawTile();const he=re.programConfigurations.get(f.id),xe=v.useProgram(Ft,he,Bt),ge=pt.constantOr(null);if(ge&&Ht.imageAtlas){const ve=Ht.imageAtlas,Ze=ve.patternPositions[ge.to.toString()],_n=ve.patternPositions[ge.from.toString()];Ze&&_n&&he.setConstantPatternPositions(Ze,_n)}const ze=X.constantOr(null),oe=it.constantOr(null);if(!gt&&ze&&oe&&Ht.lineAtlas){const ve=Ht.lineAtlas,Ze=ve.getDash(ze.to,oe),_n=ve.getDash(ze.from,oe);Ze&&_n&&he.setConstantPatternPositions(Ze,_n)}const Ne=v.terrain?Rt.projMatrix:null,Ie=gt?Ap(v,Ht,f,ut,Ne,q):U1(v,Ht,f,ut,Ne,re.lineClipsArray.length,q);if(ft){const ve=re.gradients[f.id];let Ze=ve.texture;if(f.gradientVersion!==ve.version){let _n=256;if(f.stepInterpolant){const Qe=a.getSource().maxzoom,$e=Rt.canonical.z===Qe?Math.ceil(1<<v.transform.maxZoom-Rt.canonical.z):1;_n=o.clamp(o.nextPowerOfTwo(re.maxLineLength/o.EXTENT*1024*$e),256,Et.maxTextureSize)}ve.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:_n,image:ve.gradient||void 0,clips:re.lineClipsArray}),ve.texture?ve.texture.update(ve.gradient):ve.texture=new o.Texture(Et,ve.gradient,It.RGBA),ve.version=f.gradientVersion,Ze=ve.texture}Et.activeTexture.set(It.TEXTURE1),Ze.bind(f.stepInterpolant?It.NEAREST:It.LINEAR,It.CLAMP_TO_EDGE)}J&&(Et.activeTexture.set(It.TEXTURE0),Ht.lineAtlasTexture.bind(It.LINEAR,It.REPEAT),he.updatePaintBuffers(ut)),gt&&(Et.activeTexture.set(It.TEXTURE0),Ht.imageAtlasTexture.bind(It.LINEAR,It.CLAMP_TO_EDGE),he.updatePaintBuffers(ut)),v.prepareDrawProgram(Et,xe,Rt.toUnwrapped());const en=ve=>{xe.draw(Et,It.TRIANGLES,I,ve,F,o.CullFaceMode.disabled,Ie,f.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,f.paint,v.transform.zoom,he,re.layoutVertexBuffer2)};if(Ut){const ve=v.stencilModeForClipping(Rt).ref;ve===0&&v.terrain&&Et.clear({stencil:0});const Ze={func:It.EQUAL,mask:255};Ie.u_alpha_discard_threshold=.8,en(new o.StencilMode(Ze,ve,255,It.KEEP,It.KEEP,It.INVERT)),Ie.u_alpha_discard_threshold=0,en(new o.StencilMode(Ze,ve,255,It.KEEP,It.KEEP,It.KEEP))}else en(v.stencilModeForClipping(Rt))}Ut&&(v.resetStencilClippingMasks(),v.terrain&&Et.clear({stencil:0}))},fill:function(v,a,f,w){const C=f.paint.get("fill-color"),R=f.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const I=v.colorModeForRenderPass(),F=f.paint.get("fill-pattern"),q=v.opaquePassEnabledForLayer()&&!F.constantOr(1)&&C.constantOr(o.Color.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===q){const X=v.depthModeForSublayer(1,v.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);nh(v,a,f,w,X,I,!1)}if(v.renderPass==="translucent"&&f.paint.get("fill-antialias")){const X=v.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);nh(v,a,f,w,X,I,!0)}},"fill-extrusion":function(v,a,f,w){const C=f.paint.get("fill-extrusion-opacity");if(C!==0&&v.renderPass==="translucent"){const R=new o.DepthMode(v.context.gl.LEQUAL,o.DepthMode.ReadWrite,v.depthRangeFor3D);if(C!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Xa(v,a,f,w,R,o.StencilMode.disabled,o.ColorMode.disabled),Xa(v,a,f,w,R,v.stencilModeFor3D(),v.colorModeForRenderPass()),v.resetStencilClippingMasks();else{const I=v.colorModeForRenderPass();Xa(v,a,f,w,R,o.StencilMode.disabled,I)}}},hillshade:function(v,a,f,w){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const C=v.context,R=v.depthModeForSublayer(0,o.DepthMode.ReadOnly),I=v.colorModeForRenderPass(),F=v.terrain&&v.terrain.renderingToTexture,[q,X]=v.renderPass!=="translucent"||F?[{},w]:v.stencilConfigForOverlap(w);for(const J of X){const it=a.getTile(J);if(it.needsHillshadePrepare&&v.renderPass==="offscreen")xp(v,it,f,R,o.StencilMode.disabled,I);else if(v.renderPass==="translucent"){const pt=F&&v.terrain?v.terrain.stencilModeForRTTOverlap(J):q[J.overscaledZ];qg(v,J,it,f,R,pt,I)}}C.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,a,f,w,C,R){if(v.renderPass!=="translucent"||f.paint.get("raster-opacity")===0||!w.length)return;const I=v.context,F=I.gl,q=a.getSource(),X=v.useProgram("raster"),J=v.colorModeForRenderPass(),it=v.terrain&&v.terrain.renderingToTexture,[pt,gt]=q instanceof Yt||it?[{},w]:v.stencilConfigForOverlap(w),ft=gt[gt.length-1].overscaledZ,ut=!v.options.moving;for(const Ft of gt){const Et=it?o.DepthMode.disabled:v.depthModeForSublayer(Ft.overscaledZ-ft,f.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,F.LESS),It=Ft.toUnwrapped(),Bt=a.getTile(Ft);if(it&&(!Bt||!Bt.hasData()))continue;const Ut=it?Ft.projMatrix:v.transform.calculateProjMatrix(It,ut),Rt=v.terrain&&it?v.terrain.stencilModeForRTTOverlap(Ft):pt[Ft.overscaledZ],Ht=R?0:f.paint.get("raster-fade-duration");Bt.registerFadeDuration(Ht);const re=a.findLoadedParent(Ft,0),he=bp(Bt,re,a,v.transform,Ht);let xe,ge;v.terrain&&v.terrain.prepareDrawTile();const ze=f.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;I.activeTexture.set(F.TEXTURE0),Bt.texture.bind(ze,F.CLAMP_TO_EDGE),I.activeTexture.set(F.TEXTURE1),re?(re.texture.bind(ze,F.CLAMP_TO_EDGE),xe=Math.pow(2,re.tileID.overscaledZ-Bt.tileID.overscaledZ),ge=[Bt.tileID.canonical.x*xe%1,Bt.tileID.canonical.y*xe%1]):Bt.texture.bind(ze,F.CLAMP_TO_EDGE);const oe=Qg(Ut,ge||[0,0],xe||1,he,f,q instanceof Yt?q.perspectiveTransform:[0,0]);if(v.prepareDrawProgram(I,X,It),q instanceof Yt)q.boundsBuffer&&q.boundsSegments&&X.draw(I,F.TRIANGLES,Et,o.StencilMode.disabled,J,o.CullFaceMode.disabled,oe,f.id,q.boundsBuffer,v.quadTriangleIndexBuffer,q.boundsSegments);else{const{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:Ie,tileBoundsSegments:en}=v.getTileBoundsBuffers(Bt);X.draw(I,F.TRIANGLES,Et,Rt,J,o.CullFaceMode.disabled,oe,f.id,Ne,Ie,en)}}v.resetStencilClippingMasks()},background:function(v,a,f,w){const C=f.paint.get("background-color"),R=f.paint.get("background-opacity");if(R===0)return;const I=v.context,F=I.gl,q=v.transform,X=q.tileSize,J=f.paint.get("background-pattern");if(v.isPatternMissing(J))return;const it=!J&&C.a===1&&R===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==it)return;const pt=o.StencilMode.disabled,gt=v.depthModeForSublayer(0,it==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),ft=v.colorModeForRenderPass(),ut=v.useProgram(J?"backgroundPattern":"background");let Ft,Et=w;Et||(Ft=v.getBackgroundTiles(),Et=Object.values(Ft).map(Bt=>Bt.tileID)),J&&(I.activeTexture.set(F.TEXTURE0),v.imageManager.bind(v.context));const It=f.getCrossfadeParameters();for(const Bt of Et){const Ut=Bt.toUnwrapped(),Rt=w?Bt.projMatrix:v.transform.calculateProjMatrix(Ut);v.prepareDrawTile();const Ht=a?a.getTile(Bt):Ft?Ft[Bt.key]:new o.Tile(Bt,X,q.zoom,v),re=J?Sp(Rt,R,v,J,{tileID:Bt,tileSize:X},It):$g(Rt,R,C);v.prepareDrawProgram(I,ut,Ut);const{tileBoundsBuffer:he,tileBoundsIndexBuffer:xe,tileBoundsSegments:ge}=v.getTileBoundsBuffers(Ht);ut.draw(I,F.TRIANGLES,gt,pt,ft,o.CullFaceMode.disabled,re,f.id,he,xe,ge)}},sky:function(v,a,f){const w=v.transform,C=w.projection.name==="mercator"||w.projection.name==="globe"?1:o.smoothstep(7,8,w.zoom),R=f.paint.get("sky-opacity")*C;if(R===0)return;const I=v.context,F=f.paint.get("sky-type"),q=new o.DepthMode(I.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),X=v.frameCounter/1e3%1;F==="atmosphere"?v.renderPass==="offscreen"?f.needsSkyboxCapture(v)&&(function(J,it,pt,gt){const ft=J.context,ut=ft.gl;let Ft=it.skyboxFbo;if(!Ft){Ft=it.skyboxFbo=ft.createFramebuffer(32,32,!1),it.skyboxGeometry=new ic(ft),it.skyboxTexture=ft.gl.createTexture(),ut.bindTexture(ut.TEXTURE_CUBE_MAP,it.skyboxTexture),ut.texParameteri(ut.TEXTURE_CUBE_MAP,ut.TEXTURE_WRAP_S,ut.CLAMP_TO_EDGE),ut.texParameteri(ut.TEXTURE_CUBE_MAP,ut.TEXTURE_WRAP_T,ut.CLAMP_TO_EDGE),ut.texParameteri(ut.TEXTURE_CUBE_MAP,ut.TEXTURE_MIN_FILTER,ut.LINEAR),ut.texParameteri(ut.TEXTURE_CUBE_MAP,ut.TEXTURE_MAG_FILTER,ut.LINEAR);for(let Ut=0;Ut<6;++Ut)ut.texImage2D(ut.TEXTURE_CUBE_MAP_POSITIVE_X+Ut,0,ut.RGBA,32,32,0,ut.RGBA,ut.UNSIGNED_BYTE,null)}ft.bindFramebuffer.set(Ft.framebuffer),ft.viewport.set([0,0,32,32]);const Et=it.getCenter(J,!0),It=J.useProgram("skyboxCapture"),Bt=new Float64Array(16);o.identity(Bt),o.rotateY(Bt,Bt,.5*-Math.PI),ws(ft,it,It,Bt,Et,0),o.identity(Bt),o.rotateY(Bt,Bt,.5*Math.PI),ws(ft,it,It,Bt,Et,1),o.identity(Bt),o.rotateX(Bt,Bt,.5*-Math.PI),ws(ft,it,It,Bt,Et,2),o.identity(Bt),o.rotateX(Bt,Bt,.5*Math.PI),ws(ft,it,It,Bt,Et,3),o.identity(Bt),ws(ft,it,It,Bt,Et,4),o.identity(Bt),o.rotateY(Bt,Bt,Math.PI),ws(ft,it,It,Bt,Et,5),ft.viewport.set([0,0,J.width,J.height])}(v,f),f.markSkyboxValid(v)):v.renderPass==="sky"&&function(J,it,pt,gt,ft){const ut=J.context,Ft=ut.gl,Et=J.transform,It=J.useProgram("skybox");ut.activeTexture.set(Ft.TEXTURE0),Ft.bindTexture(Ft.TEXTURE_CUBE_MAP,it.skyboxTexture);const Bt=((Ut,Rt,Ht,re,he)=>({u_matrix:Ut,u_sun_direction:Rt,u_cubemap:0,u_opacity:re,u_temporal_offset:he}))(Et.skyboxMatrix,it.getCenter(J,!1),0,gt,ft);J.prepareDrawProgram(ut,It),It.draw(ut,Ft.TRIANGLES,pt,o.StencilMode.disabled,J.colorModeForRenderPass(),o.CullFaceMode.backCW,Bt,"skybox",it.skyboxGeometry.vertexBuffer,it.skyboxGeometry.indexBuffer,it.skyboxGeometry.segment)}(v,f,q,R,X):F==="gradient"&&v.renderPass==="sky"&&function(J,it,pt,gt,ft){const ut=J.context,Ft=ut.gl,Et=J.transform,It=J.useProgram("skyboxGradient");it.skyboxGeometry||(it.skyboxGeometry=new ic(ut)),ut.activeTexture.set(Ft.TEXTURE0);let Bt=it.colorRampTexture;Bt||(Bt=it.colorRampTexture=new o.Texture(ut,it.colorRamp,Ft.RGBA)),Bt.bind(Ft.LINEAR,Ft.CLAMP_TO_EDGE);const Ut=((Rt,Ht,re,he,xe)=>({u_matrix:Rt,u_color_ramp:0,u_center_direction:Ht,u_radius:o.degToRad(re),u_opacity:he,u_temporal_offset:xe}))(Et.skyboxMatrix,it.getCenter(J,!1),it.paint.get("sky-gradient-radius"),gt,ft);J.prepareDrawProgram(ut,It),It.draw(ut,Ft.TRIANGLES,pt,o.StencilMode.disabled,J.colorModeForRenderPass(),o.CullFaceMode.backCW,Ut,"skyboxGradient",it.skyboxGeometry.vertexBuffer,it.skyboxGeometry.indexBuffer,it.skyboxGeometry.segment)}(v,f,q,R,X)},debug:function(v,a,f){for(let w=0;w<f.length;w++)iy(v,a,f[w])},custom:function(v,a,f){const w=v.context,C=f.implementation;if(v.transform.projection.unsupportedLayers&&v.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(v.renderPass==="offscreen"){const R=C.prerender;R&&(v.setCustomLayerDefaults(),w.setColorMode(v.colorModeForRenderPass()),R.call(C,w.gl,v.transform.customLayerMatrix()),w.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),w.setColorMode(v.colorModeForRenderPass()),w.setStencilMode(o.StencilMode.disabled);const R=C.renderingMode==="3d"?new o.DepthMode(v.context.gl.LEQUAL,o.DepthMode.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,o.DepthMode.ReadOnly);w.setDepthMode(R),C.render(w.gl,v.transform.customLayerMatrix()),w.setDirty(),v.setBaseState(),w.bindFramebuffer.set(null)}}};class oy{constructor(a,f){this.context=new et(a),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Hu,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(a,f){const w=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(w||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zr(this,a));const C=this._terrain;this.transform.elevation=w?C:null,C.update(a,this.transform,f)}_updateFog(a){const f=a.fog;if(!f||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[w,C]=f.getFovAdjustedRange(this.transform._fov);if(w>C)return void(this.transform.fogCullDistSq=null);const R=w+.78*(C-w);this.transform.fogCullDistSq=R*R}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,f){if(this.width=a*o.exported.devicePixelRatio,this.height=f*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style.order)this.style._layers[w].resize()}setup(){const a=this.context,f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(f,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const w=new o.StructArrayLayout2i4;w.emplaceBack(0,0),w.emplaceBack(o.EXTENT,0),w.emplaceBack(0,o.EXTENT),w.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=a.createVertexBuffer(w,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const C=new o.StructArrayLayout2i4;C.emplaceBack(-1,-1),C.emplaceBack(1,-1),C.emplaceBack(-1,1),C.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(C,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const R=new o.StructArrayLayout4i8;R.emplaceBack(0,0,0,0),R.emplaceBack(o.EXTENT,0,o.EXTENT,0),R.emplaceBack(0,o.EXTENT,0,o.EXTENT),R.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(R,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const I=new o.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const F=new o.StructArrayLayout1ui2;for(const X of[0,1,3,2,0])F.emplaceBack(X);this.debugIndexBuffer=a.createIndexBuffer(F),this.emptyTexture=new o.Texture(a,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=o.create();const q=this.context.gl;this.stencilClearMode=new o.StencilMode({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO),this.loadTimeStamps.push(o.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,f=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(a,f.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Xu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(a,f,w){if(!f||this.currentStencilSource===f.id||!a.isTileClipped()||!w||w.length===0)return;const C=[];let R=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const J of w)if(this._tileClippingMaskIDs.has(J.key)||(R=!0),this._skippedStencilTileIDs.has(J.key)){if(!f.getTile(J).getBucket(a))continue;this._skippedStencilTileIDs.delete(J.key),C.push(J)}if(!R&&C.length===0)return}const I=this.context,F=I.gl;I.setColorMode(o.ColorMode.disabled),I.setDepthMode(o.DepthMode.disabled);const q=this.useProgram("clippingMask"),X=J=>{const it=f.getTile(J),{tileBoundsBuffer:pt,tileBoundsIndexBuffer:gt,tileBoundsSegments:ft}=this.getTileBoundsBuffers(it);q.draw(I,F.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:F.GREATER,mask:255},this._tileClippingMaskIDs.get(J.key)||0,255,F.KEEP,F.KEEP,F.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Xu(J.projMatrix),"$clipping",pt,gt,ft)};if(!R&&C.length>0)for(const J of C)X(J);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+w.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const J of w)this._tileClippingMaskIDs.set(J.key,this.nextStencilID++),f.getTile(J).getBucket(a)?X(J):this._skippedStencilTileIDs.add(J.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=f.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,f=this.context.gl;return new o.StencilMode({func:f.NOTEQUAL,mask:255},a,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const f=this.context.gl;return new o.StencilMode({func:f.EQUAL,mask:255},this._tileClippingMaskIDs.get(a.key)||0,0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(a){const f=this.context.gl,w=a.sort((I,F)=>F.overscaledZ-I.overscaledZ),C=w[w.length-1].overscaledZ,R=w[0].overscaledZ-C+1;if(R>1){this.currentStencilSource=void 0,this.nextStencilID+R>256&&this.clearStencil();const I={};for(let F=0;F<R;F++)I[F+C]=new o.StencilMode({func:f.GEQUAL,mask:255},F+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=R,[I,w]}return[{[C]:o.StencilMode.disabled},w]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([a.CONSTANT_COLOR,a.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(a,f,w){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const C=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new o.DepthMode(w||this.context.gl.LEQUAL,f,[C,C])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,f){this.style=a,this.options=f,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const w=this.style.order,C=this.style._sourceCaches;for(const X in C){const J=C[X];J.used&&J.prepare(this.context)}const R={},I={},F={};for(const X in C){const J=C[X];R[X]=J.getVisibleCoordinates(),I[X]=R[X].slice().reverse(),F[X]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let X=0;X<w.length;X++)if(this.style._layers[w[X]].is3D()){this.opaquePassCutoff=X;break}if(this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),!o.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const X of w){const J=this.style._layers[X],it=a._getLayerSourceCache(J);if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const pt=it?I[it.id]:void 0;(J.type==="custom"||J.isSky()||pt&&pt.length)&&this.renderLayer(this,it,J,pt)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let q=o.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(q=this.style.fog.properties.get("color")),this.context.clear({color:f.showOverdrawInspector?o.Color.black:q,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const X=this.style._layers[w[this.currentLayer]],J=a._getLayerSourceCache(X);if(X.isSky())continue;const it=J?I[J.id]:void 0;this._renderTileClippingMasks(X,J,it),this.renderLayer(this,J,X,it)}if(this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const X=this.style._layers[w[this.currentLayer]],J=a._getLayerSourceCache(X);X.isSky()&&this.renderLayer(this,J,X,J?I[J.id]:void 0)}for(this.transform.projection.name==="globe"&&function(X){const J=X.context,it=J.gl,pt=X.transform,gt=new o.DepthMode(it.LEQUAL,o.DepthMode.ReadOnly,[0,1]),ft=X.useProgram("globeAtmosphere"),ut=pt.centerOffset,Ft=pt._camera.getCameraToClipPerspective(pt._fov,pt.width/pt.height,pt._nearZ,pt._farZ);Ft[8]=2*-ut.x/pt.width,Ft[9]=2*ut.y/pt.height;const Et=o.invert([],Ft),It=o.mul([],Et,pt.projMatrix),Bt={u_frustum_tl:As([-1,1,1],Et),u_frustum_tr:As([1,1,1],Et),u_frustum_br:As([1,-1,1],Et),u_frustum_bl:As([-1,-1,1],Et),u_globe_pos:As([pt.globeMatrix[12],pt.globeMatrix[13],pt.globeMatrix[14]],It),u_globe_radius:pt.worldSize/2/Math.PI-1,u_opacity:1-o.globeToMercatorTransition(pt.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};X.prepareDrawProgram(J,ft);const Ut=X.globeSharedBuffers;Ut&&ft.draw(J,it.TRIANGLES,gt,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Bt,"skybox",Ut.atmosphereVertexBuffer,Ut.atmosphereIndexBuffer,Ut.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<w.length;){const X=this.style._layers[w[this.currentLayer]],J=a._getLayerSourceCache(X);if(X.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(X)){if(X.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const it=J?(X.type==="symbol"?F:I)[J.id]:void 0;this._renderTileClippingMasks(X,J,J?R[J.id]:void 0),this.renderLayer(this,J,X,it),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let X=null;o.values(this.style._layers).forEach(J=>{const it=a._getLayerSourceCache(J);it&&!J.isHidden(this.transform.zoom)&&(!X||X.getSource().maxzoom<it.getSource().maxzoom)&&(X=it)}),X&&this.options.showTileBoundaries&&Ip.debug(this,X,X.getVisibleCoordinates())}this.options.showPadding&&function(X){const J=X.transform.padding;Ye(X,X.transform.height-(J.top||0),3,Rp),Ye(X,J.bottom||0,3,Lp),to(X,J.left||0,3,ny),to(X,X.transform.width-(J.right||0),3,ih);const it=X.transform.centerPoint;(function(pt,gt,ft,ut){nc(pt,gt-1,ft-10,2,20,ut),nc(pt,gt-10,ft-1,20,2,ut)})(X,it.x,X.transform.height-it.y,rh)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,f,w,C){w.isHidden(this.transform.zoom)||(w.type==="background"||w.type==="sky"||w.type==="custom"||C&&C.length)&&(this.id=w.id,this.gpuTimingStart(w),a.transform.projection.unsupportedLayers&&a.transform.projection.unsupportedLayers.includes(w.type)||Ip[w.type](a,f,w,C,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery;let w=this.gpuTimers[a.id];w||(w=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),w.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,w.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}queryGpuTimers(a){const f={};for(const w in a){const C=a[w],R=this.context.extTimerQuery,I=R.getQueryObjectEXT(C.query,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(C.query),f[w]=I}return f}translatePosMatrix(a,f,w,C,R){if(!w[0]&&!w[1])return a;const I=R?C==="map"?this.transform.angle:0:C==="viewport"?-this.transform.angle:0;if(I){const X=Math.sin(I),J=Math.cos(I);w=[w[0]*J-w[1]*X,w[0]*X+w[1]*J]}const F=[R?w[0]:qt(f,w[0],this.transform.zoom),R?w[1]:qt(f,w[1],this.transform.zoom),0],q=new Float32Array(16);return o.translate(q,a,F),q}saveTileTexture(a){const f=this._tileTextures[a.size[0]];f?f.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const f=this._tileTextures[a];return f&&f.length>0?f.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const f=this.imageManager.getPattern(a.from.toString()),w=this.imageManager.getPattern(a.to.toString());return!f||!w}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,f=this.style&&this.style.fog,w=[];return this.terrain&&!this.terrain.renderingToTexture&&w.push("TERRAIN"),f&&!a&&f.getOpacity(this.transform.pitch)!==0&&w.push("FOG"),a&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(a,f,w){this.cache=this.cache||{};const C=w||[],R=this.currentGlobalDefines().concat(C),I=Ql.cacheKey(a,R,f);return this.cache[I]||(this.cache[I]=new Ql(this.context,a,Kl[a],f,ri[a],R)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,f,w){if(this.terrain&&this.terrain.renderingToTexture)return;const C=this.style.fog;if(C){const R=C.getOpacity(this.transform.pitch);R!==0&&f.setFogUniformValues(a,((I,F,q,X)=>{const J=F.properties.get("color"),it=I.frameCounter/1e3%1,pt=[J.r/J.a,J.g/J.a,J.b/J.a,X];return{u_fog_matrix:q?I.transform.calculateFogTileMatrix(q):I.identityMat,u_fog_range:F.getFovAdjustedRange(I.transform._fov),u_fog_color:pt,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_temporal_offset:it}})(this,C,w,R))}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const a=this.context.gl,f=a.createTexture();return a.bindTexture(a.TEXTURE_2D,f),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&a.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const a=this._backgroundTiles,f=this._backgroundTiles={},w=this.transform.coveringTiles({tileSize:512});for(const C of w)f[C.key]=a[C.key]||new o.Tile(C,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}}class Es{constructor(a=0,f=0,w=0,C=0){if(isNaN(a)||a<0||isNaN(f)||f<0||isNaN(w)||w<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=f,this.left=w,this.right=C}interpolate(a,f,w){return f.top!=null&&a.top!=null&&(this.top=o.number(a.top,f.top,w)),f.bottom!=null&&a.bottom!=null&&(this.bottom=o.number(a.bottom,f.bottom,w)),f.left!=null&&a.left!=null&&(this.left=o.number(a.left,f.left,w)),f.right!=null&&a.right!=null&&(this.right=o.number(a.right,f.right,w)),this}getCenter(a,f){const w=o.clamp((this.left+a-this.right)/2,0,a),C=o.clamp((this.top+f-this.bottom)/2,0,f);return new o.pointGeometry(w,C)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Es(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function sy(v,a){const f=o.getColumn(v,3);o.fromQuat(v,a),o.setColumn(v,3,f)}function kp(v,a){const f=o.identity$1([]);return o.rotateZ$1(f,f,-a),o.rotateX$1(f,f,-v),f}function oh(v,a){const f=[v[0],v[1],0],w=[a[0],a[1],0];if(o.length(f)>=1e-15){const I=o.normalize([],f);o.scale$2(w,I,o.dot(w,I)),a[0]=w[0],a[1]=w[1]}const C=o.cross([],a,v);if(o.len(C)<1e-15)return null;const R=Math.atan2(-C[1],C[0]);return kp(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),R)}class rc{constructor(a,f){this.position=a,this.orientation=f}get position(){return this._position}set position(a){if(a){const f=a instanceof o.MercatorCoordinate?a:new o.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(f.x=o.wrap(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(a,f){if(this.orientation=null,!this.position)return;const w=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(a)):0,C=this.position,R=o.MercatorCoordinate.fromLngLat(a,w),I=[R.x-C.x,R.y-C.y,R.z-C.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=oh(I,f)}setPitchBearing(a,f){this.orientation=kp(o.degToRad(a),o.degToRad(-f))}}class oc{constructor(a,f){this._transform=o.identity([]),this.orientation=f,this.position=a}get mercatorPosition(){const a=this.position;return new o.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=o.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var f;a&&o.setColumn(this._transform,3,[(f=a)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||o.identity$1([]),a&&sy(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,f){this._orientation=kp(a,f),sy(this._transform,this._orientation)}forward(){const a=o.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=o.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=o.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,f){const w=new Float64Array(16);return o.invert(w,this.getWorldToCamera(a,f)),w}getWorldToCameraPosition(a,f,w){const C=this.position;o.scale$2(C,C,-a);const R=new Float64Array(16);return o.fromScaling(R,[w,w,w]),o.translate(R,R,C),R[10]*=f,R}getWorldToCamera(a,f){const w=new Float64Array(16),C=new Float64Array(4),R=this.position;return o.conjugate(C,this._orientation),o.scale$2(R,R,-a),o.fromQuat(w,C),o.translate(w,w,R),w[1]*=-1,w[5]*=-1,w[9]*=-1,w[13]*=-1,w[8]*=f,w[9]*=f,w[10]*=f,w[11]*=f,w}getCameraToClipPerspective(a,f,w,C){const R=new Float64Array(16);return o.perspective(R,a,f,w,C),R}getDistanceToElevation(a){const f=a===0?0:o.mercatorZfromAltitude(a,this.position[1]),w=this.forward();return(f-this.position[2])/w[2]}clone(){return new oc([...this.position],[...this.orientation])}}function Bp(v,a){const f=sc(v),w=function(R,I,F,q,X){const J=new o.LngLat(F.lng-180*Ts,F.lat),it=new o.LngLat(F.lng+180*Ts,F.lat),pt=R.project(J.lng,J.lat),gt=R.project(it.lng,it.lat),ft=-Math.atan2(gt.y-pt.y,gt.x-pt.x),ut=o.MercatorCoordinate.fromLngLat(F);ut.y=o.clamp(ut.y,-.999975,.999975);const Ft=ut.toLngLat(),Et=R.project(Ft.lng,Ft.lat),It=o.MercatorCoordinate.fromLngLat(Ft);It.x+=Ts;const Bt=It.toLngLat(),Ut=R.project(Bt.lng,Bt.lat),Rt=Np(Ut.x-Et.x,Ut.y-Et.y,ft),Ht=o.MercatorCoordinate.fromLngLat(Ft);Ht.y+=Ts;const re=Ht.toLngLat(),he=R.project(re.lng,re.lat),xe=Np(he.x-Et.x,he.y-Et.y,ft),ge=Math.abs(Rt.x)/Math.abs(xe.y),ze=o.identity([]);o.rotateZ(ze,ze,-ft*(1-(X?0:q)));const oe=o.identity([]);return o.scale(oe,oe,[1,1-(1-ge)*q,1]),oe[4]=-xe.x/xe.y*q,o.rotateZ(oe,oe,ft),o.multiply$1(oe,ze,oe),oe}(v.projection,0,v.center,f,a),C=Fp(v);return o.scale(w,w,[C,C,1]),w}function Fp(v){const a=v.projection,f=sc(v),w=zp(a,v.center),C=zp(a,o.LngLat.convert(a.center));return Math.pow(2,w*f+(1-f)*C)}function sc(v){const a=v.projection.range;if(!a)return 0;const f=Math.max(v.width,v.height),w=Math.log(f/1024)/Math.LN2;return o.smoothstep(a[0]+w,a[1]+w,v.zoom)}const Ts=1/4e4;function zp(v,a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),w=new o.LngLat(a.lng-180*Ts,f),C=new o.LngLat(a.lng+180*Ts,f),R=v.project(w.lng,f),I=v.project(C.lng,f),F=o.MercatorCoordinate.fromLngLat(w),q=o.MercatorCoordinate.fromLngLat(C),X=I.x-R.x,J=I.y-R.y,it=q.x-F.x,pt=q.y-F.y,gt=Math.sqrt((it*it+pt*pt)/(X*X+J*J));return Math.log(gt)/Math.LN2}function Np(v,a,f){const w=Math.cos(f),C=Math.sin(f);return{x:v*w-a*C,y:v*C+a*w}}class sh{constructor(a,f,w,C,R,I,F){this.tileSize=512,this._renderWorldCopies=R===void 0||R,this._minZoom=a||0,this._maxZoom=f||22,this._minPitch=w==null?0:w,this._maxPitch=C==null?60:C,this.setProjection(I),this.setMaxBounds(F),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Es,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new oc,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const a=new sh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(a||f)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(a){a==null&&(a={name:"mercator"}),this.projectionOptions=a;const f=this.projection?this.getProjection():void 0;this.projection=o.getProjection(a);const w=this.getProjection();return M(f,w)?null:(this._calcMatrices(),w)}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const f=-a*Math.PI/180;var w;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=(w=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(w[1]=0,w[2]=0),w[0]=1,w[3]=1,w),function(C,R,I){var F=R[0],q=R[1],X=R[2],J=R[3],it=Math.sin(I),pt=Math.cos(I);C[0]=F*pt+X*it,C[1]=q*pt+J*it,C[2]=F*-it+X*pt,C[3]=q*-it+J*pt}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const f=o.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const f=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],w=this.horizonLineFromTop();let C=0,R=0;for(let I=0;I<f.length;I++){const F=new o.pointGeometry(f[I][0]*this.width,w+f[I][1]*(this.height-w)),q=a.pointCoordinate(F);if(!q)continue;const X=1/Math.hypot(q[0]-this._camera.position[0],q[1]-this._camera.position[1]);C+=q[3]*X,R+=X}return R===0?NaN:C/R}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const a=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),w=this.pixelsPerMeter/this.worldSize*f,C=this._mercatorZfromZoom(a),R=this._mercatorZfromZoom(this._maxZoom),I=Math.max(C-w,R);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let w;w=a.z<this._camera.position[2]?[f.x,f.y,f.z]:[a.x,a.y,a.z];const C=o.length(o.sub([],this._camera.position,w));return o.clamp(this._zoomFromMercatorZ(C),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let f=!1;if(a.orientation&&!o.exactEquals(a.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(a.orientation)),a.position){const w=[a.position.x,a.position.y,a.position.z];o.exactEquals$1(w,this._camera.position)||(this._setCameraPosition(w),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,f=new rc;return f.position=new o.MercatorCoordinate(a[0],a[1],a[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(a){if(!o.length$1(a))return!1;o.normalize$1(a,a);const f=o.transformQuat([],[0,0,-1],a),w=o.transformQuat([],[0,-1,0],a);if(w[2]<0)return!1;const C=oh(f,w);return!!C&&(this._camera.orientation=C,!0)}_setCameraPosition(a){const f=this.zoomScale(this.minZoom)*this.tileSize,w=this.zoomScale(this.maxZoom)*this.tileSize,C=this.cameraToCenterDistance;a[2]=o.clamp(a[2],C/w,C/f),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,f,w){this._unmodified=!1,this._edgeInsets.interpolate(a,f,w),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const f=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(a){const f=[new o.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const w=this.pointCoordinate(new o.pointGeometry(0,0)),C=this.pointCoordinate(new o.pointGeometry(this.width,0)),R=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),I=this.pointCoordinate(new o.pointGeometry(0,this.height)),F=Math.floor(Math.min(w.x,C.x,R.x,I.x)),q=Math.floor(Math.max(w.x,C.x,R.x,I.x)),X=1;for(let J=F-X;J<=q+X;J++)J!==0&&f.push(new o.UnwrappedTileID(J,a))}return f}coveringTiles(a){let f=this.coveringZoomLevel(a);const w=f,C=this.elevation&&!a.isTerrainDEM,R=this.projection.name==="mercator";if(a.minzoom!==void 0&&f<a.minzoom)return[];a.maxzoom!==void 0&&f>a.maxzoom&&(f=a.maxzoom);const I=this.locationCoordinate(this.center),F=this.center.lat,q=1<<f,X=[q*I.x,q*I.y,0],J=this.projection.name==="globe",it=!J,pt=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,it),gt=J?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ft=q*o.mercatorZfromAltitude(1,this.center.lat),ut=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),Ft=[q*gt.x,q*gt.y,ut*(it?1:ft)],Et=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),It=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?f:0,Bt=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ut=a.isTerrainDEM?-Bt:this._elevation?this._elevation.getMinElevationBelowMSL():0,Rt=this.projection.isReprojectedInTileSpace?Fp(this):1,Ht=ve=>{const _n=new o.MercatorCoordinate(ve.x+25e-6,ve.y,ve.z),Qe=new o.MercatorCoordinate(ve.x,ve.y+25e-6,ve.z),$e=ve.toLngLat(),An=_n.toLngLat(),Un=Qe.toLngLat(),gn=this.locationCoordinate($e),Pn=this.locationCoordinate(An),Zn=this.locationCoordinate(Un),Ei=Math.hypot(Pn.x-gn.x,Pn.y-gn.y),cr=Math.hypot(Zn.x-gn.x,Zn.y-gn.y);return Math.sqrt(Ei*cr)*Rt/25e-6},re=ve=>{const Ze=Bt,_n=Ut;return{aabb:o.tileAABB(this,q,0,0,0,ve,_n,Ze,this.projection),zoom:0,x:0,y:0,minZ:_n,maxZ:Ze,wrap:ve,fullyVisible:!1}},he=[];let xe=[];const ge=f,ze=a.reparseOverscaled?w:f,oe=ve=>ve*ve,Ne=oe((ut-this._centerAltitude)*ft),Ie=ve=>{if(!this._elevation||!ve.tileID||!R)return;const Ze=this._elevation.getMinMaxForTile(ve.tileID),_n=ve.aabb;Ze?(_n.min[2]=Ze.min,_n.max[2]=Ze.max,_n.center[2]=(_n.min[2]+_n.max[2])/2):(ve.shouldSplit=en(ve),ve.shouldSplit||(_n.min[2]=_n.max[2]=_n.center[2]=this._centerAltitude))},en=ve=>{if(ve.zoom<It)return!0;if(ve.zoom===ge)return!1;if(ve.shouldSplit!=null)return ve.shouldSplit;const Ze=ve.aabb.distanceX(Ft),_n=ve.aabb.distanceY(Ft);let Qe=Ne,$e=1;if(J){Qe=oe(ve.aabb.distanceZ(Ft));const Un=Math.pow(2,ve.zoom),gn=o.latFromMercatorY((ve.y+1)/Un),Pn=o.latFromMercatorY(ve.y/Un),Zn=Math.min(Math.max(F,gn),Pn),Ei=o.circumferenceAtLatitude(Zn)/o.circumferenceAtLatitude(F);$e=Math.min(Ei,1)}else if(C&&(Qe=oe(ve.aabb.distanceZ(Ft)*ft)),this.projection.isReprojectedInTileSpace&&w<=5){const Un=Math.pow(2,ve.zoom),gn=Ht(new o.MercatorCoordinate((ve.x+.5)/Un,(ve.y+.5)/Un));$e=gn>.85?1:gn}const An=Ze*Ze+_n*_n+Qe;return An<oe((1<<ge-ve.zoom)*Et*$e*((Un,gn)=>{if(gn*oe(.707)<Un)return 1;const Pn=Math.sqrt(gn/Un);return Pn/(1.4144271570014144+(Math.pow(1.1,Pn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Qe,Ne),An))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)he.push(re(-ve)),he.push(re(ve));for(he.push(re(0));he.length>0;){const ve=he.pop(),Ze=ve.x,_n=ve.y;let Qe=ve.fullyVisible;if(!Qe){const $e=ve.aabb.intersects(pt);if($e===0)continue;Qe=$e===2}if(ve.zoom!==ge&&en(ve))for(let $e=0;$e<4;$e++){const An=(Ze<<1)+$e%2,Un=(_n<<1)+($e>>1),gn={aabb:R?ve.aabb.quadrant($e):o.tileAABB(this,q,ve.zoom+1,An,Un,ve.wrap,ve.minZ,ve.maxZ,this.projection),zoom:ve.zoom+1,x:An,y:Un,wrap:ve.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:ve.minZ,maxZ:ve.maxZ};C&&!J&&(gn.tileID=new o.OverscaledTileID(ve.zoom+1===ge?ze:ve.zoom+1,ve.wrap,ve.zoom+1,An,Un),Ie(gn)),he.push(gn)}else{const $e=ve.zoom===ge?ze:ve.zoom;if(a.minzoom&&a.minzoom>$e)continue;const An=X[0]-(.5+Ze+(ve.wrap<<ve.zoom))*(1<<f-ve.zoom),Un=X[1]-.5-_n,gn=ve.tileID?ve.tileID:new o.OverscaledTileID($e,ve.wrap,ve.zoom,Ze,_n);xe.push({tileID:gn,distanceSq:An*An+Un*Un})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Ze=this.horizonLineFromTop();xe=xe.filter(_n=>{const Qe=[0,0,0,1],$e=[o.EXTENT,o.EXTENT,0,1],An=this.calculateFogTileMatrix(_n.tileID.toUnwrapped());o.transformMat4$1(Qe,Qe,An),o.transformMat4$1($e,$e,An);const Un=o.getAABBPointSquareDist(Qe,$e);if(Un===0)return!0;let gn=!1;const Pn=this._elevation;if(Pn&&Un>ve&&Ze!==0){const Zn=this.calculateProjMatrix(_n.tileID.toUnwrapped());let Ei;a.isTerrainDEM||(Ei=Pn.getMinMaxForTile(_n.tileID)),Ei||(Ei={min:Ut,max:Bt});const cr=o.furthestTileCorner(this.rotation),ur=[cr[0]*o.EXTENT,cr[1]*o.EXTENT,Ei.max];o.transformMat4(ur,ur,Zn),gn=(1-ur[1])*this.height*.5<Ze}return Un<ve||gn})}return xe.sort((ve,Ze)=>ve.distanceSq-Ze.distanceSq).map(ve=>ve.tileID)}resize(a,f){this.width=a,this.height=f,this.pixelsToGLUnits=[2/a,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const f=o.clamp(a.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),w=this.projection.project(a.lng,f);return new o.pointGeometry(w.x*this.worldSize,w.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(a,f){let w,C;const R=this.centerPoint;if(this.projection.name==="globe"){const F=this.worldSize;w=(f.x-R.x)/F,C=(f.y-R.y)/F}else{const F=this.pointCoordinate(f),q=this.pointCoordinate(R);w=F.x-q.x,C=F.y-q.y}const I=this.locationCoordinate(a);this.setLocation(new o.MercatorCoordinate(I.x-w,I.y-C))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this._coordinatePoint(this.locationCoordinate(a),!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,f){const w=f?o.mercatorZfromAltitude(f,a.lat):void 0,C=this.projection.project(a.lng,a.lat);return new o.MercatorCoordinate(C.x,C.y,w)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,f){const w=f!=null?f:this._centerAltitude,C=[a.x,a.y,0,1],R=[a.x,a.y,1,1];o.transformMat4$1(C,C,this.pixelMatrixInverse),o.transformMat4$1(R,R,this.pixelMatrixInverse);const I=R[3];o.scale$1(C,C,1/C[3]),o.scale$1(R,R,1/I);const F=C[2],q=R[2];return{p0:C,p1:R,t:F===q?0:(w-F)/(q-F)}}screenPointToMercatorRay(a){const f=[a.x,a.y,0,1],w=[a.x,a.y,1,1];return o.transformMat4$1(f,f,this.pixelMatrixInverse),o.transformMat4$1(w,w,this.pixelMatrixInverse),o.scale$1(f,f,1/f[3]),o.scale$1(w,w,1/w[3]),f[2]=o.mercatorZfromAltitude(f[2],this._center.lat)*this.worldSize,w[2]=o.mercatorZfromAltitude(w[2],this._center.lat)*this.worldSize,o.scale$1(f,f,1/this.worldSize),o.scale$1(w,w,1/this.worldSize),new o.Ray([f[0],f[1],f[2]],o.normalize([],o.sub([],w,f)))}rayIntersectionCoordinate(a){const{p0:f,p1:w,t:C}=a,R=o.mercatorZfromAltitude(f[2],this._center.lat),I=o.mercatorZfromAltitude(w[2],this._center.lat);return new o.MercatorCoordinate(o.number(f[0],w[0],C)/this.worldSize,o.number(f[1],w[1],C)/this.worldSize,o.number(R,I,C))}pointCoordinate(a,f=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,f)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);const f=this.elevation;let w=this.elevation.pointCoordinate(a);if(w)return new o.MercatorCoordinate(w[0],w[1],w[2]);let C=0,R=this.horizonLineFromTop();if(a.y>R)return this.pointCoordinate(a);const I=.02*R,F=a.clone();for(let q=0;q<10&&R-C>I;q++){F.y=o.number(C,R,.66);const X=f.pointCoordinate(F);X?(R=F.y,w=X):C=F.y}return w?new o.MercatorCoordinate(w[0],w[1],w[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){if(this.elevation)return!this.elevation.pointCoordinate(a);{const f=this.horizonLineFromTop();return a.y<f}}_coordinatePoint(a,f){const w=f&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,C=[a.x*this.worldSize,a.y*this.worldSize,w+a.toAltitude(),1];return o.transformMat4$1(C,C,this.pixelMatrix),C[3]>0?new o.pointGeometry(C[0]/C[3],C[1]/C[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(a,f){const w=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),C=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),R=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),I=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let F=this.pointCoordinate(w,a),q=this.pointCoordinate(C,a);const X=this.pointCoordinate(R,f),J=this.pointCoordinate(I,f),it=(pt,gt)=>(gt.y-pt.y)/(gt.x-pt.x);return F.y>1&&q.y>=0?F=new o.MercatorCoordinate((1-J.y)/it(J,F)+J.x,1):F.y<0&&q.y<=1&&(F=new o.MercatorCoordinate(-J.y/it(J,F)+J.x,0)),q.y>1&&F.y>=0?q=new o.MercatorCoordinate((1-X.y)/it(X,q)+X.x,1):q.y<0&&F.y<=1&&(q=new o.MercatorCoordinate(-X.y/it(X,q)+X.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(X))}_getBounds3D(){const a=this.elevation;if(!a.visibleDemTiles.length)return this._getBounds(0,0);const f=a.visibleDemTiles.reduce((w,C)=>{if(C.dem){const R=C.dem.tree;w.min=Math.min(w.min,R.minimums[0]),w.max=Math.max(w.max,R.maximums[0])}return w},{min:Number.MAX_VALUE,max:0});return this._getBounds(f.min*a.exaggeration(),f.max*a.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(a=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,w=this.height/2-f*(1-this._horizonShift);return a?Math.max(0,w):w}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,f){return this.projection.createTileMatrix(this,f,a)}calculateDistanceTileData(a){const f=a.key,w=this._distanceTileDataCache;if(w[f])return w[f];const C=a.canonical,R=1/this.height,I=this.cameraWorldSize/this.zoomScale(C.z),F=(C.x+Math.pow(2,C.z)*a.wrap)*I,q=C.y*I,X=this.point,J=this.angle,it=Math.sin(-J),pt=-Math.cos(-J);return w[f]={bearing:[it,pt],center:[(X.x-F)*R,(X.y-q)*R],scale:I/o.EXTENT*R},w[f]}calculateFogTileMatrix(a){const f=a.key,w=this._fogTileMatrixCache;if(w[f])return w[f];const C=this.calculatePosMatrix(a,this.cameraWorldSize);return o.multiply$1(C,this.worldToFogMatrix,C),w[f]=new Float32Array(C),w[f]}calculateProjMatrix(a,f=!1){const w=a.key,C=f?this._alignedProjMatrixCache:this._projMatrixCache;if(C[w])return C[w];const R=this.calculatePosMatrix(a,this.worldSize);return o.multiply$1(R,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.alignedProjMatrix:this.projMatrix,R),C[w]=new Float32Array(R),C[w]}calculatePixelsToTileUnitsMatrix(a){const f=a.tileID.key,w=this._pixelsToTileUnitsCache;if(w[f])return w[f];const C=function(R,I){const{scale:F}=R.tileTransform,q=F*o.EXTENT/(R.tileSize*Math.pow(2,I.zoom-R.tileID.overscaledZ+R.tileID.canonical.z));return X=new Float32Array(4),pt=(J=I.inverseAdjustmentMatrix)[1],gt=J[2],ft=J[3],Ft=(it=[q,q])[1],X[0]=J[0]*(ut=it[0]),X[1]=pt*ut,X[2]=gt*Ft,X[3]=ft*Ft,X;var X,J,it,pt,gt,ft,ut,Ft}(a,this);return w[f]=C,w[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const f=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(f),C=this._camera.forward(),R=o.mercatorZfromAltitude(1,this._center.lat);w[2]/=R,C[2]/=R,o.normalize(C,C);const I=a.raycast(w,C,a.exaggeration());if(I){const F=o.scaleAndAdd([],w,C,I),q=new o.MercatorCoordinate(F[0],F[1],o.mercatorZfromAltitude(F[2],o.latFromMercatorY(F[1]))),X=(q.z+o.length([q.x-w[0],q.y-w[1],q.z-w[2]*R]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(X),this._centerAltitude=q.toAltitude(),this._center=this.coordinateLocation(q),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const a=this._elevation;this._updateCameraState();const f=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(f),C=a.getAtPointOrZero(new o.MercatorCoordinate(...w)),R=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),I=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*C;if(I<R){const F=this.locationCoordinate(this._center,this._centerAltitude),q=[F.x-w[0],F.y-w[1],F.z-w[2]],X=o.length(q);q[2]-=(R-I)/this._projectionScaler;const J=o.length(q);if(J===0)return;o.scale$2(q,q,X/J*this._projectionScaler),this._camera.position=[F.x-q[0],F.y-q[1],F.z*this._projectionScaler-q[2]],this._camera.orientation=oh(q,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const it=this.center;return it.lat=o.clamp(it.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(it.lng=o.clamp(it.lng,this.minLng,this.maxLng)),this.center=it,void(this._constraining=!1)}const a=this._unmodified,{x:f,y:w}=this.point;let C=0,R=f,I=w;const F=this.width/2,q=this.height/2,X=this.worldMinY*this.scale,J=this.worldMaxY*this.scale;if(w-q<X&&(I=X+q),w+q>J&&(I=J-q),J-X<this.height&&(C=Math.max(C,this.height/(J-X)),I=(J+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const it=this.worldMinX*this.scale,pt=this.worldMaxX*this.scale,gt=this.worldSize/2-(it+pt)/2;R=(f+gt+this.worldSize)%this.worldSize-gt,R-F<it&&(R=it+F),R+F>pt&&(R=pt-F),pt-it<this.width&&(C=Math.max(C,this.width/(pt-it)),R=(pt+it)/2)}R===f&&I===w||(this.center=this.unproject(new o.pointGeometry(R,I))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCameraAltitude(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this._fov/2,f=this.centerOffset,w=this.pixelsPerMeter;this._projectionScaler=w/(o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(a)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const C=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?w:1),R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);R[8]=2*-f.x/this.width,R[9]=2*f.y/this.height;let I=o.mul([],R,C);if(this.projection.isReprojectedInTileSpace){const Ut=this.locationCoordinate(this.center),Rt=o.identity([]);o.translate(Rt,Rt,[Ut.x*this.worldSize,Ut.y*this.worldSize,0]),o.multiply$1(Rt,Rt,Bp(this)),o.translate(Rt,Rt,[-Ut.x*this.worldSize,-Ut.y*this.worldSize,0]),o.multiply$1(I,I,Rt),this.inverseAdjustmentMatrix=function(Ht){const re=Bp(Ht,!0);return tt([],[re[0],re[1],re[4],re[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],I,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=I,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const F=new Float32Array(16);o.identity(F),o.scale(F,F,[1,-1,1]),o.rotateX(F,F,this._pitch),o.rotateZ(F,F,this.angle);const q=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-f.x/this.width,q[9]=2*(f.y+X)/this.height,this.skyboxMatrix=o.multiply$1(F,q,F);const J=this.point,it=J.x,pt=J.y,gt=this.width%2/2,ft=this.height%2/2,ut=Math.cos(this.angle),Ft=Math.sin(this.angle),Et=it-Math.round(it)+ut*gt+Ft*ft,It=pt-Math.round(pt)+ut*ft+Ft*gt,Bt=new Float64Array(I);if(o.translate(Bt,Bt,[Et>.5?Et-1:Et,It>.5?It-1:It,0]),this.alignedProjMatrix=Bt,I=o.create(),o.scale(I,I,[this.width/2,-this.height/2,1]),o.translate(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.create(),o.scale(I,I,[1,-1,1]),o.translate(I,I,[-1,-1,0]),o.scale(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.invert(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this.globeMatrix=this.projection.name==="globe"?o.calculateGlobeMatrix(this):I,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSize,f=this.cameraPixelsPerMeter,w=this._camera.position,C=1/this.height,R=[a,a,f];o.scale$2(R,R,C),o.scale$2(w,w,-1),o.multiply$2(w,w,R);const I=o.create();o.translate(I,I,w),o.scale(I,I,R),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,f,C)}_computeCameraPosition(a){const f=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,w=this._camera.forward(),C=this.point,R=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-a/this.worldSize*this._centerAltitude;return[C.x/this.worldSize-w[0]*R,C.y/this.worldSize-w[1]*R,a/this.worldSize*this._centerAltitude-w[2]*R]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),w=a[2];let C=1;w>0&&(C=Math.min((f-this._camera.position[2])/w,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,a,C),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const a=this._camera.position,f=this._camera.forward(),{pitch:w,bearing:C}=this._camera.getPitchBearing(),R=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),F=Math.max((a[2]-R)/Math.cos(w),I),q=this._zoomFromMercatorZ(F);o.scaleAndAdd(a,a,f,F),this._pitch=o.clamp(w,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(C,-Math.PI,Math.PI),this._setZoom(o.clamp(q,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(a,f){const w=Math.min(a.x,f.x),C=Math.max(a.x,f.x),R=Math.min(a.y,f.y),I=Math.max(a.y,f.y);if(R<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const F=[new o.pointGeometry(w,R),new o.pointGeometry(C,I),new o.pointGeometry(w,I),new o.pointGeometry(C,R)],q=this.renderWorldCopies?-3:0,X=this.renderWorldCopies?4:1;for(const J of F){const it=this.pointRayIntersection(J);if(it.t<0)return!0;const pt=this.rayIntersectionCoordinate(it);if(pt.x<q||pt.y<0||pt.x>X||pt.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(a,f){const w=o.length(o.sub([],this._camera.position,a)),C=this._zoomFromMercatorZ(w)+f;return w-this._mercatorZfromZoom(C)}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,a))}}function Up(v,a){let f=!1,w=null;const C=()=>{w=null,f&&(v(),w=setTimeout(C,a),f=!1)};return()=>(f=!0,w||C(),w)}class ay{constructor(a){this._hashName=a&&encodeURIComponent(a),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Up(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,o.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(a){const f=this._map;if(!f)return"";const w=f.getCenter(),C=Math.round(100*f.getZoom())/100,R=Math.ceil((C*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,R),F=Math.round(w.lng*I)/I,q=Math.round(w.lat*I)/I,X=f.getBearing(),J=f.getPitch();let it="";if(it+=a?`/${F}/${q}/${C}`:`${C}/${q}/${F}`,(X||J)&&(it+="/"+Math.round(10*X)/10),J&&(it+=`/${Math.round(J)}`),this._hashName){const pt=this._hashName;let gt=!1;const ft=o.window.location.hash.slice(1).split("&").map(ut=>{const Ft=ut.split("=")[0];return Ft===pt?(gt=!0,`${Ft}=${it}`):ut}).filter(ut=>ut);return gt||ft.push(`${pt}=${it}`),`#${ft.join("&")}`}return`#${it}`}_getCurrentHash(){const a=o.window.location.hash.replace("#","");if(this._hashName){let f;return a.split("&").map(w=>w.split("=")).forEach(w=>{w[0]===this._hashName&&(f=w)}),(f&&f[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(w=>isNaN(w))){const w=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(f[3]||0):a.getBearing();return a.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:w,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,a)}}const Qo={linearity:.3,easing:o.bezier(0,0,.3,1)},ly=o.extend({deceleration:2500,maxSpeed:1400},Qo),cy=o.extend({deceleration:20,maxSpeed:1400},Qo),uy=o.extend({deceleration:1e3,maxSpeed:360},Qo),hy=o.extend({deceleration:1e3,maxSpeed:90},Qo);class dy{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,f=o.exported.now();for(;a.length>0&&f-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:R}of this._inertiaBuffer)f.zoom+=R.zoomDelta||0,f.bearing+=R.bearingDelta||0,f.pitch+=R.pitchDelta||0,R.panDelta&&f.pan._add(R.panDelta),R.around&&(f.around=R.around),R.pinchAround&&(f.pinchAround=R.pinchAround);const w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(f.pan.mag()){const R=Qi(f.pan.mag(),w,o.extend({},ly,a||{}));C.offset=f.pan.mult(R.amount/f.pan.mag()),C.center=this._map.transform.center,ac(C,R)}if(f.zoom){const R=Qi(f.zoom,w,cy);C.zoom=this._map.transform.zoom+R.amount,ac(C,R)}if(f.bearing){const R=Qi(f.bearing,w,uy);C.bearing=this._map.transform.bearing+o.clamp(R.amount,-179,179),ac(C,R)}if(f.pitch){const R=Qi(f.pitch,w,hy);C.pitch=this._map.transform.pitch+R.amount,ac(C,R)}if(C.zoom||C.bearing){const R=f.pinchAround===void 0?f.around:f.pinchAround;C.around=R?this._map.unproject(R):this._map.getCenter()}return this.clear(),C.noMoveStart=!0,C}}function ac(v,a){(!v.duration||v.duration<a.duration)&&(v.duration=a.duration,v.easing=a.easing)}function Qi(v,a,f){const{maxSpeed:w,linearity:C,deceleration:R}=f,I=o.clamp(v*C/(a/1e3),-w,w),F=Math.abs(I)/(R*C);return{easing:f.easing,duration:1e3*F,amount:I*(F/2)}}class Nr extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,w,C={}){const R=V(f.getCanvasContainer(),w),I=f.unproject(R);super(a,o.extend({point:R,lngLat:I,originalEvent:w},C)),this._defaultPrevented=!1,this.target=f}}class lc extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,w){const C=a==="touchend"?w.changedTouches:w.touches,R=W(f.getCanvasContainer(),C),I=R.map(q=>f.unproject(q)),F=R.reduce((q,X,J,it)=>q.add(X.div(it.length)),new o.pointGeometry(0,0));super(a,{points:R,point:F,lngLats:I,lngLat:f.unproject(F),originalEvent:w}),this._defaultPrevented=!1}}class O1 extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,f,w){super(a,{originalEvent:w}),this._defaultPrevented=!1}}class j1{constructor(a,f){this._map=a,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new O1(a.type,this._map,a))}mousedown(a,f){return this._mousedownPos=f,this._firePreventable(new Nr(a.type,this._map,a))}mouseup(a){this._map.fire(new Nr(a.type,this._map,a))}preclick(a){const f=o.extend({},a);f.type="preclick",this._map.fire(new Nr(f.type,this._map,f))}click(a,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Nr(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Nr(a.type,this._map,a))}mouseover(a){this._map.fire(new Nr(a.type,this._map,a))}mouseout(a){this._map.fire(new Nr(a.type,this._map,a))}touchstart(a){return this._firePreventable(new lc(a.type,this._map,a))}touchmove(a){this._map.fire(new lc(a.type,this._map,a))}touchend(a){this._map.fire(new lc(a.type,this._map,a))}touchcancel(a){this._map.fire(new lc(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $o{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Nr(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Nr(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class py{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,f){this.isEnabled()&&a.shiftKey&&a.button===0&&(z(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(a,f){if(!this._active)return;const w=f;if(this._lastPos.equals(w)||!this._box&&w.dist(this._startPos)<this._clickTolerance)return;const C=this._startPos;this._lastPos=w,this._box||(this._box=A("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const R=Math.min(C.x,w.x),I=Math.max(C.x,w.x),F=Math.min(C.y,w.y),q=Math.max(C.y,w.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${R}px,${F}px)`,this._box.style.width=I-R+"px",this._box.style.height=q-F+"px")})}mouseupWindow(a,f){if(!this._active||a.button!==0)return;const w=this._startPos,C=f;if(this.reset(),H(),w.x!==C.x||w.y!==C.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:R=>R.fitScreenCoordinates(w,C,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),O(),delete this._startPos,delete this._lastPos}_fireEvent(a,f){return this._map.fire(new o.Event(a,{originalEvent:f}))}}function Ps(v,a){const f={};for(let w=0;w<v.length;w++)f[v[w].identifier]=a[w];return f}class Io{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,f,w){(this.centroid||w.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=a.timeStamp),w.length===this.numTouches&&(this.centroid=function(C){const R=new o.pointGeometry(0,0);for(const I of C)R._add(I);return R.div(C.length)}(f),this.touches=Ps(w,f)))}touchmove(a,f,w){if(this.aborted||!this.centroid)return;const C=Ps(w,f);for(const R in this.touches){const I=this.touches[R],F=C[R];(!F||F.dist(I)>30)&&(this.aborted=!0)}}touchend(a,f,w){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),w.length===0){const C=!this.aborted&&this.centroid;if(this.reset(),C)return C}}}class Za{constructor(a){this.singleTap=new Io(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,f,w){this.singleTap.touchstart(a,f,w)}touchmove(a,f,w){this.singleTap.touchmove(a,f,w)}touchend(a,f,w){const C=this.singleTap.touchend(a,f,w);if(C){const R=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(C)<30;if(R&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}}}class Ke{constructor(){this._zoomIn=new Za({numTouches:1,numTaps:2}),this._zoomOut=new Za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,f,w){this._zoomIn.touchstart(a,f,w),this._zoomOut.touchstart(a,f,w)}touchmove(a,f,w){this._zoomIn.touchmove(a,f,w),this._zoomOut.touchmove(a,f,w)}touchend(a,f,w){const C=this._zoomIn.touchend(a,f,w),R=this._zoomOut.touchend(a,f,w);return C?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(C)},{originalEvent:a})}):R?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(R)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const fy={0:1,2:2};class ah{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,f){return!1}_move(a,f){return{}}mousedown(a,f){if(this._lastPoint)return;const w=K(a);this._correctButton(a,w)&&(this._lastPoint=f,this._eventButton=w)}mousemoveWindow(a,f){const w=this._lastPoint;if(w){if(a.preventDefault(),this._eventButton!=null&&function(C,R){const I=fy[R];return C.buttons===void 0||(C.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(f.dist(w)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(w,f)}}mouseupWindow(a){this._lastPoint&&K(a)===this._eventButton&&(this._moved&&H(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cc extends ah{mousedown(a,f){super.mousedown(a,f),this._lastPoint&&(this._active=!0)}_correctButton(a,f){return f===0&&!a.ctrlKey}_move(a,f){return{around:f,panDelta:f.sub(a)}}}class Ja extends ah{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const w=.8*(f.x-a.x);if(w)return this._active=!0,{bearingDelta:w}}contextmenu(a){a.preventDefault()}}class Vp extends ah{_correctButton(a,f){return f===0&&a.ctrlKey||f===2}_move(a,f){const w=-.5*(f.y-a.y);if(w)return this._active=!0,{pitchDelta:w}}contextmenu(a){a.preventDefault()}}class my{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(a,f,w){return this._calculateTransform(a,f,w)}touchmove(a,f,w){if(this._active&&!(w.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(w.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.preventDefault(),this._calculateTransform(a,f,w)}}touchend(a,f,w){this._calculateTransform(a,f,w),this._active&&w.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,f,w){w.length>0&&(this._active=!0);const C=Ps(w,f),R=new o.pointGeometry(0,0),I=new o.pointGeometry(0,0);let F=0;for(const X in C){const J=C[X],it=this._touches[X];it&&(R._add(J),I._add(J.sub(it)),F++,C[X]=J)}if(this._touches=C,F<this._minTouches||!I.mag())return;const q=I.div(F);return this._sum._add(q),this._sum.mag()<this._clickTolerance?void 0:{around:R.div(F),panDelta:q}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=A("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class lh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,f,w){return{}}touchstart(a,f,w){this._firstTwoTouches||w.length<2||(this._firstTwoTouches=[w[0].identifier,w[1].identifier],this._start([f[0],f[1]]))}touchmove(a,f,w){const C=this._firstTwoTouches;if(!C)return;a.preventDefault();const[R,I]=C,F=uc(w,f,R),q=uc(w,f,I);if(!F||!q)return;const X=this._aroundCenter?null:F.add(q).div(2);return this._move([F,q],X,a)}touchend(a,f,w){if(!this._firstTwoTouches)return;const[C,R]=this._firstTwoTouches,I=uc(w,f,C),F=uc(w,f,R);I&&F||(this._active&&H(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function uc(v,a,f){for(let w=0;w<v.length;w++)if(v[w].identifier===f)return a[w]}function Gp(v,a){return Math.log(v/a)/Math.LN2}class gy extends lh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,f){const w=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Gp(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gp(this._distance,w),pinchAround:f}}}function Op(v,a){return 180*v.angleWith(a)/Math.PI}class ch extends lh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,f){const w=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Op(this._vector,w),pinchAround:f}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const f=25/(Math.PI*this._minDiameter)*360,w=Op(a,this._startVector);return Math.abs(w)<f}}function hc(v){return Math.abs(v.y)>Math.abs(v.x)}class uh extends lh{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,hc(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,f,w){const C=this._lastPoints;if(!C)return;const R=a[0].sub(C[0]),I=a[1].sub(C[1]);return this._map._cooperativeGestures&&w.touches.length<3||(this._valid=this.gestureBeginsVertically(R,I,w.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(R.y+I.y)/2*-.5})}gestureBeginsVertically(a,f,w){if(this._valid!==void 0)return this._valid;const C=a.mag()>=2,R=f.mag()>=2;if(!C&&!R)return;if(!C||!R)return this._firstMove==null&&(this._firstMove=w),w-this._firstMove<100&&void 0;const I=a.y>0==f.y>0;return hc(a)&&hc(f)&&I}}const yy={panStep:100,bearingStep:15,pitchStep:10};class xy{constructor(){const a=yy;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let f=0,w=0,C=0,R=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:a.shiftKey?w=-1:(a.preventDefault(),R=-1);break;case 39:a.shiftKey?w=1:(a.preventDefault(),R=1);break;case 38:a.shiftKey?C=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?C=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(w=0,C=0),{cameraAnimation:F=>{const q=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:vy,zoom:f?Math.round(q)+f*(a.shiftKey?2:1):q,bearing:F.getBearing()+w*this._bearingStep,pitch:F.getPitch()+C*this._pitchStep,offset:[-R*this._panStep,-I*this._panStep],center:F.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vy(v){return v*(2-v)}const jp=4.000244140625;class _y{constructor(a,f){this._map=a,this._el=a.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=a.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const w=o.exported.now(),C=w-(this._lastWheelEventTime||0);this._lastWheelEventTime=w,f!==0&&f%jp==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(C*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),a.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=a,this._delta-=f,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=V(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform,f=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(this._delta!==0){const q=this._type==="wheel"&&Math.abs(this._delta)>jp?this._wheelZoomRate:this._defaultZoomRate;let X=2/(1+Math.exp(-Math.abs(this._delta*q)));this._delta<0&&X!==0&&(X=1/X);const J=f(),it=Math.pow(2,J),pt=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):it;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(pt*X))),this._type==="wheel"&&(this._startZoom=f(),this._easing=this._smoothOutEasing(200)),this._delta=0}const w=typeof this._targetZoom=="number"?this._targetZoom:f(),C=this._startZoom,R=this._easing;let I,F=!1;if(this._type==="wheel"&&C&&R){const q=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),X=R(q);I=o.number(C,w,X),q<1?this._frameId||(this._frameId=!0):F=!0}else I=w,F=!0;return this._active=!0,F&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!F,zoomDelta:I-f(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let f=o.ease;if(this._prevEase){const w=this._prevEase,C=(o.exported.now()-w.start)/w.duration,R=w.easing(C+.01)-w.easing(C),I=.27/Math.sqrt(R*R+1e-4)*.01,F=Math.sqrt(.0729-I*I);f=o.bezier(I,F,.25,1)}return this._prevEase={start:o.exported.now(),duration:a,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=A("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class by{constructor(a,f){this._clickZoom=a,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class My{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,f){return a.preventDefault(),{cameraAnimation:w=>{w.easeTo({duration:300,zoom:w.getZoom()+(a.shiftKey?-1:1),around:w.unproject(f)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hp{constructor(){this._tap=new Za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,f,w){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?w.length>0&&(this._swipePoint=f[0],this._swipeTouch=w[0].identifier):this._tap.touchstart(a,f,w))}touchmove(a,f,w){if(this._tapTime){if(this._swipePoint){if(w[0].identifier!==this._swipeTouch)return;const C=f[0],R=C.y-this._swipePoint.y;return this._swipePoint=C,a.preventDefault(),this._active=!0,{zoomDelta:R/128}}}else this._tap.touchmove(a,f,w)}touchend(a,f,w){this._tapTime?this._swipePoint&&w.length===0&&this.reset():this._tap.touchend(a,f,w)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wy{constructor(a,f,w){this._el=a,this._mousePan=f,this._touchPan=w}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ay{constructor(a,f,w){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=f,this._mousePitch=w}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ey{constructor(a,f,w,C){this._el=a,this._touchZoom=f,this._touchRotate=w,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const dc=v=>v.zoom||v.drag||v.pitch||v.rotate;class Wp extends o.Event{}class Ty{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,f){const w=o.sub([],f,a);this.radius=o.length(w[2]<0?o.div([],w,this.constants):[w[0],w[1],0])}projectRay(a){o.div(a,a,this.constants),o.normalize(a,a),o.mul$1(a,a,this.constants);const f=o.scale$2([],a,this.radius);if(f[2]>0){const w=o.scale$2([],[0,0,1],o.dot(f,[0,0,1])),C=o.scale$2([],o.normalize([],[f[0],f[1],0]),this.radius),R=o.add([],f,o.scale$2([],o.sub([],o.add([],C,w),f),2));f[0]=R[0],f[1]=R[1]}return f}}function Qa(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Py{constructor(a,f){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dy(a),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ty,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),o.bindAll(["handleEvent","handleWindowEvent"],this);const w=this._el;this._listeners=[[w,"touchstart",{passive:!0}],[w,"touchmove",{passive:!1}],[w,"touchend",void 0],[w,"touchcancel",void 0],[w,"mousedown",void 0],[w,"mousemove",void 0],[w,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[w,"mouseover",void 0],[w,"mouseout",void 0],[w,"dblclick",void 0],[w,"click",void 0],[w,"keydown",{capture:!1}],[w,"keyup",void 0],[w,"wheel",{passive:!1}],[w,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[C,R,I]of this._listeners)C.addEventListener(R,C===o.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,f,w]of this._listeners)a.removeEventListener(f,a===o.window.document?this.handleWindowEvent:this.handleEvent,w)}_addDefaultHandlers(a){const f=this._map,w=f.getCanvasContainer();this._add("mapEvent",new j1(f,a));const C=f.boxZoom=new py(f,a);this._add("boxZoom",C);const R=new Ke,I=new My;f.doubleClickZoom=new by(I,R),this._add("tapZoom",R),this._add("clickZoom",I);const F=new Hp;this._add("tapDragZoom",F);const q=f.touchPitch=new uh(f);this._add("touchPitch",q);const X=new Ja(a),J=new Vp(a);f.dragRotate=new Ay(a,X,J),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);const it=new cc(a),pt=new my(f,a);f.dragPan=new wy(w,it,pt),this._add("mousePan",it),this._add("touchPan",pt,["touchZoom","touchRotate"]);const gt=new ch,ft=new gy;f.touchZoomRotate=new Ey(w,ft,gt,F),this._add("touchRotate",gt,["touchPan","touchZoom"]),this._add("touchZoom",ft,["touchPan","touchRotate"]),this._add("blockableMapEvent",new $o(f));const ut=f.scrollZoom=new _y(f,this);this._add("scrollZoom",ut,["mousePan"]);const Ft=f.keyboard=new xy;this._add("keyboard",Ft);for(const Et of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[Et]&&f[Et].enable(a[Et])}_add(a,f,w){this._handlers.push({handlerName:a,handler:f,allowed:w}),this._handlersById[a]=f}stop(a){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dc(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,f,w){for(const C in a)if(C!==w&&(!f||f.indexOf(C)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const f=[];for(const w of a)this._el.contains(w.target)&&f.push(w);return f}handleEvent(a,f){this._updatingCamera=!0;const w=a.type==="renderFrame",C=w?void 0:a,R={needsRenderFrame:!1},I={},F={},q=a.touches?this._getMapTouches(a.touches):void 0,X=q?W(this._el,q):w?void 0:V(this._el,a);for(const{handlerName:pt,handler:gt,allowed:ft}of this._handlers){if(!gt.isEnabled())continue;let ut;this._blockedByActive(F,ft,pt)?gt.reset():gt[f||a.type]&&(ut=gt[f||a.type](a,X,q),this.mergeHandlerResult(R,I,ut,pt,C),ut&&ut.needsRenderFrame&&this._triggerRenderFrame()),(ut||gt.isActive())&&(F[pt]=gt)}const J={};for(const pt in this._previousActiveHandlers)F[pt]||(J[pt]=C);this._previousActiveHandlers=F,(Object.keys(J).length||Qa(R))&&(this._changes.push([R,I,J]),this._triggerRenderFrame()),(Object.keys(F).length||Qa(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:it}=R;it&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],it(this._map))}mergeHandlerResult(a,f,w,C,R){if(!w)return;o.extend(a,w);const I={handlerName:C,originalEvent:w.originalEvent||R};w.zoomDelta!==void 0&&(f.zoom=I),w.panDelta!==void 0&&(f.drag=I),w.pitchDelta!==void 0&&(f.pitch=I),w.bearingDelta!==void 0&&(f.rotate=I)}_applyChanges(){const a={},f={},w={};for(const[C,R,I]of this._changes)C.panDelta&&(a.panDelta=(a.panDelta||new o.pointGeometry(0,0))._add(C.panDelta)),C.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(a.around=C.around),C.aroundCoord!==void 0&&(a.aroundCoord=C.aroundCoord),C.pinchAround!==void 0&&(a.pinchAround=C.pinchAround),C.noInertia&&(a.noInertia=C.noInertia),o.extend(f,R),o.extend(w,I);this._updateMapTransform(a,f,w),this._changes=[]}_updateMapTransform(a,f,w){const C=this._map,R=C.transform,I=It=>[It.x,It.y,It.z];if((It=>{const Bt=this._eventsInProgress.drag;return Bt&&!this._handlersById[Bt.handlerName].isActive()})()&&!Qa(a)){const It=R.zoom;R.cameraElevationReference="sea",R.recenterOnTerrain(),R.cameraElevationReference="ground",It!==R.zoom&&this._map._update(!0)}if(!Qa(a))return void this._fireEvents(f,w,!0);let{panDelta:F,zoomDelta:q,bearingDelta:X,pitchDelta:J,around:it,aroundCoord:pt,pinchAround:gt}=a;gt!==void 0&&(it=gt),(It=>f.drag&&!this._eventsInProgress.drag)()&&it&&(this._dragOrigin=I(R.pointCoordinate3D(it)),this._trackingEllipsoid.setup(R._camera.position,this._dragOrigin)),R.cameraElevationReference="sea",C._stop(!0),it=it||C.transform.centerPoint,X&&(R.bearing+=X),J&&(R.pitch+=J),R._updateCameraState();const ft=[0,0,0];if(F){const It=R.pointCoordinate(it);if(R.projection.name==="globe"){const Bt=o.latFromMercatorY(It.y),Ut=R.center.lat,Rt=Math.min(o.mercatorZfromAltitude(1,Bt)/o.mercatorZfromAltitude(1,Ut),2);F=F.rotate(-R.angle),ft[0]=-F.x/R.worldSize*Rt,ft[1]=-F.y/R.worldSize*Rt}else{const Bt=R.pointCoordinate(it.sub(F));It&&Bt&&(ft[0]=Bt.x-It.x,ft[1]=Bt.y-It.y)}}const ut=R.zoom,Ft=[0,0,0];if(q){const It=I(pt||R.pointCoordinate3D(it)),Bt={dir:o.normalize([],o.sub([],It,R._camera.position))};if(Bt.dir[2]<0){const Ut=R.zoomDeltaToMovement(It,q);o.scale$2(Ft,Bt.dir,Ut)}}const Et=o.add(ft,ft,Ft);R._translateCameraConstrained(Et),q&&Math.abs(R.zoom-ut)>1e-4&&R.recenterOnTerrain(),R.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(f,w,!0)}_fireEvents(a,f,w){const C=dc(this._eventsInProgress),R=dc(a),I={};for(const J in a){const{originalEvent:it}=a[J];this._eventsInProgress[J]||(I[`${J}start`]=it),this._eventsInProgress[J]=a[J]}!C&&R&&this._fireEvent("movestart",R.originalEvent);for(const J in I)this._fireEvent(J,I[J]);R&&this._fireEvent("move",R.originalEvent);for(const J in a){const{originalEvent:it}=a[J];this._fireEvent(J,it)}const F={};let q;for(const J in this._eventsInProgress){const{handlerName:it,originalEvent:pt}=this._eventsInProgress[J];this._handlersById[it].isActive()||(delete this._eventsInProgress[J],q=f[it]||pt,F[`${J}end`]=q)}for(const J in F)this._fireEvent(J,F[J]);const X=dc(this._eventsInProgress);if(w&&(C||R)&&!X){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),it=pt=>pt!==0&&-this._bearingSnap<pt&&pt<this._bearingSnap;J?(it(J.bearing||this._map.getBearing())&&(J.bearing=0),this._map.easeTo(J,{originalEvent:q})):(this._map.fire(new o.Event("moveend",{originalEvent:q})),it(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,f){this._map.fire(new o.Event(a,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new Wp("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const hh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qp extends o.Evented{constructor(a,f){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=f.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,f){return this.jumpTo({center:a},f)}panBy(a,f,w){return a=o.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,o.extend({offset:a},f),w)}panTo(a,f,w){return this.easeTo(o.extend({center:a},f),w)}getZoom(){return this.transform.zoom}setZoom(a,f){return this.jumpTo({zoom:a},f),this}zoomTo(a,f,w){return this.easeTo(o.extend({zoom:a},f),w)}zoomIn(a,f){return this.zoomTo(this.getZoom()+1,a,f),this}zoomOut(a,f){return this.zoomTo(this.getZoom()-1,a,f),this}getBearing(){return this.transform.bearing}setBearing(a,f){return this.jumpTo({bearing:a},f),this}getPadding(){return this.transform.padding}setPadding(a,f){return this.jumpTo({padding:a},f),this}rotateTo(a,f,w){return this.easeTo(o.extend({bearing:a},f),w)}resetNorth(a,f){return this.rotateTo(0,o.extend({duration:1e3},a),f),this}resetNorthPitch(a,f){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},a),f),this}snapToNorth(a,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,f):this}getPitch(){return this.transform.pitch}setPitch(a,f){return this.jumpTo({pitch:a},f),this}cameraForBounds(a,f){a=o.LngLatBounds.convert(a);const w=f&&f.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),w,f)}_extendCameraOptions(a){const f={top:0,bottom:0,right:0,left:0};if(typeof(a=o.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding=="number"){const w=a.padding;a.padding={top:w,bottom:w,right:w,left:w}}return a.padding=o.extend(f,a.padding),a}_cameraForBoxAndBearing(a,f,w,C){const R=this._extendCameraOptions(C),I=this.transform,F=I.padding,q=I.project(o.LngLat.convert(a)),X=I.project(o.LngLat.convert(f)),J=new o.pointGeometry(q.x,X.y),it=new o.pointGeometry(X.x,q.y),pt=-o.degToRad(w),gt=q.rotate(pt),ft=X.rotate(pt),ut=J.rotate(pt),Ft=it.rotate(pt),Et=new o.pointGeometry(Math.max(gt.x,ft.x,ut.x,Ft.x),Math.max(gt.y,ft.y,ut.y,Ft.y)),It=new o.pointGeometry(Math.min(gt.x,ft.x,ut.x,Ft.x),Math.min(gt.y,ft.y,ut.y,Ft.y)),Bt=Et.sub(It),Ut=(I.width-((F.left||0)+(F.right||0)+R.padding.left+R.padding.right))/Bt.x,Rt=(I.height-((F.top||0)+(F.bottom||0)+R.padding.top+R.padding.bottom))/Bt.y;if(Rt<0||Ut<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ht=Math.min(I.scaleZoom(I.scale*Math.min(Ut,Rt)),R.maxZoom),re=typeof R.offset.x=="number"&&typeof R.offset.y=="number"?new o.pointGeometry(R.offset.x,R.offset.y):o.pointGeometry.convert(R.offset),he=new o.pointGeometry((R.padding.left-R.padding.right)/2,(R.padding.top-R.padding.bottom)/2).rotate(w*Math.PI/180),xe=re.add(he).mult(I.scale/I.zoomScale(Ht));return{center:I.unproject(q.add(X).div(2).sub(xe)),zoom:Ht,bearing:w}}_cameraForBox(a,f,w,C,R){const I=this._extendCameraOptions(R);w=w||0,C=C||0,a=o.LngLat.convert(a),f=o.LngLat.convert(f);const F=this.transform.clone();F.padding=I.padding;const q=this.getFreeCameraOptions(),X=new o.LngLat(.5*(a.lng+f.lng),.5*(a.lat+f.lat)),J=.5*(w+C);if(F._camera.position[2]<o.mercatorZfromAltitude(J,X.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");q.lookAtPoint(X),F.setFreeCameraOptions(q);const it=o.MercatorCoordinate.fromLngLat(a),pt=o.MercatorCoordinate.fromLngLat(f),gt=F.pointRayIntersection(F.centerPoint,J),ft=[(ut=F.rayIntersectionCoordinate(gt)).x,ut.y,ut.z];var ut;const Ft=F.screenPointToMercatorRay(F.centerPoint),Et=F.projection.name!=="globe";let It,Bt=0;do{const Ut=Math.floor(F.zoom),Rt=1<<Ut,Ht=Math.min(Rt*it.x,Rt*pt.x),re=Math.min(Rt*it.y,Rt*pt.y),he=Math.max(Rt*it.x,Rt*pt.x),xe=Math.max(Rt*it.y,Rt*pt.y),ge=new o.Aabb([Ht,re,w],[he,xe,C]),ze=o.Frustum.fromInvProjectionMatrix(F.invProjMatrix,F.worldSize,Ut,Et);if(ge.intersects(ze)!==2){It&&(F._camera.position=o.scaleAndAdd([],F._camera.position,Ft.dir,-It),F._updateStateFromCamera());break}const oe=o.sub([],F._camera.position,ft);It=.5*o.length(oe),F._camera.position=o.scaleAndAdd([],F._camera.position,Ft.dir,It);try{F._updateStateFromCamera()}catch(Ne){return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Bt<10);return{center:F.center,zoom:F.zoom,bearing:F.bearing,pitch:F.pitch}}fitBounds(a,f,w){return this._fitInternal(this.cameraForBounds(a,f),f,w)}_raycastElevationBox(a,f){const w=this.transform.elevation;if(!w)return;const C=new o.pointGeometry(a.x,f.y),R=new o.pointGeometry(f.x,a.y),I=w.pointCoordinate(a);if(!I)return;const F=w.pointCoordinate(f);if(!F)return;const q=w.pointCoordinate(C);if(!q)return;const X=w.pointCoordinate(R);if(!X)return;const J=new o.MercatorCoordinate(I[0],I[1]).toLngLat(),it=new o.MercatorCoordinate(F[0],F[1]).toLngLat(),pt=new o.MercatorCoordinate(q[0],q[1]).toLngLat(),gt=new o.MercatorCoordinate(X[0],X[1]).toLngLat(),ft=Math.min(J.lng,Math.min(it.lng,Math.min(pt.lng,gt.lng))),ut=Math.min(J.lat,Math.min(it.lat,Math.min(pt.lat,gt.lat))),Ft=Math.max(J.lng,Math.max(it.lng,Math.max(pt.lng,gt.lng))),Et=Math.max(J.lat,Math.max(it.lat,Math.max(pt.lat,gt.lat))),It=Math.min(I[3],Math.min(F[3],Math.min(q[3],X[3]))),Bt=Math.max(I[3],Math.max(F[3],Math.max(q[3],X[3])));return{minLngLat:new o.LngLat(ft,ut),maxLngLat:new o.LngLat(Ft,Et),minAltitude:It,maxAltitude:Bt}}fitScreenCoordinates(a,f,w,C,R){let I,F,q,X;const J=o.pointGeometry.convert(a),it=o.pointGeometry.convert(f),pt=this._raycastElevationBox(J,it);if(pt)I=pt.minLngLat,F=pt.maxLngLat,q=pt.minAltitude,X=pt.maxAltitude;else{if(this.transform.anyCornerOffEdge(J,it))return this;I=this.transform.pointLocation(J),F=this.transform.pointLocation(it)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(a)),this.transform.pointLocation(o.pointGeometry.convert(f)),w,C):this._cameraForBox(I,F,q,X,C),C,R)}_fitInternal(a,f,w){return a?(delete(f=o.extend(a,f)).padding,f.linear?this.easeTo(f,w):this.flyTo(f,w)):this}jumpTo(a,f){this.stop();const w=a.preloadOnly?this.transform.clone():this.transform;let C=!1,R=!1,I=!1;return"zoom"in a&&w.zoom!==+a.zoom&&(C=!0,w.zoom=+a.zoom),a.center!==void 0&&(w.center=o.LngLat.convert(a.center)),"bearing"in a&&w.bearing!==+a.bearing&&(R=!0,w.bearing=+a.bearing),"pitch"in a&&w.pitch!==+a.pitch&&(I=!0,w.pitch=+a.pitch),a.padding==null||w.isPaddingEqual(a.padding)||(w.padding=a.padding),a.preloadOnly?(this._preloadTiles(w),this):(this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),C&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),R&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),I&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(hh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,f){const w=this.transform;if(!w.projection.supportsFreeCamera)return o.warnOnce(hh),this;this.stop();const C=w.zoom,R=w.pitch,I=w.bearing;w.setFreeCameraOptions(a);const F=C!==w.zoom,q=R!==w.pitch,X=I!==w.bearing;return this.fire(new o.Event("movestart",f)).fire(new o.Event("move",f)),F&&this.fire(new o.Event("zoomstart",f)).fire(new o.Event("zoom",f)).fire(new o.Event("zoomend",f)),X&&this.fire(new o.Event("rotatestart",f)).fire(new o.Event("rotate",f)).fire(new o.Event("rotateend",f)),q&&this.fire(new o.Event("pitchstart",f)).fire(new o.Event("pitch",f)).fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f)),this}easeTo(a,f){this._stop(!1,a.easeId),((a=o.extend({offset:[0,0],duration:500,easing:o.ease},a)).animate===!1||!a.essential&&o.exported.prefersReducedMotion)&&(a.duration=0);const w=this.transform,C=this.getZoom(),R=this.getBearing(),I=this.getPitch(),F=this.getPadding(),q="zoom"in a?+a.zoom:C,X="bearing"in a?this._normalizeBearing(a.bearing,R):R,J="pitch"in a?+a.pitch:I,it="padding"in a?a.padding:w.padding,pt=o.pointGeometry.convert(a.offset);let gt,ft,ut;if(w.projection.name==="globe"){const xe=o.MercatorCoordinate.fromLngLat(w.center),ge=pt.rotate(-w.angle);xe.x+=ge.x/w.worldSize,xe.y+=ge.y/w.worldSize;const ze=xe.toLngLat(),oe=o.LngLat.convert(a.center||ze);this._normalizeCenter(oe),gt=w.centerPoint.add(ge),ft=new o.pointGeometry(xe.x,xe.y).mult(w.worldSize),ut=new o.pointGeometry(o.mercatorXfromLng(oe.lng),o.mercatorYfromLat(oe.lat)).mult(w.worldSize).sub(ft)}else{gt=w.centerPoint.add(pt);const xe=w.pointLocation(gt),ge=o.LngLat.convert(a.center||xe);this._normalizeCenter(ge),ft=w.project(xe),ut=w.project(ge).sub(ft)}const Ft=w.zoomScale(q-C);let Et,It;a.around&&(Et=o.LngLat.convert(a.around),It=w.locationPoint(Et));const Bt=this._zooming||q!==C,Ut=this._rotating||R!==X,Rt=this._pitching||J!==I,Ht=!w.isPaddingEqual(it),re=xe=>ge=>{if(Bt&&(xe.zoom=o.number(C,q,ge)),Ut&&(xe.bearing=o.number(R,X,ge)),Rt&&(xe.pitch=o.number(I,J,ge)),Ht&&(xe.interpolatePadding(F,it,ge),gt=xe.centerPoint.add(pt)),Et)xe.setLocationAtPoint(Et,It);else{const ze=xe.zoomScale(xe.zoom-C),oe=q>C?Math.min(2,Ft):Math.max(.5,Ft),Ne=Math.pow(oe,1-ge),Ie=xe.unproject(ft.add(ut.mult(ge*Ne)).mult(ze));xe.setLocationAtPoint(xe.renderWorldCopies?Ie.wrap():Ie,gt)}return a.preloadOnly||this._fireMoveEvents(f),xe};if(a.preloadOnly){const xe=this._emulate(re,a.duration,w);return this._preloadTiles(xe),this}const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Bt,this._rotating=Ut,this._pitching=Rt,this._padding=Ht,this._easeId=a.easeId,this._prepareEase(f,a.noMoveStart,he),this._ease(re(w),xe=>{w.recenterOnTerrain(),this._afterEase(f,xe)},a),this}_prepareEase(a,f,w={}){this._moving=!0,this.transform.cameraElevationReference="sea",f||w.moving||this.fire(new o.Event("movestart",a)),this._zooming&&!w.zooming&&this.fire(new o.Event("zoomstart",a)),this._rotating&&!w.rotating&&this.fire(new o.Event("rotatestart",a)),this._pitching&&!w.pitching&&this.fire(new o.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new o.Event("move",a)),this._zooming&&this.fire(new o.Event("zoom",a)),this._rotating&&this.fire(new o.Event("rotate",a)),this._pitching&&this.fire(new o.Event("pitch",a))}_afterEase(a,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const w=this._zooming,C=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,w&&this.fire(new o.Event("zoomend",a)),C&&this.fire(new o.Event("rotateend",a)),R&&this.fire(new o.Event("pitchend",a)),this.fire(new o.Event("moveend",a))}flyTo(a,f){if(!a.essential&&o.exported.prefersReducedMotion){const Qe=o.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,f)}this.stop(),a=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},a);const w=this.transform,C=this.getZoom(),R=this.getBearing(),I=this.getPitch(),F=this.getPadding(),q="zoom"in a?o.clamp(+a.zoom,w.minZoom,w.maxZoom):C,X="bearing"in a?this._normalizeBearing(a.bearing,R):R,J="pitch"in a?+a.pitch:I,it="padding"in a?a.padding:w.padding,pt=w.zoomScale(q-C),gt=o.pointGeometry.convert(a.offset);let ft=w.centerPoint.add(gt);const ut=w.pointLocation(ft),Ft=o.LngLat.convert(a.center||ut);this._normalizeCenter(Ft);const Et=w.project(ut),It=w.project(Ft).sub(Et);let Bt=a.curve;const Ut=Math.max(w.width,w.height),Rt=Ut/pt,Ht=It.mag();if("minZoom"in a){const Qe=o.clamp(Math.min(a.minZoom,C,q),w.minZoom,w.maxZoom),$e=Ut/w.zoomScale(Qe-C);Bt=Math.sqrt($e/Ht*2)}const re=Bt*Bt;function he(Qe){const $e=(Rt*Rt-Ut*Ut+(Qe?-1:1)*re*re*Ht*Ht)/(2*(Qe?Rt:Ut)*re*Ht);return Math.log(Math.sqrt($e*$e+1)-$e)}function xe(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function ge(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const ze=he(0);let oe=function(Qe){return ge(ze)/ge(ze+Bt*Qe)},Ne=function(Qe){return Ut*((ge(ze)*(xe($e=ze+Bt*Qe)/ge($e))-xe(ze))/re)/Ht;var $e},Ie=(he(1)-ze)/Bt;if(Math.abs(Ht)<1e-6||!isFinite(Ie)){if(Math.abs(Ut-Rt)<1e-6)return this.easeTo(a,f);const Qe=Rt<Ut?-1:1;Ie=Math.abs(Math.log(Rt/Ut))/Bt,Ne=function(){return 0},oe=function($e){return Math.exp(Qe*Bt*$e)}}a.duration="duration"in a?+a.duration:1e3*Ie/("screenSpeed"in a?+a.screenSpeed/Bt:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const en=R!==X,ve=J!==I,Ze=!w.isPaddingEqual(it),_n=Qe=>$e=>{const An=$e*Ie,Un=1/oe(An);Qe.zoom=$e===1?q:C+Qe.scaleZoom(Un),en&&(Qe.bearing=o.number(R,X,$e)),ve&&(Qe.pitch=o.number(I,J,$e)),Ze&&(Qe.interpolatePadding(F,it,$e),ft=Qe.centerPoint.add(gt));const gn=$e===1?Ft:Qe.unproject(Et.add(It.mult(Ne(An))).mult(Un));return Qe.setLocationAtPoint(Qe.renderWorldCopies?gn.wrap():gn,ft),Qe._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(f),Qe};if(a.preloadOnly){const Qe=this._emulate(_n,a.duration,w);return this._preloadTiles(Qe),this}return this._zooming=!0,this._rotating=en,this._pitching=ve,this._padding=Ze,this._prepareEase(f,!1),this._ease(_n(w),()=>this._afterEase(f),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const w=this._onEaseEnd;this._onEaseEnd=void 0,w.call(this,f)}if(!a){const w=this.handlers;w&&w.stop(!1)}return this}_ease(a,f,w){w.animate===!1||w.duration===0?(a(1),f()):(this._easeStart=o.exported.now(),this._easeOptions=w,this._onEaseFrame=a,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,f){a=o.wrap(a,-180,180);const w=Math.abs(a-f);return Math.abs(a-360-f)<w&&(a-=360),Math.abs(a+360-f)<w&&(a+=360),a}_normalizeCenter(a){const f=this.transform;if(!f.renderWorldCopies||f.maxBounds)return;const w=a.lng-f.center.lng;a.lng+=w>180?-360:w<-180?360:0}_emulate(a,f,w){const C=Math.ceil(15*f/1e3),R=[],I=a(w.clone());for(let F=0;F<=C;F++){const q=I(F/C);R.push(q.clone())}return R}}class dh{constructor(a={}){this.options=a,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const f=this.options&&this.options.compact;return this._map=a,this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=A("button","mapboxgl-ctrl-attrib-button",this._container),A("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=A("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,f){const w=this._map._getUIString(`AttributionControl.${f}`);a.setAttribute("aria-label",w),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",w)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(a){const w=f.reduce((C,R,I)=>(R.value&&(C+=`${R.key}=${R.value}${I<f.length-1?"&":""}`),C),"?");a.href=`${o.config.FEEDBACK_URL}/${w}${this._map._hash?this._map._hash.getHashString(!0):""}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const C=this._map.style.stylesheet;this.styleOwner=C.owner,this.styleId=C.id}const f=this._map.style._sourceCaches;for(const C in f){const R=f[C];if(R.used){const I=R.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((C,R)=>C.length-R.length),a=a.filter((C,R)=>{for(let I=R+1;I<a.length;I++)if(a[I].indexOf(C)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const w=a.join(" | ");w!==this._attribHTML&&(this._attribHTML=w,a.length?(this._innerContainer.innerHTML=w,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sy{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=A("div","mapboxgl-ctrl");const f=A("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(Object.entries(a).length===0)return!0;for(const f in a){const w=a[f].getSource();if(w.hasOwnProperty("mapbox_logo")&&!w.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const f=a[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Cy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const f=++this._id;return this._queue.push({callback:a,id:f,cancelled:!1}),f}remove(a){const f=this._currentlyRunning,w=f?this._queue.concat(f):this._queue;for(const C of w)if(C.id===a)return void(C.cancelled=!0)}run(a=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const w of f)if(!w.cancelled&&(w.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ph(v,a,f){if(v=new o.LngLat(v.lng,v.lat),a){const w=new o.LngLat(v.lng-360,v.lat),C=new o.LngLat(v.lng+360,v.lat),R=360*Math.ceil(Math.abs(v.lng-f.center.lng)/360),I=f.locationPoint(v).distSqr(a),F=a.x<0||a.y<0||a.x>f.width||a.y>f.height;f.locationPoint(w).distSqr(a)<I&&(F||Math.abs(w.lng-f.center.lng)<R)?v=w:f.locationPoint(C).distSqr(a)<I&&(F||Math.abs(C.lng-f.center.lng)<R)&&(v=C)}for(;Math.abs(v.lng-f.center.lng)>180;){const w=f.locationPoint(v);if(w.x>=0&&w.y>=0&&w.x<=f.width&&w.y<=f.height)break;v.lng>f.center.lng?v.lng-=360:v.lng+=360}return v}const fh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class mh extends o.Evented{constructor(a,f){if(super(),(a instanceof o.window.HTMLElement||f)&&(a=o.extend({element:a},f)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),a&&a.element)this._element=a.element,this._offset=o.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=A("div");const C=41,R=27,I=T("svg",{display:"block",height:C*this._scale+"px",width:R*this._scale+"px",viewBox:`0 0 ${R} ${C}`},this._element),F=T("radialGradient",{id:"shadowGradient"},T("defs",{},I));T("stop",{offset:"10%","stop-opacity":.4},F),T("stop",{offset:"100%","stop-opacity":.05},F),T("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),T("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),T("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),T("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=o.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",C=>{C.preventDefault()}),this._element.addEventListener("mousedown",C=>{C.preventDefault()});const w=this._element.classList;for(const C in fh)w.remove(`mapboxgl-marker-anchor-${C}`);w.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=o.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const C=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(38.1-13.5+C)],"bottom-right":[-C,-1*(38.1-13.5+C)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const f=a.code,w=a.charCode||a.keyCode;f!=="Space"&&f!=="Enter"&&w!==32&&w!==13||this.togglePopup()}_onMapClick(a){const f=a.originalEvent.target,w=this._element;this._popup&&(f===w||w.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const a=this._map;if(!a)return;const f=this._pos;if(!f||f.x<0||f.x>a.transform.width||f.y<0||f.y>a.transform.height)return void this._clearFadeTimer();const w=a.unproject(f);let C=!1;if(a.transform._terrainEnabled()&&a.getTerrain()){const I=a.getFreeCameraOptions();if(I.position){const F=I.position.toLngLat();C=F.distanceTo(w)<.9*F.distanceTo(this._lngLat)}}const R=(1-a._queryFogOpacity(w))*(C?.2:1);this._element.style.opacity=`${R}`,this._popup&&this._popup._setOpacity(`${R}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a)return;const f=this._offset.mult(this._scale),w=this._calculatePitch(),C=this._calculateRotation();this._element.style.transform=`
            translate(${a.x}px, ${a.y}px) ${fh[this._anchor]}
            rotateX(${w}deg) rotateZ(${C}deg)
            translate(${f.x}px, ${f.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(a){o.window.cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=ph(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),a===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!f.getTerrain()&&!f.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=o.pointGeometry.convert(a),this._update(),this}_onMove(a){const f=this._map;if(f){if(!this._isDragging){const w=this._clickTolerance||f._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=w}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(a){const f=this._map;f&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos),this._pointerdownPos=a.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const f=this._map;return f&&(a?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class H1{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const f=o.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,f,w){this._start=this.getValue(f),this._end=a,this._startTime=f,this._endTime=f+w}}const W1={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Yp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function pc(v){v.parentNode&&v.parentNode.removeChild(v)}const Xp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Kp{constructor(a,f,w=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Ja({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,w&&(this.mousePitch=new Vp({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(a,f){this.mouseRotate.mousedown(a,f),this.mousePitch&&this.mousePitch.mousedown(a,f),z()}move(a,f){const w=this.map,C=this.mouseRotate.mousemoveWindow(a,f),R=C&&C.bearingDelta;if(R&&w.setBearing(w.getBearing()+R),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,f),F=I&&I.pitchDelta;F&&w.setPitch(w.getPitch()+F)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){O(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(o.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),V(this.element,a)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,V(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=W(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Er={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Ur,fc=0,sa=!1;const Zp={maxWidth:100,unit:"metric"};function gh(v,a,f){const w=f&&f.maxWidth||100,C=v._containerHeight/2,R=v._containerWidth/2-w/2,I=v.unproject([R,C]),F=v.unproject([R+w,C]),q=I.distanceTo(F);if(f&&f.unit==="imperial"){const X=3.2808*q;X>5280?$a(a,w,X/5280,v._getUIString("ScaleControl.Miles"),v):$a(a,w,X,v._getUIString("ScaleControl.Feet"),v)}else f&&f.unit==="nautical"?$a(a,w,q/1852,v._getUIString("ScaleControl.NauticalMiles"),v):q>=1e3?$a(a,w,q/1e3,v._getUIString("ScaleControl.Kilometers"),v):$a(a,w,q,v._getUIString("ScaleControl.Meters"),v)}function $a(v,a,f,w,C){const R=function(F){const q=Math.pow(10,`${Math.floor(F)}`.length-1);let X=F/q;return X=X>=10?10:X>=5?5:X>=3?3:X>=2?2:X>=1?1:function(J){const it=Math.pow(10,Math.ceil(-Math.log(J)/Math.LN10));return Math.round(J*it)/it}(X),q*X}(f),I=R/f;C._requestDomTask(()=>{v.style.width=a*I+"px",v.innerHTML=`${R}&nbsp;${w}`})}const eo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function mc(v=new o.pointGeometry(0,0),a="bottom"){if(typeof v=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(a){case"top":return new o.pointGeometry(0,v);case"top-left":return new o.pointGeometry(f,f);case"top-right":return new o.pointGeometry(-f,f);case"bottom":return new o.pointGeometry(0,-v);case"bottom-left":return new o.pointGeometry(f,-f);case"bottom-right":return new o.pointGeometry(-f,-f);case"left":return new o.pointGeometry(v,0);case"right":return new o.pointGeometry(-v,0)}return new o.pointGeometry(0,0)}return v instanceof o.pointGeometry||Array.isArray(v)?o.pointGeometry.convert(v):o.pointGeometry.convert(v[a]||[0,0])}const tl={version:o.version,supported:m,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends qp{constructor(v){if((v=o.extend({},Yp,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(v.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new sh(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),v),this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._optimizeForTerrain=v.optimizeForTerrain,this._renderTaskQueue=new Cy,this._domRenderTaskQueue=new Cy,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},W1,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new H1(0),this._explicitProjection=null,this._requestManager=new o.RequestManager(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,typeof v.container=="string"){if(this._container=o.window.document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Py(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),this._hash=v.hash&&new ay(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,o.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),v.attributionControl&&this.addControl(new dh({customAttribution:v.customAttribution})),this._logoControl=new Sy,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new o.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new o.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(v,a){if(a===void 0&&(a=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=v.onAdd(this);this._controls.push(v);const w=this._controlPositions[a];return a.indexOf("bottom")!==-1?w.insertBefore(f,w.firstChild):w.appendChild(f),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(v);return a>-1&&this._controls.splice(a,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new o.Event("movestart",v)).fire(new o.Event("move",v)),this.fire(new o.Event("resize",v)),a&&this.fire(new o.Event("moveend",v)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(o.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v==null?-2:v)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v==null?22:v)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v==null?0:v)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v==null?85:v)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(v){return this._lazyInitEmptyStyle(),v?typeof v=="string"&&(v={name:v}):v=null,this._updateProjection(v)}_updateProjection(v){v===null&&(this._explicitProjection=null);const a=v||this.getProjection(),f=this.transform.setProjection(a);if(v&&(this._explicitProjection=this.transform.getProjection()),f){this.painter.clearBackgroundTiles();for(const w in this.style._sourceCaches)this.style._sourceCaches[w].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(v){return this.transform.locationPoint3D(o.LngLat.convert(v))}unproject(v){return this.transform.pointLocation3D(o.pointGeometry.convert(v))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(v,a,f){if(v==="mouseenter"||v==="mouseover"){let w=!1;const C=I=>{const F=a.filter(X=>this.getLayer(X)),q=F.length?this.queryRenderedFeatures(I.point,{layers:F}):[];q.length?w||(w=!0,f.call(this,new Nr(v,this,I.originalEvent,{features:q}))):w=!1},R=()=>{w=!1};return{layers:new Set(a),listener:f,delegates:{mousemove:C,mouseout:R}}}if(v==="mouseleave"||v==="mouseout"){let w=!1;const C=I=>{const F=a.filter(q=>this.getLayer(q));(F.length?this.queryRenderedFeatures(I.point,{layers:F}):[]).length?w=!0:w&&(w=!1,f.call(this,new Nr(v,this,I.originalEvent)))},R=I=>{w&&(w=!1,f.call(this,new Nr(v,this,I.originalEvent)))};return{layers:new Set(a),listener:f,delegates:{mousemove:C,mouseout:R}}}{const w=C=>{const R=a.filter(F=>this.getLayer(F)),I=R.length?this.queryRenderedFeatures(C.point,{layers:R}):[];I.length&&(C.features=I,f.call(this,C),delete C.features)};return{layers:new Set(a),listener:f,delegates:{[v]:w}}}}on(v,a,f){if(f===void 0)return super.on(v,a);Array.isArray(a)||(a=[a]);const w=this._createDelegatedListener(v,a,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(w);for(const C in w.delegates)this.on(C,w.delegates[C]);return this}once(v,a,f){if(f===void 0)return super.once(v,a);Array.isArray(a)||(a=[a]);const w=this._createDelegatedListener(v,a,f);for(const C in w.delegates)this.once(C,w.delegates[C]);return this}off(v,a,f){if(f===void 0)return super.off(v,a);a=new Set(Array.isArray(a)?a:[a]);const w=(R,I)=>{if(R.size!==I.size)return!1;for(const F of R)if(!I.has(F))return!1;return!0},C=this._delegatedListeners?this._delegatedListeners[v]:void 0;return C&&(R=>{for(let I=0;I<R.length;I++){const F=R[I];if(F.listener===f&&w(F.layers,a)){for(const q in F.delegates)this.off(q,F.delegates[q]);return R.splice(I,1),this}}})(C),this}queryRenderedFeatures(v,a){return this.style?(a!==void 0||v===void 0||v instanceof o.pointGeometry||Array.isArray(v)||(a=v,v=void 0),this.style.queryRenderedFeatures(v=v||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(v,a){return this.style.querySourceFeatures(v,a)}queryTerrainElevation(v,a){const f=this.transform.elevation;return f?(a=o.extend({},{exaggerated:!0},a),f.getAtPoint(o.MercatorCoordinate.fromLngLat(v),null,a.exaggerated)):null}setStyle(v,a){return(a=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&v?(this._diffStyle(v,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(v,a))}_getUIString(v){const a=this._locale[v];if(a==null)throw new Error(`Missing UI string '${v}'`);return a}_updateStyle(v,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v&&(this.style=new Ar(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v):this.style.loadJSON(v)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ar(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,a){if(typeof v=="string"){const f=this._requestManager.normalizeStyleURL(v),w=this._requestManager.transformRequest(f,o.ResourceType.Style);o.getJSON(w,(C,R)=>{C?this.fire(new o.ErrorEvent(C)):R&&this._updateDiff(R,a)})}else typeof v=="object"&&this._updateDiff(v,a)}_updateDiff(v,a){try{this.style.setState(v)&&this._update(!0)}catch(f){o.warnOnce(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(v,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(v,a){return this._lazyInitEmptyStyle(),this.style.addSource(v,a),this._update(!0)}isSourceLoaded(v){return!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){const v=this.style&&this.style._sourceCaches;for(const a in v){const f=v[a]._tiles;for(const w in f){const C=f[w];if(C.state!=="loaded"&&C.state!=="errored")return!1}}return!0}addSourceType(v,a,f){this._lazyInitEmptyStyle(),this.style.addSourceType(v,a,f)}removeSource(v){return this.style.removeSource(v),this._updateTerrain(),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,a,{pixelRatio:f=1,sdf:w=!1,stretchX:C,stretchY:R,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap){const{width:F,height:q,data:X}=o.exported.getImageData(a);this.style.addImage(v,{data:new o.RGBAImage({width:F,height:q},X),pixelRatio:f,stretchX:C,stretchY:R,content:I,sdf:w,version:0})}else if(a.width===void 0||a.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:F,height:q}=a,X=a;this.style.addImage(v,{data:new o.RGBAImage({width:F,height:q},new Uint8Array(X.data)),pixelRatio:f,stretchX:C,stretchY:R,content:I,sdf:w,version:0,userImage:X}),X.onAdd&&X.onAdd(this,v)}}updateImage(v,a){const f=this.style.getImage(v);if(!f)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap?o.exported.getImageData(a):a,{width:C,height:R}=w;C!==void 0&&R!==void 0?C===f.data.width&&R===f.data.height?(f.data.replace(w.data,!(a instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&a instanceof o.window.ImageBitmap)),this.style.updateImage(v,f)):this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,a){o.getImage(this._requestManager.transformRequest(v,o.ResourceType.Image),(f,w)=>{a(f,w instanceof o.window.HTMLImageElement?o.exported.getImageData(w):w)})}listImages(){return this.style.listImages()}addLayer(v,a){return this._lazyInitEmptyStyle(),this.style.addLayer(v,a),this._update(!0)}moveLayer(v,a){return this.style.moveLayer(v,a),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,a,f){return this.style.setLayerZoomRange(v,a,f),this._update(!0)}setFilter(v,a,f={}){return this.style.setFilter(v,a,f),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,a,f,w={}){return this.style.setPaintProperty(v,a,f,w),this._update(!0)}getPaintProperty(v,a){return this.style.getPaintProperty(v,a)}setLayoutProperty(v,a,f,w={}){return this.style.setLayoutProperty(v,a,f,w),this._update(!0)}getLayoutProperty(v,a){return this.style.getLayoutProperty(v,a)}setLight(v,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(v),this.transform):0}setFeatureState(v,a){return this.style.setFeatureState(v,a),this._update()}removeFeatureState(v,a){return this.style.removeFeatureState(v,a),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let f,w,C,R=this._container;for(;R&&(!w||!C);){const I=o.window.getComputedStyle(R).transform;I&&I!=="none"&&(f=I.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(w=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(C=f[3])),R=R.parentElement}this._containerWidth=w?Math.abs(v/w):v,this._containerHeight=C?Math.abs(a/C):a}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=A("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=A("div","mapboxgl-canvas-container",v);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=A("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=A("div","mapboxgl-control-container",v),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{w[C]=A("div",`mapboxgl-ctrl-${C}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,a){const f=o.exported.devicePixelRatio||1;this._canvas.width=f*Math.ceil(v),this._canvas.height=f*Math.ceil(a),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${a}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const a=this._markers.indexOf(v);a!==-1&&this._markers.splice(a,1)}_setupPainter(){const v=o.extend({},m.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);a?(o.storeAuthState(a,!0),this.painter=new oy(a,this.transform),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(a)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let a;const f=this.painter.context.extTimerQuery,w=o.exported.now();if(this.listens("gpu-timing-frame")&&(a=f.createQueryEXT(),f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;let C=!1;const R=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const q=this.transform.zoom,X=this.transform.pitch,J=o.exported.now();this.style.zoomHistory.update(q,J);const it=new o.EvaluationParameters(q,{now:J,fadeDuration:R,pitch:X,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pt=it.crossFadingFactor();pt===1&&pt===this._crossFadingFactor||(C=!0,this._crossFadingFactor=pt),this.style.update(it)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let I=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),I=this._updateAverageElevation(w),this.style._updateSources(this.transform),this._forceMarkerUpdate()):I=this._updateAverageElevation(w),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,R,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:R,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||C)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const q=o.exported.now()-w;f.endQueryEXT(f.TIME_ELAPSED_EXT,a),setTimeout(()=>{const X=f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)/1e6;f.deleteQueryEXT(a),this.fire(new o.Event("gpu-timing-frame",{cpuTime:q,gpuTime:X}))},50)}if(this.listens("gpu-timing-layer")){const q=this.painter.collectGpuTimers();setTimeout(()=>{const X=this.painter.queryGpuTimers(q);this.fire(new o.Event("gpu-timing-layer",{layerTimes:X}))},50)}const F=this._sourcesDirty||this._styleDirty||this._placementDirty||I;if(F||this._repaint)this.triggerRepaint();else{const q=!this.isMoving()&&this.loaded();if(q&&(I=this._updateAverageElevation(w,!0)),I)this.triggerRepaint();else if(this._triggerFrame(!1),q&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const X=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:X})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const v of this._markers)v._update()}_updateAverageElevation(v,a=!1){const f=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);if((a||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const w=this.transform.averageElevation;let C=this.transform.sampleAverageElevation(),R=!1;this.transform.elevation&&(R=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(C)?C=0:this._averageElevationLastSampledAt=v;const I=Math.abs(w-C);if(I>1){if(this._isInitialLoad||R)return this._averageElevation.jumpTo(C),f(C);this._averageElevation.easeTo(C,v,300)}else if(I>1e-4)return this._averageElevation.jumpTo(C),f(C)}return!!this._averageElevation.isEasing(v)&&f(this._averageElevation.getValue(v))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===o.AUTH_ERR_MSG||v.status===401)){const a=this.painter.context.gl;o.storeAuthState(a,!1),this._logoControl instanceof Sy&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const f=this.painter.context.gl,w=f.createFramebuffer();function C(R){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,R,0);const I=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,I),I}return f.bindFramebuffer(f.FRAMEBUFFER,w),this._canvasPixelComparison(C(v),a.canvasCopies.map(C),a.timeStamps)}_canvasPixelComparison(v,a,f){let w=f[1]-f[0];const C=v.length/4;for(let R=0;R<a.length;R++){const I=a[R];let F=0;for(let q=0;q<I.length;q+=4)I[q]===v[q]&&I[q+1]===v[q+1]&&I[q+2]===v[q+2]&&I[q+3]===v[q+3]&&(F+=1);w+=(f[R+2]-f[R+1])*(1-F/C)}return w}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),pc(this._canvasContainer),pc(this._controlContainer),pc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=o.exported.frame(a=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(a)}))}_preloadTiles(v){const a=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(a,(f,w)=>f._preloadTiles(v,w),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}_setCacheLimits(v,a){o.setCacheLimits(v,a)}get version(){return o.version}},NavigationControl:class{constructor(v){this.options=o.extend({},Xp,v),this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),A("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),A("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:a}):f.resetNorth({},{originalEvent:a}))}),this._compassIcon=A("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const a=v.getZoom(),f=a===v.getMaxZoom(),w=a===v.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=w,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",w.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Kp(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,a){const f=A("button",v,this._container);return f.type="button",f.addEventListener("click",a),f}_setButtonTitle(v,a){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${a}`);v.setAttribute("aria-label",f),v.firstElementChild&&v.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends o.Evented{constructor(v){super(),this.options=o.extend({},Er,v),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Up(this._updateMarkerRotation,20)}onAdd(v){var a;return this._map=v,this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-group"),a=this._setupUI,Ur!==void 0?a(Ur):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(f=>{Ur=f.state!=="denied",a(Ur)}):(Ur=!!o.window.navigator.geolocation,a(Ur)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,fc=0,sa=!1}_isOutOfMapMaxBounds(v){const a=this._map.getMaxBounds(),f=v.coords;return!!a&&(f.longitude<a.getWest()||f.longitude>a.getEast()||f.latitude<a.getSouth()||f.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(v),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",v)),this._finish()}}_updateCamera(v){const a=new o.LngLat(v.coords.longitude,v.coords.latitude),f=v.coords.accuracy,w=this._map.getBearing(),C=o.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(f),C,{geolocateSource:!0})}_updateMarker(v){if(v){const a=new o.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map._containerHeight/2,a=this._map.unproject([0,v]),f=this._map.unproject([100,v]),w=a.distanceTo(f)/100,C=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=`${C}px`,this._circleElement.style.height=`${C}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(v.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(v.code===3&&sa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=A("button","mapboxgl-ctrl-geolocate",this._container),A("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",v===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=A("div","mapboxgl-user-location"),this._dotElement.appendChild(A("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(A("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new mh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=A("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new mh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:v.absolute===!0&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fc--,sa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),fc++,fc>1?(v={maximumAge:6e5,timeout:0},sa=!0):(v=this.options.positionOptions,sa=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(a=>{a==="granted"&&v()}).catch(console.error):v()}_clearWatch(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dh,ScaleControl:class{constructor(v){this.options=o.extend({},Zp,v),o.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){gh(this._map,this._container,this.options)}onAdd(v){return this._map=v,this._container=A("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(v){this.options.unit=v,gh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof o.window.HTMLElement?this._container=v.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=A("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=A("button","mapboxgl-ctrl-fullscreen",this._controlContainer);A("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(v){super(),this.options=o.extend(Object.create(eo),v),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=o.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(o.window.document.createTextNode(v))}setHTML(v){const a=o.window.document.createDocumentFragment(),f=o.window.document.createElement("body");let w;for(f.innerHTML=v;w=f.firstChild,w;)a.appendChild(w);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=A("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(v),this.options.closeButton){const f=this._closeButton=A("button","mapboxgl-popup-close-button",a);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let a;return this._classList.delete(v)?a=!1:(this._classList.add(v),a=!0),this._updateClassList(),a}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const a=this._map,f=this._container,w=this._pos;if(!a||!f||!w)return"bottom";const C=f.offsetWidth,R=f.offsetHeight,I=w.x<C/2,F=w.x>a.transform.width-C/2;if(w.y+v<R)return I?"top-left":F?"top-right":"top";if(w.y>a.transform.height-R){if(I)return"bottom-left";if(F)return"bottom-right"}return I?"left":F?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),v.className=a.join(" ")}_update(v){const a=this._map,f=this._content;if(!a||!this._lngLat&&!this._trackPointer||!f)return;let w=this._container;if(w||(w=this._container=A("div","mapboxgl-popup",a.getContainer()),this._tip=A("div","mapboxgl-popup-tip",w),w.appendChild(f)),this.options.maxWidth&&w.style.maxWidth!==this.options.maxWidth&&(w.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ph(this._lngLat,this._pos,a.transform)),!this._trackPointer||v){const C=this._pos=this._trackPointer&&v?v:a.project(this._lngLat),R=mc(this.options.offset),I=this._anchor=this._getAnchor(R.y),F=mc(this.options.offset,I),q=C.add(F).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${fh[I]} translate(${q.x}px,${q.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(mi);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._content&&(this._content.style.opacity=v),this._tip&&(this._tip.style.opacity=v)}},Marker:mh,Style:Ar,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:rc,Evented:o.Evented,config:o.config,prewarm:function(){Vt().acquire(Mn)},clearPrewarmedResources:function(){const v=ht;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Mn),ht=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(v){o.config.ACCESS_TOKEN=v},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(v){o.config.API_URL=v},get workerCount(){return rt.workerCount},set workerCount(v){rt.workerCount=v},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){o.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){o.clearTileCache(v)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return tl});var h=s;return h})})(bA);var hU=bA.exports;const dU=Nw(hU),Bu={tdtsl(){return{layers:[["tdtsl","TianDiTu.Normal.Map"],["tdtslzj","TianDiTu.Normal.Annotion"]],key:"fb258b4c0bbf60ff7a0205b519ad9a96"}},tdtyx(){return{layers:[["tdtyx","TianDiTu.Satellite.Map"],["tdtyxzj","TianDiTu.Satellite.Annotion"]],key:"fb258b4c0bbf60ff7a0205b519ad9a96"}},tdtdx(){return{layers:[["tdtdx","TianDiTu.Terrain.Map"],["tdtdxzj","TianDiTu.Terrain.Annotion"]],key:"fb258b4c0bbf60ff7a0205b519ad9a96"}},gdsl(){return{layers:[["gdsl","GaoDe.Normal.Map"]]}},gdslwzj(){return{layers:[["gdslwzj","GaoDe.Normal_NoTag.Map"]]}},gdyx(){return{layers:[["gdyx","GaoDe.Satellite.Map"],["gdyxzj","GaoDe.Satellite.Annotion"]]}},bdsl(){return{layers:[["bdsl","Baidu.Normal.Map"]]}},bdyx(){return{layers:[["bdyx","Baidu.Satellite.Map"],["bdyxzj","Baidu.Satellite.Annotion"]]}},osm(){return{layers:[["osm","OSM.Normal.Map"]]}},geoq(){return{layers:[["geoq","Geoq.Normal.Map"]]}},geoqPurplishBlue(){return{layers:[["geoqPurplishBlue","Geoq.Normal.PurplishBlue"]]}},geoqGray(){return{layers:[["geoqGray","Geoq.Normal.Gray"]]}},geoqWarm(){return{layers:[["geoqWarm","Geoq.Normal.Warm"]]}},geoqCold(){return{layers:[["geoqCold","Geoq.Normal.Cold"]]}}};function pU(t){const e="./gis/radar.tiff";console.log(e);let n=(114.06825863001939-104.18084906665138)*.005,r=(32.396413467808586-22.54283198132819)*.005,s=114.07867152431874,u=22.563727343812303;t.addSource("radar",{type:"image",url:e,coordinates:[[s-n*.5,u+r*.5],[s+n*.5,u+r*.5],[s+n*.5,u-r*.5],[s-n*.5,u-r*.5]]}),t.addLayer({id:"radar-layer",type:"raster",source:"radar",paint:{"raster-fade-duration":0}})}function fU(t){var e="http://192.168.5.19:8080/geoserver/gwc/service/wmts?layer=mytest%3Amxcadtest2&style=&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image/png&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}";t.addSource("wmts-source",{type:"raster",tiles:[e],tileSize:256}),t.addLayer({id:"wmts-layer",type:"raster",source:"wmts-source",paint:{"raster-opacity":.95}})}function mU(){return{TianDiTu:{Normal:{Map:"http://t{s}.tianditu.com/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Satellite:{Map:"http://t{s}.tianditu.com/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Terrain:{Map:"http://t{s}.tianditu.com/DataServer?T=ter_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cta_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:14},Subdomains:["0","1","2","3","4","5","6","7"],key:""},GaoDe:{Normal:{Map:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",minzoom:0,maxzoom:18},Normal_NoTag:{Map:"https://wprd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&scl=1&ltype=11&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Satellite:{Map:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",Annotion:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Subdomains:["1","2","3","4"]},Baidu:{Normal:{Map:"http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1"},Satellite:{Map:"http://shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46",Annotion:"http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles=sl&v=020"},Subdomains:"0123456789",tileType:"bd09"},Geoq:{Normal:{Map:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}",PurplishBlue:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",Gray:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",Warm:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",minzoom:3,maxzoom:16},Subdomains:[]},OSM:{Normal:{Map:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",minzoom:0,maxzoom:18},Subdomains:["a","b","c"]}}}function gU(){return["https://0pn.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}","https://0pn.cn/maps/vt?lyrs=s,m&gl=CN&x={x}&y={y}&z={z}"]}let up,Yo;function yU(t){up.on("click",function(e){return Gt(this,null,function*(){let{lng:n,lat:r}=e.lngLat;if(t){let h=p.mx_gcj02_To_gps84(n,r);n=h.lng,r=h.lat}console.log("经纬度坐标:",JSON.stringify([n,r]));let s=dU.MercatorCoordinate.fromLngLat([n,r],0);console.log("墨卡托坐标:",JSON.stringify(Yo.map_lnglat_to_meters(n,r)));let u=Yo.mercatorCoord2CAD(s.x,s.y);console.log("CAD坐标:",JSON.stringify(u))})})}let hp=!1,Fg=!0;Fg=!1,Fg&&(hp=!1);function xU(){let t=new p.MxCADPluginMapDefaultData;t.cadOrigin=[116275.977014,19273.279085],t.mapOrigin=[114.06825863001939,22.54283198132819],t.meterInCADUnits=1,t.openFile="./demo/road.dwg.mxweb";let e=$.MxFun.getQueryString("maptype");if(!Fg)if(e=="google"){let n=p.mx_gps84_To_gcj02(t.mapOrigin[0],t.mapOrigin[1]);t.mapOrigin=[n.lng,n.lat],hp=!0,t.viewColor={red:0,green:0,blue:0}}else{let n=Bu.gdslwzj();e=="gdslwzj"?n=Bu.gdslwzj():e=="gdyx"?n=Bu.gdyx():e=="tdtsl"?n=Bu.tdtsl():e=="bdsl"?n=Bu.bdsl():e=="geoq"&&(n=Bu.geoq()),t.rasterTileLayerList=n.layers,n.key&&(t.rasterTileKey=n.key),t.providers=mU()}return t}function vU(t){Yo=t,up=t.getMapbox(),hp&&p.MxMapAddGoogleCnLayer(up,["Image","Lable"],gU()),yU(hp),Fg?fU(up):pU(up)}function _U(){return Gt(this,null,function*(){let t=new p.MxCADUiPrPoint;t.setMessage(`
指定下载范围第一点:`);let e=yield t.go();if(!e)return;t.setMessage(`
指定下载范围第二点:`),t.setUserDraw((y,x)=>{x.setColor(16711680);let M=new p.McDbPolyline;M.addVertexAt(e),M.addVertexAt(new p.McGePoint3d(e.x,y.y)),M.addVertexAt(y),M.addVertexAt(new p.McGePoint3d(y.x,e.y)),M.constantWidth=$.MxFun.screenCoordLong2Doc(2),M.isClosed=!0,x.drawMcDbEntity(M);let A=[];A.push(e.toVector3()),A.push(new THREE.Vector3(e.x,y.y)),A.push(y.toVector3()),A.push(new THREE.Vector3(y.x,e.y)),x.setColor(12868),x.drawSolid(A,.5)}),t.setDisableOsnap(!0),t.setDisableOrthoTrace(!0),t.setDynamicInputType($.DynamicInputType.kXYCoordInput);let n=yield t.go();if(!n)return;let r=Yo.cadTolnglat(e.toVector3()),s=Yo.cadTolnglat(n.toVector3()),u=Yo.map_lnglat_to_meters(r[0],r[1]),h=Yo.map_lnglat_to_meters(s[0],s[1]);if(hp&&!(Yo.outOfChina(r[0],r[1])&&Yo.outOfChina(s[0],s[1]))){let y=p.mx_gcj02_To_gps84(r[0],r[1]),x=p.mx_gcj02_To_gps84(s[0],s[1]);u=Yo.map_lnglat_to_meters(y.lng,y.lat),h=Yo.map_lnglat_to_meters(x.lng,x.lat)}let o={url:"https://0pn.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}",polygon:[u[0],u[1],h[0],h[1]],zoom:18,auto_close:!1,no_repeated_download:!0,download_dir:"",thread_count:32};$.MxFun.acutPrintf(`
 使用教程:https://help.mxdraw.com/?pid=111`),$.MxFun.acutPrintf(`
 复制下面的范围,到下载器下载地图,下载范围:`);let m=`
`+JSON.stringify([u[0],u[1],h[0],h[1]]);$.MxFun.acutPrintf(m),$.MxFun.acutPrintf(`
`),Df({method:"post",url:"http://localhost:1337/users/mxgis/download",data:o}).then(y=>{console.log(y.data),alert(JSON.stringify(y.data))}).catch(y=>{console.log("网络错误")})})}window._iconfont_svg_string_4337873='<svg><symbol id="icon-zidian" viewBox="0 0 1024 1024"><path d="M893.080181 585.210149h-86.234525v-37.615932h79.557697a57.552376 57.552376 0 0 0 1.786757-115.104753l-20.500683-0.658279 2.445035-20.312603a153.473004 153.473004 0 0 0 1.034439-17.679488A148.300813 148.300813 0 0 0 723.056167 245.72636a151.310088 151.310088 0 0 0-39.966928 5.64239l-20.782803 5.64239-3.009274-21.347042A225.695594 225.695594 0 0 0 209.222531 266.415123v18.807966l-16.739089 1.880797a130.715365 130.715365 0 0 0 14.952333 260.490331v37.615932a168.331297 168.331297 0 0 1-35.547056-332.806961 263.311526 263.311526 0 0 1 521.074702-41.753685 181.120714 181.120714 0 0 1 29.998706-2.539075 185.916746 185.916746 0 0 1 185.822706 185.728666v3.573513a95.168309 95.168309 0 0 1-15.704652 187.515423z" fill="#282D33" ></path><path d="M399.371069 341.646988H329.875634a74.573586 74.573586 0 0 0-74.291466 73.257028v478.944858-18.807966 14.576174a74.573586 74.573586 0 0 1 74.573586-74.479546h431.454744V341.646988H399.371069z" fill="#FFFFFF" ></path><path d="M255.584168 908.519088h-18.807966V414.715936A94.039831 94.039831 0 0 1 329.875634 322.839021h69.495435v37.615933H329.875634a56.423898 56.423898 0 0 0-55.4835 54.825221v399.481201a93.381552 93.381552 0 0 1 55.76562-18.807966h412.646778V360.454954H506.012238v-37.615933h274.408226v511.106481H329.875634a55.85966 55.85966 0 0 0-55.4835 52.568265v7.523187h-0.940398a18.807966 18.807966 0 0 1-17.867568 14.482134z" fill="#282D33" ></path><path d="M369.654483 392.804655H710.736949v371.363292H369.654483z" fill="#F8C44F" ></path><path d="M761.612498 815.137536H329.875634a74.573586 74.573586 0 1 0 0 149.053132h431.736864z" fill="#FFFFFF" ></path><path d="M780.420464 982.998634H329.875634a93.381552 93.381552 0 1 1 0-186.669064h450.54483zM329.875634 833.945502a55.76562 55.76562 0 1 0 0 111.437199h412.928898V833.945502z" fill="#282D33" ></path><path d="M475.073133 1024l-54.072903-34.230498-54.072902 34.230498v-127.89417h108.145805v127.89417z" fill="#34CA9D" ></path><path d="M324.327284 893.942914z" fill="#FFFFFF" ></path><path d="M324.327284 875.134948h437.285214v37.615932h-437.285214z" fill="#282D33" ></path><path d="M324.327284 810.529584z" fill="#FFFFFF" ></path><path d="M305.519318 349.076134h37.615933v461.45345h-37.615933zM520.494371 257.857498L453.067813 190.524979l-67.332519 67.332519-26.613272-26.613272L453.067813 137.392475l94.039831 93.851751-26.613273 26.613272z" fill="#282D33" ></path><path d="M436.422763 189.302462h37.615932v248.829392h-37.615932zM559.803021 694.390393l-94.039831-93.851751 26.613272-26.613272 67.426559 67.332519 67.426558-67.332519 26.519233 26.613272-93.945791 93.851751z" fill="#282D33" ></path><path d="M538.832138 393.556974h37.615933v248.829393h-37.615933z" fill="#282D33" ></path></symbol></svg>',function(t){var n=(n=document.getElementsByTagName("script"))[n.length-1],e=n.getAttribute("data-injectcss"),n=n.getAttribute("data-disable-injectsvg");if(!n){var r,s,u,h,o,m=function(M,A){A.parentNode.insertBefore(M,A)};if(e&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(M){console&&console.log(M)}}r=function(){var M,A=document.createElement("div");A.innerHTML=t._iconfont_svg_string_4337873,(A=A.getElementsByTagName("svg")[0])&&(A.setAttribute("aria-hidden","true"),A.style.position="absolute",A.style.width=0,A.style.height=0,A.style.overflow="hidden",A=A,(M=document.body).firstChild?m(A,M.firstChild):M.appendChild(A))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(s=function(){document.removeEventListener("DOMContentLoaded",s,!1),r()},document.addEventListener("DOMContentLoaded",s,!1)):document.attachEvent&&(u=r,h=t.document,o=!1,x(),h.onreadystatechange=function(){h.readyState=="complete"&&(h.onreadystatechange=null,y())})}function y(){o||(o=!0,u())}function x(){try{h.documentElement.doScroll("left")}catch(M){return void setTimeout(x,50)}y()}}(window),window._iconfont_svg_string_4604696='<svg><symbol id="icon-guding1" viewBox="0 0 1024 1024"><path d="M251.15000029 471.5l214.425 150.1875 183.74999942 128.62500029a243.7875 243.7875 0 0 0 7.01250029-235.42500058l-10.31249971-20.1375 160.61249971-229.3875-153.60000029-107.55-160.61249971 229.3875-22.42500029-2.77499971a243.7875 243.7875 0 0 0-218.84999942 87.11250029z m192.9375 180.9l-204.37500058 291.825a18.74999971 18.74999971 0 1 1-30.67499971-21.4875L413.37500029 630.87499971l-261.1125-182.84999942a18.74999971 18.74999971 0 1 1 21.4875-30.7125l46.61249942 32.625a281.28750029 281.28750029 0 0 1 254.32500058-102.75000029l147.63749942-210.89999971-46.04999942-32.25000058a18.74999971 18.74999971 0 0 1 21.4875-30.74999942l307.19999971 215.1a18.74999971 18.74999971 0 1 1-21.52500029 30.74999942l-46.08749971-32.2875-147.63750029 210.86250029a281.28750029 281.28750029 0 0 1-9.59999942 274.12499971l46.575 32.625a18.74999971 18.74999971 0 1 1-21.4875 30.75000029l-261.1125-182.85000029z" fill="#89cbfa" ></path></symbol><symbol id="icon-guding" viewBox="0 0 1024 1024"><path d="M381.298 418.828h-157.703l-37.575 38.272 155.61 158.377-278.212 345.128 356.040-265.838 154.71 157.41 38.813-39.51 2.407-157.972 238.838-313.29 71.685 73.013 34.695-35.28-310.185-315.743-34.672 35.257 77.287 79.402-311.737 240.773z"  ></path></symbol><symbol id="icon-dengpao1" viewBox="0 0 1024 1024"><path d="M344.73 841.5c0 8.28 6.77 15.31 15.31 15.31h32.75v1.26c0 40.65 51.69 73.52 115.43 73.52s115.18-32.87 115.18-73.52v-1.26h28.48c8.53 0 15.31-7.03 15.31-15.31v-59.95H344.96c-0.23 33.17-0.23 59.95-0.23 59.95zM512.1 98.23c-187.2 0-338.76 140.02-338.76 312.67 0 89.83 40.9 170.89 106.65 227.85 14.1 12.12 26.16 26.24 35.98 41.69h137.08l-31.49-352.21 4.6-0.02v-0.1h149.83v0.11l2.61 0.01-31.49 352.21h149.23c6.92-8.25 14.58-15.91 23.54-22.37 79.8-57.21 130.99-146.55 130.99-247.17C850.86 238.25 699.3 98.23 512.1 98.23zM343.93 759.53h323.25v-1.34c0-17.26 3.88-33.93 10.87-49.21H330.27c6.72 16.12 11.77 32.96 13.66 50.55z" fill="#F7B52C" ></path><path d="M546.38 357.44h-92.6l28.87 323h34.85z" fill="#F7B52C" ></path></symbol><symbol id="icon-duigou" viewBox="0 0 1024 1024"><path d="M387.072 611.328L236.6464 460.8 128 569.3952l259.072 259.1232 515.1232-515.072L793.6 204.8z" fill="#07A35A" ></path></symbol><symbol id="icon-jiantou_xiangyou" viewBox="0 0 1024 1024"><path d="M729.6 448H128v85.333333h601.6L597.333333 665.6l59.733334 59.733333 234.666666-234.666666L661.333333 256l-59.733333 59.733333 128 132.266667z" fill="#444444" ></path></symbol><symbol id="icon-jiantou_xiangzuo" viewBox="0 0 1024 1024"><path d="M290.133333 448H896v85.333333H290.133333l132.266667 132.266667L362.666667 725.333333 128 490.666667 362.666667 256l59.733333 59.733333-132.266667 132.266667z" fill="#444444" ></path></symbol><symbol id="icon-shezhi" viewBox="0 0 1024 1024"><path d="M519.9 647.4c-44.8 7.4-90.4-6.9-122.5-38.3-32.1-31.4-46.6-76.2-39-120 9.4-56.8 56.2-102.7 114.2-112.1 44.9-7.6 90.7 6.7 122.9 38.2 32.2 31.6 46.7 76.5 38.9 120.4-9.7 56.9-56.5 102.6-114.5 111.8M848.4 559l66-40.4c10.5-6.4 15.6-18.6 12.9-30.4L895 349.3c-2.7-11.8-12.8-20.6-25.1-21.9l-77.5-8.4c-7.7-0.8-14.7-4.6-19.5-10.5l-13-16c-4.8-5.9-7-13.5-6.1-21l8.9-75.7c1.4-12-5.1-23.6-16.2-28.9l-131-61.8c-11.1-5.2-24.4-3-33.2 5.5l-55 54c-5.4 5.3-12.8 8.4-20.6 8.4H486c-7.7 0-15.1-3-20.6-8.4l-55-54c-8.7-8.6-22-10.8-33.2-5.5l-130.9 61.8c-11.1 5.3-17.6 16.8-16.2 28.9l8.9 75.8c0.9 7.5-1.3 15-6.1 21L220 308.4c-4.8 5.9-11.8 9.7-19.5 10.5l-77.5 8.5c-12.3 1.3-22.3 10.1-25.1 21.9L65.5 488.1c-2.7 11.8 2.4 24 12.9 30.4l66 40.5c6.5 4 11.2 10.4 12.9 17.8l4.6 19.9c1.7 7.4 0.4 15.1-3.7 21.5l-41.6 64.5c-6.6 10.2-5.8 23.4 1.9 32.9l90.7 111.3c7.7 9.5 20.7 13.1 32.3 9.1l73.5-25.3c7.3-2.5 15.3-2.1 22.2 1.2l18.7 8.8c7 3.3 12.3 9.1 14.8 16.3l25.6 72c4.1 11.4 15.1 19.1 27.4 19.1H569c12.4 0 23.4-7.7 27.4-19.1l25.6-72c2.5-7.1 7.9-13 14.8-16.3l18.7-8.8c6.9-3.3 14.9-3.7 22.2-1.2l73.5 25.3c11.7 4 24.6 0.4 32.3-9.1l90.7-111.3c7.7-9.5 8.4-22.7 1.9-32.9l-41.6-64.5c-4.1-6.4-5.5-14.1-3.8-21.5l4.6-19.8c1.9-7.5 6.5-13.9 13.1-17.9" fill="" ></path></symbol><symbol id="icon-dengpao" viewBox="0 0 1024 1024"><path d="M661.333333 916.394667a21.333333 21.333333 0 0 1 21.333334 21.333333v42.666667a21.333333 21.333333 0 0 1-21.333334 21.333333h-298.666666a21.333333 21.333333 0 0 1-21.333334-21.333333v-42.666667a21.333333 21.333333 0 0 1 21.333334-21.333333h298.666666z m-149.333333-896a384 384 0 0 1 170.709333 728.064L682.666667 831.061333a42.666667 42.666667 0 0 1-42.666667 42.666667H384a42.666667 42.666667 0 0 1-42.666667-42.666667v-82.602666A384 384 0 0 1 512 20.394667z m0 85.333333a298.666667 298.666667 0 0 0-85.333333 584.96v97.706667h170.666666l0.042667-97.706667A298.666667 298.666667 0 0 0 512 105.728z" fill="#000000" opacity=".65" ></path></symbol></svg>',function(t){var n=(n=document.getElementsByTagName("script"))[n.length-1],e=n.getAttribute("data-injectcss"),n=n.getAttribute("data-disable-injectsvg");if(!n){var r,s,u,h,o,m=function(M,A){A.parentNode.insertBefore(M,A)};if(e&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(M){console&&console.log(M)}}r=function(){var M,A=document.createElement("div");A.innerHTML=t._iconfont_svg_string_4604696,(A=A.getElementsByTagName("svg")[0])&&(A.setAttribute("aria-hidden","true"),A.style.position="absolute",A.style.width=0,A.style.height=0,A.style.overflow="hidden",A=A,(M=document.body).firstChild?m(A,M.firstChild):M.appendChild(A))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(s=function(){document.removeEventListener("DOMContentLoaded",s,!1),r()},document.addEventListener("DOMContentLoaded",s,!1)):document.attachEvent&&(u=r,h=t.document,o=!1,x(),h.onreadystatechange=function(){h.readyState=="complete"&&(h.onreadystatechange=null,y())})}function y(){o||(o=!0,u())}function x(){try{h.documentElement.doScroll("left")}catch(M){return void setTimeout(x,50)}y()}}(window),window._iconfont_svg_string_4666894='<svg><symbol id="icon-a-1" viewBox="0 0 1024 1024"><path d="M429.12 896L256 628.16l23.04-20.16 173.12 267.84z" fill="#ffffff" ></path><path d="M456 893.76l-28.16-12.8L803.84 192l28.16 12.8z" fill="#ffffff" ></path><path d="M256 608h336v32H256z" fill="#ffffff" ></path></symbol><symbol id="icon-a-2" viewBox="0 0 1024 1024"><path d="M429.12 896L256 628.16l23.04-20.16 173.12 267.84z" fill="#000000" ></path><path d="M456 893.76l-28.16-12.8L803.84 192l28.16 12.8z" fill="#000000" ></path><path d="M256 608h336v32H256z" fill="#000000" ></path></symbol></svg>',(t=>{var e=(n=(n=document.getElementsByTagName("script"))[n.length-1]).getAttribute("data-injectcss"),n=n.getAttribute("data-disable-injectsvg");if(!n){var r,s,u,h,o,m=function(M,A){A.parentNode.insertBefore(M,A)};if(e&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(M){console&&console.log(M)}}r=function(){var M,A=document.createElement("div");A.innerHTML=t._iconfont_svg_string_4666894,(A=A.getElementsByTagName("svg")[0])&&(A.setAttribute("aria-hidden","true"),A.style.position="absolute",A.style.width=0,A.style.height=0,A.style.overflow="hidden",A=A,(M=document.body).firstChild?m(A,M.firstChild):M.appendChild(A))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(s=function(){document.removeEventListener("DOMContentLoaded",s,!1),r()},document.addEventListener("DOMContentLoaded",s,!1)):document.attachEvent&&(u=r,h=t.document,o=!1,x(),h.onreadystatechange=function(){h.readyState=="complete"&&(h.onreadystatechange=null,y())})}function y(){o||(o=!0,u())}function x(){try{h.documentElement.doScroll("left")}catch(M){return void setTimeout(x,50)}y()}})(window);var bU=function(){function t(Lt){ci.call(this,Lt),this.dracoLoader=null,this.ddsLoader=null}t.prototype=Object.assign(Object.create(ci.prototype),{constructor:t,load:function(Lt,bt,qt,Wt){var Nt=this,se;this.resourcePath!==""?se=this.resourcePath:this.path!==""?se=this.path:se=Bl.extractUrlBase(Lt),Nt.manager.itemStart(Lt);var _t=function(Ct){Wt?Wt(Ct):console.error(Ct),Nt.manager.itemError(Lt),Nt.manager.itemEnd(Lt)},wt=new Do(Nt.manager);wt.setPath(this.path),wt.setResponseType("arraybuffer"),Nt.crossOrigin==="use-credentials"&&wt.setWithCredentials(!0),wt.load(Lt,function(Ct){try{Nt.parse(Ct,se,function(Mt){bt(Mt),Nt.manager.itemEnd(Lt)},_t)}catch(Mt){_t(Mt)}},qt,_t)},setDRACOLoader:function(Lt){return this.dracoLoader=Lt,this},setDDSLoader:function(Lt){return this.ddsLoader=Lt,this},parse:function(Lt,bt,qt,Wt){var Nt,se={};if(typeof Lt=="string")Nt=Lt;else{var _t=Bl.decodeText(new Uint8Array(Lt,0,4));if(_t===h){try{se[n.KHR_BINARY_GLTF]=new y(Lt)}catch(pe){Wt&&Wt(pe);return}Nt=se[n.KHR_BINARY_GLTF].content}else Nt=Bl.decodeText(new Uint8Array(Lt))}var wt=JSON.parse(Nt);if(wt.asset===void 0||wt.asset.version[0]<2){Wt&&Wt(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}if(wt.extensionsUsed)for(var Ct=0;Ct<wt.extensionsUsed.length;++Ct){var Mt=wt.extensionsUsed[Ct],jt=wt.extensionsRequired||[];switch(Mt){case n.KHR_LIGHTS_PUNCTUAL:se[Mt]=new s(wt);break;case n.KHR_MATERIALS_UNLIT:se[Mt]=new u;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:se[Mt]=new T;break;case n.KHR_DRACO_MESH_COMPRESSION:se[Mt]=new x(wt,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:se[Mt]=new r(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:se[Mt]=new M;break;case n.KHR_MESH_QUANTIZATION:se[Mt]=new P;break;default:jt.indexOf(Mt)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+Mt+'".')}}var ee=new le(wt,se,{path:bt||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});ee.parse(qt,Wt)}});function e(){var Lt={};return{get:function(bt){return Lt[bt]},add:function(bt,qt){Lt[bt]=qt},remove:function(bt){delete Lt[bt]},removeAll:function(){Lt={}}}}var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(Lt){if(!Lt)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=Lt}function s(Lt){this.name=n.KHR_LIGHTS_PUNCTUAL;var bt=Lt.extensions&&Lt.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=bt.lights||[]}s.prototype.loadLight=function(Lt){var bt=this.lightDefs[Lt],qt,Wt=new sn(16777215);bt.color!==void 0&&Wt.fromArray(bt.color);var Nt=bt.range!==void 0?bt.range:0;switch(bt.type){case"directional":qt=new $m(Wt),qt.target.position.set(0,0,-1),qt.add(qt.target);break;case"point":qt=new Qm(Wt),qt.distance=Nt;break;case"spot":qt=new Jm(Wt),qt.distance=Nt,bt.spot=bt.spot||{},bt.spot.innerConeAngle=bt.spot.innerConeAngle!==void 0?bt.spot.innerConeAngle:0,bt.spot.outerConeAngle=bt.spot.outerConeAngle!==void 0?bt.spot.outerConeAngle:Math.PI/4,qt.angle=bt.spot.outerConeAngle,qt.penumbra=1-bt.spot.innerConeAngle/bt.spot.outerConeAngle,qt.target.position.set(0,0,-1),qt.add(qt.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+bt.type+'".')}return qt.position.set(0,0,0),qt.decay=2,bt.intensity!==void 0&&(qt.intensity=bt.intensity),qt.name=bt.name||"light_"+Lt,Promise.resolve(qt)};function u(){this.name=n.KHR_MATERIALS_UNLIT}u.prototype.getMaterialType=function(){return gr},u.prototype.extendParams=function(Lt,bt,qt){var Wt=[];Lt.color=new sn(1,1,1),Lt.opacity=1;var Nt=bt.pbrMetallicRoughness;if(Nt){if(Array.isArray(Nt.baseColorFactor)){var se=Nt.baseColorFactor;Lt.color.fromArray(se),Lt.opacity=se[3]}Nt.baseColorTexture!==void 0&&Wt.push(qt.assignTexture(Lt,"map",Nt.baseColorTexture))}return Promise.all(Wt)};var h="glTF",o=12,m={JSON:1313821514,BIN:5130562};function y(Lt){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var bt=new DataView(Lt,0,o);if(this.header={magic:Bl.decodeText(new Uint8Array(Lt.slice(0,4))),version:bt.getUint32(4,!0),length:bt.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var qt=new DataView(Lt,o),Wt=0;Wt<qt.byteLength;){var Nt=qt.getUint32(Wt,!0);Wt+=4;var se=qt.getUint32(Wt,!0);if(Wt+=4,se===m.JSON){var _t=new Uint8Array(Lt,o+Wt,Nt);this.content=Bl.decodeText(_t)}else if(se===m.BIN){var wt=o+Wt;this.body=Lt.slice(wt,wt+Nt)}Wt+=Nt}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function x(Lt,bt){if(!bt)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=Lt,this.dracoLoader=bt,this.dracoLoader.preload()}x.prototype.decodePrimitive=function(Lt,bt){var qt=this.json,Wt=this.dracoLoader,Nt=Lt.extensions[this.name].bufferView,se=Lt.extensions[this.name].attributes,_t={},wt={},Ct={};for(var Mt in se){var jt=V[Mt]||Mt.toLowerCase();_t[jt]=se[Mt]}for(Mt in Lt.attributes){var jt=V[Mt]||Mt.toLowerCase();if(se[Mt]!==void 0){var ee=qt.accessors[Lt.attributes[Mt]],pe=z[ee.componentType];Ct[jt]=pe,wt[jt]=ee.normalized===!0}}return bt.getDependency("bufferView",Nt).then(function(Te){return new Promise(function(We){Wt.decodeDracoFile(Te,function(yt){for(var St in yt.attributes){var Ee=yt.attributes[St],be=wt[St];be!==void 0&&(Ee.normalized=be)}We(yt)},_t,Ct)})})};function M(){this.name=n.KHR_TEXTURE_TRANSFORM}M.prototype.extendTexture=function(Lt,bt){return Lt=Lt.clone(),bt.offset!==void 0&&Lt.offset.fromArray(bt.offset),bt.rotation!==void 0&&(Lt.rotation=bt.rotation),bt.scale!==void 0&&Lt.repeat.fromArray(bt.scale),bt.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Lt.needsUpdate=!0,Lt};function A(Lt){Yr.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var bt=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),qt=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),Wt=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),Nt=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),se=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join(`
`),_t={specular:{value:new sn().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=_t,this.onBeforeCompile=function(wt){for(var Ct in _t)wt.uniforms[Ct]=_t[Ct];wt.fragmentShader=wt.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),wt.fragmentShader=wt.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),wt.fragmentShader=wt.fragmentShader.replace("#include <roughnessmap_pars_fragment>",bt),wt.fragmentShader=wt.fragmentShader.replace("#include <metalnessmap_pars_fragment>",qt),wt.fragmentShader=wt.fragmentShader.replace("#include <roughnessmap_fragment>",Wt),wt.fragmentShader=wt.fragmentShader.replace("#include <metalnessmap_fragment>",Nt),wt.fragmentShader=wt.fragmentShader.replace("#include <lights_physical_fragment>",se)},Object.defineProperties(this,{specular:{get:function(){return _t.specular.value},set:function(wt){_t.specular.value=wt}},specularMap:{get:function(){return _t.specularMap.value},set:function(wt){_t.specularMap.value=wt}},glossiness:{get:function(){return _t.glossiness.value},set:function(wt){_t.glossiness.value=wt}},glossinessMap:{get:function(){return _t.glossinessMap.value},set:function(wt){_t.glossinessMap.value=wt,wt?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Lt)}A.prototype=Object.create(Yr.prototype),A.prototype.constructor=A,A.prototype.copy=function(Lt){return Yr.prototype.copy.call(this,Lt),this.specularMap=Lt.specularMap,this.specular.copy(Lt.specular),this.glossinessMap=Lt.glossinessMap,this.glossiness=Lt.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this};function T(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return A},extendParams:function(Lt,bt,qt){var Wt=bt.extensions[this.name];Lt.color=new sn(1,1,1),Lt.opacity=1;var Nt=[];if(Array.isArray(Wt.diffuseFactor)){var se=Wt.diffuseFactor;Lt.color.fromArray(se),Lt.opacity=se[3]}if(Wt.diffuseTexture!==void 0&&Nt.push(qt.assignTexture(Lt,"map",Wt.diffuseTexture)),Lt.emissive=new sn(0,0,0),Lt.glossiness=Wt.glossinessFactor!==void 0?Wt.glossinessFactor:1,Lt.specular=new sn(1,1,1),Array.isArray(Wt.specularFactor)&&Lt.specular.fromArray(Wt.specularFactor),Wt.specularGlossinessTexture!==void 0){var _t=Wt.specularGlossinessTexture;Nt.push(qt.assignTexture(Lt,"glossinessMap",_t)),Nt.push(qt.assignTexture(Lt,"specularMap",_t))}return Promise.all(Nt)},createMaterial:function(Lt){var bt=new A(Lt);return bt.fog=!0,bt.color=Lt.color,bt.map=Lt.map===void 0?null:Lt.map,bt.lightMap=null,bt.lightMapIntensity=1,bt.aoMap=Lt.aoMap===void 0?null:Lt.aoMap,bt.aoMapIntensity=1,bt.emissive=Lt.emissive,bt.emissiveIntensity=1,bt.emissiveMap=Lt.emissiveMap===void 0?null:Lt.emissiveMap,bt.bumpMap=Lt.bumpMap===void 0?null:Lt.bumpMap,bt.bumpScale=1,bt.normalMap=Lt.normalMap===void 0?null:Lt.normalMap,bt.normalMapType=vl,Lt.normalScale&&(bt.normalScale=Lt.normalScale),bt.displacementMap=null,bt.displacementScale=1,bt.displacementBias=0,bt.specularMap=Lt.specularMap===void 0?null:Lt.specularMap,bt.specular=Lt.specular,bt.glossinessMap=Lt.glossinessMap===void 0?null:Lt.glossinessMap,bt.glossiness=Lt.glossiness,bt.alphaMap=null,bt.envMap=Lt.envMap===void 0?null:Lt.envMap,bt.envMapIntensity=1,bt.refractionRatio=.98,bt}}}function P(){this.name=n.KHR_MESH_QUANTIZATION}function D(Lt,bt,qt,Wt){Xr.call(this,Lt,bt,qt,Wt)}D.prototype=Object.create(Xr.prototype),D.prototype.constructor=D,D.prototype.copySampleValue_=function(Lt){for(var bt=this.resultBuffer,qt=this.sampleValues,Wt=this.valueSize,Nt=Lt*Wt*3+Wt,se=0;se!==Wt;se++)bt[se]=qt[Nt+se];return bt},D.prototype.beforeStart_=D.prototype.copySampleValue_,D.prototype.afterEnd_=D.prototype.copySampleValue_,D.prototype.interpolate_=function(Lt,bt,qt,Wt){for(var Nt=this.resultBuffer,se=this.sampleValues,_t=this.valueSize,wt=_t*2,Ct=_t*3,Mt=Wt-bt,jt=(qt-bt)/Mt,ee=jt*jt,pe=ee*jt,Te=Lt*Ct,We=Te-Ct,yt=-2*pe+3*ee,St=pe-ee,Ee=1-yt,be=St-ee+jt,En=0;En!==_t;En++){var mn=se[We+En+_t],an=se[We+En+wt]*Mt,yn=se[Te+En+_t],Tn=se[Te+En]*Mt;Nt[En]=Ee*mn+be*an+yt*yn+St*Tn}return Nt};var k={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},z={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},O={9728:Yi,9729:$i,9984:Hf,9985:U0,9986:Wf,9987:Ic},U={33071:Dr,33648:Xh,10497:xl},H={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},V={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},W={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},K={CUBICSPLINE:void 0,LINEAR:Bc,STEP:Jh},Z={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},tt={"image/png":No,"image/jpeg":Ns};function at(Lt,bt){return typeof Lt!="string"||Lt===""?"":(/^https?:\/\//i.test(bt)&&/^\//.test(Lt)&&(bt=bt.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Lt)||/^data:.*,.*$/i.test(Lt)||/^blob:.*$/i.test(Lt)?Lt:bt+Lt)}function st(Lt){return Lt.DefaultMaterial===void 0&&(Lt.DefaultMaterial=new Yr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Dc})),Lt.DefaultMaterial}function nt(Lt,bt,qt){for(var Wt in qt.extensions)Lt[Wt]===void 0&&(bt.userData.gltfExtensions=bt.userData.gltfExtensions||{},bt.userData.gltfExtensions[Wt]=qt.extensions[Wt])}function ct(Lt,bt){bt.extras!==void 0&&(typeof bt.extras=="object"?Object.assign(Lt.userData,bt.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+bt.extras))}function xt(Lt,bt,qt){for(var Wt=!1,Nt=!1,se=0,_t=bt.length;se<_t;se++){var wt=bt[se];if(wt.POSITION!==void 0&&(Wt=!0),wt.NORMAL!==void 0&&(Nt=!0),Wt&&Nt)break}if(!Wt&&!Nt)return Promise.resolve(Lt);for(var Ct=[],Mt=[],se=0,_t=bt.length;se<_t;se++){var wt=bt[se];if(Wt){var jt=wt.POSITION!==void 0?qt.getDependency("accessor",wt.POSITION):Lt.attributes.position;Ct.push(jt)}if(Nt){var jt=wt.NORMAL!==void 0?qt.getDependency("accessor",wt.NORMAL):Lt.attributes.normal;Mt.push(jt)}}return Promise.all([Promise.all(Ct),Promise.all(Mt)]).then(function(ee){var pe=ee[0],Te=ee[1];return Wt&&(Lt.morphAttributes.position=pe),Nt&&(Lt.morphAttributes.normal=Te),Lt.morphTargetsRelative=!0,Lt})}function vt(Lt,bt){if(Lt.updateMorphTargets(),bt.weights!==void 0)for(var qt=0,Wt=bt.weights.length;qt<Wt;qt++)Lt.morphTargetInfluences[qt]=bt.weights[qt];if(bt.extras&&Array.isArray(bt.extras.targetNames)){var Nt=bt.extras.targetNames;if(Lt.morphTargetInfluences.length===Nt.length){Lt.morphTargetDictionary={};for(var qt=0,Wt=Nt.length;qt<Wt;qt++)Lt.morphTargetDictionary[Nt[qt]]=qt}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Zt(Lt){var bt=Lt.extensions&&Lt.extensions[n.KHR_DRACO_MESH_COMPRESSION],qt;return bt?qt="draco:"+bt.bufferView+":"+bt.indices+":"+ce(bt.attributes):qt=Lt.indices+":"+ce(Lt.attributes)+":"+Lt.mode,qt}function ce(Lt){for(var bt="",qt=Object.keys(Lt).sort(),Wt=0,Nt=qt.length;Wt<Nt;Wt++)bt+=qt[Wt]+":"+Lt[qt[Wt]]+";";return bt}function le(Lt,bt,qt){this.json=Lt||{},this.extensions=bt||{},this.options=qt||{},this.cache=new e,this.primitiveCache={},this.textureLoader=new zd(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new Do(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}le.prototype.parse=function(Lt,bt){var qt=this,Wt=this.json,Nt=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(se){var _t={scene:se[0][Wt.scene||0],scenes:se[0],animations:se[1],cameras:se[2],asset:Wt.asset,parser:qt,userData:{}};nt(Nt,_t,Wt),ct(_t,Wt),Lt(_t)}).catch(bt)},le.prototype.markDefs=function(){for(var Lt=this.json.nodes||[],bt=this.json.skins||[],qt=this.json.meshes||[],Wt={},Nt={},se=0,_t=bt.length;se<_t;se++)for(var wt=bt[se].joints,Ct=0,Mt=wt.length;Ct<Mt;Ct++)Lt[wt[Ct]].isBone=!0;for(var jt=0,ee=Lt.length;jt<ee;jt++){var pe=Lt[jt];pe.mesh!==void 0&&(Wt[pe.mesh]===void 0&&(Wt[pe.mesh]=Nt[pe.mesh]=0),Wt[pe.mesh]++,pe.skin!==void 0&&(qt[pe.mesh].isSkinnedMesh=!0))}this.json.meshReferences=Wt,this.json.meshUses=Nt},le.prototype.getDependency=function(Lt,bt){var qt=Lt+":"+bt,Wt=this.cache.get(qt);if(!Wt){switch(Lt){case"scene":Wt=this.loadScene(bt);break;case"node":Wt=this.loadNode(bt);break;case"mesh":Wt=this.loadMesh(bt);break;case"accessor":Wt=this.loadAccessor(bt);break;case"bufferView":Wt=this.loadBufferView(bt);break;case"buffer":Wt=this.loadBuffer(bt);break;case"material":Wt=this.loadMaterial(bt);break;case"texture":Wt=this.loadTexture(bt);break;case"skin":Wt=this.loadSkin(bt);break;case"animation":Wt=this.loadAnimation(bt);break;case"camera":Wt=this.loadCamera(bt);break;case"light":Wt=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(bt);break;default:throw new Error("Unknown type: "+Lt)}this.cache.add(qt,Wt)}return Wt},le.prototype.getDependencies=function(Lt){var bt=this.cache.get(Lt);if(!bt){var qt=this,Wt=this.json[Lt+(Lt==="mesh"?"es":"s")]||[];bt=Promise.all(Wt.map(function(Nt,se){return qt.getDependency(Lt,se)})),this.cache.add(Lt,bt)}return bt},le.prototype.loadBuffer=function(Lt){var bt=this.json.buffers[Lt],qt=this.fileLoader;if(bt.type&&bt.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+bt.type+" buffer type is not supported.");if(bt.uri===void 0&&Lt===0)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var Wt=this.options;return new Promise(function(Nt,se){qt.load(at(bt.uri,Wt.path),Nt,void 0,function(){se(new Error('THREE.GLTFLoader: Failed to load buffer "'+bt.uri+'".'))})})},le.prototype.loadBufferView=function(Lt){var bt=this.json.bufferViews[Lt];return this.getDependency("buffer",bt.buffer).then(function(qt){var Wt=bt.byteLength||0,Nt=bt.byteOffset||0;return qt.slice(Nt,Nt+Wt)})},le.prototype.loadAccessor=function(Lt){var bt=this,qt=this.json,Wt=this.json.accessors[Lt];if(Wt.bufferView===void 0&&Wt.sparse===void 0)return Promise.resolve(null);var Nt=[];return Wt.bufferView!==void 0?Nt.push(this.getDependency("bufferView",Wt.bufferView)):Nt.push(null),Wt.sparse!==void 0&&(Nt.push(this.getDependency("bufferView",Wt.sparse.indices.bufferView)),Nt.push(this.getDependency("bufferView",Wt.sparse.values.bufferView))),Promise.all(Nt).then(function(se){var _t=se[0],wt=H[Wt.type],Ct=z[Wt.componentType],Mt=Ct.BYTES_PER_ELEMENT,jt=Mt*wt,ee=Wt.byteOffset||0,pe=Wt.bufferView!==void 0?qt.bufferViews[Wt.bufferView].byteStride:void 0,Te=Wt.normalized===!0,We,yt;if(pe&&pe!==jt){var St=Math.floor(ee/pe),Ee="InterleavedBuffer:"+Wt.bufferView+":"+Wt.componentType+":"+St+":"+Wt.count,be=bt.cache.get(Ee);be||(We=new Ct(_t,St*pe,Wt.count*pe/Mt),be=new Ks(We,pe/Mt),bt.cache.add(Ee,be)),yt=new fd(be,wt,ee%pe/Mt,Te)}else _t===null?We=new Ct(Wt.count*wt):We=new Ct(_t,ee,Wt.count*wt),yt=new Nn(We,wt,Te);if(Wt.sparse!==void 0){var En=H.SCALAR,mn=z[Wt.sparse.indices.componentType],an=Wt.sparse.indices.byteOffset||0,yn=Wt.sparse.values.byteOffset||0,Tn=new mn(se[1],an,Wt.sparse.count*En),pn=new Ct(se[2],yn,Wt.sparse.count*wt);_t!==null&&(yt=new Nn(yt.array.slice(),yt.itemSize,yt.normalized));for(var qe=0,hn=Tn.length;qe<hn;qe++){var Je=Tn[qe];if(yt.setX(Je,pn[qe*wt]),wt>=2&&yt.setY(Je,pn[qe*wt+1]),wt>=3&&yt.setZ(Je,pn[qe*wt+2]),wt>=4&&yt.setW(Je,pn[qe*wt+3]),wt>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return yt})},le.prototype.loadTexture=function(Lt){var bt=this,qt=this.json,Wt=this.options,Nt=this.textureLoader,se=window.URL||window.webkitURL,_t=qt.textures[Lt],wt=_t.extensions||{},Ct;wt[n.MSFT_TEXTURE_DDS]?Ct=qt.images[wt[n.MSFT_TEXTURE_DDS].source]:Ct=qt.images[_t.source];var Mt=Ct.uri,jt=!1;return Ct.bufferView!==void 0&&(Mt=bt.getDependency("bufferView",Ct.bufferView).then(function(ee){jt=!0;var pe=new Blob([ee],{type:Ct.mimeType});return Mt=se.createObjectURL(pe),Mt})),Promise.resolve(Mt).then(function(ee){var pe=Wt.manager.getHandler(ee);return pe||(pe=wt[n.MSFT_TEXTURE_DDS]?bt.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:Nt),new Promise(function(Te,We){pe.load(at(ee,Wt.path),Te,void 0,We)})}).then(function(ee){jt===!0&&se.revokeObjectURL(Mt),ee.flipY=!1,_t.name!==void 0&&(ee.name=_t.name),Ct.mimeType in tt&&(ee.format=tt[Ct.mimeType]);var pe=qt.samplers||{},Te=pe[_t.sampler]||{};return ee.magFilter=O[Te.magFilter]||$i,ee.minFilter=O[Te.minFilter]||Ic,ee.wrapS=U[Te.wrapS]||xl,ee.wrapT=U[Te.wrapT]||xl,ee})},le.prototype.assignTexture=function(Lt,bt,qt){var Wt=this;return this.getDependency("texture",qt.index).then(function(Nt){if(!Nt.isCompressedTexture)switch(bt){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":Nt.format=Ns;break}if(qt.texCoord!==void 0&&qt.texCoord!=0&&!(bt==="aoMap"&&qt.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+qt.texCoord+" for texture "+bt+" not yet supported."),Wt.extensions[n.KHR_TEXTURE_TRANSFORM]){var se=qt.extensions!==void 0?qt.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;se&&(Nt=Wt.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(Nt,se))}Lt[bt]=Nt})},le.prototype.assignFinalMaterial=function(Lt){var bt=Lt.geometry,qt=Lt.material;this.extensions;var Wt=bt.attributes.tangent!==void 0,Nt=bt.attributes.color!==void 0,se=bt.attributes.normal===void 0,_t=Lt.isSkinnedMesh===!0,wt=Object.keys(bt.morphAttributes).length>0,Ct=wt&&bt.morphAttributes.normal!==void 0;if(Lt.isPoints){var Mt="PointsMaterial:"+qt.uuid,jt=this.cache.get(Mt);jt||(jt=new Aa,zn.prototype.copy.call(jt,qt),jt.color.copy(qt.color),jt.map=qt.map,jt.sizeAttenuation=!1,this.cache.add(Mt,jt)),qt=jt}else if(Lt.isLine){var Mt="LineBasicMaterial:"+qt.uuid,ee=this.cache.get(Mt);ee||(ee=new Vi,zn.prototype.copy.call(ee,qt),ee.color.copy(qt.color),this.cache.add(Mt,ee)),qt=ee}if(Wt||Nt||se||_t||wt){var Mt="ClonedMaterial:"+qt.uuid+":";qt.isGLTFSpecularGlossinessMaterial&&(Mt+="specular-glossiness:"),_t&&(Mt+="skinning:"),Wt&&(Mt+="vertex-tangents:"),Nt&&(Mt+="vertex-colors:"),se&&(Mt+="flat-shading:"),wt&&(Mt+="morph-targets:"),Ct&&(Mt+="morph-normals:");var pe=this.cache.get(Mt);pe||(pe=qt.clone(),_t&&(pe.skinning=!0),Wt&&(pe.vertexTangents=!0),Nt&&(pe.vertexColors=Rc),se&&(pe.flatShading=!0),wt&&(pe.morphTargets=!0),Ct&&(pe.morphNormals=!0),this.cache.add(Mt,pe)),qt=pe}qt.aoMap&&bt.attributes.uv2===void 0&&bt.attributes.uv!==void 0&&bt.setAttribute("uv2",new Nn(bt.attributes.uv.array,2)),qt.normalScale&&!Wt&&(qt.normalScale.y=-qt.normalScale.y),Lt.material=qt},le.prototype.loadMaterial=function(Lt){var bt=this,qt=this.json,Wt=this.extensions,Nt=qt.materials[Lt],se,_t={},wt=Nt.extensions||{},Ct=[];if(wt[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var Mt=Wt[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];se=Mt.getMaterialType(),Ct.push(Mt.extendParams(_t,Nt,bt))}else if(wt[n.KHR_MATERIALS_UNLIT]){var jt=Wt[n.KHR_MATERIALS_UNLIT];se=jt.getMaterialType(),Ct.push(jt.extendParams(_t,Nt,bt))}else{se=Yr;var ee=Nt.pbrMetallicRoughness||{};if(_t.color=new sn(1,1,1),_t.opacity=1,Array.isArray(ee.baseColorFactor)){var pe=ee.baseColorFactor;_t.color.fromArray(pe),_t.opacity=pe[3]}ee.baseColorTexture!==void 0&&Ct.push(bt.assignTexture(_t,"map",ee.baseColorTexture)),_t.metalness=ee.metallicFactor!==void 0?ee.metallicFactor:1,_t.roughness=ee.roughnessFactor!==void 0?ee.roughnessFactor:1,ee.metallicRoughnessTexture!==void 0&&(Ct.push(bt.assignTexture(_t,"metalnessMap",ee.metallicRoughnessTexture)),Ct.push(bt.assignTexture(_t,"roughnessMap",ee.metallicRoughnessTexture)))}Nt.doubleSided===!0&&(_t.side=Wh);var Te=Nt.alphaMode||Z.OPAQUE;return Te===Z.BLEND?_t.transparent=!0:(_t.transparent=!1,Te===Z.MASK&&(_t.alphaTest=Nt.alphaCutoff!==void 0?Nt.alphaCutoff:.5)),Nt.normalTexture!==void 0&&se!==gr&&(Ct.push(bt.assignTexture(_t,"normalMap",Nt.normalTexture)),_t.normalScale=new ke(1,1),Nt.normalTexture.scale!==void 0&&_t.normalScale.set(Nt.normalTexture.scale,Nt.normalTexture.scale)),Nt.occlusionTexture!==void 0&&se!==gr&&(Ct.push(bt.assignTexture(_t,"aoMap",Nt.occlusionTexture)),Nt.occlusionTexture.strength!==void 0&&(_t.aoMapIntensity=Nt.occlusionTexture.strength)),Nt.emissiveFactor!==void 0&&se!==gr&&(_t.emissive=new sn().fromArray(Nt.emissiveFactor)),Nt.emissiveTexture!==void 0&&se!==gr&&Ct.push(bt.assignTexture(_t,"emissiveMap",Nt.emissiveTexture)),Promise.all(Ct).then(function(){var We;return se===A?We=Wt[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(_t):We=new se(_t),Nt.name!==void 0&&(We.name=Nt.name),We.map&&(We.map.encoding=Qh),We.emissiveMap&&(We.emissiveMap.encoding=Qh),ct(We,Nt),Nt.extensions&&nt(Wt,We,Nt),We})};function fe(Lt,bt,qt){var Wt=bt.attributes,Nt=new Vo;if(Wt.POSITION!==void 0){var se=qt.json.accessors[Wt.POSITION],_t=se.min,wt=se.max;if(_t!==void 0&&wt!==void 0)Nt.set(new kt(_t[0],_t[1],_t[2]),new kt(wt[0],wt[1],wt[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;var Ct=bt.targets;if(Ct!==void 0)for(var Mt=new kt,jt=0,ee=Ct.length;jt<ee;jt++){var pe=Ct[jt];if(pe.POSITION!==void 0){var se=qt.json.accessors[pe.POSITION],_t=se.min,wt=se.max;_t!==void 0&&wt!==void 0?(Mt.setX(Math.max(Math.abs(_t[0]),Math.abs(wt[0]))),Mt.setY(Math.max(Math.abs(_t[1]),Math.abs(wt[1]))),Mt.setZ(Math.max(Math.abs(_t[2]),Math.abs(wt[2]))),Nt.expandByVector(Mt)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Lt.boundingBox=Nt;var Te=new js;Nt.getCenter(Te.center),Te.radius=Nt.min.distanceTo(Nt.max)/2,Lt.boundingSphere=Te}function de(Lt,bt,qt){var Wt=bt.attributes,Nt=[];function se(Mt,jt){return qt.getDependency("accessor",Mt).then(function(ee){Lt.setAttribute(jt,ee)})}for(var _t in Wt){var wt=V[_t]||_t.toLowerCase();wt in Lt.attributes||Nt.push(se(Wt[_t],wt))}if(bt.indices!==void 0&&!Lt.index){var Ct=qt.getDependency("accessor",bt.indices).then(function(Mt){Lt.setIndex(Mt)});Nt.push(Ct)}return ct(Lt,bt),fe(Lt,bt,qt),Promise.all(Nt).then(function(){return bt.targets!==void 0?xt(Lt,bt.targets,qt):Lt})}function Le(Lt,bt){var qt=Lt.getIndex();if(qt===null){var Wt=[],Nt=Lt.getAttribute("position");if(Nt!==void 0){for(var se=0;se<Nt.count;se++)Wt.push(se);Lt.setIndex(Wt),qt=Lt.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Lt}var _t=qt.count-2,wt=[];if(bt===Sb)for(var se=1;se<=_t;se++)wt.push(qt.getX(0)),wt.push(qt.getX(se)),wt.push(qt.getX(se+1));else for(var se=0;se<_t;se++)se%2===0?(wt.push(qt.getX(se)),wt.push(qt.getX(se+1)),wt.push(qt.getX(se+2))):(wt.push(qt.getX(se+2)),wt.push(qt.getX(se+1)),wt.push(qt.getX(se)));wt.length/3!==_t&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var Ct=Lt.clone();return Ct.setIndex(wt),Ct}return le.prototype.loadGeometries=function(Lt){var bt=this,qt=this.extensions,Wt=this.primitiveCache;function Nt(pe){return qt[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(pe,bt).then(function(Te){return de(Te,pe,bt)})}for(var se=[],_t=0,wt=Lt.length;_t<wt;_t++){var Ct=Lt[_t],Mt=Zt(Ct),jt=Wt[Mt];if(jt)se.push(jt.promise);else{var ee;Ct.extensions&&Ct.extensions[n.KHR_DRACO_MESH_COMPRESSION]?ee=Nt(Ct):ee=de(new wn,Ct,bt),Wt[Mt]={primitive:Ct,promise:ee},se.push(ee)}}return Promise.all(se)},le.prototype.loadMesh=function(Lt){for(var bt=this,qt=this.json,Wt=qt.meshes[Lt],Nt=Wt.primitives,se=[],_t=0,wt=Nt.length;_t<wt;_t++){var Ct=Nt[_t].material===void 0?st(this.cache):this.getDependency("material",Nt[_t].material);se.push(Ct)}return se.push(bt.loadGeometries(Nt)),Promise.all(se).then(function(Mt){for(var jt=Mt.slice(0,Mt.length-1),ee=Mt[Mt.length-1],pe=[],Te=0,We=ee.length;Te<We;Te++){var yt=ee[Te],St=Nt[Te],Ee,be=jt[Te];if(St.mode===k.TRIANGLES||St.mode===k.TRIANGLE_STRIP||St.mode===k.TRIANGLE_FAN||St.mode===void 0)Ee=Wt.isSkinnedMesh===!0?new xd(yt,be):new ki(yt,be),Ee.isSkinnedMesh===!0&&!Ee.geometry.attributes.skinWeight.normalized&&Ee.normalizeSkinWeights(),St.mode===k.TRIANGLE_STRIP?Ee.geometry=Le(Ee.geometry,f3):St.mode===k.TRIANGLE_FAN&&(Ee.geometry=Le(Ee.geometry,Sb));else if(St.mode===k.LINES)Ee=new Xi(yt,be);else if(St.mode===k.LINE_STRIP)Ee=new go(yt,be);else if(St.mode===k.LINE_LOOP)Ee=new Em(yt,be);else if(St.mode===k.POINTS)Ee=new Sm(yt,be);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+St.mode);Object.keys(Ee.geometry.morphAttributes).length>0&&vt(Ee,Wt),Ee.name=Wt.name||"mesh_"+Lt,ee.length>1&&(Ee.name+="_"+Te),ct(Ee,Wt),bt.assignFinalMaterial(Ee),pe.push(Ee)}if(pe.length===1)return pe[0];for(var En=new Cl,Te=0,We=pe.length;Te<We;Te++)En.add(pe[Te]);return En})},le.prototype.loadCamera=function(Lt){var bt,qt=this.json.cameras[Lt],Wt=qt[qt.type];if(!Wt){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return qt.type==="perspective"?bt=new er(Xn.radToDeg(Wt.yfov),Wt.aspectRatio||1,Wt.znear||1,Wt.zfar||2e6):qt.type==="orthographic"&&(bt=new Cu(Wt.xmag/-2,Wt.xmag/2,Wt.ymag/2,Wt.ymag/-2,Wt.znear,Wt.zfar)),qt.name!==void 0&&(bt.name=qt.name),ct(bt,qt),Promise.resolve(bt)},le.prototype.loadSkin=function(Lt){var bt=this.json.skins[Lt],qt={joints:bt.joints};return bt.inverseBindMatrices===void 0?Promise.resolve(qt):this.getDependency("accessor",bt.inverseBindMatrices).then(function(Wt){return qt.inverseBindMatrices=Wt,qt})},le.prototype.loadAnimation=function(Lt){for(var bt=this.json,qt=bt.animations[Lt],Wt=[],Nt=[],se=[],_t=[],wt=[],Ct=0,Mt=qt.channels.length;Ct<Mt;Ct++){var jt=qt.channels[Ct],ee=qt.samplers[jt.sampler],pe=jt.target,Te=pe.node!==void 0?pe.node:pe.id,We=qt.parameters!==void 0?qt.parameters[ee.input]:ee.input,yt=qt.parameters!==void 0?qt.parameters[ee.output]:ee.output;Wt.push(this.getDependency("node",Te)),Nt.push(this.getDependency("accessor",We)),se.push(this.getDependency("accessor",yt)),_t.push(ee),wt.push(pe)}return Promise.all([Promise.all(Wt),Promise.all(Nt),Promise.all(se),Promise.all(_t),Promise.all(wt)]).then(function(St){for(var Ee=St[0],be=St[1],En=St[2],mn=St[3],an=St[4],yn=[],Tn=0,pn=Ee.length;Tn<pn;Tn++){var qe=Ee[Tn],hn=be[Tn],Je=En[Tn],Jt=mn[Tn],je=an[Tn];if(qe!==void 0){qe.updateMatrix(),qe.matrixAutoUpdate=!0;var rn;switch(W[je.path]){case W.weights:rn=Tu;break;case W.rotation:rn=Bd;break;case W.position:case W.scale:default:rn=Pu;break}var In=qe.name?qe.name:qe.uuid,xn=Jt.interpolation!==void 0?K[Jt.interpolation]:Bc,On=[];W[je.path]===W.weights?qe.traverse(function(Ai){Ai.isMesh===!0&&Ai.morphTargetInfluences&&On.push(Ai.name?Ai.name:Ai.uuid)}):On.push(In);var qn=Je.array;if(Je.normalized){var Jn;if(qn.constructor===Int8Array)Jn=1/127;else if(qn.constructor===Uint8Array)Jn=1/255;else if(qn.constructor==Int16Array)Jn=1/32767;else if(qn.constructor===Uint16Array)Jn=1/65535;else throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var Ji=new Float32Array(qn.length),jn=0,Bi=qn.length;jn<Bi;jn++)Ji[jn]=qn[jn]*Jn;qn=Ji}for(var jn=0,Bi=On.length;jn<Bi;jn++){var oi=new rn(On[jn]+"."+W[je.path],hn.array,qn,xn);Jt.interpolation==="CUBICSPLINE"&&(oi.createInterpolant=function($r){return new D(this.times,this.values,this.getValueSize()/3,$r)},oi.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),yn.push(oi)}}}var or=qt.name!==void 0?qt.name:"animation_"+Lt;return new Co(or,void 0,yn)})},le.prototype.loadNode=function(Lt){var bt=this.json,qt=this.extensions,Wt=this,Nt=bt.meshReferences,se=bt.meshUses,_t=bt.nodes[Lt];return function(){var wt=[];return _t.mesh!==void 0&&wt.push(Wt.getDependency("mesh",_t.mesh).then(function(Ct){var Mt;if(Nt[_t.mesh]>1){var jt=se[_t.mesh]++;Mt=Ct.clone(),Mt.name+="_instance_"+jt}else Mt=Ct;return _t.weights!==void 0&&Mt.traverse(function(ee){if(ee.isMesh)for(var pe=0,Te=_t.weights.length;pe<Te;pe++)ee.morphTargetInfluences[pe]=_t.weights[pe]}),Mt})),_t.camera!==void 0&&wt.push(Wt.getDependency("camera",_t.camera)),_t.extensions&&_t.extensions[n.KHR_LIGHTS_PUNCTUAL]&&_t.extensions[n.KHR_LIGHTS_PUNCTUAL].light!==void 0&&wt.push(Wt.getDependency("light",_t.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(wt)}().then(function(wt){var Ct;if(_t.isBone===!0?Ct=new Ax:wt.length>1?Ct=new Cl:wt.length===1?Ct=wt[0]:Ct=new cn,Ct!==wt[0])for(var Mt=0,jt=wt.length;Mt<jt;Mt++)Ct.add(wt[Mt]);if(_t.name!==void 0&&(Ct.userData.name=_t.name,Ct.name=wr.sanitizeNodeName(_t.name)),ct(Ct,_t),_t.extensions&&nt(qt,Ct,_t),_t.matrix!==void 0){var ee=new Kn;ee.fromArray(_t.matrix),Ct.applyMatrix4(ee)}else _t.translation!==void 0&&Ct.position.fromArray(_t.translation),_t.rotation!==void 0&&Ct.quaternion.fromArray(_t.rotation),_t.scale!==void 0&&Ct.scale.fromArray(_t.scale);return Ct})},le.prototype.loadScene=function(){function Lt(bt,qt,Wt,Nt){var se=Wt.nodes[bt];return Nt.getDependency("node",bt).then(function(_t){if(se.skin===void 0)return _t;var wt;return Nt.getDependency("skin",se.skin).then(function(Ct){wt=Ct;for(var Mt=[],jt=0,ee=wt.joints.length;jt<ee;jt++)Mt.push(Nt.getDependency("node",wt.joints[jt]));return Promise.all(Mt)}).then(function(Ct){return _t.traverse(function(Mt){if(Mt.isMesh){for(var jt=[],ee=[],pe=0,Te=Ct.length;pe<Te;pe++){var We=Ct[pe];if(We){jt.push(We);var yt=new Kn;wt.inverseBindMatrices!==void 0&&yt.fromArray(wt.inverseBindMatrices.array,pe*16),ee.push(yt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',wt.joints[pe])}Mt.bind(new _m(jt,ee),Mt.matrixWorld)}}),_t})}).then(function(_t){qt.add(_t);var wt=[];if(se.children)for(var Ct=se.children,Mt=0,jt=Ct.length;Mt<jt;Mt++){var ee=Ct[Mt];wt.push(Lt(ee,_t,Wt,Nt))}return Promise.all(wt)})}return function(qt){var Wt=this.json,Nt=this.extensions,se=this.json.scenes[qt],_t=this,wt=new Gs;se.name!==void 0&&(wt.name=se.name),ct(wt,se),se.extensions&&nt(Nt,wt,se);for(var Ct=se.nodes||[],Mt=[],jt=0,ee=Ct.length;jt<ee;jt++)Mt.push(Lt(Ct[jt],wt,Wt,_t));return Promise.all(Mt).then(function(){return wt})}}(),t}();function MU(t){new bU().load("./gis/34M_17.gltf",n=>{n.scene.position.set(116577.28779765591,19632.646909285337,0),n.scene.rotateX(Math.PI/2),n.scene.scale.set(2,2,2),t.addObject(n.scene)})}const wU=`import { MxCpp, McGePoint3d, McDbLine, McCmColor } from "mxcad";

//画直线
function drawLine() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  // 绘制直线
  let line_1 = new McDbLine()
  let pt1 = new McGePoint3d(1000, 200, 0)
  let pt2 = new McGePoint3d(-1000, -200, 0)
  line_1.startPoint = pt1
  line_1.endPoint = pt2
  line_1.trueColor = new McCmColor(0, 255, 0)
  mxcad.drawEntity(line_1)

  let line_2 = new McDbLine(1000, 500, 0, -1000, -500, 0)
  line_2.trueColor = new McCmColor(255, 0, 0)
  line_2.linetypeScale = 0.4
  mxcad.drawEntity(line_2)

  mxcad.drawLine(1000, 800, -1000, -800)

  mxcad.zoomAll()
  mxcad.zoomScale(0.8)
};

// 调用画直线方法
drawLine();
`,AU=`import {MxCpp, McDbCircle , McCmColor, McGePoint3d} from "mxcad"

//画圆
function drawCircle() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  //绘制圆
  const circle_1 = new McDbCircle(-100, 300, 0, 20)
  circle_1.trueColor = new McCmColor(255, 0, 0)
  mxcad.drawEntity(circle_1)

  const circle_2 = new McDbCircle()
  circle_2.center = new McGePoint3d(-100, 300, 0)
  circle_2.radius = 10
  circle_2.trueColor = new McCmColor(0, 255, 0)
  mxcad.drawEntity(circle_2)

  mxcad.drawCircle(-100, 300, 30)

  mxcad.zoomAll()
  mxcad.zoomScale(0.8)
};

// 调用画圆方法
drawCircle();
`,EU=`import { MxCpp, McDbPoint, McCmColor } from "mxcad"

//画点
function drawPoint() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  // 循环画点
  const point = new McDbPoint()
  const color = new McCmColor(0, 255, 0)
  point.trueColor = color
  for (let i = 0; i < 100; i++) {
    point.setPosition(i, 200 + i)
    mxcad.drawEntity(point)
  }
  for (let i = 0; i < 100; i++) {
    mxcad.drawPoint(i, 150 + i)
  }

  mxcad.zoomAll()
  mxcad.zoomScale(0.8)
};

// 调用画点的函数
drawPoint();`,TU=`import { MxCpp, McGePoint3d } from "mxcad";

//画图片
function drawImg() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  //图片插入点
  const pt = new McGePoint3d(0, 0, 0)
  //图片地址
  let imagUrl = "https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg";
  mxcad.loadImage(imagUrl, (image) => {
    if (!image) {
      console.log("loadImage failed");
      return;
    }
    let width = mxcad.mxdraw.viewCoordLong2Cad(100);
    let height = (image.height / image.width) * width;
    mxcad.drawImage((pt as any).x, (pt as any).y, width, height, 0, imagUrl,true,image.width,image.height);
    mxcad.updateDisplay();
  });
};

// 调用绘图片方法
drawImg();`,PU=`import { MxCpp, McDbArc, McGePoint3d, McCmColor} from "mxcad";

//画圆弧
function drawArc() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  const arc = new McDbArc()
  arc.center = new McGePoint3d(-100, -100),
    arc.radius = 20
  arc.startAngle = Math.PI / 2
  arc.endAngle = Math.PI * 3 / 2
  arc.trueColor = new McCmColor(255, 233, 0)
  mxcad.drawEntity(arc)

  const arc_1 = new McDbArc()
  const pt1 = new McGePoint3d(-60, -80)
  const pt2 = new McGePoint3d(-80, -100)
  const pt3 = new McGePoint3d(-60, -120)
  arc_1.trueColor = new McCmColor(0, 255, 0)
  arc_1.computeArc(pt1.x, pt1.y, pt2.x, pt2.y, pt3.x, pt3.y)
  mxcad.drawEntity(arc_1)

  mxcad.drawArc(-120, -100, 20, 100, 250);

  mxcad.drawColor = new McCmColor(255, 0, 0)
  mxcad.drawArc2(-80, -80, -100, -100, -80, -120)

  mxcad.drawColor = new McCmColor(0, 0, 255)
  mxcad.drawArc3(-40, -80, -40, -120, 1)

  mxcad.zoomAll()
  mxcad.zoomScale(0.8)
};

// 调用绘圆方法
drawArc()`,SU=`import { MxCpp, McDbPolyline, McGePoint3d } from "mxcad"

//画多段线
function drawPolyline() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();
 
  // 画多段线
  const polyline = new McDbPolyline()
  polyline.isClosed = true // 设置闭合
  polyline.constantWidth = 5 // 设置线宽
  // 添加多段线顶点
  polyline.addVertexAt(new McGePoint3d(800, 300, 0))
  polyline.addVertexAt(new McGePoint3d(900, 300, 0))
  polyline.addVertexAt(new McGePoint3d(900, 400, 0))
  mxcad.drawEntity(polyline)

  mxcad.zoomAll()
  mxcad.zoomScale(0.8)
}

// 调用画多段线的方法
drawPolyline()`,CU=`import {McDbEllipse, McGeVector3d, MxCpp, McGePoint3d, McCmColor } from "mxcad";
 
//画椭圆弧
function drawEllipse() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  //绘制椭圆
  const ellipse = new McDbEllipse();
  ellipse.center = new McGePoint3d(-200, -200);
  ellipse.majorAxis = new McGeVector3d(0, 300, 0);
  ellipse.radiusRatio = 0.5;
  ellipse.trueColor = new McCmColor(255, 233, 0);
  mxcad.drawEntity(ellipse);

  const ellipse_arc = new McDbEllipse();
  ellipse_arc.center = new McGePoint3d(-380, -200);
  ellipse_arc.majorAxis = new McGeVector3d(0, 150, 0);
  ellipse_arc.minorAxis = new McGeVector3d(280, 0, 0);
  ellipse_arc.startAngle = Math.PI / 2;
  ellipse_arc.endAngle = Math.PI * 3 / 2;
  ellipse_arc.trueColor = new McCmColor(0, 255, 255);
  mxcad.drawEntity(ellipse_arc);

  mxcad.drawEllipse(0, -200, 200, 0, 1.5);

  mxcad.drawColor = new McCmColor(0, 255, 0);
  mxcad.drawEllipseArc(200, -200, 200, 0, 1.5, 100, 650);

  mxcad.zoomAll();
  mxcad.zoomScale(0.8);
};

// 调用画椭圆的方法
drawEllipse();`,DU=`import { MxCpp, McGePoint3d, McDbText, McCmColor } from "mxcad";

function drawText() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  // 绘制文字
  let text = new McDbText()
  text.textString = 'Hello World'
  text.position = new McGePoint3d(1000, 200, 0)
  text.height = 50
  text.trueColor = new McCmColor(0, 255, 0)
  mxcad.drawEntity(text)

  mxcad.zoomAll()
  mxcad.zoomScale(0.8)
};

// 调用画文字的方法
drawText();`,RU=`import { MxCpp } from "mxcad";\r
\r
function drawMtext() {\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    //清空当前显示内容\r
    mxcad.newFile();\r
\r
    //把颜色改回黑白色\r
    mxcad.drawColorIndex = 0;\r
\r
    mxcad.addLayer("MtextLayer");\r
\r
    //设置当前图层为"MtextLayer"\r
\r
    mxcad.drawLayer = "MtextLayer"; \r
\r
    mxcad.drawTextStyle = "";\r
\r
    mxcad.drawMText(0, -100, "控件:\\\\P多行文字测试", 50, 400, 0, 1);\r
\r
    mxcad.zoomAll();\r
    mxcad.updateDisplay();\r
};\r
\r
// 调用画多行文字的方法\r
drawMtext();`,LU=`
import { McDbAlignedDimension,McDb, McDbRotatedDimension, MxCpp, McGePoint3d, McCmColor } from "mxcad";
//画标注
function drawDimension() {
  const mxcad = MxCpp.getCurrentMxCAD();
  // 创建新画布
  mxcad.newFile();

  // 画标注
  const mDimension = new McDbAlignedDimension()
  mDimension.xLine1Point = new McGePoint3d(-1800, 800)
  mDimension.xLine2Point = new McGePoint3d(1800, 800)
  mDimension.dimLinePoint = new McGePoint3d(800, 500)
  mDimension.textAttachment = McDb.AttachmentPoint.kTopLeft
  mDimension.trueColor = new McCmColor(200, 255, 0)
  mDimension.oblique = 0
  mxcad.drawEntity(mDimension)

  const rDimension = new McDbRotatedDimension()
  rDimension.xLine1Point = new McGePoint3d(-1800, -800)
  rDimension.xLine2Point = new McGePoint3d(1800, -800)
  rDimension.dimLinePoint = new McGePoint3d(-800, -500)
  rDimension.textAttachment = McDb.AttachmentPoint.kTopLeft
  rDimension.textRotation = 0.0
  rDimension.trueColor = new McCmColor(200, 255, 0)
  rDimension.oblique = 0
  rDimension.rotation = 0
  rDimension.dimensionText = "标注文本"
  mxcad.drawEntity(rDimension)

  mxcad.zoomCenter(0, 0)
};

// 调用画标注方法
drawDimension();`,IU=`import { MxCpp } from "mxcad";\r
\r
// 画路径\r
function drawPath() {\r
    const mxcad = MxCpp.getCurrentMxCAD();\r
    // 创建新画布\r
    mxcad.newFile();\r
    //用路径 绘制矩形框\r
    //定义一个路径的开始点\r
    mxcad.pathMoveTo(0, 300);\r
    //路径的一下个点\r
    mxcad.pathLineTo(100, 300);\r
    //路径的一下个点\r
    mxcad.pathLineTo(100, 400);\r
    //路径的一下个点\r
    mxcad.pathLineTo(0, 400);\r
    //把路径设置成闭合\r
    mxcad.pathMakeClosed();\r
    //生成一个矩形框的多义线\r
    mxcad.drawPathToPolyline();\r
\r
    //定义一个路径的开始点\r
    mxcad.pathMoveTo(170, 320)\r
    mxcad.pathLineTo(200, 320)\r
    mxcad.pathLineTo(200, 340)\r
    mxcad.pathLineTo(170, 340)\r
    // 把上面定义的路径定义填充排除区域.\r
    mxcad.pathMakeExclude(true)\r
    mxcad.pathMoveTo(150, 300)\r
    mxcad.pathLineTo(250, 300)\r
    mxcad.pathLineTo(250, 400)\r
    mxcad.pathLineTo(150, 400)\r
    mxcad.pathMakeClosed();\r
    // 将路径生成一个填充 这里的参数是图案缩放比例\r
    mxcad.drawPathToHatch(1);\r
\r
    mxcad.zoomAll();\r
    mxcad.zoomScale(0.8)\r
};\r
\r
// 调用画路径的函数\r
drawPath();`,kU=`import { MxCpp, McCmColor } from "mxcad";\r
\r
// 画填充\r
function drawHatch() {\r
    const mxcad = MxCpp.getCurrentMxCAD();\r
    // 创建新画布\r
    mxcad.newFile();\r
    // 绘制一个实心填充\r
    //定义一个路径的开始点\r
    mxcad.pathMoveTo(150, 3300);\r
    //路径的一下个点\r
    mxcad.pathLineTo(250, 3300);\r
    //路径的一下个点\r
    mxcad.pathLineTo(250, 3400);\r
    //路径的一下个点\r
    mxcad.pathLineTo(150, 3300);\r
    //把路径拟合成一个样线\r
    mxcad.drawColor = new McCmColor(255, 0, 0);\r
    mxcad.drawPathToHatch(1);\r
\r
    // 绘制一个图形填充\r
    mxcad.addPatternDefinition("MyHatchPattern1", "((45, 0,0, 0,0.125))");\r
    mxcad.drawPatternDefinition = "MyHatchPattern1";\r
    //定义一个路径的开始点\r
    mxcad.pathMoveTo(250, 3300);\r
    //路径的一下个点\r
    mxcad.pathLineTo(350, 3300);\r
    //路径的一下个点\r
    mxcad.pathLineTo(350, 3400);\r
    //路径的一下个点\r
    mxcad.pathLineTo(250, 3300);\r
    mxcad.drawColor = new McCmColor(255, 255, 0);\r
    //把路径变成一个填充,80,是填充图案的缩放比例.\r
    mxcad.drawPathToHatch(100);\r
    mxcad.zoomAll()\r
    mxcad.zoomScale(0.8)\r
};\r
\r
// 调用画填充的方法\r
drawHatch();`,BU=`import { MxCpp, McDbBlockTableRecord, McDbLine, McDbCircle, McCmColor, McDbBlockReference, McGePoint3d } from "mxcad";\r
\r
// 画图块\r
function drawBlock() {\r
  const mxcad = MxCpp.getCurrentMxCAD();\r
  // 创建新画布\r
  mxcad.newFile();\r
\r
  // 先从数据库中得到图块表\r
  let blkTable = mxcad.getDatabase().getBlockTable();\r
  // 将一个新的图块记录添加到图块表中\r
  let blkRecId = blkTable.add(new McDbBlockTableRecord());\r
\r
  // 根据ObjectId再次得到刚刚添加的图块记录\r
  let blkTableRecord = blkRecId.getMcDbBlockTableRecord()\r
\r
  // 添加两条线段再图块记录中 这里每条线段的具体属性比如开始点和结束点自行赋值\r
  const line = new McDbLine(50, 50, 0, -50, -50, 0)\r
  line.trueColor = new McCmColor(0, 255, 0)\r
  const line1 = new McDbLine(-50, 50, 0, 50, -50, 0)\r
  const circle = new McDbCircle(0, 0, 0, 50)\r
  circle.trueColor = new McCmColor(255, 255, 0)\r
  blkTableRecord.appendAcDbEntity(line);\r
  blkTableRecord.appendAcDbEntity(line1);\r
  blkTableRecord.appendAcDbEntity(circle);\r
\r
  // 设置图块的基点 一般是包围盒内的点， 可以任意指定\r
  blkTableRecord.origin = new McGePoint3d(0, 0, 0);\r
\r
  // 实例化块参照 这里需要设置我们刚刚添加图块记录得到的ObjectId\r
  let blkRef = new McDbBlockReference();\r
  blkRef.blockTableRecordId = blkRecId;\r
  // 最后设置位置 渲染图块\r
  blkRef.position = new McGePoint3d(0, 0, 0);\r
\r
  mxcad.drawEntity(blkRef);\r
\r
  mxcad.zoomAll()\r
  mxcad.zoomScale(0.8)\r
};\r
\r
// 调用画图块方法\r
drawBlock();`,FU=`import {\r
    MxCpp, McDbLine, McGePoint3d, McDbCustomEntity, IMcDbDwgFiler, MxCADWorldDraw, McGePoint3dArray,\r
    McGeVector3d, McDbText, McDb, MxCADResbuf, MxCADSelectionSet, McObjectId, McDbCircle,\r
    McDbEntity,\r
    McDbMText,\r
    MxCADUtility\r
} from "mxcad"\r
\r
// 线文本自定义实体\r
// 新创建 McDbLineText 类，继承McDbCustomEntity\r
class McDbTestLineText extends McDbCustomEntity {\r
    //设置McDbLineText类中的两个直线端点 pt1、pt2\r
    //以及显示线段长度的文字_text和文字大小_textsize\r
    private pt1: McGePoint3d = new McGePoint3d();\r
    private pt2: McGePoint3d = new McGePoint3d();\r
    private _text: string = "";\r
    private _textsize: number = 10;\r
    /** 包围盒最大点 包围盒最小点 */\r
    private minPt: McGePoint3d = new McGePoint3d();\r
    private maxPt: McGePoint3d = new McGePoint3d();\r
    //构造函数\r
    constructor(imp?: any) {\r
        super(imp);\r
    }\r
    //创建函数\r
    public create(imp: any) {\r
        return new McDbTestLineText(imp)\r
    }\r
    //获取类型\r
    public getTypeName(): string {\r
        return "McDbTestLineText";\r
    }\r
    //设置或获取文本值\r
    public set text(val: string) {\r
        this._text = val;\r
    }\r
    public get text(): string {\r
        return this._text;\r
    }\r
    //设置或获取文本大小\r
    public set textsize(val: number) {\r
        this._textsize = val;\r
    }\r
    public get textsize(): number {\r
        return this._textsize;\r
    }\r
    //读取自定义实体数据pt1、pt2、_text、_textsize\r
    public dwgInFields(filter: IMcDbDwgFiler): boolean {\r
        this.pt1 = filter.readPoint("pt1").val;\r
        this.pt2 = filter.readPoint("pt2").val;\r
        this._text = filter.readString("text").val;\r
        this._textsize = filter.readDouble("textsize").val;\r
        this.minPt = filter.readPoint("minPt").val;\r
        this.maxPt = filter.readPoint("maxPt").val;\r
        return true;\r
    }\r
    //写入自定义实体数据pt1、pt2、_text、_textsize\r
    public dwgOutFields(filter: IMcDbDwgFiler): boolean {\r
        filter.writePoint("pt1", this.pt1);\r
        filter.writePoint("pt2", this.pt2);\r
        filter.writeString("text", this._text);\r
        filter.writeDouble("textsize", this._textsize);\r
        filter.writePoint("minPt", this.minPt);\r
        filter.writePoint("maxPt", this.maxPt);\r
        return true;\r
    }\r
    //自定义同步函数，当其他对象与该对象相连时同步数据\r
    private fineLink(pt: McGePoint3d): any {\r
        let ret: any = {};\r
        let myId = this.getObjectID();\r
        let dSearch = this._textsize * 0.5;;\r
        let filter = new MxCADResbuf();\r
        filter.AddString("CUSTOMENTITY", 5020);\r
        let ss = new MxCADSelectionSet();\r
        ss.crossingSelect(pt.x - dSearch, pt.y - dSearch, pt.x + dSearch, pt.y + dSearch, filter);\r
        ss.forEach((id) => {\r
            if (id == myId)\r
                return;\r
            let ent = id.getMcDbEntity();\r
            if (!ent) return;\r
            if (ent instanceof McDbTestLineText) {\r
                let line = (ent as McDbTestLineText);\r
                let linkPoint = line.getPoint1();\r
                let link_pos = 0;\r
                // 得到直线与图块连接的端点坐标.\r
                let dist = line.getPoint1().distanceTo(pt);\r
                if (dist > line.getPoint2().distanceTo(pt)) {\r
                    dist = line.getPoint2().distanceTo(pt);\r
                    linkPoint = line.getPoint2();\r
                    link_pos = 1;\r
                }\r
                if (dist < dSearch) {\r
                    ret[id.id] = { link_point: linkPoint, link_pos: link_pos };\r
                }\r
            }\r
        });\r
        return ret;\r
    }\r
    //处理夹点编辑效果\r
    public moveGripPointsAt(iIndex: number, dXOffset: number, dYOffset: number, dZOffset: number) {\r
        this.assertWrite();\r
        let pt: McGePoint3d = this.pt1.clone();\r
        let new_pt: McGePoint3d = pt;\r
        if (iIndex == 0) {\r
            this.pt1.x += dXOffset;\r
            this.pt1.y += dYOffset;\r
            this.pt1.z += dZOffset;\r
            new_pt = this.pt1;\r
        }\r
        else if (iIndex == 1) {\r
            pt = this.pt2.clone();\r
            this.pt2.x += dXOffset;\r
            this.pt2.y += dYOffset;\r
            this.pt2.z += dZOffset;\r
            new_pt = this.pt2;\r
        }\r
        if (this.getObjectID().isValid()) {\r
            // 同步，与连接的其它对象。\r
            let linkobj = this.fineLink(pt)\r
            Object.keys(linkobj).forEach((id_val: any) => {\r
                let idFind = new McObjectId(id_val);\r
                let lineFind = (idFind.getMcDbEntity() as McDbTestLineText);\r
                if (linkobj[id_val].link_pos == 0) {\r
                    lineFind.setPoint1(new_pt);\r
                }\r
                else {\r
                    lineFind.setPoint2(new_pt);\r
                }\r
            });\r
        }\r
    };\r
    //设置对象编辑点位\r
    public getGripPoints(): McGePoint3dArray {\r
        let ret = new McGePoint3dArray()\r
        ret.append(this.pt1);\r
        ret.append(this.pt2);\r
        return ret;\r
    };\r
    //动态绘制\r
    public worldDraw(draw: MxCADWorldDraw): void {\r
        const allEntityArr: McDbEntity[] = [];\r
\r
        let circle_r = this._textsize * 0.4;\r
        let vec2 = this.pt2.sub(this.pt1);\r
        vec2.normalize().mult(circle_r);\r
        let tmpline = new McDbLine(this.pt1.clone().addvec(vec2),\r
            this.pt2.clone().subvec(vec2));\r
        draw.drawEntity(tmpline);\r
        allEntityArr.push(tmpline)\r
        let vec = this.pt2.sub(this.pt1).mult(0.5);\r
        let midpt = this.pt1.clone().addvec(vec);\r
        if (vec.dotProduct(McGeVector3d.kXAxis) < 0) {\r
            vec.negate();\r
        }\r
        let ange = vec.angleTo2(McGeVector3d.kXAxis, McGeVector3d.kNegateZAxis);\r
        let str = this._text;\r
        if (str.length == 0) {\r
            str = this.pt1.distanceTo(this.pt2).toFixed(2);\r
        }\r
        vec.perpVector();\r
        if (vec.dotProduct(McGeVector3d.kYAxis) < 0) {\r
            vec.negate();\r
        }\r
        vec.normalize().mult(this._textsize * 0.2);\r
        let text = new McDbText();\r
        text.textString = str;\r
        text.position = midpt.clone().addvec(vec);\r
        text.alignmentPoint = midpt.clone().addvec(vec);\r
        text.rotation = ange;\r
        text.verticalMode = McDb.TextVertMode.kTextBottom;\r
        text.horizontalMode = McDb.TextHorzMode.kTextCenter;\r
        text.height = this._textsize;\r
        draw.drawEntity(text)\r
        allEntityArr.push(text)\r
        let circle1 = new McDbCircle();\r
        circle1.center = this.pt1;\r
        circle1.radius = circle_r;\r
        draw.drawEntity(circle1);\r
        allEntityArr.push(circle1)\r
\r
        let circle2 = new McDbCircle();\r
        circle2.center = this.pt2;\r
        circle2.radius = circle_r;\r
        draw.drawEntity(circle2);\r
        allEntityArr.push(circle2)\r
\r
        this.getBox(allEntityArr);\r
    }\r
    private getBox(entityArr: McDbEntity[]) {\r
        const mxcad = MxCpp.getCurrentMxCAD();\r
        let _minPt, _maxPt = null;\r
        let result;\r
        entityArr.forEach(entity => {\r
            if (entity instanceof McDbText) {\r
                const ent = new McDbMText()\r
                ent.contents = entity.textString;\r
                ent.textHeight = entity.height;\r
                ent.location = entity.position;\r
                switch (entity.horizontalMode) {\r
                    case McDb.TextHorzMode.kTextLeft:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomLeft;\r
                        break;\r
                    case McDb.TextHorzMode.kTextCenter:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomCenter;\r
                        break;\r
                    case McDb.TextHorzMode.kTextRight:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomRight;\r
                        break;\r
                    case McDb.TextHorzMode.kTextMid:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomCenter;\r
                        break;\r
                    default:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomLeft;\r
                        break;\r
                }\r
                // 将ent的文字样式设置为当前文字样式\r
                const textStyleId = mxcad.getDatabase().getCurrentlyTextStyleId();\r
                ent.textStyleId = textStyleId;\r
                ent.reCompute();\r
                result = MxCADUtility.getTextEntityBox(ent, false);\r
            } else if (entity instanceof McDbMText) {\r
                entity.reCompute();\r
                result = MxCADUtility.getTextEntityBox(entity, false);\r
            } else {\r
                result = entity.getBoundingBox();\r
            }\r
            const { minPt, maxPt, ret } = result;\r
            if (!_minPt) _minPt = minPt.clone();\r
            if (!_maxPt) _maxPt = maxPt.clone();\r
            if (minPt.x < _minPt.x) _minPt.x = minPt.x;\r
            if (minPt.y < _minPt.y) _minPt.y = minPt.y;\r
            if (maxPt.x > _maxPt.x) _maxPt.x = maxPt.x;\r
            if (maxPt.y > _maxPt.y) _maxPt.y = maxPt.y;\r
        });\r
        if (_minPt && _maxPt) {\r
            this.maxPt = _maxPt;\r
            this.minPt = _minPt\r
        }\r
    }\r
    // 设置pt1\r
    public setPoint1(pt1: McGePoint3d) {\r
        this.assertWrite();\r
        this.pt1 = pt1.clone();\r
    }\r
    // 设置pt2\r
    public setPoint2(pt2: McGePoint3d) {\r
        this.assertWrite();\r
        this.pt2 = pt2.clone();\r
    }\r
    // 获取pt1\r
    public getPoint1() {\r
        return this.pt1;\r
    }\r
    //获取pt2\r
    public getPoint2() {\r
        return this.pt2;\r
    }\r
    // 获取包围盒\r
    public getBoundingBox(): { minPt: McGePoint3d; maxPt: McGePoint3d; ret: boolean; } {\r
        return { minPt: this.minPt, maxPt: this.maxPt, ret: true }\r
    }\r
}\r
\r
// 绘线文本自定义实体\r
async function MxTest_LineText() {\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    //清空当前显示内容\r
    mxcad.newFile();\r
\r
    let pt1 = new McGePoint3d(100, 100, 0);\r
    let pt2 = new McGePoint3d(200, 150, 0);\r
    let pt3 = new McGePoint3d(400, 50, 0);\r
    let pt4 = new McGePoint3d(600, 60, 0);\r
    let pt5 = new McGePoint3d(200, 300, 0);\r
\r
    let textsize = 5;\r
\r
    let myline1 = new McDbTestLineText();\r
    myline1.setPoint1(pt1);\r
    myline1.setPoint2(pt2);\r
    myline1.textsize = textsize;\r
    myline1.text = "xxxx";\r
    mxcad.drawEntity(myline1);\r
\r
\r
    let myline2 = new McDbTestLineText();\r
    myline2.setPoint1(pt2);\r
    myline2.setPoint2(pt3);\r
    myline2.textsize = textsize;\r
    mxcad.drawEntity(myline2);\r
\r
    let myline3 = new McDbTestLineText();\r
    myline3.setPoint1(pt3);\r
    myline3.setPoint2(pt4);\r
    myline3.textsize = textsize;\r
    mxcad.drawEntity(myline3);\r
\r
\r
    let myline4 = new McDbTestLineText();\r
    myline4.setPoint1(pt2);\r
    myline4.setPoint2(pt5);\r
    myline4.textsize = textsize;\r
    mxcad.drawEntity(myline4);\r
\r
\r
    //把所有的实体都放到当前显示视区\r
    mxcad.zoomW(new McGePoint3d(-300, -300, 0), new McGePoint3d(650, 500, 0));\r
    //更新视区显示\r
    mxcad.updateDisplay();\r
}\r
\r
// 自定义实体注册\r
new McDbTestLineText().rxInit();\r
// 调用绘线文本自定义实体方法\r
MxTest_LineText();\r
\r
`,zU=`import { McCmColor, MxCpp} from "mxcad"\r
\r
// 绘制多种线型直线\r
function Mx_Test_DrawLine() {\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    //清空当前显示内容\r
    mxcad.newFile();\r
    //把颜色改回黑白色\r
    mxcad.drawColorIndex = 0;\r
    //把线型改成实线\r
    mxcad.drawLinetype = "";\r
    //设置线宽 4\r
    mxcad.drawLineWidth = 0;\r
  \r
  \r
    //创建一个图层,名为"LineLayer"\r
    mxcad.addLayer("LineLayer");\r
    //设置当前图层为"LineLayer"\r
    mxcad.drawLayer = "LineLayer";\r
    // 直接绘制一个实线\r
    // 参数一直线的开始点x坐标，参数二直线的开始点y坐标，参数三直线的结束点x坐标，参数四直线的结束点y坐标\r
    mxcad.drawLine(0, 0, 100, 0);\r
    // 绘制一个实斜线\r
    mxcad.drawLine(200, 0, 300, 100);\r
  \r
  \r
    //----------------------------------------------------------------------------------------------------------\r
    //绘制一个虚线\r
    //定义虚线数据据,"MyLineType"是线型名，"6,-8"是虚线的一个单位定义，6是实线长，-8是空格长。\r
    mxcad.addLinetype("MyLineType", "6,-10");\r
    //设计当前线型为"MyLineType"\r
    mxcad.drawLinetype = "MyLineType";\r
    // 绘制一个虚线\r
    mxcad.drawLine(0, 30, 100, 30);\r
    // 绘制一个斜虚线\r
    mxcad.drawLine(200, 30, 300, 130);\r
  \r
    //---------------------------------------------------------------------------------------------------------\r
    // 修改绘线的颜色为 16711680(蓝色),  16711680转成16进制是0xFF 00 00,其中，FF是蓝色，00是绿色，第个二00是红色。\r
    mxcad.drawColor = new McCmColor(0, 0, 255);\r
    // 绘制一个蓝色的虚线\r
  \r
    mxcad.drawLine(0, 60, 100, 60);\r
    // 绘制一个蓝色的斜虚线\r
    mxcad.drawLine(200, 60, 300, 160);\r
    //---------------------------------------------------------------------------------------------------------\r
    //把颜色改回黑白色\r
    mxcad.drawColorIndex = 0;\r
    //把线型改成实线\r
    mxcad.drawLinetype = "";\r
    //设置线宽 4\r
    mxcad.drawLineWidth = 4;\r
    //绘制一个带宽度的直线。\r
    mxcad.drawLine(0, 90, 100, 90);\r
    // 绘制一个带宽度的斜线\r
    mxcad.drawLine(200, 90, 300, 190);\r
  \r
    //---------------------------------------------------------------------------------------------------------\r
    //绘制一个点划线虚线\r
    mxcad.addLinetype("MyLineType2", "10,-2,3,-2");\r
    //把线型改点划线\r
    mxcad.drawLinetype = "MyLineType2";\r
    // 修改绘线的颜色为 255(红色),  255转成16进制是0x00 00 FF,其中，00是蓝色，第个二00是绿色，FF是红色。\r
    mxcad.drawColor = new McCmColor(255, 0, 0);\r
    //绘制一个带宽度的红色点划线。\r
    mxcad.drawLine(0, 120, 100, 120);\r
    // 绘制一个带宽度红色点划斜线\r
    mxcad.drawLine(200, 120, 300, 220);\r
    //---------------------------------------------------------------------------------------------------------\r
    //增加一个带有形的线型\r
    mxcad.addTextStyle("MyLineTypeTextStyle", "txt.shx", "hztxt.shx", 1);\r
    mxcad.addLinetypeEx("MyLineType3", "(12.7,(\\"T=MxDraw\\",\\"S=2.54\\",\\"L=-5.08\\",\\"R=0.0\\",\\"X=-2.54\\",\\"Y=-1.27\\"),-10.08)", "MyLineTypeTextStyle");\r
    mxcad.drawLinetype = "MyLineType3";\r
    mxcad.drawLineWidth = 0;\r
    //绘制一个带宽度的红色点划线。\r
    mxcad.drawLine(350, 120, 600, 120);\r
    //---------------------------------------------------------------------------------------------------------\r
    //增加一个带有形的线型\r
    //把颜色改回黑白色\r
    mxcad.drawColorIndex = 0;\r
    mxcad.drawLineWidth = 4;\r
    //绘制一个带宽度的红色点划线。\r
    mxcad.drawLine(350, 220, 600, 220);\r
  \r
    //把所有的实体都放到当前显示视区\r
    mxcad.zoomAll();\r
    //更新视区显示\r
    mxcad.updateDisplay();\r
  }\r
\r
  // 调用绘制多种线型直线的方法\r
  Mx_Test_DrawLine()`,NU=`import { MxCpp, McCmColor } from "mxcad";\r
\r
function Mx_Test_TrueText() {\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    //清空当前显示内容\r
    mxcad.newFile();\r
    MxCpp.App.loadFonts([], [], ["syadobe", "simsun"], () => {\r
\r
        // 添加一个黑体文字样式\r
        mxcad.AddTureTypeTextStyle("ht_style", "syadobe");\r
\r
        // 添加一个宋体文字样式\r
        mxcad.AddTureTypeTextStyle("st_style", "simsun");\r
\r
        // 设置当前样式为黑体\r
        mxcad.drawTextStyle = "ht_style";\r
\r
        mxcad.drawColor = new McCmColor(200, 255, 50);\r
        mxcad.drawText(0, 3500, "绘图控件TrueType文字测试1", 100, 0, 0, 1);\r
\r
        // 设置当前样式为黑体\r
        mxcad.drawTextStyle = "st_style";\r
        mxcad.drawColor = new McCmColor(200, 100, 0);\r
        mxcad.drawText(0, 3200, "绘图控件TrueType文字测试2", 100, 0, 0, 1);\r
\r
        mxcad.zoomAll();\r
        mxcad.regen();\r
        mxcad.updateDisplay();\r
    });\r
};\r
\r
// 调用画多种文字样式的文字的方法\r
Mx_Test_TrueText()`,UU=`import { MxCADUiPrPoint, McDbPolyline, McDbArc, MxCpp } from "mxcad";

//画圆弧
async function Mx_drawArc() {
    // 根据起点，中点，端点三个点确定一段圆弧 
    // 获取起点
    let getFristPoint = new MxCADUiPrPoint();
    getFristPoint.setMessage('指定起点');
    let fristPoint = await getFristPoint.go();
    if (!fristPoint) return

    // 获取第二个点
    let getSecondPoint = new MxCADUiPrPoint();
    getSecondPoint.setMessage('指定圆弧的第二个点');
    //动态绘制取点对象
    getSecondPoint.setUserDraw((pt, pw) => {
        let pl = new McDbPolyline();
        pl.addVertexAt(fristPoint)
        pl.addVertexAt(pt);
        pw.drawMcDbEntity(pl)
    })
    let secondPoint = await getSecondPoint.go();
    if (!secondPoint) return;

    // 获取端点
    let getThirdPoint = new MxCADUiPrPoint();
    getThirdPoint.setMessage('指定圆弧的端点');
    //动态绘制圆弧
    getThirdPoint.setUserDraw((pt, pw) => {
        let arc = new McDbArc();
        arc.computeArc(fristPoint.x, fristPoint.y, secondPoint.x, secondPoint.y, pt.x, pt.y);//三点画圆弧
        pw.drawMcDbEntity(arc)
    });
    let thirdPoint = await getThirdPoint.go();
    if (!thirdPoint) return

    // 画圆弧
    let arc = new McDbArc();
    arc.computeArc(fristPoint.x, fristPoint.y, secondPoint.x, secondPoint.y, thirdPoint.x, thirdPoint.y);//三点画圆弧

    const mxcad = MxCpp.getCurrentMxCAD();
    mxcad.drawEntity(arc);
};

// 调用画圆弧的方法
Mx_drawArc();

`,VU=`import {MxCADUiPrPoint, McDbLine, MxCpp} from "mxcad";\r
\r
//画线\r
async function Mx_drawLine() {\r
    // 获取线段起点\r
    let getFristPoint = new MxCADUiPrPoint();\r
    getFristPoint.setMessage("请点击确定起始点");\r
    let fristPoint: any = await getFristPoint.go();\r
    if (!fristPoint) return\r
\r
    // 获取线段终点\r
    let getSecondPoint = new MxCADUiPrPoint();\r
    getSecondPoint.setMessage("请点击确定终点");\r
    getSecondPoint.setUserDraw((pt, pw) => {\r
        let line = new McDbLine(fristPoint.x, fristPoint.y, fristPoint.z, pt.x, pt.y, pt.z);\r
        pw.drawMcDbEntity(line)\r
    })\r
    let secondPoint: any = await getSecondPoint.go();\r
    if (!secondPoint) return\r
\r
    // 绘制线段\r
    let line = new McDbLine(fristPoint.x, fristPoint.y, fristPoint.z, secondPoint.x, secondPoint.y, secondPoint.z);\r
    const mxcad = MxCpp.getCurrentMxCAD();\r
    mxcad.drawEntity(line)\r
};\r
\r
// 调用画线的方法\r
\r
Mx_drawLine();`,GU=`import { McDbText, MxCADUiPrDist, MxCADUiPrPoint, MxCADUiPrString, MxCpp } from "mxcad";\r
\r
async function Mx_drawText() {\r
    // 创建文字对象\r
    const text = new McDbText();\r
\r
    // 设置文字内容\r
    const getStr = new MxCADUiPrString()\r
    getStr.setMessage("请输入文字内容")\r
    const str = await getStr.go()\r
    if (!str) return\r
    text.textString = str;\r
\r
    // 设置文字高度\r
    const getDist = new MxCADUiPrDist()\r
    getDist.setMessage("请输入文字高度")\r
    const height = await getDist.go()\r
    if (!height) return\r
    text.height = getDist.value();\r
\r
    // 设置文字高度\r
    const getPoint = new MxCADUiPrPoint()\r
    getPoint.setMessage("请点击确定文字位置")\r
    getPoint.setUserDraw((pt, pw) => {\r
        text.position = pt;\r
        text.alignmentPoint = pt;\r
        pw.drawMcDbEntity(text)\r
    })\r
    const position = await getPoint.go()\r
    if (!position) return\r
    text.position = position;\r
    text.alignmentPoint = position\r
\r
    const mxcad = MxCpp.getCurrentMxCAD();\r
    mxcad.drawEntity(text);\r
};\r
\r
// 调用绘制文字的方法\r
Mx_drawText();`,OU=`import {McDbCircle, MxCADUiPrDist, MxCADUiPrPoint, MxCpp} from "mxcad";\r
\r
// 画圆\r
async function Mx_drawCircle(){\r
    // 创建圆\r
    const circle = new McDbCircle();\r
\r
    // 获取圆心\r
    const getCenter = new MxCADUiPrPoint();\r
    getCenter.setMessage('请确定圆心位置\\n');\r
    const center = await getCenter.go();\r
    if (!center) return;\r
    circle.center = center;\r
\r
    // 获取圆半径\r
    const getRadius = new MxCADUiPrDist();\r
    getRadius.setBasePt(center);\r
    getRadius.setMessage('请输入圆半径');\r
    // 动态绘制圆\r
    getRadius.setUserDraw((pt, pw) => {\r
        const r = pt.distanceTo(center);\r
        circle.radius = r;\r
        pw.drawMcDbEntity(circle)\r
    })\r
    const radiusVal = await getRadius.go();\r
    if (!radiusVal) return;\r
    circle.radius = getRadius.value();\r
\r
    // 绘制圆\r
    const mxobj = MxCpp.getCurrentMxCAD();\r
    mxobj.drawEntity(circle);\r
};\r
\r
// 调用画圆的方法\r
Mx_drawCircle();`,jU=`import {MxCADUiPrPoint, MxCpp} from "mxcad";\r
\r
//画图片\r
async function Mx_drawImg() {\r
    // 设置图片插入点\r
    const getPoint = new MxCADUiPrPoint();\r
    getPoint.setMessage("\\n指定插入点:");\r
    let pt = await getPoint.go();\r
    if (!pt) return;\r
   \r
    const mxcad = MxCpp.getCurrentMxCAD();\r
    // 设置图片地址\r
    let imagUrl = "https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg";\r
    mxcad.loadImage(imagUrl,(image)=>{\r
        if(!image ){ \r
        console.log("loadImage failed");\r
        return;\r
        }\r
        // 设置图片宽高\r
        let width = mxcad.mxdraw.viewCoordLong2Cad(100);\r
        let height  = (image.height /  image.width) * width;\r
        mxcad.drawImage((pt as any).x,(pt as any).y,width,height,0,imagUrl,true,image.width,image.height);\r
        mxcad.updateDisplay();\r
    });\r
};\r
\r
// 调用画图片的方法\r
Mx_drawImg();`,HU=`import { MxCpp, MxCADUiPrPoint, McDbPolyline, MxCADUiPrDist, McGeVector3d, McGePoint3d, McDbArc, MxCADUtility, McDbLine, McDb} from "mxcad";\r
\r
// 画多段线\r
async function Mx_drawPolyline() {\r
    // 获取画布实例\r
    const mxcad = MxCpp.App.getCurrentMxCAD();\r
    const getPoint = new MxCADUiPrPoint();\r
    getPoint.setMessage("\\n指定起点:");\r
    let firstPoint = await getPoint.go();\r
    if (!firstPoint) return;\r
    let pointArr: any[] = [];\r
    let drawObjIds: any[] = [];\r
    let isArc: boolean = false;\r
    let dStartWidth: number = 0;\r
    let dEndWidth: number = 0;\r
    pointArr.push({ pt: firstPoint, dBulge: 0, dStartWidth, dEndWidth })\r
    let isAutoClose: boolean = false;\r
    let isReverse: boolean = false;//圆弧方向是否取反\r
    let arcDirection: any = null //指定圆弧切向\r
    while (true) {\r
        if (!isArc) {\r
            //绘直线\r
            const getNextPoint = new MxCADUiPrPoint;\r
            getNextPoint.setMessage("\\n指定下一个点");\r
            // 提示消息\r
            if (pointArr.length < 2) {\r
                getNextPoint.setKeyWords('[圆弧(A)/宽度(W)]')\r
            } else {\r
                getNextPoint.setKeyWords('[放弃(U)/圆弧(A)/宽度(W)/闭合(C)]')\r
            }\r
            let lastPoint = pointArr[pointArr.length - 1];//鼠标点击的最后一个点\r
            // 等待鼠标点击期间会执行setUserDraw动态绘制函数中的回调函数\r
            getNextPoint.setUserDraw((pt, pw) => {\r
                // pt 就是鼠标所在图纸位置的坐标\r
                // pw 是提供了一些动态绘制方法的对象\r
                let pl = new McDbPolyline();\r
                pl.addVertexAt(lastPoint.pt, lastPoint.dBulge, lastPoint.dStartWidth, lastPoint.dEndWidth)\r
                pl.addVertexAt(pt, 0, dStartWidth, dEndWidth);\r
                pw.drawMcDbEntity(pl);\r
            })\r
            let nextPoint = await getNextPoint.go();\r
            if (nextPoint !== null) {\r
                // 获取到了鼠标点击点\r
                pointArr.push({ pt: nextPoint, dBulge: 0, dStartWidth, dEndWidth });\r
                let pl = new McDbPolyline();\r
                pl.addVertexAt(lastPoint.pt, lastPoint.dBulge, lastPoint.dStartWidth, lastPoint.dEndWidth);\r
                pl.addVertexAt(nextPoint, 0, dStartWidth, dEndWidth);\r
                drawObjIds.push(mxcad.drawEntity(pl))\r
            } else if (getNextPoint.getStatus() === Mx.MrxDbgUiPrBaseReturn.kKeyWord) {\r
                // 用户输入关键字\r
                let keyWord = getNextPoint.keyWordPicked()\r
                if (keyWord === 'A') {\r
                    // 绘制圆弧\r
                    isArc = true;\r
                } else if (keyWord === 'W') {\r
                    // 设置宽度\r
                    /**\r
                     * 输入空格宽度不变\r
                     */\r
                    let getWidth = new MxCADUiPrDist();\r
                    getWidth.setMessage('指定起点宽度:');\r
                    // 获取线宽\r
                    let dWVal = await getWidth.go();\r
                    if (dWVal !== null && getWidth.getStatus() !== Mx.MrxDbgUiPrBaseReturn.kNone) {\r
                        dStartWidth = getWidth.value();\r
                        pointArr[pointArr.length - 1].dStartWidth = dStartWidth;\r
                    }\r
                    getWidth.setMessage('指定端点宽度');\r
                    dWVal = await getWidth.go();\r
                    if (dWVal !== null && getWidth.getStatus() !== Mx.MrxDbgUiPrBaseReturn.kNone) {\r
                        dEndWidth = getWidth.value();\r
                        pointArr[pointArr.length - 1].dEndWidth = dEndWidth;\r
                    }\r
                } else if (keyWord === 'U') {\r
                    // 回退操作\r
                    if (pointArr.length > 1 && drawObjIds.length > 1) {\r
                        pointArr.pop();\r
                        drawObjIds[drawObjIds.length - 1].erase();\r
                        drawObjIds.pop();\r
                    }\r
                } else if (keyWord === 'C') {\r
                    isAutoClose = true;\r
                    break;\r
                }\r
            } else {\r
                break;\r
            }\r
        } else {\r
            // 绘制圆弧\r
            let getNextPoint = new MxCADUiPrPoint();\r
            getNextPoint.setMessage('指定圆弧的端点(按住 ctrl 键取相反方向)\\n');\r
            getNextPoint.setKeyWords('[第二个点(S)/角度(A)/圆心(CE)/放弃(U)/直线(L)/宽度(W)/闭合(CL)]');\r
            // 计算圆弧的切向量.\r
            let vecArcTangent = new McGeVector3d();\r
            // 开端的圆弧切向量取水平方向./获取圆弧切向\r
            if (pointArr.length < 2) {\r
                // 开端的圆弧切向量取水平方向.\r
                vecArcTangent.copy(McGeVector3d.kYAxis);\r
            } else {\r
                let length = pointArr.length;\r
                let p1 = pointArr[length - 2].pt;\r
                let dBulge = pointArr[length - 2].dBulge;\r
                let p2 = pointArr[length - 1].pt;\r
                if (dBulge === 0) {\r
                    // 前一段是个直线.\r
                    vecArcTangent = new McGePoint3d(p2.x, p2.y, 0.0).sub(new McGePoint3d(p1.x, p1.y, 0.0));\r
                }\r
                else {\r
                    // 前一段为曲线，求圆弧的切向量\r
                    let tmpPl = new McDbPolyline;\r
                    tmpPl.addVertexAt(p1, dBulge);\r
                    tmpPl.addVertexAt(p2);\r
                    let tmpVec = tmpPl.getFirstDeriv(new McGePoint3d(p2.x, p2.y, 0.0));//曲线上任意一点的切向量\r
                    if (tmpVec.ret) {\r
                        vecArcTangent = tmpVec.val;\r
                    }\r
                    else {\r
                        vecArcTangent.copy(McGeVector3d.kXAxis);\r
                    }\r
                }\r
            }\r
            let lastPoint = pointArr[pointArr.length - 1];\r
            //监听ctrl键是否被按下\r
            document.addEventListener('keydown', function (event) {\r
                if (event.ctrlKey && event.keyCode === 17) {\r
                    isReverse = true;\r
                }\r
            });\r
            // ctrl键松开\r
            document.addEventListener('keyup', function () {\r
                isReverse = false;\r
            });\r
            getNextPoint.setUserDraw((pt, pw) => {\r
                let pl = new McDbPolyline();\r
                let d = CMxDrawPolylineDragArcDraw_CalcArcBulge(lastPoint.pt, pt, arcDirection ? arcDirection : vecArcTangent);\r
                if (isReverse) d = -d;\r
                pl.addVertexAt(lastPoint.pt, d, lastPoint.dStartWidth, lastPoint.dEndWidth);\r
                pl.addVertexAt(pt, 0, dStartWidth, dEndWidth);\r
                pw.drawMcDbEntity(pl);\r
            })\r
            let nextPoint = await getNextPoint.go();\r
            if (nextPoint != null) {\r
                let dBulge = CMxDrawPolylineDragArcDraw_CalcArcBulge(lastPoint.pt, nextPoint, arcDirection ? arcDirection : vecArcTangent);\r
                if (isReverse) dBulge = -dBulge;\r
                lastPoint.dBulge = dBulge;\r
                pointArr.push({ pt: nextPoint, dBulge: 0, dStartWidth, dEndWidth });\r
                let pl = new McDbPolyline();\r
                pl.addVertexAt(lastPoint.pt, dBulge, lastPoint.dStartWidth, lastPoint.dEndWidth);\r
                pl.addVertexAt(nextPoint, 0, dStartWidth, dEndWidth);\r
                drawObjIds.push(mxcad.drawEntity(pl));\r
            } else if (getNextPoint.getStatus() === Mx.MrxDbgUiPrBaseReturn.kKeyWord) {\r
                // 获取用户输入关键字\r
                let keyWord = getNextPoint.keyWordPicked();\r
                if (keyWord === 'L') {\r
                    // 变直线\r
                    isArc = false;\r
                } else if (keyWord === 'U') {\r
                    // 回退\r
                    if (pointArr.length > 1 && drawObjIds.length > 1) {\r
                        pointArr.pop();\r
                        drawObjIds[drawObjIds.length - 1].erase();\r
                        drawObjIds.pop();\r
                    }\r
                } else if (keyWord === 'S') {\r
                    // 用户指定圆弧的第二个点\r
                    let getPoint2 = new MxCADUiPrPoint();//用户输入的指定点\r
                    getPoint2.setMessage("指定圆弧的第二个点");\r
                    let pt2: any = await getPoint2.go();\r
                    if (pt2 === null) return\r
                    let getPoint3 = new MxCADUiPrPoint();\r
                    getPoint3.setMessage("指定圆弧的端点");\r
                    let lastPoint = pointArr[pointArr.length - 1]\r
                    getPoint3.setUserDraw((pt, pw) => {\r
                        let arc = new McDbArc();\r
                        arc.computeArc(lastPoint.pt.x, lastPoint.pt.y, pt2.x, pt2.y, pt.x, pt.y);//三点绘制圆弧\r
                        pw.drawMcDbEntity(arc);\r
                    });\r
                    let pt3 = await getPoint3.go();\r
                    if (!pt3) break;\r
                    let retB = MxCADUtility.calcBulge(lastPoint.pt, pt2, pt3);//开始点,中点，结束点 三点计算当前弧线的凸度\r
                    if (!retB.ret) break;\r
                    pointArr[pointArr.length - 1] = retB.val;\r
                    pointArr.push({ pt: pt3, dBulge: 0, dStartWidth, dEndWidth });//最后一个点\r
                    let pl = new McDbPolyline();\r
                    pl.addVertexAt(lastPoint.pt, retB.val, dStartWidth, dEndWidth);\r
                    pl.addVertexAt(pt3);\r
                    drawObjIds.push(mxcad.drawEntity(pl));\r
                } else if (keyWord === 'W') {\r
                    // 设置宽度\r
                    let getWidth = new MxCADUiPrDist();\r
                    getWidth.setMessage('指定起点宽度:');\r
                    // 获取线宽\r
                    let dWVal = await getWidth.go();\r
                    if (dWVal !== null && getWidth.getStatus() !== Mx.MrxDbgUiPrBaseReturn.kNone) {\r
                        dStartWidth = getWidth.value();\r
                        pointArr[pointArr.length - 1].dStartWidth = dStartWidth;\r
                    }\r
                    getWidth.setMessage('指定端点宽度');\r
                    dWVal = await getWidth.go();\r
                    if (dWVal !== null && getWidth.getStatus() !== Mx.MrxDbgUiPrBaseReturn.kNone) {\r
                        dEndWidth = getWidth.value();\r
                        pointArr[pointArr.length - 1].dEndWidth = dEndWidth;\r
                    }\r
                } else if (keyWord === 'D') {\r
                    // 指定圆弧切向\r
                    let getDirection = new MxCADUiPrPoint();\r
                    getDirection.setMessage('指定圆弧起点的切向:');\r
                    let dirVal = await getDirection.go();\r
                    if (dirVal === null) break;\r
                    arcDirection = new McGeVector3d(dirVal.x, dirVal.y, dirVal.z)\r
                } else if (keyWord === 'CE') {\r
                    // 确定圆心\r
                    let getCenter = new MxCADUiPrPoint();\r
                    getCenter.setMessage('指定圆弧的圆心:');\r
                    let arcCenter: any = await getCenter.go();\r
                    if (!arcCenter) return;\r
                    // 起始角度：起点与圆心的连线与X轴正方向的夹角\r
                    // 结束角度：结束点与圆心的连线与X轴正方向的夹角\r
                    let getNextPoint = new MxCADUiPrPoint();\r
                    let lastPoint = pointArr[pointArr.length - 1];\r
                    let r: number = 0;//圆弧凸度\r
                    let arc = new McDbArc();//圆弧\r
                    // 开端的圆弧切向量取水平方向./获取圆弧切向\r
                    getNextPoint.setUserDraw(async (pt, pw) => {\r
                        // 起始角度\r
                        arc.startAngle = lastPoint.pt.sub(arcCenter).angleTo1(new McGeVector3d(arcCenter.x, 0, 0))//始终不变\r
                        arc.endAngle = pt.sub(arcCenter).angleTo1(new McGeVector3d(arcCenter.x, 0, 0))\r
                        arc.center = arcCenter;\r
                        arc.radius = arcCenter.distanceTo(lastPoint.pt);\r
                        if (pt.y < arcCenter.y) arc.endAngle = -arc.endAngle;\r
                        // // 获取圆弧上的第三个点\r
                        let lineX = new McDbPolyline();\r
                        lineX.addVertexAt(new McGePoint3d(arcCenter.x, 0, 0));\r
                        lineX.addVertexAt(new McGePoint3d(0, 0, 0));\r
                        let pointsX = arc.IntersectWith(lineX, 3);//X轴交点\r
                        // 获取凸度\r
                        let rLine = new McDbPolyline();\r
                        rLine.addVertexAt(arcCenter);\r
                        rLine.addVertexAt(pt);\r
                        let currentPoint = arc.IntersectWith(rLine, 2);//当前线段与圆弧的交点\r
                        let cp: any = null;\r
                        if (currentPoint.length() === 1) {\r
                            cp = currentPoint.at(0);\r
                        } else {\r
                            if (pt.distanceTo(currentPoint.at(0)) <= pt.distanceTo(currentPoint.at(1))) {\r
                                cp = currentPoint.at(0);\r
                            } else {\r
                                cp = currentPoint.at(1);\r
                            }\r
                        }\r
                        let retB = MxCADUtility.calcBulge(lastPoint.pt, pointsX.at(0), cp);\r
                        if (retB.ret) {\r
                            r = retB.val;\r
                            let pl = new McDbPolyline()\r
                            pl.addVertexAt(lastPoint.pt, r);\r
                            pl.addVertexAt(cp);\r
                            pw.drawMcDbEntity(pl)\r
                        }\r
                    })\r
                    let nextPoint = await getNextPoint.go();\r
                    if (!nextPoint) break;\r
                    // 获取凸度\r
                    let rLine = new McDbPolyline();\r
                    rLine.addVertexAt(arcCenter);\r
                    rLine.addVertexAt(nextPoint);\r
                    let currentPoint = arc.IntersectWith(rLine, 2);\r
                    let cp: any = null;\r
                    if (currentPoint.length() === 1) {\r
                        cp = currentPoint.at(0);\r
                    } else {\r
                        if (nextPoint.distanceTo(currentPoint.at(0)) <= nextPoint.distanceTo(currentPoint.at(1))) {\r
                            cp = currentPoint.at(0);\r
                        } else {\r
                            cp = currentPoint.at(1);\r
                        }\r
                    }\r
                    let pl = new McDbPolyline()\r
                    pl.addVertexAt(lastPoint.pt, r, dStartWidth, dEndWidth);\r
                    pl.addVertexAt(cp);\r
                    pointArr[pointArr.length - 1].dBulge = r;\r
                    pointArr.push({ pt: cp, dBulge: 0, dStartWidth, dEndWidth })\r
                    drawObjIds.push(mxcad.drawEntity(pl));\r
\r
                } else if (keyWord === 'CL') {\r
                    // 闭合\r
                    isAutoClose = true;\r
                    break;\r
                }\r
            } else {\r
                break;\r
            }\r
\r
        }\r
    }\r
    // 删除监听事件\r
    document.removeEventListener('keydown', () => isReverse = false)\r
    document.removeEventListener('keyup', () => isReverse = false)\r
    // 最终绘制\r
    /**\r
     * 先删除所有临时对象再重新绘制多边形\r
     */\r
    for (let i = 0; i < drawObjIds.length; i++) {\r
        drawObjIds[i].erase();\r
    }\r
    if (pointArr.length > 1) {\r
        let pl = new McDbPolyline();\r
        pointArr.forEach(item => {\r
            pl.addVertexAt(item.pt, item.dBulge, item.dStartWidth, item.dEndWidth)\r
        })\r
        pl.isClosed = isAutoClose;\r
        mxcad.drawEntity(pl);\r
    }\r
}\r
\r
// 计算圆弧凸度\r
function CMxDrawPolylineDragArcDraw_CalcArcBulge(firstPoint, nextPoint, vecArcTangent): number {\r
    if (firstPoint.isEqualTo(nextPoint))\r
        return 0.0;\r
    let midPt = firstPoint.c().addvec(nextPoint.c().sub(firstPoint).mult(0.5));\r
\r
    let vecMid = nextPoint.c().sub(firstPoint);\r
    vecMid.rotateBy(Math.PI / 2.0, McGeVector3d.kZAxis);\r
\r
    let tmpMidLine = new McDbLine(midPt, midPt.c().addvec(vecMid));\r
\r
    let vecVertical = vecArcTangent.c();\r
    vecVertical.rotateBy(Math.PI / 2.0, McGeVector3d.kZAxis);\r
\r
    let tmpVerticalLine = new McDbLine(firstPoint, firstPoint.c().addvec(vecVertical));\r
\r
    let aryPoint = tmpMidLine.IntersectWith(tmpVerticalLine, McDb.Intersect.kExtendBoth);\r
    if (aryPoint.isEmpty())\r
        return 0.0;\r
\r
    let arcCenPoint = aryPoint.at(0);\r
\r
    let dR = arcCenPoint.distanceTo(firstPoint);\r
\r
    vecMid.normalize();\r
    vecMid.mult(dR);\r
\r
    let arcMidPt1 = arcCenPoint.c().addvec(vecMid);\r
    let arcMidPt2 = arcCenPoint.c().subvec(vecMid);\r
    let vecArcDir1 = arcMidPt1.c().sub(firstPoint);\r
    let vecArcDir2 = arcMidPt2.c().sub(firstPoint);\r
    let arcMidPt = arcMidPt1;\r
    if (vecArcDir1.angleTo1(vecArcTangent) > vecArcDir2.angleTo1(vecArcTangent)) {\r
        arcMidPt = arcMidPt2;\r
    }\r
    return MxCADUtility.calcBulge(firstPoint, arcMidPt, nextPoint).val;\r
}\r
\r
// 调用画多段线的方法\r
Mx_drawPolyline();`,WU=`import { McDbEllipse,MxCADUiPrPoint, McDbLine, McGePoint3d, MxCADUiPrDist, MxCpp } from "mxcad";\r
\r
// 绘制椭圆\r
async function drawMxDbEllipse() {\r
 \r
    // 创建椭圆对象\r
    const ellipse = new McDbEllipse();\r
    \r
    // 指定椭圆的轴端点\r
    const getPt1 = new MxCADUiPrPoint();\r
    getPt1.setMessage("\\n指定椭圆的轴端点:");\r
    const pt1 = await getPt1.go();\r
    if (!pt1) return;\r
\r
    // 指定椭圆轴的另一个端点\r
    const getPt2 = new MxCADUiPrPoint();\r
    getPt2.setMessage("\\n指定椭圆轴的另一个端点:");\r
    getPt2.setUserDraw((pt, pw) => {\r
        const line = new McDbLine(pt, pt1);\r
        pw.drawMcDbEntity(line);\r
    })\r
    const pt2 = await getPt2.go();\r
    if (!pt2) return;\r
\r
    // 获取椭圆中心点\r
    const center = new McGePoint3d((pt1.x + pt2.x) / 2, (pt1.y + pt2.y) / 2);\r
    ellipse.center = center;\r
    ellipse.majorAxis = pt1.sub(pt2);\r
    const xRadius = pt1.distanceTo(pt2) / 2\r
\r
    // 指定另一条半轴长度\r
    const getDist = new MxCADUiPrDist();\r
    getDist.setMessage("指定另一条半轴长度")\r
    getDist.setBasePt(center)\r
    getDist.setUserDraw((pt, pw) => {\r
        const yRadius = center.distanceTo(pt) / 2\r
        // 设置椭圆的副轴长度与主轴长度的比值\r
        ellipse.radiusRatio = yRadius / xRadius\r
        pw.drawMcDbEntity(ellipse)\r
    })\r
    let length = await getDist.go()\r
    if (!length) return\r
    if (getDist.getDetailedResult() === Mx.DetailedResult.kCoordIn) {\r
        const yRadius = length / 2\r
        ellipse.radiusRatio = yRadius / xRadius\r
    }\r
    MxCpp.getCurrentMxCAD().drawEntity(ellipse)\r
};\r
\r
// 调用绘制椭圆的方法\r
drawMxDbEllipse();`,qU=`import { MxCADUiPrPoint, MxCADUtility, MxCpp } from "mxcad";\r
\r
// 选点填充\r
async function MxTest_DrawHatchFormPoint() {\r
    // 指定填充区域内部一点\r
    const getPoint = new MxCADUiPrPoint();\r
    getPoint.setMessage("\\n指定填充区域内部一点:");\r
    getPoint.disableAllTrace(true);\r
    getPoint.setDisableOsnap(true);\r
    let pt = await getPoint.go();\r
    if (!pt) return;\r
    \r
    // 绘制填充\r
    let hatch = MxCADUtility.builderHatchFromPoint(pt);\r
    if (!hatch) {\r
        Mx.MxFun.acutPrintf("没有找到闭合区域\\n")\r
        return;\r
    }\r
\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    mxcad.drawEntity(hatch);\r
};\r
\r
// 调用选点填充的方法\r
MxTest_DrawHatchFormPoint();`,YU=`import { McDbBlockReference, MxCADUiPrPoint, MxCpp } from "mxcad";\r
\r
function getHostUrl(): string {\r
    let host = window.location.hostname;\r
    if (host.substring(0, 4) != "http") {\r
        host = document.location.protocol + "//" + host;\r
    }\r
    return host;\r
}\r
\r
// 插入图块\r
async function MxTest_InsertBlock() {\r
    let baseUrl = "http://localhost:3000/mxcad/"\r
    if (baseUrl.substring(0, 16) == "http://localhost") {\r
      baseUrl = getHostUrl() + baseUrl.substring(16);\r
    }\r
    // 设置图块路径\r
    let blkFilePath = baseUrl + "tree.mxweb";\r
\r
    // 插入图块文件\r
    let mxcad = MxCpp.App.getCurrentMxCAD();\r
    let blkrecId = await mxcad.insertBlock(blkFilePath, "tree");\r
    if (!blkrecId.isValid()) {\r
        // 插入图块\r
        return;\r
    }\r
\r
    // 设置图块大小\r
    let blkRef = new McDbBlockReference();\r
    blkRef.blockTableRecordId = blkrecId;\r
    let box = blkRef.getBoundingBox();\r
    if (box.ret) {\r
        let dLen = box.maxPt.distanceTo(box.minPt);\r
        if (dLen > 0.00001) {\r
            blkRef.setScale(mxcad.getMxDrawObject().screenCoordLong2Doc(100) / dLen);\r
        }\r
    }\r
\r
    // 指定插入基点\r
    let getPoint = new MxCADUiPrPoint();\r
    getPoint.setMessage("\\指定插入基点");\r
\r
    // 动态绘制图块\r
    getPoint.setUserDraw((v, worldDraw) => {\r
        blkRef.position = v;\r
        worldDraw.drawMcDbEntity(blkRef);\r
    });\r
\r
    let pt = await getPoint.go();\r
    if (!pt) return;\r
    blkRef.position = pt;\r
    // 绘制图块\r
    let newBlkRefId = mxcad.drawEntity(blkRef);\r
    if (!newBlkRefId.isValid) {\r
        console.log("insert error");\r
        return;\r
    }\r
};\r
\r
// 调用插入图块方法\r
MxTest_InsertBlock();`,XU=`import { IMcDbDwgFiler, McDb, McDbCustomEntity, McDbEntity, McDbMText, McDbPolyline, McDbText, McGePoint3d, McGePoint3dArray, MxCADUiPrPoint, MxCADUtility, MxCADWorldDraw, MxCpp } from "mxcad";\r
\r
// 新创建 McDbTestLineCustomEntity 类继承 McDbCustomEntity\r
class McDbTestRectangle extends McDbCustomEntity {\r
    // 定义McDbTestLineCustomEntity内部的点对象 \r
    // 矩形角点pt1、pt2\r
    private pt1: McGePoint3d = new McGePoint3d();\r
    private pt2: McGePoint3d = new McGePoint3d();\r
    /** 包围盒最大点 包围盒最小点 */\r
    private minPt: McGePoint3d = new McGePoint3d();\r
    private maxPt: McGePoint3d = new McGePoint3d();\r
    // 构造函数\r
    constructor(imp?: any) {\r
        super(imp);\r
    }\r
    // 创建函数\r
    public create(imp: any) {\r
        return new McDbTestRectangle(imp)\r
    }\r
    // 获取类名\r
    public getTypeName(): string {\r
        return "McDbTestRectangle";\r
    }\r
    // 读取自定义实体数据pt1、pt2\r
    public dwgInFields(filter: IMcDbDwgFiler): boolean {\r
        this.pt1 = filter.readPoint("pt1").val;\r
        this.pt2 = filter.readPoint("pt2").val;\r
        this.minPt = filter.readPoint("minPt").val;\r
        this.maxPt = filter.readPoint("maxPt").val;\r
        return true;\r
    }\r
    // 写入自定义实体数据pt1、pt2\r
    public dwgOutFields(filter: IMcDbDwgFiler): boolean {\r
        filter.writePoint("pt1", this.pt1);\r
        filter.writePoint("pt2", this.pt2);\r
        filter.writePoint("minPt", this.minPt);\r
        filter.writePoint("maxPt", this.maxPt);\r
        return true;\r
    }\r
\r
    // 移动自定义对象的夹点\r
    public moveGripPointsAt(iIndex: number, dXOffset: number, dYOffset: number, dZOffset: number) {\r
        this.assertWrite();\r
        if (iIndex == 0) {\r
            this.pt1.x += dXOffset;\r
            this.pt1.y += dYOffset;\r
            this.pt1.z += dZOffset;\r
        }\r
        else if (iIndex == 1) {\r
            this.pt2.x += dXOffset;\r
            this.pt2.y += dYOffset;\r
            this.pt2.z += dZOffset;\r
        }\r
    };\r
    // 获取自定义对象的夹点\r
    public getGripPoints(): McGePoint3dArray {\r
        let ret = new McGePoint3dArray()\r
        ret.append(this.pt1);\r
        ret.append(this.pt2);\r
        return ret;\r
    };\r
    // 绘制实体\r
    public worldDraw(draw: MxCADWorldDraw): void {\r
        const allEntityArr: McDbEntity[] = [];\r
\r
        const pl = new McDbPolyline();\r
        pl.isClosed = true;\r
        pl.addVertexAt(this.pt1);\r
        pl.addVertexAt(new McGePoint3d(this.pt2.x, this.pt1.y));\r
        pl.addVertexAt(this.pt2);\r
        pl.addVertexAt(new McGePoint3d(this.pt1.x, this.pt2.y));\r
        draw.drawEntity(pl);\r
        allEntityArr.push(pl)\r
\r
        this.getBox(allEntityArr);\r
    }\r
    private getBox(entityArr: McDbEntity[]) {\r
        const mxcad = MxCpp.getCurrentMxCAD();\r
        let _minPt, _maxPt = null;\r
        let result;\r
        entityArr.forEach(entity => {\r
            if (entity instanceof McDbText) {\r
                const ent = new McDbMText()\r
                ent.contents = entity.textString;\r
                ent.textHeight = entity.height;\r
                ent.location = entity.position;\r
                switch (entity.horizontalMode) {\r
                    case McDb.TextHorzMode.kTextLeft:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomLeft;\r
                        break;\r
                    case McDb.TextHorzMode.kTextCenter:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomCenter;\r
                        break;\r
                    case McDb.TextHorzMode.kTextRight:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomRight;\r
                        break;\r
                    case McDb.TextHorzMode.kTextMid:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomCenter;\r
                        break;\r
                    default:\r
                        ent.attachment = McDb.AttachmentPoint.kBottomLeft;\r
                        break;\r
                }\r
                // 将ent的文字样式设置为当前文字样式\r
                const textStyleId = mxcad.getDatabase().getCurrentlyTextStyleId();\r
                ent.textStyleId = textStyleId;\r
                ent.reCompute();\r
                result = MxCADUtility.getTextEntityBox(ent, false);\r
            } else if (entity instanceof McDbMText) {\r
                entity.reCompute();\r
                result = MxCADUtility.getTextEntityBox(entity, false);\r
            } else {\r
                result = entity.getBoundingBox();\r
            }\r
            const { minPt, maxPt, ret } = result;\r
            if (!_minPt) _minPt = minPt.clone();\r
            if (!_maxPt) _maxPt = maxPt.clone();\r
            if (minPt.x < _minPt.x) _minPt.x = minPt.x;\r
            if (minPt.y < _minPt.y) _minPt.y = minPt.y;\r
            if (maxPt.x > _maxPt.x) _maxPt.x = maxPt.x;\r
            if (maxPt.y > _maxPt.y) _maxPt.y = maxPt.y;\r
        });\r
        if (_minPt && _maxPt) {\r
            this.maxPt = _maxPt;\r
            this.minPt = _minPt\r
        }\r
    }\r
    // 设置pt1\r
    public setPoint1(pt1: McGePoint3d) {\r
        this.assertWrite();\r
        this.pt1 = pt1.clone();\r
    }\r
    // 设置pt2\r
    public setPoint2(pt2: McGePoint3d) {\r
        this.assertWrite();\r
        this.pt2 = pt2.clone();\r
    }\r
    // 获取pt1\r
    public getPoint1() {\r
        return this.pt1;\r
    }\r
    // 获取pt2\r
    public getPoint2() {\r
        return this.pt2;\r
    }\r
    // 获取包围盒\r
    public getBoundingBox(): { minPt: McGePoint3d; maxPt: McGePoint3d; ret: boolean; } {\r
        return { minPt: this.minPt, maxPt: this.maxPt, ret: true }\r
    }\r
}\r
\r
\r
async function MxTest_DrawCustomEntity() {\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    const getPoint = new MxCADUiPrPoint();\r
    getPoint.setMessage("\\n指定第一个角点:");\r
    let pt1 = await getPoint.go();\r
    if (!pt1) return;\r
    const myRect = new McDbTestRectangle();\r
    myRect.setPoint1(pt1);\r
\r
    getPoint.setMessage("\\n指定第二个角点:");\r
    getPoint.setUserDraw((pt, pw) => {\r
        myRect.setPoint2(pt);\r
        pw.drawMcDbEntity(myRect);\r
    })\r
    let pt2 = await getPoint.go();\r
    if (!pt2) return;\r
\r
    myRect.setPoint2(pt2);\r
    mxcad.drawEntity(myRect);\r
}\r
\r
// 注册自定义实体\r
new McDbTestRectangle().rxInit();\r
// 调用方法绘制自定义实体\r
MxTest_DrawCustomEntity();\r
`,KU=`import { McDbAlignedDimension, McDbArc, McDbBlockReference, McDbCircle, McDbDimension, McDbHatch, McDbLine, McDbMText, McDbPolyline, McDbRasterImage, McDbRotatedDimension, McDbText, MxCADSelectionSet } from "mxcad";\r
\r
\r
// 点对象转字符串\r
function McGePoint3dToString(pt): string {\r
    return "x=" + pt.x + ",y=" + pt.y + ",z=" + pt.z;\r
}\r
\r
// 实体对象转json对象\r
function McDbEntityToJsonObject(ent): object {\r
    let obj: any = {}\r
    obj.ObjectName = ent.objectName;// 对象名\r
    obj.id = ent.getObjectID().id;// 对象id\r
    obj.handle = ent.getHandle(); // 对象句柄\r
    obj.layer = ent.layer; // 对象所在图层\r
    obj.color = ent.trueColor.getColorString(); // 对象颜色说明字符串\r
    obj.colorVal = ent.trueColor.getColorValue(ent.layerId); // 对象颜色字符串\r
    obj.linetype = ent.linetype; // 对象线型\r
    obj.textStyle = ent.textStyle; // 对象文字样式\r
    obj.dxf0 = ent.dxf0;// 得到对象的DXF组码的类型名\r
\r
    if (ent instanceof McDbText) {\r
        // 文字对象\r
        let txt = ent as McDbText;\r
        obj.position = McGePoint3dToString(txt.position);\r
        obj.textString = txt.textString;\r
    }\r
    else if (ent instanceof McDbMText) {\r
        // 多行文字对象\r
        let mtxt = ent as McDbMText;\r
        obj.contents = mtxt.contents;\r
        obj.location = McGePoint3dToString(mtxt.location);\r
    }\r
    else if (ent instanceof McDbLine) {\r
        // 直线对象\r
        let line = ent as McDbLine;\r
        obj.startPoint = McGePoint3dToString(line.startPoint);\r
        obj.endPoint = McGePoint3dToString(line.endPoint);\r
    }\r
    else if (ent instanceof McDbCircle) {\r
        // 圆对象\r
        let circle = ent as McDbCircle;\r
        obj.center = McGePoint3dToString(circle.center);\r
        obj.radius = circle.radius;\r
    }\r
    else if (ent instanceof McDbArc) {\r
        // 圆弧对象\r
        let arc = ent as McDbArc;\r
        obj.center = McGePoint3dToString(arc.center);\r
        obj.startAngle = arc.startAngle;\r
        obj.endAngle = arc.endAngle;\r
    }\r
    else if (ent instanceof McDbPolyline) {\r
        // 多段线对象\r
        let polyline = ent as McDbPolyline;\r
        let num = polyline.numVerts();\r
        obj.num = num;\r
        for (let i = 0; i < num; i++) {\r
            let pt = polyline.getPointAt(i);\r
            let bulge = polyline.getBulgeAt(i);\r
            obj["pt" + i] = McGePoint3dToString(pt.val);\r
            obj["bulge" + i] = bulge;\r
        }\r
    }\r
    else if (ent instanceof McDbBlockReference) {\r
        // 块引用对象\r
        let blkRef = ent as McDbBlockReference;\r
        obj.position = McGePoint3dToString(blkRef.position);\r
        obj.blockTransform = blkRef.blockTransform;\r
        obj.blockName = blkRef.blockName;\r
    }\r
    else if (ent instanceof McDbAlignedDimension) {\r
        // 对齐标注对象\r
        let alignedDim = ent as McDbAlignedDimension;\r
        obj.xLine1Point = McGePoint3dToString(alignedDim.xLine1Point);\r
        obj.xLine2Point = McGePoint3dToString(alignedDim.xLine2Point);\r
        let txts = alignedDim.GetAllText();\r
        txts.forEach((val, index) => {\r
            obj["txt:" + index] = val;\r
        });\r
    }\r
    else if (ent instanceof McDbRotatedDimension) {\r
        // 旋转标注对象\r
        let rotatedDim = ent as McDbRotatedDimension;\r
        obj.xLine1Point = McGePoint3dToString(rotatedDim.xLine1Point);\r
        obj.xLine2Point = McGePoint3dToString(rotatedDim.xLine2Point);\r
        let txts = rotatedDim.GetAllText();\r
        txts.forEach((val, index) => {\r
            obj["txt:" + index] = val;\r
        });\r
    }\r
    else if (ent instanceof McDbDimension) {\r
        // 标注对象\r
        let dim = ent as McDbDimension;\r
        let txts = dim.GetAllText();\r
        txts.forEach((val, index) => {\r
            obj["txt:" + index] = val;\r
        });\r
    }\r
    else if (ent instanceof McDbHatch) {\r
        // 填充对象\r
        let hatch = ent as McDbHatch;\r
        obj.patternType = hatch.patternType();\r
        obj.patternName = hatch.patternName();\r
        obj.patternAngle = hatch.patternAngle;\r
        obj.patternScale = hatch.patternScale;\r
        obj.patternSpace = hatch.patternSpace;\r
        obj.patternDouble = hatch.patternDouble;\r
        obj.hatchStyle = hatch.hatchStyle();\r
        obj.isSolid = hatch.isSolid();\r
        obj.numLoops = hatch.numLoops;\r
        for (let i = 0; i < obj.numLoops; i++) {\r
            let loop: any = hatch.getLoopAt(i);\r
            loop.vertices.forEach((val: any, inidex: number) => {\r
                loop["pt:" + inidex] = {};\r
                loop["pt:" + inidex].x = val.x;\r
                loop["pt:" + inidex].y = val.y;\r
                loop["pt:" + inidex].z = val.z;\r
            })\r
            obj["loop:" + i] = loop;\r
        };\r
        obj.numPatternDefinitions = hatch.numPatternDefinitions;\r
        for (let i = 0; i < obj.numPatternDefinitions; i++) {\r
            obj["patternDefinitions:" + i] = hatch.getPatternDefinitionAt(i);\r
        };\r
    }\r
    else if (ent instanceof McDbRasterImage) {\r
        // 位图对象\r
        let image = ent as McDbRasterImage;\r
        let orientation = image.getOrientation();\r
        obj.orientation = {};\r
        obj.orientation.origin = orientation.origin.toVector3();\r
        obj.orientation.uCorner = orientation.uCorner.toVector3();\r
        obj.orientation.vOnPlane = orientation.vOnPlane.toVector3();\r
\r
        let clipBoundary = image.clipBoundary();\r
        obj.clipBoundary = {};\r
        clipBoundary.forEach((pt, index) => {\r
            obj.clipBoundary["pt" + index] = pt.toVector3();\r
        });\r
\r
        obj.clipBoundaryType = image.clipBoundaryType();\r
\r
        let imageDef = image.imageDefId().getMcDbRasterImageDef();\r
        if (imageDef) {\r
            obj.filePath = imageDef.sourceFileName;\r
        }\r
    }\r
\r
    return obj;\r
}\r
// 得到图纸所有对象\r
async function TestGetAllEntity() {\r
\r
    let ss = new MxCADSelectionSet();\r
    ss.allSelect();\r
    ss.forEach((id) => {\r
        let ent: any = id.getMcDbEntity();\r
        if (!ent) return;\r
        ent = McDbEntityToJsonObject(ent);\r
        console.log(JSON.stringify(ent));\r
    })\r
};\r
\r
// 调用得到图纸所有对象的方法\r
TestGetAllEntity()`,ZU=`import { McDbLayerTableRecord, MxCpp } from "mxcad";\r
\r
// 添加图层\r
function MxTest_AddLayer() {\r
    // 获取当前mxcad对象\r
    let mxcad = MxCpp.App.getCurrentMxCAD();\r
\r
    // 获取数据库图层表\r
    let layerTable = mxcad.getDatabase().getLayerTable();\r
    // 判断图层表中是否存在xxx11图层\r
    if (!layerTable.has("xxx11")) {\r
        // 不存在则创建xxx11图层\r
        let newLayer = new McDbLayerTableRecord();\r
        newLayer.name = "xxx11";\r
        layerTable.add(newLayer);\r
    }\r
\r
    if (layerTable.has("xxx11")) {\r
        // 存在则打印日志\r
        console.log("add layer ok");\r
    }\r
};\r
\r
// 调用添加图层的方法\r
MxTest_AddLayer(); `,JU=`import { MxCpp } from "mxcad";\r
\r
function MxTest_GetAllBlock() {\r
    // 获取当前mxcad对象\r
    let mxcad = MxCpp.App.getCurrentMxCAD();\r
    // 获取数据库块表\r
    let blockTable = mxcad.getDatabase().getBlockTable();\r
    // 获取所有块表记录的id数组\r
    let aryId = blockTable.getAllRecordId();\r
    // 遍历所有块表记录\r
    aryId.forEach((id) => {\r
        let blkRec = id.getMcDbBlockTableRecord();\r
        if (blkRec === null) return;\r
        console.log(blkRec);\r
        console.log("blkRec.name:" + blkRec.name);\r
        console.log("blkRec.origin:" + blkRec.origin);\r
    });\r
};\r
\r
// 调用获取所有图块的方法\r
MxTest_GetAllBlock();\r
`,QU=`import { MxCpp } from "mxcad";\r
import { MxFun } from "mxdraw";\r
\r
// 获取所有图层\r
function MxTest_GetAllLayer() {\r
  // 获取当前mxcad对象\r
    let mxcad = MxCpp.App.getCurrentMxCAD();\r
    // 获取图层表\r
    let layerTable = mxcad.getDatabase().getLayerTable();\r
    // 获取所有记录id\r
    let aryId = layerTable.getAllRecordId();\r
    let ret = [];\r
    // 遍历图层id\r
    aryId.forEach((id) => {\r
      let layerRec = id.getMcDbLayerTableRecord();\r
      if (layerRec === null) return;\r
  \r
      console.log(layerRec);\r
      console.log("layerRec.color:" + layerRec.color.getColorString());\r
      console.log("layerRec.name:" + layerRec.name);\r
      let layer: any = {};\r
      layer.name = layerRec.name;\r
  \r
      layer.color = layerRec.color.getColorString();\r
      ret.push(layer);\r
    });\r
    \r
    MxFun.postMessageToParentFrame(ret);\r
    return ret;\r
  };\r
\r
  // 调用获取所有图层的方法\r
  MxTest_GetAllLayer();`,$U=`import { MxCpp } from "mxcad"\r
\r
// 获取所有线型样式\r
function MxTest_GetAllLinetype() {\r
    // 获取当前mxcad对象\r
    let mxobj = MxCpp.getCurrentMxCAD();\r
    // 获取数据库线型样式表\r
    let linetypeTable = mxobj.getDatabase().getLinetypeTable();\r
    // 获取所有线型记录的ID数组\r
    let aryId = linetypeTable.getAllRecordId();\r
    // 遍历线型记录\r
    aryId.forEach((id) => {\r
        let linetypeRec = id.getMcDbLinetypeTableRecord();\r
        if (linetypeRec === null) return;\r
        console.log(linetypeRec);\r
    });\r
};\r
\r
// 调用获取所有线型样式\r
MxTest_GetAllLinetype()`,tV=`import { MxCpp } from "mxcad";\r
\r
// 获取所有文字样式\r
function MxTest_GetAllTextStyle() {\r
    // 获取当前mxcad对象\r
    let mxobj = MxCpp.getCurrentMxCAD();\r
    // 获取文字样式表\r
    let textSyleTable = mxobj.getDatabase().getTextStyleTable();\r
    // 获取文字样式表记录id数组\r
    let aryId = textSyleTable.getAllRecordId();\r
    // 遍历文字样式表记录\r
    aryId.forEach((id) => {\r
        let textSyleRec = id.getMcDbTextStyleTableRecord();\r
        if (textSyleRec === null) return;\r
        let out: any = {};\r
        out.name = textSyleRec.name;\r
        out.font = textSyleRec.font();\r
        out.fileName = textSyleRec.fileName;\r
        out.bigFontFileName = textSyleRec.bigFontFileName;\r
        out.textSize = textSyleRec.textSize;\r
        out.xScale = textSyleRec.xScale;\r
        console.log(out);\r
    });\r
};\r
\r
// 调用获取所有文字样式的方法\r
MxTest_GetAllTextStyle();\r
`,eV=`import { MxCADUiPrEntity } from "mxcad";\r
\r
// 读取扩展数据。\r
async function MxTest_ReadxData() {\r
    // 选择对象\r
    let selEntity = new MxCADUiPrEntity();\r
    selEntity.setMessage("选择对象");\r
    let id = await selEntity.go();\r
    if (!id.isValid()) return;\r
    \r
    // 获取对象\r
    let ent = id.getMcDbEntity();\r
    if (ent === null) return; \r
\r
    // 得到对象的扩展数据\r
    let data = ent.getxData();\r
    //data.PrintData();\r
    data.forEach((val, type, dxf) => {\r
        console.log(JSON.stringify({ val: val, type: type, dxf: dxf }));\r
    })\r
\r
    //let data = ent.getxDataString("DataName");\r
    //MxFun.acutPrintf(data.val + "\\n");\r
};\r
\r
// 调用读取扩展数据的方法\r
MxTest_ReadxData()`,nV=`import { MxCADUiPrEntity } from "mxcad";\r
\r
// 写扩展数据\r
async function MxTest_WritexData() {\r
    // 选择对象\r
    let selEntity = new MxCADUiPrEntity();\r
    selEntity.setMessage("选择对象");\r
    let id = await selEntity.go();\r
    if (!id.isValid()) return;\r
     \r
    // 获取对象\r
    let ent = id.getMcDbEntity();\r
    if (ent === null) return;\r
    // 写扩展数据\r
    ent.setxDataString("DataName", "xxxxx");\r
    //ent.setxData(new MxCADResbuf([{type:MxCADResbufDataType.kExDataName,val:"DataName"},{type:MxCADResbufDataType.kString,val:"yyyyy"}]));\r
};\r
\r
// 调用写扩展数据的方法\r
 MxTest_WritexData();\r
\r
`,iV=`import { MxCpp, McDbDictionary, McDbXrecord } from "mxcad";\r
\r
// 字典数据遍历\r
function MxTest_DictionaryData(dict) {\r
    let aryName = dict.getAllObjectName();\r
    aryName.forEach((name) => {\r
        console.log(name);\r
        let id = dict.getAt(name);\r
        let obj = id.getMcDbObject();\r
        if (obj instanceof McDbDictionary) {\r
            let dict = obj as McDbDictionary;\r
            console.log(dict);\r
            MxTest_DictionaryData(dict);\r
        }\r
        else if (obj instanceof McDbXrecord) {\r
            let xrec = obj as McDbXrecord;\r
            let data = xrec.getData()\r
            data.PrintData();\r
        }\r
    })\r
}\r
\r
// 得到命名字典\r
async function MxTest_GetNamedObjectsDictionary() {\r
    let mxcad = MxCpp.getCurrentMxCAD();\r
    let dict = mxcad.getDatabase().getNamedObjectsDictionary();\r
    let aryName = dict.getAllObjectName();\r
    aryName.forEach((name) => {\r
        console.log(name);\r
        let id = dict.getAt(name);\r
        let obj = id.getMcDbObject();\r
        if (obj instanceof McDbDictionary) {\r
            let dict = obj as McDbDictionary;\r
            console.log(dict);\r
            MxTest_DictionaryData(dict);\r
        }\r
    })\r
}\r
\r
// 调用得到命名字典方法\r
MxTest_GetNamedObjectsDictionary()`,MA=[{type:"参数绘图",name:"画直线",code:`${wU}`},{type:"参数绘图",name:"画圆",code:AU},{type:"参数绘图",name:"画点",code:EU},{type:"参数绘图",name:"画圆弧",code:PU},{type:"参数绘图",name:"画图片",code:TU},{type:"参数绘图",name:"画多段线",code:SU},{type:"参数绘图",name:"画椭圆",code:CU},{type:"参数绘图",name:"画文字",code:DU},{type:"参数绘图",name:"画多行文字",code:RU},{type:"参数绘图",name:"画尺寸标注",code:LU},{type:"参数绘图",name:"画路径",code:IU},{type:"参数绘图",name:"画填充",code:kU},{type:"参数绘图",name:"画图块",code:BU},{type:"参数绘图",name:"画文本自定义实体",code:FU},{type:"参数绘图",name:"画多种线型的直线",code:zU},{type:"参数绘图",name:"画多种文字样式的文字",code:NU},{type:"交互绘图",name:"取点画圆弧",code:UU},{type:"交互绘图",name:"取点画直线",code:VU},{type:"交互绘图",name:"取点画文字",code:GU},{type:"交互绘图",name:"取点画圆",code:OU},{type:"交互绘图",name:"取点画图片",code:jU},{type:"交互绘图",name:"取点画多段线",code:HU},{type:"交互绘图",name:"取点画椭圆",code:WU},{type:"交互绘图",name:"选点填充",code:qU},{type:"交互绘图",name:"插入图块",code:YU},{type:"交互绘图",name:"绘制矩形",code:XU},{type:"图纸数据库",name:"得到图纸所有对象",code:KU},{type:"图纸数据库",name:"添加图层",code:ZU},{type:"图纸数据库",name:"得到图纸所有图块",code:JU},{type:"图纸数据库",name:"得到图纸所有图层",code:QU},{type:"图纸数据库",name:"得到图纸所有线型样式",code:$U},{type:"图纸数据库",name:"得到图纸所有文字样式",code:tV},{type:"图纸数据库",name:"读扩展数据",code:eV},{type:"图纸数据库",name:"写入扩展数据",code:nV},{type:"图纸数据库",name:"得到命名字典",code:iV}];function rV(t,e,n){const s=t.distanceTo(e)/2,u=s*n,h=(s*s+u*u)/(2*u),o=(t.x+e.x)/2,m=(t.y+e.y)/2;return new p.McGePoint3d(o,m).addvec(e.clone().sub(t).perpVector().normalize().mult(h-u))}function oV(t,e,n){const r=Math.PI*2/360;let s=Math.atan2(e.y-t.y,e.x-t.x)*180/Math.PI*r,u=Math.atan2(n.y-t.y,n.x-t.x)*180/Math.PI*r;return{startAngle:s,endAngle:u}}$.MxFun.addCommand("list",()=>Gt(this,null,function*(){const t=yield p.MxCADUtility.userSelect("选择对象"),e=new p.MxCADUiPrPoint;$.MxFun.acutPrintf("找到"+t.length+`个
`);const n=t.pop();if(!n)return;const r=n.getMcDbEntity();if(!n.isValid()||!r)$.MxFun.acutPrintf(`对象无效
`);else if((yield EA(r))===!1)return;for(;t.length;){if(e.setMessage("按 ENTER 键继续"),e.setDisableDynInput(!0),yield e.go(),e.getDetailedResult()===$.DetailedResult.kCodeAbort||e.getDetailedResult()===$.DetailedResult.kEcsIn||e.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;const s=t.pop();if(!s)break;const u=s.getMcDbEntity();if(!s.isValid()||!u){$.MxFun.acutPrintf(`对象无效
`);continue}if((yield EA(u))===!1)return}}));const sV={McDbPoint:"点",McDbLine:"直线",McDbPolyline:"多段线",McDbArc:"圆弧",McDbCircle:"圆",McDbEllipse:"椭圆",McDbHatch:"填充",McDbText:"单行文本",McDbMText:"多行文本",McDbRasterImage:"光栅图片",McDbBlockReference:"块参照"},wA={Top:"上",Middle:"中",Bottom:"下",Base:"基",Left:"左",Center:"中",Right:"右",Align:"对齐",Fit:"适应",Mid:"中"},AA=t=>t.replace(/k(\w+)/g,function(e,n){return n.replace(/([A-Z])/g,"-$1").split("-").reduce((h,o)=>wA[o]?h+wA[o]:"")});function EA(t){return Gt(this,null,function*(){const e=t.layer,s=p.MxCpp.getCurrentDatabase().currentSpace.name==="*Model_Space"?"模型空间":"图纸空间",u=t.getHandle();console.log(t.objectName);let h=sV[t.objectName]||t.objectName;if(t instanceof p.McDbDimension&&(h="标注"),$.MxFun.acutPrintf(`
                  ${h}        图层: "${e}"`),$.MxFun.acutPrintf(`
                           空间: "${s}"`),$.MxFun.acutPrintf(`
                    句柄 = ${u}`),t instanceof p.McDbPoint&&$.MxFun.acutPrintf(`
                 于 点， X= ${t.position.x.toFixed(4)}  Y= ${t.position.y.toFixed(4)}  Z= ${t.position.z.toFixed(4)}`),t instanceof p.McDbLine){$.MxFun.acutPrintf(`
                 自 点， X= ${t.startPoint.x.toFixed(4)}  Y= ${t.startPoint.y.toFixed(4)}  Z= ${t.startPoint.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                 到 点， X= ${t.startPoint.x.toFixed(4)}  Y= ${t.startPoint.y.toFixed(4)}  Z= ${t.startPoint.z.toFixed(4)}`);let o=t.endPoint.x-t.startPoint.x,m=t.endPoint.y-t.startPoint.y,y=t.endPoint.z-t.startPoint.z,x=THREE.MathUtils.radToDeg(Math.atan2(m,o));$.MxFun.acutPrintf(`
          长度 = ${t.getLength().val.toFixed(4)}，在 XY 平面中的角度 = ${Math.floor(x)}`),$.MxFun.acutPrintf(`
                  增量 X =  ${o.toFixed(4)}，增量 Y =   ${m.toFixed(4)}，增量 Z =   ${y.toFixed(4)}`)}if(t instanceof p.McDbPolyline){$.MxFun.acutPrintf(`
            ${t.isClosed?"闭合":"打开"}`),$.MxFun.acutPrintf(`
        固定宽度    ${t.constantWidth.toFixed(4)}`),$.MxFun.acutPrintf(`
            面积   ${t.getArea().val.toFixed(4)}`),$.MxFun.acutPrintf(`
         周长   ${t.getLength().val.toFixed(4)}`);const o=t.numVerts(),m=new p.MxCADUiPrPoint,y=[],x=[];let M=!1;for(let P=0;P<o;P++){const D=t.getWidthsAt(P),k=t.getBulgeAt(P);(D.val1!==0||D.val2!==0)&&(M=!0),y.push(D),x.push(k)}let A=0;const T=3;for(let P=0;P<o;P++){if(A>T)for(;;){m.setMessage("按 ENTER 键继续"),m.disableAllTrace(),m.clearLastInputPoint(),m.setDynamicInputType($.DynamicInputType.kNoInput);const z=yield m.go();if(m.getDetailedResult()===$.DetailedResult.kCodeAbort||m.getDetailedResult()===$.DetailedResult.kEcsIn)return;if(m.getDetailedResult()===$.DetailedResult.kNewCommadIn)return!1;if(m.getDetailedResult()===$.DetailedResult.kNullEnterIn||m.getDetailedResult()===$.DetailedResult.kNullSpaceIn||z){A=0;break}}const D=t.getPointAt(P).val,k=x[P];if($.MxFun.acutPrintf(`
          于端点  X=  ${D.x.toFixed(1)}  Y=  ${D.y.toFixed(1)}  Z=  ${D.z.toFixed(1)}`),M&&($.MxFun.acutPrintf(`
    起点宽度  ${y[P].val1.toFixed(4)}`),$.MxFun.acutPrintf(`
      端点宽度  ${y[P].val2.toFixed(4)}`)),Math.abs(k)>0){$.MxFun.acutPrintf(`
             凸度       ${k.toFixed(1)}`);const z=t.getPointAt(P+1).val,O=rV(D,z,k);$.MxFun.acutPrintf(`
            圆心  X=  ${O.x.toFixed(1)}  Y=  ${O.y.toFixed(1)}  Z=  ${O.z.toFixed(1)}`),$.MxFun.acutPrintf(`
            半径    ${O.distanceTo(D).toFixed(1)}`);const{startAngle:U,endAngle:H}=oV(O,D,z);$.MxFun.acutPrintf(`
       起点角度       ${THREE.MathUtils.radToDeg(U).toFixed(0)}`),$.MxFun.acutPrintf(`
       端点角度       ${THREE.MathUtils.radToDeg(H).toFixed(0)}`),P===o-1&&$.MxFun.acutPrintf(`
          于端点  X=  ${z.x.toFixed(1)}  Y=  ${z.y.toFixed(1)}  Z=  ${z.z.toFixed(1)}`)}A++}}if(t instanceof p.McDbArc&&($.MxFun.acutPrintf(`
                圆心 点， X= ${t.center.x.toFixed(4)}  Y= ${t.center.y.toFixed(4)}  Z= ${t.center.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                半径  ${t.radius.toFixed(4)}`),$.MxFun.acutPrintf(`
                起点 角度    ${THREE.MathUtils.radToDeg(t.startAngle).toFixed(0)}`),$.MxFun.acutPrintf(`
                端点 角度    ${THREE.MathUtils.radToDeg(t.endAngle).toFixed(0)}`),$.MxFun.acutPrintf(`
            长度 ${t.getLength().val.toFixed(4)}`)),t instanceof p.McDbCircle&&($.MxFun.acutPrintf(`
                圆心 点， X= ${t.center.x.toFixed(4)}  Y= ${t.center.y.toFixed(4)}  Z= ${t.center.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                半径  ${t.radius.toFixed(4)}`),$.MxFun.acutPrintf(`
                周长 ${t.getLength().val.toFixed(4)}`),$.MxFun.acutPrintf(`
                面积 ${(Math.PI*t.radius*t.radius).toFixed(4)}`)),t instanceof p.McDbEllipse){const o=t.majorAxis.length(),m=t.minorAxis.length(),y=t.startAngle===0&&t.endAngle===2*Math.PI;if(y){const T=(P,D)=>{const k=Math.pow(P-D,2)/Math.pow(P+D,D);return Math.PI*(P+D)*(1+3*k/(10+Math.sqrt(4-3*k)))};$.MxFun.acutPrintf(`
                               面积: ${(Math.PI*o*m).toFixed(4)}`),$.MxFun.acutPrintf(`
                               圆周: ${T(o,m).toFixed(4)}`)}else{const T=(P,D,k,z,O)=>{const U=function(W){return Math.sqrt(P*P*Math.sin(W)*Math.sin(W)+D*D*Math.cos(W)*Math.cos(W))};let H=0;const V=(z-k)/O;for(let W=0;W<=O;W++){const K=k+W*V;W===0||W===O?H+=U(K):W%2===0?H+=2*U(K):H+=4*U(K)}return H*=V/3,Math.abs(H)};$.MxFun.acutPrintf(`
                               长度: ${T(o,m,t.startAngle,t.endAngle,30).toFixed(4)}`)}$.MxFun.acutPrintf(`
                              中心点: X = ${t.center.x.toFixed(4)} , Y = ${t.center.y.toFixed(4)}   , Z = ${t.center.z.toFixed(4)}`);const x=o>m,M=x?t.majorAxis:t.minorAxis,A=x?t.minorAxis:t.majorAxis;if($.MxFun.acutPrintf(`
                               长轴: X = ${M.x.toFixed(4)}  , Y = ${M.y.toFixed(4)}  , Z = ${M.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                               短轴: X = ${A.x.toFixed(4)}  , Y = ${A.y.toFixed(4)}  , Z = ${A.z.toFixed(4)}`),!y){const T=(k,z,O,U,H)=>{const V=k.x,W=k.y,K=z.x,Z=z.y,tt=O.x,at=O.y,st=Math.atan2(Z,K),nt=Math.sqrt(K*K+Z*Z),ct=Math.sqrt(tt*tt+at*at),xt=V+nt*Math.cos(U)*Math.cos(st)-ct*Math.sin(U)*Math.sin(st),vt=W+nt*Math.cos(U)*Math.sin(st)+ct*Math.sin(U)*Math.cos(st),Zt=V+nt*Math.cos(H)*Math.cos(st)-ct*Math.sin(H)*Math.sin(st),ce=W+nt*Math.cos(H)*Math.sin(st)+ct*Math.sin(H)*Math.cos(st);return{startPoint:new p.McGePoint3d(xt,vt),endPoint:new p.McGePoint3d(Zt,ce)}},{startPoint:P,endPoint:D}=T(t.center,t.majorAxis,t.minorAxis,t.startAngle,t.endAngle);$.MxFun.acutPrintf(`
                               起点: X = ${P.x.toFixed(4)} , Y = ${P.y.toFixed(4)}  , Z = ${P.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                               端点: X = ${D.x.toFixed(4)} , Y = ${D.y.toFixed(4)}  , Z = ${D.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                             起点角度: ${THREE.MathUtils.radToDeg(t.startAngle).toFixed(0)}`),$.MxFun.acutPrintf(`
                             端点角度: ${THREE.MathUtils.radToDeg(t.endAngle).toFixed(0)}`)}$.MxFun.acutPrintf(`
                             半径比例: ${t.radiusRatio.toFixed(4)}`)}if(t instanceof p.McDbHatch){const o=t.patternName();$.MxFun.acutPrintf(`
                 填充图案 ${o}`),$.MxFun.acutPrintf(`
                 图案填充比例    ${t.patternScale.toFixed(4)}`),$.MxFun.acutPrintf(`
                 图案填充角度      ${THREE.MathUtils.radToDeg(t.patternAngle).toFixed(0)}`);const m=new p.McDbPolyline,y=[];m.isClosed=!0;for(let M=0;M<t.numLoops;M++){const{vertices:A,bulges:T}=t.getLoopAt(M);A.forEach((P,D)=>{const k=T[D];m.addVertexAt(P,Number(k.toFixed(14)))}),y.push(m),p.MxCpp.getCurrentMxCAD().drawEntity(m)}const x=y.reduce((M,A)=>M+A.getArea().val,0);$.MxFun.acutPrintf(`
                 面积      ${x.toFixed(4)}`)}if(t instanceof p.McDbText&&($.MxFun.acutPrintf(`
              样式 = "${t.textStyle}"`),$.MxFun.acutPrintf(`
                起点 点， X=  ${t.position.x.toFixed(4)}  Y= ${t.position.y.toFixed(4)}  Z=   ${t.position.z.toFixed(4)}`),$.MxFun.acutPrintf(`
                高度    ${t.height.toFixed(4)}`),$.MxFun.acutPrintf(`
                文字 ${t.textString}`),$.MxFun.acutPrintf(`
                旋转 角度    ${t.rotation.toFixed(0)}`),$.MxFun.acutPrintf(`
                宽度 比例因子    ${t.widthFactor.toFixed(4)}`)),t instanceof p.McDbMText&&($.MxFun.acutPrintf(`
              样式 = "${t.textStyle}"`),$.MxFun.acutPrintf(`
位置:         X=  ${t.location.x.toFixed(4)}  Y=   ${t.location.y.toFixed(4)}  Z=   ${t.location.z.toFixed(4)}`),$.MxFun.acutPrintf(`
宽度:           ${t.width.toFixed(4)}`),$.MxFun.acutPrintf(`
法向:         X=   ${t.normal.x.toFixed(4)}  Y=   ${t.normal.y.toFixed(4)}  Z=   ${t.normal.z.toFixed(4)}`),$.MxFun.acutPrintf(`
旋转:                 ${t.rotation.toFixed(0)}`),$.MxFun.acutPrintf(`
文字高度:        ${t.textHeight.toFixed(4)}`),$.MxFun.acutPrintf(`
附着:        ${AA(p.McDb.AttachmentPoint[t.attachment])}`),$.MxFun.acutPrintf(`
内容:        ${t.contents}`)),t instanceof p.McDbRasterImage){const o=t.imageDefId().getMcDbRasterImageDef(),m=M=>M.split("/").pop().split("\\").pop();$.MxFun.acutPrintf(`
图像:                   ${m(o.sourceFileName)}`);const y=M=>{const A=M.clipBoundaryType();if(A===p.McDb.ClipBoundaryType.kInvalid)return"无效";if(A===p.McDb.ClipBoundaryType.kPoly)return"多边形";if(A===p.McDb.ClipBoundaryType.kRect)return"矩形"};$.MxFun.acutPrintf(`
剪裁边界类型:      ${y(t)}`);const x=t.clipBoundary();$.MxFun.acutPrintf(`
边界点数目: ${x.length()}`),t.clipBoundary().forEach(M=>{$.MxFun.acutPrintf(`
       位于点，X=   ${M.x.toFixed(4)}, Y=   ${M.y.toFixed(4)}, Z=   ${M.z.toFixed(4)}`)})}if(t instanceof p.McDbBlockReference&&($.MxFun.acutPrintf(`
块名:               "${t.blockName}"`),$.MxFun.acutPrintf(`
插入点:             X= ${t.position.x.toFixed(4)}, Y=   ${t.position.y.toFixed(4)}, Z=   ${t.position.z.toFixed(4)}`),$.MxFun.acutPrintf(`
X 比例因子:         ${t.scaleFactors.x.toFixed(4)}`),$.MxFun.acutPrintf(`
Y 比例因子:         ${t.scaleFactors.y.toFixed(4)}`),$.MxFun.acutPrintf(`
  旋转角度:         ${t.rotation.toFixed(0)}`),$.MxFun.acutPrintf(`
Z 比例因子:         ${t.scaleFactors.z.toFixed(4)}`),$.MxFun.acutPrintf(`
Z 比例因子:         ${t.scaleFactors.z.toFixed(4)}`),$.MxFun.acutPrintf(`
  缩放比例:         ${t.getScale().toFixed(4)}`)),t instanceof p.McDbDimension){$.MxFun.acutPrintf(`
文字位置:           X= ${t.textPosition.x.toFixed(4)} Y= ${t.textPosition.y.toFixed(4)} Z= ${t.textPosition.z.toFixed(4)}`),$.MxFun.acutPrintf(`
是否使用的默认文字位置:           ${t.isUsingDefaultTextPosition()}`),$.MxFun.acutPrintf(`
高度:          ${t.elevation.toFixed(4)}`),$.MxFun.acutPrintf(`
文本内容:       ${t.dimensionText}`),$.MxFun.acutPrintf(`
文本旋转角度:   ${THREE.MathUtils.radToDeg(t.textRotation).toFixed(0)}`);const o=t.dimensionStyle.getMcDbDimStyleTableRecord();$.MxFun.acutPrintf(`
标注样式:       ${o.name}`),$.MxFun.acutPrintf(`
文字附着:      ${AA(p.McDb.AttachmentPoint[t.textAttachment])}`),$.MxFun.acutPrintf(`
水平旋转角度:   ${THREE.MathUtils.radToDeg(t.horizontalRotation).toFixed(0)}`),$.MxFun.acutPrintf(`
水平旋转角度:   ${THREE.MathUtils.radToDeg(t.horizontalRotation).toFixed(0)}`)}$.MxFun.acutPrintf(`
命令`)})}$.MxFun.addCommand("group",()=>Gt(this,null,function*(){let t,e="",n="",r;const s=p.MxCpp.getCurrentDatabase(),u=s.GetGroupDictionary();for(;;){const h=yield p.MxCADUtility.userSelect("选择对象",null,(o,m)=>{m.setKeyWords("[名称(N)/说明(D)]"),t=m});if(t.getDetailedResult()===$.DetailedResult.kEcsIn||t.getDetailedResult()===$.DetailedResult.kCodeAbort||t.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;if(h&&(r=h),t.isKeyWordPicked("N")){for(;;){const o=new p.MxCADUiPrString;o.setMessage("输入编组名"),o.setKeyWords("[查询(A)]");const m=yield o.go();if(o.getDetailedResult()===$.DetailedResult.kCodeAbort||o.getDetailedResult()===$.DetailedResult.kEcsIn||o.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;if(o.isKeyWordPicked("A")){o.setMessage("请输入要列出的编码组名<*>"),o.setKeyWords("");const M=yield o.go();if(console.log(M),o.getDetailedResult()===$.DetailedResult.kCodeAbort||o.getDetailedResult()===$.DetailedResult.kEcsIn||o.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;if(M&&M!=="*"){const T=u.getAt(M).getMcDbObject();$.MxFun.acutPrintf(`
定义的编组:`),T&&$.MxFun.acutPrintf(`
 ${T.name}`)}else if(M==="*"||o.getDetailedResult()===$.DetailedResult.kNullEnterIn||o.getDetailedResult()===$.DetailedResult.kNullSpaceIn){const A=u.getAllObject();$.MxFun.acutPrintf(`
定义的编组:`),A.forEach(T=>{const P=T.getMcDbObject();P&&$.MxFun.acutPrintf(`
 ${P.name}`)})}continue}if(!m)return;const y=u.getAt(e);if(y.getMcDbObject()&&y.isValid()){$.MxFun.acutPrintf(`编组 ${e} 已经存在`);continue}e=m;break}continue}if(t.isKeyWordPicked("D")){const o=new p.MxCADUiPrString;o.setMessage("输入编组说明");const m=yield o.go();if(!m)return;n=m;continue}if(t.getDetailedResult()===$.DetailedResult.kNullEnterIn||t.getDetailedResult()===$.DetailedResult.kNullSpaceIn){if(r.some(m=>s.getEntitiesInTheGroup(m).length!==0)){const m=new p.MxCADUiPrKeyWord;m.setMessage("包含相同对象的组已经存在。仍要创建新的组？<N>"),m.setKeyWords("[是(Y)/否(N)]");const y=yield m.go();if((y==null?void 0:y.toLocaleUpperCase())==="N"||!y)return}if(s.CreateGroup(r,e)){const y=u.getAt(e).getMcDbObject();y.description=n}}break}})),$.MxFun.addCommand("ungroup",()=>Gt(this,null,function*(){let t;const n=p.MxCpp.getCurrentDatabase().GetGroupDictionary();for(;;){const r=new p.MxCADUiPrEntity;r.setMessage("选择对象"),r.setKeyWords("[名称(N)]");const s=yield r.go();if(r.getDetailedResult()===$.DetailedResult.kEcsIn||r.getDetailedResult()===$.DetailedResult.kCodeAbort||r.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;if(r.isKeyWordPicked("N")){for(;;){const u=new p.MxCADUiPrString;u.setMessage("输入编组名"),u.setKeyWords("[查询(A)]");const h=yield u.go();if(u.getDetailedResult()===$.DetailedResult.kCodeAbort||u.getDetailedResult()===$.DetailedResult.kEcsIn||u.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;if(u.isKeyWordPicked("A")){u.setMessage("请输入要列出的编码组名<*>"),u.setKeyWords("");const y=yield u.go();if(u.getDetailedResult()===$.DetailedResult.kCodeAbort||u.getDetailedResult()===$.DetailedResult.kEcsIn||u.getDetailedResult()===$.DetailedResult.kNewCommadIn)return;if(y&&y!=="*"){const M=n.getAt(y).getMcDbObject();$.MxFun.acutPrintf(`
定义的编组:`),M&&$.MxFun.acutPrintf(`
 ${M.name}`)}else if(y==="*"||u.getDetailedResult()===$.DetailedResult.kNullEnterIn||u.getDetailedResult()===$.DetailedResult.kNullSpaceIn){const x=n.getAllObject();$.MxFun.acutPrintf(`
定义的编组:`),x.forEach(M=>{const A=M.getMcDbObject();A&&$.MxFun.acutPrintf(`
 ${A.name}`)})}continue}if(!h)return;const o=n.getAt(t);if(o.getMcDbObject()&&o.isValid()){$.MxFun.acutPrintf(`编组 ${t} 已经存在`);continue}t=h;break}continue}if(s){const u=s.getMcDbEntity();if(u){const h=u.getHandle(),o=n.getAllObjectName(),m=o.length();for(let y=0;y<m;y++){const x=o.at(y),A=n.getAt(x).getMcDbObject();if(!A)continue;A.getAllEntityId().some(P=>{const D=P.getMcDbEntity();return(D==null?void 0:D.getHandle())===h?(t=x,!0):!1})}}}if(t){const h=n.getAt(t).getMcDbObject();if(h)h.clear(),n.remove(t),$.MxFun.acutPrintf(`
组 ${t} 已分解`);else{$.MxFun.acutPrintf(`
对象不是组成员`);continue}}else{$.MxFun.acutPrintf(`
对象不是组成员`);continue}break}}));const aV=`///////////////////////////////////////////////////////////////////////////////
//版权所有（C）2002-2022，成都梦想凯德科技有限公司。
//本软件代码及其文档和相关资料归成都梦想凯德科技有限公司,应用包含本软件的程序必须包括以下版权声明
//此应用程序应与成都梦想凯德科技有限公司达成协议，使用本软件、其文档或相关材料
//https://www.mxdraw.com/
///////////////////////////////////////////////////////////////////////////////

import { McDbEntity, McDbLine, McDbPoint, McDbPolyline, MxCADUiPrPoint, MxCADUtility, MxCpp, McGePoint3d, McDbArc, McDbCircle, McDbEllipse, McGeVector3d, McDbHatch, McDbText, McDbMText, McDb, McDbRasterImageDef, McDbRasterImage, McDbBlockReference, McDbDimension } from "mxcad";
import { DetailedResult, DynamicInputType, MxDbRegularPolygonShape, MxFun } from "mxdraw";
function calculateCenter(start: McGePoint3d, end: McGePoint3d, bulge: number) {
  const dist = start.distanceTo(end)
  const dx = dist / 2
  const dy = dx * bulge
  const r = (dx * dx + dy * dy) / (2 * dy)
  const midX = (start.x + end.x) / 2
  const midY = (start.y + end.y) / 2

  return new McGePoint3d(midX, midY).addvec(end.clone().sub(start).perpVector().normalize().mult(r - dy))
}
function calculateLineAngle(center: McGePoint3d, start: McGePoint3d, end: McGePoint3d) {
  const deg = (Math.PI * 2) / 360
  // 计算直线的角度
  let startAngle = ((Math.atan2(start.y - center.y, start.x - center.x) * 180) / Math.PI) * deg
  let endAngle = ((Math.atan2(end.y - center.y, end.x - center.x) * 180) / Math.PI) * deg

  return {
    startAngle,
    endAngle
  }
}
MxFun.addCommand("list", async () => {
  // 选择对象获取信息
  const objIds = await MxCADUtility.userSelect("选择对象")
  const getPoint = new MxCADUiPrPoint()
  MxFun.acutPrintf("找到" + objIds.length + "个\\n")
  const objId = objIds.pop()
  if (!objId) return
  const ent = objId.getMcDbEntity()
  if (!objId.isValid() || !ent) {
    MxFun.acutPrintf("对象无效\\n")
  } else {
    if (await printInfo(ent) === false) return
  }
  while (objIds.length) {
    getPoint.setMessage("按 ENTER 键继续")
    getPoint.setDisableDynInput(true)
    await getPoint.go()
    // 程序中止、按下Esc键、新的命令运行时退出
    if (getPoint.getDetailedResult() === DetailedResult.kCodeAbort) return
    if (getPoint.getDetailedResult() === DetailedResult.kEcsIn) return
    if (getPoint.getDetailedResult() === DetailedResult.kNewCommadIn) return
    const objId = objIds.pop()
    if (!objId) break;
    const ent = objId.getMcDbEntity()
    if (!objId.isValid() || !ent) {
      MxFun.acutPrintf("对象无效\\n")
      continue
    }
    if (await printInfo(ent) === false) return
  }
})
// 记录对象的名称
const entNames = {
  "McDbPoint": "点",
  "McDbLine": "直线",
  "McDbPolyline": "多段线",
  "McDbArc": "圆弧",
  "McDbCircle": "圆",
  "McDbEllipse": "椭圆",
  "McDbHatch": "填充",
  "McDbText": "单行文本",
  "McDbMText": "多行文本",
  "McDbRasterImage": "光栅图片",
  "McDbBlockReference": "块参照",
}
// 附着名称字典
const map = {
  Top: "上",
  Middle: "中",
  Bottom: "下",
  Base: "基",
  Left: "左",
  Center: "中",
  Right: "右",
  Align: "对齐",
  Fit: "适应",
  Mid: "中"
};

// 获取文字的附着名称
const getAttachmentName = (str: string) => {
  return str.replace(/k(\\w+)/g, function (_, p1) {
    let key = p1.replace(/([A-Z])/g, "-$1") as string
    const arr = key.split("-")
    const name = arr.reduce((name, key) => {
      if (map[key]) {
        return name + map[key];
      } else {
        return "";
      }
    })
    return name
  });
}
// 打印信息
async function printInfo(ent: McDbEntity) {
  // 得到所有对象的基本信息
  const layer = ent.layer
  const layoutBlockName = MxCpp.getCurrentDatabase().currentSpace.name
  const isMainModel = layoutBlockName === "*Model_Space"
  const modeName = isMainModel ? "模型空间" : "图纸空间"
  const handle = ent.getHandle()
  console.log(ent.objectName)

  let entName = entNames[ent.objectName] || ent.objectName
  if(ent instanceof McDbDimension) {
    entName = "标注"
  }
  MxFun.acutPrintf(\`\\n                  \${entName}        图层: "\${layer}"\`)
  MxFun.acutPrintf(\`\\n                           空间: "\${modeName}"\`)

  MxFun.acutPrintf(\`\\n                    句柄 = \${handle}\`)
  // 点对象的信息
  if (ent instanceof McDbPoint) {
    MxFun.acutPrintf(\`\\n                 于 点， X= \${ent.position.x.toFixed(4)}  Y= \${ent.position.y.toFixed(4)}  Z= \${ent.position.z.toFixed(4)}\`)
  }
  // 直线对象的信息
  if (ent instanceof McDbLine) {
    MxFun.acutPrintf(\`\\n                 自 点， X= \${ent.startPoint.x.toFixed(4)}  Y= \${ent.startPoint.y.toFixed(4)}  Z= \${ent.startPoint.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                 到 点， X= \${ent.startPoint.x.toFixed(4)}  Y= \${ent.startPoint.y.toFixed(4)}  Z= \${ent.startPoint.z.toFixed(4)}\`)
    let deltaX = ent.endPoint.x - ent.startPoint.x;
    let deltaY = ent.endPoint.y - ent.startPoint.y;
    let deltaZ = ent.endPoint.z - ent.startPoint.z;

    // 使用atan2计算角度，结果是弧度，转换为度
    let angleInDegrees = THREE.MathUtils.radToDeg(Math.atan2(deltaY, deltaX));

    MxFun.acutPrintf(\`\\n          长度 = \${ent.getLength().val.toFixed(4)}，在 XY 平面中的角度 = \${Math.floor(angleInDegrees)}\`)
    MxFun.acutPrintf(\`\\n                  增量 X =  \${deltaX.toFixed(4)}，增量 Y =   \${deltaY.toFixed(4)}，增量 Z =   \${deltaZ.toFixed(4)}\`)
  }

  // 多段线对象的信息
  if (ent instanceof McDbPolyline) {
    MxFun.acutPrintf(\`\\n            \${ent.isClosed ? "闭合" : "打开"}\`)
    MxFun.acutPrintf(\`\\n        固定宽度    \${ent.constantWidth.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n            面积   \${ent.getArea().val.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n         周长   \${ent.getLength().val.toFixed(4)}\`)

    // 输出多段线的每个点的信息
    const num = ent.numVerts()
    // 通过取点对象控制输出量 只有在按下空格或者回车才会继续打印剩余信息
    const getPoint = new MxCADUiPrPoint()

    // 记录点包含的其他信息如线宽、凸度值等
    const widthInfos: {
      val1: number;
      val2: number;
      ret: boolean;
    }[] = []
    const bulges: number[] = []
    // 记录是否打印线宽
    let isPrintWidth = false

    for (let index = 0; index < num; index++) {
      const width = ent.getWidthsAt(index)
      const bulge = ent.getBulgeAt(index)
      if (width.val1 !== 0 || width.val2 !== 0) {
        isPrintWidth = true
      }
      widthInfos.push(width)
      bulges.push(bulge)
    }
    // 控制输出打印量
    let accumulated = 0
    const maxIndex = 3

    for (let index = 0; index < num; index++) {
      if (accumulated > maxIndex) {
        while (true) {
          getPoint.setMessage("按 ENTER 键继续")
          getPoint.disableAllTrace()
          getPoint.clearLastInputPoint()
          // 设置不需要动态的输入框
          getPoint.setDynamicInputType(DynamicInputType.kNoInput)
          const pt = await getPoint.go()
          if (getPoint.getDetailedResult() === DetailedResult.kCodeAbort) return
          if (getPoint.getDetailedResult() === DetailedResult.kEcsIn) return
          if (getPoint.getDetailedResult() === DetailedResult.kNewCommadIn) return false
          // 只有回车和空格或者鼠标左键点击才能继续往下走打印的流程， 否则始终循环等待用户输入
          if (getPoint.getDetailedResult() === DetailedResult.kNullEnterIn || getPoint.getDetailedResult() === DetailedResult.kNullSpaceIn || pt) {
            accumulated = 0
            break;
          }
        }
      }
      const point = ent.getPointAt(index).val
      const bulge = bulges[index]

      MxFun.acutPrintf(\`\\n          于端点  X=  \${point.x.toFixed(1)}  Y=  \${point.y.toFixed(1)}  Z=  \${point.z.toFixed(1)}\`)
      if (isPrintWidth) {
        MxFun.acutPrintf(\`\\n    起点宽度  \${widthInfos[index].val1.toFixed(4)}\`)
        MxFun.acutPrintf(\`\\n      端点宽度  \${widthInfos[index].val2.toFixed(4)}\`)
      }
      // 凸度不为0时 且
      if (Math.abs(bulge) > 0) {
        MxFun.acutPrintf(\`\\n             凸度       \${bulge.toFixed(1)}\`)
        const nextPoint = ent.getPointAt(index + 1).val
        const center = calculateCenter(point, nextPoint, bulge)
        MxFun.acutPrintf(\`\\n            圆心  X=  \${center.x.toFixed(1)}  Y=  \${center.y.toFixed(1)}  Z=  \${center.z.toFixed(1)}\`)
        MxFun.acutPrintf(\`\\n            半径    \${center.distanceTo(point).toFixed(1)}\`)
        const { startAngle, endAngle } = calculateLineAngle(center, point, nextPoint)
        MxFun.acutPrintf(\`\\n       起点角度       \${THREE.MathUtils.radToDeg(startAngle).toFixed(0)}\`)
        MxFun.acutPrintf(\`\\n       端点角度       \${THREE.MathUtils.radToDeg(endAngle).toFixed(0)}\`)
        // 最后一次循环加上最后一个端点信息
        if (index === num - 1) {
          MxFun.acutPrintf(\`\\n          于端点  X=  \${nextPoint.x.toFixed(1)}  Y=  \${nextPoint.y.toFixed(1)}  Z=  \${nextPoint.z.toFixed(1)}\`)
        }
      }
      accumulated++
    }
  }
  // 圆弧的信息
  if (ent instanceof McDbArc) {
    MxFun.acutPrintf(\`\\n                圆心 点， X= \${ent.center.x.toFixed(4)}  Y= \${ent.center.y.toFixed(4)}  Z= \${ent.center.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                半径  \${ent.radius.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                起点 角度    \${THREE.MathUtils.radToDeg(ent.startAngle).toFixed(0)}\`)
    MxFun.acutPrintf(\`\\n                端点 角度    \${THREE.MathUtils.radToDeg(ent.endAngle).toFixed(0)}\`)
    MxFun.acutPrintf(\`\\n            长度 \${ent.getLength().val.toFixed(4)}\`)
  }
  // 圆的信息
  if (ent instanceof McDbCircle) {
    MxFun.acutPrintf(\`\\n                圆心 点， X= \${ent.center.x.toFixed(4)}  Y= \${ent.center.y.toFixed(4)}  Z= \${ent.center.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                半径  \${ent.radius.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                周长 \${ent.getLength().val.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                面积 \${(Math.PI * ent.radius * ent.radius).toFixed(4)}\`)
  }

  // 椭圆的信息
  if (ent instanceof McDbEllipse) {
    // 得到椭圆的半轴长度
    const radius1 = ent.majorAxis.length()
    const radius2 = ent.minorAxis.length()
    // 是否是椭圆 为false表示是椭圆弧
    const isEllipse = ent.startAngle === 0 && ent.endAngle === 2 * Math.PI
    if (isEllipse) {
      const calculateEllipseCircumference = (radius1: number, radius2: number) => {
        const h = Math.pow((radius1 - radius2), 2) / Math.pow((radius1 + radius2), radius2);
        const circumference = Math.PI * (radius1 + radius2) * (1 + (3 * h) / (10 + Math.sqrt(4 - 3 * h)));
        return circumference;
      }
      MxFun.acutPrintf(\`\\n                               面积: \${(Math.PI * radius1 * radius2).toFixed(4)}\`)
      MxFun.acutPrintf(\`\\n                               圆周: \${calculateEllipseCircumference(radius1, radius2).toFixed(4)}\`)
    }
    else {
      // 计算椭圆弧的长度
      const arcLengthOfEllipse = (a: number, b: number, theta1: number, theta2: number, numSteps: number) => {
        // a: 长半轴
        // b: 短半轴
        // 定义被积函数
        const integrand = function (theta: number) {
          return Math.sqrt(a * a * Math.sin(theta) * Math.sin(theta) + b * b * Math.cos(theta) * Math.cos(theta));
        };

        // 使用复合辛普森法则进行数值积分
        let integral = 0;
        const stepSize = (theta2 - theta1) / numSteps;
        for (let i = 0; i <= numSteps; i++) {
          const theta = theta1 + i * stepSize;
          if (i === 0 || i === numSteps) {
            integral += integrand(theta);
          } else if (i % 2 === 0) {
            integral += 2 * integrand(theta);
          } else {
            integral += 4 * integrand(theta);
          }
        }

        integral *= stepSize / 3;
        return Math.abs(integral);
      }

      MxFun.acutPrintf(\`\\n                               长度: \${arcLengthOfEllipse(radius1, radius2, ent.startAngle, ent.endAngle, 30).toFixed(4)}\`)
    }
    MxFun.acutPrintf(\`\\n                              中心点: X = \${ent.center.x.toFixed(4)} , Y = \${ent.center.y.toFixed(4)}   , Z = \${ent.center.z.toFixed(4)}\`)
    // 判断哪个是半轴长度较长的轴
    const isMaxAxis = radius1 > radius2
    const maxAxis = isMaxAxis ? ent.majorAxis : ent.minorAxis
    const minAxis = isMaxAxis ? ent.minorAxis : ent.majorAxis
    MxFun.acutPrintf(\`\\n                               长轴: X = \${maxAxis.x.toFixed(4)}  , Y = \${maxAxis.y.toFixed(4)}  , Z = \${maxAxis.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                               短轴: X = \${minAxis.x.toFixed(4)}  , Y = \${minAxis.y.toFixed(4)}  , Z = \${minAxis.z.toFixed(4)}\`)
    // 椭圆弧的其他信息
    if (!isEllipse) {
      // 计算椭圆弧的起点和端点
      const calculateEllipseEndpoints = (center: McGePoint3d, v1: McGeVector3d, v2: McGeVector3d, theta1: number, theta2: number) => {
        // 椭圆中心坐标
        const cx = center.x;
        const cy = center.y;

        // 主轴向量
        const vx1 = v1.x;
        const vy1 = v1.y;

        //  副轴向量
        const vx2 = v2.x;
        const vy2 = v2.y;

        // 计算椭圆的起始点和结束点
        const alpha = Math.atan2(vy1, vx1)

        const a = Math.sqrt(vx1 * vx1 + vy1 * vy1);  // 长轴半径
        const b = Math.sqrt(vx2 * vx2 + vy2 * vy2);  // 短轴半径
        // 根据角度计算起始点和结束点
        const startEndpointX = cx + a * Math.cos(theta1) * Math.cos(alpha) - b * Math.sin(theta1) * Math.sin(alpha);
        const startEndpointY = cy + a * Math.cos(theta1) * Math.sin(alpha) + b * Math.sin(theta1) * Math.cos(alpha);
        const endEndpointX = cx + a * Math.cos(theta2) * Math.cos(alpha) - b * Math.sin(theta2) * Math.sin(alpha);
        const endEndpointY = cy + a * Math.cos(theta2) * Math.sin(alpha) + b * Math.sin(theta2) * Math.cos(alpha);

        return {
          startPoint: new McGePoint3d(startEndpointX, startEndpointY),
          endPoint: new McGePoint3d(endEndpointX, endEndpointY)
        };
      }

      const { startPoint, endPoint } = calculateEllipseEndpoints(ent.center, ent.majorAxis, ent.minorAxis, ent.startAngle, ent.endAngle)
      MxFun.acutPrintf(\`\\n                               起点: X = \${startPoint.x.toFixed(4)} , Y = \${startPoint.y.toFixed(4)}  , Z = \${startPoint.z.toFixed(4)}\`)
      MxFun.acutPrintf(\`\\n                               端点: X = \${endPoint.x.toFixed(4)} , Y = \${endPoint.y.toFixed(4)}  , Z = \${endPoint.z.toFixed(4)}\`)
      MxFun.acutPrintf(\`\\n                             起点角度: \${THREE.MathUtils.radToDeg(ent.startAngle).toFixed(0)}\`)
      MxFun.acutPrintf(\`\\n                             端点角度: \${THREE.MathUtils.radToDeg(ent.endAngle).toFixed(0)}\`)
    }
    MxFun.acutPrintf(\`\\n                             半径比例: \${ent.radiusRatio.toFixed(4)}\`)
  }

  // 填充对象信息
  if(ent instanceof McDbHatch) {
    const patternName =  ent.patternName()
    MxFun.acutPrintf(\`\\n                 填充图案 \${patternName}\`)
    MxFun.acutPrintf(\`\\n                 图案填充比例    \${ent.patternScale.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                 图案填充角度      \${THREE.MathUtils.radToDeg(ent.patternAngle).toFixed(0)}\`)
    const pl = new McDbPolyline()
    const pls: McDbPolyline[] = []
    pl.isClosed = true
    for (let index = 0; index < ent.numLoops; index++) {
      const { vertices, bulges } = ent.getLoopAt(index)
      vertices.forEach((pt, index)=> {
        const bulge = bulges[index]
        pl.addVertexAt(pt, Number(bulge.toFixed(14)))
      })
      pls.push(pl)
      MxCpp.getCurrentMxCAD().drawEntity(pl)
    }
    const totalArea = pls.reduce((totalArea, pl)=> totalArea + pl.getArea().val, 0)
    MxFun.acutPrintf(\`\\n                 面积      \${totalArea.toFixed(4)}\`)
  }

  // 单行文字信息
  if(ent instanceof McDbText) {
    MxFun.acutPrintf(\`\\n              样式 = "\${ent.textStyle}"\`)
    MxFun.acutPrintf(\`\\n                起点 点， X=  \${ent.position.x.toFixed(4)}  Y= \${ent.position.y.toFixed(4)}  Z=   \${ent.position.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                高度    \${ent.height.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n                文字 \${ent.textString}\`)
    MxFun.acutPrintf(\`\\n                旋转 角度    \${ent.rotation.toFixed(0)}\`)
    MxFun.acutPrintf(\`\\n                宽度 比例因子    \${ent.widthFactor.toFixed(4)}\`)
  }
  // 多行文字信息
  if(ent instanceof McDbMText) {
    MxFun.acutPrintf(\`\\n              样式 = "\${ent.textStyle}"\`)
    MxFun.acutPrintf(\`\\n位置:         X=  \${ent.location.x.toFixed(4)}  Y=   \${ent.location.y.toFixed(4)}  Z=   \${ent.location.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n宽度:           \${ent.width.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n法向:         X=   \${ent.normal.x.toFixed(4)}  Y=   \${ent.normal.y.toFixed(4)}  Z=   \${ent.normal.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n旋转:                 \${ent.rotation.toFixed(0)}\`)
    MxFun.acutPrintf(\`\\n文字高度:        \${ent.textHeight.toFixed(4)}\`)

    MxFun.acutPrintf(\`\\n附着:        \${getAttachmentName(McDb.AttachmentPoint[ent.attachment])}\`)
    MxFun.acutPrintf(\`\\n内容:        \${ent.contents}\`)
  }
  // 光栅图片信息
  if(ent instanceof McDbRasterImage) {
    const imgDef = ent.imageDefId().getMcDbRasterImageDef()
    const getFileNameFromPath = (path: string)=> {
      return path.split('/').pop().split('\\\\').pop();
    }
    MxFun.acutPrintf(\`\\n图像:                   \${getFileNameFromPath(imgDef.sourceFileName)}\`)

    const getClipBoundaryType = (ent: McDbRasterImage)=> {
      const type = ent.clipBoundaryType()
      if(type === McDb.ClipBoundaryType.kInvalid) return "无效"
      if(type === McDb.ClipBoundaryType.kPoly) return "多边形"
      if(type === McDb.ClipBoundaryType.kRect) return "矩形"
    }
    MxFun.acutPrintf(\`\\n剪裁边界类型:      \${getClipBoundaryType(ent)}\`)
    const clipBoundary =  ent.clipBoundary()
    MxFun.acutPrintf(\`\\n边界点数目: \${clipBoundary.length()}\`)
    ent.clipBoundary().forEach((pt)=> {
      MxFun.acutPrintf(\`\\n       位于点，X=   \${pt.x.toFixed(4)}, Y=   \${pt.y.toFixed(4)}, Z=   \${pt.z.toFixed(4)}\`)
    })
  }

  // 图块信息
  if(ent instanceof McDbBlockReference) {
    MxFun.acutPrintf(\`\\n块名:               "\${ent.blockName}"\`)
    MxFun.acutPrintf(\`\\n插入点:             X= \${ent.position.x.toFixed(4)}, Y=   \${ent.position.y.toFixed(4)}, Z=   \${ent.position.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\nX 比例因子:         \${ent.scaleFactors.x.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\nY 比例因子:         \${ent.scaleFactors.y.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n  旋转角度:         \${ent.rotation.toFixed(0)}\`)
    MxFun.acutPrintf(\`\\nZ 比例因子:         \${ent.scaleFactors.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\nZ 比例因子:         \${ent.scaleFactors.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n  缩放比例:         \${ent.getScale().toFixed(4)}\`)
  }

  // 标注信息
  if(ent instanceof McDbDimension) {
    MxFun.acutPrintf(\`\\n文字位置:           X= \${ent.textPosition.x.toFixed(4)} Y= \${ent.textPosition.y.toFixed(4)} Z= \${ent.textPosition.z.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n是否使用的默认文字位置:           \${ent.isUsingDefaultTextPosition()}\`)
    MxFun.acutPrintf(\`\\n高度:          \${ent.elevation.toFixed(4)}\`)
    MxFun.acutPrintf(\`\\n文本内容:       \${ent.dimensionText}\`)
    MxFun.acutPrintf(\`\\n文本旋转角度:   \${THREE.MathUtils.radToDeg(ent.textRotation).toFixed(0)}\`)
    const dimStyle = ent.dimensionStyle.getMcDbDimStyleTableRecord()
    MxFun.acutPrintf(\`\\n标注样式:       \${dimStyle.name}\`)
    MxFun.acutPrintf(\`\\n文字附着:      \${getAttachmentName(McDb.AttachmentPoint[ent.textAttachment])}\`)
    MxFun.acutPrintf(\`\\n水平旋转角度:   \${THREE.MathUtils.radToDeg(ent.horizontalRotation).toFixed(0)}\`)
    MxFun.acutPrintf(\`\\n水平旋转角度:   \${THREE.MathUtils.radToDeg(ent.horizontalRotation).toFixed(0)}\`)
  }
  MxFun.acutPrintf("\\n命令")
}

`;function lV(t){return t.replace(/[\u00A0\u1680\u2000-\u200D\u202F\u205F\u3000]/g," ")}const TA=t=>{const e=/\/\/{24}[\s\S]*\/\/{24}/g;let n=t.replace(e,"");return n=lV(n),n};(t=>{t.forEach(e=>{e.code=TA(e.code)}),t.push({type:"命令实现",name:"list 命令",code:TA(aV)})})(MA);class cV extends p.MxCADPluginBase{constructor(){super(),this.map_default_data=xU(),this.sampleCode=MA}}let Fu;const{showModal:uV,hideModal:Hl,showTools:hV}=If();function dV(){return Gt(this,null,function*(){uV({title:"My Test Draw",text:"测试Modal",oncancel:()=>{Hl()},onsubmit:()=>{Hl()},ongetallentity:()=>{Hl(),$.MxFun.sendStringToExecute("TestGetAllEntity")},ondrawline:()=>{Hl(),$.MxFun.sendStringToExecute("Mx_Circle")},docommand:t=>{Hl(),$.MxFun.sendStringToExecute(t)}})})}function pV(){return Gt(this,null,function*(){hV({title:"My Extension Tools",text:"扩展工具",oncancel:()=>{Hl()},docommand:t=>{Hl(),$.MxFun.sendStringToExecute(t)}})})}const PA=document.createElement("div");document.body.appendChild(PA),b.createApp(SS).mount(PA),DS(),MxPluginContext.on("databaseLayerUpdate",()=>{console.log("数据库图层数据更新")}),$.MxFun.setloadImageFuction((t,e,n)=>t.slice(-4)=="tiff"||t.slice(-3)=="tif"?(new p.MxTIFFLoader().load(t,e,n),1):0),$.MxFun.onInitSync(()=>new Promise(t=>{t(!0)})),$.MxFun.on("mxcadApplicationStart",t=>{Fu=t,Fu.init(new cV),$.MxFun.setIniset({IntelliSelectType:2})}),$.MxFun.on("mxcadApplicationInitMap",()=>{vU(Fu.mxmap)}),$.MxFun.on("mxcadApplicationStartCreatingMxCADObject",t=>{let e=t.mxdraw;e.setViewMovementMethod(!0),e.on("openFileComplete",()=>{console.log("MxTip:openFileComplete ")}),e.addControlsEvent("mousedown",n=>{let r=n.offsetX,s=n.offsetY,u=e.viewCoord2Cad(r,s,0);return console.log("mousedown:",u),0})}),$.MxFun.on("mxcadApplicationCreatedMxCADObject",t=>{let e=Fu.getServerConfig();p.MxCpp.App.addNetworkLoadingFont(e.font||["txt.shx","simplex.shx","gdt.shx","aaa.shx","ltypeshp.shx","complex.shx"]),p.MxCpp.App.addNetworkLoadingBigFont(e.bigFont||["hztxt.shx","gbcbig.shx"]),e.trueTypeFont?p.MxCpp.App.addNetworkLoadingTrueTypeFont(e.trueTypeFont[0],e.trueTypeFont[1],e.trueTypeFont[2]):p.MxCpp.App.addNetworkLoadingTrueTypeFont(["syadobe"],["思原黑体"],["syadobe.otf"]);let n=t.mxcad;n.setAttribute({DisplayPrecision:35}),n.on("selectChange",u=>{if(console.log("selectChange"),u.length==0)return;let h=u[0],o=h.getMxDbEntity();if(o!==null){console.log(o.getTypeName()),o instanceof $.MxDbRectBoxLeadComment&&console.log(o.text);return}let m=h.getMcDbEntity();m!==null&&(console.log(m.objectName),m instanceof p.McDbText?console.log(m.textString):m instanceof p.McDbBlockReference&&m.getAllAttribute().forEach(M=>{let A=M.getMcDbEntity();console.log(A.textString),console.log(A.tag)}))}),p.MxCpp.PropertiesWindow.onEvent_getProperties(u=>{let h=u.getMcDbEntity();if(!h)return[];let o=h.getxDataDouble("DN"),m=h.getxDataDouble("LEN"),y=[];return o.ret&&y.push({sVarName:"DN",iVarType:p.MxPropertiesWindowCustomValueType.kDouble,val:o.val,isOnlyRead:!1}),m.ret&&y.push({sVarName:"LEN",iVarType:p.MxPropertiesWindowCustomValueType.kDouble,val:m.val,isOnlyRead:!1}),y}),p.MxCpp.PropertiesWindow.onEvent_setProperties((u,h)=>{let o=u.getMcDbEntity();o&&(h.sVarName=="DN"?o.setxDataDouble("DN",h.val):h.sVarName=="LEN"&&o.setxDataDouble("LEN",h.val))});let r,s;p.MxCpp.getCurrentMxCAD().on("selectChange",u=>{var o;if(u.length===0)return;const h=(o=u[0])==null?void 0:o.getMcDbEntity();if(h&&h instanceof p.McDbCustomEntity&&(r==null?void 0:r.getHandle())===h.getHandle()){const m=h.getTypeName();Wo.value=h.clone(),m==="McDbTestRoughness"?(Ho.value="RoughnessDialog",_o.showDialog(!0,{title:G("表面粗糙度")}).then(M=>Gt(this,[M],function*({data:y,isCanceled:x}){var A;if(!x){const T=y.roughnessData,P=h.clone();P.rougMarkType=T.selectSymbolNum,P.textLeftStr=T.textLeftStr,P.rougCornerType=T.rougCornerType==="无"?"":T.rougCornerType,P.isRoungSameRequire=T.isRoungSameRequire,P.isShowMostSymbols=T.isShowMostSymbols;const D=(A=T.textUpStr)==null?void 0:A.filter(k=>k!="");P.textUpStr=JSON.parse(JSON.stringify(D)).reverse(),P.textDownStr=T.textDownStr.filter(k=>k!=""),P.isAddRougLongLine=T.isAddLongLine,h.erase(),n.drawEntity(P),n.mxdraw.clearMxCurrentSelect(),n.updateDisplay()}}))):m==="McDbTestWeldingSymbol"?(Ho.value="WeldingSymbolDialog",_o.showDialog(!0,{title:G("焊接符号")}).then(M=>Gt(this,[M],function*({data:y,isCanceled:x}){if(!x){const A=y.formData,T=h;if(A.specialSymbol.length&&T.setSpecialSymbol(A.specialSymbol),A.rightDim1||A.rightDim2){const P=[ii.top,ii.down],D=[];P.forEach(k=>{const z=A.rightDim1.filter(H=>H.position===k)[0],O=A.rightDim2.filter(H=>H.position===k)[0],U=z.content&&O.content?"×":"";D.push({position:k,content:z.content+U+O.content})}),T.setRightDim(D)}T.setSuppleSymbol(A.suppleSymbol),T.setLeftDim(A.leftDim),T.setTopDim(A.topDim),T.setAuxiliarySymbol(A.auxiliarySymbol),T.setBaseSymbok(A.basicSymbol),T.setIntWeldSeam(A.intWeldSeam),T.dottedLinePos=A.dottedLinePos,T.weldingSymbolInfo=A.weldingSymbolInfo.replace(/\n/g,"\\P"),h.erase(),n.drawEntity(T),n.mxdraw.clearMxCurrentSelect(),n.updateDisplay()}}))):m==="MxDbGeometricTolerances"&&(Ho.value="GemoetricToleranceDialog",_o.showDialog(!0,{title:G("形位公差")}).then(M=>Gt(this,[M],function*({data:y,isCanceled:x}){if(!x){const A=y.formData,T=h;T.dimToleranceContents=(A==null?void 0:A.dimToleranceContents)||[],T.isShowFullWeekSymbol=(A==null?void 0:A.isShowFull)||!1,T.dimNotesDown=(A==null?void 0:A.downDim)||"",T.dimNotesUp=(A==null?void 0:A.topDim)||"",h.erase(),n.drawEntity(T),n.mxdraw.clearMxCurrentSelect(),n.updateDisplay()}})))}r=h,s&&clearTimeout(s),s=setTimeout(()=>{r=null},300)})});function Ua(){return Fu}function Jr(t){return"x="+t.x+",y="+t.y+",z="+t.z}function fV(){window.open("https://demo.mxdraw3d.com:3562/MxCADCode.7z")}function mV(){window.open("https://demo.mxdraw3d.com:3562/MxDrawCloudServer1.0TryVersion.7z")}function zu(t){var e=window.location.href;return e.indexOf("?")!=-1&&(e=e.replace(/(\?|#)[^'"]*/,"")),`${e}?map=true&maptype=${t}`}function gV(){window.open(zu("gdslwzj"))}function yV(){window.open(zu("google"))}function xV(){window.open(zu("gdyx"))}function vV(){window.open(zu("tdtsl"))}function _V(){window.open(zu("bdsl"))}function bV(){window.open(zu("geoq"))}function MV(){p.MxCpp.getCurrentMxCAD().setViewBackgroundColor(255,255,255),$.MxFun.callEvent("updateBackgroundColor",new p.McCmColor(255,255,255))}function SA(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("选择要需要开启自定义属性的对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity();p.MxCpp.PropertiesWindow.setEntitySupportCustom(e),n.setxDataDouble("DN",100),n.setxDataDouble("LEN",2e3)})}function wV(){p.MxCpp.getCurrentMxCAD().openWebFile("http://localhost:1337/mxcad/file/a9cbed3d3a351b79f24484e87bd78338.DWG.mxweb")}function AV(){return Gt(this,null,function*(){})}function EV(){return Gt(this,null,function*(){let t=new p.MxCADUiPrEntity;t.setMessage(G("选择要隐藏的对象"));let e=yield t.go();if(!e.isValid())return;let n=e.getMcDbEntity(),r=p.MxCpp.getCurrentMxCAD(),h=r.getDatabase().getLayerTable().get(n.layer).getMcDbLayerTableRecord();h!==null&&(h.isOff=!0,r.updateLayerDisplayStatus(),r.updateDisplay())})}function TV(){return window.location.origin+window.location.pathname}let zg;function PV(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定插入点:"));let e=yield t.go();if(!e)return;let n=p.MxCpp.getCurrentMxCAD(),r=TV()+"mxcad.jpg";n.loadImage(r,s=>{if(!s){console.log("loadImage failed");return}let u=n.mxdraw.viewCoordLong2Cad(100),h=s.height/s.width*u,o=0;zg=n.drawImage(e.x,e.y,u,h,o,r,!0,s.width,s.height);let m=zg.getMcDbEntity(),y=p.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder();m&&(m.drawOrder=y.maxDrawOrder+1),n.updateDisplay()})})}function SV(){if(!zg)return;let t=p.MxCpp.getCurrentMxCAD(),e="https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg";t.loadImage(e,n=>{if(!n){console.log("loadImage failed");return}let r=t.addImageDefine(e,"winter-7593872_960_720.jpg",!0),s=zg.getMcDbEntity();s&&s.setImageDefId(r),t.updateDisplay()})}function CV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=new p.MxCADUiPrPoint,n=yield e.go();if(n==null)return;e.setBasePt(n);let r=yield e.go();if(r==null)return;let s=t.drawLine(n.x,n.y,r.x,r.y);t.addCurrentSelect(s)})}let CA=0;function DV(){return Gt(this,null,function*(){CA+=Math.PI*.5,p.MxCpp.getCurrentMxCAD().zoomAngle(CA)})}function RV(){p.MxCpp.getCurrentMxCAD().zoomCenter(900,900)}function LV(){let t=p.MxCpp.getCurrentMxCAD();t.newFile();let e=new p.McDbPolyline;e.setType(p.McDb.PolylineType.k3dPolyline),e.addVertexAt(new p.McGePoint3d(100,100,100)),e.addVertexAt(new p.McGePoint3d(200,100,500)),e.addVertexAt(new p.McGePoint3d(300,400,200)),t.drawEntity(e),t.zoomAll(),t.updateDisplay()}function IV(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定一点:"));let e=yield t.go();if(!e)return;const n=new p.MxCADUiPrAngle;n.setMessage(G("指定夹角")),n.setKeyWords(""),n.setBasePt(e);const r=yield n.go();console.log(r)})}function kV(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定一点:")),t.setOffsetInputPostion(!0);let e=yield t.go();if(!e)return;t.setBasePt(e),t.setUseBasePt(!0),t.setMessage(G(" 指定二点:"));let n=yield t.go();n&&p.MxCpp.getCurrentMxCAD().drawLine(e.x,e.y,n.x,n.y)})}function BV(){return Gt(this,null,function*(){let t=new p.MxCADSelectionSet;if(!(yield t.userSelect("选择要做成组的对象:"))||t.count()==0)return;p.MxCpp.getCurrentMxCAD().getDatabase().CreateGroup(t.getIds())})}function FV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();const e=new p.MxCADUiPrPoint;e.setMessage(G(" 指定第一点:"));let n=yield e.go();if(!n)return;e.setMessage(G(" 指定第二点:")),e.setBasePt(n);let r=yield e.go();if(!r)return;let s=r.sub(n);s.rotateBy(Math.PI*.5).normalize().mult($.MxFun.screenCoordLong2Doc(10));let u=n.clone().addvec(s),h=n.clone().subvec(s),o=r.clone().addvec(s),m=r.clone().subvec(s),y=new p.McGeBound([u,h,o,m]),x=y.minPoint,M=y.maxPoint,A=new p.MxCADSelectionSet;A.crossingSelect(x.x,x.y,M.x,M.y,new p.MxCADResbuf([p.DxfCode.kEntityType,"LINE,ARC,CIRCLE,LWPOLYLINE"]));let T=$.MxFun.screenCoordLong2Doc(5),P=new p.McDbLine(n,r);A.forEach(D=>{let z=D.getMcDbEntity().IntersectWith(P,p.McDb.Intersect.kOnBothOperands);if(z.length()!=0){let O=z.at(0);t.drawCircle(O.x,O.y,T)}})})}$.MxFun.on("mxcadApplicationCreatedMxCADObject",t=>{t.mxcad.on("selectChange",n=>{if(n.length==0)return;let r=n[0],s=r.getMxDbEntity();if(s!==null){console.log(s.getTypeName()),s instanceof $.MxDbRectBoxLeadComment&&console.log(s.text);return}let u=r.getMcDbEntity();u!==null&&(console.log(u.objectName),u instanceof p.McDbText?console.log(u.textString):u instanceof p.McDbBlockReference&&u.getAllAttribute().forEach(m=>{let y=m.getMcDbEntity();console.log(y.textString),console.log(y.tag)}))}),p.MxCpp.PropertiesWindow.onEvent_getProperties(n=>{let r=n.getMcDbEntity();if(!r)return[];let s=r.getxDataDouble("DN"),u=r.getxDataDouble("LEN"),h=[];return s.ret&&h.push({sVarName:"DN",iVarType:p.MxPropertiesWindowCustomValueType.kDouble,val:s.val,isOnlyRead:!1}),u.ret&&h.push({sVarName:"LEN",iVarType:p.MxPropertiesWindowCustomValueType.kDouble,val:u.val,isOnlyRead:!1}),console.log(h),h}),p.MxCpp.PropertiesWindow.onEvent_setProperties((n,r)=>{let s=n.getMcDbEntity();s&&(r.sVarName=="DN"?s.setxDataDouble("DN",r.val):r.sVarName=="LEN"&&s.setxDataDouble("LEN",r.val),console.log(r))}),YV()});function zV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();if(t.mxdraw.isMapBox())t.mxdraw.createCanvasImageData(e=>{let n=window.open();n!=null&&n.document.write('<img src="'+e+'"/>')});else{const e=yield p.MxCADUtility.getCorner("选择截图范围",void 0,void 0,!1,!0);if(!e)return;let n=Math.abs(e.pt1.x-e.pt2.x),r=Math.abs(e.pt1.y-e.pt2.y);if(n<1||r<1)return;let s=200,u=s*r/n;t.mxdraw.createCanvasImageData(h=>{let o=window.open();o!=null&&o.document.write('<img src="'+h+'"/>')},{width:s,height:u,range_pt1:e.pt1.toVector3(),range_pt2:e.pt2.toVector3()})}})}function NV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();if(t.mxdraw.isMapBox())t.setAttribute({ShowCoordinate:!1}),t.mxdraw.createCanvasImageData(e=>{t.setAttribute({ShowCoordinate:!0});let n=window.open();n!=null&&new p.MxCanvas2Image(n.document).saveAsImage(t.mxdraw.getCanvas(),void 0,void 0,"bmp")});else{const e=yield p.MxCADUtility.getCorner("选择截图范围",void 0,void 0,!1,!0);if(!e)return;let n=Math.abs(e.pt1.x-e.pt2.x),r=Math.abs(e.pt1.y-e.pt2.y);if(n<1||r<1)return;let s=1e3,u=s*r/n,h=t.getViewBackgroundColor();t.setViewBackgroundColor(16777215),t.setAttribute({ShowCoordinate:!1});let o=new p.MxModifyColor,m=new p.McCmColor;m.setColorIndex(p.ColorIndexType.kWhite),o.Do(p.MxCpp.getCurrentDatabase(),m),t.mxdraw.createCanvasImageData(y=>{t.setViewBackgroundColor(h),t.setAttribute({ShowCoordinate:!0}),o.DoRestore();let x=window.open();x!=null&&new p.MxCanvas2Image(x.document).saveAsImage(t.mxdraw.getCanvas(),void 0,void 0,"bmp")},{type:"image/bmp",width:s,height:u,range_pt1:e.pt1.toVector3(),range_pt2:e.pt2.toVector3()})}})}function UV(){return Gt(this,null,function*(){for(;;){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定一点:")),t.setOffsetInputPostion(!0),t.clearLastInputPoint();let e=yield t.go();if(!e)return;let n=$.MxFun.getCurrentDraw();n.getTempMarkDraw().drawCircleMark(e.toVector3(),n.viewCoordLong2Cad(50),16711680),n.updateDisplay()}})}function VV(){return Gt(this,null,function*(){const t=new p.MxCADUiPrPoint;t.setMessage(G(" 指定第一点:"));let e=yield t.go();if(!e)return;let n=yield p.MxCADUtility.getCorner(" 指定第二点:",e);if(!n)return;let r=n.pt2,s=new p.McGePoint3dArray;s.append(e),s.append(new p.McGePoint3d(e.x,r.y,0)),s.append(new p.McGePoint3d(r.x,r.y,0)),s.append(new p.McGePoint3d(r.x,e.y,0));let u=new p.McDbWipeout;u.setVertices(s),u=p.MxCpp.getCurrentMxCAD().drawEntity(u).getMcDbObject();let m=p.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder().maxDrawOrder+1;u.drawOrder=m})}function GV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=t.getDatabase();e.setCurrentlyTrueColor(new p.McCmColor(255,100,0)),e.setCurrentlyLineWeight(p.McDb.LineWeight.kLnWt030),t.showLineWeight(!0)})}function OV(){return Gt(this,null,function*(){let t=yield p.MxCADUtility.selectEnt("选择PL线",new p.MxCADResbuf([p.DxfCode.kEntityType,"LWPOLYLINE"]));if(t.length==0)return;let e=t[0],n=e.getMcDbEntity();if(n&&n instanceof p.McDbPolyline){let r=n,s=r.getBoundingBox();if(!s.ret)return;let u=r.getSamplePoints(.1).GetPoints();if(u.length()<3)return;let h=[],o=new p.MxCADSelectionSet;o.crossingSelect(s.minPt.x,s.minPt.y,s.maxPt.x,s.maxPt.y),o.forEach(m=>{if(m.id==e.id)return;let y=m.getMcDbEntity();if(y){let x=y.getBoundingBox();if(!x.ret)return;let M=x.minPt.clone().addvec(x.maxPt.sub(x.minPt).mult(.5));p.MxCADUtility.pointInPolygon(u,M.x,M.y)&&h.push(m)}}),console.log(h)}})}function jV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=yield p.MxCADUtility.selectEnt("xxxx");if(e.length==0)return;let r=e[0].getMcDbEntity();if(r){let s=r.explode();if(s.GetCount()==0)return;let u=s.GetCount();for(let h=0;h<u;h++){let o=s.AtObject(h).val;o instanceof p.McDbEntity&&t.drawEntity(o)}r.erase()}})}function HV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD();const e=new p.MxCADUiPrPoint;e.setMessage(G(" 指定一点:"));let n=yield e.go();if(!n)return;e.setBasePt(n),e.setUseBasePt(!0),e.setMessage(G(" 指定二点:"));let r=yield e.go();if(!r)return;let s=new p.McDbPolyline;s.addVertexAt(n),s.addVertexAt(r),s.constantWidth=t.mxdraw.viewCoordLong2Cad(10),s.trueColor=new p.McCmColor(255,255,255,160),t.drawEntity(s),t.updateDisplay()})}function WV(){return Gt(this,null,function*(){let t=yield p.MxCADUtility.selectEnt(G("选择图案填充对象"));if(t.length==0)return;let n=t[0].getMcDbEntity();n&&n instanceof p.McDbHatch&&n.scalePattern(2)})}function qV(){return Gt(this,null,function*(){let t=p.MxCpp.getCurrentMxCAD(),e=t.mxdraw.viewCoordLong2Cad(10),n=t.database,r=t.getSysVarDouble("LTSCALE");e=e/r;let s=n.getLinetypeTable(),u="MyTest1",h=s.get(u);if(h.isNull()){let M=new p.McDbLinetypeTableRecord;M.numDashes=2,M.setDashLengthAt(0,e),M.setDashLengthAt(1,-e),M.name=u,h=s.add(M)}const o=new p.MxCADUiPrPoint;o.setMessage(G(" 指定一点:"));let m=yield o.go();if(!m)return;o.setBasePt(m),o.setUseBasePt(!0),o.setMessage(G(" 指定二点:"));let y=yield o.go();if(!y)return;let x=new p.McDbLine;x.startPoint=m,x.endPoint=y,x.linetypeId=h,t.drawEntity(x)})}function YV(){$.MxFun.addCommand("My_PluginTest",dV),$.MxFun.addCommand("My_Extool",pV),$.MxFun.addCommand("Mx_Open_DemoCode",fV),$.MxFun.addCommand("Mx_Open_DevInstall",mV),$.MxFun.addCommand("Mx_Open_Map_gdslwzj",gV),$.MxFun.addCommand("Mx_Open_Map_gdyx",xV),$.MxFun.addCommand("Mx_Open_Map_tdtsl",vV),$.MxFun.addCommand("Mx_Open_Map_bdsl",_V),$.MxFun.addCommand("Mx_Open_Map_geoq",bV),$.MxFun.addCommand("Mx_Open_Map_googlecn",yV),$.MxFun.addCommand("Mx_ViewBackgroundColor",MV),$.MxFun.addCommand("Mx_TestExProp",SA),$.MxFun.addCommand("Mx_Test_OpenFile",wV),$.MxFun.addCommand("Mx_Test_GetFile",AV),$.MxFun.addCommand("Mx_TestExProp",SA),$.MxFun.addCommand("Mx_SelectEntitHideLayer",EV),$.MxFun.addCommand("MxTest_TestAddCurrentSelect",CV),$.MxFun.addCommand("MxTest_TestSetViewAngle",DV),$.MxFun.addCommand("MxText_ZoomCenter",RV),$.MxFun.addCommand("MxTest_Map_Download",_U),$.MxFun.addCommand("Mx_Test_DrawImage",PV),$.MxFun.addCommand("Mx_Test_ModifyImage",SV),$.MxFun.addCommand("Mx_Test_Draw3DPolyline",LV),$.MxFun.addCommand("MxTemp_Test",IV),$.MxFun.addCommand("Mx_Test_IntersectWith",FV),$.MxFun.addCommand("Mx_Test_OffsetIn_DrawLine",kV),$.MxFun.addCommand("Mx_Test_CreateGroup",BV),$.MxFun.addCommand("Mx_ScreenToJpg",zV),$.MxFun.addCommand("Mx_ScreenToBmp",NV),$.MxFun.addCommand("Mx_Test_DrawMarkCircle",UV),$.MxFun.addCommand("Mx_Test_Wipeout",VV),$.MxFun.addCommand("Mx_Test_SetCurrentlyDraw",GV),$.MxFun.addCommand("Mx_Test_FindPolygonEntitys",OV),$.MxFun.addCommand("Mx_Test_DrawTransparencyLine",HV),$.MxFun.addCommand("MxTest_Explode",jV),$.MxFun.addCommand("MxTest_LineRecord",qV),$.MxFun.addCommand("MxTest_ModifyPatternScale",WV),US(),nC(),CI(),RI(),uk(),bk(),Ak(),Dk(),Lk(),l5(),m5(),Pk(),M5(),Wz(),f6(),C6(),H6(),rU(),uz(),uU(),Fu.mxmap&&MU($.MxFun.getCurrentDraw())}const XV=Object.freeze(Object.defineProperty({__proto__:null,default:{718:"Specify the first point of the output range:",719:"Specify the second point of the output range:",720:"Specify the first point:",721:"Specify the second point:",722:"Cloud wireframe starting point:",723:"End point of cloud wireframe:",724:"Drawing review annotation points:",725:"Click to start drawing cloud lines:",726:"Click to end drawing cloud lines again:",727:"Specify one point:",728:"Specify two points:",729:"Select object",730:"Specify the next point:",731:"\\Specify insertion base point",732:"Specify table insertion point:",733:"Specify insertion point:",734:"Specify insertion base point",735:"Select annotation object",736:"Please select the target text",737:"Specify a point inside the filling area:",738:"No closed area found",739:"Surface roughness",740:"Welding symbol",741:"Positional tolerance",742:"Select the object that needs to enable custom properties",743:"Select the object to hide",744:"Specify insertion point:",745:"Specify one point:",746:"Specify the angle",747:"Specify two points:",748:"Select pattern fill object",749:"Specify the first point:",750:"Specify the second point:",751:"Specify the second angle point:",752:"Specify the last point:",753:"Specify coordinate point:",754:"Specify annotation points:",755:"Please provide your approval comments",756:"Specify the starting point of the cloud wireframe",757:"Specify the termination point of the cloud wireframe",758:"Designated review icon annotation points",759:"Specify the first corner point:",760:"Specify the second corner point:",761:"Specify serial number location:",762:"Rotations Symbols",763:"Tag type",764:"Please select the circle to be marked:",765:"Please set positioning points, lines, arcs, or circles",766:"Drag to determine the annotation position",767:"Please specify or enter an angle",768:"weld symbol",769:"Please pick a positioning point, line, or arc",770:"Please specify the second point",771:"Please set the positioning point",772:"Please set the angle",773:"Please set positioning points, lines, or arcs",774:"Please set the lead turning point",775:"Drag to determine the positioning point",776:"Please specify the first point:",777:"Please specify the second point:",778:"Please select the target block object",779:"Please enter a new block name",780:"Select the block that needs to modify the base point",781:"Set base point",782:"Select the block that requires color modification",783:"Enter color index (0~256)",784:"Please select the source block",785:"Select the target block to brush:",786:"Select connection method",787:"Manually connect each line one by one",788:"Automatic batch connection",789:"Please select the block for the connection",790:"Set centerline length",791:"Select the target block to rotate:",792:"Set rotation angle",793:"Please set the zoom ratio",794:"Please set the selection range:",795:"Please select the target block",796:"Please set the statistical scope",797:"Specify table insertion point:",798:"Select target curve",799:"Specify the length annotation point",800:"Select Target Object",801:"Please select the target slope object",802:"Please set the height of the annotation text",803:"Specify slope annotation point",804:"Please select the target coordinate point",805:"Please specify the annotation location",806:"Specify start point",807:"Specify the endpoint",808:"Specify annotation direction",809:"Please set the text content",810:"Please select the first point of the area",811:"Please select the next point",812:"Please select the location for area annotation",813:"Please select corner 1 of the rectangle",814:"Please select corner 2 of the rectangle",815:"Please set the location for area annotation",816:"Please select a measurement point",817:"Please select a straight line",818:"Please set the position of the dimension line",819:"Please select an arc",820:"Please specify the position of the dimension line",821:"Please select a circular object",822:"Please specify the text location",823:"Please select the endpoint or arc of the line",824:"Please specify the position of the text",825:"Please select a continuous measurement label",826:"Please select the second straight line",827:"Please set the position for angle annotation",828:"Please enter the number of star shaped vertices:",829:"Specify the star center point:",830:"Please set the inner radius of the star shape:",831:"Specify the outer radius of the star shape:",832:"Please enter the width of the concave convex line<5>",833:"Please enter the height of the concave convex line as<10>",834:"Please click to confirm the starting point",835:"Please click to confirm the endpoint",836:"Please enter zigzag width<5>",837:"Please enter zigzag line height<10>",838:"Please enter rectangle width<5>",839:"Please enter rectangle height<10>",840:"Please click to confirm the center of the rectangle",841:"Please enter pipe diameter<10>",842:"Please enter the length of the outlet pipe<5>",843:"Please click to confirm the starting point",844:"Specify the starting point of the pipeline section",845:"Specify the endpoint of the sectional pipeline",846:"Select the direction of the pipeline arc",847:"the left",848:"the right side",849:"MODE",850:"straight bead",851:"Arc weld seam",852:"Please enter weld radius<5>",853:"Specify the second point of the arc",854:"Specify end point of arc",855:"Please enter width<25>",856:"Please enter height<15>",857:"Please enter staircase level<10>",858:"Please confirm the center position of the circle",859:"Please enter the radius of the circle",860:"Please enter insulation cotton width<5>",861:"Please enter insulation cotton height<10>",862:"Please click on the next point",863:"Please select the first line",864:"Please select the second line",865:"Please select the endpoint",866:"Please select the target rectangle",867:"Set the center point of the compass",868:"Set the radius of the compass",869:"Select prompt box pointing",870:"Specify the first point of the message box:",871:"Specify the second point of the message box:",872:"Set the message box to point to:",873:"Please set the reference character text",874:"Please set the text height",875:"Please set the benchmark position",876:"Please set positioning points, arcs, or lines",877:"Please set the symbol position",878:"Please set the center of the circle",879:"Please set the center of the gear circle",880:"Please set the gear radius",881:"Please set the centerline length to 10>",882:"Please select the first circle",883:"Please select the second circle",884:"Please set the top left corner point of the rectangle",885:"Please set the bottom right corner point of the rectangle",886:"Please set the fillet radius",887:"Please select the starting point of the polygon",888:"Please select polygon vertices",889:"Select object:",890:"Specify base point",891:"Specify the second point",892:"array",893:"exit",894:"give up",895:"Enter the number of items to be arranged in the array",896:"Select arc object",897:"Choose to copy rotated objects:",898:"Please specify the target point",899:"Please specify the rotation angle",900:"Select the object to be converted into a polygon",901:"Set the number of polygon edges",902:"Input Options",903:"Internally connected to a circle",904:"Externally cut to a circle",905:"Select the object whose color you want to modify",906:"Enter color index",907:"hide",908:"Hide Unselected",909:"show all",910:"Select the target object",911:"Specify to delete the first point of the box:",912:"Specify to delete the second point of the box:",913:"Select the entity that needs to be precisely deleted",914:"Please select an angle to copy the object",915:"Please enter the angle for copying quantity",916:"Please enter the base point for copying the angle",917:"Please enter the copying angle",918:"Please select vertex object",919:"Please select the copied object",920:"Please confirm the replication base point",921:"Please select the reference curve",922:"Select interrupt object",923:"Specify offset object",924:"Please enter the offset distance",925:"Specify the scaling object (select lines, polylines, arcs)",926:"Stretching to",927:"Select the object to modify the line type scale",928:"Please enter the line type ratio",929:"Please enter the array spacing",930:"Please select an arc",931:"Select sorting objects",932:"Specify the arrangement base point",933:"Select target polyline:",934:"Please enter rounded corner radius<5>",935:"Select fill object",936:"Please enter the fill ratio",937:"Please select the original fill shape",938:"Please click to fill any point inside the graphic",939:"Please select a line object",940:"Select equal division mode",941:"measure",942:"Divide",943:"Offset equal division",944:"Copy equally",945:"Please select offset equal division objects",946:"Please select to copy equally divided objects",947:"Please select the line segments that need to be divided equally",948:"Please set equal distances",949:"Please set the number of equal parts",950:"Please set the offset distance",951:"Please specify the offset point",952:"Please specify the replication base point",953:"Please specify the number of equal parts to be copied",954:"Please specify the endpoints for copying and dividing equally",955:"Please select the entity that requires rectangular scaling:",956:"Please specify corner 1 of the rectangle",957:"Please specify corner 2 of the rectangle",958:"Please choose to zoom in on the center point",959:"Please select the zoom in range",960:"Please set the magnification factor",961:"Please choose to enlarge the insertion point",962:"Please select a curve that needs to be broken",963:"Please select a break point on the curve",964:"Please enter the number of arrays",965:"Do you want to enable rotation",966:"correct",967:"deny",968:"Please select the graphics that require an array:",969:"Please select the center point of the array",970:"Please select a closed polygon!",971:"Please select the first point",972:"Please select the second point",973:"Please select the first closed polygon",974:"Please select the second closed polygon",975:"Please select two closed polygons",976:"Two polygons do not have overlapping edges!",977:"Please select the target polygon",978:"Please select the edges of the polygon to add vertices to",979:"Please set the position of the added vertices",980:"Please select the vertices of the polygon that need to be deleted",981:"Please select the edges of the polygon that need to be stretched",982:"Please specify the stretching position",983:"Please set the orientation of the frame to<N>",984:"horizontal",985:"longitudinal",986:"Please set the frame size to<4>",987:"Please set the position of the frame",988:"Specify cutting corner 1",989:"Specify cutting corner point 2",990:"Please set the starting point of the road",991:"Please set the next point",992:"Please select the target alignment line object (choose a line)",993:"Please select the target text object",994:"Select Text Object",995:"Please set the font height",996:"Please set the word width",997:"Please select the source text",998:"Please select the first text",999:"Please select the second text",1e3:"Please select the text that needs to be aligned",1001:"Please choose the alignment method",1002:"the left side",1003:"centre",1004:"the right side",1005:"Please select the alignment base point",1006:"Please select the text that needs to be reversed",1007:"Please select the text that needs to be filled with spaces",1008:"Please select a text object",1009:"Please enter underline width",1010:"Please set the underline distance",1011:"Please set an underline to extend the distance",1012:"Please select the operation option",1013:"capital letters",1014:"lowercase",1015:"sentence case ",1016:"Please select a numerical object",1017:"Please select a text insertion point",1018:"Select the scope to search for:",1019:"Please select the search mode",1020:"equal to",1021:"contain",1022:"The prefix is",1023:"The suffix is",1024:"Please enter keywords",1025:"Select the scope of operation:",1026:"Select operation mode",1027:"add",1028:"delete",1029:"Select operation location",1030:"prefix",1031:"suffix",1032:"Please enter the content",1033:"Please select text",1034:"Please select an arc",1035:"Please choose a text style",1036:"Please set the text extraction range",1037:"Download and open the demo code",1038:"Download development kit",1039:"Call the command to draw circular lines",1040:"Interactive drawing of straight lines",1041:"Add Layer",1042:"Get all layers",1043:"Get all text styles",1044:"Obtain all image blocks",1045:"Get all line types",1046:"Write extended data",1047:"Read extended data",1048:"Test inserting a block",1049:"Draw a straight line",1050:"arc ",1051:"circle",1052:"Draw PL line",1053:"Draw Fill",1054:"emoji",1055:"Draw an ellipse",1056:"Draw elliptical arcs",1057:"Draw multiline text",1058:"TABLE",1059:"Draw QR code",1060:"Insert stamp",1061:"Get all objects",1062:"Interactive selection of objects",1063:"Save MXWeb to the server",1064:"Obtain system variables",1065:"new sheet",1066:"White background color",1067:"Text search and positioning",1068:"Select entity to make blocks",1069:"Draw single line text",1070:"Select point filling",1071:"Set extended attributes",1072:"Draw alignment annotations",1073:"Drawing line annotation",1074:"angular",1075:"Modify object line type",1076:"Select hidden object layer",1077:"Add to current selection",1078:"Visual rotation",1079:"Write extension records",1080:"Get a Naming Dictionary",1081:"Add Text Style",1082:"Draw custom entities",1083:"Modify object color",1084:"The modified object is not visible",1085:"Modify object layer",1086:"Modify the display order of objects",1087:"Output PDF within the specified range",1088:"Draw an image",1089:"Read object extension dictionary",1090:"Draw 3D Polyline",1091:"Custom entity for line drawing text",1092:"Calculate intersection point",1093:"Modify Text Style",1094:"Offset input line drawing",1095:"Create Group",1096:"Screenshot JPG",1097:"Obtain the same text as the drawing",1098:"Specify the output range as dwg",1099:"Test drawing marker circle",1100:"Test Wipeout",1101:"create cutouts",1102:"Tolerance marking",1103:"Change all object colors",1104:"Cutting MXWeb",1105:"Set the current color line weight",1106:"Search for objects within a polygonal region",1107:"Smash objects",1108:"Draw semi transparent lines",1109:"Add line type",1110:"Modify the proportion of the pattern",1111:"Test Text Editing",1112:"Draw barcode",1113:"Screenshot BMP",1114:"Modify Tools",1115:"text tool",1116:"Drawing tools",1117:"Block Tool",1118:"Instrument",1119:"Annotation tool",1120:"Other tools",1121:"Multiple replication",1122:"Arc to Circle",1123:"Copy Rotation",1124:"Circular to Multilateral",1125:"Change color",1126:"Arc angle cutting",1127:"Temporary Hide",1128:"Box deletion",1129:"Angle copying",1130:"Vertex Copy",1131:"Intersection point interruption",1132:"double offset",1133:"Change the size of the circle",1134:"Linetype Scale",1135:"Telescoping",1136:"By arc array",1137:"PL rounded corner",1138:"PL line reverse",1139:"Obtain all linear objects",1140:"equal division",1141:"Rectangular scaling",1142:"interrupt",1143:"Cutting polygons",1144:"Merging Polygons",1145:"Add polygon vertices",1146:"Delete polygon vertices",1147:"Unilateral stretching of polygons",1148:"star shape",1149:"Concave convex line",1150:"jagged lines",1151:"Center rectangle",1152:"rounded rectangle",1153:"Circular centerline",1154:"pipe",1155:"Pipe cutting symbol",1156:"perpendicular bisector",1157:"staircase",1158:"solid circle",1159:"Thermal insulation cotton",1160:"Centerline",1161:"Opening a hole",1162:"message box",1163:"Reference symbol (1)",1164:"weld line",1165:"concentric circles",1166:"gear",1167:"Block centerline",1168:"Circular tangent line",1169:"Reference symbol (2)",1170:"Insert frame",1171:"Draw roads",1172:"Draw any polygon",1173:"Align by line",1174:"Change the font height",1175:"Change the width of the characters",1176:"Brush content",1177:"Change content",1178:"justified",1179:"Align up and down",1180:"Text reversal",1181:"Text framing",1182:"underline",1183:"Title line",1184:"case",1185:"Sum of numbers",1186:"Select specific characters",1187:"affix",1188:"Connecting Text",1189:"Delete space",1190:"Vertical Text",1191:"Align by arc",1192:"Modify global text style",1193:"Extract Text",1194:"Text number",1195:"Change the block name",1196:"Brush block",1197:"Block Connection",1198:"Change the base point of the block",1199:"Change the color of the block",1200:"Multi block rotation",1201:"Multi block scaling",1202:"Brush block angle",1203:"Select by block",1204:"Select all by block",1205:"Statistics of individual blocks",1206:"Count multiple blocks",1207:"Modify block layer",1208:"length",1209:"Statistical area",1210:"Intelligent elevation",1211:"area",1212:"Rectangular area",1213:"distance from point to line",1214:"arc length",1215:"Measuring Circle",1216:"CONTINUE",1217:"View segment length",1218:"Area including arc",1219:"Drawing review annotation",1220:"Rectangular annotation",1221:"Roughness annotation",1222:"Coordinate annotation",1223:"Slope marking",1224:"alignment",1225:"enlarge",1226:"Number annotation",1227:"Rotate annotation",1228:"Circular hole marking",1229:"Directional symbol",1230:"Radiographic annotation",1231:"Rectangular annotation hovering color change",1232:"Crop drawing extension",1233:"Arrow line",1234:"Selected Text",1235:"Clipboard",1236:"cancel",1237:"sure",1238:"Tolerance code",1239:"Tolerance 1",1240:"Tolerance 2",1241:"annotations",1242:"top",1243:"bottom",1244:"reference",1245:"Full week symbol",1246:"Current line",1247:"Add Row",1248:"delete row",1249:"zero clearing",1250:"Straightness",1251:"Flatness",1252:"roundness",1253:"Cylindricity",1254:"Line Profile",1255:"Profile of a Surface",1256:"parallelism",1257:"verticality",1258:"tilt",1259:"Positional accuracy",1260:"Coaxiality",1261:"Symmetry",1262:"runout",1263:"total runout",1264:"clean up",1265:"Please enter the text content and number:",1266:"Text content:",1267:"(Enter 0-20 words)",1268:"Starting number:",1269:"(Number automatically increases by 1)",1270:"Number location:",1271:"Number before",1272:"Number after",1273:"change direction",1274:"Left text content:",1275:"Text content on the right:",1276:"Bottom text content:",1277:"Basic symbols",1278:"Same requirements",1279:"Most symbols",1280:"Add a horizontal line to the long side",1281:"auxiliary symbol",1282:"Supplementary symbols",1283:"Symbol position",1284:"Special symbols",1285:"Left size",1286:"Up size",1287:"Right size",1288:"Staggered weld",1289:"spacing",1290:"extended text ",1291:"Dashed line position",1292:"Welding instructions",1293:"Clear rows",1294:"flange weld",1295:"Type I weld seam",1296:"V-shaped weld seam",1297:"Unilateral V-shaped weld seam",1298:"Single sided steep side V-shaped groove welding",1299:"Tilted weld seam",1300:"Removable pad",1301:"Durable pad",1302:"V-type weld with rounded edge",1303:"U-shaped weld with rounded edge",1304:"Single sided V-shaped weld with a stop edge",1305:"Single sided U-shaped weld with a stop edge",1306:"Edge weld",1307:"Welding joint",1308:"sealing bead",1309:"fillet weld",1310:"Plug weld or groove weld",1311:"spotweld",1312:"Folding interface",1313:"Tilt interface",1314:"Spot weld seam (offset center)",1315:"Weld seam",1316:"Weld seam (off center)",1317:"Steep side V-shaped groove welding",1318:"The first type of planar symbol",1319:"The second concave symbol",1320:"The second type of convex symbol",1321:"The second type of planar symbol",1322:"The first convex symbol",1323:"The third type of planar symbol",1324:"The first concave symbol",1325:"Flatten the weld seam",1326:"Smooth transition at the toe",1327:"With pad symbol",1328:"Three sided weld symbol",1329:"Surrounding welding symbols",1330:"On site symbols",1331:"tail symbol",1332:"Interleaved intermittent welding symbol",1333:"Horn shaped weld seam",1334:"Unilateral horn shaped weld seam",1335:"Weld seam",1336:"Lock edge weld seam",1337:"Locking edge groove",1338:"upper",1339:"below",1340:"not have",1341:"basicSymbol",1342:"auxiliarySymbol",1343:"suppleSymbol",1344:"specialSymbol",1345:"Select the weld symbol to be placed on the geometric shape",1346:"Welding angle width:",1347:"Unilateral V-shaped butt weld (front view)",1348:"Corner weld seam (front view)",1349:"Unilateral V-shaped butt weld (side view)",1350:"Corner weld seam (side view)"}},Symbol.toStringTag,{value:"Module"})),KV=Object.freeze(Object.defineProperty({__proto__:null,default:{718:"출력 범위의 첫 번째 점을 지정합니다.",719:"출력 범위의 두 번째 점을 지정합니다.",720:"첫 번째 점을 지정합니다.",721:"두 번째 점 지정:",722:"클라우드 와이어프레임 시작점:",723:"클라우드 와이어프레임 끝점:",724:"심사 아이콘 참고 사항:",725:"클릭하여 구름선을 그리기 시작:",726:"다시 클릭하여 클라우드 그리기를 끝냅니다.",727:"점 지정:",728:"두 점 지정:",729:"객체 선택",730:"다음 점을 지정합니다.",731:"\\ 삽입 기준점 지정",732:"테이블 삽입점을 지정하려면 다음과 같이 하십시오.",733:"삽입점을 지정하려면 다음과 같이 하십시오.",734:"삽입 기준점 지정",735:"치수 객체 선택",736:"대상 텍스트 선택",737:"채우기 영역 내부의 점을 지정합니다.",738:"닫힌 영역을 찾을 수 없음",739:"표면 거친도",740:"용접 기호",741:"비트 공차",742:"사용자 정의 속성을 설정할 객체 선택",743:"숨길 객체 선택",744:"삽입점을 지정하려면 다음과 같이 하십시오.",745:"점 지정:",746:"각도 지정",747:"두 점 지정:",748:"해치 객체 선택",749:"첫 번째 점을 지정합니다.",750:"두 번째 점 지정:",751:"두 번째 각도를 지정합니다.",752:"마지막 점을 지정합니다.",753:"좌표점을 지정합니다.",754:"치수 점을 지정하려면 다음과 같이 하십시오.",755:"승인 의견을 입력하십시오.",756:"클라우드 와이어프레임 시작점 지정",757:"클라우드 와이어프레임 끝점 지정",758:"심사 아이콘 주석 지정",759:"첫 번째 구석을 지정합니다.",760:"두 번째 구석 지정:",761:"일련번호 위치를 지정하려면 다음과 같이 하십시오.",762:"회전 기호",763:"태그 유형",764:"태그가 필요한 원을 선택하십시오.",765:"위치 점 또는 선 또는 호 또는 원을 설정하십시오.",766:"드래그하여 치수 위치 결정",767:"각도를 지정하거나 입력하십시오.",768:"용접 기호",769:"위치 점, 선 또는 호를 선택하십시오.",770:"두 번째 점을 지정하십시오.",771:"위치 점을 설정하십시오.",772:"각도를 설정하십시오.",773:"위치 점이나 선 또는 호를 설정하십시오.",774:"지시선 전환점을 설정하십시오.",775:"드래그하여 위치 점 결정",776:"첫 번째 점을 지정하십시오.",777:"두 번째 점을 지정하십시오.",778:"대상 블록 객체를 선택하십시오.",779:"새 블록 이름을 입력하십시오.",780:"기준점을 수정할 블록 선택",781:"기준점 설정",782:"색상을 수정할 블록 선택",783:"색상 색인 입력 (0~256)",784:"소스 블록을 선택하십시오.",785:"브러시할 대상 블록 선택:",786:"연결 방법 선택",787:"수동으로 하나씩 연결",788:"자동 대량 연결",789:"연결된 블록을 선택하십시오.",790:"중심선 길이 설정",791:"회전할 대상 블록을 선택합니다.",792:"회전 각도 설정",793:"배율을 설정하십시오.",794:"선택 범위를 설정하십시오.",795:"대상 블록을 선택하십시오.",796:"통계 범위를 설정하십시오.",797:"테이블 삽입점을 지정하려면 다음과 같이 하십시오.",798:"대상 커브 선택",799:"길이 치수 점 지정",800:"대상 객체 선택",801:"대상 기울기 객체를 선택하십시오.",802:"치수 문자 높이를 설정하십시오.",803:"기울기 치수 점 지정",804:"대상 좌표점을 선택하십시오.",805:"치수 위치를 지정하십시오.",806:"시작점 지정",807:"끝점 지정",808:"치수 방향 지정",809:"텍스트 내용을 설정하십시오.",810:"영역의 첫 번째 점을 선택하십시오.",811:"다음 점을 선택하십시오.",812:"영역 치수의 위치를 선택하십시오.",813:"사각형의 구석 1을 선택하십시오.",814:"사각형의 구석 2 를 선택하십시오.",815:"영역 치수의 위치를 설정하십시오.",816:"측정 점을 선택하십시오.",817:"선을 선택하십시오.",818:"치수 선의 위치를 설정하십시오.",819:"호선을 선택하십시오.",820:"치수 선 위치를 지정하십시오.",821:"원 객체를 선택하십시오.",822:"문자 위치를 지정하십시오.",823:"선의 끝점이나 호를 선택하십시오.",824:"문자의 위치를 지정하십시오.",825:"연속 측정을 위한 치수를 선택하십시오.",826:"두 번째 선을 선택하십시오.",827:"각도 치수의 위치를 설정하십시오.",828:"별 꼭대기 점 수를 입력하십시오.",829:"별의 중심점을 지정하려면:",830:"별의 내부 반지름을 설정하십시오.",831:"별의 외부 반지름을 지정합니다.",832:"범프 선 너비를 입력하십시오<5>",833:"범프 선 높이를 입력하십시오<10>",834:"시작점을 확인하려면 클릭하십시오.",835:"클릭하여 결승점을 확정하세요",836:"앤티앨리어싱 너비를 입력하십시오<5>",837:"앤티앨리어싱 높이 입력<10>",838:"직사각형 너비 입력<5>",839:"직사각형 높이 입력<10>",840:"클릭하여 사각형 중심 확인",841:"파이프 지름을 입력하십시오<10>",842:"파이프 배출구 길이를 입력하십시오<5>",843:"클릭하여 시작점 확인",844:"횡단면 파이프라인 시작점 지정하기",845:"횡단면 파이프라인 끝점 지정하기",846:"횡단면 파이프라인 호 방향 선택",847:"왼쪽",848:"오른쪽",849:"선택 모드",850:"선 용접",851:"아크 용접",852:"용접 반지름을 입력하십시오<5>",853:"호의 두 번째 점 지정하기",854:"호의 끝점 지정하기",855:"폭을 입력하십시오<25>",856:"높이를 입력하십시오<15>",857:"계단 레벨을 입력하십시오<10>",858:"중심 위치를 확인하십시오.",859:"원 반지름을 입력하십시오.",860:"보온면 너비 입력<5>",861:"보온면 높이 입력<10>",862:"다음 점 눌러주세요.",863:"첫 번째 선을 선택하십시오.",864:"두 번째 선을 선택하십시오.",865:"끝점을 선택하십시오.",866:"대상 사각형을 선택하십시오.",867:"나침반 중심점 설정",868:"나침반 반지름 설정",869:"프롬프트 상자 가리키기 선택",870:"메시지 상자의 첫 번째 점을 지정합니다.",871:"메시지 상자의 두 번째 점을 지정합니다.",872:"메시지 상자 방향을 설정하려면 다음과 같이 하십시오.",873:"데이텀 문자 설정하기",874:"문자 높이를 설정하십시오.",875:"데이텀 문자 위치를 설정하십시오.",876:"위치 점이나 호 또는 선을 설정하십시오.",877:"기호 위치를 설정하십시오.",878:"중심점을 설정하십시오.",879:"기어 중심을 설정하십시오.",880:"기어 반지름을 설정하십시오.",881:"중심선 길이 10 설정 >",882:"첫 번째 원을 선택하십시오.",883:"두 번째 원을 선택하십시오.",884:"직사각형의 왼쪽 위 구석을 설정하십시오.",885:"직사각형의 오른쪽 아래 구석을 설정하십시오.",886:"필렛 반지름을 설정하십시오.",887:"다각형 시작점을 선택하십시오.",888:"다각형 교점을 선택하십시오.",889:"객체 선택:",890:"기준점 지정",891:"두 번째 점 지정",892:"어레이",893:"종료",894:"포기",895:"패턴화할 항목 수 입력",896:"호 객체 선택",897:"회전된 객체 복사를 선택합니다.",898:"대상 점을 지정하십시오.",899:"회전 각도를 지정하십시오.",900:"다각형으로 변환할 객체 선택",901:"다각형 모서리 수 설정",902:"입력 옵션",903:"내접 원",904:"원에 외부 탄젠트",905:"색상을 수정할 객체 선택",906:"색상 색인 입력",907:"숨기기",908:"선택 안 함 숨기기",909:"모두 표시",910:"대상의 객체 선택",911:"상자의 첫 번째 점을 삭제하도록 지정합니다.",912:"상자 두 번째 점을 삭제하도록 지정합니다.",913:"정확하게 삭제할 엔티티 선택",914:"각도를 선택하여 객체를 복사합니다.",915:"각도 복사 수량을 입력하십시오.",916:"각도 복사의 기준점을 입력하십시오.",917:"복사 각도를 입력하십시오.",918:"정점 객체를 선택하십시오.",919:"객체 복사를 선택하십시오.",920:"복제 기준점을 확인하십시오.",921:"참조 커브 선택",922:"끊기 객체 선택",923:"오프셋 객체 지정",924:"오프셋 거리를 입력하십시오.",925:"신축 객체 지정 (선, 폴리선, 호 선택)",926:"다음으로 확장",927:"선종류 축척을 수정할 객체 선택",928:"선종류 축척을 입력하십시오.",929:"패턴 간격을 입력하십시오.",930:"호를 선택하십시오.",931:"정렬 객체 선택",932:"정렬 기준점 지정",933:"대상 폴리선을 선택합니다.",934:"필렛 반지름을 입력하십시오<5>",935:"채우기 객체 선택",936:"채우기 축척을 입력하십시오.",937:"원래 채우기 도면을 선택하십시오.",938:"도면 내부의 아무 곳이나 채우려면 클릭하십시오.",939:"선 객체 선택",940:"등분 모드 선택",941:"정거 등분",942:"정수 등분",943:"오프셋 등분",944:"등분 복사",945:"동등한 객체 간격띄우기를 선택하십시오.",946:"등분 객체 복사를 선택하십시오.",947:"등분할 세그먼트를 선택하십시오.",948:"등분 거리를 설정하십시오.",949:"등분 수량을 설정하십시오",950:"오프셋 거리를 설정하십시오.",951:"오프셋 점을 지정하십시오.",952:"복사 기준점을 지정하십시오.",953:"복사 등분 수량을 지정하십시오.",954:"복사 등분 끝점을 지정하십시오.",955:"사각형 배율이 필요한 엔티티를 선택하십시오.",956:"사각형의 구석 1 을 지정하십시오.",957:"사각형 구석 2를 지정하십시오.",958:"중심점 확대 선택",959:"확대 범위를 선택하십시오.",960:"확대 배수를 설정하십시오.",961:"삽입점 확대 를 선택하십시오.",962:"끊을 커브를 선택하십시오.",963:"커브에서 브레이크 점을 선택하십시오.",964:"패턴 수를 입력하십시오.",965:"회전 켜기",966:"예",967:"아니오",968:"배열이 필요한 도면을 선택하십시오.",969:"스토리지 중심점을 선택하십시오.",970:"닫힌 다각형을 선택하십시오!",971:"첫 번째 점을 선택하십시오.",972:"두 번째 점을 선택하십시오.",973:"첫 번째 닫힌 다각형을 선택하십시오.",974:"두 번째 닫힌 다각형을 선택하십시오.",975:"닫힌 다각형 두 개를 선택하십시오.",976:"두 다각형은 겹치는 모서리가 없습니다!",977:"대상 다각형을 선택하십시오.",978:"정점을 추가할 다각형 모서리를 선택하십시오.",979:"추가할 정점 위치를 설정하십시오.",980:"다각형에서 삭제할 정점을 선택하십시오.",981:"다각형으로 밀어낼 모서리를 선택하십시오.",982:"밀어내기 위치를 지정하십시오.",983:"그림 상자 방향을 설정하십시오<N>",984:"가로",985:"세로",986:"액자 크기를 설정하십시오<4>",987:"프레임 위치를 설정하십시오.",988:"트림 각도 점 1 지정",989:"트림된 구석 2 지정",990:"도로 시작점을 설치하세요",991:"다음 점을 설정하십시오.",992:"대상 정렬선 객체 (선 선택) 를 선택하십시오.",993:"대상 문자 객체를 선택하십시오.",994:"문자 객체 선택",995:"높이를 설정하십시오.",996:"글자 폭을 설정하십시오.",997:"원본 텍스트를 선택하십시오.",998:"첫 번째 텍스트를 선택하십시오.",999:"두 번째 텍스트를 선택하십시오.",1e3:"정렬할 문자를 선택하십시오.",1001:"정렬을 선택하십시오.",1002:"왼쪽",1003:"가운데",1004:"오른쪽",1005:"기준점 정렬을 선택하십시오.",1006:"반전할 텍스트를 선택하십시오.",1007:"공백을 제거할 텍스트를 선택하십시오.",1008:"문자 객체를 선택하십시오.",1009:"밑줄 너비를 입력하십시오.",1010:"밑줄 거리를 설정하십시오.",1011:"밑줄 연장 거리를 설정하십시오.",1012:"작업 옵션을 선택하십시오.",1013:"대문자",1014:"소문자",1015:"문장의 첫머리와 대문자.",1016:"디지털 객체를 선택하십시오.",1017:"텍스트 삽입점을 선택하십시오.",1018:"찾을 범위를 선택합니다.",1019:"찾기 모드를 선택하십시오.",1020:"같음",1021:"포함",1022:"접두사는",1023:"접미어는",1024:"키워드를 입력하십시오.",1025:"작업할 범위를 선택합니다.",1026:"작업 방법 선택",1027:"추가",1028:"삭제",1029:"작업 위치 선택",1030:"접두사",1031:"접미어",1032:"내용을 입력하십시오.",1033:"텍스트 선택",1034:"호를 선택하십시오.",1035:"문자 스타일을 선택하십시오.",1036:"텍스트 추출 범위를 설정하십시오.",1037:"오픈 데모 코드 다운로드",1038:"개발 패키지 다운로드",1039:"원선 그리기 명령 호출",1040:"서로 직선을 그리다",1041:"도면층 추가",1042:"모든 도면층 가져오기",1043:"모든 문자 스타일 가져오기",1044:"모든 그림 블록 가져오기",1045:"모든 선 모양 가져오기",1046:"확장 데이터 쓰기",1047:"확장 데이터 읽기",1048:"그림 블록 삽입 테스트",1049:"선을 그리다",1050:"호 그리기",1051:"원을 그리다",1052:"PL 선 그리기",1053:"채우기 그리기",1054:"드로잉 문자",1055:"타원 그리기",1056:"타원형 호를 그리다",1057:"여러 줄 문자 그리기",1058:"테이블 그리기",1059:"QR코드 그리기",1060:"도장 삽입",1061:"모든 객체 가져오기",1062:"상호 객체 선택",1063:"서버에 mxweb 저장",1064:"시스템 변수 가져오기",1065:"새 시트",1066:"흰색 배경색",1067:"텍스트 찾기 위치",1068:"블록으로 솔리드 선택",1069:"단일행 문자 그리기",1070:"선택 채우기",1071:"확장 속성 설정",1072:"정렬 치수 그리기",1073:"회선 치수",1074:"각도 치수",1075:"객체 선종류 수정",1076:"숨겨진 객체 레이어 선택",1077:"현재 선택에 추가",1078:"뷰포트 회전",1079:"확장 레코드 쓰기",1080:"명명 사전 얻기",1081:"문자 스타일 추가",1082:"사용자 솔리드 그리기",1083:"객체 색상 수정",1084:"수정 개체가 보이지 않음",1085:"객체 레이어 수정",1086:"객체 표시 순서 수정",1087:"범위 지정 출력 pdf",1088:"이미지 그리기",1089:"객체 확장 사전 읽기",1090:"3DPolyline 그리기",1091:"선 그리기 텍스트 사용자화 솔리드",1092:"계산 교차점",1093:"문자 스타일 수정",1094:"오프셋 입력 선",1095:"그룹 만들기",1096:"스크린샷 jpg",1097:"시트 동일 문자 가져오기",1098:"범위 출력 dwg 지정",1099:"표식 원 그리기 테스트",1100:"Wipeout 테스트",1101:"잘라낸 블록 생성하기",1102:"공차 치수",1103:"모든 객체 색상 변경",1104:"자르기 mxweb",1105:"현재 색상 선 무게 설정",1106:"다각형 영역 내의 객체 찾기",1107:"객체 깨기",1108:"반투명 선 그리기",1109:"선 유형 추가",1110:"패턴 축척 수정하기",1111:"텍스트 편집 테스트",1112:"바코드 그리기",1113:"스크린샷 bmp",1114:"수정 도구",1115:"문자 도구",1116:"드로잉 도구",1117:"블록 도구",1118:"측정 도구",1119:"치수 도구",1120:"기타 도구",1121:"다중 복제",1122:"호전원",1123:"복사 회전",1124:"원형 다각형",1125:"색상 수정",1126:"호 탄젠트",1127:"임시 숨기기",1128:"상자 삭제",1129:"각도 복사",1130:"정점 복사",1131:"교점이 끊어지다",1132:"양방향 오프셋",1133:"원 크기 변경",1134:"선종류 축척",1135:"신축",1136:"호별 패턴",1137:"pl 필렛",1138:"pl선 대칭 이동",1139:"모든 선 객체 가져오기",1140:"등분",1141:"직사각형 크기 조절",1142:"끊다",1143:"다각형 가공하기",1144:"다각형 결합",1145:"다각형 교점 추가",1146:"다각형 교점 삭제",1147:"다각형 단일 밀어내기",1148:"별 모양",1149:"범프 선",1150:"톱니 선",1151:"중심 사각형",1152:"필렛 사각형",1153:"원 중심선",1154:"파이프",1155:"단면부",1156:"중수선",1157:"계단",1158:"채워진 원",1159:"보온면",1160:"중심선",1161:"구멍을 내다",1162:"메시지 상자",1163:"데이텀 문자 (1)",1164:"용접선",1165:"동심원",1166:"기어",1167:"블록 중심선",1168:"원형 공접선",1169:"데이텀 문자 (2)",1170:"그림 상자 삽입",1171:"도로를 그리다",1172:"다각형 그리기",1173:"선으로 정렬",1174:"고자질",1175:"글자의 폭을 바꾸다",1176:"내용 스밍",1177:"내용을 바꾸다",1178:"좌우 정렬",1179:"위아래 정렬",1180:"문자 반전",1181:"텍스트 상자",1182:"밑줄",1183:"도명선",1184:"대소문자",1185:"숫자 구화",1186:"특정 단어 선택",1187:"접미어",1188:"연결 문자",1189:"공백 제거",1190:"문자 세로 방향",1191:"호별 정렬",1192:"전역 문자 스타일 수정",1193:"텍스트 추출",1194:"문자 번호",1195:"블록 이름 변경",1196:"브러시",1197:"블록 연결",1198:"블록 기준점을 변경하다.",1199:"블록 색상 변경",1200:"다중 블록 회전",1201:"다중 블록 크기 조절",1202:"브러시 각도",1203:"블록별 선택",1204:"블록별로 모두 선택",1205:"통계 단일 블록",1206:"다중 블록 통계",1207:"블록 도면층 수정",1208:"길이",1209:"통계 면적",1210:"지능형 높이",1211:"면적",1212:"직사각형 영역",1213:"점에서 선까지의 거리",1214:"호 길이",1215:"원 측정",1216:"연속 측정",1217:"세그먼트 길이 보기",1218:"영역 포함 호",1219:"심도 치수",1220:"직사각형 치수",1221:"조잡도 치수",1222:"좌표 치수",1223:"슬로프",1224:"정렬",1225:"부분 확대",1226:"일련번호 마크업",1227:"치수 회전",1228:"둥근 구멍 표식",1229:"방향 기호",1230:"방사선 치수",1231:"직사각형 치수 고정 변색",1232:"용지 확장 트림",1233:"화살표 선",1234:"선택한 텍스트",1235:"클립보드로 복사",1236:"취소",1237:"확인",1238:"공차 코드",1239:"공차 1",1240:"공차 2",1241:"부주",1242:"꼭대기",1243:"밑단",1244:"기준",1245:"전주기호",1246:"현재 행",1247:"행 추가",1248:"행 삭제",1249:"제로",1250:"직선도",1251:"평면도",1252:"원도",1253:"원통도",1254:"선 프로파일",1255:"면 프로파일",1256:"평행도",1257:"수직도",1258:"경사도",1259:"위치도",1260:"동축도",1261:"대칭도",1262:"둥글게 뛰다",1263:"올댄스",1264:"지우기",1265:"텍스트 내용 및 번호를 입력하십시오.",1266:"텍스트 내용:",1267:"(0-20자 입력)",1268:"시작 번호:",1269:"(번호 자동 증가 1)",1270:"번호 지정 위치:",1271:"번호 이전",1272:"번호 뒤에",1273:"방향 변경",1274:"왼쪽 텍스트 내용:",1275:"오른쪽 텍스트 내용:",1276:"아래 텍스트 내용:",1277:"기본 기호",1278:"동일 요구 사항",1279:"다수 기호",1280:"긴 모서리 가로줄",1281:"보조 기호",1282:"보충 기호",1283:"기호 위치",1284:"특수 기호",1285:"왼쪽 치수",1286:"위 치수",1287:"오른쪽 치수",1288:"교차 용접",1289:"간격",1290:"텍스트 확장",1291:"점선 위치",1292:"용접 설명",1293:"행 지우기",1294:"볼륨 모서리 용접",1295:"유형 I 용접",1296:"V 용접",1297:"단일 V 용접",1298:"한면 급경사 V 그루브 스택",1299:"용접 기울이기",1300:"분리식 패드",1301:"영구 패드",1302:"리턴 모서리 V 용접",1303:"리턴 모서리 U 용접",1304:"리턴 모서리 단일 V 용접",1305:"리턴 모서리 단일 U 용접",1306:"끝 용접",1307:"스택 용접 커넥터",1308:"커버 용접",1309:"필렛 용접",1310:"플러그 또는 슬롯 용접",1311:"점 용접",1312:"인터페이스 축소",1313:"기울기 커넥터",1314:"점 용접 (가운데 오프셋)",1315:"용접",1316:"용접 (중심 이탈)",1317:"가파른 V 그루브 스택",1318:"첫 번째 평면 기호",1319:"두 번째 오목 기호",1320:"두 번째 볼록 기호",1321:"두 번째 평면 기호",1322:"첫 번째 볼록 기호",1323:"세 번째 평면 기호",1324:"첫 번째 오목 기호",1325:"용접 깎기",1326:"발가락 부드럽게 변환",1327:"개스킷 기호 포함",1328:"3면 용접 기호",1329:"주변 용접 문자",1330:"필드 기호",1331:"꼬리 기호",1332:"인터레이스 띄엄필렛 용접 기호",1333:"플레어 용접",1334:"단일 플레어 용접",1335:"더미 용접",1336:"자물쇠 모서리 용접",1337:"모서리 그루브 잠금",1338:"위",1339:"하",1340:"없음",1341:"basicSymbol",1342:"auxiliarySymbol",1343:"suppleSymbol",1344:"specialSymbol",1345:"형상에 배치할 용접 기호 선택",1346:"용접 각도 너비:",1347:"단일 V 버트 용접(전면)",1348:"필렛 용접 (전면)",1349:"단일 V 버트 용접 (측면 뷰)",1350:"필렛 용접 (측면 뷰)"}},Symbol.toStringTag,{value:"Module"})),ZV=Object.freeze(Object.defineProperty({__proto__:null,default:{718:"指定輸出範圍第一點：",719:"指定輸出範圍第二點：",720:"指定第一點：",721:"指定第二點：",722:"雲線框起始點：",723:"雲線框結束點：",724:"審圖標注點：",725:"點擊開啟繪製雲線：",726:"再次點擊結束繪製雲線：",727:"指定一點：",728:"指定二點：",729:"選擇對象",730:"指定下一個點：",731:"\\指定插入基點",732:"指定表格插入點：",733:"指定插入點：",734:"指定插入基點",735:"選擇標注對象",736:"請選擇目標文字",737:"指定填充區域內部一點：",738:"沒有找到閉合區域",739:"表面粗糙度",740:"焊接符號",741:"形位公差",742:"選擇要需要開啟自訂屬性的對象",743:"選擇要隱藏的對象",744:"指定插入點：",745:"指定一點：",746:"指定夾角",747:"指定二點：",748:"選擇圖案填充對象",749:"指定第一點：",750:"指定第二點：",751:"指定第二個角度點：",752:"指定最後一個點：",753:"指定座標點：",754:"指定標注點：",755:"請輸入審批意見",756:"指定雲線框起始點",757:"指定雲線框終止點",758:"指定審圖標注點",759:"指定第一個角點：",760:"指定第二個角點：",761:"指定序號位置：",762:"旋轉符號",763:"標記類型",764:"請選擇需要標記的圓：",765:"請設定定位點或直線或圓弧或圓",766:"拖動確定標注位置",767:"請指定或輸入角度",768:"焊縫符號",769:"請拾取定位點、直線或圓弧",770:"請指定第二點",771:"請設定定位點",772:"請設定角度",773:"請設定定位點或直線或圓弧",774:"請設定引線轉捩點",775:"拖動確定定位點",776:"請指定第一點：",777:"請指定第二點：",778:"請選擇目標塊對象",779:"請輸入新塊名",780:"選擇需要修改基點的塊",781:"設定基點",782:"選擇需要修改顏色的塊",783:"輸入顏色索引(0~256)",784:"請選擇源塊",785:"選擇要刷的目標塊：",786:"選擇連接管道",787:"手動逐個連線",788:"自動批量連線",789:"請選擇連線的塊",790:"設定中心線長度",791:"選擇要旋轉的目標塊：",792:"設定旋轉角度",793:"請設定縮放比例",794:"請設定選擇範圍：",795:"請選擇目標塊",796:"請設定統計範圍",797:"指定表格插入點：",798:"選擇目標曲線",799:"指定長度標注點",800:"選擇目標對象",801:"請選擇目標斜率對象",802:"請設定標注文字高度",803:"指定斜率標注點",804:"請選擇目標座標點",805:"請指定標注位置",806:"指定起點",807:"指定終點",808:"指定標注方向",809:"請設定文字內容",810:"請選擇面積的第一個點",811:"請選擇下一個點",812:"請選擇面積標注的位置",813:"請選擇矩形的角點1",814:"請選擇矩形的角點2",815:"請設定面積標注的位置",816:"請選擇一個量測點",817:"請選擇一條直線",818:"請設定尺寸線的位置",819:"請選擇一條弧線",820:"請指定尺寸線位置",821:"請選擇一個圓對象",822:"請指定文字位置",823:"請選擇直線的端點或弧線",824:"請指定文字的位置",825:"請選擇一個連續量測的標注",826:"請選擇第二條直線",827:"請設定角度標注的位置",828:"請輸入星形頂點數：",829:"指定星形中心點：",830:"請設定星形的內半徑：",831:"指定星形的外半徑：",832:"請輸入凹凸線寬度<5>",833:"請輸入凹凸線高度<10>",834:"請點擊確定起始點",835:"請點擊確定終點",836:"請輸入鋸齒線寬度<5>",837:"請輸入鋸齒線高度<10>",838:"請輸入矩形寬度<5>",839:"請輸入矩形高度<10>",840:"請點擊確定矩形中心",841:"請輸入管徑<10>",842:"請輸入長出管口長度<5>",843:"請點擊確定起點",844:"指定剖管線起點",845:"指定剖管線終點",846:"選擇剖管線圓弧方向",847:"左邊",848:"右邊",849:"選擇模式",850:"直線焊縫",851:"弧線焊縫",852:"請輸入焊縫半徑<5>",853:"指定圓弧的第二個點",854:"指定圓弧的端點",855:"請輸入寬度<25>",856:"請輸入高度<15>",857:"請輸入樓梯級數<10>",858:"請確定圓心位置",859:"請輸入圓半徑",860:"請輸入保溫棉寬度<5>",861:"請輸入保溫棉高度<10>",862:"請點擊下一個點",863:"請選擇第一條線",864:"請選擇第二條線",865:"請選擇終點",866:"請選擇目標矩形",867:"設定指北針中心點",868:"設定指北針半徑",869:"選擇提示框指向",870:"指定訊息方塊第一點：",871:"指定訊息方塊第二點：",872:"設定訊息方塊指向：",873:"請設定基準符文字",874:"請設定文字高度",875:"請設定基準符位置",876:"請設定定位點或圓弧或直線",877:"請設定符號位置",878:"請設定圓心",879:"請設定齒輪圓心",880:"請設定齒輪半徑",881:"請設定中心線長度10>",882:"請選擇第一個圓",883:"請選擇第二個圓",884:"請設定矩形左上角點",885:"請設定矩形右下角點",886:"請設定圓角半徑",887:"請選擇多邊形起點",888:"請選擇多邊形頂點",889:"選擇對象：",890:"指定基點",891:"指定第二個點",892:"陣列",893:"退出",894:"放弃",895:"輸入要進行陣列的項目數",896:"選擇圓弧對象",897:"選擇複製旋轉對象：",898:"請指定目標點",899:"請指定旋轉角度",900:"選擇要轉成多邊形的對象",901:"設定多邊形邊數",902:"輸入選項",903:"內接於圓",904:"外切於圓",905:"選擇要修改顏色的對象",906:"輸入顏色索引",907:"隱藏",908:"隱藏未選",909:"全部顯示",910:"選擇目標的對象",911:"指定删除方框第一點：",912:"指定删除方框第二點：",913:"選擇需要精確删除的實體",914:"請選擇角度複製對象",915:"請輸入角度複製數量",916:"請輸入角度複製的基點",917:"請輸入複製角度",918:"請選擇頂點對象",919:"請選擇複製對象",920:"請確定複製基點",921:"請選擇參攷曲線",922:"選擇打斷對象",923:"指定偏移對象",924:"請輸入偏移距離",925:"指定伸縮對象(選擇直線、多段線、圓弧)",926:"伸縮至",927:"選擇要修改線型比例的對象",928:"請輸入線型比例",929:"請輸入陣列間距",930:"請選擇圓弧",931:"選擇排列對象",932:"指定排列基點",933:"選擇目標多段線：",934:"請輸入圓角半徑<5>",935:"選擇填充對象",936:"請輸入填充比例",937:"請選擇原填充圖形",938:"請點擊填充圖形內部任意一點",939:"請選擇線對象",940:"選擇等分模式",941:"定距等分",942:"定數等分",943:"偏移等分",944:"複製等分",945:"請選擇偏移等分對象",946:"請選擇複製等分對象",947:"請選擇需要等分的線段",948:"請設定等分距離",949:"請設定等分的數量",950:"請設定偏移距離",951:"請指定偏移點",952:"請指定複製基點",953:"請指定複製等分數量",954:"請指定複製等分端點",955:"請選擇需要矩形縮放的實體：",956:"請指定矩形的角點1",957:"請指定矩形角點2",958:"請選擇放大中心點",959:"請選擇放大範圍",960:"請設定放大倍數",961:"請選擇放大插入點",962:"請選擇一條需要打斷的曲線",963:"請在曲線上選取打斷點",964:"請輸入陣列數量",965:"是否開啟旋轉",966:"是",967:"否",968:"請選擇需要陣列的圖形：",969:"請選擇陣列中心點",970:"請選擇閉合多邊形！",971:"請選擇第一個點",972:"請選擇第二個點",973:"請選擇第一個閉合多邊形",974:"請選擇第二個閉合多邊形",975:"請選擇兩個閉合多邊形",976:"兩個多邊形沒有重合邊！",977:"請選擇目標多邊形",978:"請選擇多邊形需要添加頂點的邊",979:"請設定添加的頂點位置",980:"請選擇多邊形需要删除的頂點",981:"請選擇多邊形需要拉伸的邊",982:"請指定拉伸位置",983:"請設定圖框方向<N>",984:"橫向",985:"縱向",986:"請設定圖框尺寸<4>",987:"請設定圖框位置",988:"指定裁剪角點1",989:"指定裁剪角點2",990:"請設定道路起點",991:"請設定下一點",992:"請選擇目標對齊線對象(選擇直線)",993:"請選擇目標文字對象",994:"選擇文字對象",995:"請設定字高",996:"請設定字寬",997:"請選擇源文字",998:"請選擇第一個文字",999:"請選擇第二個文字",1e3:"請選擇需要對齊的文字",1001:"請選擇對齊管道",1002:"左",1003:"中",1004:"右",1005:"請選擇對齊基點",1006:"請選擇需要反轉的文字",1007:"請選擇需要去空格的文字",1008:"請選擇文字對象",1009:"請輸入底線寬度",1010:"請設定底線距離",1011:"請設定底線延長距離",1012:"請選擇操作選項",1013:"大寫",1014:"小寫",1015:"句首大寫",1016:"請選擇數位對象",1017:"請選擇文字插入點",1018:"選擇要查找的範圍：",1019:"請選擇查找模式",1020:"等於",1021:"包含",1022:"首碼為",1023:"尾碼為",1024:"請輸入關鍵字",1025:"選擇要操作的範圍：",1026:"選擇操作管道",1027:"添加",1028:"删除",1029:"選擇操作位置",1030:"首碼",1031:"尾碼",1032:"請輸入內容",1033:"請選擇文字",1034:"請選擇圓弧",1035:"請選擇文字樣式",1036:"請設定文字選取範圍",1037:"下載開Demo程式碼",1038:"下載開發包",1039:"調用畫圓線命令",1040:"互動畫直線",1041:"添加圖層",1042:"得到所有圖層",1043:"得到所有文字樣式",1044:"得到所有圖塊",1045:"得到所有線型",1046:"寫擴展數據",1047:"讀擴展數據",1048:"測試插入一個圖塊",1049:"繪直線",1050:"繪圓弧",1051:"繪圓",1052:"繪PL線",1053:"繪填充",1054:"繪文字",1055:"繪橢圓",1056:"繪橢圓弧",1057:"繪製多行文字",1058:"繪製表格",1059:"繪製二維碼",1060:"插入圖章",1061:"得到所有對象",1062:"互動選擇對象",1063:"保存mxweb到服務器",1064:"得到系統變數",1065:"新建圖紙",1066:"白色背景色",1067:"文字查找定位",1068:"選擇實體做塊",1069:"繪製單行文字",1070:"選點填充",1071:"設定擴展内容",1072:"繪製對齊標注",1073:"繪性線標注",1074:"角度標注",1075:"修改對象線型",1076:"選擇隱藏對象層",1077:"添加到當前選擇",1078:"視區旋轉",1079:"寫擴展記錄",1080:"得到命名字典",1081:"添加文字樣式",1082:"繪自定義實體",1083:"修改對象顏色",1084:"修改對象不可見",1085:"修改對象層",1086:"修改對象顯示順序",1087:"指定範圍輸出pdf",1088:"繪製image",1089:"讀取對象擴展字典",1090:"繪製3DPolyline",1091:"繪線文字自定義實體",1092:"計算交點",1093:"修改文字樣式",1094:"偏移輸入畫線",1095:"創建組",1096:"螢幕截圖jpg",1097:"獲取圖紙相同文字",1098:"指定範圍輸出dwg",1099:"測試繪製標記圓",1100:"測試Wipeout",1101:"創建剪切塊",1102:"公差標注",1103:"改所有對象顏色",1104:"切剪mxweb",1105:"設定當前顏色線重",1106:"查找多邊形區域內對象",1107:"打碎對象",1108:"繪半透明線",1109:"添加線型",1110:"修改圖案比例",1111:"測試文字編輯",1112:"繪製條碼",1113:"螢幕截圖bmp",1114:"修改工具",1115:"文字工具",1116:"繪圖工具",1117:"塊工具",1118:"量測工具",1119:"標注工具",1120:"其他工具",1121:"多重複製",1122:"弧轉圓",1123:"複製旋轉",1124:"圓轉多邊",1125:"修改顏色",1126:"圓弧切角",1127:"臨時隱藏",1128:"方框删除",1129:"角度複製",1130:"頂點複製",1131:"交點打斷",1132:"雙向偏移",1133:"改圓大小",1134:"線型比例",1135:"伸縮",1136:"按弧陣列",1137:"pl圓角",1138:"pl線反向",1139:"得到所有直線對象",1140:"等分",1141:"矩形縮放",1142:"打斷",1143:"切割多邊形",1144:"合併多邊形",1145:"添加多邊形頂點",1146:"删除多邊形頂點",1147:"多邊形單邊拉伸",1148:"星形",1149:"凹凸線",1150:"鋸齒線",1151:"中心矩形",1152:"圓角矩形",1153:"圓中心線",1154:"筦道",1155:"剖管符",1156:"中垂線",1157:"樓梯",1158:"實心圓",1159:"保溫棉",1160:"中心線",1161:"開洞",1162:"訊息方塊",1163:"基準符(1)",1164:"焊縫線",1165:"同心圓",1166:"齒輪",1167:"塊中心線",1168:"圓公切線",1169:"基準符(2)",1170:"插入圖框",1171:"繪製道路",1172:"繪任意多邊形",1173:"按線對齊",1174:"改字高",1175:"改字寬",1176:"刷內容",1177:"換內容",1178:"左右對齊",1179:"上下對齊",1180:"文字反轉",1181:"文字加框",1182:"底線",1183:"圖名線",1184:"大小寫",1185:"數位求和",1186:"選特定字",1187:"前尾碼",1188:"連接文字",1189:"去空格",1190:"文字豎向",1191:"按弧對齊",1192:"修改全域文字樣式",1193:"選取文字",1194:"文字編號",1195:"改塊名",1196:"刷塊",1197:"塊連線",1198:"改塊基點",1199:"改塊顏色",1200:"多塊旋轉",1201:"多塊縮放",1202:"刷塊角度",1203:"按塊選擇",1204:"按塊全選",1205:"統計單塊",1206:"統計多塊",1207:"修改塊圖層",1208:"長度",1209:"統計面積",1210:"智慧標高",1211:"面積",1212:"矩形面積",1213:"點到直線的距離",1214:"弧長",1215:"量測圓",1216:"連續量測",1217:"查看分段長度",1218:"面積含弧線",1219:"審圖標注",1220:"矩形標注",1221:"粗糙度標注",1222:"座標標注",1223:"標斜率",1224:"對齊",1225:"局部放大",1226:"序號標注",1227:"旋轉標注",1228:"圓孔標記",1229:"向視符號",1230:"射線標注",1231:"矩形標注懸停變色",1232:"裁剪圖紙擴展",1233:"箭頭直線",1234:"選擇的文字",1235:"複製到剪貼板",1236:"取消",1237:"確定",1238:"公差代號",1239:"公差1",1240:"公差2",1241:"附注",1242:"頂端",1243:"底端",1244:"基準",1245:"全周符號",1246:"當前行",1247:"新增行",1248:"删除行",1249:"清零",1250:"直線度",1251:"平面度",1252:"圓度",1253:"圓柱度",1254:"線輪廓度",1255:"面輪廓度",1256:"平行度",1257:"垂直度",1258:"傾斜度",1259:"位置度",1260:"同軸度",1261:"對稱度",1262:"圓跳動",1263:"全跳動",1264:"清除",1265:"請輸入文字內容和編號：",1266:"文字內容：",1267:"(輸入0-20個字)",1268:"起始編號：",1269:"(編號自動遞增1)",1270:"編號位置：",1271:"編號在前",1272:"編號在後",1273:"改變方向",1274:"左邊文字內容：",1275:"右邊文字內容：",1276:"底部文字內容：",1277:"基本符號",1278:"相同要求",1279:"多數符號",1280:"長邊加橫線",1281:"輔助符號",1282:"補充符號",1283:"符號位置",1284:"特殊符號",1285:"左尺寸",1286:"上尺寸",1287:"右尺寸",1288:"交錯焊縫",1289:"間距",1290:"擴充文字",1291:"虛線位置",1292:"焊接說明",1293:"清除行",1294:"卷邊焊縫",1295:"I型焊縫",1296:"V型焊縫",1297:"單邊V型焊縫",1298:"單邊陡側V型坡口堆焊",1299:"傾斜焊縫",1300:"可移除襯墊",1301:"持久襯墊",1302:"帶頓邊V型焊縫",1303:"帶頓邊U型焊縫",1304:"帶頓邊單邊V型焊縫",1305:"帶頓邊單邊U型焊縫",1306:"端接焊縫",1307:"堆焊接頭",1308:"封底焊縫",1309:"角焊縫",1310:"塞焊縫或槽焊縫",1311:"點焊縫",1312:"折疊介面",1313:"傾斜介面",1314:"點焊縫(偏移中心)",1315:"縫焊縫",1316:"縫焊縫(偏離中心)",1317:"陡側V型坡口堆焊",1318:"第一種平面符號",1319:"第二種凹面符號",1320:"第二種凸面符號",1321:"第二種平面符號",1322:"第一種凸面符號",1323:"第三種平面符號",1324:"第一種凹面符號",1325:"削平焊縫",1326:"趾部平滑過渡",1327:"帶墊板符號",1328:"三面焊縫符號",1329:"周圍焊接符",1330:"現場符號",1331:"尾部符號",1332:"交錯斷續焊接符號",1333:"喇叭形焊縫",1334:"單邊喇叭形焊縫",1335:"堆焊縫",1336:"鎖邊焊縫",1337:"鎖邊坡口",1338:"上",1339:"下",1340:"無",1341:"basicSymbol",1342:"auxiliarySymbol",1343:"suppleSymbol",1344:"specialSymbol",1345:"選擇要在幾何圖形上放置的焊縫符號",1346:"焊角寬度：",1347:"單邊V型對接焊縫(前視圖)",1348:"角焊縫(前視圖)",1349:"單邊V型對接焊縫(側視圖)",1350:"角焊縫(側視圖)"}},Symbol.toStringTag,{value:"Module"}))})(Mx,MxCAD,MXCADAPP_EXTERNALLIBRARIES.Vue,MXCADAPP_EXTERNALLIBRARIES.vuetifyComponents,MXCADAPP_EXTERNALLIBRARIES.axios);
//# sourceMappingURL=test.js.map
