import{h as D,k as q,v as le,l as pe,y as ve,d as ge,D as I,b as G,o as U,w as V,m as L,H as $,a0 as Y,L as Q,p as K,n as X,aw as ie,_ as he,c as J,a as j,t as B,F as se,C as fe,e as me,R as Ne}from"./framework.BMMljfWr.js";import{I as E,t as n,c as Ie,ca as W,ah as re,K as z,b1 as Pe,au as ke,cb as Te,cc as Fe}from"./lib.Cdm3KEls.js";import"./commonjsHelpers.Cpj98o6Y.js";const Be=navigator.platform.toLowerCase().includes("win")||navigator.userAgent.includes("Windows"),Me=()=>{const l=D([]),p=D(new Map),r=D({isLoading:!1,hasChanges:!1,lastError:null}),f=e=>{const t=l.value.find(a=>a.id===e);if(!t)return!1;const o=E.isKeySuspended(e),s=t.isSuspended;return o!==s&&(console.warn("Shortcut suspension state mismatch:",{id:e,managerState:o,localState:s}),s?E.suspendKey(e):E.resumeKey(e)),!0},y=(e,t)=>{const o=Array.isArray(e)?e:[e],s=[];return l.value.forEach(a=>{if(t&&a.id===t||a.isSuspended)return;const i=[];Array.isArray(a.key)?i.push(...a.key):a.key&&i.push(a.key),Be&&a.winKey&&(Array.isArray(a.winKey)?i.push(...a.winKey):i.push(a.winKey));const w=(S,k)=>{const P={ctrlKey:!!S.ctrlKey,shiftKey:!!S.shiftKey,altKey:!!S.altKey,metaKey:!!S.metaKey,keyCode:S.keyCode},F={ctrlKey:!!k.ctrlKey,shiftKey:!!k.shiftKey,altKey:!!k.altKey,metaKey:!!k.metaKey,keyCode:k.keyCode},g=P.ctrlKey===F.ctrlKey&&P.shiftKey===F.shiftKey&&P.altKey===F.altKey&&P.metaKey===F.metaKey,b=P.keyCode===F.keyCode;if(P.keyCode==="*"||F.keyCode==="*")return g;const T=g&&b;return T&&console.debug("Key comparison details:",{key1:P,key2:F,modifiersMatch:g,keyCodeMatch:b}),T};o.some(S=>i.some(k=>{const P=w(S,k);return P&&console.debug("Conflict detected:",{new:{keyCode:S.keyCode,ctrlKey:!!S.ctrlKey,shiftKey:!!S.shiftKey,altKey:!!S.altKey,metaKey:!!S.metaKey},existing:{keyCode:k.keyCode,ctrlKey:!!k.ctrlKey,shiftKey:!!k.shiftKey,altKey:!!k.altKey,metaKey:!!k.metaKey},shortcut:{id:a.id,label:a.info.label,command:a.info.command}}),P}))&&s.push(a)}),s.length>0&&console.warn("Shortcut conflicts found:",{newKeys:o.map(a=>({keyCode:a.keyCode,ctrlKey:!!a.ctrlKey,shiftKey:!!a.shiftKey,altKey:!!a.altKey,metaKey:!!a.metaKey})),conflicts:s.map(a=>({id:a.id,label:a.info.label,command:a.info.command,key:Array.isArray(a.key)?a.key.map(i=>({keyCode:i.keyCode,ctrlKey:!!i.ctrlKey,shiftKey:!!i.shiftKey,altKey:!!i.altKey,metaKey:!!i.metaKey})):a.key?{keyCode:a.key.keyCode,ctrlKey:!!a.key.ctrlKey,shiftKey:!!a.key.shiftKey,altKey:!!a.key.altKey,metaKey:!!a.key.metaKey}:null}))}),s},C=async e=>{const t=l.value.findIndex(o=>o.id===e);t!==-1&&(l.value.splice(t,1),E.unregister(e),r.value.hasChanges=!0)},d=()=>{try{const e=E.getRegisteredShortcuts(),t=E.getSuspendedKeys();l.value=e.filter(o=>!!(o.info&&typeof o.info.label=="string"&&typeof o.info.command=="string"&&typeof o.info.category=="string"&&typeof o.info.description=="string")).map(o=>{p.value.set(o.id,{key:o.key,winKey:o.winKey,when:o.when,action:o.action,isNoPreventDefault:o.isNoPreventDefault,info:o.info});const s=t.includes(o.id);return{...o,isSuspended:s}});for(const o of l.value)o.isSuspended&&E.suspendKey(o.id);l.value.forEach(o=>{f(o.id)})}catch(e){console.error(n("初始化快捷键失败")+":",e),r.value.lastError=e}},c=async(e,t)=>{try{r.value.isLoading=!0;const o=l.value.findIndex(N=>N.id===e);if(o===-1)return;const s=p.value.get(e);if(!s)return;const{skipConflictCheck:a,...i}=t;if(!a&&i.key){if(Array.isArray(i.key)){if(i.key.length===0)throw new Error(n("快捷键不能为空数组"));i.key.forEach((S,k)=>{if(!S.keyCode)throw new Error(`${n("快捷键数组")}${n("中")}${n("第")} ${k+1} ${n("个")}${n("快捷键无效")}`)})}else if(!i.key.keyCode)throw new Error(n("无效的快捷键"));const N=y(i.key,e);if(N.length>0){const S=N.map(k=>({label:k.info.label,command:k.info.command,key:Array.isArray(k.key)?k.key[0]:k.key}));throw console.warn("Shortcut conflict detected:",{newKey:i.key,conflicts:S}),new Error(`${n("快捷键冲突")}：${n("与")}${n("命令")} "${N.map(k=>k.info.label).join('", "')}" ${n("冲突")}`)}}const w={...l.value[o],...i,action:s.action,when:s.when};l.value[o]=w,"isSuspended"in i?i.isSuspended?(E.unregister(e),E.suspendKey(e),console.debug("Suspended shortcut:",e)):(E.resumeKey(e),E.registerWithId(e,{key:w.key,winKey:w.winKey,when:s.when,action:s.action,isNoPreventDefault:w.isNoPreventDefault,info:s.info}),console.debug("Resumed and re-registered shortcut with original ID:",e)):w.isSuspended||await E.updateShortcut(e,{key:w.key,winKey:w.winKey,when:s.when,action:s.action,isNoPreventDefault:w.isNoPreventDefault,info:s.info}),r.value.hasChanges=!0,console.debug("Shortcut updated:",{id:e,isSuspended:w.isSuspended,key:w.key})}catch(o){throw r.value.lastError=o,console.error(n("更新快捷键失败")+":",o),o}finally{r.value.isLoading=!1}},h=async()=>{try{for(const e of l.value)E.unregister(e.id);E.resumeAllKeys(),l.value=[];for(const[e,t]of p.value.entries())E.registerWithId(e,{key:t.key,winKey:t.winKey,when:t.when,action:t.action,isNoPreventDefault:t.isNoPreventDefault,info:t.info}),l.value.push({id:e,key:t.key,winKey:t.winKey,when:t.when,action:t.action,isNoPreventDefault:t.isNoPreventDefault,info:t.info,isSuspended:!1});localStorage.removeItem("mxcad-shortcuts"),localStorage.removeItem("mxcad-suspended-keys"),await d(),r.value.hasChanges=!0,console.debug("Reset to default completed, shortcuts count:",l.value.length)}catch(e){throw console.error(n("重置快捷键失败")+":",e),e}},_=async e=>{try{r.value.isLoading=!0;const t=Math.max(...l.value.map(a=>a.id),0)+1,o={id:t,key:e.key,winKey:e.winKey,info:e.info,action:a=>{e.info.command&&Ie(e.info.command)},isSuspended:!1},s=y(e.key);if(s.length>0)throw new Error(`${n("快捷键冲突")}：${n("与")}${n("命令")} "${s.map(a=>a.info.label).join('", "')}" ${n("冲突")}`);return E.registerWithId(t,{key:e.key,winKey:e.winKey,action:o.action,info:e.info}),l.value.push(o),p.value.set(t,{key:e.key,winKey:e.winKey,action:o.action,info:e.info}),r.value.hasChanges=!0,t}catch(t){throw r.value.lastError=t,console.error(n("添加快捷键失败")+":",t),t}finally{r.value.isLoading=!1}},u=async e=>{const t=l.value.findIndex(o=>o.id===e);t!==-1&&(l.value[t]={...l.value[t],key:[],winKey:void 0},E.unregister(e),r.value.hasChanges=!0)};return d(),{shortcuts:l,operationState:r,updateShortcut:c,resetToDefault:h,validateShortcutState:f,checkConflict:y,removeShortcut:C,addShortcut:_,emptiedShortcut:u}},Ue=l=>{const p=D(""),r=D("asc"),f=D("label"),y=(e,t)=>{var a;if(!t)return!0;const o=t.toLowerCase().trim();if(!o)return!0;const s=Array.isArray(e.key)?e.key.map(i=>W(i).toLowerCase()):e.key?[W(e.key).toLowerCase()]:[];return e.info.label.toLowerCase().includes(o)||e.info.command.toLowerCase().includes(o)||(((a=e.info.description)==null?void 0:a.toLowerCase())||"").includes(o)||s.some(i=>i.includes(o))},C=q(()=>{let e=[...l.value];return p.value&&(e=e.filter(t=>y(t,p.value))),e.sort((t,o)=>{const s=u(t,f.value),a=u(o,f.value),i=s.localeCompare(a);return r.value==="asc"?i:-i}),e}),d=q(()=>{const e=l.value.length,t=C.value.length;return{total:e,filtered:t,hasFilter:p.value!==""}}),c=e=>{f.value===e?r.value=r.value==="asc"?"desc":"asc":(f.value=e,r.value="asc")},h=()=>{p.value="",r.value="asc",f.value="label"},_=()=>{p.value=""},u=(e,t)=>{switch(t){case"label":return e.info.label.toLowerCase();case"command":return e.info.command.toLowerCase();case"category":return e.info.category.toLowerCase();default:return""}};return{searchText:p,sortOrder:r,sortBy:f,filteredShortcuts:C,searchStats:d,resetAll:h,resetFilter:_,toggleSort:c}},je=(l,p)=>{const r=D(null),f=D(!1);let y=null,C=!1;const d=async _=>{if(!(!r.value||!f.value||C))try{if(C=!0,_.preventDefault(),_.stopPropagation(),_.stopImmediatePropagation(),["Control","Shift","Alt","Meta","Escape"].includes(_.key)){_.key==="Escape"&&h();return}const u={keyCode:_.code,ctrlKey:_.ctrlKey,shiftKey:_.shiftKey,altKey:_.altKey,metaKey:_.metaKey},e=p(u,r.value.id);if(e.length>0){const t=re(),o=e.map(s=>`"${s.info.label}"`).join("、");await t.open({title:n("快捷键冲突"),text:`${n("快捷键")} "${W(u)}" ${n("已被以下命令使用")}：
${o}`,defineTitle:n("确定")});return}await l(r.value.id,{key:u,winKey:void 0}),h()}catch(u){console.error(n("更新快捷键失败")+":",u),await re().open({title:n("错误"),text:n("更新快捷键失败"),defineTitle:n("确定")})}finally{C=!1}},c=_=>{y&&(y(),y=null),r.value=_,f.value=!0,C=!1;const u=t=>{f.value&&(t.preventDefault(),t.stopPropagation(),d(t))};document.addEventListener("keydown",u,!0);const e=t=>{const s=t.target.closest(".shortcut-input");s&&s.classList.contains("editing")?(t.preventDefault(),t.stopPropagation()):h()};document.addEventListener("click",e,!0),y=()=>{document.removeEventListener("keydown",u,!0),document.removeEventListener("click",e,!0),C=!1}},h=()=>{y&&(y(),y=null),r.value=null,f.value=!1,C=!1,setTimeout(()=>{C=!1},100)};return{editingShortcut:r,isEditing:f,handleKeyPress:d,startEdit:c,cancelEdit:h}},ce=[{id:"all",name:n("全部"),icon:"$mdi-folder-multiple-outline",description:n("显示所有快捷键")},{id:"common",name:n("常用命令"),icon:"$mdi-star-outline",description:n("常用的基础操作命令")},{id:"draw",name:n("绘图命令"),icon:"$mdi-pencil-outline",description:n("绘制图形相关的命令")},{id:"edit",name:n("编辑命令"),icon:"$mdi-pencil-ruler",description:n("编辑修改图形的命令")},{id:"view",name:n("视图命令"),icon:"$mdi-eye-outline",description:n("视图操作相关的命令")},{id:"dim",name:n("标注命令"),icon:"$mdi-ruler",description:n("尺寸标注相关的命令")},{id:"custom",name:n("自定义命令"),icon:"$mdi-cog-outline",description:n("用户自定义的命令")}],Oe=l=>{const p=D("all"),r=D(ce),f=q(()=>{const u=new Map;return r.value.forEach(e=>{u.set(e.id,0)}),l.value.forEach(e=>{const t=e.info.category;u.set(t,(u.get(t)||0)+1)}),u.set("all",l.value.length),u}),y=u=>{u!=="all"&&f.value.get(u)===0||(p.value=u)},C=u=>r.value.find(e=>e.id===u),d=()=>{p.value="all"},c=u=>{var e;return((e=C(u))==null?void 0:e.icon)||ce[0].icon},h=u=>{var e;return((e=C(u))==null?void 0:e.name)||u},_=u=>p.value==="all"?u:u.filter(e=>e.info.category===p.value);return{categories:r.value,currentCategory:p,categoryCounts:f,switchCategory:y,getCategoryInfo:C,getCategoryIcon:c,getCategoryName:h,filterByCategory:_,resetCategory:d}};function Re(l,p,r=!1){let f=null,y=!0;return{exec:function(...c){const h=this;if(r&&y){l.apply(h,c),y=!1;return}f&&clearTimeout(f),f=setTimeout(()=>{l.apply(h,c),f=null,r&&(y=!0)},p)},cancel:()=>{f&&(clearTimeout(f),f=null),r&&(y=!0)}}}const ze=(l,p)=>{const r=D(!1),f=D(!1),y=D({lastSyncTime:null,isSyncing:!1,syncError:null}),C=new Map,d=()=>{l.value.forEach(t=>{C.set(t.id,{when:t.when,action:t.action,isNoPreventDefault:t.isNoPreventDefault})})},{cancel:c}=Re(async()=>{try{y.value.isSyncing=!0,await u(),y.value.lastSyncTime=new Date}catch(t){y.value.syncError=t,console.error(n("自动保存失败")+":",t)}finally{y.value.isSyncing=!1}},1e3),h=async()=>{try{f.value=!0;const t={version:"1.0.0",shortcuts:l.value.map(i=>({id:i.id,key:i.key,winKey:i.winKey,info:{label:i.info.label,command:i.info.command,category:i.info.category,description:i.info.description},isSuspended:!!i.isSuspended}))},o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=`shortcuts-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}catch(t){console.error(n("导出快捷键配置失败")+":",t),re().open({title:n("错误"),text:n("导出快捷键配置失败"),defineTitle:n("确定")})}finally{f.value=!1}},_=async()=>{try{r.value=!0;const t=document.createElement("input");t.type="file",t.accept=".json";const s=await(await new Promise((w,N)=>{t.onchange=S=>{const k=S.target.files;k&&k.length>0?w(k[0]):N(new Error("未选择文件"))},t.click()})).text(),a=JSON.parse(s);if(!a.version||!Array.isArray(a.shortcuts))throw new Error("无效的配置文件格式");for(const w of a.shortcuts)if(l.value.find(S=>S.id===w.id)){const S=C.get(w.id);S&&await p(w.id,{key:w.key,winKey:w.winKey,isSuspended:w.isSuspended,...S,skipConflictCheck:!0})}z().success("快捷键配置导入成功")}catch(t){console.error("导入快捷键配置失败:",t),z().error("导入快捷键配置失败")}finally{r.value=!1}},u=async()=>{try{y.value.isSyncing=!0;const t={version:"1.0.0",shortcuts:l.value.map(o=>({id:o.id,key:o.key,winKey:o.winKey,info:o.info,isSuspended:!!o.isSuspended}))};localStorage.setItem("mxcad-shortcuts",JSON.stringify(t));for(const o of l.value)o.isSuspended?await E.suspendKey(o.id):await E.resumeKey(o.id);for(const o of l.value){const s={key:o.key,winKey:o.winKey,when:o.when,action:o.action,isNoPreventDefault:o.isNoPreventDefault,info:o.info};await E.updateShortcut(o.id,s)}y.value.lastSyncTime=new Date,y.value.syncError=null}catch(t){throw y.value.syncError=t,console.error("保存快捷键配置失败:",t),z().error("保存快捷键配置失败"),t}finally{y.value.isSyncing=!1}},e=async()=>{try{const t=localStorage.getItem("mxcad-shortcuts");if(!t)return;const o=JSON.parse(t);for(const s of o.shortcuts)if(l.value.find(i=>i.id===s.id)){const i=C.get(s.id);i&&await p(s.id,{key:s.key,winKey:s.winKey,isSuspended:s.isSuspended,...i,skipConflictCheck:!0})}}catch(t){throw console.error("加载快捷键配置失败:",t),t}};return le(l,()=>{},{deep:!0}),pe(async()=>{d(),await e()}),ve(()=>{c()}),{syncState:y,exportToFile:h,importFromFile:_,saveToLocalStorage:u,loadFromLocalStorage:e,cancelAutoSave:c}},We=(l,p)=>ze(l,p),He=(l,p)=>({suspendShortcut:async d=>{if(l.value.find(h=>h.id===d))try{await p(d,{isSuspended:!0}),E.suspendKey(d)}catch(h){throw console.error(n("禁用快捷键失败")+":",h),h}},resumeShortcut:async d=>{if(l.value.find(h=>h.id===d))try{await p(d,{isSuspended:!1}),E.resumeKey(d)}catch(h){throw console.error(n("启用快捷键失败")+":",h),h}},suspendAllShortcuts:async()=>{try{for(const d of l.value)await p(d.id,{isSuspended:!0})}catch(d){throw console.error(n("禁用所有快捷键失败")+":",d),d}},resumeAllShortcuts:async()=>{try{for(const d of l.value)await p(d.id,{isSuspended:!1});E.resumeAllKeys()}catch(d){throw console.error(n("启用所有快捷键失败")+":",d),d}}}),qe={class:"pa-4"},Je=ge({__name:"AddShortcutDialog",props:{checkConflict:{type:Function}},emits:["save"],setup(l,{expose:p,emit:r}){const{isShow:f,showDialog:y}=Pe(!1,"MxCAD_AddShortcut"),C=D(!1),d=D({label:"",command:"",key:""}),c=D({label:"",command:void 0,category:"custom",description:"",key:null}),h={label:[g=>!!g||n("命令名称不能为空")],command:[g=>!!g||n("命令不能为空")],key:[g=>!!g||n("快捷键不能为空")]},_=D(),u=D([]),e=D(!1),t=g=>{if(!g){u.value=[];return}const b=g.toLowerCase();u.value=Te.value.filter(T=>T.toLowerCase().includes(b)),e.value=!0},o=g=>{c.value.command=g,c.value.label||(c.value.label=g),e.value=!1},s=D(!1),a=q(()=>c.value.key?W(c.value.key):n("点击设置快捷键")),i=l,w=async g=>{if(!s.value)return;if(g.preventDefault(),g.stopPropagation(),["Control","Shift","Alt","Meta","Escape"].includes(g.key)){g.key==="Escape"&&(s.value=!1,document.removeEventListener("keydown",w,!0));return}const b={keyCode:g.code,ctrlKey:g.ctrlKey,shiftKey:g.shiftKey,altKey:g.altKey,metaKey:g.metaKey},T=i.checkConflict(b);T.length>0?(z().warning(`${n("快捷键冲突")}：${n("与")}${n("命令")} "${T.map(H=>H.info.label).join('", "')}" ${n("冲突")}`),c.value.key=null):c.value.key=b,s.value=!1,document.removeEventListener("keydown",w,!0)},N=()=>{if(d.value={label:"",command:"",key:""},!c.value.label){d.value.label=n("命令名称不能为空");return}if(!c.value.command){d.value.command=n("命令不能为空");return}if(!c.value.key){d.value.key=n("快捷键不能为空");return}F("save",{key:c.value.key,info:{label:c.value.label,command:c.value.command,category:c.value.category,description:c.value.description}}),k(),y(!1)},S=()=>{s.value=!0,document.addEventListener("keydown",w,!0)},k=()=>{s.value=!1,document.removeEventListener("keydown",w,!0),c.value={label:"",command:"",category:"custom",description:"",key:null},d.value={label:"",command:"",key:""},u.value=[],e.value=!1,C.value=!1},P=[{name:n("确定"),fun:N,primary:!0},{name:n("取消"),fun:()=>{k(),y(!1)}}],F=r;return p({showDialog:y}),(g,b)=>{const T=I("v-text-field"),O=I("v-list-item"),H=I("v-combobox"),Z=I("v-select"),ee=I("v-textarea"),te=I("v-form");return U(),G(ke,{title:g.t("添加新快捷键"),modelValue:K(f),"onUpdate:modelValue":b[5]||(b[5]=A=>ie(f)?f.value=A:null),maxWidth:"600",footerBtnList:P},{default:V(()=>[L("div",qe,[$(te,{onSubmit:Y(N,["prevent"])},{default:V(()=>[$(T,{modelValue:c.value.label,"onUpdate:modelValue":b[0]||(b[0]=A=>c.value.label=A),rules:h.label,placeholder:g.t("命令名称"),required:"",class:"mb-3","error-messages":d.value.label},null,8,["modelValue","rules","placeholder","error-messages"]),$(H,{modelValue:c.value.command,"onUpdate:modelValue":[b[1]||(b[1]=A=>c.value.command=A),o],rules:h.command,placeholder:g.t("命令"),required:"",class:"mb-3",ref_key:"commandInput",ref:_,items:u.value,"menu-props":{modelValue:e.value,maxHeight:200},"onUpdate:search":t,"error-messages":d.value.command},{item:V(({item:A,props:oe})=>[$(O,Q(oe,{title:A.raw,onClick:ue=>o(A.raw)}),null,16,["title","onClick"])]),_:1},8,["modelValue","rules","placeholder","items","menu-props","error-messages"]),$(Z,{modelValue:c.value.category,"onUpdate:modelValue":b[2]||(b[2]=A=>c.value.category=A),items:K(ce).filter(A=>A.id!=="all"),"item-title":"name","item-value":"id",required:"",class:"mb-3"},null,8,["modelValue","items"]),$(ee,{modelValue:c.value.description,"onUpdate:modelValue":b[3]||(b[3]=A=>c.value.description=A),label:g.t("描述"),rows:"3",class:"mb-3"},null,8,["modelValue","label"]),$(T,{"model-value":a.value,onClick:S,rules:h.key,class:X({editing:s.value}),placeholder:s.value?g.t("请按下新的快捷键组合"):g.t("点击设置快捷键"),"error-messages":d.value.key,readonly:"",clearable:"","clear-icon":"$mdi-recovery","onClick:clear":b[4]||(b[4]=Y(A=>c.value.key=null,["stop"]))},null,8,["model-value","rules","class","placeholder","error-messages"])]),_:1})])]),_:1},8,["title","modelValue"])}}}),Ge=he(Je,[["__scopeId","data-v-4065322a"]]),Qe={class:"shortcut-dialog pa-4"},Xe={class:"d-flex align-center mb-4"},Ye={class:"d-flex"},Ze={class:"d-flex align-center justify-center"},et={class:"d-flex align-center justify-center"},tt={class:"text-center"},ot={class:"text-center"},nt={class:"text-center",style:{width:"86px"}},at={class:"text-center text-no-wrap"},st={class:"text-center text-no-wrap text-medium-emphasis"},lt={class:"text-center"},it={class:"d-flex align-center"},rt={class:"text-center text-caption text-medium-emphasis description-cell"},ct={class:"text-center"},ut={class:"d-flex justify-center"},dt=ge({__name:"index",setup(l){const{isShow:p,showDialog:r}=Fe,{shortcuts:f,updateShortcut:y,resetToDefault:C,checkConflict:d,removeShortcut:c,addShortcut:h,emptiedShortcut:_}=Me(),{categories:u,currentCategory:e,categoryCounts:t,switchCategory:o,getCategoryIcon:s,getCategoryName:a,filterByCategory:i,resetCategory:w}=Oe(f),{searchText:N,sortOrder:S,sortBy:k,filteredShortcuts:P,toggleSort:F,resetAll:g}=Ue(f),{editingShortcut:b,startEdit:T,cancelEdit:O}=je(y,d),{exportToFile:H,importFromFile:Z,saveToLocalStorage:ee,loadFromLocalStorage:te}=We(f,y),{suspendShortcut:A,resumeShortcut:oe}=He(f,y),ue=q(()=>i(P.value));le(p,async m=>{if(!m)try{O()}catch(x){console.error("关闭对话框清理失败:",x)}},{immediate:!0});const we=m=>{m.isSuspended?oe(m.id):A(m.id)},Se=()=>{C(),g(),w()},de=D(!1),Ke=[{name:n("确定"),fun:async()=>{try{await ee(),de.value=!de.value,r(!1)}catch(m){console.error("保存快捷键配置失败:",m)}},primary:!0},{name:n("恢复系统默认"),fun:Se},{name:n("导出配置"),fun:H},{name:n("导入配置"),fun:Z},{name:n("取消"),fun:async()=>{try{await te(),r(!1)}catch(m){console.error("加载快捷键配置失败:",m)}}}];le(b,m=>{m&&Ne(()=>{const x=document.querySelector(".shortcut-input.editing input");x instanceof HTMLElement&&x.focus({preventScroll:!0})})}),pe(()=>{document.addEventListener("click",m=>{b.value&&!m.target.closest(".shortcut-input")&&O()})}),ve(()=>{try{O()}catch(m){console.error("组件卸载清理失败:",m)}});const Ce=m=>m.key?Array.isArray(m.key)?m.key.length>0?W(m.key[0]):"":W(m.key):"",ye=D(null),be=async m=>{try{await h(m),z().success(n("添加快捷键成功"))}catch(x){console.error("添加快捷键失败:",x),z().error(x instanceof Error?x.message:n("添加快捷键失败"))}};return(m,x)=>{const ne=I("v-text-field"),R=I("v-icon"),_e=I("v-btn"),xe=I("v-list-subheader"),$e=I("v-chip"),Ee=I("v-list-item-title"),Le=I("v-list-item"),De=I("v-list"),ae=I("v-tooltip"),Ae=I("v-table");return U(),J(se,null,[$(ke,{title:m.t("键盘快捷键设置"),modelValue:K(p),"onUpdate:modelValue":x[4]||(x[4]=v=>ie(p)?p.value=v:null),maxWidth:"1000",footerBtnList:Ke},{default:V(()=>[L("div",Qe,[L("div",Xe,[$(ne,{modelValue:K(N),"onUpdate:modelValue":x[0]||(x[0]=v=>ie(N)?N.value=v:null),placeholder:m.t("搜索快捷键..."),"prepend-inner-icon":"$mdi-magnify",clearable:"",class:"flex-grow-1"},null,8,["modelValue","placeholder"]),$(_e,{color:"primary",class:"ml-4",onClick:x[1]||(x[1]=v=>{var M;return(M=ye.value)==null?void 0:M.showDialog(!0)})},{default:V(()=>[$(R,null,{default:V(()=>[...x[5]||(x[5]=[j("$mdi-plus",-1)])]),_:1}),j(" "+B(m.t("添加快捷键")),1)]),_:1})]),L("div",Ye,[$(De,{density:"compact",nav:"",rounded:"lg",width:240,class:"mr-4"},{default:V(()=>[$(xe,null,{default:V(()=>[j(B(m.t("快捷键分类")),1)]),_:1}),(U(!0),J(se,null,fe(K(u),v=>(U(),G(Le,{key:v.id,active:K(e)===v.id,onClick:M=>K(o)(v.id),class:X({"selected-category":K(e)===v.id}),rounded:"lg"},{prepend:V(()=>[$(R,{icon:K(s)(v.id),size:"small",color:K(e)===v.id?"primary":""},null,8,["icon","color"])]),default:V(()=>[$(Ee,{class:"d-flex align-center"},{default:V(()=>[j(B(m.t(K(a)(v.id)))+" ",1),$($e,{size:"x-small",class:"ml-auto",color:K(e)===v.id?"primary":"",variant:"flat"},{default:V(()=>[j(B(K(t).get(v.id)),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1032,["active","onClick","class"]))),128))]),_:1}),$(Ae,{class:"w-100",height:"300px"},{default:V(()=>[L("thead",null,[L("tr",null,[L("th",{class:"text-center sortable",onClick:x[2]||(x[2]=v=>K(F)("label"))},[L("div",Ze,[j(B(m.t("命令名称"))+" ",1),K(k)==="label"?(U(),G(R,{key:0,size:"small",class:"ml-1",icon:K(S)==="asc"?"$mdi-arrow-up":"$mdi-arrow-down",color:"primary"},null,8,["icon"])):me("",!0)])]),L("th",{class:"text-center sortable",onClick:x[3]||(x[3]=v=>K(F)("command"))},[L("div",et,[j(B(m.t("命令"))+" ",1),K(k)==="command"?(U(),G(R,{key:0,size:"small",class:"ml-1",icon:K(S)==="asc"?"$mdi-arrow-up":"$mdi-arrow-down"},null,8,["icon"])):me("",!0)])]),L("th",tt,B(m.t("快捷键")),1),L("th",ot,B(m.t("描述")),1),L("th",nt,B(m.t("操作")),1)])]),L("tbody",null,[(U(!0),J(se,null,fe(ue.value,v=>(U(),J("tr",{key:v.id,class:X({suspended:v.isSuspended})},[L("td",at,B(m.t(v.info.label)),1),L("td",st,B(v.info.command),1),L("td",lt,[L("div",it,[$(ne,{"model-value":Ce(v),class:X(["shortcut-input mx-auto",{editing:K(b)===v,disabled:v.isSuspended}]),onClick:Y(M=>K(T)(v),["stop"]),onFocus:M=>K(T)(v),readonly:!0,placeholder:K(b)===v?m.t("请按下新的快捷键组合"):"",clearable:"","clear-icon":"$mdi-recovery","onClick:clear":Y(()=>{K(_)(v.id),K(T)(v)},["stop"])},null,8,["model-value","onClick","onFocus","class","placeholder","onClick:clear"])])]),L("td",rt,[$(ae,{text:v.info.description,location:"top","max-width":"300","open-delay":500},{activator:V(({props:M})=>[L("div",Q({ref_for:!0},M,{class:"description-text"}),B(v.info.description),17)]),_:2},1032,["text"])]),L("td",ct,[L("div",ut,[$(ae,{text:v.isSuspended?m.t("启用快捷键"):m.t("禁用快捷键"),location:"top","open-delay":500},{activator:V(({props:M})=>[$(R,Q({ref_for:!0},M,{icon:v.isSuspended?"$mdi-play":"$mdi-pause",size:"x-small",class:"v-icon--clickable mr-2",color:v.isSuspended?"warning":"",onClick:Ve=>we(v)}),{default:V(()=>[...x[6]||(x[6]=[])]),_:1},16,["icon","color","onClick"])]),_:2},1032,["text"]),$(ae,{text:m.t("删除快捷键"),location:"top","open-delay":500},{activator:V(({props:M})=>[$(R,Q({ref_for:!0},M,{icon:"$mdi-close",size:"x-small",class:"v-icon--clickable",onClick:Ve=>K(c)(v.id)}),null,16,["onClick"])]),_:2},1032,["text"])])])],2))),128))])]),_:1})])])]),_:1},8,["title","modelValue"]),$(Ge,{ref_key:"addShortcutDialog",ref:ye,onSave:be,checkConflict:K(d)},null,8,["checkConflict"])],64)}}}),pt=he(dt,[["__scopeId","data-v-8317d17e"]]);export{pt as default};
