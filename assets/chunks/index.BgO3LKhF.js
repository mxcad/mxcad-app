import{aa as c,bt as O,bL as ne,ai as de,a4 as ue,t as a,ax as G,aZ as se,au as ee,aY as k,br as ce,B as me,C as ye,bs as fe,ah as pe,bM as I,bN as H,K as ve}from"./lib.DTykjivu.js";import{h as R,k as F,d as te,al as oe,x as ge,D as x,b as le,o as T,w as v,c as Y,e as _e,m as n,H as r,t as p,p as d,a as w,F as X,C as ie,_ as re,$ as Se,v as Q,aY as he,aw as be,O as Ce}from"./framework.BMMljfWr.js";import"./commonjsHelpers.Cpj98o6Y.js";const Z=()=>{try{return c.keys()||[c.defaultName]}catch(y){return console.error("获取多线样式名称失败:",y),[c.defaultName]}},Ve=y=>{try{return Z().includes(y)?(c.currentName=y,!0):!1}catch(m){return console.error("设置当前多线样式失败:",m),!1}},ke=y=>{try{if(!y.name)return!1;const{name:m}=y;return c.set(m,y),!0}catch(m){return console.error("保存多线样式失败:",m),!1}},xe=y=>{try{return y===c.defaultName?!1:Z().includes(y)?(c.remove(y),!0):!1}catch(m){return console.error("删除多线样式失败:",m),!1}},Ne=(y,m)=>{try{if(y===c.defaultName)return!1;const u=Z();if(u.includes(m))return!1;if(u.includes(y)){const e=c.get(y);return c.set(m,e),c.remove(y),c.currentName===y&&(c.currentName=m),!0}return!1}catch(u){return console.error("重命名多线样式失败:",u),!1}},we=()=>{const y=R([]),m=R(null),u=R(null),e=R(!1),h=()=>{const f=Z();y.value=f.map(b=>({...c.get(b),name:b}))};h();const E=F(()=>y.value),V=c.get(c.defaultName);return V&&(m.value={...V,name:c.defaultName}),V&&(u.value={...V,name:c.defaultName}),{styleList:E,currentStyle:m,editingStyle:u,isCreating:e,startEditing:f=>{u.value=JSON.parse(JSON.stringify(f)),e.value=!1},startCreating:()=>{const f=c.get(c.defaultName);c.defaultValue,f&&(u.value={...JSON.parse(JSON.stringify(f)),name:"",description:"新建样式"}),e.value=!0},cancelEditing:()=>{e.value=!1},saveStyle:()=>{if(!u.value||!u.value.name.trim())return!1;const f=ke(u.value);if(f){h();const b=c.get(u.value.name);b&&(m.value={...b,name:u.value.name}),e.value=!1}return f},deleteStyle:f=>{var i;if(!f||f.name===c.defaultName)return!1;const b=xe(f.name);if(b&&(h(),((i=m.value)==null?void 0:i.name)===f.name)){const t=c.get(c.defaultName);t&&(m.value={...t,name:c.defaultName})}return b},applyStyle:()=>{m.value&&(Ve(m.value.name),ne&&ne(m.value.name))},addElement:()=>{u.value&&u.value.elements&&u.value.elements.length<16&&u.value.elements.push({offset:0,color:O.kBylayer,lineType:"ByLayer"})},removeElement:f=>{u.value&&u.value.elements&&u.value.elements.length>1&&u.value.elements.splice(f,1)},extendStyle:f=>{u.value=JSON.parse(JSON.stringify(f)),u.value&&(u.value.name=""),e.value=!0},renameStyle:(f,b)=>{const i=Ne(f,b);return i&&h(),i},refreshStyleList:h}},Be={key:0,class:"d-flex flex-column pa-4"},De={class:"mb-4"},Le={class:"mb-2"},Ee={class:"mb-2"},Ue={class:"d-flex"},$e={class:"flex-grow-1 flex-shrink-0",style:{width:"40%"}},Je={class:"mb-2"},Oe={class:"d-flex mb-2"},Te={class:"d-flex align-center"},Ie={class:"mr-2"},Me={class:"d-flex mb-2"},Ae={class:"d-flex align-center"},ze={class:"mr-2"},Re={class:"d-flex mb-2"},Fe={class:"d-flex align-center"},je={class:"mr-2"},Ke={class:"ml-4 flex-grow-0 flex-shrink-0",style:{width:"60%"}},Pe={class:"d-flex justify-space-between align-center mb-2"},We={style:{width:"15%"}},Ye={style:{width:"30%"}},qe={style:{width:"30%"}},Ge={style:{width:"15%"}},He=te({__name:"index",props:{modelValue:{type:Boolean},style:{},isCreate:{type:Boolean}},emits:["update:modelValue","save","cancel"],setup(y,{emit:m}){const u=y,e=m,h=de(),{lineTypeList:E}=ue(h),V=R(),l=oe({style:{},isCreating:u.isCreate,initialized:!1}),D=F(()=>{var i,t;return l.isCreating?a("新建多线样式")+": "+(((i=l.style)==null?void 0:i.name)||""):a("修改多线样式")+": "+(((t=l.style)==null?void 0:t.name)||"")}),M=()=>{u.modelValue&&!l.initialized&&(l.style=JSON.parse(JSON.stringify(u.style)),l.isCreating=u.isCreate,l.initialized=!0)},B=()=>{l.initialized=!1};ge(()=>{u.modelValue?M():B()});const L=i=>{var _;if(!((_=l.style)!=null&&_.fill)||!i)return;let t=null;i.method===k.kNone?t=O.kBylayer:i.method===k.kByColor?t=parseInt(i.color.replace("#",""),16):i.method===k.kByLayer?t=O.kBylayer:i.method===k.kByBlock?t=O.kByblock:i.index!==-1&&(t=i.index),l.style.fill.color=t},j=(i,t)=>{var S;if(!((S=l.style)!=null&&S.elements)||!i)return;let _=null;i.method===k.kNone?_=O.kBylayer:i.method===k.kByColor?_=parseInt(i.color.replace("#",""),16):i.method===k.kByLayer?_=O.kBylayer:i.method===k.kByBlock?_=O.kByblock:i.index!==-1&&(_=i.index),l.style.elements[t].color=_},A=()=>{var i;(i=l.style)!=null&&i.elements&&l.style.elements.length<16&&l.style.elements.push({offset:0,color:O.kBylayer,lineType:"ByLayer"})},q=i=>{var t;(t=l.style)!=null&&t.elements&&l.style.elements.length>1&&l.style.elements.splice(i,1)},K=i=>{const t=ce(i),{createColor:_,colorSelectList:S}=me();let U=S.find(C=>{if(C.method===t.method){if(C.method===k.kByLayer||C.method===k.kByBlock||C.method===k.kByACI&&C.index===t.colorIndex)return!0;if(C.method===k.kByColor){const o=ye(C.color);return o.red()===t.red&&o.green()===t.green&&o.blue()===t.blue}}return!1});if(!U){const C=fe(t);U=_({color:C,name:C,method:t.method,index:t.colorIndex,n:t.n})}return U},P=()=>{e("save",l.style),e("update:modelValue",!1)},f=()=>{e("cancel"),e("update:modelValue",!1)},b=[{name:a("确定"),fun:P,primary:!0},{name:a("取消"),fun:f},{name:a("帮助"),fun:()=>{}}];return(i,t)=>{const _=x("v-text-field"),S=x("v-checkbox"),U=x("v-btn"),C=x("v-select"),o=x("v-icon"),g=x("v-table");return T(),le(ee,{maxWidth:"800","model-value":i.modelValue,keys:{enter:P},"onUpdate:modelValue":t[12]||(t[12]=s=>e("update:modelValue",s)),title:D.value,footerBtnList:b},{default:v(()=>[l.initialized?(T(),Y("div",Be,[n("div",De,[n("div",Le,p(d(a)("名称")+"(N)")+":",1),r(_,{modelValue:l.style.name,"onUpdate:modelValue":t[0]||(t[0]=s=>l.style.name=s),variant:"outlined","hide-details":"",class:"mb-4","bg-color":"grey-lighten-4",disabled:!l.isCreating},null,8,["modelValue","disabled"]),n("div",Ee,p(d(a)("说明(P)"))+":",1),r(_,{modelValue:l.style.description,"onUpdate:modelValue":t[1]||(t[1]=s=>l.style.description=s),variant:"outlined","hide-details":"",class:"mb-4","bg-color":"grey-lighten-4"},null,8,["modelValue"])]),n("div",Ue,[n("div",$e,[n("div",Je,p(d(a)("封口")),1),r(G,{title:d(a)("起点")},{default:v(()=>[n("div",Oe,[r(S,{modelValue:l.style.startCaps.line,"onUpdate:modelValue":t[2]||(t[2]=s=>l.style.startCaps.line=s),label:d(a)("直线")},null,8,["modelValue","label"]),r(S,{modelValue:l.style.startCaps.outerArc,"onUpdate:modelValue":t[3]||(t[3]=s=>l.style.startCaps.outerArc=s),label:d(a)("外弧")},null,8,["modelValue","label"]),r(S,{modelValue:l.style.startCaps.innerArc,"onUpdate:modelValue":t[4]||(t[4]=s=>l.style.startCaps.innerArc=s),label:d(a)("内弧")},null,8,["modelValue","label"])]),n("div",Te,[n("div",Ie,p(d(a)("角度")+"(A)")+":",1),r(_,{modelValue:l.style.startCaps.angle,"onUpdate:modelValue":t[5]||(t[5]=s=>l.style.startCaps.angle=s),type:"number",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])])]),_:1},8,["title"]),r(G,{title:d(a)("端点")},{default:v(()=>[n("div",Me,[r(S,{modelValue:l.style.endCaps.line,"onUpdate:modelValue":t[6]||(t[6]=s=>l.style.endCaps.line=s),label:d(a)("直线")},null,8,["modelValue","label"]),r(S,{modelValue:l.style.endCaps.outerArc,"onUpdate:modelValue":t[7]||(t[7]=s=>l.style.endCaps.outerArc=s),label:d(a)("外弧")},null,8,["modelValue","label"]),r(S,{modelValue:l.style.endCaps.innerArc,"onUpdate:modelValue":t[8]||(t[8]=s=>l.style.endCaps.innerArc=s),label:d(a)("内弧")},null,8,["modelValue","label"])]),n("div",Ae,[n("div",ze,p(d(a)("角度")+"(A)")+":",1),r(_,{modelValue:l.style.endCaps.angle,"onUpdate:modelValue":t[9]||(t[9]=s=>l.style.endCaps.angle=s),type:"number",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])])]),_:1},8,["title"]),r(G,{title:d(a)("填充")},{default:v(()=>[n("div",Re,[r(S,{modelValue:l.style.fill.enabled,"onUpdate:modelValue":t[10]||(t[10]=s=>l.style.fill.enabled=s),label:d(a)("使用填充")},null,8,["modelValue","label"])]),n("div",Fe,[n("div",je,p(d(a)("颜色(C)"))+":",1),r(se,{ref_key:"fillColorSelectRef",ref:V,"model-value":K(l.style.fill.color),onChange:L,disabled:!l.style.fill.enabled},null,8,["model-value","disabled"])])]),_:1},8,["title"]),r(G,{class:"mt-2"},{default:v(()=>[r(S,{modelValue:l.style.displayJoints,"onUpdate:modelValue":t[11]||(t[11]=s=>l.style.displayJoints=s),label:d(a)("显示连接")},null,8,["modelValue","label"])]),_:1})]),n("div",Ke,[n("div",Pe,[n("div",null,p(d(a)("图元")),1),r(U,{size:"small",color:"primary",class:"mr-2",onClick:A},{default:v(()=>[w(p(d(a)("添加")),1)]),_:1})]),r(g,{density:"compact",class:"border mb-3",height:"290",hover:!1},{default:v(()=>[n("thead",null,[n("tr",null,[n("th",We,p(d(a)("偏移")),1),n("th",Ye,p(d(a)("颜色")),1),n("th",qe,p(d(a)("线型")),1),n("th",Ge,p(d(a)("操作")),1)])]),n("tbody",null,[(T(!0),Y(X,null,ie(l.style.elements,(s,$)=>(T(),Y("tr",{key:$},[n("td",null,[r(_,{modelValue:s.offset,"onUpdate:modelValue":N=>s.offset=N,"hide-details":"",type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),n("td",null,[r(se,{"model-value":K(s.color),onChange:N=>j(N,$)},null,8,["model-value","onChange"])]),n("td",null,[r(C,{modelValue:s.lineType,"onUpdate:modelValue":N=>s.lineType=N,items:d(E),"item-title":"name","item-value":"name"},null,8,["modelValue","onUpdate:modelValue","items"])]),n("td",null,[r(U,{size:"x-small",variant:"text",icon:"",onClick:N=>q($),disabled:l.style.elements.length<=1},{default:v(()=>[r(o,{size:"x-large"},{default:v(()=>[...t[13]||(t[13]=[w("cha",-1)])]),_:1})]),_:1},8,["onClick","disabled"])])]))),128))])]),_:1})])])])):_e("",!0)]),_:1},8,["model-value","keys","title"])}}}),Ze=re(He,[["__scopeId","data-v-ddacc6e9"]]),Qe={class:"pa-4"},Xe={class:"d-flex justify-end pa-3 gap-2"},et=te({__name:"InputDialog",props:{modelValue:{type:Boolean},title:{},label:{},defaultValue:{}},emits:["update:modelValue","confirm","cancel"],setup(y,{emit:m}){const u=y,e=m,h=R(u.defaultValue||""),E=()=>{h.value.trim()&&(e("confirm",h.value.trim()),e("update:modelValue",!1))},V=()=>{e("cancel"),e("update:modelValue",!1)};return(l,D)=>{const M=x("v-text-field"),B=x("v-btn");return T(),le(ee,{title:l.title,"model-value":l.modelValue,"onUpdate:modelValue":D[1]||(D[1]=L=>e("update:modelValue",L)),"max-width":"400"},{actions:v(()=>[n("div",Xe,[r(B,{class:"mr-1",color:"primary",onClick:E},{default:v(()=>[w(p(d(a)("确定")),1)]),_:1}),r(B,{onClick:V},{default:v(()=>[w(p(d(a)("取消")),1)]),_:1})])]),default:v(()=>[n("div",Qe,[r(M,{modelValue:h.value,"onUpdate:modelValue":D[0]||(D[0]=L=>h.value=L),autofocus:"",onKeyup:Se(E,["enter"])},null,8,["modelValue"])])]),_:1},8,["title","model-value"])}}}),tt={class:"d-flex flex-column pa-4"},lt={class:"d-flex align-center mb-4 flex-wrap"},at={class:"mr-4"},nt={class:"text-body-2 font-weight-medium"},st={class:"text-primary font-weight-bold"},ot={class:"d-flex"},it={class:"flex-grow-1"},rt={class:"mb-2"},dt={class:"ml-4 d-flex flex-column",style:{width:"180px"}},ut={class:"mt-4"},ct={class:"mb-2"},mt={class:"grey lighten-4 pa-2 border"},yt=te({__name:"index",setup(y){const m=ve(),u=pe(),e=oe({styleList:[],currentStyle:null,editingStyle:null,isCreating:!1,showEditDialog:!1,showInputDialog:!1,inputDialog:{title:"",label:"",defaultValue:""}}),{styleList:h,currentStyle:E,refreshStyleList:V,deleteStyle:l,applyStyle:D,renameStyle:M}=we();Q(h,o=>{e.styleList=[...o]},{immediate:!0}),Q(E,o=>{o?e.currentStyle={...o}:e.currentStyle=null},{immediate:!0});const B=F(()=>I.value),L=F(()=>B.value),j=F(()=>e.currentStyle&&e.currentStyle.name!==c.defaultName),A=F(()=>e.currentStyle!==null),q=o=>{o&&o.name&&(e.currentStyle={...o})},K=()=>{e.currentStyle&&(D(),I.value=e.currentStyle.name)},P=()=>{const o=c.get(c.defaultName);o&&(e.editingStyle={...JSON.parse(JSON.stringify(o)),name:f("NewStyle"),description:a("新建样式")},e.isCreating=!0,e.showEditDialog=!0)},f=o=>{let g=1,s=`${o}${g}`;for(;e.styleList.some($=>$.name===s);)g++,s=`${o}${g}`;return s},b=()=>{e.currentStyle&&(e.editingStyle=JSON.parse(JSON.stringify(e.currentStyle)),e.isCreating=!1,e.showEditDialog=!0)},i=()=>{if(e.currentStyle){if(e.editingStyle=JSON.parse(JSON.stringify(e.currentStyle)),e.editingStyle){const o="Copy_of_"+e.currentStyle.name;e.editingStyle.name=f(o),e.editingStyle.description=a("继承自")+" "+e.currentStyle.name}e.isCreating=!0,e.showEditDialog=!0}},t=()=>{e.currentStyle&&e.currentStyle.name!==c.defaultName&&(e.inputDialog={title:a("重命名样式"),label:a("输入新名称"),defaultValue:e.currentStyle.name},e.showInputDialog=!0)},_=o=>{if(o&&o.trim()!==""&&e.currentStyle){if(e.styleList.find(N=>N.name.toLowerCase()===o.toLowerCase()&&N.name!==e.currentStyle.name)){m.warning(a("样式名称")+' "'+o+'" '+a("已存在，请使用其他名称"));return}const s=e.currentStyle.name;M(s,o)&&(V(),B.value===s&&(I.value=o))}},S=()=>{e.currentStyle&&e.currentStyle.name!==c.defaultName&&u.open({title:a("确认删除"),text:a("确定要删除样式")+" "+e.currentStyle.name+"?",defineTitle:a("确定"),cancelTitle:a("取消"),define:()=>{e.currentStyle&&l(e.currentStyle)}})},U=o=>{if(e.isCreating&&e.styleList.find(s=>s.name.toLowerCase()===o.name.toLowerCase()&&(e.currentStyle?s.name!==e.currentStyle.name:!0))){m.warning(a("样式名称")+' "'+o.name+'" '+a("已存在，请使用其他名称"));return}e.editingStyle=o,c.set(o.name,o),V(),e.currentStyle={...o},B.value&&e.currentStyle&&B.value===e.currentStyle.name&&(I.value=e.currentStyle.name),e.showEditDialog=!1},C=()=>{e.showEditDialog=!1};return Q(()=>H.value,o=>{if(o&&(V(),I.value)){const g=c.get(I.value);g&&(e.currentStyle={...g,name:I.value})}}),(o,g)=>{const s=x("v-icon"),$=x("v-list-item"),N=x("v-list"),z=x("v-btn");return T(),Y(X,null,[r(ee,{maxWidth:"700",modelValue:d(H),"onUpdate:modelValue":g[0]||(g[0]=J=>be(H)?H.value=J:null),title:d(a)("多线样式")},{actions:v(()=>[...g[4]||(g[4]=[n("div",null,null,-1)])]),default:v(()=>{var J;return[n("div",tt,[n("div",lt,[n("div",at,[n("span",nt,p(d(a)("当前多线样式"))+": ",1),n("span",st,p(L.value),1)])]),n("div",ot,[n("div",it,[n("div",rt,p(d(a)("样式(S)"))+":",1),r(N,{density:"compact","bg-color":"grey-lighten-3",height:"180",class:"border","select-strategy":"single-independent"},{default:v(()=>[(T(!0),Y(X,null,ie(e.styleList,W=>{var ae;return T(),le($,{key:W.name,active:((ae=e.currentStyle)==null?void 0:ae.name)===W.name,"active-class":"bg-primary text-white",onClick:ft=>q(W),title:W.name,class:"py-1"},he({_:2},[W.name===L.value?{name:"append",fn:v(()=>[r(s,{size:"small",color:"success"},{default:v(()=>[...g[3]||(g[3]=[w("mdi-check-circle",-1)])]),_:1})]),key:"0"}:void 0]),1032,["active","onClick","title"])}),128))]),_:1})]),n("div",dt,[r(z,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:K,disabled:!A.value},{default:v(()=>[w(p(d(a)("置为当前(U)")),1)]),_:1},8,["disabled"]),r(z,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:P},{default:v(()=>[w(p(d(a)("新建(N)"))+"... ",1)]),_:1}),r(z,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:i,disabled:!A.value},{default:v(()=>[w(p(d(a)("继承(E)"))+"... ",1)]),_:1},8,["disabled"]),r(z,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:b,disabled:!A.value},{default:v(()=>[w(p(d(a)("修改(M)"))+"... ",1)]),_:1},8,["disabled"]),r(z,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:t,disabled:!j.value},{default:v(()=>[w(p(d(a)("重命名(R)")),1)]),_:1},8,["disabled"]),r(z,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:S,disabled:!j.value},{default:v(()=>[w(p(d(a)("删除(D)")),1)]),_:1},8,["disabled"])])]),n("div",ut,[n("div",ct,p(d(a)("说明"))+":",1),n("div",mt,p(((J=e.currentStyle)==null?void 0:J.description)||""),1)])])]}),_:1},8,["modelValue","title"]),r(Ze,{modelValue:e.showEditDialog,"onUpdate:modelValue":g[1]||(g[1]=J=>e.showEditDialog=J),style:Ce(e.editingStyle||{}),"is-create":e.isCreating,onSave:U,onCancel:C},null,8,["modelValue","style","is-create"]),r(et,{modelValue:e.showInputDialog,"onUpdate:modelValue":g[2]||(g[2]=J=>e.showInputDialog=J),title:e.inputDialog.title,label:e.inputDialog.label,"default-value":e.inputDialog.defaultValue,onConfirm:_},null,8,["modelValue","title","label","default-value"])],64)}}}),_t=re(yt,[["__scopeId","data-v-bfcbe274"]]);export{_t as default};
