import{a3 as Y,be as D,a4 as K,bf as Z,t as n,bg as E,B as $,ai as _,c as ee,bh as te,bi as ae}from"./lib.DTykjivu.js";import{al as le}from"./framework.BMMljfWr.js";let x=!1,m;const ne=s=>{const{setValue:u,setLayerList:p}=m,{list:L}=K(m);s=typeof s=="boolean"?s:x,u("visible",s,L.value.map((h,g)=>g)),x=!s},ce=({onAddLayer:s})=>{m=Y();const u=D("Shift"),p=D("Control"),{add:L,remove:h,putCurrent:g,toggle:V,setValue:f,setIndex:i,getIndex:I,stringifyJSON:j,create:re,initLayerList:w,setLayerList:B}=m,{index:a,list:o,currentLayer:P,rootId:b}=K(m),y=()=>Array.isArray(a.value)&&a.value.length>1,z=(e,t,...l)=>{const[r,A,R]=l;if(u.value||p.value)return e.preventDefault();if(!t.isSelect)return f(r,A,R);if(y())return e.stopPropagation(),f(r,A),!1;f(r,A,R)};let c;const S=(e,t)=>{if(t&&t.target&&T(t.target),u.value){typeof c>"u"&&(c=a.value);const l=Math.max(c,e);i(ae(l===e?c:e,l));return}if(p.value){let l=[];if(Array.isArray(a.value)){const r=a.value.indexOf(e);r>=0&&a.value.length>1?(l=[...a.value],l.splice(r,1)):l=[...a.value,e]}else l=[a.value,e];i(l);return}i(e),c=e,C()},F=(e,t)=>{(!y()||!o.value[e].isSelect)&&S(e,t)};let v;const C=()=>{Array.isArray(a.value)?v=a.value[a.value.length-1]:v=a.value},N=()=>{s&&s(L()),u&&(c=o.value.length-1)};let d;const T=e=>{if(e)if(e.tagName==="INPUT")d=e;else{let l=e==null?void 0:e.getElementsByTagName("input")[0];l?d=l:T(e.parentNode)}},M=e=>{const t=I();if(Array.isArray(t)&&t.length>1)return;const l=Array.isArray(t)?t[0]:t;P.value!==o.value[l]&&o.value[l].id!==b.value&&e&&setTimeout(()=>{e.focus({preventScroll:!0}),e.select()})},H=(e,t)=>{d=e.target,a.value===t&&M(d)},J=()=>{v&&i(v),v=void 0},U=()=>{i(o.value.map((e,t)=>t))},q=()=>{i([]),C()},k=()=>{const e=Array.isArray(a.value)?a.value:[a.value];let t=[];C(),V("isSelect",o.value.map((l,r)=>(e.includes(r)||t.push(r),r))),a.value=t},G=Z({hasIcon:!0,iconType:"svg-icon",menuList:[{label:n("置为当前"),fn:()=>g(void 0,!0),disabled:y},{label:n("新建图层"),fn:()=>N()},{label:n("删除"),fn:()=>h(),disabled:()=>{var t;if(y())return!1;let e=I(a.value);return e=typeof e=="number"?e:e[0],((t=o.value[e])==null?void 0:t.id)===b.value},icon:E("youjianshanchu")},{label:n("重命名"),tips:"F2",fn:()=>M(d),disabled:y,icon:E("youjianzhongmingming")},{line:!0},{label:n("全部选择"),fn:()=>U()},{label:n("全部清除"),fn:()=>q()},{label:n("反转选择"),fn:()=>k()}]}),{createColor:Q}=$(),W=e=>{ee("Mx_Color",{call:(t,l)=>{f("color",Q({...te(t,l)}),a)},color:e})},{createLineType:se}=_(),X=e=>{f("lineType",e,a)},O=le([{name:n("新增图层"),fun:()=>{N()}},{name:n("删除图层"),fun:()=>h()},{name:n("置为当前"),fun:()=>g()},{name:n("关闭所有图层"),fun:()=>{ne(),O[3].name=x?n("开启所有图层"):n("关闭所有图层")}}]);return{onClickLayer:S,onClickStopTD:z,onClickLayerName:H,resumeIndex:J,reverseSelection:k,selectColor:W,selectLineType:X,setIndex:i,onRightClickLayer:F,initLayerList:w,setLayerList:()=>{B(j())},list:o,bodyRightClickMenuOptions:G,isShiftKeyMultipleChoice:u,isCtrlKeyMultipleChoice:p,btnList:O,rootId:b}};export{ne as d,ce as u};
