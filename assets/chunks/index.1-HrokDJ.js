import{aS as z,O as I,a1 as ee,b as $,aT as te,P as ae,t as i,j as le,Y as K,aU as se,aw as y,ax as F,ay as X,au as oe,ah as ne,K as h,m as ce,aA as ie}from"./lib.Cdm3KEls.js";import{h as L,al as re,d as ue,v as de,D as B,b as me,o as Y,w as a,m as E,H as t,p as s,aw as j,a as g,t as p,n as Z,c as q,_ as fe}from"./framework.BMMljfWr.js";import"./commonjsHelpers.Cpj98o6Y.js";var P=(r=>(r[r.HOLD=0]="HOLD",r[r.CONVERT_TO_BLOCK=1]="CONVERT_TO_BLOCK",r[r.DELETE=2]="DELETE",r))(P||{});const _e=()=>{const r=L(""),M=L(z()),b=I(!1,"Mx_CreateBlocksDialog_is_specify_on_screen_get_base_point"),u=re({x:0,y:0,z:0}),d=async()=>{const m=new le;m.clearLastInputPoint(),m.setMessage(i("指定插入基点"));const f=await m.go();if(!f)return;const{x:_,y:D,z:w}=f;return u.x=K(_,3),u.y=K(D,3),u.z=K(w,3),f},T=I(!1,"Mx_CreateBlocksDialog_is_specify_on_screen_select_object"),n=I(2,"Mx_CreateBlocksDialog_select_Object_operation_type"),O=L(!0),c=L(0);let x;const C=async()=>{if(x=new ae,c.value=0,!await x.userSelect(i("选择要做成块的对象")))return;const m=x.count();if(c.value=m,m===0){O.value=!0;return}return O.value=!1,x},V=()=>{const f=$.getCurrentMxCAD().getDatabase().getBlockTable(),_=new te;return _.name=r.value,f.add(_)},U=(m,f,_)=>{var G;(G=f.getMcDbBlockTableRecord())==null||G.getAllEntityId().forEach(R=>{var l;(l=R.getMcDbEntity())==null||l.erase()});let D=f.getMcDbBlockTableRecord();if(!D)return;m.forEach(R=>{const l=R.getMcDbEntity();if(!l)return;const e=l.clone();D&&D.appendAcDbEntity(e)}),D.origin=_;let w=new ee;return w.blockTableRecordId=f,w.position=_,w},A=L("");return{blockName:r,blockNames:M,getBlockNames:z,basePoint:u,getMouseClickGetBasePoint:d,isSpecifyOnScreenGetBasePoint:b,isNoSelectObject:O,isSpecifyOnScreenSelectObject:T,selectObjectOperationType:n,selectObject:C,createBlock:V,loadBlock:U,explainText:A,selectCount:c}},be={class:"px-3"},pe={class:"f-flex justify-center align-center mt-2"},ve={class:"f-flex justify-center align-center mt-2"},ke={class:"d-flex flex-column"},ye={key:0,class:"f-flex justify-center align-center mt-2"},ge={key:1},xe=ue({__name:"index",setup(r){const{isShow:M,showDialog:b}=se;let u;const{blockName:d,blockNames:T,basePoint:n,getMouseClickGetBasePoint:O,isSpecifyOnScreenGetBasePoint:c,isNoSelectObject:x,isSpecifyOnScreenSelectObject:C,selectObjectOperationType:V,selectObject:U,selectCount:A,createBlock:m,loadBlock:f}=_e();de(M,l=>{l&&(T.value=z())});const _=()=>{n.x=0,n.y=0,n.z=0,d.value="",u=void 0,x.value=!0,T.value=z()},D=async()=>{b(!1),await O(),b(!0)},w=async()=>{b(!1),u=await U(),b(!0)},R=[{name:"确定",fun:async()=>{const{open:l}=ne();let e=!1;const H=T.value.includes(d.value);if(d.value==="")return h().error(i("图块名不能为空")+"!");if(H)try{await new Promise((v,k)=>{l({title:i("是否替换该图块"),text:i("已定义")+d.value+i("的")+i("图块")+"，"+i("是否替换")+"?",define:()=>{e=!0,v()},cancel:()=>{e=!1,k()},defineTitle:i("是"),cancelTitle:i("否")})})}catch{return}let N;if(e?N=$.getCurrentMxCAD().getDatabase().getBlockTable().get(d.value):N=m(),c.value&&(b(!1),await O()),C.value&&(b(!1),u=await U()),!u||x.value)return h().error(i("没有为块")+d.value+i("选择对象")+"!");const S=f(u,N,new ce(n.x,n.y,n.z));if(!S)return h().error(i("创建块失败")+"!");V.value!==P.HOLD&&(u.forEach(v=>{const k=v.getMcDbEntity();k&&k.erase()}),ie()),V.value===P.CONVERT_TO_BLOCK&&$.getCurrentMxCAD().drawEntity(S),b(!1),_()},primary:!0},{name:"关闭",fun:()=>{b(!1),_()}}];return(l,e)=>{const H=B("v-combobox"),N=B("v-checkbox"),S=B("v-text-field"),v=B("v-col"),k=B("v-radio"),J=B("v-radio-group"),Q=B("v-icon"),W=B("v-row");return Y(),me(oe,{title:l.t("创建块"),onClickClose:_,modelValue:s(M),"onUpdate:modelValue":e[7]||(e[7]=o=>j(M)?M.value=o:null),"max-width":"400",footerBtnList:R},{default:a(()=>[E("div",be,[t(H,{class:"mt-2",modelValue:s(d),"onUpdate:modelValue":e[0]||(e[0]=o=>j(d)?d.value=o:null),items:s(T)},{prepend:a(()=>[t(y,{"key-name":"N"},{default:a(()=>[g(p(l.t("名称")),1)]),_:1})]),_:1},8,["modelValue","items"]),t(W,{"align-stretch":""},{default:a(()=>[t(v,{cols:6,"align-self":"stretch"},{default:a(()=>[t(F,{title:l.t("基点"),class:"h-100"},{default:a(()=>[t(N,{modelValue:s(c),"onUpdate:modelValue":e[1]||(e[1]=o=>j(c)?c.value=o:null)},{label:a(()=>[t(y,{"key-name":"S"},{default:a(()=>[g(p(l.t("在屏幕上指定")),1)]),_:1})]),_:1},8,["modelValue"]),E("div",pe,[t(X,{disabled:s(c),onClick:D},null,8,["disabled"]),t(y,{class:Z(s(c)?"text-disabled":""),"key-name":"S"},{default:a(()=>[g(p(l.t("拾取点")),1)]),_:1},8,["class"])]),t(S,{class:"mt-3",modelValue:s(n).x,"onUpdate:modelValue":e[2]||(e[2]=o=>s(n).x=o),type:"number",disabled:s(c)},{prepend:a(()=>[...e[8]||(e[8]=[E("span",{class:""}," X:",-1)])]),_:1},8,["modelValue","disabled"]),t(S,{class:"mt-1",modelValue:s(n).y,"onUpdate:modelValue":e[3]||(e[3]=o=>s(n).y=o),type:"number",disabled:s(c)},{prepend:a(()=>[...e[9]||(e[9]=[E("span",{class:""}," Y: ",-1)])]),_:1},8,["modelValue","disabled"]),t(S,{class:"mt-1",modelValue:s(n).z,"onUpdate:modelValue":e[4]||(e[4]=o=>s(n).z=o),type:"number",disabled:s(c)},{prepend:a(()=>[...e[10]||(e[10]=[E("span",{class:""}," Z:",-1)])]),_:1},8,["modelValue","disabled"])]),_:1},8,["title"])]),_:1}),t(v,{cols:6,"align-self":"stretch"},{default:a(()=>[t(F,{title:l.t("对象"),class:"h-100"},{default:a(()=>[t(N,{modelValue:s(C),"onUpdate:modelValue":e[5]||(e[5]=o=>j(C)?C.value=o:null)},{label:a(()=>[t(y,{class:"","key-name":"S"},{default:a(()=>[g(p(l.t("在屏幕上指定")),1)]),_:1})]),_:1},8,["modelValue"]),E("div",ve,[t(X,{disabled:s(C),onClick:w},null,8,["disabled"]),t(y,{class:Z(s(C)?"text-disabled":""),"key-name":"I"},{default:a(()=>[g(p(l.t("选择对象")),1)]),_:1},8,["class"])]),t(J,{column:"",class:"mt-2",modelValue:s(V),"onUpdate:modelValue":e[6]||(e[6]=o=>j(V)?V.value=o:null)},{default:a(()=>[E("div",ke,[t(k,{value:s(P).HOLD,class:"mt-1"},{label:a(()=>[t(y,{class:"","key-name":"R"},{default:a(()=>[g(p(l.t("保留")),1)]),_:1})]),_:1},8,["value"]),t(k,{value:s(P).CONVERT_TO_BLOCK,class:"mt-1"},{label:a(()=>[t(y,{class:"","key-name":"C"},{default:a(()=>[g(p(l.t("转换为块")),1)]),_:1})]),_:1},8,["value"]),t(k,{value:s(P).DELETE,class:"mt-1"},{label:a(()=>[t(y,{class:"","key-name":"D"},{default:a(()=>[g(p(l.t("删除")),1)]),_:1})]),_:1},8,["value"])])]),_:1},8,["modelValue"]),s(x)?(Y(),q("div",ye,[t(Q,{icon:"jinggao"}),t(y,{class:"","key-name":"I"},{default:a(()=>[g(p(l.t("未选定对象")),1)]),_:1})])):(Y(),q("div",ge,p(l.t("已选择对象")+":"+s(A)+l.t("个")),1))]),_:1},8,["title"])]),_:1})]),_:1})])]),_:1},8,["title","modelValue"])}}}),Ve=fe(xe,[["__scopeId","data-v-c63def7e"]]);export{Ve as default};
