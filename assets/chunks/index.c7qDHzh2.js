import{bJ as q,b1 as ot,aG as Q,au as X,bK as st,bS as it,O as W,ax as E,aw as H,ay as rt,j as ut,t as $,z as J,v as ct,K as dt,b as mt,aA as ft,h as pt,bT as vt}from"./lib.DTykjivu.js";import{h as V,d as Z,D as w,b as K,o as B,w as n,m as v,az as _t,H as e,aw as I,aH as gt,p as i,a as y,t as x,c as tt,F as et,C as bt,L as ht,_ as wt}from"./framework.BMMljfWr.js";import"./commonjsHelpers.Cpj98o6Y.js";function nt(s){const r=[];let a=null;return s.split(`
`).forEach(m=>{if(m.trim()!=="")if(m.startsWith("*")){a&&(a.value+=")",r.push(a));const f=m.substring(1).split(",").map(c=>c.trim());a={id:f[0],name:f[1],value:"(",imgPath:new URL(Object.assign({})[`/public/imgs/${f[0]}.png`],import.meta.url).href}}else{if(!a){console.error("Invalid pattern file format. Missing pattern start marker (*)");return}const f=m.trim().split(",").map(C=>C.startsWith(".")?"0"+C:C).join(),c=(a.value==="("?"(":" (")+f+")";a.value+=c}}),a&&r.push(a),r}var L=(s=>(s.ANSI="ANSI",s.ISO="ISO",s.ANY="ANY",s))(L||{});const Y={ANSI:new URL("/node_modules/mxcad/dist/fonts/mx.pat",import.meta.url).href,ISO:new URL("/node_modules/mxcad/dist/fonts/mxiso.pat",import.meta.url).href,ANY:new URL("/node_modules/mxcad/dist/fonts/mxuser.pat",import.meta.url).href},g=V(),M=V(0),G={};Object.keys(Y).forEach(async s=>{const r=Y[s],h=await(await fetch(r)).blob(),m=await q(h);G[s]=nt(m),g.value||N(s)});const A=V(""),N=s=>{A.value=Y[s],g.value=G[s];let r=0;U.value&&(r=g.value.indexOf(U.value)),U.value=g.value[r]},U=V(),xt=s=>{if(g.value){const r=g.value.indexOf(s);r>=0&&(M.value=r)}U.value=s},yt=()=>({patContent:g,activeIndex:M,defaultPatContents:G,switchPath:N,filePath:A,item:U,onchange:xt}),Ct={class:"px-3"},Dt={class:"d-flex algin-center mt-3"},St={class:"mt-2"},Pt={class:"fill_box"},kt=["onClick"],It={class:"d-inline-block text-truncate"},Vt=Z({__name:"FillSelectDialog",emits:["change"],setup(s,{expose:r,emit:a}){const{isShow:h,showDialog:m}=ot(!1),f=V(),c=()=>{f.value&&f.value.click()},C=async d=>{const o=d.target,p=o.files;if(!p)return;const F=p[0],S=await st(F);if(typeof S!="object")return;o.value="";const u=await q(S);g.value=nt(u)},P=a,D=()=>{if(g.value){const d=g.value[M.value];P("change",d)}m(!1)},b=[{name:"确定",fun:D,primary:!0},{name:"关闭",fun:()=>m(!1)}];return r({showDialog:m}),(d,o)=>{const p=w("v-btn"),F=w("v-img"),S=w("v-tooltip");return B(),K(X,{title:d.t("填充图案选择"),"max-width":"400",modelValue:i(h),"onUpdate:modelValue":o[4]||(o[4]=u=>I(h)?h.value=u:null),footerBtnList:b},{default:n(()=>[v("div",Ct,[v("div",Dt,[_t(v("input",{class:"form__inset w-100",disabled:!0,"onUpdate:modelValue":o[0]||(o[0]=u=>I(A)?A.value=u:null)},null,512),[[gt,i(A)]]),e(Q,{onClick:c,class:"ml-1"},{default:n(()=>[y(x(d.t("文件"))+"(F)...",1)]),_:1})]),v("input",{type:"file",ref_key:"fillFileSelect",ref:f,onChange:C,style:{display:"none"},accept:".pat"},null,544),v("div",St,[e(p,{density:"compact",class:"mr-2",onClick:o[1]||(o[1]=u=>i(N)(i(L).ANSI))},{default:n(()=>[...o[5]||(o[5]=[y("ANSI",-1)])]),_:1}),e(p,{density:"compact",class:"mr-2",onClick:o[2]||(o[2]=u=>i(N)(i(L).ISO))},{default:n(()=>[...o[6]||(o[6]=[y("ISO",-1)])]),_:1}),e(p,{density:"compact",onClick:o[3]||(o[3]=u=>i(N)(i(L).ANY))},{default:n(()=>[y(x(d.t("其他预定义")),1)]),_:1})]),v("div",Pt,[(B(!0),tt(et,null,bt(i(g),(u,j)=>(B(),K(S,{text:u.id+" "+u.name,location:"bottom","open-delay":800},{activator:n(({props:T})=>[v("div",ht({ref_for:!0},T,{class:["fill_pattern",i(M)===j?"fill_pattern_active":""],onClick:t=>M.value=j,onDblclick:D}),[e(F,{src:u.imgPath||"",width:"32",height:"32"},null,8,["src"]),v("span",It,x(u.id),1)],16,kt)]),_:2},1032,["text"]))),256))])])]),_:1},8,["title","modelValue"])}}}),Ft=wt(Vt,[["__scopeId","data-v-e91f8e94"]]),Mt={class:"px-3"},At={class:"d-flex align-center"},Nt={class:"mr-2"},$t=Z({__name:"index",setup(s){const{isShow:r,showDialog:a}=it,h=V(),{patContent:m,onchange:f,item:c}=yt(),C=t=>{var l;(l=h.value)==null||l.showDialog(t)},P=W(0,"PatternFillingDialog_angle"),D=W(11,"PatternFillingDialog_proportion");let b,d;const o=async()=>{a(!1);const t=new ut;t.clearLastInputPoint(),t.setMessage(`
`+$("指定填充区域内部一点")+":"),t.disableAllTrace(!0),t.setDisableOsnap(!0);const l=await t.go();l&&(d=l,b="point"),a(!0)};let p;const F=async()=>{a(!1);const t=await J.userSelect($("选择对象"));if(t&&t.length>0){const O=t[0].getMcDbEntity();O&&(p=O),b="object"}a(!0)},S=async()=>{if(b==="point"&&d){const t=J.builderHatchFromPoint(d);if(!t){ct.acutPrintf($("没有找到闭合区域")+`
`),dt().error($("没有找到闭合区域"));return}let l=mt.getCurrentMxCAD();c.value&&(l.addPatternDefinition(c.value.id,c.value.value),l.drawPatternDefinition=c.value.id),t.patternAngle=P.value,l.drawHatch(t,D.value*10),a(!1),ft(),b=d=void 0}b==="object"&&p&&(p instanceof pt&&new vt,p=b=void 0,a(!1))},u=()=>{b=p=d=void 0,a(!1)},j=[{name:"确定",fun:S,primary:!0,disabled:()=>typeof b>"u"},{name:"关闭",fun:u}],T={enter:()=>{var t;((t=document.activeElement)==null?void 0:t.tagName)!=="INPUT"&&S()},esc:u,k:o,b:F};return(t,l)=>{const O=w("v-select"),k=w("v-col"),lt=w("v-icon"),R=w("v-row"),at=w("v-img"),z=w("v-combobox");return B(),tt(et,null,[e(X,{title:t.t("图案填充"),"max-width":"360",modelValue:i(r),"onUpdate:modelValue":l[4]||(l[4]=_=>I(r)?r.value=_:null),footerBtnList:j,keys:T},{default:n(()=>[v("div",Mt,[e(E,{title:t.t("型和图案"),class:"mt-2"},{default:n(()=>[e(R,null,{default:n(()=>[e(k,{cols:"8"},{default:n(()=>[e(O,{items:i(m),"item-title":"id",modelValue:i(c),"onUpdate:modelValue":[l[0]||(l[0]=_=>I(c)?c.value=_:null),i(f)],"return-object":""},{prepend:n(()=>[y(x(t.t("样式"))+": ",1)]),_:1},8,["items","modelValue","onUpdate:modelValue"])]),_:1}),e(k,{cols:"4"},{default:n(()=>[e(Q,{style:{"min-width":"60px"},onClick:l[1]||(l[1]=_=>C(!0))},{default:n(()=>[e(lt,{icon:"class:iconfont more"})]),_:1})]),_:1})]),_:1}),e(R,null,{default:n(()=>[e(k,{cols:"8"},{default:n(()=>{var _;return[v("div",At,[v("span",Nt,x(t.t("样例"))+":",1),e(at,{src:((_=i(c))==null?void 0:_.imgPath)||"",width:"32",height:"32",style:{flex:"unset"}},null,8,["src"])])]}),_:1}),e(k,{cols:"4"})]),_:1})]),_:1},8,["title"]),e(E,{title:t.t("角度和比例"),class:"mt-2"},{default:n(()=>[e(R,null,{default:n(()=>[e(k,{cols:"6"},{default:n(()=>[e(H,{"key-name":"G",colon:""},{default:n(()=>[y(x(t.t("角度")),1)]),_:1}),e(z,{modelValue:i(P),"onUpdate:modelValue":l[2]||(l[2]=_=>I(P)?P.value=_:null),items:[0,5,10,15,20,30,45,60,90,95,100,120,135,150]},null,8,["modelValue"])]),_:1}),e(k,{cols:"6"},{default:n(()=>[e(H,{"key-name":"S",colon:""},{default:n(()=>[y(x(t.t("比例")),1)]),_:1}),e(z,{modelValue:i(D),"onUpdate:modelValue":l[3]||(l[3]=_=>I(D)?D.value=_:null),items:[.25,.5,.75,1,1.25,1.5,1.75,2,11]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["title"]),e(E,{title:t.t("边界"),class:"mt-2"},{default:n(()=>[v("div",null,[e(rt,{onClick:o}),e(H,{"key-name":"K"},{default:n(()=>[y(x(t.t("添加"))+": "+x(t.t("拾取点")),1)]),_:1})])]),_:1},8,["title"])])]),_:1},8,["title","modelValue"]),e(Ft,{ref_key:"fillSelectDialog",ref:h,onChange:i(f)},null,8,["onChange"])],64)}}});export{$t as default};
