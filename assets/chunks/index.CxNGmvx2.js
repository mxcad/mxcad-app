import{d as q,h as c,k as E,v as V,D as f,aA as H,b as D,o as p,w as v,m as W,az as Q,H as i,$ as X,c as Y,F as Z,C as ee,a as N,t as A,p as B,aw as ae}from"./framework.BMMljfWr.js";import{cq as x,a3 as le,a4 as te,t as L,ay as se,aG as I,au as oe,z as ne,P as re,cr as ue,cs as U,aP as ie}from"./lib.DTykjivu.js";import"./commonjsHelpers.Cpj98o6Y.js";const ce={class:"d-flex algin-center"},ye=q({__name:"index",setup(ve){const{isShow:m}=x,k=le(),{setValue:$,stringifyJSON:C,remove:F,setLayerList:J}=k,{list:_}=te(k),r=c(!1),u=E(()=>_.value.filter(e=>e.name).map(({name:e})=>e)),t=c([...u.value]);let g;const b=c(!0);V(m,a=>{a?g=ue():g&&b.value&&U(g)}),V(t,ie(a=>{_.value.forEach((e,s)=>{$("visible",a.includes(e.name),s)}),U(C())},100));const d=c(""),h=c(!1),K=async()=>{x.showDialog(!1);const a=await ne.userSelect(L("选择对象")),e=new Set;a.forEach(s=>{const l=s.getMcDbEntity();l&&e.add(l.layer)}),t.value=Array.from(e),x.showDialog(!0)};V(d,a=>{a===""&&(h.value=!1,r.value=!1)});const O=()=>{if(d.value===""){t.value=[];return}h.value=!0,r.value=!0,t.value=u.value.filter(a=>a.toLocaleLowerCase()===d.value.toLocaleLowerCase())},S=c([]),R=a=>{const{map:e}=a(S.value.map(l=>l.$el),(l,o)=>o);if(e.length===0)return;const s=r.value?t.value:u.value;t.value=e.map(l=>s[l])},P=(a,e,s)=>{if(a.ctrlKey)t.value.indexOf(e)===-1?t.value=[...t.value,e]:t.value=t.value.filter(o=>o!==e);else if(a.shiftKey){const l=t.value.map(w=>u.value.indexOf(w));let o=Math.min(...l),y=Math.max(...l);o>s?o=s:y=s,t.value=u.value.slice(o,y+1)}else t.value=[e]},z=E(()=>`${L("图层漫游")} - ${L("图层数")}:`+u.value.length),G=()=>{const a=new re,e=new Set;a.allSelect(),a.forEach(l=>{let o=l.getMcDbEntity();o&&e.add(o.layer)});const s=Array.from(e);F(_.value.filter(({name:l})=>!s.includes(l)),"this"),J(C())};return(a,e)=>{const s=f("v-text-field"),l=f("v-checkbox"),o=f("v-list-item"),y=f("v-list"),w=f("v-card-actions"),T=H("box-selection");return p(),D(oe,{maxWidth:"400px",ref:"layerDialog",modelValue:B(m),"onUpdate:modelValue":e[4]||(e[4]=n=>ae(m)?m.value=n:null),title:z.value},{actions:v(()=>[i(w,{class:"mx-1 mt-0 mb-1 py-0 px-2 bg-dialog-card-text d-flex justify-end"},{default:v(()=>[i(l,{class:"mr-5",label:a.t("退出时恢复"),modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=n=>b.value=n)},null,8,["label","modelValue"]),i(I,{onClick:G},{default:v(()=>[N(A(a.t("清除")),1)]),_:1}),i(I,{onClick:e[3]||(e[3]=n=>B(x).showDialog(!1))},{default:v(()=>[N(A(a.t("关闭")),1)]),_:1})]),_:1})]),default:v(()=>[W("div",ce,[i(se,{onClick:K}),i(s,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=n=>d.value=n),onKeydown:X(O,["enter"])},null,8,["modelValue"]),i(l,{label:a.t("过滤器"),modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=n=>r.value=n),disabled:!h.value},null,8,["label","modelValue","disabled"])]),Q((p(),D(y,{density:"compact",color:"primary",style:{height:"300px"}},{default:v(()=>[(p(!0),Y(Z,null,ee(r.value?[...t.value]:u.value,(n,M)=>(p(),D(o,{class:"ma-0",title:n,ref_for:!0,ref_key:"refItems",ref:S,key:M,onClick:j=>P(j,n,M),active:r.value?r.value:t.value.includes(n)},null,8,["title","onClick","active"]))),128))]),_:1})),[[T,R]])]),_:1},8,["modelValue","title"])}}});export{ye as default};
