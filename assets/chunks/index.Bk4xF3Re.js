import{h as w,d as E,l as P,D as R,b as A,o as C,w as D,m as n,H as V,az as I,a as N,t as v,aw as B,aH as U,p as g,c as F,F as j,C as z,n as H,_ as K}from"./framework.BMMljfWr.js";import{ai as G,a4 as J,bI as O,b as W,ah as $,t as f,K as q,bJ as S,aG as Q,au as X,bK as Y}from"./lib.DTykjivu.js";import"./commonjsHelpers.Cpj98o6Y.js";const Z=()=>{const k=w(0),y=G(),{createLineType:L}=y,{currentLineType:d,lineTypeList:m}=J(y),x=w([]),_=w("");return{lineTypeList:x,createLineType:L,index:k,filePath:_,parseTextLineTypes:t=>{const r=t.split(`
`),c=[];let i=null;for(let o=0;o<r.length;o++){const l=r[o].trim();if(l.startsWith("*")){i&&c.push(i);const p=l.split(","),e=p[0].slice(1).trim(),s=p.slice(1).join(",").trim(),u=r[o+1].trim().replace(/^A,/,"");i=L({name:e,appearance:s,explain:s,value:u}),o+=1}}return i&&c.push(i),c},addLineType:async t=>{let r=!1;const c=W.getCurrentMxCAD(),i=c.database.getLinetypeTable().get(t.name);if(i.isErase())r=!0;else{if(!await new Promise(e=>{$().open({title:"MxCAD",text:f("线型")+" "+t.name+f("已加载")+","+f("是否重载"),cancelTitle:f("否"),defineTitle:f("是"),cancel:()=>{e(!1)},define:()=>{e(!0)}})}))return;i.erase()}if(!c.addLinetypeEx(t.name,t.value||"","").isValid()){q().error(f("线型")+":"+t.name+f("加载失败")+"!");return}r&&m.value.push(t);const l=m.value.find(({name:p})=>t.name===p);l&&(l.value=t.value,l.explain=l.appearance=t.appearance),d.value=l||t},...O}},ee={class:"d-flex algin-center mt-3"},te={class:"mt-2"},se={class:"w-100"},ae={class:"w-100"},ne={class:"text-left"},le={class:"text-left"},ie={class:"w-100"},oe=["onClick"],ce={class:"text-left"},re={class:"text-left"},ue=E({__name:"index",emits:["change"],setup(k,{expose:y,emit:L}){const{lineTypeList:d,showDialog:m,isShow:x,index:_,filePath:h,parseTextLineTypes:T,addLineType:t,onReveal:r}=Z(),c=()=>{t(d.value[_.value]),m(!1)},i=[{name:"确定",fun:c,primary:!0},{name:"取消",fun:()=>m(!1)}],o=w(),l=()=>{o.value&&o.value.click()},p=async e=>{const u=e.target.files;if(!u)return;const a=u[0],b=await Y(a),M=await S(b);d.value=T(M),h.value=a.name};return P(async()=>{const e=new URL("/node_modules/mxcad/dist/fonts/mx.lin",import.meta.url).href,u=await(await fetch(e)).blob(),a=await S(u);h.value=e,d.value=T(a)}),r(e=>{_.value=d.value.findIndex(({name:s})=>e.name===s)}),y({showDialog:m}),(e,s)=>{const u=R("v-table");return C(),A(X,{title:e.t("线型加载或重载"),"max-width":"600",modelValue:g(x),"onUpdate:modelValue":s[1]||(s[1]=a=>B(x)?x.value=a:null),footerBtnList:i},{default:D(()=>[n("div",ee,[V(Q,{onClick:l,class:"ml-1"},{default:D(()=>[N(v(e.t("文件"))+"(F)...",1)]),_:1}),I(n("input",{class:"form__inset w-100",disabled:!0,"onUpdate:modelValue":s[0]||(s[0]=a=>B(h)?h.value=a:null)},null,512),[[U,g(h)]])]),n("input",{type:"file",ref_key:"fillSelectEl",ref:o,onChange:p,style:{display:"none"},accept:".lin"},null,544),n("div",te,[n("p",null,v(e.t("可用线型")),1),V(u,{class:"w-100",cellpadding:"20",height:"300"},{default:D(()=>[n("thead",se,[n("tr",ae,[n("th",ne,v(e.t("线型")),1),n("th",le,v(e.t("说明")),1)])]),n("tbody",ie,[(C(!0),F(j,null,z(g(d),(a,b)=>(C(),F("tr",{key:a.id,class:H(g(_)===b?"active":""),onClick:M=>_.value=b,onDblclick:c},[n("td",ce,v(a.name),1),n("td",re,v(a.appearance),1)],42,oe))),128))])]),_:1})])]),_:1},8,["title","modelValue"])}}}),me=K(ue,[["__scopeId","data-v-5e4038d3"]]);export{me as default};
