import{ch as M,t as n,au as k,ci as D,cj as F,b as j,j as I,ck as N}from"./lib.Cdm3KEls.js";import{d as P,h as d,D as A,b as E,o as H,w as u,m as r,t as c,p as s,H as m,a as y,aw as S}from"./framework.BMMljfWr.js";import"./commonjsHelpers.Cpj98o6Y.js";const W={class:"d-flex flex-column"},q={class:"d-flex align-center justify-space-between mt-1"},L={for:"exportTableInputId",class:"d-flex align-center"},R={class:"d-flex justify-space-between mt-1"},X={class:"mt-1"},z={class:"d-flex align-center mt-1"},Q=P({__name:"index",setup(G){const{isShow:x,showDialog:b}=M,f=d(4),w=d(4),V=d(50),_=d(20),v=d(""),p=d(!1),U=async()=>{try{const a=new D;a.colWidth=V.value,a.rowHeight=_.value;const e=C(w.value+(p.value?1:0),f.value);p.value&&v.value&&(e[0][0]=v.value,a.setMergeCells([{row:0,col:0,rowspan:1,colspan:f.value}])),a.setFromArray(e),requestAnimationFrame(async()=>{await g(a)})}catch(a){console.error("创建表格失败:",a)}},T=async a=>{const e=a.target;if(!e.files||e.files.length===0)return;const l=e.files[0];try{const o=await B(l),t=await F.readFromArrayBuffer(o),i=new D;i.setFromWorkbook(t),b(!1),requestAnimationFrame(async()=>{await g(i)})}catch(o){console.error("导入表格失败:",o)}finally{e.value=""}},C=(a,e)=>{const l=[];for(let o=0;o<a;o++){const t=[];for(let i=0;i<e;i++)t.push("");l.push(t)}return l},B=a=>new Promise((e,l)=>{const o=new FileReader;o.onload=()=>e(o.result),o.onerror=l,o.readAsArrayBuffer(a)}),g=async a=>{try{const e=j.getCurrentMxCAD(),l=new I;l.setMessage(`
`+n("指定表格插入点")),l.setUserDraw((t,i)=>{const h=a.clone();h.position=t,i.drawMcDbEntity(h)});const o=await l.go();if(!o)return;a.position=o,a.styleName=N.currentName,e.drawEntity(a),e.updateDisplay(),console.log("表格插入成功!")}catch(e){console.error("插入表格失败:",e)}};return(a,e)=>{const l=A("v-text-field"),o=A("v-checkbox");return H(),E(k,{title:s(n)("表格"),"max-width":"500",modelValue:s(x),"onUpdate:modelValue":e[6]||(e[6]=t=>S(x)?x.value=t:null),footerBtnList:[{name:s(n)("确定"),fun:async()=>{await U(),s(b)(!1)},primary:!0},{name:s(n)("关闭"),fun:()=>s(b)(!1)}]},{default:u(()=>[r("div",W,[r("div",q,[r("label",L,[r("div",null,c(s(n)("导入文件"))+":",1),r("input",{id:"exportTableInputId",class:"mb-1",accept:".xls,.xlsx,.xlsm,.csv,.xlsb",type:"file",onChange:T},null,32)])]),r("div",R,[r("div",null,[m(l,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),type:"number",class:"pa-0"},{prepend:u(()=>[y(c(s(n)("行"))+":",1)]),_:1},8,["modelValue"]),m(l,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),type:"number",class:"pa-0 mt-1"},{prepend:u(()=>[y(c(s(n)("列"))+":",1)]),_:1},8,["modelValue"])]),r("div",X,[m(l,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=t=>_.value=t),type:"number",class:"pa-0",density:"compact","hide-details":""},{prepend:u(()=>[y(c(s(n)("行高"))+":",1)]),_:1},8,["modelValue"]),m(l,{modelValue:V.value,"onUpdate:modelValue":e[3]||(e[3]=t=>V.value=t),type:"number",class:"pa-0 mt-1",density:"compact","hide-details":""},{prepend:u(()=>[y(c(s(n)("列宽"))+":",1)]),_:1},8,["modelValue"])])]),r("div",z,[m(o,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=t=>p.value=t),"hide-details":"",class:"ma-0 pa-0"},{label:u(()=>[r("span",null,c(s(n)("标题"))+":",1)]),_:1},8,["modelValue"]),m(l,{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=t=>v.value=t),class:"ml-2",disabled:!p.value,"hide-details":"",density:"compact"},null,8,["modelValue","disabled"])])])]),_:1},8,["title","modelValue","footerBtnList"])}}});export{Q as default};
