import{c3 as k,au as D,af as A,ag as E,aq as V}from"./lib.DTykjivu.js";import{u as B}from"./hooks.C9N3R9Vz.js";import{d as F,h as N,k as R,D as p,b as h,o as i,w as v,m as a,H as _,t as x,c as f,F as T,C as z,e as H,p as y,_ as L}from"./framework.BMMljfWr.js";import"./commonjsHelpers.Cpj98o6Y.js";const j={class:"mt-2"},q={style:{width:"90px"}},M={class:"text-center"},P={class:"text-left"},X={style:{height:"26px"}},G={style:{width:"90px"}},J={class:"d-flex justify-center"},K={key:0,class:"border_box"},O={style:{width:"auto"}},Q={style:{height:"3px"}},W=F({__name:"index",setup(Y){const{dialog:r}=B(),c=N([]),S=e=>{if(e===0)return"class:iconfont gou";if(e===1)return"class:iconfont cha"},b=e=>{if(e===0)return"#33CD2A";if(e===1)return"#ff0000"};r.onReveal(e=>{const t=[];e.externalReference.forEach(l=>{t.push({name:l,uploadState:3,progress:0,type:"ref",hash:e.hash})}),e.images.forEach(l=>{t.push({name:l,uploadState:3,progress:0,hash:e.hash,type:"img"})}),c.value=t});const w=()=>{let{baseUrl:e=""}=A()||{};e.substring(0,16)=="http://localhost"&&(e=E()+e.substring(16));const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept",".dwg,image/*"),t.style.display="none",t.setAttribute("multiple","multiple"),t.setAttribute("capture","camera"),document.body.appendChild(t),t.onchange=()=>{if(!t.files||t.files.length<1)return;const l=Array.from(t.files);c.value.filter(o=>l.some(n=>{if(n.name===o.name)return o.source=n,!0})).forEach(async o=>{const{type:n,name:m,source:s,hash:g}=o;o.uploadState=2;{const u=new FormData;s&&u.append("file",s),u.append("src_dwgfile_hash",g),u.append("ext_ref_file",m),V({url:e+(n==="img"?"/mxcad/up_ext_reference_image":"/mxcad/up_ext_reference_dwg"),method:"post",headers:{"Content-Type":"multipart/form-data"},data:u,onUploadProgress(d){d.total&&(o.progress=d.loaded/d.total*100,console.log(o.progress))}}).then(d=>{d.data.code===0?(o.uploadState=0,t.remove()):(o.uploadState=1,t.remove())},()=>{o.uploadState=1,t.remove()})}})},setTimeout(()=>{t.click()},100)},C=R(()=>c.value.some(e=>e.uploadState===2)),U=[{name:"选择文件",fun:w,disabled:()=>c.value.every(e=>e.uploadState===0)},{name:"取消",fun:()=>{r.cancel(!1),r.showDialog(!1)}},{name:"继续打开文件",fun:()=>{r.confirm(!0),r.showDialog(!1)}}];return(e,t)=>{const l=p("v-icon"),o=p("v-progress-circular"),n=p("v-table"),m=p("v-progress-linear");return i(),h(D,{title:e.t("选择上传外部参照文件"),width:"450",modelValue:y(r).isShow.value,"onUpdate:modelValue":t[0]||(t[0]=s=>y(r).isShow.value=s),footerBtnList:U},{default:v(()=>[a("div",j,[_(n,{height:"150",class:"mb-2",style:{overflow:"hidden"},hover:!1},{default:v(()=>[a("thead",null,[a("tr",null,[a("th",q,x(e.t("状态")),1),a("th",M,x(e.t("文件名")),1)])]),a("tbody",P,[(i(!0),f(T,null,z(c.value,(s,g)=>(i(),f("tr",X,[a("td",G,[a("div",J,[s.uploadState!==2?(i(),f("div",K,[_(l,{icon:S(s.uploadState),color:b(s.uploadState),size:"16"},null,8,["icon","color"])])):(i(),h(o,{key:1,rotate:360,size:16,width:2,"model-value":s.progress,color:"teal",indeterminate:s.progress===100},null,8,["model-value","indeterminate"]))])]),a("td",O,[_(k,{class:"text-left",width:285,text:s.name,"slice-num":10},null,8,["text"])])]))),256))])]),_:1}),a("div",Q,[C.value?(i(),h(m,{key:0,indeterminate:"",color:"green"})):H("",!0)])])]),_:1},8,["title","modelValue"])}}}),te=L(W,[["__scopeId","data-v-75fdb8a1"]]);export{te as default};
