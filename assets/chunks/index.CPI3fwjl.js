import{ck as r,cl as ae,b0 as ue,a4 as de,t as a,ax as K,aZ as P,a_ as ce,au as X,aY as S,bt as L,B as ne,br as me,C as fe,bs as ye,ah as ge,b1 as se,cm as I,cn as j,K as ve}from"./lib.DTykjivu.js";import{h as O,k as U,d as ee,al as ie,x as pe,D as E,b as te,o as H,w as v,c as Q,e as Se,m as u,H as m,t as p,p as i,_ as re,$ as he,a as N,v as Z,F as oe,C as _e,aY as xe,aw as Ce,O as be}from"./framework.BMMljfWr.js";import"./commonjsHelpers.Cpj98o6Y.js";const Y=()=>{try{return r.keys()||[r.defaultName]}catch(f){return console.error("获取表格样式名称失败:",f),[r.defaultName]}},ke=f=>{try{return Y().includes(f)?(r.currentName=f,!0):!1}catch(d){return console.error("设置当前表格样式失败:",d),!1}},Ve=f=>{try{if(!f.name)return!1;const{name:d}=f;return r.set(d,f),!0}catch(d){return console.error("保存表格样式失败:",d),!1}},Ne=f=>{try{return f===r.defaultName?!1:Y().includes(f)?(r.remove(f),!0):!1}catch(d){return console.error("删除表格样式失败:",d),!1}},Be=(f,d)=>{try{if(f===r.defaultName)return!1;const c=Y();if(c.includes(d))return!1;if(c.includes(f)){const e=r.get(f);return r.set(d,e),r.remove(f),r.currentName===f&&(r.currentName=d),!0}return!1}catch(c){return console.error("重命名表格样式失败:",c),!1}},we=()=>{const f=O([]),d=O(null),c=O(null),e=O(!1),h=()=>{const g=Y();f.value=g.map(_=>({...r.get(_),name:_}))};h();const B=U(()=>f.value),x=r.get(r.defaultName);return x&&(d.value={...x,name:r.defaultName}),x&&(c.value={...x,name:r.defaultName}),{styleList:B,currentStyle:d,editingStyle:c,isCreating:e,startEditing:g=>{c.value=JSON.parse(JSON.stringify(g)),e.value=!1},startCreating:()=>{const g=r.get(r.defaultName);r.defaultValue,g&&(c.value={...JSON.parse(JSON.stringify(g)),name:""}),e.value=!0},cancelEditing:()=>{e.value=!1},saveStyle:()=>{if(!c.value||!c.value.name.trim())return!1;const g=Ve(c.value);if(g){h();const _=r.get(c.value.name);_&&(d.value={..._,name:c.value.name}),e.value=!1}return g},deleteStyle:g=>{var C;if(!g||g.name===r.defaultName)return!1;const _=Ne(g.name);if(_&&(h(),((C=d.value)==null?void 0:C.name)===g.name)){const w=r.get(r.defaultName);w&&(d.value={...w,name:r.defaultName})}return _},applyStyle:()=>{d.value&&(ke(d.value.name),ae&&ae(d.value.name))},extendStyle:g=>{c.value=JSON.parse(JSON.stringify(g)),c.value&&(c.value.name=""),e.value=!0},renameStyle:(g,_)=>{const C=Be(g,_);return C&&h(),C},refreshStyleList:h}},De={key:0,class:"d-flex flex-column pa-4"},Le={class:"mb-4"},Ee={class:"mb-2"},$e={class:"d-flex"},Ie={class:"flex-grow-1 flex-shrink-0",style:{width:"50%"}},Oe={class:"d-flex align-center mb-2"},Ue={class:"mr-2"},Je={class:"d-flex align-center"},Me={class:"mr-2"},Re={class:"d-flex align-center"},Te={class:"mr-2"},He={class:"ml-4 flex-grow-1 flex-shrink-0",style:{width:"50%"}},ze={class:"d-flex align-center mb-2"},Ae={class:"mr-2"},We={class:"d-flex align-center mb-2"},Fe={class:"mr-2"},Ke={class:"d-flex align-center"},je={class:"mr-2"},Ye={class:"d-flex align-center mb-2"},qe={class:"mr-2"},Ge={class:"d-flex align-center"},Pe={class:"mr-2"},Ze=ee({__name:"index",props:{modelValue:{type:Boolean},style:{},isCreate:{type:Boolean}},emits:["update:modelValue","save","cancel"],setup(f,{emit:d}){const c=f,e=d,h=ue(),{initList:B}=h,{textStyles:x}=de(h),$=ce(),V=O(),J=O(),k=U(()=>!(!l.style.name||l.style.name.trim()===""||Number(l.style.textHeight)<=0)),l=ie({style:{...r.defaultValue},isCreating:c.isCreate,initialized:!1}),z=U(()=>{var o,t;return l.isCreating?a("新建表格样式")+": "+(((o=l.style)==null?void 0:o.name)||""):a("修改表格样式")+": "+(((t=l.style)==null?void 0:t.name)||"")}),M=()=>{c.modelValue&&!l.initialized&&(l.style=JSON.parse(JSON.stringify(c.style)),l.isCreating=c.isCreate,l.initialized=!0)},A=()=>{l.initialized=!1};pe(()=>{c.modelValue?M():A()});const g=o=>{if(!l.style||!o)return;let t=null;o.method===S.kNone?t=L.kBylayer:o.method===S.kByColor?t=parseInt(o.color.replace("#",""),16):o.method===S.kByLayer?t=L.kBylayer:o.method===S.kByBlock?t=L.kByblock:o.index!==-1&&(t=o.index),l.style.borderColor=t},_=o=>{if(!l.style||!o)return;let t=null;o.method===S.kNone?t=L.kBylayer:o.method===S.kByColor?t=parseInt(o.color.replace("#",""),16):o.method===S.kByLayer?t=L.kBylayer:o.method===S.kByBlock?t=L.kByblock:o.index!==-1&&(t=o.index),l.style.textColor=t},C=o=>{if(!l.style||!o)return;let t=null;o.method===S.kNone?t=null:o.method===S.kByColor?t=parseInt(o.color.replace("#",""),16):o.method===S.kByLayer?t=L.kBylayer:o.method===S.kByBlock?t=L.kByblock:o.index!==-1&&(t=o.index),l.style.backgroundColor=t},w=o=>{if(o==null){const{createColor:y}=ne();return y({name:a("无"),color:"#fff",method:S.kNone})}const t=me(o),{createColor:R,colorSelectList:n}=ne();let s=n.find(y=>{if(y.method===t.method){if(y.method===S.kByLayer||y.method===S.kByBlock||y.method===S.kByACI&&y.index===t.colorIndex)return!0;if(y.method===S.kByColor){const D=fe(y.color);return D.red()===t.red&&D.green()===t.green&&D.blue()===t.blue}}return!1});if(!s){const y=ye(t);s=R({color:y,name:y,method:t.method,index:t.colorIndex,n:t.n})}return s},W=()=>{k.value&&(e("save",l.style),e("update:modelValue",!1))},q=()=>{e("cancel"),e("update:modelValue",!1)},G=[{name:a("确定"),fun:W,primary:!0},{name:a("取消"),fun:q}];return(o,t)=>{const R=E("v-text-field"),n=E("v-select");return H(),te(X,{maxWidth:"800","model-value":o.modelValue,keys:{enter:W},"onUpdate:modelValue":t[7]||(t[7]=s=>e("update:modelValue",s)),title:z.value,footerBtnList:G},{default:v(()=>[l.initialized?(H(),Q("div",De,[u("div",Le,[u("div",Ee,p(i(a)("名称")+"(N)")+":",1),m(R,{modelValue:l.style.name,"onUpdate:modelValue":t[0]||(t[0]=s=>l.style.name=s),variant:"outlined","hide-details":"",class:"mb-4","bg-color":"grey-lighten-4",disabled:!l.isCreating,error:!l.style.name||l.style.name.trim()==="","error-messages":!l.style.name||l.style.name.trim()===""?i(a)("名称不能为空"):""},null,8,["modelValue","disabled","error","error-messages"])]),u("div",$e,[u("div",Ie,[m(K,{title:i(a)("边框设置")},{default:v(()=>[u("div",Oe,[u("div",Ue,p(i(a)("颜色"))+":",1),m(P,{ref_key:"borderColorSelectRef",ref:V,"model-value":w(l.style.borderColor),onChange:g},null,8,["model-value"])]),u("div",Je,[u("div",Me,p(i(a)("线宽"))+":",1),m(n,{modelValue:l.style.borderLineWeight,"onUpdate:modelValue":t[1]||(t[1]=s=>l.style.borderLineWeight=s),items:i($),"item-title":"name","hide-details":""},null,8,["modelValue","items"])])]),_:1},8,["title"]),m(K,{title:i(a)("背景设置")},{default:v(()=>[u("div",Re,[u("div",Te,p(i(a)("颜色"))+":",1),m(P,{ref:"backgroundColorSelectRef","model-value":w(l.style.backgroundColor),onChange:C},null,8,["model-value"])])]),_:1},8,["title"])]),u("div",He,[m(K,{title:i(a)("文本设置")},{default:v(()=>[u("div",ze,[u("div",Ae,p(i(a)("颜色"))+":",1),m(P,{ref_key:"textColorSelectRef",ref:J,"model-value":w(l.style.textColor),onChange:_},null,8,["model-value"])]),u("div",We,[u("div",Fe,p(i(a)("文本样式")+"(S)")+":",1),m(n,{modelValue:l.style.textStyle,"onUpdate:modelValue":t[2]||(t[2]=s=>l.style.textStyle=s),"onUpdate:menu":t[3]||(t[3]=s=>s&&i(B)()),items:i(x)},null,8,["modelValue","items"])]),u("div",Ke,[u("div",je,p(i(a)("文本高度")+"(H)")+":",1),m(R,{modelValue:l.style.textHeight,"onUpdate:modelValue":t[4]||(t[4]=s=>l.style.textHeight=s),type:"number",error:Number(l.style.textHeight)<=0,"error-messages":Number(l.style.textHeight)<=0?i(a)("文本高度必须大于0"):""},null,8,["modelValue","error","error-messages"])])]),_:1},8,["title"]),m(K,{title:i(a)("对齐方式")},{default:v(()=>[u("div",Ye,[u("div",qe,p(i(a)("水平对齐")+"(H)")+":",1),m(n,{modelValue:l.style.textAlignment,"onUpdate:modelValue":t[5]||(t[5]=s=>l.style.textAlignment=s),items:[{text:i(a)("左对齐"),value:"left"},{text:i(a)("居中"),value:"center"},{text:i(a)("右对齐"),value:"right"}],"item-title":"text","item-value":"value"},null,8,["modelValue","items"])]),u("div",Ge,[u("div",Pe,p(i(a)("垂直对齐")+"(V)")+":",1),m(n,{modelValue:l.style.textVerticalAlignment,"onUpdate:modelValue":t[6]||(t[6]=s=>l.style.textVerticalAlignment=s),items:[{text:i(a)("顶部对齐"),value:"top"},{text:i(a)("垂直居中"),value:"middle"},{text:i(a)("底部对齐"),value:"bottom"}],"item-title":"text","item-value":"value"},null,8,["modelValue","items"])])]),_:1},8,["title"])])])])):Se("",!0)]),_:1},8,["model-value","keys","title"])}}}),Qe=re(Ze,[["__scopeId","data-v-99663db8"]]),Xe={class:"pa-4"},et={class:"d-flex justify-end pa-3 gap-2"},tt=ee({__name:"InputDialog",props:{modelValue:{type:Boolean},title:{},label:{},defaultValue:{}},emits:["update:modelValue","confirm","cancel"],setup(f,{emit:d}){const c=f,e=d,h=O(c.defaultValue||""),B=()=>{h.value&&(e("confirm",h.value),e("update:modelValue",!1))},x=()=>{e("cancel"),e("update:modelValue",!1)};return($,V)=>{const J=E("v-text-field"),k=E("v-btn");return H(),te(X,{title:$.title,"model-value":$.modelValue,"onUpdate:modelValue":V[1]||(V[1]=l=>e("update:modelValue",l)),"max-width":"400"},{actions:v(()=>[u("div",et,[m(k,{class:"mr-1",color:"primary",onClick:B},{default:v(()=>[N(p(i(a)("确定")),1)]),_:1}),m(k,{onClick:x},{default:v(()=>[N(p(i(a)("取消")),1)]),_:1})])]),default:v(()=>[u("div",Xe,[m(J,{modelValue:h.value,"onUpdate:modelValue":V[0]||(V[0]=l=>h.value=l),autofocus:"",onKeyup:he(B,["enter"])},null,8,["modelValue"])])]),_:1},8,["title","model-value"])}}}),lt={class:"d-flex flex-column pa-4"},at={class:"d-flex align-center mb-4 flex-wrap"},nt={class:"mr-4"},st={class:"text-body-2 font-weight-medium"},ot={class:"text-primary font-weight-bold"},it={class:"d-flex"},rt={class:"flex-grow-1"},ut={class:"mb-2"},dt={class:"ml-4 d-flex flex-column",style:{width:"180px"}},ct=ee({__name:"index",setup(f){const d=ve(),c=ge(),e=ie({styleList:[],currentStyle:null,editingStyle:null,isCreating:!1,showEditDialog:se(!1).isShow,showInputDialog:se(!1).isShow,inputDialog:{title:"",label:"",defaultValue:""}}),{styleList:h,currentStyle:B,refreshStyleList:x,deleteStyle:$,applyStyle:V,renameStyle:J}=we();Z(h,n=>{e.styleList=[...n]},{immediate:!0}),Z(B,n=>{n?e.currentStyle={...n}:e.currentStyle=null},{immediate:!0});const k=U(()=>I.value),l=U(()=>k.value),z=U(()=>e.currentStyle&&e.currentStyle.name!==r.defaultName),M=U(()=>e.currentStyle!==null),A=n=>{n&&n.name&&(e.currentStyle={...n})},g=()=>{e.currentStyle&&(V(),I.value=e.currentStyle.name)},_=()=>{const n=r.get(r.defaultName);n&&(e.editingStyle={...JSON.parse(JSON.stringify(n)),name:C("NewStyle")},e.isCreating=!0,e.showEditDialog=!0)},C=n=>{let s=1,y=`${n}${s}`;for(;e.styleList.some(D=>D.name===y);)s++,y=`${n}${s}`;return y},w=()=>{e.currentStyle&&(e.editingStyle=JSON.parse(JSON.stringify(e.currentStyle)),e.isCreating=!1,e.showEditDialog=!0)},W=()=>{if(e.currentStyle){if(e.editingStyle=JSON.parse(JSON.stringify(e.currentStyle)),e.editingStyle){const n="Copy_of_"+e.currentStyle.name;e.editingStyle.name=C(n)}e.isCreating=!0,e.showEditDialog=!0}},q=()=>{e.currentStyle&&e.currentStyle.name!==r.defaultName&&(e.inputDialog={title:a("重命名样式"),label:a("输入新名称"),defaultValue:e.currentStyle.name},e.showInputDialog=!0)},G=n=>{if(n&&n.trim()!==""&&e.currentStyle){if(e.styleList.find(F=>F.name.toLowerCase()===n.toLowerCase()&&F.name!==e.currentStyle.name)){d.warning(a("样式名称")+' "'+n+'" '+a("已存在，请使用其他名称"));return}const y=e.currentStyle.name;J(y,n)&&(x(),k.value===y&&(I.value=n))}},o=()=>{e.currentStyle&&e.currentStyle.name!==r.defaultName&&c.open({title:a("确认删除"),text:a("确定要删除样式")+" "+e.currentStyle.name+"?",defineTitle:a("确定"),cancelTitle:a("取消"),define:()=>{e.currentStyle&&$(e.currentStyle)}})},t=n=>{if(e.isCreating&&e.styleList.find(y=>y.name.toLowerCase()===n.name.toLowerCase()&&(e.currentStyle?y.name!==e.currentStyle.name:!0))){d.warning(a("样式名称")+' "'+n.name+'" '+a("已存在，请使用其他名称"));return}e.editingStyle=n,r.set(n.name,n),x(),e.currentStyle={...n},k.value&&e.currentStyle&&k.value===e.currentStyle.name&&(I.value=e.currentStyle.name),e.showEditDialog=!1},R=()=>{e.showEditDialog=!1};return Z(()=>j.value,n=>{if(n&&(x(),I.value)){const s=r.get(I.value);s&&(e.currentStyle={...s,name:I.value})}}),(n,s)=>{const y=E("v-icon"),D=E("v-list-item"),F=E("v-list"),T=E("v-btn");return H(),Q(oe,null,[m(X,{maxWidth:"700",modelValue:i(j),"onUpdate:modelValue":s[0]||(s[0]=b=>Ce(j)?j.value=b:null),title:i(a)("表格样式")},{actions:v(()=>[...s[4]||(s[4]=[u("div",null,null,-1)])]),default:v(()=>[u("div",lt,[u("div",at,[u("div",nt,[u("span",st,p(i(a)("当前表格样式"))+": ",1),u("span",ot,p(l.value),1)])]),u("div",it,[u("div",rt,[u("div",ut,p(i(a)("样式(S)"))+":",1),m(F,{density:"compact","bg-color":"grey-lighten-3",height:"180",class:"border","select-strategy":"single-independent"},{default:v(()=>[(H(!0),Q(oe,null,_e(e.styleList,b=>{var le;return H(),te(D,{key:b.name,active:((le=e.currentStyle)==null?void 0:le.name)===b.name,"active-class":"bg-primary text-white",onClick:mt=>A(b),title:b.name,class:"py-1"},xe({_:2},[b.name===l.value?{name:"append",fn:v(()=>[m(y,{size:"small",color:"success"},{default:v(()=>[...s[3]||(s[3]=[N("mdi-check-circle",-1)])]),_:1})]),key:"0"}:void 0]),1032,["active","onClick","title"])}),128))]),_:1})]),u("div",dt,[m(T,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:g,disabled:!M.value},{default:v(()=>[N(p(i(a)("置为当前(U)")),1)]),_:1},8,["disabled"]),m(T,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:_},{default:v(()=>[N(p(i(a)("新建(N)"))+"... ",1)]),_:1}),m(T,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:W,disabled:!M.value},{default:v(()=>[N(p(i(a)("继承(E)"))+"... ",1)]),_:1},8,["disabled"]),m(T,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:w,disabled:!M.value},{default:v(()=>[N(p(i(a)("修改(M)"))+"... ",1)]),_:1},8,["disabled"]),m(T,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:q,disabled:!z.value},{default:v(()=>[N(p(i(a)("重命名(R)")),1)]),_:1},8,["disabled"]),m(T,{class:"mb-2",color:"grey-lighten-2",block:"",onClick:o,disabled:!z.value},{default:v(()=>[N(p(i(a)("删除(D)")),1)]),_:1},8,["disabled"])])])])]),_:1},8,["modelValue","title"]),m(Qe,{modelValue:e.showEditDialog,"onUpdate:modelValue":s[1]||(s[1]=b=>e.showEditDialog=b),style:be(e.editingStyle||{}),"is-create":e.isCreating,onSave:t,onCancel:R},null,8,["modelValue","style","is-create"]),m(tt,{modelValue:e.showInputDialog,"onUpdate:modelValue":s[2]||(s[2]=b=>e.showInputDialog=b),title:e.inputDialog.title,label:e.inputDialog.label,"default-value":e.inputDialog.defaultValue,onConfirm:G},null,8,["modelValue","title","label","default-value"])],64)}}}),vt=re(ct,[["__scopeId","data-v-04c0b0ef"]]);export{vt as default};
